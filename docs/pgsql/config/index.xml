<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>集群配置 on PIGSTY</title><link>https://pigsty.cc/docs/pgsql/config/</link><description>Recent content in 集群配置 on PIGSTY</description><generator>Hugo</generator><language>zh-CN</language><atom:link href="https://pigsty.cc/docs/pgsql/config/index.xml" rel="self" type="application/rss+xml"/><item><title>集群实例</title><link>https://pigsty.cc/docs/pgsql/config/cluster/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/cluster/</guid><description>&lt;blockquote&gt;
&lt;p&gt;根据需求场景选择合适的实例与集群类型，配置出满足需求的 PostgreSQL 数据库集群。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;您可以定义不同类型的实例和集群，下面是 Pigsty 中常见的几种 PostgreSQL 实例/集群类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#%E8%AF%BB%E5%86%99%E4%B8%BB%E5%BA%93"&gt;读写主库&lt;/a&gt;：定义单一实例集群。&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E5%8F%AA%E8%AF%BB%E4%BB%8E%E5%BA%93"&gt;只读从库&lt;/a&gt;：定义具有一个主库和一个副本的基本HA集群。&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E7%A6%BB%E7%BA%BF%E4%BB%8E%E5%BA%93"&gt;离线从库&lt;/a&gt;：定义专用于OLAP/ETL/交互式查询的实例&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E5%90%8C%E6%AD%A5%E5%A4%87%E5%BA%93"&gt;同步备库&lt;/a&gt;：启用同步提交以确保没有数据丢失。&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E6%B3%95%E5%AE%9A%E4%BA%BA%E6%95%B0%E6%8F%90%E4%BA%A4"&gt;法定人数提交&lt;/a&gt;：使用多数同步提交获得更高的一致性级别。&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E5%A4%87%E4%BB%BD%E9%9B%86%E7%BE%A4"&gt;备份集群&lt;/a&gt;：克隆现有集群并跟随它&lt;/li&gt;
&lt;li&gt;&lt;a href="#%E5%BB%B6%E8%BF%9F%E9%9B%86%E7%BE%A4"&gt;延迟集群&lt;/a&gt;：克隆现有集群用于紧急数据恢复&lt;/li&gt;
&lt;li&gt;&lt;a href="#citus%E9%9B%86%E7%BE%A4"&gt;Citus集群&lt;/a&gt;：定义一个Citus分布式数据库集群&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="读写主库"&gt;读写主库&lt;/h2&gt;
&lt;p&gt;我们从最简单的情况开始：由一个主库（Primary）组成的单实例集群：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-test&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-test&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这段配置言简意赅，自我描述，仅由 &lt;a href="https://pigsty.cc/docs/concept/model/pgsql#%E8%BA%AB%E4%BB%BD%E5%8F%82%E6%95%B0"&gt;&lt;strong&gt;身份参数&lt;/strong&gt;&lt;/a&gt; 构成，请注意 Ansible Group 分组名应当与 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_cluster"&gt;&lt;code&gt;pg_cluster&lt;/code&gt;&lt;/a&gt; 保持一致。&lt;/p&gt;
&lt;p&gt;使用以下命令创建该集群：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;bin/pgsql-add pg-test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Demo展示，开发测试，承载临时需求，进行无关紧要的计算分析任务时，使用单一数据库实例可能并没有太大问题。但这样的单机集群没有 &lt;a href="https://pigsty.cc/docs/concept/ha"&gt;高可用&lt;/a&gt;，当出现硬件故障时，您需要使用 &lt;a href="https://pigsty.cc/docs/concept/pitr"&gt;PITR&lt;/a&gt; 或其他恢复手段来确保集群的 RTO / RPO。为此，您可以考虑为集群添加若干个 &lt;a href="#%E5%8F%AA%E8%AF%BB%E4%BB%8E%E5%BA%93"&gt;只读从库&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="只读从库"&gt;只读从库&lt;/h2&gt;
&lt;p&gt;要添加一台只读从库（Replica）实例，您可以在 &lt;code&gt;pg-test&lt;/code&gt; 中添加一个新节点，并将其 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_role"&gt;&lt;code&gt;pg_role&lt;/code&gt;&lt;/a&gt; 设置为&lt;code&gt;replica&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-test&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 2, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;replica } &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;--- 新添加的从库&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-test&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果整个集群不存在，您可以直接 &lt;a href="https://pigsty.cc/docs/pgsql/admin/cluster#%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4"&gt;创建&lt;/a&gt; 这个完整的集群。 如果集群主库已经初始化好了，那么您可以向现有集群 &lt;a href="https://pigsty.cc/docs/pgsql/admin/cluster#%E6%89%A9%E5%AE%B9%E9%9B%86%E7%BE%A4"&gt;添加&lt;/a&gt; 一个从库：&lt;/p&gt;</description></item><item><title>内核版本</title><link>https://pigsty.cc/docs/pgsql/config/kernel/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/kernel/</guid><description>&lt;blockquote&gt;
&lt;p&gt;在 Pigsty 中选择&amp;quot;内核&amp;quot;意味着确定 PostgreSQL 大版本、模式/发行版、需要安装的包以及要加载的调优模板。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty v4.1 当前支持 PostgreSQL 13 - 18，默认使用 18。下方内容展示如何通过配置文件完成这些选择。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="大版本与软件包"&gt;大版本与软件包&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg_version&lt;/code&gt;：指定 PostgreSQL 主版本（默认 18）。Pigsty 会根据版本自动映射到正确的包名前缀。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_packages&lt;/code&gt;：定义需要安装的核心包集合，支持使用 &lt;a href="https://pigsty.cc/docs/pgsql/config/alias"&gt;包别名&lt;/a&gt;（默认 &lt;code&gt;pgsql-main pgsql-common&lt;/code&gt;，包含内核 + patroni/pgbouncer/pgbackrest 等常用工具）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_extensions&lt;/code&gt;：额外需要安装的扩展包列表，同样支持别名；缺省为空表示只装核心依赖。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;all&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_version&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;18&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pgsql-main pgsql-common ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;postgis, timescaledb, pgvector, pgml ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;效果：Ansible 在安装阶段会拉取与 &lt;code&gt;pg_version=18&lt;/code&gt; 对应的包，将扩展预装到系统中，随后数据库初始化脚本即可直接 &lt;code&gt;CREATE EXTENSION&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty 的离线仓库中不同版本的扩展支持范围不同：13 可用扩展相对较少，17/18 覆盖最广。若某扩展未预打包，可通过 &lt;code&gt;repo_packages_extra&lt;/code&gt; 追加。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="内核模式pg_mode"&gt;内核模式（pg_mode）&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;pg_mode&lt;/code&gt; 控制要部署的内核“风味”，默认 &lt;code&gt;pgsql&lt;/code&gt; 表示标准 PostgreSQL。Pigsty 目前支持以下模式：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;模式&lt;/th&gt;
 &lt;th&gt;场景&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;pgsql&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;标准 PostgreSQL，高可用 + 复制&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;citus&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Citus 分布式集群，需要额外的 &lt;code&gt;pg_shard / pg_group&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;gpsql&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Greenplum / MatrixDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;mssql&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;Babelfish for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;mysql&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;OpenGauss/HaloDB 兼容 MySQL 协议&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;polar&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;阿里 PolarDB（基于 pg &lt;code&gt;polar&lt;/code&gt; 发行）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ivory&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;IvorySQL（Oracle 兼容语法）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;oriole&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;OrioleDB 存储引擎&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;oracle&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;PostgreSQL + ora 兼容（&lt;code&gt;pg_mode: oracle&lt;/code&gt;）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;选择模式后，Pigsty 会自动加载对应的模板、依赖包与 Patroni 配置。以部署 Citus 为例：&lt;/p&gt;</description></item><item><title>别名翻译</title><link>https://pigsty.cc/docs/pgsql/config/alias/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/alias/</guid><description>&lt;p&gt;PostgreSQL 在不同操作系统上的软件包命名规则存在显著差异：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;EL 系统&lt;/strong&gt;（RHEL/Rocky/Alma/&amp;hellip;）使用 &lt;code&gt;pgvector_17&lt;/code&gt;，&lt;code&gt;postgis36_17*&lt;/code&gt; 这样的格式&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu 系统&lt;/strong&gt;使用 &lt;code&gt;postgresql-17-pgvector&lt;/code&gt;，&lt;code&gt;postgresql-17-postgis-3&lt;/code&gt; 这样的格式&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这种差异给用户带来了额外的认知负担：您需要记住不同系统的包名规则，还要处理 PostgreSQL 版本号嵌入的问题。&lt;/p&gt;
&lt;h2 id="软件包别名"&gt;软件包别名&lt;/h2&gt;
&lt;p&gt;Pigsty 通过 &lt;strong&gt;软件包别名（Package Alias）&lt;/strong&gt; 机制解决了这个问题：您只需使用统一的别名，Pigsty 会处理好所有细节：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 使用别名 —— 简单、统一、跨平台&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;postgis, pgvector, timescaledb ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 等效于 EL9 + PG17 上的实际包名&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;postgis36_17*, pgvector_17*, timescaledb-tsl_17* ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 等效于 Ubuntu 24 + PG17 上的实际包名&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;postgresql-17-postgis-3, postgresql-17-pgvector, postgresql-17-timescaledb-tsl ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="别名翻译"&gt;别名翻译&lt;/h2&gt;
&lt;p&gt;别名还可以将一组软件包归类为一个整体，例如 Pigsty 默认安装的软件包 —— &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_packages"&gt;&lt;strong&gt;&lt;code&gt;pg_packages&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 的默认值是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# pg packages to be installed, alias can be used&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- &lt;span style="color:#000"&gt;pgsql-main pgsql-common&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pigsty 将查询当前的操作系统别名清单（假设为 &lt;a href="https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el10.x86_64.yml#L105"&gt;&lt;strong&gt;&lt;code&gt;el10.x86_64&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;），将其翻译为 PGSQL 内核，扩展，以及工具包：&lt;/p&gt;</description></item><item><title>用户/角色</title><link>https://pigsty.cc/docs/pgsql/config/user/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/user/</guid><description>&lt;blockquote&gt;
&lt;p&gt;在本文中，&amp;ldquo;用户&amp;rdquo;（User） 指的是使用 SQL 命令 &lt;code&gt;CREATE USER/ROLE&lt;/code&gt; 创建的，数据库集簇内的逻辑对象。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在 PostgreSQL 中，用户直接隶属于数据库集簇而非某个具体的数据库。因此在创建业务数据库和业务用户时，应当遵循&amp;quot;先用户，后数据库&amp;quot;的原则。&lt;/p&gt;
&lt;p&gt;Pigsty 通过两个配置参数定义数据库集群中的角色与用户：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/pgsql/param#pg_default_roles"&gt;&lt;strong&gt;&lt;code&gt;pg_default_roles&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：定义全局统一使用的角色和用户&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/pgsql/param#pg_users"&gt;&lt;strong&gt;&lt;code&gt;pg_users&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：在数据库集群层面定义业务用户和角色&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;前者用于定义整套环境中共用的角色与用户，后者定义单个集群中特有的业务角色与用户。二者形式相同，均为用户定义对象的数组。
用户/角色按数组顺序逐一创建，因此后定义的用户可以属于先定义的角色。&lt;/p&gt;
&lt;p&gt;默认情况下，所有带有 &lt;code&gt;pgbouncer: true&lt;/code&gt; 标记的用户都会被添加到 &lt;a href="https://pigsty.cc/docs/concept/arch/pgsql#pgbouncer"&gt;&lt;strong&gt;Pgbouncer&lt;/strong&gt;&lt;/a&gt; 连接池用户列表中。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="定义用户"&gt;定义用户&lt;/h2&gt;
&lt;p&gt;下面是 Pigsty 演示环境中默认集群 &lt;code&gt;pg-meta&lt;/code&gt; 中的业务用户定义：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer for meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_grafana ,password: DBUser.Grafana ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for grafana database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_bytebase ,password: DBUser.Bytebase ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for bytebase database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_kong ,password: DBUser.Kong ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for kong api gateway }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_gitea ,password: DBUser.Gitea ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for gitea service }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_wiki ,password: DBUser.Wiki ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for wiki.js service }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_noco ,password: DBUser.Noco ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;admin user for nocodb service }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_remove ,state: absent } # 使用 state&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;absent 删除用户&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;每个用户/角色定义都是一个复杂对象，可能包括以下字段，除了 &lt;code&gt;name&lt;/code&gt; 字段外，其他字段均为可选字段：&lt;/p&gt;</description></item><item><title>数据库</title><link>https://pigsty.cc/docs/pgsql/config/db/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/db/</guid><description>&lt;blockquote&gt;
&lt;p&gt;在本文中，“数据库”（Database） 指的是使用 SQL 命令 &lt;code&gt;CREATE DATABASE&lt;/code&gt; 创建的，数据库集簇内的逻辑对象。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;一组 PostgreSQL 服务器可以同时服务于多个 &lt;strong&gt;数据库&lt;/strong&gt; （Database）。在 Pigsty 中，你可以在集群配置中 &lt;a href="#%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E5%BA%93"&gt;&lt;strong&gt;定义&lt;/strong&gt;&lt;/a&gt; 好所需的数据库。&lt;/p&gt;
&lt;p&gt;Pigsty会对默认模板数据库&lt;code&gt;template1&lt;/code&gt;进行修改与定制，创建默认模式，安装默认扩展，配置默认权限，新创建的数据库默认会从&lt;code&gt;template1&lt;/code&gt;继承这些设置。
您也可以通过 &lt;a href="#template"&gt;&lt;strong&gt;&lt;code&gt;template&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 参数指定其他模板数据库，实现瞬间 &lt;a href="https://pigsty.cc/docs/pgsql/admin/db#%E5%85%8B%E9%9A%86%E6%95%B0%E6%8D%AE%E5%BA%93"&gt;&lt;strong&gt;数据库克隆&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;默认情况下，所有业务数据库都会被 1:1 添加到 &lt;a href="https://pigsty.cc/docs/concept/arch/pgsql#pgbouncer"&gt;&lt;strong&gt;Pgbouncer&lt;/strong&gt;&lt;/a&gt; &lt;a href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0"&gt;&lt;strong&gt;连接池&lt;/strong&gt;&lt;/a&gt; 中；&lt;a href="https://pigsty.cc/docs/concept/arch/pgsql#pg_exporter"&gt;&lt;strong&gt;&lt;code&gt;pg_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 默认会通过 &lt;strong&gt;自动发现&lt;/strong&gt; 机制查找所有业务数据库并进行库内对象监控。
所有数据库也会添加到所有 &lt;a href="https://pigsty.cc/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;INFRA节点&lt;/strong&gt;&lt;/a&gt; 上的 &lt;a href="https://pigsty.cc/docs/concept/arch/infra#grafana"&gt;&lt;strong&gt;Grafana&lt;/strong&gt;&lt;/a&gt; 中，
注册为 PostgreSQL 数据源供 PGCAT 监控面板使用。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="定义数据库"&gt;定义数据库&lt;/h2&gt;
&lt;p&gt;业务数据库定义在数据库集群参数 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_databases"&gt;&lt;strong&gt;&lt;code&gt;pg_databases&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 中，这是一个数据库定义构成的对象数组。
在集群初始化时，数组内的数据库按照 &lt;strong&gt;定义顺序&lt;/strong&gt; 依次创建，因此后面定义的数据库可以使用先前定义的数据库作为&lt;strong&gt;模板&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;下面是 Pigsty 演示环境中默认集群 &lt;code&gt;pg-meta&lt;/code&gt; 中的数据库定义：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;{&lt;span style="color:#204a87;font-weight:bold"&gt;name: postgis, schema&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;public}, {name: timescaledb}]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: grafana ,owner: dbuser_grafana ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;grafana primary database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: bytebase ,owner: dbuser_bytebase ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;bytebase primary database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: kong ,owner: dbuser_kong ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;kong the api gateway database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: gitea ,owner: dbuser_gitea ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;gitea meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: wiki ,owner: dbuser_wiki ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;wiki meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: noco ,owner: dbuser_noco ,revokeconn: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;nocodb database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;每个数据库定义都是一个复杂对象，可能包括以下字段，除了 &lt;code&gt;name&lt;/code&gt; 字段外，其他字段均为可选字段：&lt;/p&gt;</description></item><item><title>HBA 规则</title><link>https://pigsty.cc/docs/pgsql/config/hba/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/hba/</guid><description>&lt;h2 id="概述"&gt;概述&lt;/h2&gt;
&lt;p&gt;HBA（Host-Based Authentication）控制&amp;quot;谁可以从哪里、以什么方式连接到数据库&amp;quot;。
Pigsty 通过 &lt;a href="#pg_default_hba_rules"&gt;&lt;strong&gt;&lt;code&gt;pg_default_hba_rules&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="#pg_hba_rules"&gt;&lt;strong&gt;&lt;code&gt;pg_hba_rules&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 让 HBA 规则也能以声明式配置形式管理。&lt;/p&gt;
&lt;p&gt;Pigsty 在集群初始化或 HBA 刷新时渲染以下配置文件：&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;配置文件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;路径&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL HBA&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;/pg/data/pg_hba.conf&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 服务器的 HBA 规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer HBA&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;/etc/pgbouncer/pgb_hba.conf&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;连接池 Pgbouncer 的 HBA 规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;HBA 规则由以下参数控制：&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;参数&lt;/th&gt;
 &lt;th style="text-align: left"&gt;层级&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pg_default_hba_rules"&gt;&lt;code&gt;pg_default_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 全局默认 HBA 规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pg_hba_rules"&gt;&lt;code&gt;pg_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G/C/I&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 集群/实例级追加规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgb_default_hba_rules"&gt;&lt;code&gt;pgb_default_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer 全局默认 HBA 规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgb_hba_rules"&gt;&lt;code&gt;pgb_hba_rules&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;G/C/I&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pgbouncer 集群/实例级追加规则&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;规则支持以下特性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;按角色过滤&lt;/strong&gt;：规则支持 &lt;code&gt;role&lt;/code&gt; 字段，根据实例的 &lt;code&gt;pg_role&lt;/code&gt; 自动筛选生效&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;按顺序排序&lt;/strong&gt;：规则支持 &lt;code&gt;order&lt;/code&gt; 字段，控制规则在最终配置文件中的位置&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;两种写法&lt;/strong&gt;：支持别名形式（简化语法）和原始形式（直接 HBA 文本）&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="刷新-hba"&gt;刷新 HBA&lt;/h2&gt;
&lt;p&gt;修改配置后，需要重新渲染配置文件并让服务重载：&lt;/p&gt;</description></item><item><title>参数配置</title><link>https://pigsty.cc/docs/pgsql/config/param/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/param/</guid><description>&lt;p&gt;PostgreSQL 参数可以在多个层级进行配置，不同层级的参数设置具有不同的作用范围和优先级。
Pigsty 支持在四个层级配置 PostgreSQL 参数，从全局到局部依次为：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;层级&lt;/th&gt;
 &lt;th&gt;作用范围&lt;/th&gt;
 &lt;th&gt;配置方式&lt;/th&gt;
 &lt;th&gt;存储位置&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#%E9%9B%86%E7%BE%A4%E7%BA%A7%E5%8F%82%E6%95%B0"&gt;&lt;strong&gt;集群级&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;整个集群所有实例&lt;/td&gt;
 &lt;td&gt;Patroni DCS / 调优模板&lt;/td&gt;
 &lt;td&gt;etcd + &lt;code&gt;postgresql.conf&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#%E5%AE%9E%E4%BE%8B%E7%BA%A7%E5%8F%82%E6%95%B0"&gt;&lt;strong&gt;实例级&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;单个 PostgreSQL 实例&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_parameters&lt;/code&gt; / &lt;code&gt;ALTER SYSTEM&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;postgresql.auto.conf&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A7%E5%8F%82%E6%95%B0"&gt;&lt;strong&gt;数据库级&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;特定数据库的所有会话&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_databases[].parameters&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_db_role_setting&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#%E7%94%A8%E6%88%B7%E7%BA%A7%E5%8F%82%E6%95%B0"&gt;&lt;strong&gt;用户级&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;特定用户的所有会话&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_users[].parameters&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_db_role_setting&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;参数优先级从低到高：&lt;strong&gt;集群级 &amp;lt; 实例级 &amp;lt; 数据库级 &amp;lt; 用户级 &amp;lt; 会话级&lt;/strong&gt;（&lt;code&gt;SET&lt;/code&gt; 命令）。
高优先级的设置会覆盖低优先级的设置。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;关于 PostgreSQL 参数的完整说明，请参阅 &lt;a href="https://www.postgresql.org/docs/current/runtime-config.html"&gt;&lt;strong&gt;PostgreSQL 官方文档：服务器配置&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="集群级参数"&gt;集群级参数&lt;/h2&gt;
&lt;p&gt;集群级参数是整个 PostgreSQL 集群共享的配置，所有实例（主库和从库）都会使用相同的参数值。
在 Pigsty 中，集群级参数通过 &lt;a href="https://pigsty.cc/docs/pgsql/admin/patroni"&gt;&lt;strong&gt;Patroni&lt;/strong&gt;&lt;/a&gt; 管理，存储在分布式配置存储（DCS，默认为 etcd）中。&lt;/p&gt;
&lt;p&gt;Pigsty 提供了四种预置的 &lt;a href="https://pigsty.cc/docs/pgsql/template"&gt;&lt;strong&gt;Patroni 参数优化模板&lt;/strong&gt;&lt;/a&gt;，针对不同的使用场景进行了优化，通过 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_conf"&gt;&lt;strong&gt;&lt;code&gt;pg_conf&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 参数指定：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;模板&lt;/th&gt;
 &lt;th&gt;适用场景&lt;/th&gt;
 &lt;th&gt;特点&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="https://pigsty.cc/docs/pgsql/template/oltp"&gt;&lt;strong&gt;&lt;code&gt;oltp.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;在线事务处理&lt;/td&gt;
 &lt;td&gt;低延迟、高并发，默认推荐&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="https://pigsty.cc/docs/pgsql/template/olap"&gt;&lt;strong&gt;&lt;code&gt;olap.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;在线分析处理&lt;/td&gt;
 &lt;td&gt;大查询、高吞吐，适合数仓&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="https://pigsty.cc/docs/pgsql/template/crit"&gt;&lt;strong&gt;&lt;code&gt;crit.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;核心金融业务&lt;/td&gt;
 &lt;td&gt;最大持久性，牺牲部分性能换取安全&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="https://pigsty.cc/docs/pgsql/template/tiny"&gt;&lt;strong&gt;&lt;code&gt;tiny.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;微型实例&lt;/td&gt;
 &lt;td&gt;资源受限环境，适合开发测试&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;调优模板文件位于 Pigsty 安装目录的 &lt;code&gt;roles/pgsql/templates/&lt;/code&gt; 目录下，包含了根据硬件规格自动计算的参数值。
这些模板会在集群初始化时渲染为 Patroni 配置文件 &lt;code&gt;/etc/patroni/patroni.yml&lt;/code&gt;。更多详情请参阅 &lt;a href="https://pigsty.cc/docs/pgsql/template"&gt;&lt;strong&gt;场景模板&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;</description></item><item><title>访问控制</title><link>https://pigsty.cc/docs/pgsql/config/acl/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/config/acl/</guid><description>&lt;blockquote&gt;
&lt;p&gt;访问控制由“角色体系 + 权限模板 + HBA”共同决定。本节聚焦于如何通过配置参数声明角色与对象权限。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty 预置了一套精简的 ACL 模型，全部通过以下参数描述：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg_default_roles&lt;/code&gt;：系统角色与系统用户。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_users&lt;/code&gt;：业务用户与角色。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_default_privileges&lt;/code&gt;：管理员/属主新建对象时的默认权限。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pg_revoke_public&lt;/code&gt;、&lt;code&gt;pg_default_schemas&lt;/code&gt;、&lt;code&gt;pg_default_extensions&lt;/code&gt;：控制 &lt;code&gt;template1&lt;/code&gt; 的默认行为。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;理解这些参数后，你就可以写出完全可复现的权限配置。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="默认角色体系pg_default_roles"&gt;默认角色体系（pg_default_roles）&lt;/h2&gt;
&lt;p&gt;默认包含 4 个业务角色 + 4 个系统用户：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;名称&lt;/th&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_readonly&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;所有业务共用，拥有 SELECT/USAGE&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_readwrite&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;继承只读角色，并拥有 INSERT/UPDATE/DELETE&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_admin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;继承 &lt;code&gt;pg_monitor&lt;/code&gt; + 读写角色，可建对象和触发器&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_offline&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;受限只读角色，仅允许访问离线实例&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;postgres&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;用户&lt;/td&gt;
 &lt;td&gt;系统超级用户，与 &lt;code&gt;pg_dbsu&lt;/code&gt; 同名&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;replicator&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;用户&lt;/td&gt;
 &lt;td&gt;用于流复制与备份，继承监控与只读权限&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbuser_dba&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;用户&lt;/td&gt;
 &lt;td&gt;主要管理员账号，同时同步到 pgbouncer&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbuser_monitor&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;用户&lt;/td&gt;
 &lt;td&gt;监控账号，具备 &lt;code&gt;pg_monitor&lt;/code&gt; 权限，默认记录慢 SQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这些定义位于 &lt;code&gt;pg_default_roles&lt;/code&gt;，理论上可以自定义，但若要替换名称，必须同步更新 HBA/ACL/脚本中的引用。&lt;/p&gt;
&lt;p&gt;示例：为离线任务额外加一个 &lt;code&gt;dbrole_etl&lt;/code&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_default_roles&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_etl, login: false, roles: [dbrole_offline], comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;etl read-only role&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_admin, login: false, roles&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#000"&gt;pg_monitor, dbrole_readwrite, dbrole_etl] }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;效果：所有继承 &lt;code&gt;dbrole_admin&lt;/code&gt; 的用户自动拥有 &lt;code&gt;dbrole_etl&lt;/code&gt; 权限，可访问 offline 实例并执行 ETL。&lt;/p&gt;</description></item></channel></rss>