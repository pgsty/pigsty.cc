<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>时间点恢复 on PIGSTY</title><link>https://pigsty.cc/docs/concept/pitr/</link><description>Recent content in 时间点恢复 on PIGSTY</description><generator>Hugo</generator><language>zh-CN</language><atom:link href="https://pigsty.cc/docs/concept/pitr/index.xml" rel="self" type="application/rss+xml"/><item><title>时间点恢复的工作原理</title><link>https://pigsty.cc/docs/concept/pitr/mechanism/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/mechanism/</guid><description>&lt;p&gt;时间点恢复（PITR）的核心原理是：&lt;strong&gt;基础备份 + WAL 归档 = 任意时间点恢复能力&lt;/strong&gt;。
在 Pigsty 中，这一能力由 &lt;strong&gt;pgBackRest&lt;/strong&gt; 实现，并通过 &lt;strong&gt;定时备份 + WAL 归档&lt;/strong&gt; 自动运行。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="三要素"&gt;三要素&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;要素&lt;/th&gt;
 &lt;th style="text-align: left"&gt;作用&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Pigsty 实现&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;基础备份&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;提供一致的物理快照，决定恢复起点&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg-backup&lt;/code&gt; + &lt;code&gt;pgbackrest&lt;/code&gt; + &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_crontab"&gt;&lt;code&gt;pg_crontab&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;WAL 归档&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;记录备份后的所有变更，决定恢复路径&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;archive_mode=on&lt;/code&gt; + &lt;code&gt;archive_command=pgbackrest ... archive-push&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;恢复目标&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;指定恢复停止位置&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_pitr&lt;/code&gt; 参数 / &lt;code&gt;pg-pitr&lt;/code&gt; 脚本 / &lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="基础备份"&gt;基础备份&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;基础备份&lt;/strong&gt;是数据库在某一时刻的物理快照，是 PITR 的恢复起点。Pigsty 通过 &lt;code&gt;pgBackRest&lt;/code&gt; 生成基础备份，并提供 &lt;code&gt;pg-backup&lt;/code&gt; 脚本封装常用操作。&lt;/p&gt;
&lt;h3 id="备份类型"&gt;备份类型&lt;/h3&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;类型&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;th style="text-align: left"&gt;恢复开销&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;全量备份&lt;/strong&gt;（Full）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;复制全部数据文件&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复最快，空间占用最大&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;差异备份&lt;/strong&gt;（Differential）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;相对最近一次全量备份的变化&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复需要全量 + 差异&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;增量备份&lt;/strong&gt;（Incremental）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;相对最近一次任意备份的变化&lt;/td&gt;
 &lt;td style="text-align: left"&gt;空间最省，恢复需要完整链路&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="pigsty-的默认行为"&gt;Pigsty 的默认行为&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg-backup&lt;/code&gt; &lt;strong&gt;默认执行增量备份&lt;/strong&gt;，若不存在全量备份会自动补一次全量。&lt;/li&gt;
&lt;li&gt;备份任务通过 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_crontab"&gt;&lt;code&gt;pg_crontab&lt;/code&gt;&lt;/a&gt; 配置，写入 &lt;code&gt;postgres&lt;/code&gt; 用户的 crontab。&lt;/li&gt;
&lt;li&gt;脚本会自动识别节点角色，&lt;strong&gt;只有主库实际执行&lt;/strong&gt;，从库会直接退出。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;备份频率越高，需要重放的 WAL 越少，恢复速度越快。
更多细节请参阅 &lt;a href="https://pigsty.cc/docs/pgsql/backup/mechanism/"&gt;&lt;strong&gt;备份机制&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="https://pigsty.cc/docs/pgsql/backup/policy/"&gt;&lt;strong&gt;备份策略&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;</description></item><item><title>时间点恢复的实现架构</title><link>https://pigsty.cc/docs/concept/pitr/arch/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/arch/</guid><description>&lt;p&gt;Pigsty 使用 &lt;a href="https://pgbackrest.org/"&gt;&lt;strong&gt;pgBackRest&lt;/strong&gt;&lt;/a&gt; 作为 PostgreSQL 备份与恢复引擎，提供开箱即用的时间点恢复（PITR）能力。&lt;/p&gt;
&lt;p&gt;本文从架构层面说明：&lt;strong&gt;备份由谁执行、数据流向哪里、仓库如何组织、故障切换后如何保持连续性&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;PITR 架构由三条主线构成：&lt;strong&gt;备份执行链路&lt;/strong&gt;、&lt;strong&gt;WAL 归档链路&lt;/strong&gt;、&lt;strong&gt;恢复执行链路&lt;/strong&gt;。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;链路&lt;/th&gt;
 &lt;th style="text-align: left"&gt;入口&lt;/th&gt;
 &lt;th style="text-align: left"&gt;引擎&lt;/th&gt;
 &lt;th style="text-align: left"&gt;终点&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;备份&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg-backup&lt;/code&gt; + &lt;code&gt;pg_crontab&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest backup&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份仓库 &lt;code&gt;backup/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;WAL 归档&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL &lt;code&gt;archive_command&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest archive-push&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份仓库 &lt;code&gt;archive/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_pitr&lt;/code&gt; / &lt;code&gt;pg-pitr&lt;/code&gt; / &lt;code&gt;pgsql-pitr.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;目标数据目录&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;更多执行细节见 &lt;a href="https://pigsty.cc/docs/pgsql/backup/mechanism/"&gt;&lt;strong&gt;备份机制&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="https://pigsty.cc/docs/pgsql/backup/restore/"&gt;&lt;strong&gt;恢复操作&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="组件与职责"&gt;组件与职责&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;角色&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据源&lt;/td&gt;
 &lt;td style="text-align: left"&gt;产生数据文件与 WAL 归档流&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pgBackRest&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份引擎&lt;/td&gt;
 &lt;td style="text-align: left"&gt;执行备份、接收/拉取 WAL、执行恢复&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pg-backup&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份入口&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pigsty 封装脚本，执行 &lt;code&gt;pgbackrest backup&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pg_pitr / pg-pitr&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复入口&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pigsty 封装参数/脚本，执行 &lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;备份仓库&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;存储后端&lt;/td&gt;
 &lt;td style="text-align: left"&gt;保存 &lt;code&gt;backup/&lt;/code&gt; 与 &lt;code&gt;archive/&lt;/code&gt;，支持 &lt;code&gt;local&lt;/code&gt; / &lt;code&gt;minio&lt;/code&gt; / &lt;code&gt;s3&lt;/code&gt; 等仓库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pgbackrest_exporter&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;监控输出&lt;/td&gt;
 &lt;td style="text-align: left"&gt;导出备份状态指标，默认监听 &lt;code&gt;9854&lt;/code&gt; 端口&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="数据流"&gt;数据流&lt;/h2&gt;
&lt;pre class="mermaid"&gt;flowchart TB
 subgraph cluster[&amp;#34;PostgreSQL 集群&amp;#34;]
 direction TB
 primary[&amp;#34;Primary&amp;lt;br/&amp;gt;PostgreSQL&amp;#34;]
 pb[&amp;#34;pgBackRest&amp;#34;]
 cron[&amp;#34;pg-backup / pg_crontab&amp;#34;]
 end
 repo[&amp;#34;备份仓库&amp;lt;br/&amp;gt;local / minio / s3&amp;#34;]
 restore[&amp;#34;恢复目标数据目录&amp;#34;]

 cron --&amp;gt; pb
 primary --&amp;gt;|base backup| pb
 primary --&amp;gt;|WAL archive| pb
 pb --&amp;gt;|backup/archive| repo
 repo --&amp;gt;|restore/archive-get| pb
 pb --&amp;gt;|restore| restore&lt;/pre&gt;
&lt;p&gt;要点：&lt;/p&gt;</description></item><item><title>时间点恢复的策略权衡</title><link>https://pigsty.cc/docs/concept/pitr/tradeoff/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/tradeoff/</guid><description>&lt;p&gt;设计 PITR 策略时，最核心的权衡来自三个维度：
&lt;strong&gt;备份仓库位置&lt;/strong&gt;、&lt;strong&gt;恢复窗口长度&lt;/strong&gt;、&lt;strong&gt;恢复速度与空间成本&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;本文帮助您在这些维度之间做出可操作的选择。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="本地-vs-远程"&gt;本地 vs 远程&lt;/h2&gt;
&lt;p&gt;备份仓库的位置是 PITR 策略设计的第一步。&lt;/p&gt;
&lt;h3 id="本地仓库"&gt;本地仓库&lt;/h3&gt;
&lt;p&gt;将备份存储在主库本地磁盘（&lt;code&gt;pgbackrest_method = local&lt;/code&gt;）：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;配置简单，开箱即用&lt;/li&gt;
&lt;li&gt;恢复速度快（本地 I/O）&lt;/li&gt;
&lt;li&gt;无外部依赖&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;劣势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无异地容灾能力，主机故障时备份可能一同丢失&lt;/li&gt;
&lt;li&gt;受限于本地磁盘容量&lt;/li&gt;
&lt;li&gt;备份与生产数据位于同一故障域&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="远程仓库"&gt;远程仓库&lt;/h3&gt;
&lt;p&gt;将备份存储到 MinIO / S3 等对象存储（&lt;code&gt;pgbackrest_method = minio|s3&lt;/code&gt;）：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;异地容灾，备份独立于数据库主机&lt;/li&gt;
&lt;li&gt;容量几乎无限，多集群可共享&lt;/li&gt;
&lt;li&gt;可配合加密、版本控制等安全策略&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;劣势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;恢复速度受网络带宽影响&lt;/li&gt;
&lt;li&gt;依赖对象存储的可用性&lt;/li&gt;
&lt;li&gt;部署与运维成本更高&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="如何选择"&gt;如何选择&lt;/h3&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;场景&lt;/th&gt;
 &lt;th style="text-align: left"&gt;推荐仓库&lt;/th&gt;
 &lt;th style="text-align: left"&gt;理由&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;开发测试&lt;/td&gt;
 &lt;td style="text-align: left"&gt;local&lt;/td&gt;
 &lt;td style="text-align: left"&gt;简单够用，容灾要求低&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;单机生产&lt;/td&gt;
 &lt;td style="text-align: left"&gt;minio / s3&lt;/td&gt;
 &lt;td style="text-align: left"&gt;主机故障仍可恢复&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;集群生产&lt;/td&gt;
 &lt;td style="text-align: left"&gt;local + minio&lt;/td&gt;
 &lt;td style="text-align: left"&gt;兼顾恢复速度与异地容灾&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;关键业务&lt;/td&gt;
 &lt;td style="text-align: left"&gt;多远程仓库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;多地容灾，最高保护&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;仓库配置细节请参阅 &lt;a href="https://pigsty.cc/docs/pgsql/backup/repository/"&gt;&lt;strong&gt;备份仓库&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="空间-vs-窗口"&gt;空间 vs 窗口&lt;/h2&gt;
&lt;p&gt;恢复窗口越长，所需存储空间越大。窗口长度由 &lt;strong&gt;备份保留策略 + WAL 归档保留&lt;/strong&gt; 决定。&lt;/p&gt;</description></item><item><title>时间点恢复的典型场景</title><link>https://pigsty.cc/docs/concept/pitr/scenarios/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/scenarios/</guid><description>&lt;p&gt;PITR 的价值不在于“回滚数据库”本身，而在于&lt;strong&gt;把不可逆的人为/软件错误变回可恢复的问题&lt;/strong&gt;。
它覆盖的场景从“误删一张表”到“整个机房不可用”，本质上解决的是&lt;strong&gt;逻辑错误与灾难恢复&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="整体认知overview"&gt;整体认知（Overview）&lt;/h2&gt;
&lt;p&gt;PITR 解决以下问题：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;场景类型&lt;/th&gt;
 &lt;th style="text-align: left"&gt;典型问题&lt;/th&gt;
 &lt;th style="text-align: left"&gt;推荐策略&lt;/th&gt;
 &lt;th style="text-align: left"&gt;恢复目标&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;误删/误更新数据（DML）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;DELETE/UPDATE&lt;/code&gt; 无条件执行，脚本误操作&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复优先&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;xid&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;误删表/库/Schema（DDL）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;DROP TABLE/DATABASE&lt;/code&gt;、错误迁移&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;name&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;批量错误/发布事故&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Bug 批量污染数据，修复脚本失败&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复 + 验证&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;xid&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;数据审计/问题复盘&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要查看历史状态，核对差异&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复（只读）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;lsn&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;机房级灾难/全量丢失&lt;/td&gt;
 &lt;td style="text-align: left"&gt;硬件故障、勒索、机房断电&lt;/td&gt;
 &lt;td style="text-align: left"&gt;原地恢复或重建集群&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;latest&lt;/code&gt; / &lt;code&gt;time&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="一个简单的判断原则"&gt;一个简单的判断原则&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;只要写入已经造成业务错误，就应该考虑 PITR&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;需要在线验证或只恢复部分数据 → 分支恢复&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;必须尽快恢复服务 → 原地恢复&lt;/strong&gt;（可接受停机）。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="mermaid"&gt;flowchart TD
 A[&amp;#34;发现问题&amp;#34;] --&amp;gt; B{&amp;#34;能否停机？&amp;#34;}
 B --&amp;gt;|能| C[&amp;#34;原地恢复&amp;lt;br/&amp;gt;最短恢复路径&amp;#34;]
 B --&amp;gt;|不能| D[&amp;#34;分支恢复&amp;lt;br/&amp;gt;先验证后切换&amp;#34;]
 C --&amp;gt; E[&amp;#34;恢复成功后重建备份&amp;#34;]
 D --&amp;gt; F[&amp;#34;验证/导出/切流量&amp;#34;]&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="场景详情"&gt;场景详情&lt;/h2&gt;
&lt;h3 id="误删误更新数据dml"&gt;误删/误更新数据（DML）&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;典型问题&lt;/strong&gt;：&lt;/p&gt;</description></item></channel></rss>