{{- /*
  AntV Infographic Shortcode for Hugo/Docsy

  Usage:
    {{< infographic >}}
    infographic list-row-simple-horizontal-arrow
    data
      items
        - label Step 1
          desc Start
        - label Step 2
          desc In Progress
    {{< /infographic >}}

    {{< infographic width="100%" height="600px" >}}
    infographic compare-vs-horizontal
    data
      title PostgreSQL vs MySQL
      items
        - label PostgreSQL
          desc 功能强大的开源数据库
        - label MySQL
          desc 流行的开源数据库
    theme
      colorPrimary #336791
    {{< /infographic >}}

  Parameters:
    width   - Container width (default: 100%)
    height  - Container height (default: auto)

  Notes:
    - Uses AntV Infographic DSL syntax (similar to Mermaid)
    - ~200 built-in templates available
    - Outputs high-quality SVG
    - See: https://infographic.antv.vision/
*/ -}}

{{- $width := .Get "width" | default "100%" -}}
{{- $height := .Get "height" | default "auto" -}}
{{- $id := printf "infographic-%s" (md5 .Inner) -}}

<div id="{{ $id }}" class="infographic-container" style="width: {{ $width }}; height: {{ $height }}; margin: 1em 0;"></div>

<script>
(function() {
  var containerId = '{{ $id }}';
  var syntax = {{ .Inner | strings.TrimSpace | safeJS | printf "`%s`" }};

  function renderInfographic() {
    var dom = document.getElementById(containerId);
    if (!dom) { console.error('Infographic: container not found:', containerId); return; }
    try {
      var ig = new AntVInfographic.Infographic({
        container: '#' + containerId,
        width: '{{ $width }}',
        height: '{{ $height }}',
      });
      ig.render(syntax);
    } catch (e) {
      console.error('Infographic render error:', e);
      dom.innerHTML = '<pre style="color: red;">Infographic Error: ' + e.message + '</pre>';
    }
  }

  // Load library dynamically if not already loaded
  if (typeof AntVInfographic !== 'undefined') {
    renderInfographic();
  } else if (!window._infographicLoading) {
    window._infographicLoading = true;
    window._infographicCallbacks = [renderInfographic];
    var script = document.createElement('script');
    script.src = '/js/infographic.min.js';
    script.onload = function() {
      window._infographicCallbacks.forEach(function(cb) { cb(); });
    };
    document.head.appendChild(script);
  } else {
    window._infographicCallbacks.push(renderInfographic);
  }
})();
</script>
