<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/about/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/about/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>关于 | PIGSTY</title><meta name=description content="了解 Pigsty 项目本身的方方面面：功能特性、历史发展，开源协议，隐私政策，社区活动与新闻。"><meta property="og:url" content="https://pigsty.cc/docs/about/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="关于"><meta property="og:description" content="了解 Pigsty 项目本身的方方面面：功能特性、历史发展，开源协议，隐私政策，社区活动与新闻。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="关于"><meta itemprop=description content="了解 Pigsty 项目本身的方方面面：功能特性、历史发展，开源协议，隐私政策，社区活动与新闻。"><meta itemprop=dateModified content="2026-01-08T18:37:06+08:00"><meta itemprop=keywords content="教程,PIGSTY"><meta name=twitter:card content="summary"><meta name=twitter:title content="关于"><meta name=twitter:description content="了解 Pigsty 项目本身的方方面面：功能特性、历史发展，开源协议，隐私政策，社区活动与新闻。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/about/>返回本页常规视图</a>.</p></div><h1 class=title>关于</h1><div class=lead>了解 Pigsty 项目本身的方方面面：功能特性、历史发展，开源协议，隐私政策，社区活动与新闻。</div><ul><li>1: <a href=#pg-0fab625b6c481f7134fc57b3be6d6b24>亮点特性</a></li><li>2: <a href=#pg-33977cd265556657652b6e1269439794>历史沿革</a></li><li>3: <a href=#pg-72c81b5256f5fa7bd33e7f85e8bfca0a>活动新闻</a></li><li>4: <a href=#pg-5b8cf903bf49e5cac8004f4b8b1742a7>发展规划</a></li><li>5: <a href=#pg-2e7ab4dcac19bf660ef9e7cad8ab7e91>加入社区</a></li><li>6: <a href=#pg-b655f0d84b0e39638f72e60cf6db032d>隐私政策</a></li><li>7: <a href=#pg-04cf6db19a8c2e839a6d1e4a81d4c6b7>开源协议</a></li><li>8: <a href=#pg-598ea3cad6e4433a090609fa3d8be7af>赞助我们</a></li><li>9: <a href=#pg-671c4a8168cec3cc6152729f65f5dd71>行业案例</a></li><li>10: <a href=#pg-6fd2303c95121a06e15583b834f3533b>订阅服务</a></li><li>11: <a href=#pg-fb47a447d16b1ba29ba890608c0f1308>常见问题</a></li><li>12: <a href=#pg-06ea9cd5145a15d31b177fb89b09c6aa>发布注记</a></li><li>13: <a href=#pg-2abe214ea9ba5412d760ce23167f55bf>同类对比</a></li><ul><li>13.1: <a href=#pg-672b46ece90a421823ac1d5ec895c9f1>成本对比</a></li></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-0fab625b6c481f7134fc57b3be6d6b24>1 - 亮点特性</h1><div class=lead>Pigsty 的价值主张与亮点功能特性。</div><blockquote><p>&ldquo;<strong>P</strong>ostgreSQL <strong>I</strong>n <strong>G</strong>reat <strong>STY</strong>le&rdquo;: <strong>P</strong>ostgres, <strong>I</strong>nfras, <strong>G</strong>raphics, <strong>S</strong>ervice, <strong>T</strong>oolbox, it&rsquo;s all <strong>Y</strong>ours.</p><p>—— <strong>开箱即用、本地优先的 PostgreSQL 发行版，开源 RDS 替代</strong></p></blockquote><hr><h2 id=价值主张>价值主张</h2><ul><li><a href=/img/pigsty/ecosystem.png><strong>可扩展性</strong></a>： 强力 <a href=/docs/ref/extension><strong>扩展</strong></a> 开箱即用：深度整合 <strong>PostGIS</strong>, <strong>TimescaleDB</strong>, <strong>Citus</strong>, <strong>PGVector</strong> 等 <a href=https://pgext.cloud/zh/list><strong>444</strong></a> 插件与 Oracle / SQL Server 的 <a href=/docs/pgsql/kernel><strong>兼容内核</strong></a>。</li><li><a href=/img/pigsty/arch.png><strong>可靠性</strong></a>：快速创建 <a href=/docs/concept/ha/><strong>高可用</strong></a>、故障自愈的 <a href=/docs/pgsql><strong>PostgreSQL</strong></a> 集群，自动预置的 <a href=/docs/concept/pitr/><strong>时间点恢复</strong></a>、<a href=/docs/concept/sec/ac/><strong>访问控制</strong></a>、自签名 <a href=/docs/concept/sec/ca><strong>CA</strong></a> 与 <a href=/docs/setup/security/><strong>SSL</strong></a>，确保数据坚如磐石。</li><li><a href=/img/pigsty/dashboard.jpg><strong>可观测性</strong></a>： 基于 <a href=/docs/infra#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6><strong>Prometheus</strong></a> & <a href=/docs/infra#grafana><strong>Grafana</strong></a> 现代可观测性技术栈，提供惊艳的监控最佳实践。模块化设计，可独立使用：<a href=https://github.com/pgsty/pigsty/wiki/Gallery><strong>画廊</strong></a> & <a href=https://demo.pigsty.cc><strong>Demo</strong></a>。</li><li><a href=/img/pigsty/ha.png><strong>可用性</strong></a>：交付稳定可靠，自动路由，事务池化、读写分离的高性能数据库 <a href=/docs/pgsql/service/#%E9%BB%98%E8%AE%A4%E6%9C%8D%E5%8A%A1><strong>服务</strong></a>，通过 HAProxy，Pgbouncer，VIP 提供灵活的 <a href=/docs/pgsql/service/#%E6%8E%A5%E5%85%A5%E6%9C%8D%E5%8A%A1><strong>接入</strong></a> 模式。</li><li><a href=/img/pigsty/iac.jpg><strong>可维护性</strong></a>：<a href=/docs/setup/install><strong>简单易用</strong></a>，<a href=/docs/pgsql/config><strong>基础设施即代码</strong></a>，<a href=/docs/pgsql/admin/><strong>管理SOP预案</strong></a>，自动调参，本地软件仓库，<a href=/docs/deploy/vagrant><strong>Vagrant</strong></a> <a href=/docs/deploy/sandbox><strong>沙箱</strong></a> 与 <a href=/docs/deploy/terraform><strong>Terraform</strong></a> 模板，不停机 <a href=/docs/pgsql/migration><strong>迁移</strong></a> 方案。</li><li><a href=/img/pigsty/sandbox.png><strong>可组合性</strong></a>：<a href=/docs/concept/arch#%E6%A8%A1%E5%9D%97><strong>模块化</strong></a> 架构设计，可复用的 <a href=/docs/infra><strong>Infra</strong></a>，多样的可选 <a href=/docs/ref/module/><strong>模块</strong></a>：<a href=/docs/redis><strong>Redis</strong></a>, <a href=/docs/minio><strong>MinIO</strong></a>, <a href=/docs/etcd><strong>ETCD</strong></a>, <a href=/docs/ferret><strong>FerretDB</strong></a>, <a href=https://github.com/pgsty/pigsty/tree/master/app/duckdb><strong>DuckDB</strong></a>, <a href=/docs/app/><strong>Docker</strong></a>, <a href=https://github.com/pgsty/pigsty/tree/master/app/supabase><strong>Supabase</strong></a>。</li></ul><p><img src=/img/pigsty/banner.png alt></p><hr><h2 id=总览>总览</h2><p>Pigsty 是一个更好的本地开源 RDS for PostgreSQL 替代：</p><ul><li><a href=#%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84rds>开箱即用的RDS</a>：从内核到RDS发行版，在 EL/Debian/Ubuntu 下提供 13-18 版本的生产级 PG 数据库服务。</li><li><a href=#%E4%B8%B0%E5%AF%8C%E7%9A%84%E6%89%A9%E5%B1%95%E6%8F%92%E4%BB%B6>丰富的扩展插件</a>：提供无可比拟的 444 扩展，提供开箱即用的分布式的时序地理空间图文向量多模态数据库能力。</li><li><a href=#%E7%81%B5%E6%B4%BB%E7%9A%84%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84>灵活的模块架构</a>：灵活组合，自由扩展：Redis/Etcd/MinIO/Mongo；可独立使用，监控现有RDS/主机/数据库。</li><li><a href=#%E6%83%8A%E8%89%B3%E7%9A%84%E8%A7%82%E6%B5%8B%E8%83%BD%E5%8A%9B>惊艳的观测能力</a>：基于现代可观测性技术栈 Prometheus/Grafana，提供令人惊艳，无可比拟的数据库观测能力。</li><li><a href=#%E4%B9%85%E7%BB%8F%E8%80%83%E9%AA%8C%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7>验证过的可靠性</a>：故障自愈的高可用架构：硬件故障自动切换，流量无缝衔接。并提供自动配置的 PITR 兜底删库！</li><li><a href=#%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8%E5%8F%AF%E7%BB%B4%E6%8A%A4>简单易用可维护</a>：声明式API，GitOps就位，傻瓜式操作，Database/Infra-as-Code 以及管理SOP封装管理复杂度！</li><li><a href=#%E6%89%8E%E5%AE%9E%E7%9A%84%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5>扎实的安全实践</a>：加密备份一应俱全，自带基础ACL最佳实践。只要硬件与密钥安全，您无需操心数据库的安全性！</li><li><a href=#%E5%B9%BF%E6%B3%9B%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF>广泛的应用场景</a>：低代码数据应用开发，或使用预置的 Docker Compose 模板，一键拉起使用PostgreSQL的海量软件！</li><li><a href=#%E5%BC%80%E6%BA%90%E7%9A%84%E8%87%AA%E7%94%B1%E8%BD%AF%E4%BB%B6>开源的自由软件</a>：以云数据库1/10不到的成本拥有与更好的数据库服务！帮您真正“拥有”自己的数据，实现自主可控！</li></ul><p>PostgreSQL 整合了生态中的工具与最佳实践：</p><ul><li>开箱即用的 <a href=https://www.postgresql.org/>PostgreSQL</a> 发行版，深度整合地理、时序、分布式、图、向量、搜索、AI等 444 余个 <a href=/docs/ref/extension>扩展插件</a>！</li><li>运行于裸操作系统之上，无需容器支持，支持主流操作系统： EL 8/9/10, Ubuntu 22.04/24.04 以及 Debian 12/13。</li><li>基于 <a href=https://patroni.readthedocs.io/en/latest/>patroni</a>, <a href=http://www.haproxy.org/>haproxy</a>, 与 <a href=https://etcd.io/>etcd</a>，打造故障自愈的高可用架构：硬件故障自动切换，流量无缝衔接。</li><li>基于 <a href=https://pgbackrest.org/>pgBackRest</a> 与可选的 <a href=https://min.io/>MinIO</a> 集群提供开箱即用的 PITR 时间点恢复，为软件缺陷与人为删库兜底。</li><li>基于 <a href=https://www.ansible.com/>Ansible</a> 提供声明式的 API 对复杂度进行抽象，以 <strong>Database-as-Code</strong> 的方式极大简化了日常运维管理操作。</li><li>Pigsty用途广泛，可用作完整应用运行时，开发演示数据/可视化应用，大量使用 PG 的软件可用 <a href=https://www.docker.com/>Docker</a> 模板一键拉起。</li><li>提供基于 <a href=https://www.vagrantup.com/>Vagrant</a> 的本地开发测试沙箱环境，与基于 <a href=https://www.terraform.io/>Terraform</a> 的云端自动部署方案，开发测试生产保持环境一致。</li><li>部署并监控专用的 <a href=https://redis.io/>Redis</a>（主从，哨兵，集群），MinIO，Etcd，Haproxy，MongoDB (<a href=https://www.ferretdb.io/>FerretDB</a>) 集群</li></ul><hr><h2 id=开箱即用的rds>开箱即用的RDS</h2><p><strong>让您立刻在本地拥有生产级的PostgreSQL数据库服务！</strong></p><p>PostgreSQL 是一个足够完美的数据库内核，但它需要更多工具与系统的配合才能成为一个足够好的数据库服务（RDS），Pigsty 帮助 PostgreSQL 完成这一步飞跃。
Pigsty 为您解决使用 PostgreSQL 中会遇到的各种难题：内核扩展安装，连接池，负载均衡，服务接入，高可用 / 自动故障切换，日志收集，指标监控，告警，备份恢复，PITR，访问控制，参数调优，安全加密，证书签发，NTP，DNS，参数调优，配置管理，CMDB，管理预案… 您无需再为这些细节烦心劳神！</p><p>Pigsty 支持 PostgreSQL 13 ～ 18 主干内核与其他兼容分支，可运行于 EL / Debian / Ubuntu 以及 <a href=/docs/ref/linux>兼容操作系统发行版</a> 上，在 x86_64 与 ARM64 芯片架构上可用，且无需容器支持。
除了数据库内核与大量开箱即用的扩展插件以外，Pigsty 还提供了数据库服务所需的完整基础设施与运行时，以及本地沙箱 / 生产环境 / 云 IaaS 自动部署方案。</p><p>Pigsty 可以一键从裸机开始拉起整套环境，触达软件交付的最后一公里。普通研发运维均可快速上手并兼职进行数据库管理，无需数据库专家即可自建企业级RDS服务！</p><p><a href=/docs/concept/arch#%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85><img src=/img/pigsty/arch.png alt=pigsty-arch></a></p><hr><h2 id=丰富的扩展插件>丰富的扩展插件</h2><p><strong>超融合多模态，一切皆用 PostgreSQL，一个PG替换所有数据库！</strong></p><p>PostgreSQL 的灵魂在于其丰富的 <a href=/blog/pg/pg-eat-db-world><strong>扩展生态</strong></a>，而 Pigsty 独一无二地深度整合了 PostgreSQL 生态中的 <a href=https://pgext.cloud/zh/list><strong>444 扩展</strong></a>，为您提供开箱即用的超融合多模态数据库！</p><p>插件间可以产生 <a href=https://pigsty.cc/zh/blog/pg/pg-eat-db-world#%E6%9E%81%E8%87%B4%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E7%9A%84%E9%AD%94%E6%B3%95><strong>协同效应</strong></a>，产生 1+1 远大于 2 的效果。
您可以使用 <a href=https://postgis.net/><strong>PostGIS</strong></a> 处理地理空间数据，使用 <a href=https://www.timescale.com/><strong>TimescaleDB</strong></a> 分析时序/事件流数据，并使用 <a href=https://www.citusdata.com/><strong>Citus</strong></a> 将其原地升级为分布式地理时空数据库；
您可以用 <a href=https://github.com/pgvector/pgvector><strong>PGVector</strong></a> 存储并搜索AI嵌入，用 <a href=https://www.paradedb.com/><strong>ParadeDB</strong></a> 实现 ES级全文检索，并同时使用精准的 SQL，全文检索，与模糊向量进行混合检索。
您还可以通过 <a href=https://github.com/duckdb/pg_duckdb><strong>pg_duckdb</strong></a>，<a href=https://github.com/duckdb/pg_mooncake><strong>pg_mooncake</strong></a> 等分析扩展，实现专用 OLAP 数据库/数据湖仓的分析表现。</p><p>使用 PostgreSQL 单一组件替代 MySQL，Kafka，ElasticSearch，MongoDB，以及大数据分析技术栈已经成为一种最佳实践 —— 单一数据库选型能够显著降低系统复杂度，极大提高研发效能与敏捷性，实现程度惊人的软硬件，研发/运维人力降本增效。</p><p><a href=/docs/ref/extension/><img src=/img/pigsty/ecosystem.jpg alt=pigsty-ecosystem.jpg></a></p><hr><h2 id=灵活的模块架构>灵活的模块架构</h2><p><strong>灵活组合，自由扩展，多数据库支持，监控现有RDS/主机/数据库</strong></p><p>Pigsty 中的组件被抽象可独立部署的 <a href=/docs/ref/module/><strong>模块</strong></a>，并可自由组合以应对多变的需求场景。<a href=/docs/infra><strong><code>INFRA</code></strong></a> 模块带有完整的现代监控技术栈，而 <a href=/docs/node><strong><code>NODE</code></strong></a> 模块则将节点调谐至指定状态并纳管。
在多个节点上安装 <a href=/docs/pgsql><strong><code>PGSQL</code></strong></a> 模块会自动组建出基于主从复制的高可用数据库集群，而同样的 <a href=/docs/etcd><strong><code>ETCD</code></strong></a> 模块则为数据库高可用提供共识与元数据存储。</p><p>除了上述四个 <a href=/docs/ref/module#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97>核心模块</a> 之外，Pigsty 还提供一系列选装功能模块：<a href=/docs/minio><strong><code>MINIO</code></strong></a> 模块可以提供本地对象存储能力，并作为集中式数据库备份仓库。
<a href=/docs/redis/><strong><code>REDIS</code></strong></a> 模块能以独立主从，哨兵，原生集群的方式为数据库提供辅助。<a href=/docs/docker><strong><code>DOCKER</code></strong></a> 模块可用于拉起无状态的应用软件。</p><p>此外，Pigsty 还提供 PG 兼容 / 衍生内核的支持，您可以使用 <a href=/docs/pgsql/kernel/babelfish><strong><code>Babelfish</code></strong></a> 提供 MS SQL Server 兼容性，使用 <a href=/docs/pgsql/kernel/ivorysql><strong><code>IvorySQL</code></strong></a> 提供 Oracle 兼容性，
使用 <a href=/docs/pgsql/kernel/openhalo><strong><code>OpenHaloDB</code></strong></a> 提供 MySQL 兼容性，使用 <a href=/docs/pgsql/kernel/orioledb><strong><code>OrioleDB</code></strong></a> 提供极致的 OLTP 性能。</p><p>不仅如此，你还可以使用 <a href=/docs/ferret/><strong><code>FerretDB</code></strong></a> 提供 MongoDB 兼容性，使用 <a href=/docs/pgsql/kernel/supabase><strong><code>Supabase</code></strong></a> 提供 Firebase 兼容，并使用 <a href=/docs/pgsql/kernel/polardb><strong><code>PolarDB</code></strong></a> 满足国产化合规要求。
更多专业版/试点模块将不断引入 Pigsty，如 <a href=/docs/pgsql/kernel/greenplum><strong><code>GPSQL</code></strong></a>，<a href=/docs/pilot/kafka/>KAFKA</a>，<a href=/docs/pilot/duckdb/>DUCKDB</a>，<a href=/blog/db/victoria-stack/>VICTORIA</a>，<a href=/docs/pilot/tigerbeetle/>TIGERBEETLE</a>，<a href=/docs/pilot/kube/>KUBERNETES</a>，<a href=/docs/pilot/consul/>CONSUL</a>，<a href=/docs/app/jupyter/>JUPYTER</a>，<a href=/docs/pgsql/kernel/greenplum/>GREENPLUM</a>，<a href=/docs/pgsql/kernel/cloudberry/>CLOUDBERRY</a>，<a href=/docs/pilot/mysql/>MYSQL</a>, …</p><p><a href=/docs/ref/module/><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></a></p><hr><h2 id=惊艳的观测能力>惊艳的观测能力</h2><p><strong>使用现代开源可观测性技术栈，提供无与伦比的监控最佳实践！</strong></p><p>Pigsty 提供了基于开源的 Grafana / Prometheus 现代可观测性技术栈做 <a href=/docs/pgsql/monitor><strong>监控</strong></a> 的最佳实践：，Grafana 负责可视化呈现，VictoriaMetrics 用于收集监控指标，VictoriaLogs 用于日志收集与查询，Alertmanager 用于告警通知。Blackbox Exporter 负责检查服务可用性。整套系统同样被设计为一键拉起，开箱即用的 INFRA 模块。</p><p>Pigsty 所管理的任何组件都会被自动纳入监控之中，包括主机节点，负载均衡 HAProxy，数据库 Postgres，连接池 Pgbouncer，元数据库 ETCD，KV缓存 Redis，对象存储 MinIO，……，以及整套监控基础设施本身。大量的 Grafana 监控面板与预置告警规则会让你的系统观测能力有质的提升，当然，这套系统也可以被复用于您的应用监控基础设施，或者监控已有的数据库实例或 RDS。</p><p>无论是故障分析还是慢查询优化、无论是水位评估还是资源规划，Pigsty 为您提供全面的数据支撑，真正做到数据驱动。在 Pigsty 中，超过三千类监控指标被用于描述整个系统的方方面面，并被进一步加工、聚合、处理、分析、提炼并以符合直觉的可视化模式呈现在您的面前。从全局大盘总览，到某个数据库实例中单个对象（表，索引，函数）的增删改查详情都能一览无余。您可以随意上卷下钻横向跳转，浏览系统现状与历史趋势，并预测未来的演变。</p><p><a href=https://github.com/Vonng/pigsty/wiki/Gallery><img src=/img/pigsty/dashboard.jpg alt=pigsty-dashboard.jpg></a></p><p>此外，Pigsty的监控系统模块部分还可以 <a href=/docs/pgsql/monitor/#%E7%9B%91%E6%8E%A7rds><strong>独立使用</strong></a> ——用它来监控现有的主机节点与数据库实例，或者是云上的 RDS 服务。只需要一个连接串一行命令，您就可以获得极致的 PostgreSQL 可观测性体验。</p><p>访问 <a href=https://github.com/Vonng/pigsty/wiki/Gallery><strong>截图画廊</strong></a> 与 <a href=https://demo.pigsty.cc><strong>在线演示</strong></a> 获取更多详情。</p><hr><h2 id=久经考验的可靠性>久经考验的可靠性</h2><p><strong>开箱即用的高可用与时间点恢复能力，确保你的数据库坚如磐石！</strong></p><p>对于软件缺陷或人为误操作造成的删表删库，Pigsty 提供了开箱即用的 <a href=/docs/concept/pitr>PITR</a> 时间点恢复能力，无需额外配置即默认启用。只要存储空间管够，基于 <code>pgBackRest</code> 的基础备份与 WAL 归档让您拥有快速回到过去任意时间点的能力。您可以使用本地目录/磁盘，亦或专用的 MinIO 集群或 S3 对象存储服务保留更长的回溯期限，丰俭由人。</p><p>更重要的是，Pigsty 让高可用与故障自愈成为 PostgreSQL 集群的标配，基于 <code>patroni</code>, <code>etcd</code>, 与 <code>haproxy</code> 打造的 <a href=/docs/concept/ha>高可用故障自愈架构</a>，让您在面对硬件故障时游刃有余：主库故障自动切换的 RTO &lt; 45s（可配置），一致性优先模式下确保数据零损失 RPO = 0。只要集群中有任意实例存活，集群就可以对外提供完整的服务，而客户端只要连接至集群中的任意节点，即可获得完整的服务。</p><p>Pigsty 内置了 HAProxy 负载均衡器用于自动流量切换，提供 DNS/VIP/LVS 等多种接入方式供客户端选用。故障切换与主动切换对业务侧除零星闪断外几乎无感知，应用不需要修改连接串重启。极小的维护窗口需求带来了极大的灵活便利：您完全可以在无需应用配合的情况下滚动维护升级整个集群。硬件故障可以等到第二天再抽空善后处置的特性，让研发，运维与 DBA 都能安心睡个好觉。
许多大型组织与核心机构已经在生产环境中长时间使用 Pigsty ，最大的部署有 25K CPU 核心与 200+ PostgreSQL 超大规格实例；在这一部署案例中，六七年内经历了数十次硬件故障与各类事故，DBA 换了几茬，但依然可以保持比 99.999% 更高的可用性战绩。</p><p><a href=/docs/concept/ha/><img src=/img/pigsty/ha.png alt=pigsty-ha.png></a></p><hr><h2 id=简单易用可维护>简单易用可维护</h2><p><strong>Infra as Code, 数据库即代码，声明式的API将数据库管理的复杂度来封装。</strong></p><p>Pigsty 使用声明式的接口对外提供服务，将系统的可控制性拔高到一个全新水平：用户通过配置清单告诉 Pigsty &ldquo;我想要什么样的数据库集群&rdquo;，而不用去操心到底需要怎样去做。从效果上讲，这类似于 K8S 中的 CRD 与 Operator，但 Pigsty 可用于任何节点上的数据库与基础设施：不论是容器，虚拟机，还是物理机。</p><p>无论是创建/销毁集群，添加/移除从库，还是新增数据库/用户/服务/扩展/黑白名单规则，您只需要修改配置清单并运行 Pigsty 提供的幂等剧本，而 Pigsty 负责将系统调整到您期望的状态。
用户无需操心配置的细节，Pigsty将自动根据机器的硬件配置进行调优，您只需要关心诸如集群叫什么名字，有几个实例放在哪几台机器上，使用什么配置模版：事务/分析/核心/微型，这些基础信息，研发也可以自助服务。但如果您愿意跳入兔子洞中，Pigsty 也提供了丰富且精细的控制参数，满足最龟毛 DBA 的苛刻定制需求。</p><p>除此之外，Pigsty 本身的安装部署也是一键傻瓜式的，所有依赖被预先打包，在安装时可以无需互联网访问。而安装所需的机器资源，也可以通过 Vagrant 或 Terraform 模板自动获取，让您在十几分钟内就可以从零在本地笔记本或云端虚拟机上拉起一套完整的 Pigsty 部署。本地沙箱环境可以跑在1核2G的微型虚拟机中，提供与生产环境完全一致的功能模拟，可以用于开发、测试、演示与学习。</p><p><a href=/docs/setup/config><img src=/img/pigsty/iac.jpg alt=pigsty-iac.jpg></a></p><hr><h2 id=扎实的安全实践>扎实的安全实践</h2><p><strong>加密备份一应俱全，只要硬件与密钥安全，您无需操心数据库的安全性。</strong></p><p><strong>Pigsty 针对高标准，严要求的企业级场景设计</strong>，采用业界领先的 <a href=/docs/setup/security>安全最佳实践</a> 保护您的数据安全（机密性/完整性/可用性），默认配置下的安全性便足以满足绝大多数场景下的合规要求。</p><p>Pigsty 会创建自签名的 CA （或使用您提供的 CA）签发证书，加密网络通信。需要保护的敏感管理页面与API端点都受到密码保护。
数据库备份使用 AES 算法加密，数据库密码使用 scram-sha-256 算法加密，并提供插件强制执行密码强度策略。
Pigsty 提供了一套开箱即用，简单易用，便于扩展的 <a href=/docs/concept/sec/ac/><strong>ACL</strong></a> 模型，提供读/写/管理/ETL 的权限区分，并带有遵循最小权限原则的 <a href=/docs/pgsql/config/hba><strong>HBA</strong></a> 规则集，通过多重防护确保系统机密性。</p><p>Pigsty 默认启用数据库校验和避免静默数据腐坏，通过从库副本提供坏块兜底。提供 CRIT 数据零丢失配置模板，使用 watchdog 确保为高可用 Fencing 兜底。
您可以通过 audit 插件审计数据库操作，系统与数据库日志全部收集备查，以满足合规要求。</p><p>Pigsty 正确配置 SELinux 与防火墙配置，并遵循最小权限原则设计操作系统用户组与文件权限，确保系统安全基线符合合规要求。
而且在 Etcd，MinIO 等附属可选组件上的安全上也毫不妥协，etcd 与 minio 均使用 RBAC 模型与 TLS 加密通信，确保系统整体安全性。</p><p>合理配置的系统通过等保三级/SOC2毫无问题，只要您遵循安全性最佳实践，内网部署并合理配置安全组与防火墙，数据库安全性将不再是您的痛点。</p><p><a href=/docs/setup/security><img src=/img/pigsty/acl.jpg alt=pigsty-acl.jpg></a></p><hr><h2 id=广泛的应用场景>广泛的应用场景</h2><p><strong>使用预置的Docker模板，一键拉起使用PostgreSQL的海量软件！</strong></p><p>在各类数据密集型应用中，数据库往往是最为棘手的部分。例如 Gitlab 企业版与社区版的核心区别就是底层 PostgreSQL 数据库的监控与高可用，如果您已经有了足够好的本地 PG RDS，完全可以拒绝为软件自带的土法手造数据库组件买单。</p><p>Pigsty 提供了 <a href=/docs/docker><strong>Docker 模块</strong></a> 与大量开箱即用的 <a href=/docs/app><strong>Compose 模板</strong></a>。您可以使用 Pigsty 管理的高可用 PostgreSQL （以及 Redis 与 MinIO ）作为后端存储，以无状态的模式一键拉起这些软件：
Gitlab、Gitea、Wiki.js、NocoDB、Odoo、Jira、Confluence、Habour、Mastodon、Discourse、KeyCloak、MatterMost 等等。
如果您的应用需要一个靠谱的 PostgreSQL 数据库， Pigsty 也许是最简单的获取方案。</p><p>Pigsty 也提供了与 PostgreSQL 紧密联系的应用开发工具集：PGAdmin4、PGWeb、ByteBase、PostgREST、Kong、以及 EdgeDB、FerretDB、<a href=/docs/app/supabase><strong>Supabase</strong></a> 这些使用 PostgreSQL 作为存储的"上层数据库"。
更奇妙的是，您完全可以基于 Pigsty 内置了的 Grafana 与 Postgres ，以低代码的方式快速搭建起一个交互式的数据应用来，甚至还可以使用 Pigsty 内置的 ECharts 面板创造更有表现力的交互可视化作品。</p><p>Pigsty 为您的 AI 应用提供了一个功能强大的运行时，您的 Agent 可以在这个环境中利用 PostgreSQL 与可观测性世界的强大能力，快速构建起一个数据驱动的智能体。</p><p><a href=/docs/app/><img src=/img/pigsty/app.jpg alt=pigsty-app.jpg></a></p><hr><h2 id=开源的自由软件>开源的自由软件</h2><p><strong>Pigsty是基于 Apache-2.0 开源的自由软件，由热爱 PostgreSQL 的社区成员用热情浇灌</strong></p><p>Pigsty 是完全 <a href=/docs/about/license/><strong>开源免费</strong></a> 的自由软件，它允许您在缺乏数据库专家的情况下，用几乎接近纯硬件的成本来运行企业级的 PostgreSQL 数据库服务。
作为对比，数据库厂商的“企业级数据库服务”与公有云厂商提供的 RDS 会收取底层硬件资源几倍到十几倍不等的 <a href=/docs/about/compare/cost/><strong>溢价</strong></a> 作为 &ldquo;服务费&rdquo;。</p><p>很多用户选择上云，正是因为自己搞不定数据库；很多用户使用 RDS，是因为别无他选。
我们将打破云厂商的垄断，为用户提供一个云中立的，<a href=/docs/about/compare/><strong>更好的</strong></a> RDS 开源替代：
Pigsty 紧跟 PostgreSQL 上游主干，不会有供应商锁定，不会有恼人的 &ldquo;授权费&rdquo;，不会有节点数量限制，不会收集您的任何数据。您的所有的核心资产 —— 数据，都能"自主可控"，掌握在自己手中。</p><p>Pigsty 本身旨在用数据库自动驾驶软件，替代大量无趣的人肉数据库运维工作，但再好的软件也没法解决所有的问题。
总会有一些的冷门低频疑难杂症需要专家介入处理。这也是为什么我们也提供专业的 <a href=/docs/about/service/><strong>订阅服务</strong></a>，来为有需要的企业级用户使用 PostgreSQL 提供兜底。
几万块的订阅咨询费不到顶尖 DBA 每年工资的几十分之一，让您彻底免除后顾之忧，把成本真正花在刀刃上。对于社区用户，我们亦 <a href=/docs/about/sponsor/><strong>用爱发电</strong></a>，提供免费的支持与日常答疑。</p><p><a href=/docs/about/compare/cost/><img src=/img/pigsty/price.jpg alt=pigsty-price.jpg></a></p><script src=/js/echarts.min.js></script><div id=echarts-dfa34818ac3edd409fae3f4d8cb72808 class="echarts-container td-max-width-on-larger-screens" style=height:560px></div><script>(function(){var e,t,o,i,a,r,c,l,n=document.getElementById("echarts-dfa34818ac3edd409fae3f4d8cb72808");if(!n)return;window._echartsFns=window._echartsFns||{},t=function(e){return Number(e||0).toLocaleString("zh-CN")},i=function(e){return t(e)},a=function(e){return!e||!e.length?"":["<b>CPU: "+e[0].axisValue+"</b>"].concat(e.map(function(e){return e.marker+" "+e.seriesName+": "+t(e.value)})).join("<br/>")},window._echartsFns.fmtn=t,window._echartsFns.yfmt=i,window._echartsFns.ttfmt=a,r=document.documentElement.getAttribute("data-bs-theme")==="dark"?"dark":null,e=echarts.init(n,r),c={grid:{bottom:70,left:96,right:36,top:50},legend:{data:["Oracle","开源PG","云数据库","Pigsty 云服务器","Pigsty 本地部署"],itemGap:16,top:4},series:[{data:[45e3,65e3,105e3,145e3,185e3,265e3,345e3,545e3,665e3,1065e3,1305e3,1985e3,2585e3,3865e3,5145e3],itemStyle:{color:"#d62728"},lineStyle:{width:3},name:"Oracle",symbolSize:7,type:"line"},{data:[800,1600,3200,4800,6400,9600,12800,20800,25600,41600,51200,78400,102400,153600,204800],itemStyle:{color:"#ff7f0e"},lineStyle:{width:2},name:"云数据库",symbolSize:6,type:"line"},{data:[360,720,1440,2160,2880,4320,5760,9360,11520,18720,23040,35280,46080,69120,92160],itemStyle:{color:"#2ca02c"},lineStyle:{width:2},name:"Pigsty 云服务器",symbolSize:6,type:"line"},{data:[38,76,152,228,304,456,608,988,1216,1976,2432,3724,4864,7296,9728],itemStyle:{color:"#9467bd"},lineStyle:{width:2},name:"Pigsty 本地部署",symbolSize:6,type:"line"}],tooltip:{formatter:"$fn:ttfmt",trigger:"axis"},xAxis:{boundaryGap:!1,data:[2,4,8,12,16,24,32,52,64,104,128,196,256,384,512],name:"CPU 核心数",nameGap:36,nameLocation:"middle",type:"category"},yAxis:{axisLabel:{formatter:"$fn:yfmt"},logBase:10,min:10,name:"月成本（元）",splitLine:{lineStyle:{opacity:.5,type:"dashed"},show:!0},type:"log"}};function s(e){if(typeof e=="string"&&e.startsWith("$fn:")){var t,n,o=e.substring(4);return window._echartsFns[o]}if(Array.isArray(e))return e.map(s);if(e&&typeof e=="object"){t={};for(n in e)t[n]=s(e[n]);return t}return e}o=s(c),e.setOption(o),window.addEventListener("resize",function(){e.resize()}),l=new MutationObserver(function(t){t.forEach(function(t){if(t.attributeName==="data-bs-theme"){var s=document.documentElement.getAttribute("data-bs-theme")==="dark"?"dark":null;e.dispose(),e=echarts.init(n,s),e.setOption(o)}})}),l.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]})})()</script></div><div class=td-content style=page-break-before:always><h1 id=pg-33977cd265556657652b6e1269439794>2 - 历史沿革</h1><div class=lead>Pigsty 项目的由来与动机，过去发展的历史，未来的目标与愿景。</div><hr><h2 id=历史起源>历史起源</h2><p>Pigsty 项目始于 2018 ～ 2019 年，起源于 <a href=https://tantanapp.com/en><strong>探探</strong></a>。
探探是一个互联网交友 App —— 中国的 Tinder，现已被陌陌收购。
探探这家公司是一个北欧风格的创业公司，有着一个瑞典工程师初创团队。</p><p>探探在技术上极有品味，使用 PostgreSQL 与 Go 作为核心技术栈。
探探整个系统架构参照 Instagram ，一切围绕 PostgreSQL 数据库设计。
直到几百万日活，几百万 TPS，几百 TB 数据的量级下，数据组件 <a href=/blog/pg/just-use-pg><strong>只用了 PostgreSQL</strong></a>。
几乎所有的业务逻辑都使用 PG 存储过程实现 —— 甚至包括 100ms 的推荐算法！称得上当时中国最复杂的 PostgreSQL 规模场景用例。</p><p>探探这种深度使用 PostgreSQL 特性的非典型研发模式，对工程师与DBA的水平提出了极高的要求。
而 Pigsty ，就是我们用这种真实世界的大规模，高标准数据库集群场景打磨出的开源项目 ——
沉淀着我们作为顶尖 PostgreSQL 专家的经验与最佳实践。</p><hr><h2 id=发展过程>发展过程</h2><p>在最开始，Pigsty 并没有现在这样的愿景、目标与版图。而是为了提供一个供我们自己使用的 PostgreSQL 监控系统。
我们调研了市面上所有的方案，开源的、商业的、云的，datadog, pgwatch，…… ，没有一个能满足我们对于可观测性的需求。
因此我决定自己动手，基于 Grafana 与 Prometheus 自己动手打造一个，这就是 Pigsty 的前身与雏形。
Pigsty 作为监控系统的效果相当惊艳，帮助我们解决了无数管理问题。</p><p>随后，研发人员希望在本地的开发机上也有这样的监控系统，于是我们使用 Ansible 编写了置备剧本，将这套系统从一次性建设任务转变为了可重复使用，可复制的软件。
新版本允许用户使用 Vagrant 和 Terraform，用 Infra as Code 的方式快速拉起本地 DevBox 开发机，或生产环境服务器，并自动完成 PostgreSQL 与监控系统的部署。</p><p>接下来，我们重新设计了生产环境的 PostgreSQL 架构，引入了 Patroni 与 pgBackRest 解决了数据库的 <a href=/docs/concept/ha><strong>高可用</strong></a> 与 <a href=/docs/concept/pitr><strong>时间点恢复</strong></a> 问题。
开发了基于逻辑复制的不停机 <a href=/docs/pgsql/migration><strong>迁移</strong></a> 方案，通过蓝绿部署将生产环境两百套数据库集群滚动升级至最新大版本。并将这些能力引入 Pigsty 中。</p><p>Pigsty 是我们做给自己使用的软件，“Eat dog food”最大的好处就是，我们自己既是开发者也更是用户 ——
我们自己作为甲方用户，非常了解自己需要什么，也不会在自己的需求上偷懒，更不用担心自己的工作全自动化后被开。</p><p>我们解决了一个又一个的问题，并将解决方案沉淀到 Pigsty 里。Pigsty 的定位，也从一个监控系统，逐渐发展成为一个开箱即用的 PostgreSQL 数据库发行版。
随即我们决定将 Pigsty 开源，并开始了一系列的技术分享与宣传，也开始有各行各业的外部用户使用起 Pigsty 并提出反馈意见。</p><hr><h2 id=全职创业>全职创业</h2><p>在 2022 年，Pigsty 项目获得了由陆奇博士发起的奇绩创坛的种子轮投资，我得以全职出来做这件事情。</p><p>作为一个开源项目，Pigsty 的发展相当不赖，在全职创业这几年里，Pigsty 在 Github 上的 Star 数从几百增长到了 4600+；上了 HN 头条推荐，增长开始滚起雪球。
2025 年 11 月，Pigsty 荣获 PostgreSQL 生态大会颁发的 <strong>Magneto Award</strong>。2026 年，Pigsty 子项目 PGEXT.CLOUD 投中 PGCon.Dev 2026 演讲。
Pigsty 成为第一个站上这个 PostgreSQL 核心生态大会舞台上的中国开源项目。</p><p>从前 Pigsty 只能跑在 CentOS 7 上，现今已经基本覆盖了所有主流 Linux 发行版 （EL, Debian, Ubuntu），支持 14 个操作系统平台。
支持的 PG 大版本覆盖 13 - 18，维护，收录整合了 PG 生态中的 444 扩展插件。
其中，我本人维护了这里超过一半（270+）的扩展插件，并提供开箱即用的 RPM/DEB 包。
算上 Pigsty 本身，&ldquo;基于开源，回馈开源&rdquo;，为 PG 生态做一些贡献。</p><p>Pigsty 的定位，也在不断发展的过程中，从一个 PostgreSQL 数据库发行版，进一步扩展到了 <strong>开源云数据库</strong>。它真正对标的是云厂商的整个云数据库品牌。</p><hr><h2 id=公有云的反叛者>公有云的反叛者</h2><p>AWS、Azure、GCP、Aliyun 等公有云厂商为初创企业提供了许多便利，但它们是闭源的，并迫使用户以高额费用租赁基础资源。</p><p>我们认为，优秀的数据库服务，应该和优秀的数据库内核一样，普及到每一个用户手中，而不是必须花费高昂的代价去向赛博领主租赁。</p><p>云计算的敏捷与弹性价值主张很好，但它应该是自由、开源、普惠、本地优先的 ——
我们认为云计算宇宙中需要一个代表开源价值观的解决方案，在不牺牲云带来好处的前提下，将基础设施的控制权交还给用户。</p><p>因此，我们也在引领着一场 <a href=/blog/cloud/exit><strong>下云的运动与战役</strong></a>，作为公有云的反叛者，来重塑这个行业的价值观。</p><hr><h2 id=我们的愿景>我们的愿景</h2><p>我希望，未来的世界人人都有自由使用优秀服务的事实权利，而不是只能被圈养在几个赛博领主公有云巨头厂商的地盘上当赛博佃户甚至赛博农奴。</p><p>这正是 Pigsty要做的事 —— <strong>一个更好的，开源免费的RDS替代</strong>。让用户能够在任何地方（包括云服务器）上，一键拉起比云RDS更好的数据库服务。</p><p>Pigsty 是对 PostgreSQL 的彻底补完，<strong>更是对云数据库的辛辣嘲讽</strong>。
它本意是“猪圈”，但也是 <strong>P</strong>ostgres <strong>I</strong>n <strong>G</strong>reat <strong>STY</strong>le 的缩写，即“<strong>全盛状态下的 PostgreSQL</strong>”。</p><p>Pigsty 本身是一款完全开源免费的软件，能够让您在没有数据库专家的情况下，自建水平达到 90 分的 PostgreSQL 数据库服务。
我们靠提供 <a href=/price><strong>精品咨询服务</strong></a> 来维持运营，为您搭建从 90 分到 100 分的体系，并提供质保、答疑、与兜底。</p><p>建设良好的系统也许跑个几年都不会遇到需要 “兜底” 的问题，但数据库的问题一但出现就不是小问题。
很多时候，专家的经验更是能够一言化腐朽为神奇，而我们为有需求的客户提供这样的精品咨询
—— 我们认为这是一种更加公正、合理、可持续的模式。</p><hr><h2 id=关于团队>关于团队</h2><p>我是冯若航，Pigsty 的作者，Pigsty 的所有代码几乎都由我 <a href=https://github.com/pgsty/pigsty/pulse><strong>一人开发</strong></a>。</p><p>软件领域依然存在个人英雄主义，独一无二的个体才能够创造出独一无二的作品 —— 我希望 Pigsty 成为这样的作品。</p><p>如果您对我感兴趣，这里是我的个人主页：<a href=https://vonng.com/>https://vonng.com/</a></p><p>《<a href=https://vonng.com/cn/blog/life/modb-interview-vonng/>墨天轮风云人物访谈录 —— 冯若航</a>》</p><p>《<a href=https://vonng.com/cn/blog/life/entrepreneur-vs-rds/>90后，辞职创业，说要卷死云数据库</a>》</p></div><div class=td-content style=page-break-before:always><h1 id=pg-72c81b5256f5fa7bd33e7f85e8bfca0a>3 - 活动新闻</h1><div class=lead>与 Pigsty 和 PostgreSQL 相关的活动事件与新闻，以及最新活动预告！</div><hr><h2 id=最近新闻>最近新闻</h2><ul><li><p><strong>2026-02-12</strong>: <strong>Pigsty v4.1 正式发布！第一批支持 PostgreSQL 18.2 的发行版</strong></p><ul><li>发布博客：<a href=/blog/pigsty/v4.1>Pigsty v4.1 发布文章</a></li><li>发布说明：<a href=/docs/about/release#v410>v4.1.0</a></li><li>Pigsty 已支持 PostgreSQL 小版本发布：18.2&mldr;</li></ul></li><li><p><strong>2026-02-04</strong>: Extension for Everyone 主题入选 PGCon.Dev 2026 演讲！</p><ul><li><a href=https://mp.weixin.qq.com/s/rThnqXp2JXVV9UQncNV3kg><strong>中国厂商首次站上 PGConf.dev 主题演讲台</strong></a></li></ul></li><li><p><strong>2026-02-03</strong>: <strong>Pigsty v4.0 正式发布！</strong> 迈入 Agent 时代！</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v40-released-ready-for-the-agent-era-3228/>Pigsty v4.0 Released: Ready for the Agent Era</a>》</li><li>Victoria 可观测性革命，安全加固，JUICE/VIBE 新模块，容器支持，许可证变更为 Apache-2.0</li><li>发布说明：<a href=/docs/about/release#v400>v4.0.0</a></li><li>发布博客：<a href=https://vonng.com/pigsty/v4.0>Pigsty v4.0：进入 AI 时代</a></li></ul></li><li><p><strong>2026-01-30</strong>: <strong>PIG v1.0 正式发布！</strong> 与 PGEXT.CLOUD 扩展目录同步上线</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pig-v10-released-with-pgextcloud-444-pg-extensions-on-14-linux-3214/>PIG v1.0 Released with PGEXT.CLOUD: 444 PG extensions on 14 Linux</a>》</li><li>PostgreSQL 扩展包管理器 pig v1.0 正式 GA，配合 PGEXT.CLOUD 开放扩展基础设施，提供 444 个扩展</li></ul></li><li><p><strong>2025-12-02</strong>: <strong>Pigsty v3.7.0 发布！</strong> PG18 成为默认版本，437 扩展，EL10/Debian13 支持</p><ul><li>发布说明：<a href=/docs/about/release#v370>v3.7.0</a></li></ul></li><li><p><strong>2025-11-29</strong>: Pigsty 荣获 <strong>PostgreSQL Magneto Award</strong>！</p><ul><li>第八届 PostgreSQL 生态大会（杭州）</li><li>演讲主题：&ldquo;A World-Grade Postgres Meta Distribution&rdquo;、AI 数据库考量、PostgreSQL 交付最佳实践</li></ul></li><li><p><strong>2025-08-15</strong>: <strong>Pigsty v3.6.1 发布！</strong> 例行 PG 小版本更新，PGDG 中国区域镜像</p><ul><li>发布说明：<a href=/docs/about/release#v361>v3.6.1</a></li></ul></li><li><p><strong>2025-08-04</strong>: <strong>Pigsty v3.6.0 发布！</strong> PostgreSQL 元发行版</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-36-the-meta-distribution-for-postgresql-3111/>Pigsty 3.6, the meta-distribution for PostgreSQL</a>》</li><li>pgactive 多主复制，MinIO/ETCD 改进，安装简化，配置梳理</li><li>发布说明：<a href=/docs/about/release#v360>v3.6.0</a></li></ul></li><li><p><strong>2025-06-16</strong>: <strong>Pigsty v3.5.0 发布！</strong> PG18 Beta 支持，421 扩展，监控升级，代码重构</p><ul><li>发布说明：<a href=/docs/about/release#v350>v3.5.0</a></li></ul></li><li><p><strong>2025-04-21</strong>: <strong>Pigsty v3.4 发布！</strong> MySQL 兼容性</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v34-released-pg-rds-with-mysql-compatibility-3052/>Pigsty v3.4 Released, PG RDS with MySQL Compatibility</a>》</li><li>OpenHalo/OrioleDB 支持，备份增强，自动 Certbot 证书，AGE 扩展</li><li>发布说明：<a href=/docs/about/release#v341>v3.4.1</a> / <a href=/docs/about/release#v340>v3.4.0</a></li></ul></li><li><p><strong>2025-03-07</strong>: <strong>Pigsty v3.3.0 发布！</strong> 404 扩展</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v33-release-with-404-postgresql-extensions-3023/>Pigsty v3.3 Release: with 404 PostgreSQL Extensions</a>》</li><li>Odoo/Dify/Supabase 应用模板，DocumentDB 支持</li><li>发布说明：<a href=/docs/about/release#v330>v3.3.0</a></li></ul></li><li><p><strong>2025-01</strong>: Pigsty v3.2.x 发布系列（v3.2.0 ~ v3.2.2）</p><ul><li>390 扩展，Omnigres，Mooncake，Citus13/PG17，扩展管理 CLI，Grafana 强化，ARM64 扩展补完</li><li>发布说明：<a href=/docs/about/release#v322>v3.2.2</a> / <a href=/docs/about/release#v321>v3.2.1</a> / <a href=/docs/about/release#v320>v3.2.0</a></li></ul></li><li><p>PostgreSQL 包管理器 pig 发布！</p><ul><li><a href=https://www.postgresql.org/about/news/announce-pig-the-postgres-extension-wizard-2988/>ANNOUNCE pig: The Postgres Extension Wizard</a></li><li><a href=https://postgresweekly.com/issues/583>PIG: A New Package Manager for PostgreSQL Extensions</a></li></ul></li><li><p><strong>2024-11</strong>: <strong>Pigsty v3.1.0 发布！</strong> PG 17 上位，Supabase 自建，ARM/Ubuntu24 支持</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v31-release-pg17-duck-extensions-self-hosting-supabase-arm-ubuntu24-2967/>Pigsty v3.1 Release: PG17, Duck Extensions, Self-hosting Supabase, ARM & Ubuntu24</a>》</li><li>介绍文章：《<a href=/blog/pigsty/v3.1>Pigsty v3.1：Supabase自建，PG17上位，MinIO改进，ARM/Ubuntu24支持</a>》</li><li>发布说明：<a href=/docs/about/release#v310>v3.1.0</a></li></ul></li><li><p><strong>2024-08 ~ 2024-10</strong>: Pigsty v3.0.x 发布系列（v3.0.0 ~ v3.0.4）</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v3-336-extensions-and-mssqloracle-flavor-pg-kernels-2921/>Pigsty v3: 336 extensions and MSSQL/Oracle flavor PG kernels!</a>》</li><li>333 个扩展，可替换内核，MSSQL/Oracle/PolarDB 兼容性，PG17 扩展</li><li>发布说明：<a href=/docs/about/release#v300>v3.0.0</a> ~ <a href=/docs/about/release#v304>v3.0.4</a></li><li>特性介绍：<a href=/blog/pigsty/v3.0>Pigsty v3.0.0</a></li></ul></li><li><p><strong>2024-08</strong>: Pigsty 补充软件仓库，提供 254 个额外的开箱即用的二进制 RPM/DEB 扩展！</p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-supplementary-aptyum-repository-with-254-additional-postgresql-extensions-2913/>Pigsty Supplementary APT/YUM Repository with 254 additional PostgreSQL Extensions!</a>》</li></ul></li><li><p><a href=/blog/pg/pgcondev-2024>PGCon.Dev 2024 参会记！</a></p></li><li><p><strong>2024-05</strong>: <strong>Pigsty v2.7 发布！</strong></p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-v27-released-free-rds-pg-with-255-extensions-available-2863/>Pigsty v2.7 Released, free RDS PG with 255 extensions available</a>》</li><li>Pigsty 博客：<a href=/blog/pigsty/v2.7>Pigsty v2.7：集异璧之大成</a></li></ul></li><li><p><strong>2024-02</strong>: <strong>Pigsty v2.6 发布！</strong></p><ul><li>PostgreSQL 官方网站新闻：《<a href=https://www.postgresql.org/about/news/pigsty-battery-included-postgresql-distro-free-rds-alternative-v26-released-2816/>Pigsty, Battery-included PostgreSQL Distro & Free RDS Alternative, v2.6 released!</a>》</li><li>Pigsty 博客：<a href=/blog/pigsty/v2.6>Pigsty v2.6：PG 踢馆 OLAP</a></li></ul></li></ul><hr><h2 id=版本发布>版本发布</h2><p><a href=/docs/about/release>Pigsty 发布注记</a></p><table class=full-width><thead><tr><th style=text-align:left>版本</th><th style=text-align:center>发布时间</th><th>摘要</th><th>地址</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/about/release#v410>v4.1.0</a></td><td style=text-align:center>2026-02-12</td><td>操作系统与数据库小版本更新，Agent Native CLI，批量 Bug 修复</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v4.1.0>v4.1.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v400>v4.0.0</a></td><td style=text-align:center>2026-01-28</td><td>Victoria 可观测性，安全加固，JUICE/VIBE 模块，Apache-2.0</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v4.0.0>v4.0.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v370>v3.7.0</a></td><td style=text-align:center>2025-12-02</td><td>PG18 成为默认，437 扩展，EL10/Debian13，PGEXT.CLOUD</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.7.0>v3.7.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v361>v3.6.1</a></td><td style=text-align:center>2025-08-15</td><td>例行 PG 小版本更新，PGDG 中国区域镜像</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.6.1>v3.6.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v360>v3.6.0</a></td><td style=text-align:center>2025-07-30</td><td>pgactive，MinIO/ETCD 改进，安装简化，配置梳理</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.6.0>v3.6.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v350>v3.5.0</a></td><td style=text-align:center>2025-06-16</td><td>PG18 Beta，421 扩展，监控升级，代码重构</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.5.0>v3.5.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v341>v3.4.1</a></td><td style=text-align:center>2025-04-05</td><td>OpenHalo，OrioleDB，MySQL兼容性，pgAdmin改进</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.1>v3.4.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v340>v3.4.0</a></td><td style=text-align:center>2025-03-30</td><td>备份增强，自动Certbot证书，Ivory跨平台，AGE扩展</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.0>v3.4.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v330>v3.3.0</a></td><td style=text-align:center>2025-02-24</td><td>404扩展，Odoo/Dify/Supabase应用模板，DocumentDB支持</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.3.0>v3.3.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v322>v3.2.2</a></td><td style=text-align:center>2025-01-23</td><td>390扩展，Omnigres支持，Mooncake，Citus13与PG17支持</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.2>v3.2.2</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v321>v3.2.1</a></td><td style=text-align:center>2025-01-12</td><td>350扩展，Ivory4，Citus强化，Odoo模板</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.1>v3.2.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v320>v3.2.0</a></td><td style=text-align:center>2024-12-24</td><td>扩展管理 CLI ，Grafana 强化，ARM64 扩展补完</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.0>v3.2.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v310>v3.1.0</a></td><td style=text-align:center>2024-11-22</td><td>PG 17 作为默认大版本，配置简化，Ubuntu 24 与 ARM 支持，MinIO 改进</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.1.0>v3.1.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v304>v3.0.4</a></td><td style=text-align:center>2024-10-30</td><td>PG 17 扩展，OLAP 全家桶，pg_duckdb</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.4>v3.0.4</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v303>v3.0.3</a></td><td style=text-align:center>2024-09-27</td><td>PostgreSQL 17，Etcd 运维优化，IvorySQL 3.4，PostGIS 3.5</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.3>v3.0.3</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v302>v3.0.2</a></td><td style=text-align:center>2024-09-07</td><td>精简安装模式，PolarDB 15支持，监控视图更新</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.2>v3.0.2</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v301>v3.0.1</a></td><td style=text-align:center>2024-08-31</td><td>例行问题修复，Patroni 4支持，Oracle兼容性改进</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.1>v3.0.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v300>v3.0.0</a></td><td style=text-align:center>2024-08-25</td><td>333个扩展插件，可插拔内核，MSSQL，Oracle，PolarDB 兼容性</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.0>v3.0.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v270>v2.7.0</a></td><td style=text-align:center>2024-05-20</td><td>扩展大爆炸，新增20+强力扩展插件，与多款Docker应用</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.7.0>v2.7.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v260>v2.6.0</a></td><td style=text-align:center>2024-02-28</td><td>PG 16 作为默认大版本，引入 ParadeDB 与 DuckDB 等扩展</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.6.0>v2.6.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v251>v2.5.1</a></td><td style=text-align:center>2023-12-01</td><td>例行小版本更新，PG16重要扩展支持</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.5.1>v2.5.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v250>v2.5.0</a></td><td style=text-align:center>2023-09-24</td><td>Ubuntu/Debian支持：bullseye, bookworm, jammy, focal</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.5.0>v2.5.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v241>v2.4.1</a></td><td style=text-align:center>2023-09-24</td><td>Supabase/PostgresML支持与各种新扩展：graphql, jwt, pg_net, vault</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.4.1>v2.4.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v240>v2.4.0</a></td><td style=text-align:center>2023-09-14</td><td>PG16，监控RDS，服务咨询支持，新扩展：中文分词全文检索/图/HTTP/嵌入等</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.4.0>v2.4.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v231>v2.3.1</a></td><td style=text-align:center>2023-09-01</td><td>带HNSW的PGVector，PG 16 RC1, 文档翻新，中文文档，例行问题修复</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.3.1>v2.3.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v230>v2.3.0</a></td><td style=text-align:center>2023-08-20</td><td>主机VIP, ferretdb, nocodb, MySQL存根, CVE修复</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.3.0>v2.3.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v220>v2.2.0</a></td><td style=text-align:center>2023-08-04</td><td>仪表盘 & 置备重做，UOS 兼容性</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.2.0>v2.2.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v210>v2.1.0</a></td><td style=text-align:center>2023-06-10</td><td>支持 PostgreSQL 12 ~ 16beta</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.1.0>v2.1.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v202>v2.0.2</a></td><td style=text-align:center>2023-03-31</td><td>新增 pgvector 支持，修复 MinIO CVE</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.2>v2.0.2</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v201>v2.0.1</a></td><td style=text-align:center>2023-03-21</td><td>v2 错误修复，安全增强，升级 Grafana 版本</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.1>v2.0.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v200>v2.0.0</a></td><td style=text-align:center>2023-02-28</td><td>架构大升级，兼容性、安全性、可维护性显著增强</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.0>v2.0.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v151>v1.5.1</a></td><td style=text-align:center>2022-06-18</td><td>Grafana 安全性修复</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.5.1>v1.5.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v150>v1.5.0</a></td><td style=text-align:center>2022-05-31</td><td>Docker 应用程序支持</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.5.0>v1.5.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v141>v1.4.1</a></td><td style=text-align:center>2022-04-20</td><td>错误修复 & 英文文档完整翻译</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.4.1>v1.4.1</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v140>v1.4.0</a></td><td style=text-align:center>2022-03-31</td><td>MatrixDB 支持，分离 INFRA/NODES/PGSQL/REDIS模块</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.4.0>v1.4.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v130>v1.3.0</a></td><td style=text-align:center>2021-11-30</td><td>PGCAT 重整 & PGSQL 增强 & Redis Beta支持</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.3.0>v1.3.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v120>v1.2.0</a></td><td style=text-align:center>2021-11-03</td><td>默认 PGSQL 版本升级至 14</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.2.0>v1.2.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v110>v1.1.0</a></td><td style=text-align:center>2021-10-12</td><td>主页, JupyterLab, PGWEB, Pev2 & pgbadger</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.1.0>v1.1.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v100>v1.0.0</a></td><td style=text-align:center>2021-07-26</td><td>v1 正式版, 监控系统重整</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v1.0.0>v1.0.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v090>v0.9.0</a></td><td style=text-align:center>2021-04-04</td><td>Pigsty 图形界面, 命令行界面, 日志集成</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.9.0>v0.9.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v080>v0.8.0</a></td><td style=text-align:center>2021-03-28</td><td>服务置备，定制对外暴露的数据库服务</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.8.0>v0.8.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v070>v0.7.0</a></td><td style=text-align:center>2021-03-01</td><td>仅监控部署，监控现有 PostgreSQL 实例</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.7.0>v0.7.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v060>v0.6.0</a></td><td style=text-align:center>2021-02-19</td><td>架构增强，将PG与Consul解耦</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.6.0>v0.6.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v050>v0.5.0</a></td><td style=text-align:center>2021-01-07</td><td>支持在配置中定义业务数据库/用户</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.5.0>v0.5.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v040>v0.4.0</a></td><td style=text-align:center>2020-12-14</td><td>支持 PostgreSQL 13，添加官方文档</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.4.0>v0.4.0</a></td></tr><tr><td style=text-align:left><a href=/docs/about/release#v030>v0.3.0</a></td><td style=text-align:center>2020-10-22</td><td>虚拟机置备方案正式定稿</td><td><a href=https://github.com/pgsty/pigsty/releases/tag/v0.3.0>v0.3.0</a></td></tr><tr><td style=text-align:left>v0.2.0</td><td style=text-align:center>2020-07-10</td><td>PG监控系统第六版正式发布</td><td><a href=https://github.com/pgsty/pigsty/commit/385e33a62a19817e8ba19997260e6b77d99fe2ba>v0.2.0</a></td></tr><tr><td style=text-align:left>v0.1.0</td><td style=text-align:center>2020-06-20</td><td>在生产仿真测试环境中验证通过</td><td><a href=https://github.com/Vonng/pigsty/commit/1cf2ea5ee91db071de00ec805032928ff582453b>v0.1.0</a></td></tr><tr><td style=text-align:left>v0.0.5</td><td style=text-align:center>2020-08-19</td><td>离线安装模式：无需互联网访问即可交付</td><td><a href=https://github.com/Vonng/pigsty/commit/0fe9e829b298fe5e56307de3f78c95071de28245>v0.0.5</a></td></tr><tr><td style=text-align:left>v0.0.4</td><td style=text-align:center>2020-07-27</td><td>将 Ansible 剧本重构为 Role Refactor playbooks into ansible roles</td><td><a href=https://github.com/Vonng/pigsty/commit/90b44259818d2c71e37df5250fe8ed1078a883d0>v0.0.4</a></td></tr><tr><td style=text-align:left>v0.0.3</td><td style=text-align:center>2020-06-22</td><td>接口设计改进</td><td><a href=https://github.com/Vonng/pigsty/commit/4c5c68ccd57bc32a9e9c98aa3f264aa19f45c7ee>v0.0.3</a></td></tr><tr><td style=text-align:left>v0.0.2</td><td style=text-align:center>2020-04-30</td><td>首次提交</td><td><a href=https://github.com/Vonng/pigsty/commit/dd646775624ddb33aef7884f4f030682bdc371f8>v0.0.2</a></td></tr><tr><td style=text-align:left>v0.0.1</td><td style=text-align:center>2019-05-15</td><td>概念原型</td><td><a href=https://github.com/Vonng/pg/commit/fa2ade31f8e81093eeba9d966c20120054f0646b>v0.0.1</a></td></tr></tbody></table><hr><h2 id=会议与演讲>会议与演讲</h2><table class=full-width><thead><tr><th>日期</th><th>类型</th><th>活动</th><th>主题</th></tr></thead><tbody><tr><td>2025-11-29</td><td>获奖&演讲</td><td>第八届 PostgreSQL 生态大会（杭州）</td><td>PostgreSQL Magneto Award，世界级 Postgres 元发行版</td></tr><tr><td>2025-05-16</td><td>闪电演讲</td><td>PGConf.Dev 2025（蒙特利尔）</td><td>Extension Delivery: 让您的 PGEXT 触达用户</td></tr><tr><td>2025-05-12</td><td>主题演讲</td><td>PGEXT.DAY, PGCon.Dev 2025</td><td>PostgreSQL 生态中缺失的包管理器与扩展仓库</td></tr><tr><td>2025-04-19</td><td>实战工坊</td><td>PostgreSQL 数据库技术峰会</td><td>使用 Pigsty 部署 PG 生态伙伴：Dify, Odoo, Supabase</td></tr><tr><td>2025-04-11</td><td>直播主持</td><td>OSCHINA 数智Talk</td><td>刷屏的 MCP 是炒作还是革命？</td></tr><tr><td>2025-01-15</td><td>直播分享</td><td>开源老将与新秀第四期</td><td>PostgreSQL 扩展吞噬数据库世界？PG包管理器 pig 与自建 RDS Pigsty</td></tr><tr><td>2025-01-09</td><td>颁奖典礼</td><td>OSCHINA 2024 年度杰出贡献专家</td><td>年度杰出贡献专家</td></tr><tr><td>2025-01-06</td><td>圆桌论坛</td><td>中国 PostgreSQL 数据库生态大会</td><td>PostgreSQL 扩展正在吞噬数据库世界</td></tr><tr><td>2024-11-23</td><td>播客</td><td>技术乱炖 Podcast</td><td>来自 Linux 基金会：为什么最近都在关注"卡脖子"？</td></tr><tr><td>2024-08-21</td><td>媒体专访</td><td>蓝色科技浪潮</td><td>Pigsty 作者冯若航专访：简化PG管理，推动中国开源社区</td></tr><tr><td>2024-08-15</td><td>技术大会</td><td>GOTC 全球开源技术峰会</td><td>PostgreSQL AI/ML/RAG 扩展生态与最佳实践</td></tr><tr><td>2024-07-12</td><td>主题演讲</td><td>第十三届 PG 中国技术大会</td><td>数据库世界的未来：扩展，服务，与 Postgres</td></tr><tr><td>2024-05-31</td><td>非正式会议</td><td>PGCon.Dev 2024 全球 PG 开发者大会 Unconference</td><td>内置 Prometheus 指标导出器</td></tr><tr><td>2024-05-28</td><td>专题研讨</td><td>PGCon.Dev 2024 全球 PG 开发者大会 扩展峰会</td><td>Extension in Core & Binary Packing</td></tr><tr><td>2024-05-10</td><td>直播辩论</td><td>三人行·云计算泥石流系列 第三期</td><td>公有云是骗局吗？</td></tr><tr><td>2024-04-17</td><td>直播辩论</td><td>三人行·云计算泥石流系列 第二期</td><td>云数据库是智商税吗？</td></tr><tr><td>2024-04-16</td><td>圆桌论坛</td><td>Cloudflare Immerse 深圳</td><td>赛博菩萨圆桌论坛</td></tr><tr><td>2024-04-12</td><td>技术大会</td><td>2024 数据技术嘉年华</td><td>Pigsty：解决 PostgreSQL 运维难题</td></tr><tr><td>2024-03-31</td><td>直播辩论</td><td>三人行·云计算泥石流系列 第一期</td><td>罗永浩卖云，我们却在下云？</td></tr><tr><td>2024-01-24</td><td>直播主持</td><td>OSCHINA 开源漫谈 第九期</td><td>DBA 会被云干掉吗？</td></tr><tr><td>2023-12-20</td><td>直播辩论</td><td>开源漫谈第七期</td><td>上云 or 下云，割韭菜还是降本增效？</td></tr><tr><td>2023-11-24</td><td>技术大会</td><td>大模型时代的向量数据库</td><td>圆桌讨论：大模型时代向量数据库新未来</td></tr><tr><td>2023-09-08</td><td>人物专访</td><td>墨天轮风云人物访谈</td><td>冯若航：不想当段子手的技术狂，不是一位好的开源创始人</td></tr><tr><td>2023-08-16</td><td>技术大会</td><td>DTCC 2023</td><td>DBA之夜：PostgreSQL vs MySQL的开源协议问题</td></tr><tr><td>2023-08-09</td><td>直播辩论</td><td>开源漫谈第一期</td><td>MySQL vs PostgreSQL，谁是世界第一？</td></tr><tr><td>2023-07-01</td><td>技术大会</td><td>SACC 2023</td><td>专题研讨会8：FinOps实践：云成本管理与优化</td></tr><tr><td>2023-05-12</td><td>线下活动</td><td>PostgreSQL中国社区 温州站线下沙龙</td><td>PG With DB4AI: 向量数据库 PGVECTOR & AI4DB: 数据库自动驾驶 Pigsty</td></tr><tr><td>2023-04-08</td><td>技术大会</td><td>数据库嘉年华 2023</td><td>更好的开源RDS替代：Pigsty</td></tr><tr><td>2023-04-01</td><td>技术大会</td><td>PostgreSQL中国社区 西安站线下沙龙</td><td>PG高可用与容灾最佳实践</td></tr><tr><td>2023-03-23</td><td>公开直播</td><td>Bytebase x Pigsty</td><td>管理 PostgreSQL 的最佳实践: Bytebase x Pigsty</td></tr><tr><td>2023-03-04</td><td>技术大会</td><td>PostgreSQL中国技术大会</td><td>炮打 RDS，Pigsty v2.0 发布</td></tr><tr><td>2023-02-01</td><td>技术大会</td><td>DTCC 2022</td><td>开源 RDS 替代：开箱即用、自动驾驶的数据库发行版 Pigsty</td></tr><tr><td>2022-07-21</td><td>直播辩论</td><td>云吞噬开源，那开源有机会反击吗？</td><td>云吞噬开源，那开源有机会反击吗？</td></tr><tr><td>2022-07-04</td><td>人物专访</td><td>专题采访：创造者说</td><td>90 后，辞职创业，说要卷死云数据库</td></tr><tr><td>2022-06-28</td><td>公开直播</td><td>贝斯的圆桌趴 ｜DBA 福音 -</td><td>SQL 审核最佳实践</td></tr><tr><td>2022-06-12</td><td>公开路演</td><td>奇绩创坛 S22 路演日</td><td>好用省钱的数据库发行版 Pigsty</td></tr><tr><td>2022-06-05</td><td>视频直播</td><td>PG中文社区直播分享</td><td>Pigstyv1.5快速上手新特性介绍与生产集群搭建</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-5b8cf903bf49e5cac8004f4b8b1742a7>4 - 发展规划</h1><div class=lead>未来功能的规划，新功能的发布节奏，待办事项列表。</div><hr><h2 id=版本发布策略>版本发布策略</h2><p>Pigsty 使用语义化版本号，<code>&lt;主版本>.&lt;次版本>.&lt;修订号></code>。Alpha / Beta / RC 版本会在版本号后添加后缀，如 <code>-a1</code>，<code>-b1</code>，<code>-c1</code>。</p><p>主版本更新意味着不兼容的基础性变化与重大新特性；次版本更新通常表示普通功能特性更新，较小的API变动；修订版本更新意味着 Bug 修复与软件包版本更新。</p><p>Pigsty 计划每年发布一次主版本更新，次版本更新通常跟随 PostgreSQL 小版本更新节奏，在 PostgreSQL 新版本发布后最迟一个月内跟进。
Pigsty 通常每年计划 4 - 6 个小版本，完整发布历史请参考 <a href=/docs/about/release><strong>发行注记</strong></a> 。</p><div class="alert alert-primary" role=alert><div class="h4 alert-heading" role=heading>使用具体的版本号进行部署</div><p>Pigsty 使用 <strong>main</strong> 主干分支进行开发，请始终使用带有版本号的 <a href=https://github.com/pgsty/pigsty/releases><strong>Release</strong></a>。</p><p>除非您清楚知道自己在做什么，否则请勿使用 GitHub 的 <strong>main</strong> 分支，总是检出特定版本使用。</p></div><hr><h2 id=列入考虑的新特性>列入考虑的新特性</h2><ul><li><input disabled type=checkbox> Agent Native CLI - PIG</li><li><input disabled type=checkbox> DBA Agent - 基本集成</li><li><input disabled type=checkbox> Grafana Dashboard 改进</li><li><input disabled type=checkbox> Boar 管理平台</li></ul><p>这里是我们的 <a href=https://github.com/pgsty/pigsty/issues><strong>活跃议题</strong></a> 与 <a href=https://github.com/users/Vonng/projects/2/views/3><strong>路线图</strong></a>。</p><hr><h2 id=扩展插件与软件包>扩展插件与软件包</h2><p>关于扩展支持的路线图，可以在这里找到：https://pgext.cloud/e/roadmap</p><h3 id=考虑纳入>考虑纳入</h3><ul><li>PDU : <a href=https://github.com/wublabdubdub/PDU-PostgreSQLDataUnloader>https://github.com/wublabdubdub/PDU-PostgreSQLDataUnloader</a></li><li>walminer <a href=https://gitee.com/movead/XLogMiner>https://gitee.com/movead/XLogMiner</a></li><li>is_jsonb_valid <a href=https://github.com/furstenheim/is_jsonb_valid>https://github.com/furstenheim/is_jsonb_valid</a></li><li>pg_kafka <a href=https://github.com/xstevens/pg_kafka>https://github.com/xstevens/pg_kafka</a></li><li>pg_jieba <a href=https://github.com/jaiminpan/pg_jieba>https://github.com/jaiminpan/pg_jieba</a></li><li>pg_paxos <a href=https://github.com/microsoft/pg_paxos>https://github.com/microsoft/pg_paxos</a></li><li>OneSparse <a href=https://github.com/OneSparse/OneSparse>https://github.com/OneSparse/OneSparse</a></li><li>PipelineDB <a href=https://github.com/pipelinedb/pipelinedb>https://github.com/pipelinedb/pipelinedb</a></li><li>SQL Firewall <a href=https://github.com/uptimejp/sql_firewall>https://github.com/uptimejp/sql_firewall</a></li><li>zcurve <a href=https://github.com/bmuratshin/zcurve>https://github.com/bmuratshin/zcurve</a></li><li>PG dot net <a href=https://github.com/Brick-Abode/pldotnet/releases>https://github.com/Brick-Abode/pldotnet/releases</a></li><li>pg_scws: <a href=https://github.com/jaiminpan/pg_scws>https://github.com/jaiminpan/pg_scws</a></li><li>themsis: <a href=https://github.com/cossacklabs/pg_themis>https://github.com/cossacklabs/pg_themis</a></li><li>pgspeck <a href=https://github.com/johto/pgspeck>https://github.com/johto/pgspeck</a></li><li>lsm3 <a href=https://github.com/postgrespro/lsm3>https://github.com/postgrespro/lsm3</a></li><li>monq <a href=https://github.com/postgrespro/monq>https://github.com/postgrespro/monq</a></li><li>pg_badplan <a href=https://github.com/trustly/pg_badplan>https://github.com/trustly/pg_badplan</a></li><li>pg_recall <a href=https://github.com/mreithub/pg_recall>https://github.com/mreithub/pg_recall</a></li><li>pgfsm <a href=https://github.com/michelp/pgfsm>https://github.com/michelp/pgfsm</a></li><li>pg_trgm pro <a href=https://github.com/postgrespro/pg_trgm_pro>https://github.com/postgrespro/pg_trgm_pro</a></li><li>pgsql-fio: <a href=https://github.com/csimsek/pgsql-fio>https://github.com/csimsek/pgsql-fio</a></li></ul><h3 id=暂不考虑>暂不考虑</h3><ul><li><a href=https://github.com/tembo-io/pg_tier>pg_tier</a>: not ready due to incomplete dep parquet_s3_fdw</li><li><a href=https://github.com/pgspider/parquet_s3_fdw>parquet_s3_fdw</a>: not ready due to compiler version</li><li>pg_top: not ready due to cmake error</li><li>timestamp9: not ready due to compiler error</li><li>pg_tier obsolete</li><li>pg_timeseries, we already have timescaledb</li><li>pg_quack, we already have a pg_lakehouse</li><li>pg_telemetry, we already have better observability</li><li>pgx_ulid, <a href=https://github.com/pksunkara/pgx_ulid>https://github.com/pksunkara/pgx_ulid</a>, already covered by pg_idkit (MIT, but RUST)</li><li>embedding: obsolete</li><li>FEAT zson <a href=https://github.com/postgrespro/zson>https://github.com/postgrespro/zson</a> MIT C (too old)</li><li>GIS pghydro <a href=https://github.com/pghydro/pghydro>https://github.com/pghydro/pghydro</a> C GPL-2.0 6.6 (no makefile)</li><li><a href=https://github.com/Zeleo/pg_natural_sort_order>https://github.com/Zeleo/pg_natural_sort_order</a> (too old)</li><li><a href=https://github.com/postgrespro/pg_query_state>https://github.com/postgrespro/pg_query_state</a></li><li><a href=https://github.com/no0p/pgsampler>https://github.com/no0p/pgsampler</a></li><li>pg_lz4 <a href=https://github.com/zilder/pg_lz4>https://github.com/zilder/pg_lz4</a></li><li>pg_amqp <a href=https://github.com/omniti-labs/pg_amqp>https://github.com/omniti-labs/pg_amqp</a></li><li>tinyint <a href=https://github.com/umitanuki/tinyint-postgresql>https://github.com/umitanuki/tinyint-postgresql</a></li><li>pg_blkchain <a href=https://github.com/blkchain/pg_blkchain>https://github.com/blkchain/pg_blkchain</a></li><li>hashtypes <a href=https://github.com/pandrewhk/hashtypes>https://github.com/pandrewhk/hashtypes</a></li><li>foreign_table_exposer <a href=https://github.com/komamitsu/foreign_table_exposer>https://github.com/komamitsu/foreign_table_exposer</a></li><li>ldap_fdw <a href=https://github.com/guedes/ldap_fdw>https://github.com/guedes/ldap_fdw</a></li><li>pg_backtrace <a href=https://github.com/postgrespro/pg_backtrace>https://github.com/postgrespro/pg_backtrace</a></li><li>connection_limits <a href=https://github.com/tvondra/connection_limits>https://github.com/tvondra/connection_limits</a></li><li>fixeddecimal <a href=https://github.com/2ndQuadrant/fixeddecimal>https://github.com/2ndQuadrant/fixeddecimal</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2e7ab4dcac19bf660ef9e7cad8ab7e91>5 - 加入社区</h1><div class=lead>Pigsty 是一个 Build in Public 的项目，我们在 GitHub 上非常活跃，中文区用户主要活跃于微信群组中。</div><hr><h2 id=github>GitHub</h2><p>我们的 GitHub 仓库地址是：<a href=https://github.com/pgsty/pigsty>https://github.com/pgsty/pigsty</a> ，欢迎点个 ⭐️ <a href=https://github.com/pgsty/pigsty/stargazers><strong>关注</strong></a> 我们。</p><p>我们欢迎任何人 <a href=https://github.com/pgsty/pigsty/issues/new>提交新 Issue</a> 或创建 <a href=https://github.com/pgsty/pigsty/pulls>Pull Request</a>，提出功能建议并参与 Pigsty 贡献。</p><p><a href=https://star-history.com/#pgsty/pigsty&amp;Date><img src="https://api.star-history.com/svg?repos=pgsty/pigsty&amp;type=Date" alt="Star History Chart"></a></p><p>请注意，关于 Pigsty 文档的问题，请在 <a href=https://github.com/Vonng/pigsty.cc>github.com/Vonng/pigsty.cc</a> 仓库中提交 <a href=https://github.com/Vonng/pigsty.cc/issues>Issue</a>。</p><hr><h2 id=微信群组>微信群组</h2><p>中文区用户主要活跃于微信群组中，目前有七个活跃的群组，1群-4群已经满员，其他群需要添加小助手微信拉入。</p><p>加入微信社群，请用搜索 “Pigsty小助手”，（微信号 <code>pigsty-cc</code>） 备注或发送 “加群” ，小助手会将您拉入群组中。</p><p><img src=/img/pigsty/pigsty-cc.jpg alt></p><hr><h2 id=海外社群>海外社群</h2><p>Telegram: <a href=https://t.me/joinchat/gV9zfZraNPM3YjFh>https://t.me/joinchat/gV9zfZraNPM3YjFh</a></p><p>Discord: <a href=https://discord.gg/j5pG8qfKxU>https://discord.gg/j5pG8qfKxU</a></p><p>您也可以通过邮件联系我： <a href=mailto:rh@vonng.com>rh@vonng.com</a></p><hr><h2 id=社区求助>社区求助</h2><p>当您使用 Pigsty 遇到问题时，可以向社区求助，您提供的信息越丰富，就越有可能在社区得到帮助。</p><p>请参考 <a href=https://github.com/pgsty/pigsty/discussions/338>社区求助指南</a> ，尽可能提供足够的信息，以便社区成员帮助您解决问题。以下是求助提问的参考模板：</p><p><strong>发生了什么事？</strong> (<strong>必选项</strong>)</p><p><strong>Pigsty版本号与操作系统版本</strong> (<strong>必选项</strong>)</p><pre tabindex=0><code>$ grep version pigsty.yml 

$ cat /etc/os-release

$ uname -a
</code></pre><p>一些云厂商对标准操作系统发行版进行了定制，您可以告诉我们使用的是哪一家云厂商的什么操作系统镜像。
如果您在安装操作系统后对环境进行了定制与修改，或者在您的局域网中有特定的安全规则与防火墙配置，也请在提问时告知我们。</p><p><strong>Pigsty配置文件</strong></p><blockquote><p>请不要忘记抹掉任何敏感信息：密码，内部密钥，敏感配置等。</p></blockquote><pre tabindex=0><code>cat ~/pigsty/pigsty.yml
</code></pre><p><strong>你期待发生什么？</strong></p><blockquote><p>请描述正常情况下应该发生什么事情，实际发生的情况与期待的情况有何偏离？</p></blockquote><p><strong>如何复现此问题？</strong></p><blockquote><p>请尽可能详细地告诉我们复现此问题的方法与步骤。</p></blockquote><p><strong>监控截图</strong></p><blockquote><p>如果你在使用 Pigsty 提供的监控系统，可以提供 <strong>相关</strong> 的截图。</p></blockquote><p><strong>错误日志</strong></p><p>请尽可能提供与错误有关的日志。<strong>请不要粘贴类似 “Failed to start xxx service” 之类没有信息量的内容</strong>。</p><p>您可以从 Grafana / VictoriaLogs 中查询日志，或从以下位置获取日志：</p><ul><li>Syslog: <code>/var/log/messages</code> (rhel) or <code>/var/log/syslog</code> (debian)</li><li>Postgres: <code>/pg/log/postgres/*</code></li><li>Patroni: <code>/pg/log/patroni/*</code></li><li>Pgbouncer: <code>/pg/log/pgbouncer/*</code></li><li>Pgbackrest: <code>/pg/log/pgbackrest/*</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>journalctl -u patroni
</span></span><span style=display:flex><span>journalctl -u &lt;service name&gt;
</span></span></code></pre></div><p><strong>您已经搜索过 Issue/网站/FAQ了吗？</strong></p><blockquote><p>在 FAQ 中，我们提供了许多常见问题的解答，请在提问前检查</p></blockquote><p>您也可以从 Github Issue 与 Discussion 中搜索相关问题：</p><ul><li><a href=/docs/pgsql/faq>Pigsty常见问题</a></li><li><a href=https://github.com/pgsty/pigsty/issues>Github 议题</a></li><li><a href=https://github.com/pgsty/pigsty/discussions>Pigsty 讨论组</a></li></ul><p><strong>有什么其他信息是我们需要知道的吗？</strong></p><blockquote><p>您提供的信息与上下文越丰富，我们越有可能帮助您解决问题。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-b655f0d84b0e39638f72e60cf6db032d>6 - 隐私政策</h1><div class=lead>Pigsty 软件与网站会收集哪些用户数据，以及我们将如何处理您的数据并保护您的隐私权？</div><hr><h2 id=pigsty软件>Pigsty软件</h2><p>当您安装 Pigsty 软件时，如果在网络隔离的环境中使用离线软件包安装，<strong>我们不会收到任何关于您的数据</strong>。</p><p>如果您选择在线安装，那么在下载相关软件包时，我们的服务器或云供应商的服务器会自动在日志中记录来访机器的 IP 地址和/或主机名，和您下载的软件包名称。
除非法律要求，我们不会与其他组织共享这些信息。（实话说，吃饱了撑着才会去看这些东西）</p><p>Pigsty 使用的主域名为：<a href=https://pigsty.io><strong>pigsty.io</strong></a> ，中国大陆请使用中文备案镜像站点 <a href=https://pigsty.cc><strong>pigsty.cc</strong></a>。</p><hr><h2 id=pigsty网站>Pigsty网站</h2><p>当您访问我们的网站时，我们的服务器会自动在 Nginx 日志中记录您的 IP 地址和/或主机名。
仅当您决定通过完成调查或在我们的某个网站上注册为用户来向我们发送此类信息时，我们才会存储您的电子邮件地址、姓名和地点等信息</p><p>我们收集这些信息是为了帮助我们改进网站内容、定制网页布局以及出于技术和支持目的联系人员。除非法律要求，我们不会与其他组织共享您的电子邮件地址。</p><p>本网站使用 Google Analytics，这是 Google, Inc.（“Google”）提供的一项网络分析服务。谷歌分析使用“cookies”，即放置在您计算机上的文本文件，帮助网站分析用户如何使用该网站。</p><blockquote><p>cookie 生成的有关您使用网站的信息（包括您的 IP 地址）将被传输至 Google 位于美国的服务器并由其存储。谷歌将使用这些信息来评估您对网站的使用情况，为网站运营商编制网站活动报告，并提供与网站活动和互联网使用相关的其他服务。
如果法律要求，或者第三方代表 Google 处理信息，Google 还可能会将此信息传输给第三方。 Google 不会将您的 IP 地址与 Google 持有的任何其他数据关联起来。
您可以通过在浏览器上选择适当的设置来拒绝使用 cookie，但请注意，如果您这样做，您可能无法使用本网站的全部功能。使用本网站即表示您同意 Google 以上述方式和目的处理有关您的数据。</p></blockquote><p>如果您对此政策有任何疑问或意见，或要求删除个人数据，您可以通过发送邮件至 <a href=mailto:rh@vonng.com>rh@vonng.com</a> 与我们联系</p></div><div class=td-content style=page-break-before:always><h1 id=pg-04cf6db19a8c2e839a6d1e4a81d4c6b7>7 - 开源协议</h1><div class=lead>Pigsty 使用的开源协议 —— Apache-2.0，它授予您什么样的权利，又有哪些限制？</div><h2 id=协议摘要>协议摘要</h2><p>Pigsty 项目主体使用 <strong>Apache-2.0</strong> 开源许可证；Pigsty 文档网站使用 <strong>CC by 4.0</strong> 许可证。
项目协议地址：<a href=https://github.com/pgsty/pigsty/blob/main/LICENSE>https://github.com/pgsty/pigsty/blob/main/LICENSE</a></p><hr><h2 id=pigsty-项目主体>Pigsty 项目主体</h2><p>Pigsty 软件主体采用 <a href=#apache-20-%E8%AE%B8%E5%8F%AF%E8%AF%81%E5%8E%9F%E6%96%87><strong>Apache License 2.0</strong></a> 许可证。
这是一种宽松的开源许可证，允许您自由地使用、修改和分发本软件，包括用于商业目的，而无需公开您的源代码或使用相同许可证。</p><table class=full-width><thead><tr><th><strong>本协议授权您</strong></th><th><strong>本协议不提供</strong></th><th><strong>本协议的条件</strong></th></tr></thead><tbody><tr><td><i class="fas fa-circle-check text-primary"></i> 商用</td><td><i class="fas fa-circle-xmark text-danger"></i> 商标使用权</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 包含本许可证与版权声明</td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 修改</td><td><i class="fas fa-circle-xmark text-danger"></i> 责任与担保</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 声明对原始代码的修改</td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 分发</td><td></td><td></td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 专利授权</td><td></td><td></td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 私人使用</td><td></td><td></td></tr></tbody></table><hr><h2 id=pigsty-文档网站>Pigsty 文档网站</h2><p>Pigsty 的文档与网站（包括但不限于：<a href=https://pigsty.cc><strong>pigsty.cc</strong></a>，<a href=https://pigsty.io><strong>pigsty.io</strong></a>，<a href=https://pgsty.com><strong>pgsty.com</strong></a> ）均使用 <strong>Creative Commons Attribution 4.0 International (CC BY 4.0)</strong> 许可证。
<strong>CC BY 4.0</strong> 是一种知识共享许可证，允许您自由地分享与演绎本站的内容，但是您必须给出 <a href=https://creativecommons.org/licenses/by/4.0/deed.zh-hans#ref-appropriate-credit><strong>适当的署名</strong></a>，提供指向许可证的链接，并 <a href=https://creativecommons.org/licenses/by/4.0/deed.zh-hans#ref-indicate-changes><strong>指出是否有对原始内容进行了修改</strong></a>。</p><table class=full-width><thead><tr><th><strong>本协议授权您</strong></th><th><strong>本协议不提供</strong></th><th><strong>本协议的条件</strong></th></tr></thead><tbody><tr><td><i class="fas fa-circle-check text-primary"></i> 商用</td><td><i class="fas fa-circle-xmark text-danger"></i> 商标使用权</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 署名（注明原作者）</td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 修改</td><td><i class="fas fa-circle-xmark text-danger"></i> 责任与担保</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 标明修改内容</td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 分发</td><td><i class="fas fa-circle-xmark text-danger"></i> 专利授权</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 提供许可证链接</td></tr><tr><td><i class="fas fa-circle-check text-primary"></i> 私人使用</td><td></td><td></td></tr></tbody></table><hr><h2 id=sbom-清单>SBOM 清单</h2><p>以下为 Pigsty 项目所使用或相关的开源软件及其开源协议。</p><p>444 个 PostgreSQL 扩展插件的许可证请参考 <a href=https://pgext.cloud/zh/list/license><strong>PostgreSQL 扩展许可证清单</strong></a>。</p><table class=full-width><thead><tr><th style=text-align:center>模块</th><th style=text-align:center>软件名称</th><th>许可证</th><th>必要性，用途与说明</th><th style=text-align:center>必要性</th></tr></thead><tbody><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://www.postgresql.org/>PostgreSQL</a></td><td><a href=https://www.postgresql.org/about/licence/>PostgreSQL License</a></td><td>PostgreSQL 内核</td><td style=text-align:center><strong>必选</strong></td></tr><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://patroni.readthedocs.io/en/latest/>patroni</a></td><td><a href=https://github.com/zalando/patroni/blob/master/LICENSE>MIT License</a></td><td>提供 PostgreSQL 高可用能力</td><td style=text-align:center><strong>必选</strong></td></tr><tr><td style=text-align:center>ETCD</td><td style=text-align:center><a href=https://etcd.io/>etcd</a></td><td><a href=https://github.com/etcd-io/etcd/blob/main/LICENSE>Apache License 2.0</a></td><td>提供高可用共识与分布式配置存储</td><td style=text-align:center><strong>必选</strong></td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://docs.ansible.com/ansible/latest/index.html>Ansible</a></td><td><a href=https://github.com/ansible/ansible/blob/devel/COPYING>GPLv3</a></td><td>管控工具，执行剧本，发起管控命令</td><td style=text-align:center><strong>必选</strong></td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://github.com/nginx/nginx>Nginx</a></td><td><a href=https://github.com/nginx/nginx/blob/master/LICENSE>BSD-2</a></td><td>暴露Web系统界面，提供本地软件源</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://pgbackrest.org/>pgbackrest</a></td><td><a href=https://github.com/pgbackrest/pgbackrest/blob/main/LICENSE>MIT License</a></td><td>提供 PITR 备份/恢复管理能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://www.pgbouncer.org/community.html>pgbouncer</a></td><td><a href=https://github.com/pgbouncer/pgbouncer/blob/master/COPYRIGHT>ISC License</a></td><td>提供 PostgreSQL 连接池化能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://github.com/cybertec-postgresql/vip-manager>vip-manager</a></td><td><a href=https://github.com/cybertec-postgresql/vip-manager/blob/master/LICENSE>BSD 2-Clause License</a></td><td>提供自动将 L2 VIP 绑定到 PG 集群主库的能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>PGSQL</td><td style=text-align:center><a href=https://github.com/Vonng/pg_exporter>pg_exporter</a></td><td><a href=https://github.com/Vonng/pg_exporter/blob/master/LICENSE>Apache License 2.0</a></td><td>提供监控 PostgreSQL 与 PgBouncer 的能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>NODE</td><td style=text-align:center><a href=https://github.com/prometheus/node_exporter>node_exporter</a></td><td><a href=https://github.com/prometheus/node_exporter/blob/master/LICENSE>Apache License 2.0</a></td><td>提供主机节点监控能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>NODE</td><td style=text-align:center><a href=https://www.haproxy.org/>haproxy</a></td><td><a href=https://www.haproxy.org/download/1.3/doc/LICENSE>HAPROXY&rsquo;s License</a> (GPLv2)</td><td>提供负载均衡，对外暴露服务的能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://grafana.com/>Grafana</a></td><td><a href=https://github.com/grafana/grafana/blob/main/LICENSE>AGPLv3</a></td><td>提供数据库可视化平台</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://victoriametrics.com/>VictoriaMetrics</a></td><td><a href=https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/LICENSE>Apache License 2.0</a></td><td>提供监控时序数据库存储，指标采集与监控告警</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://victoriametrics.com/>VictoriaLogs</a></td><td><a href=https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/LICENSE>Apache License 2.0</a></td><td>提供集中式日志收集存储查询平台</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>INFRA</td><td style=text-align:center><a href=https://thekelleys.org.uk/dnsmasq/doc.html>DNSMASQ</a></td><td><a href=https://thekelleys.org.uk/dnsmasq/doc.html>GPLv2</a> / <a href=https://thekelleys.org.uk/dnsmasq/doc.html>GPLv3</a></td><td>提供DNS解析服务，提供集群名查询能力</td><td style=text-align:center>建议</td></tr><tr><td style=text-align:center>MINIO</td><td style=text-align:center><a href=https://min.io/>MinIO</a></td><td><a href=https://github.com/minio/minio/blob/master/LICENSE>AGPLv3</a></td><td>提供S3兼容的对象存储服务</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>NODE</td><td style=text-align:center><a href=https://www.keepalived.org/>keepalived</a></td><td><a href=https://github.com/umich-arc/keepalived/blob/master/LICENSE>MIT License</a></td><td>提供绑定在节点集群上的 VIP</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>REDIS</td><td style=text-align:center><a href=https://redis.io/>Redis</a></td><td><a href=https://redis.io/docs/about/license/>Redis License</a> (BSD-3)</td><td>搭配PG使用的缓存服务，锁死版本 7.2.6</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>REDIS</td><td style=text-align:center><a href=https://github.com/oliver006/redis_exporter>Redis Exporter</a></td><td><a href=https://github.com/oliver006/redis_exporter/blob/master/LICENSE>MIT License</a></td><td>提供 Redis 监控能力</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>MONGO</td><td style=text-align:center><a href=https://www.ferretdb.io/>FerretDB</a></td><td><a href=https://github.com/FerretDB/FerretDB/blob/main/LICENSE>Apache License 2.0</a></td><td>提供基于PG的MongoDB兼容能力</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>DOCKER</td><td style=text-align:center><a href=https://github.com/docker/docker-ce>docker-ce</a></td><td><a href=https://github.com/docker/docker-ce/blob/master/LICENSE>Apache License 2.0</a></td><td>提供容器管理能力</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>CLOUD</td><td style=text-align:center><a href=https://github.com/labring/sealos/blob/main/LICENSE>SealOS</a></td><td><a href=https://github.com/labring/sealos/blob/main/LICENSE>Apache License 2.0</a></td><td>提供快速部署，复制，打包K8S集群的能力</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>DUCKDB</td><td style=text-align:center><a href=https://github.com/duckdb/duckdb>DuckDB</a></td><td><a href=https://github.com/duckdb/duckdb/blob/main/LICENSE>MIT</a></td><td>提供简单易用的高性能分析能力</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>External</td><td style=text-align:center><a href=https://www.vagrantup.com/>Vagrant</a></td><td><a href=https://github.com/hashicorp/vagrant/blob/main/LICENSE>Business Source License 1.1</a></td><td>拉起本地测试环境虚拟机</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>External</td><td style=text-align:center><a href=https://www.terraform.io/>Terraform</a></td><td><a href=https://github.com/hashicorp/terraform/blob/main/LICENSE>Business Source License 1.1</a></td><td>一键申请云资源用于部署</td><td style=text-align:center>可选</td></tr><tr><td style=text-align:center>External</td><td style=text-align:center><a href=https://www.virtualbox.org/>Virtualbox</a></td><td><a href=https://www.virtualbox.org/wiki/Licensing_FAQ>GPLv2</a></td><td>虚拟机管理软件</td><td style=text-align:center>可选</td></tr></tbody></table><p>必要性等级说明：</p><ul><li><strong>必选</strong>：提供 Pigsty 关键性核心能力，不提供关闭停用选项</li><li><strong>建议</strong>：Pigsty <strong>默认启用</strong> 的组件，可以通过配置选项停用</li><li><strong>可选</strong>：Pigsty 默认支持但不启用的组件，可通过配置启用</li></ul><h2 id=apache-20-许可证原文>Apache-2.0 许可证原文</h2><pre tabindex=0><code>
                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      &#34;License&#34; shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

      &#34;Licensor&#34; shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

      &#34;Legal Entity&#34; shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      &#34;control&#34; means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

      &#34;You&#34; (or &#34;Your&#34;) shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      &#34;Source&#34; form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

      &#34;Object&#34; form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      &#34;Work&#34; shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      &#34;Derivative Works&#34; shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

      &#34;Contribution&#34; shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, &#34;submitted&#34;
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as &#34;Not a Contribution.&#34;

      &#34;Contributor&#34; shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

      (d) If the Work includes a &#34;NOTICE&#34; text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

      You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions.
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an &#34;AS IS&#34; BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets &#34;[]&#34;
      replaced with your own identifying information. (Don&#39;t include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same &#34;printed page&#34; as the copyright notice for easier
      identification within third-party archives.

   Copyright (C) 2018-2026  Ruohang Feng, @Vonng (rh@vonng.com)

   Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-598ea3cad6e4433a090609fa3d8be7af>8 - 赞助我们</h1><div class=lead>Pigsty 的赞助者，投资人名单，感谢你们对本项目的支持！</div><hr><h2 id=赞助我们>赞助我们</h2><p>Pigsty 是一个开源免费的自由软件，由 PostgreSQL 社区成员用热情浇灌而成，旨在整合 PostgreSQL 生态的力量，推广 PostgreSQL 的普及。
如果我们的工作帮到了您，请考虑赞助或者支持一下我们的项目：</p><ul><li>直接打钱赞助我们，用最直接有力的鼓舞表达您的真挚支持！</li><li>考虑采购我们的 <a href=/docs/about/service/><strong>技术支持服务</strong></a>，我们可以提供专业的 PostgreSQL 高可用集群部署与维护服务，让您的预算花得物有所值！</li><li>通过文章，讲座，视频分享您使用 Pigsty 的案例与经验。</li><li>允许我们在 “这些用户使用了Pigsty” 中提及您的组织。</li><li>向有需求的朋友，同事与客户提名/推荐我们的项目与服务。</li><li>关注我们的 <a href=https://mp.weixin.qq.com/s/p4Ys10ZdEDAuqNAiRmcnIQ><strong>微信公众号</strong></a> 并转发相关技术文章至群组与朋友圈。</li></ul><hr><h2 id=天使投资人>天使投资人</h2><p>Pigsty 是由 <a href=https://www.miracleplus.com/en/><strong>奇绩创坛</strong></a> （原YC中国，MiraclePlus） S22 所投资的项目，感谢奇绩创坛与陆奇博士对本项目的支持！</p><hr><h2 id=赞助者>赞助者</h2><p>感谢我们的赞助者 Vercel，为 Pigsty 网站提供了赞助与网站托管基础设施。</p><p><a href=https://vercel.com/oss><img src=https://vercel.com/oss/program-badge.svg alt="Vercel OSS Program"></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-671c4a8168cec3cc6152729f65f5dd71>9 - 行业案例</h1><div class=lead>Pigsty 在各个领域与行业的客户/应用案例</div><p>根据 Google Analytics PV 与下载量，Pigsty 目前有约 <strong>10 万用户</strong>，一半来自中国大陆，一半来自全球其他地区。
遍布互联网、云计算、金融、自动驾驶、制造业、科技创新、ISV 与军工等多个行业。
如果您在 使用 Pigsty 并且愿意与我们分享您的案例与 Logo，欢迎联系我们，我们提供一次的免费咨询支持。</p><h2 id=互联网>互联网</h2><p><strong>探探</strong>：两百台+物理机，用于 PostgreSQL 与 Redis 服务</p><p><strong>哔哩哔哩</strong>：用于支持 PostgreSQL 创新业务</p><h2 id=云厂商>云厂商</h2><p><strong>Bitdeer</strong>：比特小鹿，提供 PG DBaaS</p><p><strong>Oracle OCI</strong>：使用 Pigsty 交付 PostgreSQL 集群。</p><h2 id=金融行业>金融行业</h2><p><strong>AirWallex</strong>：监控 200+ GCP PostgreSQL 数据库</p><h2 id=影视行业>影视行业</h2><p><strong>影视飓风</strong>：自建 PG RDS / Victoria Metrics</p><h2 id=自动驾驶>自动驾驶</h2><p><strong>Momenta</strong>：自动驾驶，管理自建 PostgreSQL 集群</p><h2 id=制造业>制造业</h2><p><strong>华峰集团</strong>：使用 Pigsty 交付 PostgreSQL 集群作为化工时序数据仓库</p><h2 id=科技创新>科技创新</h2><p><strong>北京领雾科技</strong>：云上 PostgreSQL 下云自建</p><p><strong>Motphys</strong>：自建 PostgreSQL 支持 Gitlab</p><p><strong>赛陇生物科技</strong>：自建 Supabase</p><p><strong>杭州零码科技</strong>：自建 PostgreSQL</p><h2 id=isv>ISV</h2><p><strong>内蒙古豪德天沐科技有限公司</strong></p><p><strong>上海元芳</strong></p><p><strong>DSG</strong></p><h2 id=军工>军工</h2><p><strong>北京某部队</strong></p><p><strong>上海某部队</strong></p><p><strong>电科36所</strong></p><p><strong>机械工业研究所</strong></p><p><strong>航天一院</strong></p></div><div class=td-content style=page-break-before:always><h1 id=pg-6fd2303c95121a06e15583b834f3533b>10 - 订阅服务</h1><div class=lead>Pigsty 专业版/企业版订阅服务：当您遇到与 PostgreSQL 和 Pigsty 有关的疑难杂症时，订阅服务可以为您兜底。</div><p>Pigsty 旨在聚集PG生态的合力，并用自动驾驶的数据库管控软件帮助用户用好世界上 <a href=/blog/pg/pg-is-no1-again/><strong>最流行</strong></a> 的数据库 PostgreSQL。</p><p>尽管 Pigsty 本身已经解决了 PG 使用中的诸多问题。但想真正达到企业级服务的质量，原厂提供的专家支持与兜底服务不可或缺。
我们深知专业的商业支持服务对于企业客户的重要性，因此，Pigsty 企业版在开源版本的基础上提供了一系列增值服务，帮助用户更好地用好 PostgreSQL 与 Pigsty，供有需求的客户按需选用。</p><p><strong>如果您有下列需求，欢迎考虑 Pigsty 订阅服务：</strong></p><ul><li>在关键场景中运行数据库，需要严格 SLA 保障兜底。</li><li>希望对 Pigsty 与 PostgreSQL 相关疑难杂症提供兜底。</li><li>希望获取关于 PostgreSQL / Pigsty 生产环境最佳实践的指导。</li><li>希望有专家帮助解读监控图表，分析定位性能瓶颈与故障根因，给出意见。</li><li>希望根据现有资源与业务需求，规划满足安全/容灾/合规要求的数据库架构。</li><li>需要将其他数据库迁移至 PostgreSQL 数据库，或对历史遗留实例迁移与改造。</li><li>建设基于Prometheus / Grafana 技术栈的可观测性体系，数据大盘，可视化应用。</li><li>希望支持国产信创操作系统/国产信创 ARM 芯片架构，提供中文/本地化界面支持。</li><li>下云并寻求 RDS for PostgreSQL 的开源替代 —— 云中立，无供应商锁定的解决方案。</li><li>希望获取关于 Redis / ETCD / MinIO，以及 TimescaleDB / Citus 等扩展的专业支持。</li><li>希望将 Pigsty 作为 SaaS / PaaS / DBaaS 对外销售，或基于此发行版提供技术服务/云服务。</li></ul><hr><h2 id=订阅计划>订阅计划</h2><p>除了 <a href=#pigsty%E5%BC%80%E6%BA%90%E7%89%88><strong>开源版</strong></a> 之外，Pigsty 提供两种不同的订阅服务档位：<a href=#pigsty%E4%B8%93%E4%B8%9A%E7%89%88><strong>专业版</strong></a> 与 <a href=#pigsty%E4%BC%81%E4%B8%9A%E7%89%88><strong>企业版</strong></a>，您可以根据自身的实际情况与需求选购。</p><div class="td-card-group card-group p-0 mb-4"><div class="td-card card border me-4"><div class=card-header><strong>Pigsty 开源版（OSS）</strong></div><div class=card-body><h5 class=card-title>开源免费</h5><h6 class="card-title ms-2 text-body-secondary">无规模限制，无质保承诺</h6><p class=card-text><p><b>许可协议：<a href=/docs/about/license>Apache-2.0</a></b></p><p><b>PG支持：18</b></p><p><b>架构支持：x86_64</b></p><p><b>OS支持：三系最新小版本</b><p><ul><li>EL 9.4</li><li>Debian 12.7</li><li>Ubuntu 22.04.5</li></ul><p><b>功能：<a href=/docs/ref/module#核心模块>核心模块</a></b></p><p><b>SLA：无 SLA 承诺</b></p><p><b>社区公益支持答疑：</b></p><ul><li><a href=/docs/about/community>微信讨论群组</a></li><li><a href=https://github.com/pgsty/pigsty/issues/>GitHub Issue</a></li><li><a href=https://discord.gg/j5pG8qfKxU>Discord Channel</a></li></ul><p><b>支持：无人天支持选项</b></p><p><b>仓库：全球CF托管仓库</b></p></p></div><div class=card-footer>自给自足的开源老司机</div></div><div class="td-card card border me-4"><div class=card-header><strong>Pigsty 专业版（PRO）</strong></div><div class=card-body><h5 class=card-title>起售价：150,000 ¥ / 年</h5><h6 class="card-title ms-2 text-body-secondary">普通用户的默认之选</h6><p class=card-text><p><b>许可协议：商业许可证</b></p><p><b>PG支持：17, 18</b></p><p><b>架构支持：x86_64，Arm64</b></p><p><b>OS支持：五系大小版本</b><p><ul><li>EL 8 / 9 兼容</li><li>Debian 12</li><li>Ubuntu 22 / 24</li></ul><p><b>功能：<a href=/docs/ref/module>所有模块</a></b>（信创除外）</p><p><b>SLA：工作日时效内响应</b></p><p><b>提供专家咨询服务：</b></p><ul><li>软件缺陷修复</li><li>疑难杂症分析</li><li>专家工单答疑</li></ul><p><b>支持：每年包含 1 人天</b></p><p><b>交付：标准离线软件包</b></p><p><b>仓库：中国大陆镜像站</b></p></p></div><div class=card-footer>普通用户的默认之选</div></div><div class="td-card card border me-4"><div class=card-header><strong>Pigsty 企业版（ENTERPRISE）</strong></div><div class=card-body><h5 class=card-title>起售价：400,000 ¥ / 年</h5><h6 class="card-title ms-2 text-body-secondary">严格 SLA 的关键场景</h6><p class=card-text><p><b>许可协议：商业许可证</b></p><p><b>PG支持：12 - 18+</b></p><p><b>架构支持：x86_64，Arm64</b></p><p><b>OS支持：按需定制</b><p><ul><li>EL, Debian, Ubuntu</li><li>云上 Linux 操作系统</li><li>国产操作系统与ARM</li></ul><p><b>功能：<a href=/docs/ref/module>所有模块</a></b></p><p><b>SLA：7 x 24 (< 1h)</b></p><p><b>提供企业级专家咨询服务：</b></p><ul><li>软件缺陷修复</li><li>疑难杂症分析</li><li>专家答疑解惑</li><li>备份合规建议</li><li>升级路径支持</li><li>性能瓶颈定位</li><li>年度架构评估</li><li>扩展插件收录</li><li>DBaaS & OEM 用例</li></ul><p><b>支持：每年包含 2 人天</b></p><p><b>仓库：中国大陆镜像站</b></p><p><b>交付：定制离线软件包</b></p><p><b>信创：<a href=/docs/pgsql/kernel/polardb-o>PolarDB-O</a> 支持</b></p></p></div><div class=card-footer>严格 SLA 的关键场景</div></div></div><hr><h2 id=pigsty开源版>Pigsty开源版</h2><p>Pigsty 开源版使用 <a href=/docs/about/license><strong>Apache-2.0</strong></a> 许可证， 提供了完整核心功能，无需任何费用，但也不承诺任何质保服务。如果您发现了 Pigsty 的缺陷，我们非常欢迎您在 Github 上提出 <a href=https://github.com/pgsty/pigsty/issues/>Issue</a>。</p><p>针对开源版本，我们提供 PostgreSQL 18 在 EL 9.6，Debian 12.11，Ubuntu 22.04.5 三个精准操作系统发行版最新小版本上的预制标准离线软件包（作为对开源的支持，同时提供 Debian 12 的 Arm64 离线软件包）。</p><p>使用 Pigsty 开源版本，可以让初级研发工程师 / 运维工程师拥有专业 DBA <strong>70%+</strong> 的能力，在缺少数据库专家的情况下，也能够轻松搭建一个高可用，高性能，易维护，安全可靠的 PostgreSQL 数据库集群。</p><table class=full-width><thead><tr><th style=text-align:center>代号</th><th>操作系统发行版版本</th><th style=text-align:center><code>x86_64</code></th><th style=text-align:center><code>Arm64</code></th><th style=text-align:center>PG17</th><th style=text-align:center>PG16</th><th style=text-align:center>PG15</th><th style=text-align:center>PG14</th><th style=text-align:center>PG13</th></tr></thead><tbody><tr><td style=text-align:center><strong>EL9</strong></td><td>RHEL 9 / Rocky9 / Alma9</td><td style=text-align:center><code>el9.x86_64</code></td><td style=text-align:center></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>U22</strong></td><td>Ubuntu 22.04 (<code>jammy</code>)</td><td style=text-align:center><code>u22.x86_64</code></td><td style=text-align:center></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>D12</strong></td><td>Debian 12 (<code>bookworm</code>)</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center><code>d12.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr></tbody></table><blockquote><p><i class="fas fa-circle-check text-primary"></i> = 首要支持，<i class="fas fa-check text-primary"></i> = 选配支持</p></blockquote><hr><h2 id=pigsty专业版>Pigsty专业版</h2><div class="alert alert-secondary" role=alert><div class="h4 alert-heading" role=heading>专业版订阅： 起售价格 ¥ 150,000 / 年</div></div><p>Pigsty 专业版订阅提供了完整的功能模块，以及对于 Pigsty 本身的质保。关于 PostgreSQL 本身与扩展插件的缺陷，我们将尽最大努力通过 PostgreSQL 全球开发者社区进行反馈与修复。</p><p>Pigsty 专业版构建于开源版基础之上，完全兼容开源版本的所有功能，并提供额外的功能模块，与更为宽广的数据库 / 操作系统版本兼容选项：我们将针对五个主流操作系统发行版的 <strong>所有小版本</strong> 提供构建选项。</p><p>Pigsty 专业版包含了对 <strong>最近两个</strong> PostgreSQL 大版本（18，17）的支持，提供两个大版本中的所有可用的扩展插件，确保您可以通过滚动升级的方式，平滑迁移到最新的 PostgreSQL 大版本上。</p><p>Pigsty 专业版订阅允许您使用中国大陆镜像站点软件仓库，无需翻墙代理即可访问；同时我们将针对您使用的精准操作系统大小版本定制离线软件安装包，确保在断网环境下也能正常安装交付，做到自主可控。</p><p>Pigsty 专业版订阅提供了标准的专家咨询服务，包括疑难杂症分析，DBA 答疑解惑，备份合规建议等，我们承诺在工作日（5x8）时效内响应您的问题，并且每年提供 <strong>1</strong> 人天支持，以及可选的人天加购选项。</p><p>Pigsty 专业版使用商业许可证，提供额外的功能模块、技术支持与质保服务。</p><p>Pigsty 专业版的起售价格 <strong>¥150,000 / 年</strong>，相当于 <strong>9</strong> vCPU 的 AWS 高可用 RDS PG 年费， 或月薪 <strong>一万元</strong> 的初级运维工程师。</p><table class=full-width><thead><tr><th style=text-align:center>代号</th><th>操作系统发行版版本</th><th style=text-align:center><code>x86_64</code></th><th style=text-align:center><code>Arm64</code></th><th style=text-align:center>PG17</th><th style=text-align:center>PG16</th><th style=text-align:center>PG15</th><th style=text-align:center>PG14</th><th style=text-align:center>PG13</th></tr></thead><tbody><tr><td style=text-align:center><strong>EL9</strong></td><td>RHEL 9 / Rocky9 / Alma9</td><td style=text-align:center><code>el9.x86_64</code></td><td style=text-align:center><code>el9.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>EL8</strong></td><td>RHEL 8 / Rocky8 / Alma8 / Anolis8</td><td style=text-align:center><code>el8.x86_64</code></td><td style=text-align:center><code>el8.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>U24</strong></td><td>Ubuntu 24.04 (<code>noble</code>)</td><td style=text-align:center><code>u24.x86_64</code></td><td style=text-align:center><code>u24.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>U22</strong></td><td>Ubuntu 22.04 (<code>jammy</code>)</td><td style=text-align:center><code>u22.x86_64</code></td><td style=text-align:center><code>u22.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>D12</strong></td><td>Debian 12 (<code>bookworm</code>)</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center><code>d12.aarch64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr></tbody></table><hr><h2 id=pigsty企业版>Pigsty企业版</h2><div class="alert alert-primary" role=alert><div class="h4 alert-heading" role=heading>企业版订阅： 起售价格 ¥ 400,000 / 年</div></div><p>Pigsty 企业版订阅包含 Pigsty 专业版订阅提供的全部服务内容，和以下增值服务项：</p><p>Pigsty 企业版订阅提供最为广泛的数据库/操作系统版本支持范围，包括对过保操作系统（EL7, U20, D11），国产操作系统，云厂商操作系统，以及过保数据库大版本（从 PG 13 开始）的延长支持，以及对 Arm64 架构芯片的完整支持。</p><p>Pigsty 企业版订阅提供了信创，国产化解决方案，允许您在 Pigsty 中使用 <a href=http://www.itsec.gov.cn/aqkkcp/cpgg/202312/t20231226_162074.html>PolarDB v2.0</a> （此内核许可需单独采购）内核替换原生 PostgreSQL 内核，以满足国产化合规要求。</p><p>Pigsty 企业版订阅提供了更高标准的企业级咨询服务，承诺 7x24 提供 (&lt; 1h) 的响应时间 SLA，并可提供更多种类的咨询支持：版本升级，性能瓶颈定位，年度架构评估，扩展插件收录等。</p><p>Pigsty 企业版订阅每年自带 <strong>2</strong> 人天支持，以及可选的人天加购选项，用于解决各种更为棘手复杂耗时的问题。</p><p>Pigsty 企业版允许您将 Pigsty 用于 DBaaS 用途，建设云数据库服务对外出售。</p><p>Pigsty 企业版的起步价格为 <strong>¥400,000 / 年</strong>，相当于 <strong>24</strong> vCPU 的 AWS 高可用 RDS 年费，或月薪 <strong>三万元</strong> 的运维专家。</p><table class=full-width><thead><tr><th style=text-align:center>代号</th><th>操作系统发行版版本</th><th style=text-align:center><code>x86_64</code></th><th style=text-align:center>PG17</th><th style=text-align:center>PG16</th><th style=text-align:center>PG15</th><th style=text-align:center>PG14</th><th style=text-align:center>PG13</th><th style=text-align:center>PG12</th><th style=text-align:center><code>Arm64</code></th><th style=text-align:right>PG17</th><th style=text-align:center>PG16</th><th style=text-align:center>PG15</th><th style=text-align:center>PG14</th><th style=text-align:center>PG13</th><th style=text-align:center>PG12</th></tr></thead><tbody><tr><td style=text-align:center><strong>EL9</strong></td><td>RHEL 9 / Rocky9 / Alma9</td><td style=text-align:center><code>el9.x86_64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>el9.arm64</code></td><td style=text-align:right><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>EL8</strong></td><td>RHEL 8 / Rocky8 / Alma8 / Anolis8</td><td style=text-align:center><code>el8.x86_64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>el8.arm64</code></td><td style=text-align:right><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>U24</strong></td><td>Ubuntu 24.04 (<code>noble</code>)</td><td style=text-align:center><code>u24.x86_64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>u24.arm64</code></td><td style=text-align:right><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>U22</strong></td><td>Ubuntu 22.04 (<code>jammy</code>)</td><td style=text-align:center><code>u22.x86_64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>u22.arm64</code></td><td style=text-align:right><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>D12</strong></td><td>Debian 12 (<code>bookworm</code>)</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>d12.arm64</code></td><td style=text-align:right><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-circle-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td></tr><tr><td style=text-align:center><strong>D11</strong></td><td>Debian 11 (<code>bullseye</code>)</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>d11.arm64</code></td><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center><strong>U20</strong></td><td>Ubuntu 20.04 (<code>focal</code>)</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>u20.arm64</code></td><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center><strong>EL7</strong></td><td>RHEL7 / CentOS7 / UOS &mldr;</td><td style=text-align:center><code>d12.x86_64</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><i class="fas fa-check text-primary"></i></td><td style=text-align:center><code>el7.arm64</code></td><td style=text-align:right></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><hr><h2 id=pigsty订阅说明>Pigsty订阅说明</h2><p><strong>功能差异</strong></p><p>Pigsty 专业版/企业版相比开源版本，包含以下额外功能：</p><ul><li><strong>命令行管理工具</strong>： 解锁 Pigsty 命令行工具（ <code>pig</code> ）的完整功能</li><li><strong>系统定制能力</strong>：针对精确的主流Linux操作系统发行版大小版本提供预制的离线安装包</li><li><strong>离线安装能力</strong>：在没有互联网访问的环境中（断网环境）实现 Pigsty 的完整安装</li><li><strong>PG内核多版本</strong>：允许用户自由指定并安装 PostgreSQL 生命周期内大版本的内核（13 - 17）</li><li><strong>内核替换能力</strong>：允许用户使用其他 PostgreSQL 系兼容内核，替换原生 PG 内核，以及离线安装这些内核的能力<ul><li><a href=/docs/pgsql/kernel/babelfish><strong>Babelfish</strong></a>：提供 Microsoft SQL Server 线缆协议级兼容能力</li><li><a href=/docs/pgsql/kernel/ivorysql><strong>IvorySQL</strong></a>：基于 PG 提供 Oracle 语法/类型/存储过程兼容能力</li><li><a href=/docs/pgsql/kernel/polardb><strong>PolarDB PG</strong></a>：提供基于开源的 PolarDB for PostgreSQL 内核支持</li><li><a href=/docs/pgsql/kernel/polardb-o><strong>PolarDB O</strong></a>：信创数据库，满足国产化合规要求的 Oracle 兼容内核（<strong>仅限企业版订阅</strong>）</li></ul></li><li><strong>扩展支持能力</strong>：针对 444 个可用 PG Extension，提供 PG 13-18 在主流操作系统上开箱即用的安装能力。</li><li><strong>完整功能模块</strong>：提供所有功能模块：<ul><li><a href=/docs/pgsql/kernel/supabase><strong>Supabase</strong></a>：可靠地自建生产级开源 Firebase</li><li><a href=/docs/minio><strong>MinIO</strong></a>：企业PB级对象存储规划与自建</li><li><a href=/docs/pilot/duckdb><strong>DuckDB</strong></a>：提供完善的 DuckDB 支持，以及 PostgreSQL + DuckDB OLAP 扩展插件支持</li><li><a href=/docs/pilot/kafka><strong>Kafka</strong></a>：提供高可用的 Kafka 集群部署与监控</li><li>Kubernetes, VictoriaMetrics & VictoriaLogs</li></ul></li><li><strong>国产操作系统支持</strong>：提供国产信创操作系统支持选项（<strong>仅限企业版订阅</strong>）</li><li><strong>国产ARM架构支持</strong>：提供国产 ARM64 架构支持选项（<strong>仅限企业版订阅</strong>）</li><li><strong>中国大陆镜像仓库</strong>：无需科学上网即可顺畅安装，提供境内 YUM/APT 仓库镜像与 DockerHub 访问代理。</li><li><strong>中文界面支持</strong>：监控系统中文版界面支持（Beta）</li></ul><p><strong>付费模式</strong></p><p>Pigsty 订阅采用按年付费的模式，签订合同后，从合同约定日起计算一年的有效期。订阅合同到期前如果继续打款则视为自动续订。
连续订阅有折扣，第一次续签（第二年）享受 95 折优惠，第二次以及后续的续签享受订阅费用 9 折优惠，一次性订阅三年以上整体费用享受 85 折优惠。</p><p>在年度订阅合同终止后，您可以选择不续签订阅服务，Pigsty 将不再提供软件更新，技术支持，咨询服务，但您仍然可以继续使用已经安装版本的 Pigsty 专业版软件。
如果您订阅了 Pigsty 专业服务并选择不续订，在重新订阅时 <strong>无需</strong> 补齐中断期间的订阅费用，但所有折扣与优惠将重置。</p><p>Pigsty 的定价策略确保用户物有所值 —— 您可以立即获得顶尖 DBA 的数据库架构建设方案与管理最佳实践，并由其提供咨询答疑与服务支持兜底；
而付出的成本相比于全职雇佣数据库专家或使用云数据库极具竞争力。以下是市场上 <a href=https://mp.weixin.qq.com/s/E0MtNxPVMQ4PAkIFmispTw>企业级数据库专业服务市场定价参考</a>：</p><ul><li><a href=https://instances.vantage.sh/rds/>AWS RDS for PostgreSQL 高可用版</a>：¥1,160 ～ ¥1,582 / (vCPU·月) ，折合人民币 <strong>14K ~ 19K/年</strong> （<strong>每vCPU</strong>）</li><li><a href=/blog/cloud/rds>阿里云 RDS for PostgreSQL 高可用版</a>：¥270 ～ ¥432 / (vCPU·月)，折合人民币 <strong>3K ~ 5K/年</strong> （<strong>每vCPU</strong>）</li><li><a href=https://www.enterprisedb.com/products/plans-comparison#edbbiganimalcommunity360plan>EDB PostgreSQL 云数据库企业版</a>： $183.3 / (vCPU·月)，折合人民币 <strong>16K/年</strong> （<strong>每vCPU</strong>）</li><li><a href=https://www.enterprisedb.com/products/plans-comparison#edbbiganimalcommunity360plan>富士通企业级 PostgreSQL Kubernetes</a>： $3200 / (Core·年)，折合人民币 <strong>12K/年</strong> （<strong>每vCPU</strong>）</li><li><a href=https://www.oracle.com/a/ocom/docs/corporate/pricing/technology-price-list-070617.pdf>Oracle 年度服务费</a>： (Enterprise $47,500 + Rac $23,000) * 22% 每年，折合人民币 <strong>28K /年</strong> （<strong>每vCPU</strong>）</li></ul><p>体面数据库专业服务的公允价格是 <strong>1 ~ 2 万元 / 年</strong>，计费单位为 <strong>vCPU</strong>，即一个 CPU 线程（1 Intel 核 = 2 vCPU 线程）。
而 Pigsty 提供国内顶尖的 PostgreSQL 专家服务，并采用 <strong>按节点计费</strong> 的模式，在当下常见的高核数服务器节点上，能为用户带来无可比拟的 <strong>降本增效</strong> 体验。</p><hr><h2 id=pigsty专家服务>Pigsty专家服务</h2><p>除了 Pigsty 订阅，Pigsty 还提供按需采购的 Pigsty x PostgreSQL 专家服务 —— 业界顶级数据库专家坐堂问诊。</p><div class="alert alert-primary" role=alert><div class="h4 alert-heading" role=heading>专家顾问：300,000 ¥ / 三年</div><br>在三年内，提供 10 次关于 PostgreSQL 与 Pigsty 的复杂案例处理，以及不限量答疑。</div><div class="alert alert-secondary" role=alert><div class="h4 alert-heading" role=heading>专家支持：30,000 ¥ / 人·天</div><br>业界顶级专家现场支持，可用于架构咨询，故障分析，问题排查，数据库体检，监控解读，迁移评估，教学培训，上下云参谋等连续耗时场景。</div><div class="alert alert-success" role=alert><div class="h4 alert-heading" role=heading>专家咨询：3000 ¥ / 例</div><br>咨询任何您想要了解的问题，关于 Pigsty， PostgreSQL，数据库，云计算，AI……
数据库老司机，云计算泥石流与您分享行业顶级洞察、认知与研判。</div><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>挂专家号：300 ¥ / 问题</div><br>给出一个关于 PostgreSQL / Pigsty / 数据库相关的问题的快速诊断意见与答复，不超过 5 分钟。</div><h3 id=服务主体>服务主体</h3><p>Pigsty 目前由作者 <strong>冯若航</strong> 独资运营维护，商业主体为：</p><ul><li>海南诸夏云数据有限公司 / 91460000MAE6L87B94</li><li>海口龙华辟技数据中心 / 92460000MAG0XJ569B</li><li>海口龙华越航科技中心 / 92460000MACCYGBQ1N</li></ul><p>PIGSTY® 与 PGSTY® 为海口龙华越航科技中心的注册商标。</p><p>商务咨询请发送邮件至 <a href=mailto:rh@vonng.com><strong>rh@vonng.com</strong></a> 。中国大陆地区用户欢迎添加微信号 <code>RuohangFeng</code>。</p><blockquote><p>Pigsty 是奇绩创坛 S22 被投项目，原主体 <strong>磐吉云数（北京）科技有限责任公司</strong> 已经清算剥离 Pigsty 业务，与 Pigsty 无关。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-fb47a447d16b1ba29ba890608c0f1308>11 - 常见问题</h1><div class=lead>解答关于 Pigsty 项目本身的常见问题。</div><hr><h3 id=pigsty-是什么不是什么>Pigsty 是什么，不是什么？</h3><p>Pigsty 是一个 PostgreSQL 数据库发行版，本地优先的开源 RDS 云数据库解决方案。
Pigsty 不是数据库管理系统（DBMS），而是管理 DBMS 的工具，发行版，解决方案，与最佳实践。</p><p>类比：数据库是车，那么 DBA 是司机，RDS 是出租车服务，Pigsty 则是自动驾驶软件。</p><hr><h3 id=pigsty-解决什么问题>Pigsty 解决什么问题？</h3><p><strong>用好数据库的能力</strong> 极为稀缺：要么高薪聘请数据库专家自建（雇司机），或从云厂商以天价租赁 RDS（打车），但现在你有新的选项：Pigsty（自动驾驶）。
Pigsty 帮用户用好数据库：让用户在没有 DBA 的情况下，以不到 RDS 1 / 10 的成本，自建质量效率更优的本地云数据库服务！</p><hr><h3 id=pigsty-的目标用户是谁>Pigsty 的目标用户是谁？</h3><p>Pigsty 有两类典型目标用户，基本盘是 <strong>中大型公司</strong> 超大规模自建企业级/生产级 PostgreSQL RDS / DBaaS 服务。
Pigsty 通过极致的可定制性，可以实现最苛刻场景的数据库管理需求，并提供企业级的支持与服务保障。</p><p>与此同时，Pigsty 也针对个人开发者，缺乏 DBA 中小企业以及开源社区提供 “开箱即用” 的 PG RDS 自建方案。</p><hr><h3 id=pigsty-为什么能帮您用好数据库>Pigsty 为什么能帮您用好数据库？</h3><p>Pigsty 沉淀了顶尖专家在最复杂，最大规模的甲方 PostgreSQL 场景中打磨得到的经验与最佳实践，产品化为可复制的软件：
一次性解决扩展安装，高可用，链接池，监控，备份恢复，参数优化，IaC 批量管理，一键安装，自动化运维等诸多问题。提前规避诸多陷阱，避免重复踩坑。</p><hr><h3 id=pigsty-为何比-rds-好用>Pigsty 为何比 RDS 好用？</h3><p>Pigsty 提供远超 RDS 的特性集与基础设施支持，包括 444 扩展插件与 8+ 内核支持。
Pigsty 提供 PG 生态中独一无二的专业级监控系统，与久经复杂场景打磨考验的架构最佳实践，简单易用。</p><p>且用探探，苹果，阿里等顶级甲方场景打磨而成，用激情与热爱持续浇灌，深度与成熟度绝非 RDS 大锅饭可比。</p><hr><h3 id=pigsty-为何比-rds-省钱>Pigsty 为何比 RDS 省钱？</h3><p>Pigsty 允许您使用 10 ¥/核·月的纯硬件资源，运行 400¥-1400¥/核·月的 RDS 云数据库，并省去 DBA 的工资。通常，成规模的 Pigsty 部署总拥有成本（TCO）能比 RDS 低 90% 以上。</p><p>Pigsty 能够同时降低软件许可/服务/人力的开销，自建无需加人，让您将成本花在刀刃上。</p><hr><h3 id=pigsty-对研发有什么帮助>Pigsty 对研发有什么帮助？</h3><p>Pigsty 整合了 PG 生态最全的扩展（444），提供了 All in PG 解决方案：单一组件替代 Redis, Kafka, MySQL, ES, 向量数据库, OLAP / 大数据分析等专用组件。</p><p>极大提高研发效能与敏捷性的同时降低复杂度成本，而且研发能在 Pigsty 的加持下实现自助管理，自主 DevOps，无需 DBA。</p><hr><h3 id=pigsty-对运维有什么帮助>Pigsty 对运维有什么帮助？</h3><p>Pigsty 故障自愈的高可用架构确保硬件故障无需当场处理，让运维与 DBA 睡个好觉；监控助力问题分析与性能优化；IaC 赋能超大规模集群自动化管理。</p><p>运维在 Pigsty 加持下能兼职 DBA ，而 DBA 则可以跳过系统建设阶段，节省大量工时并专注于高价值工作，或喝茶看报，学习PG。</p><hr><h3 id=pigsty-的作者是谁>Pigsty 的作者是谁？</h3><p>Pigsty 主体由冯若航一人开发，这是一位专注于 PostgreSQL 领域 10 年的开源贡献者，数据库专家与布道师，
曾任职于阿里，探探，苹果，全栈专家。现为一人公司创始人，提供专业咨询服务。</p><p>同时他也是技术 KOL，微信数据库个人公众号榜首 《非法加冯》 的主理人，全网粉丝六万+。</p><hr><h3 id=pigsty-的生态位与影响力如何>Pigsty 的生态位与影响力如何？</h3><p>Pigsty 全球 PostgreSQL 生态中最有影响力的中国开源项目，共有约十万用户，一半来自海外。
Pigsty 也是 PostgreSQL 生态最活跃的开源项目之一，目前在扩展分发与监控系统上占据碾压性优势。</p><p><a href=https://pgext.cloud><strong>PGEXT.Cloud</strong></a> 是由 Pigsty 维护的 PostgreSQL 扩展仓库，拥有全球最多的 PostgreSQL 扩展分发量。
目前已经成为多家国际 PostgreSQL 厂商的软件供应链上游。</p><p>Pigsty 目前是 PostgreSQL 生态的主要发行版之一，也是云厂商 RDS 的挑战者，目前已经广泛应用于军工，政企，医疗，互联网，金融，制造业等各个行业。</p><hr><h3 id=pigsty-适合什么规模的客户>Pigsty 适合什么规模的客户？</h3><p>Pigsty 源于超大规模 PostgreSQL 自动化管理的需求，但已针对易用性进行深度优化，缺乏专业 DBA 能力的个人开发者与中小型企业也可以轻松上手使用。</p><p>最大规模部署为 25K vCPU，450万QPS，六年+，最小规模部署可完整运行于 1c1g 虚拟机上作为 Demo / Devbox 使用。</p><hr><h3 id=pigsty-提供哪些能力>Pigsty 提供哪些能力？</h3><p>Pigsty 专注于整合 PostgreSQL 生态，提供 PostgreSQL 的最佳实践，但同时也支持一系列与 PostgreSQL 配合良好的开源软件。例如：</p><ul><li>Etcd, Redis, MinIO, DuckDB, Prometheus</li><li>FerretDB, Babelfish, IvorySQL, PolarDB, OrioleDB</li><li>OpenHalo, Supabase, Greenplum, Dify, Odoo, &mldr;</li></ul><hr><h3 id=pigsty-适用于哪些场景>Pigsty 适用于哪些场景？</h3><ul><li>运行大规模 PostgreSQL 集群用于业务</li><li>自建 RDS，对象存储，缓存，数仓，Supabase, …</li><li>自建 Odoo，Dify，Wiki，GitLab 等企业级应用</li><li>运行监控基础设施，监控现有数据库与主机</li><li>同时组合使用多种 PG 扩展插件</li><li>大屏开发与交互式数据应用 Demo，数据可视化，Web 建站</li></ul><hr><h3 id=pigsty-开源免费吗>Pigsty 开源免费吗？</h3><p>Pigsty 是 100% 的开源软件 + 自由软件，在遵循开源许可证的前提下，您可以将其免费地，自由的用于各种商业目的。</p><p>我们珍视软件自由，对于非 DBaaS / OEM 用例，我们执行更为宽松的等效 Apache 2.0 许可证。请参阅许可证以获取更多详细信息。</p><hr><h3 id=pigsty-提供商业支持吗>Pigsty 提供商业支持吗？</h3><p>Pigsty 软件本身开源免费，并提供丰俭由人的商业订阅，为 Pigsty & PostgreSQL 提供质保。
订阅提供更宽广的 OS/PG/芯片架构支持范围，以及专家咨询与支持。
Pigsty 商业订阅交付业界顶尖的管理/技术经验/解决方案，
帮助您节省宝贵的时间，替您扛雷，并为疑难杂症兜底。</p><hr><h3 id=pigsty-支持国产信创吗>Pigsty 支持国产信创吗？</h3><p>Pigsty 软件本身不属于数据库，不受信创名录限制，且已有多个部队用例。但 Pigsty 开源版不提供任何形式的信创支持。
商业版订阅提供与阿里云合作的国产信创解决方案，支持使用具有信创资质的 PolarDB-O（需单独采购）作为 RDS 内核，能够运行于信创操作系统/芯片环境。</p><hr><h3 id=pigsty-可以换-logo-贴牌为自己的产品吗>Pigsty 可以换 Logo 贴牌为自己的产品吗？</h3><p>再分发 Pigsty 时，您必须保留原作品中的版权声明、专利声明、商标声明和归属声明，
并且需要在修改的文件中附上显著的变更说明，同时保留 LICENSE 文件的内容。
在此前提下，您可以更换 PIGSTY 的 Logo 与商标，但不得宣传为 “自己原创的作品”。
我们在企业版本中提供对 OEM 与贴牌的商业授权支持。</p><hr><h3 id=pigsty-的服务主体>Pigsty 的服务主体</h3><p>Pigsty 是奇绩创坛 S22 被投项目，原主体 <strong>磐吉云数（北京）科技有限责任公司</strong> 已经清算剥离 Pigsty 业务，与 Pigsty 无关。</p><p>Pigsty 目前由作者冯若航个人独资运营维护，商业主体为：</p><ul><li>海南诸夏云数据有限公司 / 91460000MAE6L87B94</li><li>海口龙华辟技数据中心 / 92460000MAG0XJ569B</li><li>海口龙华越航科技中心 / 92460000MACCYGBQ1N</li></ul><p>PIGSTY® 与 PGSTY® 为海口龙华越航科技中心的注册商标。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-06ea9cd5145a15d31b177fb89b09c6aa>12 - 发布注记</h1><div class=lead>Pigsty 历史版本发布说明</div><p>Pigsty 当前的最新稳定版本为 <a href=#v410><strong>v4.1.0</strong></a>。</p><table class=full-width><thead><tr><th style=text-align:center>版本</th><th style=text-align:center>发布日期</th><th>摘要</th><th style=text-align:center>发布页面</th></tr></thead><tbody><tr><td style=text-align:center><a href=#v410>v4.1.0</a></td><td style=text-align:center>2026-02-12</td><td>大小版本更新支持，Agent-Native CLI，默认防火墙安全策略收紧</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v4.1.0>v4.1.0</a></td></tr><tr><td style=text-align:center><a href=#v400>v4.0.0</a></td><td style=text-align:center>2026-01-28</td><td>Victoria 可观测性，安全加固，JUICE/VIBE 模块，容器支持，Apache-2.0</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v4.0.0>v4.0.0</a></td></tr><tr><td style=text-align:center><a href=#v370>v3.7.0</a></td><td style=text-align:center>2025-12-02</td><td>PG18 成为默认，437 个扩展，EL10 与 Debian13 支持，PGEXT.CLOUD</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.7.0>v3.7.0</a></td></tr><tr><td style=text-align:center><a href=#v361>v3.6.1</a></td><td style=text-align:center>2025-08-15</td><td>例行 PG 小版本更新，PGDG 中国区域镜像，EL9，D13 存根</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.6.1>v3.6.1</a></td></tr><tr><td style=text-align:center><a href=#v360>v3.6.0</a></td><td style=text-align:center>2025-07-30</td><td>pgactive，MinIO / ETCD 改进，安装简化，配置梳理</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.6.0>v3.6.0</a></td></tr><tr><td style=text-align:center><a href=#v350>v3.5.0</a></td><td style=text-align:center>2025-06-16</td><td>PG18 beta，421 扩展，监控升级，代码重构</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.5.0>v3.5.0</a></td></tr><tr><td style=text-align:center><a href=#v341>v3.4.1</a></td><td style=text-align:center>2025-04-05</td><td>OpenHalo & OrioleDB，MySQL兼容，pgAdmin改进</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.1>v3.4.1</a></td></tr><tr><td style=text-align:center><a href=#v340>v3.4.0</a></td><td style=text-align:center>2025-03-30</td><td>备份改进，自动证书，AGE，Ivory 全平台，本地化，架构与参数改进</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.0>v3.4.0</a></td></tr><tr><td style=text-align:center><a href=#v330>v3.3.0</a></td><td style=text-align:center>2025-02-24</td><td>404 扩展，扩展目录，App 剧本，Nginx 定制，DocumentDB 支持</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.3.0>v3.3.0</a></td></tr><tr><td style=text-align:center><a href=#v322>v3.2.2</a></td><td style=text-align:center>2025-01-23</td><td>390扩展，Omnigres支持，Mooncake，Citus13与PG17支持</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.2>v3.2.2</a></td></tr><tr><td style=text-align:center><a href=#v321>v3.2.1</a></td><td style=text-align:center>2025-01-12</td><td>350扩展，Ivory4，Citus强化，Odoo模板</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.1>v3.2.1</a></td></tr><tr><td style=text-align:center><a href=#v320>v3.2.0</a></td><td style=text-align:center>2024-12-24</td><td>扩展管理 CLI ，Grafana 强化，ARM64 扩展补完</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.2.0>v3.2.0</a></td></tr><tr><td style=text-align:center><a href=#v310>v3.1.0</a></td><td style=text-align:center>2024-11-24</td><td>PG 17 升默认大版本，配置简化，Ubuntu24与ARM 支持，Supabase，MinIO 改进</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.1.0>v3.1.0</a></td></tr><tr><td style=text-align:center><a href=#v304>v3.0.4</a></td><td style=text-align:center>2024-10-30</td><td>PG 17 扩展，OLAP 全家桶，pg_duckdb</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.4>v3.0.4</a></td></tr><tr><td style=text-align:center><a href=#v303>v3.0.3</a></td><td style=text-align:center>2024-09-27</td><td>PostgreSQL 17，Etcd 运维优化，IvorySQL 3.4，PostGIS 3.5</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.3>v3.0.3</a></td></tr><tr><td style=text-align:center><a href=#v302>v3.0.2</a></td><td style=text-align:center>2024-09-07</td><td>精简安装模式，PolarDB 15支持，监控视图更新</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.2>v3.0.2</a></td></tr><tr><td style=text-align:center><a href=#v301>v3.0.1</a></td><td style=text-align:center>2024-08-31</td><td>例行问题修复，Patroni 4支持，Oracle兼容性改进</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.1>v3.0.1</a></td></tr><tr><td style=text-align:center><a href=#v300>v3.0.0</a></td><td style=text-align:center>2024-08-25</td><td>333个扩展插件，可插拔内核，MSSQL，Oracle，PolarDB 兼容性</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v3.0.0>v3.0.0</a></td></tr><tr><td style=text-align:center><a href=#v270>v2.7.0</a></td><td style=text-align:center>2024-05-20</td><td>扩展大爆炸，新增20+强力扩展插件，与多款Docker应用</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.7.0>v2.7.0</a></td></tr><tr><td style=text-align:center><a href=#v260>v2.6.0</a></td><td style=text-align:center>2024-02-28</td><td>PG 16 作为默认大版本，引入 ParadeDB 与 DuckDB 等扩展</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.6.0>v2.6.0</a></td></tr><tr><td style=text-align:center><a href=#v251>v2.5.1</a></td><td style=text-align:center>2023-12-01</td><td>例行小版本更新，PG16重要扩展支持</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.5.1>v2.5.1</a></td></tr><tr><td style=text-align:center><a href=#v250>v2.5.0</a></td><td style=text-align:center>2023-09-24</td><td>Ubuntu/Debian支持：bullseye, bookworm, jammy, focal</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.5.0>v2.5.0</a></td></tr><tr><td style=text-align:center><a href=#v241>v2.4.1</a></td><td style=text-align:center>2023-09-24</td><td>Supabase/PostgresML支持与各种新扩展：graphql, jwt, pg_net, vault</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.4.1>v2.4.1</a></td></tr><tr><td style=text-align:center><a href=#v240>v2.4.0</a></td><td style=text-align:center>2023-09-14</td><td>PG16，监控RDS，服务咨询支持，新扩展：中文分词全文检索/图/HTTP/嵌入等</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.4.0>v2.4.0</a></td></tr><tr><td style=text-align:center><a href=#v231>v2.3.1</a></td><td style=text-align:center>2023-09-01</td><td>带HNSW的PGVector，PG 16 RC1, 文档翻新，中文文档，例行问题修复</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.3.1>v2.3.1</a></td></tr><tr><td style=text-align:center><a href=#v230>v2.3.0</a></td><td style=text-align:center>2023-08-20</td><td>主机VIP, ferretdb, nocodb, MySQL存根, CVE修复</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.3.0>v2.3.0</a></td></tr><tr><td style=text-align:center><a href=#v220>v2.2.0</a></td><td style=text-align:center>2023-08-04</td><td>仪表盘 & 置备重做，UOS 兼容性</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.2.0>v2.2.0</a></td></tr><tr><td style=text-align:center><a href=#v210>v2.1.0</a></td><td style=text-align:center>2023-06-10</td><td>支持 PostgreSQL 12 ~ 16beta</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.1.0>v2.1.0</a></td></tr><tr><td style=text-align:center><a href=#v202>v2.0.2</a></td><td style=text-align:center>2023-03-31</td><td>新增 pgvector 支持，修复 MinIO CVE</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.2>v2.0.2</a></td></tr><tr><td style=text-align:center><a href=#v201>v2.0.1</a></td><td style=text-align:center>2023-03-21</td><td>v2 错误修复，安全增强，升级 Grafana 版本</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.1>v2.0.1</a></td></tr><tr><td style=text-align:center><a href=#v200>v2.0.0</a></td><td style=text-align:center>2023-02-28</td><td>架构大升级，兼容性、安全性、可维护性显著增强</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v2.0.0>v2.0.0</a></td></tr><tr><td style=text-align:center><a href=#v151>v1.5.1</a></td><td style=text-align:center>2022-06-18</td><td>Grafana 安全性修复</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.5.1>v1.5.1</a></td></tr><tr><td style=text-align:center><a href=#v150>v1.5.0</a></td><td style=text-align:center>2022-05-31</td><td>Docker 应用程序支持</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.5.0>v1.5.0</a></td></tr><tr><td style=text-align:center><a href=#v141>v1.4.1</a></td><td style=text-align:center>2022-04-20</td><td>错误修复 & 英文文档完整翻译</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.4.1>v1.4.1</a></td></tr><tr><td style=text-align:center><a href=#v140>v1.4.0</a></td><td style=text-align:center>2022-03-31</td><td>MatrixDB 支持，分离 INFRA/NODES/PGSQL/REDIS模块</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.4.0>v1.4.0</a></td></tr><tr><td style=text-align:center><a href=#v130>v1.3.0</a></td><td style=text-align:center>2021-11-30</td><td>PGCAT 重整 & PGSQL 增强 & Redis Beta支持</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.3.0>v1.3.0</a></td></tr><tr><td style=text-align:center><a href=#v120>v1.2.0</a></td><td style=text-align:center>2021-11-03</td><td>默认 PGSQL 版本升级至 14</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.2.0>v1.2.0</a></td></tr><tr><td style=text-align:center><a href=#v110>v1.1.0</a></td><td style=text-align:center>2021-10-12</td><td>主页, JupyterLab, PGWEB, Pev2 & pgbadger</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.1.0>v1.1.0</a></td></tr><tr><td style=text-align:center><a href=#v100>v1.0.0</a></td><td style=text-align:center>2021-07-26</td><td>v1 正式版, 监控系统重整</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v1.0.0>v1.0.0</a></td></tr><tr><td style=text-align:center><a href=#v090>v0.9.0</a></td><td style=text-align:center>2021-04-04</td><td>Pigsty 图形界面, 命令行界面, 日志集成</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.9.0>v0.9.0</a></td></tr><tr><td style=text-align:center><a href=#v080>v0.8.0</a></td><td style=text-align:center>2021-03-28</td><td>服务置备，定制对外暴露的数据库服务</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.8.0>v0.8.0</a></td></tr><tr><td style=text-align:center><a href=#v070>v0.7.0</a></td><td style=text-align:center>2021-03-01</td><td>仅监控部署，监控现有 PostgreSQL 实例</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.7.0>v0.7.0</a></td></tr><tr><td style=text-align:center><a href=#v060>v0.6.0</a></td><td style=text-align:center>2021-02-19</td><td>架构增强，将PG与Consul解耦</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.6.0>v0.6.0</a></td></tr><tr><td style=text-align:center><a href=#v050>v0.5.0</a></td><td style=text-align:center>2021-01-07</td><td>支持在配置中定义业务数据库/用户</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.5.0>v0.5.0</a></td></tr><tr><td style=text-align:center><a href=#v040>v0.4.0</a></td><td style=text-align:center>2020-12-14</td><td>支持 PostgreSQL 13，添加官方文档</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.4.0>v0.4.0</a></td></tr><tr><td style=text-align:center><a href=#v030>v0.3.0</a></td><td style=text-align:center>2020-10-22</td><td>虚拟机置备方案正式定稿</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/releases/tag/v0.3.0>v0.3.0</a></td></tr><tr><td style=text-align:center>v0.2.0</td><td style=text-align:center>2020-07-10</td><td>PG监控系统第六版正式发布</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/385e33a62a19817e8ba19997260e6b77d99fe2ba>v0.2.0</a></td></tr><tr><td style=text-align:center>v0.1.0</td><td style=text-align:center>2020-06-20</td><td>在生产仿真测试环境中验证通过</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/1cf2ea5ee91db071de00ec805032928ff582453b>v0.1.0</a></td></tr><tr><td style=text-align:center>v0.0.5</td><td style=text-align:center>2020-08-19</td><td>离线安装模式：无需互联网访问即可交付</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/0fe9e829b298fe5e56307de3f78c95071de28245>v0.0.5</a></td></tr><tr><td style=text-align:center>v0.0.4</td><td style=text-align:center>2020-07-27</td><td>将 Ansible 剧本重构为 Role</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/90b44259818d2c71e37df5250fe8ed1078a883d0>v0.0.4</a></td></tr><tr><td style=text-align:center>v0.0.3</td><td style=text-align:center>2020-06-22</td><td>接口设计改进</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/4c5c68ccd57bc32a9e9c98aa3f264aa19f45c7ee>v0.0.3</a></td></tr><tr><td style=text-align:center>v0.0.2</td><td style=text-align:center>2020-04-30</td><td>首次提交</td><td style=text-align:center><a href=https://github.com/pgsty/pigsty/commit/dd646775624ddb33aef7884f4f030682bdc371f8>v0.0.2</a></td></tr><tr><td style=text-align:center>v0.0.1</td><td style=text-align:center>2019-05-15</td><td>概念原型</td><td style=text-align:center><a href=https://github.com/Vonng/pg/commit/fa2ade31f8e81093eeba9d966c20120054f0646b>v0.0.1</a></td></tr></tbody></table><hr><h2 id=v410>v4.1.0</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v4.1.0
</span></span></code></pre></div><p><strong>72 个提交</strong>，252 文件变更，+5,744 / -5,015 行（<code>v4.0.0..v4.1.0</code>，2026-02-02 ~ 2026-02-13）</p><p><strong>亮点特性</strong></p><ul><li>新增 7 个扩展，总计 <strong>451</strong> 个扩展支持。</li><li><code>pig</code> 从传统脚本接口升级为 <strong>Agent-Native CLI</strong>（<code>1.0.0 -> 1.1.0</code>），支持主动暴露上下文并提供 JSON/YAML 输出。</li><li><code>pig</code> 新增 PostgreSQL / OS <strong>大小版本更新</strong>统一能力（覆盖 major/minor 升级流程）。</li><li><code>pg_exporter</code> 升级到 <strong>v1.2.0</strong>（<code>1.1.2 -> 1.2.0</code>），并修复 PG17/18 指标链路与单位换算。</li><li>防火墙默认安全策略更新：<code>node_firewall_mode</code> 默认改为 <code>zone</code>，<code>node_firewall_public_port</code> 默认从 <code>[22,80,443,5432]</code> 收敛为 <code>[22,80,443]</code>。</li><li>PostgreSQL 小版本更新：18.2、17.8、16.12、15.16、14.21。</li><li>EL 默认小版本更新到 <code>EL 9.7 / EL 10.1</code>，Debian 默认小版本更新到 <code>12.13 / 13.3</code>。</li><li>集中修复 PGSQL / PGCAT Grafana 看板可用性：<code>$dsn</code> 动态数据源、schema 级跳转、Age 指标、链接映射与语义一致性。</li><li>新增 Mattermost 一键应用模板，支持数据库、目录、门户与可选 PGFS/JuiceFS 方案。</li><li>重构 <code>infra-rm</code> 卸载逻辑，新增 <code>deregister</code> 分段清理能力，可回收 Victoria target、Grafana datasource、Vector 日志配置。</li><li>优化 PostgreSQL 默认 autovacuum 阈值，减少小表高频 vacuum/analyze。</li><li>修复 FD 上限链路：新增 <code>fs.nr_open=8M</code> 并统一 <code>LimitNOFILE=8M</code>，避免 systemd/setrlimit 导致服务启动失败。</li><li>调整 Vibe 默认体验：Jupyter 默认关闭，Claude Code 改由 npm 包统一安装管理。</li></ul><p><strong>版本更新</strong></p><ul><li>Pigsty 版本：<code>v4.0.0 -> v4.1.0</code></li><li><code>pig</code> CLI：<code>1.0.0 -> 1.1.0</code>（Agent-Native + 大小版本更新支持）</li><li><code>pg_exporter</code>：<code>1.1.2 -> 1.2.0</code></li><li>默认 EL 小版本：<code>9.6/10.0 -> 9.7/10.1</code></li><li>默认 Debian 小版本：<code>12.12/13.1 -> 12.13/13.3</code></li></ul><p><strong>扩展更新</strong></p><ul><li><a href=/docs/repo/pgsql/rpm/#2026-02-12>RPM Changelog 2026-02-12</a></li><li><a href=/docs/repo/pgsql/deb/#2026-02-12>DEB Changelog 2026-02-12</a></li><li>timescaledb <code>2.24.0 -> 2.25.0</code></li><li>pg_search <code>0.21.4 -> 0.21.7</code></li><li>pgmq <code>1.9.0 -> 1.10.0</code></li><li>pg_textsearch <code>0.4.0 -> 0.5.0</code></li><li>pljs <code>1.0.4 -> 1.0.5</code></li><li>pg_track_optimizer <code>0.9.1</code>（新增）</li><li>nominatim_fdw <code>1.1.0</code>（新增）</li><li>pg_utl_smtp <code>1.0.0</code>（新增）</li><li>pg_strict <code>1.0.2</code>（新增）</li><li>pgmb <code>1.0.0</code>（新增）</li><li>pg_pwhash（新增支持）</li><li>informix_fdw（新增支持）</li></ul><p><strong>INFRA 组件版本</strong></p><p><a href=/docs/repo/infra/log/#2026-02-12>Infra Changelog 2026-02-12</a></p><table><thead><tr><th>软件包</th><th>版本</th><th>软件包</th><th>版本</th></tr></thead><tbody><tr><td>victoria-metrics</td><td>1.135.0</td><td>victoria-logs</td><td>1.45.0</td></tr><tr><td>vector</td><td>0.53.0</td><td>grafana</td><td>12.3.2</td></tr><tr><td>alertmanager</td><td>0.31.1</td><td>etcd</td><td>3.6.7</td></tr><tr><td>duckdb</td><td>1.4.4</td><td>pg_exporter</td><td>1.2.0</td></tr><tr><td>pig</td><td>1.1.0</td><td>claude</td><td>2.1.37</td></tr><tr><td>opencode</td><td>1.1.59</td><td>uv</td><td>0.10.0</td></tr><tr><td>code-server</td><td>4.108.2</td><td>caddy</td><td>2.10.2</td></tr><tr><td>hugo</td><td>0.155.2</td><td>cloudflared</td><td>2026.2.0</td></tr><tr><td>headscale</td><td>0.28.0</td><td></td><td></td></tr></tbody></table><p><strong>API变化</strong></p><ul><li><code>io_method</code> / <code>io_workers</code> 模板生效条件从 <code>pg_version >= 17</code> 更正为 <code>pg_version >= 18</code>。</li><li><code>idle_replication_slot_timeout</code> / <code>initdb --no-data-checksums</code> 的 PG18 守卫条件修正。</li><li><code>maintenance_io_concurrency</code> 生效范围放宽至 <code>PG13+</code>。</li><li><code>autovacuum_vacuum_threshold</code>：<code>oltp/crit/tiny</code> 从 50 提升到 500，<code>olap</code> 提升到 1000。</li><li><code>autovacuum_analyze_threshold</code>：<code>oltp/crit/tiny</code> 从 50 提升到 250，<code>olap</code> 提升到 500。</li><li><code>checkpoint_completion_target</code> 默认从 <code>0.90</code> 提升到 <code>0.95</code>。</li><li>Node tuned 模板新增 <code>fs.nr_open=8388608</code>，并统一 <code>fs.file-max / fs.nr_open / LimitNOFILE</code> 层级关系。</li><li>postgres、patroni、minio 的 systemd <code>LimitNOFILE</code> 从 <code>16777216</code> 调整为 <code>8388608</code>。</li><li><code>node_sysctl_params</code> 默认加入 <code>fs.nr_open: 8388608</code>。</li><li><code>node_firewall_mode</code> 默认值从 <code>none</code> 调整为 <code>zone</code>：默认启用防火墙，内网信任，公网仅开放 <code>node_firewall_public_port</code>；如需完全自管防火墙请设为 <code>none</code>。</li><li><code>node_firewall_public_port</code> 默认值从 <code>[22,80,443,5432]</code> 调整为 <code>[22,80,443]</code>，数据库端口 <code>5432</code> 需要按需显式添加。注意防火墙规则为“只增不删”，存量节点若已放行 <code>5432</code> 需手工移除；单机体验模板（如 <code>meta</code> / <code>vibe</code>）会显式覆盖并保留 <code>5432</code> 以便远程使用。</li><li><code>bin/validate</code> 新增 <code>pg_databases[*].parameters</code> 与 <code>pg_hba_rules[*].order</code> 校验支持，并修复 HBA 错误未正确返回失败的问题。</li><li><code>infra-rm.yml</code> 新增 <code>deregister</code>、<code>config</code>、<code>env</code> 等分段标签。</li><li>Vibe 默认 <code>jupyter_enabled=false</code>，<code>npm_packages</code> 默认加入 <code>@anthropic-ai/claude-code</code>、<code>happy-coder</code>，并新增 <code>CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1</code>。</li><li>PgBouncer 参数别名收敛：<code>pool_size_reserve -> pool_reserve</code>，<code>pool_max_db_conn -> pool_connlimit</code>。</li></ul><p><strong>兼容性修复（去重归并）</strong></p><ul><li>注：同一问题的重复回补（反复引入后再次修复）仅计一次，以下按问题域归并。</li><li>修复 Redis <code>replicaof</code> 判空逻辑与 systemd 停止行为。</li><li>修复 <code>pg_migration</code> 脚本 schema/table/sequence 全限定、标识符 quoting 与日志格式字符串安全问题。</li><li>修复 pgsql role handler 重启对象与变量使用错误。</li><li>修复 blackbox 配置文件名清理项与 pgAdmin pgpass 文件格式。</li><li><code>pg_exporter</code> 启动改为非阻断，避免 exporter 启动失败拖慢主流程。</li><li>VIP 地址解析逻辑简化，未显式 CIDR 时默认掩码 <code>24</code>。</li><li>MinIO 健康检查重试从 <code>3</code> 提升到 <code>5</code>。</li><li>节点主机名设置改用 hostname 模块，替代 shell 调用。</li><li>修复 <code>app/electric</code> 与 <code>app/pg_exporter</code> 的 <code>.env</code> 格式为标准 <code>KEY=VALUE</code>。</li><li>修复 <code>pigsty.yml</code> 的 <code>pg_crontab</code> 语法错误。</li><li>更新 ETCD 文档，明确默认 TLS 与可选 mTLS 的语义差异。</li><li>修复 <code>repo-add</code> 参数传递、Debian 中国镜像组件兼容性、<code>bin/psql.py</code> 的 Python3 兼容性。</li><li>加固 redis exporter 凭据文件权限，减少敏感信息暴露风险。</li><li><code>pgsql-user.yml</code> 隐藏用户凭据日志输出并对敏感步骤启用 <code>no_log</code>。</li><li>修复 <code>pg_monitor</code> 注册 Victoria target 的 gate 条件。</li><li><code>pg_remove</code> 备份清理改为集群级目录，避免误删其他集群备份。</li></ul><p><strong>提交清单（v4.0.0..v4.1.0，共 72，2026-02-02 ~ 2026-02-13）</strong></p><pre tabindex=0><code>7410de401 v4.1.0 release
fa31213ce conf(node): default firewall to zone with single-node 5432 override
bb8382c58 update default extension list to 451
770d01959 hide user credential in pgsql-user playbook
7219a896c pg_monitor: fix victoria registration gate conditions
084c98432 remove one cluster in backup dir during pg_remove
7005617f1 pgsql: drop legacy pgbouncer pool parameter aliases
f8165a886 docs(roles): fix typos and align juice role documentation
06a589218 chore(meta): normalize platform versions for current lint schema
e0a208248 fix(roles): harden redis exporter file permissions
fd0469881 terraform/vagrant: parameterize aliyun region/zone, fix vagrant scripts
74c59aabe grafana: fix dashboard links, descriptions, and overrides
443e58724 conf: clean legacy params and fix template references
536c4b39d adjust grafana dashboard dead links
f3b9866ce grafana(pgsql): fix panel typos and title consistency
bcb69be11 grafana(pgsql): fix drilldown links and variable mappings
1ce4374a1 grafana: fill pglog panel titles and normalize wording
2d127f9f4 grafana: fix minio traffic metrics and pigsty dashboard links
9d3ca0118 grafana: align victoria instance dashboards with query scope
55bc61622 grafana: fix infra dashboard copy, links, and table semantics
607b75535 grafana(node): fix panel drilldown links and clean dashboard metadata
1321de532 grafana(redis): fix dashboard links and blocked-clients panel semantics
91e0c8437 fix(grafana): correct Redis alert drill-down dashboard links
0fde78c02 fix(tooling): improve Python3 compatibility and enforce vagrant scale lower bound
fa3454a52 fix(bootstrap): use Debian-compatible components for CN apt mirror
36c95c749 fix(cli): restore repo-add execution and HBA validation failure propagation
797385929 add macbook local vagrant image override
f9c928e32 fix(grafana): restore reverted dashboard bugfixes
c11af8b6a Bump version to v4.1.0
307a236ba update extension list
f17024807 override el9/u24 vagrant box for convient testing
c2ada1283 terraform: bump Aliyun Debian images to 12.13/13.3
25bd8210f fix(node): add daemon_reload to systemd tasks for keepalived, chronyd, and cron
6f2576fd0 fix(node): set default fs.nr_open via node_sysctl_params
43a71245e add pg_bgwriter_buffers_backend for pg 17-
da832a47b fix(monitor): keep checkpointer metrics for checkpoint stats
90434ca8a fix(monitor): add pg_bgwriter fallback for checkpointer metrics
e2d75e787 fix(monitor): use pg_checkpointer metrics for checkpoint stats
a0b7474f8 fix grafana dashboard metrics and lengend
27ddacbc6 vagrant: refresh box selector and OS shortcuts
26e108788 fix(monitor): correct unit for time metrics scaled by pg_exporter
ee90044b5 fix(pgsql): correct min_parallel scan size params in oltp/crit templates
d439464b2 pgsql: fix pg_version guards for PG18-only settings
26320f120 docs: recommend RockyLinux 10.1
1e9b9f33a terraform: bump Aliyun Rocky images to 9.7/10.1
d6e9c7122 monitor: optimize table/index bloat estimators
42d45d32e fix(grafana): align panel semantics across node/infra/redis
3972d2c45 fix(grafana/pgsql): align dashboard semantics for query monitoring
cb52375ac bump checkpoint_completion_target from 0.90 to 0.95
13115a95d fix legend in pgsql-persist checkpoint panel
102cd2edb fix(pg_migration): make template logging format-safe
c402f0e6d fix: correct io_method/io_workers version guard from PG17 to PG18
3bf676546 vibe: disable jupyter by default and install claude-code via npm_packages
613c4efa9 fix: set fs.nr_open in tuned profiles and reduce LimitNOFILE to 8M
07e499d4d new app conf template matter most
4cc68ed61 Refine infra removal playbook
7cfb98f69 fix: app docker .env file format
9b36b1875 Fix config templates and validation
318d85e6e Simplify VIP parsing and make pg_exporter non-blocking
571cd9e70 Use hostname module for nodename
de98f073c Fix blackbox config filename and pgpass format
4bff01100 Fix redis replicaof guard and systemd stop
38445b68d minio: increase health check retries
c99854969 docs(etcd): clarify TLS vs mTLS
41229124a fix pgsql roles typo
e575d17c6 fix pg_migration scripts to use fully qualified identifiers
ec4207202 fix pgsql-schema broken links
a237e6c99 tune autovacuum threshold to reduce small table vacuum frequency
e80754760 fix pgcat-database links to pgcat-table https://github.com/pgsty/pigsty/issues/690
0060f5346 fix pgsql-database / pgsql-databases age metric fix https://github.com/pgsty/pigsty/issues/695
43cdf72bc fix pigsty.yml typo
0d9db7b08 fix: update datasource to $dsn - fix https://github.com/pgsty/pigsty/issues/692#issuecomment-3835461620
</code></pre><p><strong>致谢</strong></p><ul><li>感谢 <a href=https://github.com/l2dy>@l2dy</a> 为本项目提出诸多改进意见与 Issue。</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>8bc75e8df0e3830931f2ddab71b89630  pigsty-v4.1.0.tgz
</span></span><span style=display:flex><span>da10de99d819421630f430d01bc9de62  pigsty-pkg-v4.1.0.d12.aarch64.tgz
</span></span><span style=display:flex><span>e1f2ed2da0d6b8c360f9fa2faaa7e175  pigsty-pkg-v4.1.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>382bb38a81c138b1b3e7c194211c2138  pigsty-pkg-v4.1.0.d13.aarch64.tgz
</span></span><span style=display:flex><span>13ceaa728901cc4202687f03d25f1479  pigsty-pkg-v4.1.0.d13.x86_64.tgz
</span></span><span style=display:flex><span>92d061de4d495d05d42f91e4283e7502  pigsty-pkg-v4.1.0.el10.aarch64.tgz
</span></span><span style=display:flex><span>be629ea91adf86bbd7e1c59b659d0069  pigsty-pkg-v4.1.0.el10.x86_64.tgz
</span></span><span style=display:flex><span>c14be706119ba33dd06c71dda6c02298  pigsty-pkg-v4.1.0.el8.aarch64.tgz
</span></span><span style=display:flex><span>0c8b6952ffc00e3b169896129ea39184  pigsty-pkg-v4.1.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>cfcc63b9ecc525165674f58f9365aa19  pigsty-pkg-v4.1.0.el9.aarch64.tgz
</span></span><span style=display:flex><span>34f733080bfa9c8515d1573c35f3e870  pigsty-pkg-v4.1.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>ad52ce9bf25e4d834e55873b3f9ada51  pigsty-pkg-v4.1.0.u22.aarch64.tgz
</span></span><span style=display:flex><span>300b2185c61a03ea7733248e526f3342  pigsty-pkg-v4.1.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>2e561e6ae9abb14796872059d2f694a8  pigsty-pkg-v4.1.0.u24.aarch64.tgz
</span></span><span style=display:flex><span>c462bb4cb2359e771ffcad006888fbd4  pigsty-pkg-v4.1.0.u24.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v400>v4.0.0</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v4.0.0
</span></span></code></pre></div><p><strong>318 个提交</strong>，604 文件变更，+118,655 / -327,552 行，发布页面: <a href=https://github.com/pgsty/pigsty/releases/tag/v4.0.0>https://github.com/pgsty/pigsty/releases/tag/v4.0.0</a></p><p><strong>亮点特性</strong></p><ul><li><strong>可观测性革命</strong>: Prometheus → VictoriaMetrics（10x 性能提升），Loki + Promtail → VictoriaLogs + Vector</li><li><strong>安全加固</strong>: 自动生成强密码、etcd RBAC、防火墙/SELinux 模式、权限收紧、Nginx Basic Auth</li><li><strong>容器支持</strong>：支持在 Docker 容器中运行 Pigsty 本身</li><li><strong>新增模块</strong>：JUICE，提供将 PG 挂载为文件系统并进行 PITR 的能力</li><li><strong>新增模块</strong>：VIBE，提供 Claude Code、JupyterLab、VS Code Server、Node.js 的配置与可观测性</li><li><strong>数据库管理</strong>: <code>pg_databases</code> state（create/absent/recreate）、<code>strategy</code> 瞬间克隆数据库</li><li><strong>PITR 与分叉</strong>: <code>/pg/bin/pg-fork</code> CoW 瞬间克隆、<code>pg-pitr</code> 增强支持 PITR 前备份</li><li><strong>高可用增强</strong>: <code>pg_rto_plan</code> 提供四档 RTO 预置参数（fast/norm/safe/wide），<code>pg_crontab</code> 定时任务</li><li><strong>多云 Terraform</strong>: AWS、Azure、GCP、Hetzner、DigitalOcean、Linode、Vultr、腾讯云模板</li><li><strong>许可证变更</strong>: AGPL-3.0 → Apache-2.0</li></ul><p><strong>基础设施软件包更新</strong></p><p>MinIO 开始使用 <a href=https://github.com/pgsty/minio>pgsty/minio</a> fork RPM/DEB</p><table class=full-width><thead><tr><th>软件包</th><th>版本</th><th>软件包</th><th>版本</th></tr></thead><tbody><tr><td>victoria-metrics</td><td>1.134.0</td><td>victoria-logs</td><td>1.43.1</td></tr><tr><td>vector</td><td>0.52.0</td><td>grafana</td><td>12.3.1</td></tr><tr><td>alertmanager</td><td>0.30.1</td><td>etcd</td><td>3.6.7</td></tr><tr><td>duckdb</td><td>1.4.4</td><td>pg_exporter</td><td>1.1.2</td></tr><tr><td>pgbackrest_exporter</td><td>0.22.0</td><td>blackbox_exporter</td><td>0.28.0</td></tr><tr><td>node_exporter</td><td>1.10.2</td><td>minio</td><td>20251203</td></tr><tr><td>pig</td><td>1.0.0</td><td>claude</td><td>2.1.19</td></tr><tr><td>opencode</td><td>1.1.34</td><td>uv</td><td>0.9.26</td></tr><tr><td>asciinema</td><td>3.1.0</td><td>prometheus</td><td>3.9.1</td></tr><tr><td>pushgateway</td><td>1.11.2</td><td>juicefs</td><td>1.4.0</td></tr><tr><td>code-server</td><td>4.100.2</td><td>caddy</td><td>2.10.2</td></tr><tr><td>hugo</td><td>0.154.5</td><td>cloudflared</td><td>2026.1.1</td></tr><tr><td>headscale</td><td>0.27.1</td><td></td><td></td></tr></tbody></table><p><strong>新增模块</strong></p><ul><li><strong>JUICE 模块</strong>：JuiceFS 分布式文件系统，使用 PostgreSQL 作为元数据引擎，支持利用 PITR 恢复文件系统</li><li><strong>VIBE 模块</strong>：AI 辅助编程沙箱环境（整合了 Code-Server、JupyterLab、Node.js 与 Claude Code）<ul><li>Code-Server：浏览器中的 VS Code</li><li>JupyterLab：交互式计算环境</li><li>Node.js：JavaScript 运行时环境</li><li>Claude Code：AI 编程助手 CLI 配置，内置 OpenTelemetry 可观测性</li></ul></li></ul><p><strong>PostgreSQL 扩展</strong></p><p><strong>新扩展</strong>: <a href=https://github.com/timescale/pg_textsearch>pg_textsearch</a> 0.4.0, <a href=https://github.com/clickhouse/pg_clickhouse/>pg_clickhouse</a> 0.1.3, <a href=https://github.com/benodiwal/pg_ai_query>pg_ai_query</a> 0.1.1, <a href=https://github.com/pgsty/etcd_fdw>etcd_fdw</a>, <a href=https://github.com/pg-ttl-index>pg_ttl_index</a> 0.1.0, <a href=https://github.com/plv8/pljs>pljs</a> 1.0.4, <a href=https://github.com/pg-retry/pg_retry>pg_retry</a> 1.0.0, <a href=https://github.com/pgsty/pg_weighted_statistics>pg_weighted_statistics</a> 1.0.0, <a href=https://github.com/pgsty/pg_enigma>pg_enigma</a> 0.5.0, <a href=https://github.com/pgsty/pglinter>pglinter</a> 1.0.1, <a href=https://github.com/microsoft/documentdb>documentdb_extended_rum</a> 0.109, <a href=https://github.com/MobilityDB>mobilitydb_datagen</a> 1.3.0</p><p><strong>重要更新</strong>: timescaledb 2.24.0, pg_search 0.21.4, citus 14.0.0, documentdb 0.109, age 1.7.0, pg_duckdb 1.1.1, vchord 1.0.0, vchord_bm25 0.3.0, pg_biscuit 2.2.2, pg_anon 2.5.1, wrappers 0.5.7, pg_vectorize 0.26.0, pg_session_jwt 0.4.0, pg_partman 5.4.0, pgmq 1.9.0, pg_bulkload 3.1.23, pg_timeseries 0.2.0, pg_convert 0.1.0, pgBackRest 2.58</p><p><strong>破坏性变更</strong></p><p><strong>可观测性栈</strong></p><table class=full-width><thead><tr><th>旧组件</th><th>新组件</th></tr></thead><tbody><tr><td>Prometheus</td><td>VictoriaMetrics</td></tr><tr><td>Loki</td><td>VictoriaLogs</td></tr><tr><td>Promtail</td><td>Vector</td></tr></tbody></table><p><strong>参数变更</strong></p><table class=full-width><thead><tr><th>移除</th><th>替代</th></tr></thead><tbody><tr><td><code>node_disable_firewall</code></td><td><code>node_firewall_mode</code> (off/none/zone)</td></tr><tr><td><code>node_disable_selinux</code></td><td><code>node_selinux_mode</code> (disabled/permissive/enforcing)</td></tr><tr><td><code>pg_pwd_enc</code></td><td>已移除，统一使用 scram-sha-256</td></tr><tr><td><code>infra_pip_packages</code></td><td><code>node_pip_packages</code></td></tr><tr><td><code>code_home</code>/<code>jupyter_home</code></td><td><code>vibe_data</code></td></tr></tbody></table><p><strong>默认值变更</strong></p><table class=full-width><thead><tr><th>参数</th><th>变化</th></tr></thead><tbody><tr><td><code>grafana_clean</code></td><td>true → false</td></tr><tr><td><code>effective_io_concurrency</code></td><td>1000 → 200</td></tr><tr><td><code>install.yml</code></td><td>重命名为 <code>deploy.yml</code></td></tr></tbody></table><p><strong>可观测性</strong></p><ul><li>使用全新的 VictoriaMetrics 替代 Prometheus，用几分之一的资源实现数倍的性能</li><li>使用全新的日志收集方案：VictoriaLogs + Vector，取代 Promtail + Loki</li><li>统一调整了所有组件的日志格式，PG 日志使用 UTC 时间戳（log_timezone）</li><li>调整了 PostgreSQL 日志的轮换方式，使用按周循环截断日志轮转模式</li><li>在 PG 日志中记录超过 1MB 的临时文件分配，在特定模版中启用 PG 17/18 日志新参数</li><li>新增了 Nginx / Syslog / PG CSV / Pgbackrest / Grafana / Redis / etcd / MinIO 等日志的 Vector 解析配置</li><li>注册数据源现在会在所有 Infra 节点上进行，Victoria 数据源将自动注册入 Grafana</li><li>新增 <code>grafana_pgurl</code> 参数，允许指定 Grafana 使用 PG 作为后端存储元数据库</li><li>新增 <code>grafana_view_password</code> 参数，指定 Grafana Meta 数据源使用的密码</li><li><code>pgbackrest_exporter</code> 的默认选项现在设置 120 秒的内部缓存间隔（原本为 600s）</li><li><code>grafana_clean</code> 参数的默认值现在由 <code>true</code> 改为 <code>false</code>，即默认不清除</li><li>新增指标收集器 <code>pg_timeline</code>，收集更实时的时间线指标 <code>pg_timeline_id</code></li><li><code>pg_exporter</code> 更新至 1.1.2，新增 <code>pg_timeline</code> 采集器，修复大量历史遗留问题</li><li>新增 <code>node-vector</code> 仪表盘，监控 Vector 日志收集器状态</li><li>新增 <code>node-juice</code> 仪表盘，监控 JuiceFS 分布式文件系统状态</li><li>新增 <code>claude-code</code> 仪表盘，监控 Claude Code AI 编程助手使用情况</li><li>PGSQL Cluster/Instance 仪表盘新增版本横幅显示</li><li>所有仪表盘使用 compact JSON 格式，大幅减少文件体积</li></ul><p><strong>接口改进</strong></p><ul><li><code>install.yml</code> 剧本现在重命名为 <code>deploy.yml</code> 以更符合语义</li><li>新增 <code>vibe.yml</code> 剧本，用于部署 VIBE AI 编程沙箱环境</li><li><code>pg_databases</code> 数据库制备功能改进<ul><li>添加删库能力：可以使用 <code>state</code> 字段指定 <code>create</code>, <code>absent</code>, <code>recreate</code> 三种状态</li><li>添加克隆能力：数据库定义中使用 <code>strategy</code> 参数指定克隆方法</li><li>支持较新版本引入的 locale 配置参数：<code>locale_provider</code>，<code>icu_locale</code>，<code>icu_rules</code>，<code>builtin_locale</code></li><li>支持 <code>is_template</code> 参数，将数据库标记为模板数据库</li><li>添加了更多类型检查，避免了字符类参数的注入</li><li>允许在 extension 中指定 <code>state: absent</code> 以删除扩展</li></ul></li><li><code>pg_users</code> 用户制备功能改进，新增参数 <code>admin</code>，类似 <code>roles</code>，但是带有 <code>ADMIN OPTION</code> 权限可以转授</li><li><code>pg_hba</code> 支持 <code>order</code> 字段，允许指定 HBA 规则的排序优先级，支持 IPv6 的 localhost 访问</li><li>新增 <code>infra_extra_services</code> 参数用于首页额外服务入口导航</li></ul><p><strong>参数优化</strong></p><ul><li><code>pg_io_method</code> 参数：auto, sync, worker, io_uring 四种方式可选，默认 worker</li><li><code>maintenance_io_concurrency</code> 设置为 100（如果使用 SSD）</li><li><code>effective_io_concurrency</code> 从 1000 减小为 200</li><li><code>file_copy_method</code> 参数为 PG18 默认设置为 <code>clone</code>，提供瞬间克隆数据库的能力</li><li><code>idle_replication_slot_timeout</code> 默认 7d，crit 模板 3d</li><li><code>log_lock_failures</code>：oltp, crit 模版开启</li><li><code>track_cost_delay_timing</code>：olap, crit 模版开启</li><li><code>log_connections</code>：oltp/olap 开启认证日志，crit 开启全部日志</li><li>新增 <code>pg_rto_plan</code> 参数，整合 Patroni 与 HAProxy 的 RTO 相关配置（fast/norm/safe/wide）</li><li><code>pg_crontab</code> 参数：为 postgres dbsu 配置定时任务</li><li>对于 PG17+，如果 <code>pg_checksums</code> 开关关闭，在 Patroni 初始化集群时显式禁用校验和</li><li>Crit 模板启用 Patroni 严格同步模式</li><li>PITR 默认 <code>archive_mode</code> 改为 <code>preserve</code>，确保恢复后保留归档能力</li><li><code>pg-pitr</code> 支持恢复前自动备份数据</li><li>修复了 <code>duckdb.allow_community_extensions</code> 总是生效的问题</li><li>允许通过 <code>node_firewall_intranet</code> 指定 HBA 信任的 &ldquo;内网网段&rdquo;</li><li>现在 pg_hba 与 pgbouncer_hba 支持 IPv6 的 localhost 访问</li></ul><p><strong>架构改进</strong></p><ul><li>在 Infra 节点上，设置固定的 <code>/infra</code> 软连接指向 Infra 数据目录 <code>/data/infra</code></li><li>现在 Infra 的数据默认放置于 <code>/data/infra</code> 目录下，这使得在容器中使用更为便利</li><li>本地软件仓库现在放置于 <code>/data/nginx/pigsty</code>，<code>/www</code> 现在作为软链接指向 <code>/data/nginx</code> 确保兼容</li><li>DNS 解析记录现在放置于 <code>/infra/hosts</code> 目录下，解决了 Ansible SELinux 竞态问题</li><li>默认首页域名从 <code>h.pigsty</code> 更名为 <code>i.pigsty</code>，新增中文首页支持</li><li>新增了 <code>/pg/bin/pg-fork</code> 脚本，用于快速创建 CoW 副本数据库实例</li><li>调整 <code>/pg/bin/pg-pitr</code> 脚本，现在可以用于实例级别的 PITR 恢复，支持恢复前自动备份</li><li>新增 <code>/pg/bin/pg-drop-role</code> 脚本，用于安全删除用户角色</li><li>新增 <code>bin/pgsql-ext</code> 脚本，用于安装 PostgreSQL 扩展</li><li>恢复 <code>pg-vacuum</code> 和 <code>pg-repack</code> 脚本</li><li>新增剧本 <code>juice.yml</code>：部署 JuiceFS 分布式文件系统实例</li><li>新增剧本 <code>vibe.yml</code>：部署 VIBE AI 编程沙箱环境（含 Code-Server、JupyterLab、Claude Code）</li><li>显式安装 cron/cronie 包，确保定时任务功能在最小化安装的系统上可用</li><li>UV Python 包管理器从 <code>infra</code> 模块迁移至 <code>node</code> 模块，新增 <code>node_uv_env</code> 参数指定虚拟环境路径</li><li><code>pg_remove</code>/<code>pg_pitr</code> 移除 etcd 元数据的任务，现在不再依赖 admin_ip 管理节点，而在 etcd 集群上执行</li><li>36 节点仿真模板 simu 简化为 20 节点的版本</li><li>适配上游变化，移除 PGDG sysupdate 仓库，移除 EL 系统上所有 llvmjit 的相关包</li><li>为 EPEL 10 / PGDG 9/10 仓库使用操作系统完整版本号（<code>major.minor</code>）</li><li>允许在仓库定义中指定 <code>meta</code> 参数，覆盖 yum 仓库的定义元数据</li><li>确保 Vagrant libvirt 模板默认带有 128GB 磁盘，以 xfs 挂载于 <code>/data</code></li><li>确保 pgbouncer 不再将 <code>0.0.0.0</code> 监听地址修改为 <code>*</code></li><li>新增 10 节点、Citus 等 Vagrant 配置模板</li><li>恢复 EL7 系统兼容性支持</li><li>多云 Terraform 模板：AWS、Azure、GCP、Hetzner、DigitalOcean、Linode、Vultr、腾讯云</li></ul><p><strong>安全改进</strong></p><ul><li><code>configure</code> 现在支持 <code>-g</code> 参数自动生成随机强密码，避免使用默认密码带来的安全隐患</li><li>更改了 MinIO 模块的默认密码，避免与众所周知的默认密码冲突</li><li>移除 <code>node_disable_firewall</code>，新增 <code>node_firewall_mode</code>，支持 off, none, zone 三种模式</li><li>移除 <code>node_disable_selinux</code>，新增 <code>node_selinux_mode</code>，支持 disabled, permissive, enforcing 三种模式</li><li>为 HAProxy、Nginx、DNSMasq、Redis 等组件配置了正确的 SELinux 上下文</li><li>启用了针对 etcd 的 RBAC，每个集群现在只能管理自己的 PostgreSQL 数据库集群</li><li>etcd root 密码现在放置于 <code>/etc/etcd/etcd.pass</code> 文件中，仅对管理员可读</li><li>将 <code>admin_ip</code> 添加到 Patroni API 允许访问的 IP 列表白名单中</li><li>总是创建 admin 系统用户组，patronictl 配置收紧为仅限 admin 组用户访问</li><li>新增 <code>node_admin_sudo</code> 参数，允许指定/调整数据库管理员的 sudo 权限模式（all/nopass）</li><li>收回了所有非 root 用户对可执行脚本的拥有权限</li><li>新增 Nginx Basic Auth 支持，可以为 Nginx Server 设置可选的 HTTP Basic Auth</li><li>修复 ownca 证书有效期问题，确保了 Chrome 可以识别自签名证书</li><li>新增 <code>vip_auth_pass</code> 参数用于 VRRP 认证</li><li>修复了若干 <code>ansible copy content</code> 字段为空时报错的问题</li><li>修复了 <code>pg_pitr</code> 中遗留的一些问题，确保 Patroni 集群恢复时没有竞态条件</li><li>使用 <code>mode 0700</code> 保护 <code>files/pki/ca</code> 目录</li></ul><p><strong>问题修复</strong></p><ul><li>修复 ownca 证书有效期 Chrome 兼容性问题</li><li>修复 Vector 0.52 syslog_raw 解析问题</li><li>修复 pg_pitr 多副本 clonefrom 时序问题</li><li>修复 Ansible SELinux dnsmasq 竞态条件</li><li>修复 EL9 aarch64 patroni & llvmjit 问题</li><li>修复 Debian groupadd 路径问题</li><li>修复空 sudoers 文件生成问题</li><li>修复 pgbouncer pid 路径（<code>/run/postgresql</code>）</li><li>修复 <code>duckdb.allow_community_extensions</code> 始终生效问题</li><li>因上游问题隐藏 EL8 上的 pg_partman 扩展</li><li>修复 HAProxy 服务模板变量路径</li><li>修复 Redis remove 任务变量名</li><li>移除 MinIO reload handler 无效处理器</li><li>修正 vmetrics_port 默认值为 8428</li><li>修复 pg-failover-callback 脚本处理所有 Patroni 回调事件</li><li>修复 pg-vacuum 事务块处理逻辑</li><li>添加 PG16+ 并行逻辑复制支持</li><li>修复 FerretDB 证书配置和服务重启策略</li><li>修正 Polar Exporter 监控指标类型定义</li><li>修复代理环境变量未传递问题</li><li>修复移除模式下 postgres 服务配置</li><li>更新 Docker 默认数据目录路径</li><li>修复 EL10 系统上的缓存问题</li><li>修复 etcd/MinIO 移除时 systemd 服务和 DNS 条目清理</li></ul><p><strong>新增参数</strong></p><table class=full-width><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>node_firewall_mode</code></td><td>enum</td><td>none (v4.0)</td><td>防火墙模式：off/none/zone（v4.1 起默认 zone）</td></tr><tr><td><code>node_selinux_mode</code></td><td>enum</td><td>permissive</td><td>SELinux 模式</td></tr><tr><td><code>node_firewall_intranet</code></td><td>string</td><td>-</td><td>HBA 信任的内网网段</td></tr><tr><td><code>node_admin_sudo</code></td><td>enum</td><td>nopass</td><td>管理员 sudo 权限级别</td></tr><tr><td><code>pg_io_method</code></td><td>enum</td><td>worker</td><td>I/O 方法：auto/sync/worker/io_uring</td></tr><tr><td><code>pg_rto_plan</code></td><td>dict</td><td>-</td><td>RTO 预设：fast/norm/safe/wide</td></tr><tr><td><code>pg_crontab</code></td><td>list</td><td>[]</td><td>postgres dbsu 定时任务</td></tr><tr><td><code>vip_auth_pass</code></td><td>string</td><td>-</td><td>VRRP 认证密码</td></tr><tr><td><code>grafana_pgurl</code></td><td>string</td><td>-</td><td>Grafana PG 后端连接字符串</td></tr><tr><td><code>grafana_view_password</code></td><td>string</td><td>DBUser.Viewer</td><td>Grafana Meta 数据源密码</td></tr><tr><td><code>infra_extra_services</code></td><td>list</td><td>[]</td><td>首页额外服务入口</td></tr><tr><td><code>juice_cache</code></td><td>path</td><td>/data/juice</td><td>JuiceFS 共享缓存目录</td></tr><tr><td><code>juice_instances</code></td><td>dict</td><td>{}</td><td>JuiceFS 实例定义</td></tr><tr><td><code>vibe_data</code></td><td>path</td><td>/fs</td><td>VIBE 工作空间目录</td></tr><tr><td><code>code_enabled</code></td><td>bool</td><td>true</td><td>是否启用 Code-Server</td></tr><tr><td><code>code_port</code></td><td>port</td><td>8443</td><td>Code-Server 监听端口</td></tr><tr><td><code>code_data</code></td><td>path</td><td>/data/code</td><td>Code-Server 数据目录</td></tr><tr><td><code>code_password</code></td><td>string</td><td>Vibe.Coding</td><td>Code-Server 登录密码</td></tr><tr><td><code>code_gallery</code></td><td>enum</td><td>openvsx</td><td>扩展市场：openvsx/microsoft</td></tr><tr><td><code>jupyter_enabled</code></td><td>bool</td><td>true</td><td>是否启用 JupyterLab</td></tr><tr><td><code>jupyter_port</code></td><td>port</td><td>8888</td><td>JupyterLab 监听端口</td></tr><tr><td><code>jupyter_data</code></td><td>path</td><td>/data/jupyter</td><td>JupyterLab 数据目录</td></tr><tr><td><code>jupyter_password</code></td><td>string</td><td>Vibe.Coding</td><td>JupyterLab 登录 Token</td></tr><tr><td><code>jupyter_venv</code></td><td>path</td><td>/data/venv</td><td>Python 虚拟环境路径</td></tr><tr><td><code>claude_enabled</code></td><td>bool</td><td>true</td><td>是否启用 Claude Code 配置</td></tr><tr><td><code>claude_env</code></td><td>dict</td><td>{}</td><td>Claude Code 额外环境变量</td></tr><tr><td><code>nodejs_enabled</code></td><td>bool</td><td>true</td><td>是否启用 Node.js 安装</td></tr><tr><td><code>nodejs_registry</code></td><td>string</td><td>''</td><td>npm registry，自动配置中国镜像</td></tr><tr><td><code>node_uv_env</code></td><td>path</td><td>/data/venv</td><td>节点 UV 虚拟环境路径，空则跳过</td></tr><tr><td><code>node_pip_packages</code></td><td>string</td><td>''</td><td>UV 虚拟环境中安装的 pip 包</td></tr></tbody></table><p><strong>兼容性</strong></p><table class=full-width><thead><tr><th>操作系统</th><th style=text-align:center>x86_64</th><th style=text-align:center>aarch64</th></tr></thead><tbody><tr><td>EL 8/9/10</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td></tr><tr><td>Debian 11/12/13</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td></tr><tr><td>Ubuntu 22.04/24.04</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td></tr></tbody></table><p><strong>PostgreSQL</strong>: 13, 14, 15, 16, 17, 18</p><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>9f42b8c64180491b59bd03016c26e8ca  pigsty-v4.0.0.tgz
</span></span><span style=display:flex><span>db9797c3c8ae21320b76a442c1135c7b  pigsty-pkg-v4.0.0.d12.aarch64.tgz
</span></span><span style=display:flex><span>1eed26eee42066ca71b9aecbf2ca1237  pigsty-pkg-v4.0.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>03540e41f575d6c3a7c63d1d30276d49  pigsty-pkg-v4.0.0.d13.aarch64.tgz
</span></span><span style=display:flex><span>36a6ee284c0dd6d9f7d823c44280b88f  pigsty-pkg-v4.0.0.d13.x86_64.tgz
</span></span><span style=display:flex><span>f2b6ec49d02916944b74014505d05258  pigsty-pkg-v4.0.0.el10.aarch64.tgz
</span></span><span style=display:flex><span>73f64c349366fe23c022f81fe305d6da  pigsty-pkg-v4.0.0.el10.x86_64.tgz
</span></span><span style=display:flex><span>287f767fbb66a9aaca9f0f22e4f20491  pigsty-pkg-v4.0.0.el8.aarch64.tgz
</span></span><span style=display:flex><span>c0886aab454bd86245f3869ef2ab4451  pigsty-pkg-v4.0.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>094ab31bcf4a3cedbd8091bc0f3ba44c  pigsty-pkg-v4.0.0.el9.aarch64.tgz
</span></span><span style=display:flex><span>235ccba44891b6474a76a81750712544  pigsty-pkg-v4.0.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>f2791c96db4cc17a8a4008fc8d9ad310  pigsty-pkg-v4.0.0.u22.aarch64.tgz
</span></span><span style=display:flex><span>3099c4453eef03b766d68e04b8d5e483  pigsty-pkg-v4.0.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>49a93c2158434f1adf0d9f5bcbbb1ca5  pigsty-pkg-v4.0.0.u24.aarch64.tgz
</span></span><span style=display:flex><span>4acaa5aeb39c6e4e23d781d37318d49b  pigsty-pkg-v4.0.0.u24.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v370>v3.7.0</h2><p><strong>亮点特性</strong></p><ul><li>PostgreSQL 18 深度支持，成为默认 PG 大版本，扩展已就位！</li><li>新增 EL10 / Debian 13 操作系统支持，总数达 14 个！</li><li>新增 PostgresQL 扩展数量，总数达到 437 个！</li><li>支持了 Ansible 2.19 破坏性重构以后的版本！</li><li>Supabase，PolarDB, IvorySQL, Percona 内核更新至最新版本！</li><li>优化了 PG 默认参数的设置逻辑，更充分利用资源。</li></ul><p><strong>版本更新</strong></p><ul><li>PostgreSQL 18.1, 17.7, 16.11, 15.15, 14.20, 13.23</li><li>Patroni 4.1.0</li><li>Pgbouncer 1.25.0</li><li>pg_exporter 1.0.3</li><li>pgbackrest 2.57.0</li><li>Supabase 2025-11</li><li>PolarDB 15.15.5.0</li><li>FerretDB 2.7.0</li><li>DuckDB 1.4.2</li><li>Etcd 3.6.6</li><li>pig 0.7.4</li></ul><p>更多软件版本更新信息，请参考：</p><ul><li><a href=https://pgext.cloud/zh/release/infra/>INFRA 变更日志</a></li><li><a href=https://pgext.cloud/zh/release/rpm/>RPM 变更日志</a></li><li><a href=https://pgext.cloud/zh/release/deb/>DEB 变更日志</a>。</li></ul><p><strong>API变化</strong></p><ul><li>为并行执行的相关参数设置了更合理的优化策略，详见 <a href=/docs/pgsql/template/tune><strong>调参说明</strong></a></li><li>在 <code>rich</code> 与 <code>full</code> 模板中，不再默认安装 citus 扩展，因为 citus 尚未支持 PG 18</li><li>PG 参数模板中，新增 duckdb 系列扩展存根。</li><li>为 <code>min_wal_size</code>, <code>max_wal_size</code>, <code>max_slot_wal_keep_size</code> 设置 200，2000，3000 GB 的封顶上限值。</li><li>为 <code>temp_file_limit</code> 设置 200 GB 的封顶上限，OLAP 设置为 2 TB。</li><li>适当增大连接池默认链接数量</li><li>新增 <code>prometheus_port</code> 参数，且默认值为 <code>9058</code>，避开与 EL10 RHEL Web Console 端口的冲突。</li><li>修改 <code>alertmanager_port</code> 参数的默认值为 <code>9059</code>，避开与 Kafka SSL 端口的潜在冲突。</li><li>新增 <code>pg_pkg</code> 的 <code>pg_pre</code> 子任务，在安装 PG 包前移除 el9+ 上导致 LLVM 冲突的 <code>bpftool</code>, <code>python3-perf</code></li><li>在 Debian / Ubuntu 的默认仓库定义中新增 llvm 仓库模块</li><li>修复了 <code>infra-rm.yml</code> 移除软件包的逻辑</li></ul><p><strong>兼容性修复</strong></p><ul><li>修复了 Ubuntu/Debian 信任 CA 时 Warning 返回码错误的问题。</li><li>修复了 Ansible 2.19 引入的大量兼容性问题，确保在新老版本上正常运行。</li><li>为 seq 类变量添加了 int 类型转换，确保兼容</li><li>将大量 with_items 修改为 loop 语法，确保兼容</li><li>为密钥交换变量添加一层列表嵌套，避免在新版本下针对字符串进行字符迭代。</li><li>将 range 用例显式转换为 list 后使用</li><li>修改了 name，port 等标记保留的变量命名</li><li>将 <code>play_hosts</code> 修改为 <code>ansible_play_hosts</code></li><li>为部分字符串类型添加了 string 强制类型转换，避免运行时错误。</li><li>EL10 逻辑适配：</li><li>修复了 EL10 缺少 ansible-collection-community-crypto 无法生成密钥的问题</li><li>修复了 EL10 缺少 ansible 逻辑包的问题</li><li>移除 modulemd_tools flamegraph timescaledb-tool</li><li>使用 java-21-openjdk 替代 java-17-openjdk</li><li>aarch64 YUM 仓库名称问题</li><li>Debian 13 逻辑适配</li><li>使用 <code>bind9-dnsutils</code> 替代 <code>dnsutils</code></li><li>Ubuntu 24 修复</li><li>临时移除了上游依赖崩溃的 tcpdump 包</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e00d0c2ac45e9eff1cc77927f9cd09df  pigsty-v3.7.0.tgz
</span></span><span style=display:flex><span>987529769d85a3a01776caefefa93ecb  pigsty-pkg-v3.7.0.d12.aarch64.tgz
</span></span><span style=display:flex><span>2d8272493784ae35abeac84568950623  pigsty-pkg-v3.7.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>090cc2531dcc25db3302f35cb3076dfa  pigsty-pkg-v3.7.0.d13.x86_64.tgz
</span></span><span style=display:flex><span>ddc54a9c4a585da323c60736b8560f55  pigsty-pkg-v3.7.0.el10.aarch64.tgz
</span></span><span style=display:flex><span>d376e75c490e8f326ea0f0fbb4a8fd9b  pigsty-pkg-v3.7.0.el10.x86_64.tgz
</span></span><span style=display:flex><span>8c2deeba1e1d09ef3d46d77a99494e71  pigsty-pkg-v3.7.0.el8.aarch64.tgz
</span></span><span style=display:flex><span>9795e059bd884b9d1b2208011abe43cd  pigsty-pkg-v3.7.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>08b860155d6764ae817ed25f2fcf9e5b  pigsty-pkg-v3.7.0.el9.aarch64.tgz
</span></span><span style=display:flex><span>1ac430768e488a449d350ce245975baa  pigsty-pkg-v3.7.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>e033aaf23690755848db255904ab3bcd  pigsty-pkg-v3.7.0.u22.aarch64.tgz
</span></span><span style=display:flex><span>cc022ea89181d89d271a9aaabca04165  pigsty-pkg-v3.7.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>0e978598796db3ce96caebd76c76e960  pigsty-pkg-v3.7.0.u24.aarch64.tgz
</span></span><span style=display:flex><span>48223898ace8812cc4ea79cf3178476a  pigsty-pkg-v3.7.0.u24.x86_64.tgz
</span></span></code></pre></div><h2 id=v361>v3.6.1</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v3.6.1
</span></span></code></pre></div><p><strong>亮点特性</strong></p><ul><li>PostgreSQL 17.6, 16.10, 15.14, 14.19, 13.22, 以及 18 Beta 3 支持</li><li>在中国大陆地区使用 Pigsty 提供的 PGDG APT/YUM 镜像解决更新断供问题。</li><li>新的网站首页： <a href=https://pgsty.com>https://pgsty.com</a></li><li>增加了 el10, debian 13 的实现存根，以及 el10 的 Terraform 镜像</li></ul><p><strong>基础设施软件包更新</strong></p><ul><li>Grafana 12.1.0</li><li>pg_exporter 1.0.2</li><li>pig 0.6.1</li><li>vector 0.49.0</li><li>redis_exporter 1.75.0</li><li>mongo_exporter 0.47.0</li><li>victoriametrics 1.123.0</li><li>victorialogs: 1.28.0</li><li>grafana-victoriametrics-ds 0.18.3</li><li>grafana-victorialogs-ds 0.19.3</li><li>grafana-infinity-ds 3.4.1</li><li>etcd 3.6.4</li><li>ferretdb 2.5.0</li><li>tigerbeetle 0.16.54</li><li>genai-toolbox 0.12.0</li></ul><p><strong>数据库软件包更新</strong></p><ul><li>pg_search 0.17.3</li></ul><p><strong>API变更</strong></p><ul><li>从 <code>node_kernel_modules</code> 默认值中移除 <code>br_filter</code> 内核模块。</li><li>在添加 PGDG YUM 源时使用操作大版本号，不再使用小版本号。</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>045977aff647acbfa77f0df32d863739  pigsty-pkg-v3.6.1.d12.aarch64.tgz
</span></span><span style=display:flex><span>636b15c2d87830f2353680732e1af9d2  pigsty-pkg-v3.6.1.d12.x86_64.tgz
</span></span><span style=display:flex><span>700a9f6d0db9c686d371bf1c05b54221  pigsty-pkg-v3.6.1.el8.aarch64.tgz
</span></span><span style=display:flex><span>2aff03f911dd7be363ba38a392b71a16  pigsty-pkg-v3.6.1.el8.x86_64.tgz
</span></span><span style=display:flex><span>ce07261b02b02b36a307dab83e460437  pigsty-pkg-v3.6.1.el9.aarch64.tgz
</span></span><span style=display:flex><span>d598d62a47bbba2e811059a53fe3b2b5  pigsty-pkg-v3.6.1.el9.x86_64.tgz
</span></span><span style=display:flex><span>13fd68752e59f5fd2a9217e5bcad0acd  pigsty-pkg-v3.6.1.u22.aarch64.tgz
</span></span><span style=display:flex><span>c25ccfb98840c01eb7a6e18803de55bb  pigsty-pkg-v3.6.1.u22.x86_64.tgz
</span></span><span style=display:flex><span>0d71e58feebe5299df75610607bf428c  pigsty-pkg-v3.6.1.u24.aarch64.tgz
</span></span><span style=display:flex><span>4fbbab1f8465166f494110c5ec448937  pigsty-pkg-v3.6.1.u24.x86_64.tgz
</span></span><span style=display:flex><span>083d8680fa48e9fec3c3fcf481d25d2f  pigsty-v3.6.1.tgz
</span></span></code></pre></div><hr><h2 id=v360>v3.6.0</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v3.6.0
</span></span></code></pre></div><p><strong>亮点特性</strong></p><ul><li>全新文档站： <a href=https://doc.pgsty.com>https://doc.pgsty.com</a></li><li>新增 <code>pgsql-pitr</code> 剧本与备份/恢复教程，改善 PITR 体验，</li><li>新增内核支持：Percona PG TDE (PG17)</li><li>优化 Supabase 自建体验，更新至最新版本，并解决了一系列官方模板的问题</li><li>简化安装步骤，默认使用在线安装，更加高效简单，bootstrap 过程（安装ansible）嵌入安装脚本中</li></ul><p><strong>设计改进</strong></p><ul><li>改善了 Etcd 模块的实现，新增独立的 <code>etcd-rm.yml</code> 剧本与扩缩容 SOP 脚本。</li><li>改善了 MinIO 模块的实现，支持 HTTP 模式，创建不同属性的三个桶供开箱即用</li><li>重新调整梳理了所有配置模板，使用更为便利</li><li>针对中国大陆使用速度更快的 Docker Registry 镜像站</li><li>优化了 tuned 操作系统参数模板，针对现代硬件与 NVMe 磁盘优化</li><li>新增扩展 <code>pgactive</code> 用于多主复制与亚秒级故障切换</li><li>调整 <code>pg_fs_main</code> / <code>pg_fs_backup</code> 默认值，简化文件目录结构设计</li></ul><p><strong>问题修复</strong></p><ul><li>修复了 pgbouncer 配置文件的错误 by @housei-zzy</li><li>修复了 OrioleDB 在 Debian 平台上的问题</li><li>修复了 tuned shm 配置参数的问题</li><li>离线软件包直接使用 PGDG 源，避免使用断开同步的镜像站点</li><li>修复了 IvorySQL libxcrypt 依赖的问题</li><li>替换了破损与缓慢的 EPEL 软件仓库站点</li><li>修复了 <code>haproxy_enabled</code> 标记位的功能</li></ul><p><strong>基础设施软件包更新</strong></p><p>新增 Victoria Metrics / Victoria Logs 相关包</p><ul><li>genai-toolbox 0.9.0 (new)</li><li>victoriametrics 1.120.0 -> 1.121.0 (重构)</li><li>vmutils 1.121.0 (重命名 victoria-metrics-utils)</li><li>grafana-victoriametrics-ds 0.15.1 -> 0.17.0</li><li>victorialogs 1.24.0 -> 1.25.1 (重构)</li><li>vslogcli 1.24.0 -> 1.25.1</li><li>vlagent 1.25.1 (新增)</li><li>grafana-victorialogs-ds 0.16.3 -> 0.18.1</li><li>prometheus 3.4.1 -> 3.5.0</li><li>grafana 12.0.0 -> 12.0.2</li><li>vector 0.47.0 -> 0.48.0</li><li>grafana-infinity-ds 3.2.1 -> 3.3.0</li><li>keepalived_exporter 1.7.0</li><li>blackbox_exporter 0.26.0 -> 0.27.0</li><li>redis_exporter 1.72.1 -> 1.77.0</li><li>rclone 1.69.3 -> 1.70.3</li></ul><p><strong>数据库软件包更新</strong></p><ul><li>PostgreSQL 18 Beta2 更新</li><li>pg_exporter 1.0.1，更新至最新依赖并提供 Docker 镜像</li><li>pig 0.6.0，更新了最新扩展与仓库列表，带有 <code>pig install</code> 子命令</li><li>vip-manager 3.0.0 -> 4.0.0</li><li>ferretdb 2.2.0 -> 2.3.1</li><li>dblab 0.32.0 -> 0.33.0</li><li>duckdb 1.3.1 -> 1.3.2</li><li>etcd 3.6.1 -> 3.6.3</li><li>ferretdb 2.2.0 -> 2.4.0</li><li>juicefs 1.2.3 -> 1.3.0</li><li>tigerbeetle 0.16.41 -> 0.16.50</li><li>pev2 1.15.0 -> 1.16.0</li></ul><p><strong>PG扩展包更新</strong></p><ul><li>OrioleDB 1.5 beta12</li><li>OriolePG 17.11</li><li>plv8 3.2.3 -> 3.2.4</li><li>postgresql_anonymizer 2.1.1 -> 2.3.0</li><li>pgvectorscale 0.7.1 -> 0.8.0</li><li>wrappers 0.5.0 -> 0.5.3</li><li>supautils 2.9.1 -> 2.10.0</li><li>citus 13.0.3 -> 13.1.0</li><li>timescaledb 2.20.0 -> 2.21.1</li><li>vchord 0.3.0 -> <a href=https://github.com/tensorchord/VectorChord/releases/tag/0.4.3>0.4.3</a></li><li>pgactive 2.1.5 (new)</li><li>documentdb 0.103.0 -> 0.105.0</li><li>pg_search 0.17.0</li></ul><p><strong>API变更</strong></p><ul><li><code>pg_fs_backup</code>：重命名为 <code>pg_fs_backup</code>，默认值为 <code>/data/backups</code>。</li><li><code>pg_rm_bkup</code>：重命名为 <code>pg_rm_backup</code>，默认值为 <code>true</code>。</li><li><code>pg_fs_main</code>：现在默认值调整为 <code>/data/postgres</code>。</li><li><code>nginx_cert_validity</code>：新增参数，用于控制 Nginx 自签名证书的有效期，默认为 <code>397d</code>。</li><li><code>minio_buckets</code>：默认值调整为创建名为 <code>pgsql</code>、<code>meta</code>、<code>data</code> 的三个桶。</li><li><code>minio_users</code>：移除 <code>dba</code> 用户，新增 <code>s3user_meta</code> 和 <code>s3user_data</code> 用户，分别对应 <code>meta</code> 和 <code>data</code> 桶。</li><li><code>minio_https</code>：新增参数，允许配置 MinIO 使用 HTTP 模式。</li><li><code>minio_provision</code>：新增参数，允许跳过 MinIO 置备阶段（跳过桶和用户的创建）。</li><li><code>minio_safeguard</code>：新增参数，启用后会在执行 <code>minio-rm.yml</code> 时中止操作。</li><li><code>minio_rm_data</code>：新增参数，控制在执行 <code>minio-rm.yml</code> 时是否删除 minio 数据目录。</li><li><code>minio_rm_pkg</code>：新增参数，控制在执行 <code>minio-rm.yml</code> 时是否卸载 minio 软件包。</li><li><code>etcd_learner</code>：新增参数，允许 etcd 以学习者身份初始化。</li><li><code>etcd_rm_data</code>：新增参数，控制在执行 <code>etcd-rm.yml</code> 时是否删除 etcd 数据目录。</li><li><code>etcd_rm_pkg</code>：新增参数，控制在执行 <code>etcd-rm.yml</code> 时是否卸载 etcd 软件包。</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>df64ac0c2b5aab39dd29698a640daf2e  pigsty-v3.6.0.tgz
</span></span><span style=display:flex><span>cea861e2b4ec7ff5318e1b3c30b470cb  pigsty-pkg-v3.6.0.d12.aarch64.tgz
</span></span><span style=display:flex><span>2f253af87e19550057c0e7fca876d37c  pigsty-pkg-v3.6.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>0158145b9bbf0e4a120b8bfa8b44f857  pigsty-pkg-v3.6.0.el8.aarch64.tgz
</span></span><span style=display:flex><span>07330d687d04d26e7d569c8755426c5a  pigsty-pkg-v3.6.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>311df5a342b39e3288ebb8d14d81e0d1  pigsty-pkg-v3.6.0.el9.aarch64.tgz
</span></span><span style=display:flex><span>92aad54cc1822b06d3e04a870ae14e29  pigsty-pkg-v3.6.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>c4fadf1645c8bbe3e83d5a01497fa9ca  pigsty-pkg-v3.6.0.u22.aarch64.tgz
</span></span><span style=display:flex><span>5477ed6be96f156a43acd740df8a9b9b  pigsty-pkg-v3.6.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>196169afc1be02f93fcc599d42d005ca  pigsty-pkg-v3.6.0.u24.aarch64.tgz
</span></span><span style=display:flex><span>dbe5c1e8a242a62fe6f6e1f6e6b6c281  pigsty-pkg-v3.6.0.u24.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v350>v3.5.0</h2><p><strong>亮点特性</strong></p><ul><li>支持 PG 18 (Beta)，扩展更新，总数达到 421 个</li><li>OrioleDB 与 OpenHalo 内核在全平台上可用</li><li>可使用 <code>pig do</code> 子命令代替 <code>bin</code> 脚本</li><li>Supabase 自建加强，解决若干遗留问题，例如复制延迟与密钥分发</li><li>代码重构与架构优化，优化了 Postgres 与 Pgbouncer 默认参数</li><li>更新了 Grafana 12, pg_exporter 1.0 与相关插件，翻修面板</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v3.5.0
</span></span></code></pre></div><ul><li>支持 PostgreSQL 18</li><li>通过 pg_exporter 1.0.0 支持 PG18 监控指标</li><li>通过 pig 0.4.1 支持 PG18 安装 Alias。</li><li>提供 <code>pg18</code> 配置模板</li><li>重构 <code>pgsql</code> 模块</li><li>PGSQL 重构，将 PG 监控抽离为单独的 <code>pg_monitor</code> 角色，移除 <code>clean</code> 逻辑</li><li>去除冗余重复的任务，合并同类项，精简配置。移除 <code>dir/utils</code> 任务块</li><li>所有扩展默认安装至 <code>extensions</code> 模式中（与 supabase 安全实践保持一致）</li><li>重命名模板文件，移除所有 <code>.j2</code> 后缀</li><li>为所有模板中的 <code>monitor</code> 函数添加 <code>SET</code> 命令清空 <code>search_path</code>，遵循 Supabase 安全最佳实践。</li><li>调整 pgbouncer 默认参数，增大默认链接池大小，设置链接池清理查询。</li><li>新增参数 <code>pgbouncer_ignore_param</code> ，允许配置 pgbouncer 忽略的参数列表</li><li>新增任务 <code>pg_key</code> 用于生成 <code>pgsodium</code> 所需的服务端密钥</li><li>针对 PG 17 默认启用 <code>sync_replication_slots</code></li><li>重新调整了子任务标签，使其更符合配置小节的拆分逻辑</li><li>重构 <code>pg_remove</code> 模块</li><li>重命名参数：<code>pg_rm_data</code>, <code>pg_rm_bkup</code>, <code>pg_rm_pkg</code> 用于控制删除的内容</li><li>重新调整角色代码结构，使用更清楚的标签进行划分</li><li>新增 <code>pg_monitor</code> 模块</li><li><code>pgbouncer_exporter</code> 现在不再和 <code>pg_exporter</code> 共享配置文件</li><li>新增了 TimescaleDB， Citus，pg_wait_event 的监控指标。</li><li>使用 <code>pg_exporter</code> 1.0.0 ，更新了 PG16/17/18 相关监控指标。</li><li>使用更为紧凑，全新设计的指标收集器配置文件。</li><li>Supabase 加强 (感谢来自 <a href=https://github.com/lawso017>@lawso017</a> 的贡献！)</li><li>将 Supabase 容器镜像与数据库模式更新至最新版本</li><li>现在默认支持 <code>pgsodium</code> 服务端密钥加载</li><li>通过 supa-kick 定时任务解决 logflare 无法及时更新复制进度的问题</li><li>为 monitor 模式中的函数添加 <code>set search_path</code> 子句以遵循安全最佳实践</li><li>CLI 新增 <code>pig do</code> 命令，允许通过命令行工具替代 <code>bin/</code> 中的 Shell 脚本</li><li>监控系统更新</li><li>更新 Grafana 大版本至 12.0.0，更新相关插件/数据源软件包</li><li>更新 Postgres 数据源 uid 命名方式（以适应新的 <code>uid</code> 长度限制与字符限制）</li><li>新增了 Static Datasource</li><li>更新了现有 Dashboard，修复若干遗留问题</li></ul><p><strong>基础设施软件包更新</strong></p><ul><li>pig 0.4.2</li><li>duckdb 1.3.0</li><li>etcd 3.6.0</li><li>vector 0.47.0</li><li>minio 20250422221226</li><li>mcli 20250416181326</li><li>pev 1.5.0</li><li>rclone 1.69.3</li><li>mtail 3.0.8 (new)</li></ul><p><strong>可观测性软件包更新</strong></p><ul><li>grafana 12.0.0</li><li>grafana-victorialogs-ds 0.16.3</li><li>grafana-victoriametrics-ds 0.15.1</li><li>grafana-infinity-ds 3.2.1</li><li>grafana_plugins 12.0.0</li><li>prometheus 3.4.0</li><li>pushgateway 1.11.1</li><li>nginx_exporter 1.4.2</li><li>pg_exporter <a href=https://github.com/pgsty/pg_exporter/releases/tag/v1.0.0>1.0.0</a></li><li>pgbackrest_exporter 0.20.0</li><li>redis_exporter 1.72.1</li><li>keepalived_exporter 1.6.2</li><li>victoriametrics 1.117.1</li><li>victoria_logs 1.22.2</li></ul><p><strong>数据库软件包更新</strong></p><ul><li>PostgreSQL 17.5, 16.9, 15.13, 14.18, 13.21</li><li>PostgreSQL 18beta1 支持</li><li>pgbouncer 1.24.1</li><li>pgbackrest 2.55</li><li>pgbadger 13.1</li></ul><p><strong>Postgres 扩展包更新</strong></p><ul><li>spat <a href=https://github.com/Florents-Tselai/spat>0.1.0a4</a> 新扩展</li><li>pgsentinel <a href=https://github.com/pgsentinel/pgsentinel/releases/tag/v1.1.0>1.1.0</a> 新扩展</li><li>pgdd <a href=https://github.com/rustprooflabs/pgdd>0.6.0</a> (pgrx 0.14.1) 新扩展</li><li>convert <a href=https://github.com/rustprooflabs/convert>0.0.4</a> (pgrx 0.14.1) 新扩展</li><li>pg_tokenizer.rs <a href=https://github.com/tensorchord/pg_tokenizer.rs>0.1.0</a> (pgrx 0.13.1)</li><li>pg_render <a href=https://github.com/mkaski/pg_render>0.1.2</a> (pgrx 0.12.8)</li><li>pgx_ulid <a href=https://github.com/pksunkara/pgx_ulid>0.2.0</a> (pgrx 0.12.7)</li><li>pg_idkit <a href=https://github.com/VADOSWARE/pg_idkit>0.3.0</a> (pgrx 0.14.1)</li><li>pg_ivm <a href=https://github.com/sraoss/pg_ivm>1.11.0</a></li><li>orioledb <a href=https://github.com/orioledb/orioledb>1.4.0 beta11</a> 新增 debian/ubuntu 支持</li><li>openhalo <a href=https://github.com/HaloTech-Co-Ltd/openHalo>14.10</a> 新增 debian/ubuntu 支持</li><li>omnigres 20250507 (在 d12/u22 编译最新版本失败)</li><li>citus <a href=https://github.com/citusdata/citus/releases/tag/v13.0.3>12.0.3</a></li><li>timescaledb <a href=https://github.com/timescale/timescaledb/releases/tag/2.20.0>2.20.0</a> (移除 PG14 支持)</li><li>supautils <a href=https://github.com/supabase/supautils/releases/tag/v2.9.2>2.9.2</a></li><li>pg_envvar <a href=https://github.com/theory/pg-envvar/releases/tag/v1.0.1>1.0.1</a></li><li>pgcollection <a href=https://github.com/aws/pgcollection/releases/tag/v1.0.0>1.0.0</a></li><li>aggs_for_vecs <a href=https://github.com/pjungwir/aggs_for_vecs/releases/tag/1.4.0>1.4.0</a></li><li>pg_tracing <a href=https://github.com/DataDog/pg_tracing/releases/tag/v0.1.3>0.1.3</a></li><li>pgmq <a href=https://github.com/pgmq/pgmq/releases/tag/v1.5.1>1.5.1</a></li><li>tzf-pg <a href=https://github.com/ringsaturn/tzf-pg/releases/tag/v0.2.0>0.2.0</a> (pgrx 0.14.1)</li><li>pg_search <a href=https://github.com/paradedb/paradedb/releases/tag/v0.15.18>0.15.18</a> (pgrx 0.14.1)</li><li>anon <a href="https://gitlab.com/dalibo/postgresql_anonymizer/-/tree/latest/debian?ref_type=heads">2.1.1</a> (pgrx 0.14.1)</li><li>pg_parquet <a href=https://github.com/CrunchyData/pg_parquet/releases/tag/v0.3.2>0.4.0</a> (0.14.1)</li><li>pg_cardano <a href=https://github.com/Fell-x27/pg_cardano/commits/master/>1.0.5</a> (pgrx 0.12) -> 0.14.1</li><li>pglite_fusion <a href=https://github.com/frectonz/pglite-fusion/releases/tag/v0.0.5>0.0.5</a> (pgrx 0.12.8) -> 14.1</li><li>vchord_bm25 <a href=https://github.com/tensorchord/VectorChord-bm25/releases/tag/0.2.1>0.2.1</a> (pgrx 0.13.1)</li><li>vchord <a href=https://github.com/tensorchord/VectorChord/releases/tag/0.3.0>0.3.0</a> (pgrx 0.13.1)</li><li>pg_vectorize <a href=https://github.com/ChuckHend/pg_vectorize/releases/tag/v0.22.1>0.22.1</a> (pgrx 0.13.1)</li><li>wrappers <a href=https://github.com/supabase/wrappers/releases/tag/v0.4.6>0.4.6</a> (pgrx 0.12.9)</li><li>timescaledb-toolkit <a href=https://github.com/timescale/timescaledb-toolkit/releases/tag/1.21.0>1.21.0</a> (pgrx 0.12.9)</li><li>pgvectorscale <a href=https://github.com/timescale/pgvectorscale/releases/tag/0.7.1>0.7.1</a> (pgrx 0.12.9)</li><li>pg_session_jwt <a href=https://github.com/neondatabase/pg_session_jwt/releases/tag/v0.3.1>0.3.1</a> (pgrx 0.12.6) -> 0.12.9</li><li>pg_timetable 5.13.0</li><li>ferretdb 2.2.0</li><li>documentdb <a href=https://github.com/FerretDB/documentdb/releases/tag/v0.103.0-ferretdb-2.2.0>0.103.0</a> (新增 aarch64支持)</li><li>pgml <a href=https://github.com/postgresml/postgresml/releases/tag/v2.10.0>2.10.0</a> (pgrx 0.12.9)</li><li>sqlite_fdw <a href=https://github.com/pgspider/sqlite_fdw/releases/tag/v2.5.0>2.5.0</a> (fix pg17 deb)</li><li>tzf <a href=https://github.com/ringsaturn/pg-tzf/releases/tag/v0.2.2>0.2.2</a> 0.14.1 (rename src)</li><li>pg_vectorize <a href=https://github.com/ChuckHend/pg_vectorize/releases/tag/v0.22.2>0.22.2</a> (pgrx 0.13.1)</li><li>wrappers <a href=https://github.com/supabase/wrappers/releases/tag/v0.5.0>0.5.0</a> (pgrx 0.12.9)</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ab91bc05c54b88c455bf66533c1d8d43  pigsty-v3.6.0.tgz
</span></span><span style=display:flex><span>4c9fabc2d1f0ed733145af2b6aff2f48 pigsty-pkg-v3.5.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>796d47de12673b2eb9882e527c3b6ba0 pigsty-pkg-v3.5.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>a53ef2cede1363f11e9faaaa43718fdc pigsty-pkg-v3.5.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>36da28f97a845fdc0b7bbde2d3812a67 pigsty-pkg-v3.5.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>8551b3e04b38af382163e6857778437d pigsty-pkg-v3.5.0.u24.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v341>v3.4.1</h2><p>GitHub 发布页面：<a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.1>v3.4.1</a></p><ul><li>在 EL 系统上增加了对 MySQL 协议兼容 PostgreSQL 内核的支持：<a href=/docs/pgsql/kernel/openhalo>openHalo</a></li><li>在 EL 系统上增加了对 OLTP 增强 PostgreSQL 内核的支持：<a href=/docs/pgsql/kernel/orioledb>orioledb</a></li><li>优化了 pgAdmin 9.2 应用模板，具有自动服务器列表更新和 pgpass 密码填充功能</li><li>将 PG 默认最大连接数增加到 250、500、1000</li><li>从 EL8 中删除了有依赖错误的 <code>mysql_fdw</code> 扩展</li></ul><p><strong>基础设施更新</strong></p><ul><li>pig 0.3.4</li><li>etcd 3.5.21</li><li>restic 0.18.0</li><li>ferretdb 2.1.0</li><li>tigerbeetle 0.16.34</li><li>pg_exporter 0.8.1</li><li>node_exporter 1.9.1</li><li>grafana 11.6.0</li><li>zfs_exporter 3.8.1</li><li>mongodb_exporter 0.44.0</li><li>victoriametrics 1.114.0</li><li>minio 20250403145628</li><li>mcli 20250403170756</li></ul><p><strong>扩展更新</strong></p><ul><li>将 pg_search 升级到 0.15.13</li><li>将 citus 升级到 13.0.3</li><li>将 timescaledb 升级到 2.19.1</li><li>将 pgcollection RPM 升级到 1.0.0</li><li>将 pg_vectorize RPM 升级到 0.22.1</li><li>将 pglite_fusion RPM 升级到 0.0.4</li><li>将 aggs_for_vecs RPM 升级到 1.4.0</li><li>将 pg_tracing RPM 升级到 0.1.3</li><li>将 pgmq RPM 升级到 1.5.1</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>471c82e5f050510bd3cc04d61f098560  pigsty-v3.4.1.tgz
</span></span><span style=display:flex><span>4ce17cc1b549cf8bd22686646b1c33d2  pigsty-pkg-v3.4.1.d12.aarch64.tgz
</span></span><span style=display:flex><span>c80391c6f93c9f4cad8079698e910972  pigsty-pkg-v3.4.1.d12.x86_64.tgz
</span></span><span style=display:flex><span>811bf89d1087512a4f8801242ca8bed5  pigsty-pkg-v3.4.1.el9.x86_64.tgzz
</span></span><span style=display:flex><span>9fe2e6482b14a3e60863eeae64a78945  pigsty-pkg-v3.4.1.u22.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v340>v3.4.0</h2><p>GitHub 发布页面：<a href=https://github.com/pgsty/pigsty/releases/tag/v3.4.0>v3.4.0</a></p><p>介绍博客：<a href=/blog/pigsty/v3.4><strong>Pigsty v3.4 MySQL 兼容性和全面增强</strong></a></p><p><strong>新功能</strong></p><ul><li>增加了新的 pgBackRest 备份监控指标和仪表板</li><li>增强了 Nginx 服务器配置选项，支持自动 Certbot 签发</li><li>现在优先使用 PostgreSQL 内置的 <code>C</code>/<code>C.UTF-8</code> 区域设置</li><li>IvorySQL 4.4 现在在所有平台上完全支持（RPM/DEB 在 x86/ARM 上）</li><li>增加了新的软件包：Juicefs、Restic、TimescaleDB EventStreamer</li><li>Apache AGE 图数据库扩展现在在 EL 上完全支持 PostgreSQL 13–17</li><li>改进了 <code>app.yml</code> playbook：无需额外配置即可启动标准 Docker 应用</li><li>升级 Supabase、Dify 和 Odoo 应用模板到最新版本</li><li>增加 electric 应用模板，本地优先的 PostgreSQL 同步引擎</li></ul><p><strong>基础设施包</strong></p><ul><li><strong>+restic</strong> 0.17.3</li><li><strong>+juicefs</strong> 1.2.3</li><li><strong>+timescaledb-event-streamer</strong> 0.12.0</li><li><strong>Prometheus</strong> 3.2.1</li><li><strong>AlertManager</strong> 0.28.1</li><li><strong>blackbox_exporter</strong> 0.26.0</li><li><strong>node_exporter</strong> 1.9.0</li><li><strong>mysqld_exporter</strong> 0.17.2</li><li><strong>kafka_exporter</strong> 1.9.0</li><li><strong>redis_exporter</strong> 1.69.0</li><li><strong>pgbackrest_exporter</strong> 0.19.0-2</li><li><strong>DuckDB</strong> 1.2.1</li><li><strong>etcd</strong> 3.5.20</li><li><strong>FerretDB</strong> 2.0.0</li><li><strong>tigerbeetle</strong> 0.16.31</li><li><strong>vector</strong> 0.45.0</li><li><strong>VictoriaMetrics</strong> 1.113.0</li><li><strong>VictoriaLogs</strong> 1.17.0</li><li><strong>rclone</strong> 1.69.1</li><li><strong>pev2</strong> 1.14.0</li><li><strong>grafana-victorialogs-ds</strong> 0.16.0</li><li><strong>grafana-victoriametrics-ds</strong> 0.14.0</li><li><strong>grafana-infinity-ds</strong> 3.0.0</li></ul><p><strong>PostgreSQL 相关</strong></p><ul><li><strong>Patroni</strong> 4.0.5</li><li><strong>PolarDB</strong> 15.12.3.0-e1e6d85b</li><li><strong>IvorySQL</strong> 4.4</li><li><strong>pgbackrest</strong> 2.54.2</li><li><strong>pev2</strong> 1.14</li><li><strong>WiltonDB</strong> 13.17</li></ul><p><strong>PostgreSQL 扩展</strong></p><ul><li><strong>pgspider_ext</strong> 1.3.0（新扩展）</li><li><strong>apache age</strong> 13–17 el rpm (1.5.0)</li><li><strong>timescaledb</strong> 2.18.2 → 2.19.0</li><li><strong>citus</strong> 13.0.1 → 13.0.2</li><li><strong>documentdb</strong> 1.101-0 → 1.102-0</li><li><strong>pg_analytics</strong> 0.3.4 → 0.3.7</li><li><strong>pg_search</strong> 0.15.2 → 0.15.8</li><li><strong>pg_ivm</strong> 1.9 → 1.10</li><li><strong>emaj</strong> 4.4.0 → 4.6.0</li><li><strong>pgsql_tweaks</strong> 0.10.0 → 0.11.0</li><li><strong>pgvectorscale</strong> 0.4.0 → 0.6.0 (pgrx 0.12.5)</li><li><strong>pg_session_jwt</strong> 0.1.2 → 0.2.0 (pgrx 0.12.6)</li><li><strong>wrappers</strong> 0.4.4 → 0.4.5 (pgrx 0.12.9)</li><li><strong>pg_parquet</strong> 0.2.0 → 0.3.1 (pgrx 0.13.1)</li><li><strong>vchord</strong> 0.2.1 → 0.2.2 (pgrx 0.13.1)</li><li><strong>pg_tle</strong> 1.2.0 → 1.5.0</li><li><strong>supautils</strong> 2.5.0 → 2.6.0</li><li><strong>sslutils</strong> 1.3 → 1.4</li><li><strong>pg_profile</strong> 4.7 → 4.8</li><li><strong>pg_snakeoil</strong> 1.3 → 1.4</li><li><strong>pg_jsonschema</strong> 0.3.2 → 0.3.3</li><li><strong>pg_incremental</strong> 1.1.1 → 1.2.0</li><li><strong>pg_stat_monitor</strong> 2.1.0 → 2.1.1</li><li><strong>ddl_historization</strong> 0.7 → 0.0.7（错误修复）</li><li><strong>pg_sqlog</strong> 3.1.7 → 1.6（错误修复）</li><li><strong>pg_random</strong> 删除开发后缀（错误修复）</li><li><strong>asn1oid</strong> 1.5 → 1.6</li><li><strong>table_log</strong> 0.6.1 → 0.6.4</li></ul><p><strong>接口变更</strong></p><ul><li>增加了新的 Docker 参数：<code>docker_data</code> 和 <code>docker_storage_driver</code>（<a href=https://github.com/pgsty/pigsty/pull/521>#521</a> 由 <a href=https://github.com/waitingsong>@waitingsong</a> 提供）</li><li>增加了新的基础设施参数：<code>alertmanager_port</code>，让您指定 AlertManager 端口</li><li>增加了新的基础设施参数：<code>certbot_sign</code>，在 nginx 初始化期间申请证书？（默认为 false）</li><li>增加了新的基础设施参数：<code>certbot_email</code>，指定通过 Certbot 请求证书时使用的邮箱</li><li>增加了新的基础设施参数：<code>certbot_options</code>，指定 Certbot 的额外参数</li><li>更新 IvorySQL，从 IvorySQL 4.4 开始将其默认二进制文件放在 <code>/usr/ivory-4</code> 下</li><li>将 <code>pg_lc_ctype</code> 和其他区域相关参数的默认值从 <code>en_US.UTF-8</code> 更改为 <code>C</code></li><li>对于 PostgreSQL 17，如果使用 <code>UTF8</code> 编码与 <code>C</code> 或 <code>C.UTF-8</code> 区域，PostgreSQL 的内置本地化规则现在优先</li><li><code>configure</code> 自动检测 PG 版本和环境是否都支持 <code>C.utf8</code>，并相应调整区域相关选项</li><li>将默认 IvorySQL 二进制路径设置为 <code>/usr/ivory-4</code></li><li>更新 <code>pg_packages</code> 的默认值为 <code>pgsql-main patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager</code></li><li>更新 <code>repo_packages</code> 的默认值为 <code>[node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, extra-modules]</code></li><li>从 <code>/etc/profile.d/node.sh</code> 中删除 <code>LANG</code> 和 <code>LC_ALL</code> 环境变量设置</li><li>现在使用 <code>bento/rockylinux-8</code> 和 <code>bento/rockylinux-9</code> 作为 EL 的 Vagrant box 镜像</li><li>增加了新别名 <code>extra_modules</code>，包含额外的可选模块</li><li>更新 PostgreSQL 别名：<code>postgresql</code>、<code>pgsql-main</code>、<code>pgsql-core</code>、<code>pgsql-full</code></li><li>GitLab 仓库现在包含在可用模块中</li><li>Docker 模块已合并到基础设施模块中</li><li><code>node.yml</code> playbook 现在包含 <code>node_pip</code> 任务，在每个节点上配置 pip 镜像</li><li><code>pgsql.yml</code> playbook 现在包含 <code>pgbackrest_exporter</code> 任务，用于收集备份指标</li><li><code>Makefile</code> 现在允许使用 <code>META</code>/<code>PKG</code> 环境变量</li><li>增加 <code>/pg/spool</code> 目录作为 pgBackRest 的临时存储</li><li>默认禁用 pgBackRest 的 <code>link-all</code> 选项</li><li>默认为 MinIO 仓库启用块级增量备份</li></ul><p><strong>错误修复</strong></p><ul><li>修复 <code>pg-backup</code> 中的退出状态码（<a href=https://github.com/pgsty/pigsty/pull/532>#532</a> 由 <a href=https://github.com/waitingsong>@waitingsong</a> 提供）</li><li>在 <code>pg-tune-hugepage</code> 中，限制 PostgreSQL 仅使用大页面（<a href=https://github.com/pgsty/pigsty/pull/527>#527</a> 由 <a href=https://github.com/waitingsong>@waitingsong</a> 提供）</li><li>修复 <code>pg-role</code> 任务中的逻辑错误</li><li>纠正大页面配置参数的类型转换</li><li>修复 <code>slim</code> 模板中 <code>node_repo_modules</code> 的默认值问题</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>768bea3bfc5d492f4c033cb019a81d3a  pigsty-v3.4.0.tgz
</span></span><span style=display:flex><span>7c3d47ef488a9c7961ca6579dc9543d6  pigsty-pkg-v3.4.0.d12.aarch64.tgz
</span></span><span style=display:flex><span>b5d76aefb1e1caa7890b3a37f6a14ea5  pigsty-pkg-v3.4.0.d12.x86_64.tgz
</span></span><span style=display:flex><span>42dacf2f544ca9a02148aeea91f3153a  pigsty-pkg-v3.4.0.el8.aarch64.tgz
</span></span><span style=display:flex><span>d0a694f6cd6a7f2111b0971a60c49ad0  pigsty-pkg-v3.4.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>7caa82254c1b0750e89f78a54bf065f8  pigsty-pkg-v3.4.0.el9.aarch64.tgz
</span></span><span style=display:flex><span>8f817e5fad708b20ee217eb2e12b99cb  pigsty-pkg-v3.4.0.el9.x86_64.tgz
</span></span><span style=display:flex><span>8b2fcaa6ef6fd8d2726f6eafbb488aaf  pigsty-pkg-v3.4.0.u22.aarch64.tgz
</span></span><span style=display:flex><span>83291db7871557566ab6524beb792636  pigsty-pkg-v3.4.0.u22.x86_64.tgz
</span></span><span style=display:flex><span>c927238f0343cde82a4a9ab230ecd2ac  pigsty-pkg-v3.4.0.u24.aarch64.tgz
</span></span><span style=display:flex><span>14cbcb90693ed5de8116648a1f2c3e34  pigsty-pkg-v3.4.0.u24.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v330>v3.3.0</h2><ul><li>可用扩展总数增加到 <a href=/docs/pgsql/ext><strong>404</strong></a>！</li><li>PostgreSQL 二月小版本更新：17.4、16.8、15.12、14.17、13.20</li><li>新功能：<code>app.yml</code> 脚本，用于自动安装 Odoo、Supabase、Dify 等应用。</li><li>新功能：在 <code>infra_portal</code> 中进一步自定义 Nginx 配置。</li><li>新功能：增加 Certbot 支持，快速申请免费 HTTPS 证书。</li><li>新功能：<code>pg_default_extensions</code> 现在支持纯文本扩展列表。</li><li>新功能：默认仓库现在包含 mongo、redis、groonga、haproxy 等。</li><li>新参数：<code>node_aliases</code>，为节点添加命令别名。</li><li>修复：解决 Bootstrap 脚本中的默认 EPEL 仓库地址问题。</li><li>改进：为 Debian Security 仓库添加阿里云镜像。</li><li>改进：IvorySQL 内核的 pgBackRest 备份支持。</li><li>改进：PolarDB 的 ARM64 和 Debian/Ubuntu 支持。</li><li>pg_exporter 0.8.0 现在支持 pgbouncer 1.24 中的新指标。</li><li>新功能：<code>git</code>、<code>docker</code>、<code>systemctl</code> 等常用命令的自动补全 <a href=https://github.com/pgsty/pigsty/pull/506>#506</a> <a href=https://github.com/pgsty/pigsty/pull/507>#507</a> 由 <a href=https://github.com/waitingsong>@waitingsong</a> 提供。</li><li>改进：优化 <code>pgbouncer</code> 配置模板中的 <code>ignore_startup_parameters</code> <a href=https://github.com/pgsty/pigsty/pull/488>#488</a> 由 <a href=https://github.com/waitingsong>@waitingsong</a> 提供。</li><li>新主页设计：Pigsty 的网站现在拥有全新的外观。</li><li>扩展目录：RPM/DEB 二进制包的详细信息和下载链接。</li><li>扩展构建：<code>pig</code> CLI 现在自动设置 PostgreSQL 扩展构建环境。</li></ul><hr><p>更多版本信息请参考 <a href=https://github.com/pgsty/pigsty/releases>GitHub 发布页面</a>。</p><hr><h2 id=v322>v3.2.2</h2><ul><li>新增扩展包: <a href=https://pgext.cloud/e/omni><code>Omnigres</code></a> 33个扩展，将postgres作为应用开发平台</li><li>新增扩展: <a href=https://pgext.cloud/e/pg_mooncake><code>pg_mooncake</code></a>: postgres中的duckdb</li><li>新增扩展: <a href=https://pgext.cloud/e/xxhash><code>pg_xxhash</code></a></li><li>新增扩展: <a href=https://pgext.cloud/e/timescaledb_toolkit><code>timescaledb_toolkit</code></a></li><li>新增扩展: <a href=https://pgext.cloud/e/pg_xenophile><code>pg_xenophile</code></a></li><li>新增扩展: <a href=https://pgext.cloud/e/pg_drop_events><code>pg_drop_events</code></a></li><li>新增扩展: <a href=https://pgext.cloud/e/pg_incremental><code>pg_incremental</code></a></li><li>升级 <a href=https://github.com/citusdata/citus/tree/v13.0.0><code>citus</code></a> 至13.0.0，支持PostgreSQL 17</li><li>升级 <a href=https://github.com/postgresml/postgresml/releases/tag/v2.10.0><code>pgml</code></a> 至2.10.0</li><li>升级 <a href=https://pgext.cloud/e/pg_extra_time><code>pg_extra_time</code></a> 至2.0.0</li><li>升级 <a href=https://pgext.cloud/e/pg_vectorize><code>pg_vectorize</code></a> 至0.20.0</li></ul><p><strong>变更内容</strong></p><ul><li>升级IvorySQL至4.2版本(基于PostgreSQL 17.2)</li><li>为PolarDB内核添加Arm64和Debian支持</li><li>在默认<code>infra_packages</code>中添加certbot和certbot-nginx</li><li>增加pgbouncer的max_prepared_statements参数至256</li><li>移除<code>pgxxx-citus</code>包别名</li><li>在<code>pg_extensions</code>中默认隐藏<code>pgxxx-olap</code>类别（因为存在两对扩展冲突）</li></ul><hr><h2 id=v321>v3.2.1</h2><p><strong>亮点特性</strong></p><ul><li>PG扩展插件数量提升至350个，新增强力Rust扩展anon。</li><li>IvorySQL支持更新至PG17兼容的4.0版本</li><li>使用Pigsty编译的Citus，TimescaleDB与PGroonga。</li><li>添加Odoo一键自建模板与新app.yml剧本</li></ul><p>新增 13 扩展插件:</p><ul><li>新增 pg_anon 2.0.0</li><li>新增 omnisketch 1.0.2</li><li>新增 ddsketch 1.0.1</li><li>新增 pg_duration 1.0.1</li><li>新增 ddl_historization 0.0.7</li><li>新增 data_historization 1.1.0</li><li>新增 schedoc 0.0.1</li><li>新增 floatfile 1.3.1</li><li>新增 pg_upless 0.0.3</li><li>新增 pg_task 1.0.0</li><li>新增 pg_readme 0.7.0</li><li>新增 vasco 0.1.0</li><li>新增 pg_xxhash 0.0.1</li></ul><p>更新扩展版本</p><ul><li>lower_quantile 1.0.3</li><li>quantile 1.1.8</li><li>sequential_uuids 1.0.3</li><li>pgmq 1.5.0 (subdir)</li><li>floatvec 1.1.1</li><li>pg_parquet 0.2.0</li><li>wrappers 0.4.4</li><li>pg_later 0.3.0</li><li>topn fix for deb.arm64</li><li>add age 17 on debian</li><li>powa + pg17, 5.0.1</li><li>h3 + pg17</li><li>ogr_fdw + pg17</li><li>age + pg17 1.5 on debian</li><li>pgtap + pg17 1.3.3</li><li>repmgr</li><li>topn + pg17</li><li>pg_partman 5.2.4</li><li>credcheck 3.0</li><li>ogr_fdw 1.1.5</li><li>ddlx 0.29</li><li>postgis 3.5.1</li><li>tdigest 1.4.3</li><li>pg_repack 1.5.2</li></ul><hr><h2 id=v320>v3.2.0</h2><p><strong>亮点特性</strong></p><ul><li>Pigsty 命令行工具：<a href=https://github.com/pgsty/pig><code>pig</code></a> 0.2.0，可用于管理扩展插件。</li><li>提供五大发行版上 <a href=https://pgext.cloud/>390 个扩展</a> 的 ARM64 扩展支持</li><li>Supabase 发布周最新版本更新，全发行版均可自建。</li><li>Grafana 更新至 11.4 ，新增 infinity 数据源。</li></ul><p><strong>软件包变化</strong></p><ul><li><p><strong>新增扩展</strong></p><ul><li>新增 timescaledb, timescaledb-loader timescaledb-toolkit timescaledb-tool to PIGSTY repo</li><li>新增 <a href=https://github.com/timescale/timescaledb>pg_timescaledb</a>，针对 EL 进行的编译重制版本</li><li>新增 <a href=https://pgext.cloud/e/pgroonga>pgroonga</a>，针对 EL 全系进行编译重制</li><li>新增 <a href=https://github.com/tensorchord/VectorChord>vchord</a> 0.1.0</li><li>新增 <a href=https://github.com/tensorchord/pg_bestmatch.rs>pg_bestmatch.rs</a> 0.0.1</li><li>新增 <a href=https://github.com/frectonz/pglite-fusion>pglite_fusion</a> 0.0.3</li><li>新增 <a href=https://github.com/Florents-Tselai/pgpdf>pgpdf</a> 0.1.0</li></ul></li><li><p><strong>更新扩展</strong></p><ul><li>pgvectorscale 0.4.0 -> 0.5.1</li><li>pg_parquet 0.1.0 -> 0.1.1</li><li>pg_polyline 0.0.1</li><li>pg_cardano 1.0.2 -> 1.0.3</li><li>pg_vectorize 0.20.0</li><li>pg_duckdb 0.1.0 -> 0.2.0</li><li>pg_search 0.13.0 -> 0.13.1</li><li>aggs_for_vecs 1.3.1 -> 1.3.2</li><li><code>pgoutput</code> 被标记为新的 PostgreSQL Contrib 扩展</li></ul></li><li><p><strong>基础设施</strong></p><ul><li>新增 promscale 0.17.0</li><li>新增 grafana-plugins 11.4</li><li>新增 grafana-infinity-plugins</li><li>新增 grafana-victoriametrics-ds</li><li>新增 grafana-victorialogs-ds</li><li>vip-manager 2.8.0 -> 3.0.0</li><li>vector 0.42.0 -> 0.43.0</li><li>grafana 11.3 -> 11.4</li><li>prometheus 3.0.0 -> 3.0.1 (软件包名从 <code>prometheus2</code> 变更为 <code>prometheus</code>)</li><li>nginx_exporter 1.3.0 -> 1.4.0</li><li>mongodb_exporter 0.41.2 -> 0.43.0</li><li>VictoriaMetrics 1.106.1 -> 1.107.0</li><li>VictoriaLogs 1.0.0 -> 1.3.2</li><li>pg_timetable 5.9.0 -> 5.10.0</li><li>tigerbeetle 0.16.13 -> 0.16.17</li><li>pg_export 0.7.0 -> 0.7.1</li></ul></li><li><p><strong>缺陷修复</strong></p><ul><li>el8.aarch64 添加 python3-cdiff 修复 patroni 依赖错漏问题</li><li>el9.aarch64 添加 timescaledb-tools ，修复官方仓库缺失问题</li><li>el9.aarch64 添加 pg_filedump ，修复官方仓库缺失问题</li></ul></li><li><p><strong>移除扩展</strong></p><ul><li><strong>pg_mooncake</strong> 因为与 <code>pg_duckdb</code> 冲突而被移除。</li><li><strong>pg_top</strong> 因为出现太多版本出现缺失，因质量问题而淘汰。</li><li><strong>hunspell_pt_pt</strong> 因为与 PG 官方字典文件冲突而被淘汰。</li><li><strong>pg_timeit</strong> 因为无法在 AARCH64 架构上使用而被淘汰。</li><li><strong>pgdd</strong> 因为缺乏维护，PG 17 与 pgrx 版本老旧而被标记为弃用。</li><li><strong>old_snapshot</strong> 与 <strong>adminpack</strong> 被标记为 PG 17 不可用。</li><li><strong>pgml</strong> 被设置为默认不下载不安装。</li></ul></li></ul><p><strong>API变化</strong></p><ul><li><a href=https://pigsty.cc/zh/docs/infra/param#repo_url_packages><code>repo_url_packages</code></a> 参数现在默认值为空数组，因为所有软件包现在都通过操作系统包管理器进行安装。</li><li><code>grafana_plugin_cache</code> 参数弃用，现在 Grafana 插件通过操作系统包管理器进行安装</li><li><code>grafana_plugin_list</code> 参数弃用，现在 Grafana 插件通过操作系统包管理器进行安装</li><li>原名为 <code>prod</code> 的 36 节点仿真模板现在重命名为 <code>simu</code>。</li><li>原本在 <code>node_id/vars</code> 针对每个发行版代码生成的配置，现在同样针对 <code>aarch64</code> 生成。</li><li><code>infra_packages</code> 中默认添加命令行管理工具 <code>pig</code></li><li><code>configure</code> 命令同样会修改自动生成配置文件中 <code>pgsql-xxx</code> 别名的版本号。</li><li><code>adminpack</code> 在 PG 17 中被移除，因此从 Pigsty 默认扩展中被移除。</li></ul><p><strong>问题修复</strong></p><ul><li>修复了 <code>pgbouncer</code> 仪表盘选择器问题 <a href=https://github.com/pgsty/pigsty/issues/474>#474</a></li><li><code>pg-pitr</code> 新增 <code>--arg value</code> 参数解析支持 by <a href="https://github.com/pgsty/pigsty/pulls?q=is%3Apr+author%3Awaitingsong">@waitingsong</a></li><li>修复 Redis 日志信息 typo by <a href=https://github.com/Vonng/pigsty/pull/476>@waitingsong</a></li></ul><p><strong>软件包校验和</strong></p><pre tabindex=0><code>8fdc6a60820909b0a2464b0e2b90a3a6  pigsty-v3.2.0.tgz
d2b85676235c9b9f2f8a0ad96c5b15fd  pigsty-pkg-v3.2.0.el9.aarch64.tgz
649f79e1d94ec1845931c73f663ae545  pigsty-pkg-v3.2.0.el9.x86_64.tgz
c42da231067f25104b71a065b4a50e68  pigsty-pkg-v3.2.0.d12.aarch64.tgz
ebb818f98f058f932b57d093d310f5c2  pigsty-pkg-v3.2.0.d12.x86_64.tgz
24c0be1d8436f3c64627c12f82665a17  pigsty-pkg-v3.2.0.u22.aarch64.tgz
0b9be0e137661e440cd4f171226d321d  pigsty-pkg-v3.2.0.u22.x86_64.tgz
</code></pre><hr><h2 id=v310>v3.1.0</h2><p><strong>亮点特性</strong></p><ul><li>PostgreSQL 17 现已成为默认使用的主要版本 (17.2)</li><li>Ubuntu 24.04 系统支持</li><li>arm 架构支持：EL9, Debian12, Ubuntu 22.04</li><li>Supabase 一键自建，新的剧本 <code>supabase.yml</code></li><li>MinIO 最佳实践改进，配置模板与 Vagrant 模板</li><li>提供了一系列开箱即用的配置模板与文档说明。</li><li>允许在 <code>configure</code> 过程中使用 <code>-v|--version</code> 指定使用的 PG 大版本。</li><li>调整 PG 默认插件策略：默认安装 <code>pg_repack</code>, <code>wal2json</code> 以及 <code>pgvector</code> 三个关键扩展。</li><li>大幅简化 <code>repo_packages</code> 本地软件源构建逻辑，允许在 <code>repo_packages</code> 中使用软件包组别名</li><li>提供了 WiltonDB，IvorySQL，PolarDB 的软件源镜像，简化三者的安装。</li><li>默认启用数据库校验和。</li><li>修复 ETCD 与 MINIO 日志面板</li></ul><p><strong>软件升级</strong></p><ul><li>PostgreSQL 17.2, 16.6, 15.10, 14.15, 13.18, 12.22</li><li>PostgreSQL 扩展版本变动请参考：https://pgext.cloud</li><li>Patroni 4.0.4</li><li>MinIO 20241107 / MCLI 20241117</li><li>Rclone 1.68.2</li><li>Prometheus: 2.54.0 -> 3.0.0</li><li>VictoriaMetrics 1.102.1 -> 1.106.1</li><li>VictoriaLogs v0.28.0 -> 1.0.0</li><li>vslogcli 1.0.0</li><li>MySQL Exporter 0.15.1 -> 0.16.0</li><li>Redis Exporter 1.62.0 -> 1.66.0</li><li>MongoDB Exporter 0.41.2 -> 0.42.0</li><li>Keepalived Exporter 1.3.3 -> 1.4.0</li><li>DuckDB 1.1.2 -> 1.1.3</li><li>etcd 3.5.16 -> 3.5.17</li><li>tigerbeetle 16.8 -> 0.16.13</li></ul><p><strong>API变更</strong></p><ul><li><code>repo_upstream</code>: 针对每个具体的操作系统发行版生成默认值：<a href=https://github.com/Vonng/pigsty/tree/main/roles/node_id/vars><code>roles/node_id/vars</code></a></li><li><code>repo_packages</code>: 允许使用 <code>package_map</code> 中定义的别名。</li><li><code>repo_extra_packages</code>: 新增未指定时的默认值，允许使用 <code>package_map</code> 中定义的别名。</li><li><code>pg_checksum</code>: 默认值修改为 <code>true</code>，默认打开。</li><li><code>pg_packages</code>: 默认值修改为：<code>postgresql, wal2json pg_repack pgvector, patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager</code></li><li><code>pg_extensions</code>: 默认值修改为空数组 <code>[]</code>。</li><li><code>infra_portal</code>: 允许为 <code>home</code> 服务器指定 <code>path</code>，替代默认的本地仓库路径 <code>nginx_home</code> (<code>/www</code>)</li></ul><p><strong>校验和</strong></p><pre tabindex=0><code>e62f9ce9f89a58958609da7b234bf2f2  pigsty-v3.1.0.tgz
</code></pre><hr><h2 id=v304>v3.0.4</h2><p><strong>特性</strong></p><ul><li>针对 PostgreSQL 17 编译了所有支持的 Pigsty 扩展插件</li><li>提供了全新的 OLAP 扩展支持：<code>pg_duckdb</code> 与 <code>pg_parquet</code></li><li>简化并优化了最新版本 Supabase 自建的流程</li><li>新增参数 <code>docker_image</code>，允许在 Docker 安装后自动拉取镜像。</li></ul><p><strong>扩展</strong></p><p>欢迎查阅我们最新的 PostgreSQL 扩展目录： <a href=https://pgext.cloud>https://pgext.cloud</a></p><table><thead><tr><th style=text-align:center>统计项</th><th style=text-align:center>总计</th><th style=text-align:center>PGDG</th><th style=text-align:center>PIGSTY</th><th style=text-align:center>MISC</th><th style=text-align:center>MISS</th><th style=text-align:center>PG17</th><th style=text-align:center>PG16</th><th style=text-align:center>PG15</th><th style=text-align:center>PG14</th><th style=text-align:center>PG13</th><th style=text-align:center>PG12</th></tr></thead><tbody><tr><td style=text-align:center>EL系统扩展</td><td style=text-align:center>338</td><td style=text-align:center>134</td><td style=text-align:center>130</td><td style=text-align:center>4</td><td style=text-align:center>7</td><td style=text-align:center>298</td><td style=text-align:center>334</td><td style=text-align:center>336</td><td style=text-align:center>328</td><td style=text-align:center>319</td><td style=text-align:center>310</td></tr><tr><td style=text-align:center>Deb系统扩展</td><td style=text-align:center>326</td><td style=text-align:center>109</td><td style=text-align:center>143</td><td style=text-align:center>74</td><td style=text-align:center>19</td><td style=text-align:center>290</td><td style=text-align:center>322</td><td style=text-align:center>324</td><td style=text-align:center>316</td><td style=text-align:center>307</td><td style=text-align:center>300</td></tr><tr><td style=text-align:center>RPM 软件包</td><td style=text-align:center>313</td><td style=text-align:center>122</td><td style=text-align:center>129</td><td style=text-align:center>4</td><td style=text-align:center>6</td><td style=text-align:center>275</td><td style=text-align:center>309</td><td style=text-align:center>311</td><td style=text-align:center>303</td><td style=text-align:center>294</td><td style=text-align:center>285</td></tr><tr><td style=text-align:center>DEB 软件包</td><td style=text-align:center>298</td><td style=text-align:center>93</td><td style=text-align:center>142</td><td style=text-align:center>64</td><td style=text-align:center>19</td><td style=text-align:center>264</td><td style=text-align:center>294</td><td style=text-align:center>296</td><td style=text-align:center>288</td><td style=text-align:center>279</td><td style=text-align:center>272</td></tr></tbody></table><p><strong>版本升级</strong></p><ul><li><p><strong>新的PGSQL扩展</strong></p><ul><li><a href=https://github.com/CrunchyData/pg_parquet/>pg_parquet</a></li><li><a href=https://github.com/davidgomes/pg-explain-ui>pg_explain_ui</a></li><li><a href=https://github.com/yihong0618/pg_polyline>pg_polyline</a></li><li><a href=https://github.com/Fell-x27/pg_cardano>pg_cardano</a></li><li><a href=https://github.com/Fell-x27/pg_base58>pg_base58</a></li><li><a href=https://github.com/HexaCluster/pg_summarize>pg_summarize</a></li><li><a href=https://pgxn.org/dist/pg_relusage/0.0.1/>pg_relusage</a></li><li><a href=https://github.com/tembo-io/pgmq>pgmq</a></li><li><a href=https://github.com/tembo-io/pg_timeseries>pg_timeseries</a></li><li><a href=https://github.com/pgexperts/pg_plan_filter>pg_plan_filter</a></li></ul></li><li><p><strong>升级与跟进PG扩展</strong></p><ul><li>pg_search 0.11.0</li><li>pg_analytics 0.2.0</li><li>plv8 3.2.3</li><li>supautils 2.5.0</li><li>icu_ext 1.9.0</li><li>redis_fdw 17</li><li>pg_failover_slots 1.1.0</li><li>pg_later 0.1.3</li><li>plprql 1.0.0</li><li>pg_vectorize 0.18.3</li><li>unit 7.7 -> 7.9</li><li>log_fdw 1.4</li><li>pg_duckdb 0.1.0</li><li>pg_graphql 1.5.9 (+17)</li><li>pg_jsonschema 0.3.2 (+17)</li><li>pgvectorscale 0.4.0 (+17)</li><li>wrappers 0.4.3 +pg17</li><li>pg_ivm 1.9</li><li>pg_timeseries 0.1.6</li><li>pgmq 1.4.4</li><li>pg_protobuf 16 17</li><li>pg_uuidv7 1.6</li><li>pg_readonly</li><li>pgddl 0.28</li><li>pg_safeupdate</li><li>pg_stat_monitor 2.1</li><li>pg_profile 4.7</li><li>system_stats 3.2</li><li>pg_auth_mon 3.0</li><li>login_hook 1.6</li><li>logerrors 2.1.3</li><li>pg-orphaned</li><li>pgnodemx 1.7</li><li>sslutils 1.4 (deb+pg16,17)</li><li>timestamp9 (deb)</li></ul></li><li><p><strong>修复不支持PG16/17的扩展</strong></p><ul><li>pg_mon</li><li>pg_uri</li><li>agg_for_vecs</li><li>quantile</li><li>lower_quantile</li><li>pg_protobuf</li><li>acl</li><li>pg_emailaddr</li><li>pg_zstd</li><li>smlar</li><li>geohash</li><li>pgsmcrypto (+17)</li><li>pg_tiktoken (+17)</li><li>pg_idkit (+17)</li></ul></li><li><p><strong>基础设施软件包</strong></p><ul><li>Grafana 11.3</li><li>duckdb 1.1.2</li><li>etcd 3.5.16</li><li>ferretdb 1.24.0</li><li>minio 20241013133411</li><li>mcli 2024101313411</li><li>pushgateway 1.10</li><li>tigerbeetle 0.16.8</li><li>mongodb_exporter 0.41.2</li><li>redis_exporter 1.64.1</li><li>vector 0.41.1</li><li>vip-manager 2.7</li><li>sealos 5.0.1</li></ul></li></ul><hr><h2 id=v303>v3.0.3</h2><p><strong>特性</strong></p><ul><li>提供对最新发布的 PostgreSQL 17 支持。</li><li>优化了 etcd 配置，监控，与告警规则</li><li>（Oracle兼容的）IvorySQL 3.4 支持，与 PostgreSQL 16.4 同步</li></ul><p><strong>版本升级</strong></p><ul><li>PostGIS 3.5</li><li>Grafana 11.2</li><li>duckdb 1.1</li><li>pg_search 0.10.2</li><li>pg_analytics 0.1.4</li></ul><hr><h2 id=v302>v3.0.2</h2><p><strong>特性</strong></p><ul><li><a href=https://pigsty.io/docs/setup/slim/>精简安装模式</a>：使用 <code>slim.yml</code> 进行最精简的 HA PGSQL 部署。</li><li><a href=https://github.com/ApsaraDB/PolarDB-for-PostgreSQL>PolarDB PG 15</a> 的原生支持。</li><li>优化 <code>monitor.pg_table_bloat</code> 与 <code>monitor.pg_index_bloat</code>，使用安全定义包装函数规避 PolarDB 统计视图权限问题。</li><li>在各模块的监控注册阶段，尊重 <code>prometheus_enabled</code> 与 <code>grafana_enabled</code> 配置选项，关闭时不再注册。</li><li>在 <code>/etc/profile.d/pgsql.sh</code> 中添加 <code>PGDATABASE</code> 与 <code>PGPORT</code> 环境变量，设置为 <code>pg_primary_db</code>（默认<code>postgres</code>）</li></ul><p><strong>变更</strong></p><ul><li>在 Pigsty PGSQL 仓库中移除 PolarDB 11 与 CloudberryDB 1.5.4 的 RPM/APT 包。</li><li>使用专用的仓库分发 PolarDB 15 与 CloudberryDB 1.6.0 的 RPM/APT 包。</li></ul><p><strong>问题修复</strong></p><ul><li>修复 Redis 的 <code>/etc/tmp.files.d</code> 文件名错误。</li><li>在管理 pgbouncer 用户时，设置 <code>PGHOST</code> 与 <code>PGPORT</code> 环境变量。</li><li>临时移除 <code>pg_snakeoil</code> 扩展支持，因为 EL8 上游源 <code>clamv</code> 出现依赖缺失问题。</li><li>移除 <code>pgsql</code> 角色的 Notify / Handler，以兼容更老的 Ansible 2.9 版本。</li></ul><hr><h2 id=v301>v3.0.1</h2><p><strong>特性改进</strong></p><ul><li>PolarDB Oracle 兼容性模式支持（需要第三方商业闭源内核）</li><li>使用 Oracle 兼容的 SQL 语法改写监控视图与相关 SQL 语句</li><li>Patroni <a href=https://patroni.readthedocs.io/en/latest/releases.html>4</a> 支持与适配</li><li>新增扩展 <code>pg_analytics</code>，通过 duckdb 为 PG 加装分析能力</li><li>添加新扩展：<code>odbc_fdw</code> 与 <code>jdbc_fdw</code>，提供通用的外部数据源连接能力</li><li>仓库添加新内核 <code>cloudberrydb</code> (Greenplum 原班开发者的开源分支)</li><li>仓库添加新工具 <code>walminer</code>，从WAL（replica等级）中提取原始 SQL。（高级特性需自行购买License）</li><li>更新执行计划可视化工具 Pev2 版本至 1.12.1</li><li>新增Grafana插件：<code>volkovlabs-rss-datasource</code></li><li>在PGCAT databases监控面板中添加了已安装和待安装的扩展插件</li><li>PGSQL 主库初始化后，会重启一次以便 pg_param & pg_files 生效，因此 Supabase PG / PolarDB 集群置备后无需重启。</li></ul><p><strong>问题修复</strong></p><ul><li>修复了 Grafana 11.1.4 面板插件默认不加载的问题</li><li>修复了特定操作系统上 BlackBox Exporter Ping 探针失效的问题</li><li>确保 /var/run/postgresql 与 /var/run/redis 临时目录总是在重启后自动创建</li><li>修复了 <code>cache.yml</code> 剧本没有正确移除老旧的 patroni 3.0.4 RPM 包问题</li><li>修复了个别告警规则中的描述信息错误</li><li>移除了 Patroni 配置文件中过时的 Bootstrap User/HBA 参数</li></ul><hr><h2 id=v300>v3.0.0</h2><p><strong>亮点特性</strong></p><ul><li><strong>扩展大爆炸</strong>：</li></ul><p>Pigsty v3 提供了史无前例的 <a href=/docs/pgsql/ext/><strong>333</strong></a> 个可用扩展插件。
包括 <strong>121</strong> 个扩展 <a href=/docs/pgsql/ext/><strong>RPM包</strong></a> 与 <strong>133</strong> 个 <a href=/docs/pgsql/ext/><strong>DEB包</strong></a>，数量已经超过了 PGDG 官方仓库提供的扩展数量总和（135 RPM/ 109 DEB）。
而且，Pigsty 还将EL系统与Debian生态的独有PG扩展插件相互移植，实现了两大发行版的插件生态大对齐。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#000>timescaledb periods temporal_tables emaj table_version pg_cron pg_later pg_background pg_timetable</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>postgis pgrouting pointcloud pg_h3 q3c ogr_fdw geoip #pg_geohash</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#mobilitydb</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pgvector pgvectorscale pg_vectorize pg_similarity pg_tiktoken pgml</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#smlar</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pg_search pg_bigm zhparser hunspell</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>hydra pg_lakehouse pg_duckdb duckdb_fdw pg_fkpart pg_partman plproxy</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pg_strom citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pg_hint_plan age hll rum pg_graphql pg_jsonschema jsquery index_advisor hypopg imgsmlr pg_ivm pgmq pgq</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#rdkit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pg_tle plv8 pllua plprql pldebugger plpgsql_check plprofiler plsh</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pljava plr pgtap faker dbt2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>prefix semver pgunit md5hash asn1oid roaringbitmap pgfaceting pgsphere pg_country pg_currency pgmp numeral pg_rational pguint ip4r timestamp9 chkpass #pg_uri #pgemailaddr #acl #debversion</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pg_rrule</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>topn pg_gzip pg_http pg_net pg_html5_email_address pgsql_tweaks pg_extra_time pg_timeit count_distinct extra_window_functions first_last_agg tdigest aggs_for_arrays pg_arraymath pg_idkit pg_uuidv7 permuteseq pg_hashids</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>sequential_uuids pg_math pg_random pg_base36 pg_base62 floatvec pg_financial pgjwt pg_hashlib shacrypt cryptint pg_ecdsa pgpcre icu_ext envvar url_encode #pg_zstd #aggs_for_vecs #quantile #lower_quantile #pgqr</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pg_protobuf</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pg_repack pg_squeeze pg_dirtyread pgfincore pgdd ddlx pg_prioritize pg_checksums pg_readonly safeupdate pg_permissions pgautofailover pg_catcheck preprepare pgcozy pg_orphaned pg_crash pg_cheat_funcs pg_savior table_log pg_fio</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pgpool pgagent</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pg_profile pg_show_plans pg_stat_kcache pg_stat_monitor pg_qualstats pg_store_plans pg_track_settings pg_wait_sampling system_stats pg_meta pgnodemx pg_sqlog bgw_replstatus pgmeminfo toastinfo pagevis powa pg_top #pg_statviz #pgexporter_ext</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#pg_mon</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>passwordcheck supautils pgsodium pg_vault anonymizer pg_tde pgsmcrypto pgaudit pgauditlogtofile pg_auth_mon credcheck pgcryptokey pg_jobmon logerrors login_hook set_user pg_snakeoil pgextwlist pg_auditor noset</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#sslutils</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>wrappers multicorn mysql_fdw tds_fdw sqlite_fdw pgbouncer_fdw mongo_fdw redis_fdw pg_redis_pubsub kafka_fdw hdfs_fdw firebird_fdw aws_s3 log_fdw #oracle_fdw</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#db2_fdw</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>orafce pgtt session_variable pg_statement_rollback pg_dbms_metadata pg_dbms_lock pgmemcache #pg_dbms_job</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#wiltondb</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>pglogical pgl_ddl_deploy pg_failover_slots wal2json wal2mongo decoderbufs decoder_raw mimeo pgcopydb pgloader pg_fact_loader pg_bulkload pg_comparator pgimportdoc pgexportdoc #repmgr</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#slony</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>gis-stack rag-stack fdw-stack fts-stack etl-stack feat-stack olap-stack supa-stack stat-stack json-stack</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li><strong>可插拔内核</strong>：</li></ul><p>Pigsty v3 允许您更换 PostgreSQL 内核，目前支持了 SQL Server 兼容的 Babelfish （线缆协议级仿真），Oracle 兼容的 IvorySQL，以及 PG 版的 RAC PolarDB；此外，现在自托管 Supabase 也在 Debian 系统中可用。
您可以让 Pigsty 中带有 HA，IaC，PITR，监控的生产级 PostgreSQL 集群仿真 MSSQL (via WiltonDB)，Oracle via (IvorySQL)，Oracle RAC (via PolarDB), MongoDB（via FerretDB），以及 Firebase （via Supabase）。</p><ul><li><strong>专业级服务</strong>：</li></ul><p>我们现在提供 Pigsty Pro <a href=/docs/about/service><strong>专业版</strong></a>，在开源版的功能基础上提供增值服务。专业版提供额外的功能模块：MSSQL，Oracle，Mongo，K8S，Victoria，Kafka，TigerBeetle 等……，并提供更广泛的 PG 大版本、操作系统、芯片架构的支持。
提供针对全系操作系统精准小版本定制的离线安装包，以及 EL7，Debian 11，Ubuntu 20.04 等过保老系统的支持；此外，专业版还提供内核可插拔定制服务，并对PolarDB PG 的原生部署、监控管控支持以满足“国产化”需要。</p><p>使用以下命令快速安装体验：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span> ./bootstrap<span style=color:#000;font-weight:700>;</span> ./configure<span style=color:#000;font-weight:700>;</span> ./install.yml
</span></span></code></pre></div><hr><p><strong>重大变更</strong></p><p>本次 Pigsty 发布调整大版本号，从 2.x 升级到 3.0，带有一些重大变更：</p><ul><li><p>首要支持操作系统调整为：EL 8 / EL 9 / Debian 12 / Ubuntu 22.04</p><ul><li>EL7 / Debian 11 / Ubuntu 20.04 等系统进入弃用阶段，不再提供支持</li><li>有在这些系统上运行需求的用户请考虑我们的 <a href=https://pigsty.io/zh/docs/about/service>订阅服务</a></li></ul></li><li><p>默认使用在线安装，不再提供离线软件包，从而解决操作系统小版本兼容性问题。</p><ul><li><code>bootstrap</code> 过程现在不再询问是否下载离线安装包，但如果 <code>/tmp/pkg.tgz</code> 存在，仍然会自动使用离线安装包。</li><li>有离线安装需求请自行制作离线软件包或考虑我们的 <a href=https://pigsty.io/zh/docs/about/service>订阅服务</a></li></ul></li><li><p>Pigsty 使用的上游软件仓库进行统一调整，地址变更，并对所有软件包进行 GPG 签名与校验</p><ul><li>标准仓库： <code>https://repo.pigsty.io/{apt/yum}</code></li><li>国内镜像： <code>https://repo.pigsty.cc/{apt/yum}</code></li></ul></li><li><p>API 参数变更与配置模板变更</p><ul><li>EL 系与 Debian 系配置模板现在收拢统一，有差异的参数统一放置于 <a href=https://github.com/Vonng/pigsty/tree/master/roles/node_id/vars><code>roles/node_id/vars/</code></a> 目录进行管理。</li><li>配置目录变更，所有配置文件模板统一放置在 <code>conf</code> 目录下，并分为 <code>default</code>, <code>dbms</code>, <code>demo</code>, <code>build</code> 四大类。</li></ul></li></ul><hr><p><strong>其他新特性</strong></p><ul><li>PG OLAP 分析能力史诗级加强：DuckDB 1.0.0，DuckDB FDW，以及 PG Lakehouse，Hydra 移植至 Deb 系统中。</li><li>PG 向量检索与全文检索能力加强：Vectorscale 提供 DiskANN 向量索引，Hunspell 分词字典支持，pg_search 0.8.6。</li><li>帮助 ParadeDB 解决了软件包构建问题，现在我们在 Debian/Ubuntu 上也能提供这一扩展。</li><li>Supabase 所需的扩展在 Debian/Ubuntu 上全部可用，Supabase 现在可在全OS上自托管。</li><li>提供了场景化预置扩展堆栈的能力，如果您不知道安装哪些扩展，我们准备了针对特定应用场景的扩展推荐包（Stack）。</li><li>针对所有 PostgreSQL 生态的扩展，制作了元数据表格、文档、索引、名称映射，针对 EL与Deb 进行对齐，确保扩展可用性。</li><li>为了解决 DockerHub 被 Ban 的问题，我们加强了 <code>proxy_env</code> 参数的功能并简化其配置方式。</li><li>建设了一个专用的新软件仓库，提供了 12-17 版本的全部扩展插件，其中，PG16的扩展仓库会在 Pigsty 默认的版本中实装。</li><li>现有软件仓库升级改造，使用标准的签名与校验机制，确保软件包的完整性与安全性。APT 仓库采用新的标准布局通过 <code>reprepro</code> 构建。</li><li>提供了 1,2,3,4,43 节点的沙箱环境：<code>meta</code>, <code>dual</code>, <code>trio</code>, <code>full</code>, <code>prod</code>，以及针对 7 大 OS Distro 的快捷配置模板。</li><li>PG Exporter 新增了 PostgreSQL 17 与 pgBouncer 1.23 新监控指标收集器的定义，与使用这些指标的 Grafana Panel</li><li>监控面板修缮，修复了各种问题，为 PGSQL Pgbouncer 与 PGSQL Patroni 监控面板添加了日志仪表盘。</li><li>使用全新的 <code>cache.yml</code> Ansible 剧本，替换了原有制作离线软件包的 <code>bin/cache</code> 与 <code>bin/release-pkg</code> 脚本。</li></ul><hr><p><strong>API变更</strong></p><ul><li>新参数选项： <code>pg_mode</code> 现在支持的模式有 <code>pgsql</code>, <code>citus</code>, <code>gpsql</code>, <code>mssql</code>, <code>ivory</code>, <code>polar</code>，用于指定 PostgreSQL 集群的模式<ul><li><code>pgsql</code>： 标准 PostgreSQL 高可用集群</li><li><code>citus</code>： Citus 水平分布式 PostgreSQL 原生高可用集群</li><li><code>gpsql</code>： 用于 Greenplum 与 GP 兼容数据库的监控（专业版）</li><li><code>mssql</code>： 安装 WiltonDB / Babelfish，提供 Microsoft SQL Server 兼容性模式的标准 PostgreSQL 高可用集群，线缆协议级支持，扩展不可用</li><li><code>ivory</code>： 安装 IvorySQL 提供的 Oracle 兼容性 PostgreSQL 高可用集群，Oracle语法/数据类型/函数/存储过程兼容，扩展不可用 （专业版）</li><li><code>polar</code>： 安装 PolarDB for PostgreSQL （PG RAC）开源版本，提供国产化数据库能力支持，扩展不可用。（专业版）</li></ul></li><li>新参数： <code>pg_parameters</code>，用于在实例级别指定 <code>postgresql.auto.conf</code> 中的参数，覆盖集群配置，实现不同实例成员的个性化配置。</li><li>新参数： <code>pg_files</code>，用于将额外的文件拷贝到PGDATA数据目录，针对需要License文件的商业版PostgreSQL分叉内核设计。</li><li>新参数： <code>repo_extra_packages</code>，用于额外指定需要下载的软件包，与 <code>repo_packages</code> 共同使用，便于指定OS版本独有的扩展列表。</li><li>参数重命名： <code>patroni_citus_db</code> 重命名为 <code>pg_primary_db</code>，用于指定集群中的主要数据库（在 Citus 模式中使用）</li><li>参数强化：<code>proxy_env</code> 中的代理服务器配置会写入 Docker Daemon，解决科学上网问题，<code>configure -x</code> 选项会自动在配置中写入当前环境中的代理服务器配置。</li><li>参数强化：<code>infra_portal</code> 参数现在支持指定 <code>path</code> 选项，对外暴露本机上的目录，提供web服务。</li><li>参数强化：<code>repo_url_packages</code> 中的 <code>repo.pigsty.io</code> 会在区域为中国时自动替换为 <code>repo.pigsty.cc</code>，解决科学上网问题，此外，现在可以指定下载后的文件名称。</li><li>参数强化：<code>pg_databases.extensions</code> 中的 <code>extension</code> 字段现在可以支持字典与扩展名字符串两种模式，字典模式提供 <code>version</code> 支持，允许安装特定版本的扩展。</li><li>参数强化：<code>repo_upstream</code> 参数如果没有显式覆盖定义，将从 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>rpm.yml</code></a> 或 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>deb.yml</code></a> 中定义的 <code>repo_upstream_default</code> 提取对应系统的默认值。</li><li>参数强化：<code>repo_packages</code> 参数如果没有显式覆盖定义，将从 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>rpm.yml</code></a> 或 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>deb.yml</code></a> 中定义的 <code>repo_packages_default</code> 提取对应系统的默认值。</li><li>参数强化：<code>infra_packages</code> 参数如果没有显式覆盖定义，将从 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>rpm.yml</code></a> 或 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>deb.yml</code></a> 中定义的 <code>infra_packages_default</code> 提取对应系统的默认值。</li><li>参数强化：<code>node_default_packages</code> 参数如果没有显式覆盖定义，将从 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>rpm.yml</code></a> 或 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>deb.yml</code></a> 中定义的 <code>node_packages_default</code> 提取对应系统的默认值。</li><li>参数强化：<code>pg_packages</code> 与 <code>pg_extensions</code> 中的扩展现在都会从 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>rpm.yml</code></a> 或 <a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/rpm.yml><code>deb.yml</code></a> 中定义的 <code>pg_package_map</code> 执行一次查找与翻译。</li><li>参数强化：<code>node_packages</code> 与 <code>pg_extensions</code> 参数中指定的软件包在安装时会升级至最新版本， <code>node_packages</code> 中现在默认值变为 <code>[openssh-server</code>]，帮助修复 <a href=https://pigsty.io/zh/blog/db/cve-2024-6387/>OpenSSH CVE</a></li><li>参数强化：<code>pg_dbsu_uid</code> 会自动根据操作系统类型调整为 <code>26</code> （EL）或 <code>543</code> （Debian），避免了手工调整。</li><li>设置了 pgbouncer 默认参数，<code>max_prepared_statements = 128</code> 启用了事物池化模式下的准备语句支持，并设置 <code>server_lifetime</code> 为 600，</li><li>修改了 patroni 模板默认参数，统一增大 <code>max_worker_processes</code> +8 可用后端进程，提高 <code>max_wal_senders</code> 与 <code>max_replication_slots</code> 至 50，并增大 OLAP 模板临时文件的大小限制为主磁盘的 1/5</li></ul><hr><p><strong>版本升级</strong></p><p>截止至发布时刻，Pigsty 主要组件的版本升级如下：</p><ul><li><a href=https://www.postgresql.org/about/news/postgresql-164-158-1413-1316-1220-and-17-beta-3-released-2910/><strong>PostgreSQL</strong></a> 16.4, 15.8, 14.13, 13.16, 12.20</li><li><a href=https://github.com/Vonng/pg_exporter>pg_exporter</a> : 0.7.0</li><li><a href=https://patroni.readthedocs.io/en/latest/>Patroni</a>: 3.3.2</li><li><a href=https://www.pgbouncer.org/2024/08/pgbouncer-1-23-1>pgBouncer</a>: 1.23.1</li><li><a href=https://pgbackrest.org/release.html#2.53.1>pgBackRest</a>: 2.53.1</li><li><a href=https://github.com/duckdb/duckdb>duckdb</a> : 1.0.0</li><li><a href=https://github.com/etcd-io/etcd>etcd</a> : 3.5.15</li><li><a href=https://github.com/cybertec-postgresql/pg_timetable>pg_timetable</a>: 5.9.0</li><li><a href=https://github.com/FerretDB/FerretDB>ferretdb</a>: 1.23.1</li><li><a href=https://github.com/cybertec-postgresql/vip-manager>vip-manager</a>: 2.6.0</li><li><a href=https://github.com/minio/minio>minio</a>: 20240817012454</li><li><a href=https://github.com/minio/mc>mcli</a>: 20240817113350</li><li><a href=https://github.com/grafana/grafana/>grafana</a> : 11.1.4</li><li><a href=https://github.com/grafana/loki>loki</a> : 3.1.1</li><li><a href=https://github.com/grafana/loki>promtail</a> : 3.0.0</li><li><a href=https://github.com/prometheus/prometheus>prometheus</a> : 2.54.0</li><li><a href=https://github.com/prometheus/pushgateway>pushgateway</a> : 1.9.0</li><li><a href=https://github.com/prometheus/alertmanager>alertmanager</a> : 0.27.0</li><li><a href=https://github.com/prometheus/blackbox_exporter>blackbox_exporter</a> : 0.25.0</li><li><a href=https://github.com/nginxinc/nginx-prometheus-exporter>nginx_exporter</a> : 1.3.0</li><li><a href=https://github.com/prometheus/node_exporter>node_exporter</a> : 1.8.2</li><li><a href=https://github.com/gen2brain/keepalived_exporter>keepalived_exporter</a> : 0.7.0</li><li><a href=https://github.com/woblerr/pgbackrest_exporter>pgbackrest_exporter</a> 0.18.0</li><li><a href=https://github.com/prometheus/mysqld_exporter>mysqld_exporter</a> : 0.15.1</li><li><a href=https://github.com/oliver006/redis_exporter>redis_exporter</a> : v1.62.0</li><li><a href=https://github.com/danielqsj/kafka_exporter>kafka_exporter</a> : 1.8.0</li><li><a href=https://github.com/percona/mongodb_exporter>mongodb_exporter</a> : 0.40.0</li><li><a href=https://github.com/VictoriaMetrics/VictoriaMetrics>VictoriaMetrics</a> : 1.102.1</li><li><a href=https://github.com/VictoriaMetrics/VictoriaMetrics/releases>VictoriaLogs</a> : v0.28.0</li><li><a href=https://github.com/labring/sealos>sealos</a>: 5.0.0</li><li><a href=https://github.com/vectordotdev/vector/releases>vector</a> : 0.40.0</li></ul><p>Pigsty 重新编译了所有 PostgreSQL 扩展插件，PostgreSQL 扩展插件的最新版本，可用的 333 个扩展插件请参考 <a href=/docs/pgsql/ext/><strong>扩展列表</strong></a></p><p><strong>新应用</strong></p><p>Pigsty 现在提供开箱即用的 Dify 与 Odoo 两款使用 PostgreSQL 软件的 Docker Compose 模板：</p><ul><li><a href=/docs/app/dify>Dify</a>： AI智能体工作流编排与 LLMOps，使用 PostgreSQL 作为元数据库，PGVector 作为向量存储。</li><li><a href=/docs/app/odoo>Odoo</a>： 企业级开源 ERP 系统，使用 PostgreSQL 作为底层数据库。</li></ul><p>Pigsty 专业版现在提供试点的 Kubernetes 部署支持与 Kafka KRaft 集群部署与监控支持</p><ul><li><strong><code>KUBE</code></strong>： 使用 cri-dockerd 或 containerd 部署由 Pigsty 托管的 Kubernetes 集群</li><li><strong><code>KAFKA</code></strong>：部署由 Kraft 协议支持的高可用 Kafka 集群</li></ul><p><strong>问题修复</strong></p><ul><li>修复了 Ubuntu / Debian 系统中，节点重启后可能出现的 postgresql-common 服务自动启动替代默认数据库集群的缺陷</li><li>通过 <code>node_packages</code> 中的默认值 <code>[openssh-server</code>]，<a href=https://pigsty.io/zh/blog/db/cve-2024-6387/>CVE-2024-6387</a> 可以在 Pigsty 安装过程中被自动修复。</li><li>修复了 Loki 解析 Nginx 日志标签基数过大导致的内存消耗问题。</li><li>修复了 EL8 系统中上游 Ansible 依赖变化导致的 bootstrap 失效问题（python3.11-jmespath 升级至 python3.12-jmespath）</li></ul><hr><h2 id=v270>v2.7.0</h2><p><strong>亮点特性</strong></p><p>新增了大量强力扩展插件，特别是一些使用 <code>rust</code> 与 <code>pgrx</code> 进行开发的强力扩展：</p><ul><li><a href=https://github.com/paradedb/paradedb/tree/dev/pg_search>pg_search</a> v0.7.0：使用 BM25 算法对 SQL 表进行全文搜索</li><li><a href=https://github.com/paradedb/paradedb/tree/dev/pg_lakehouse>pg_lakehouse</a> v0.7.0：在对象存储（如 S3）和表格式（如 DeltaLake）上进行查询的引擎</li><li><a href=https://github.com/paradedb/pg_analytics>pg_analytics</a> v0.6.1：加速 PostgreSQL 内部的分析查询处理</li><li><a href=https://github.com/supabase/pg_graphql>pg_graphql</a> v1.5.4：为 PostgreSQL 数据库提供 GraphQL 支持</li><li><a href=https://github.com/supabase/pg_jsonschema>pg_jsonschema</a> v0.3.1：提供 JSON Schema 校验的 PostgreSQL 扩展</li><li><a href=https://github.com/supabase/wrappers>wrappers</a> v0.3.1：由 Supabase 提供的 PostgreSQL 外部数据封装器集合</li><li><a href=https://github.com/tembo-io/pgmq>pgmq</a> v1.5.2：轻量级消息队列，类似于 AWS SQS 和 RSMQ</li><li><a href=https://github.com/tembo-io/pg_tier>pg_tier</a> v0.0.3：支将将冷数据分级存储到 AWS S3</li><li><a href=https://github.com/tembo-io/pg_vectorize>pg_vectorize</a> v0.15.0: 在 PG 中实现 RAG 向量检索的封装</li><li><a href=https://github.com/tembo-io/pg_later>pg_later</a> v0.1.0：现在执行 SQL，并在稍后获取结果</li><li><a href=https://github.com/VADOSWARE/pg_idkit>pg_idkit</a> v0.2.3：生成多种流行类型的标识符（UUID）</li><li><a href=https://github.com/kaspermarstal/plprql>plprql</a> v0.1.0：在 PostgreSQL 中使用 PRQL 查询语言</li><li><a href=https://github.com/zhuobie/pgsmcrypto>pgsmcrypto</a> v0.1.0：PostgreSQL 的国密 SM 算法扩展</li><li><a href=https://github.com/kelvich/pg_tiktoken>pg_tiktoken</a> v0.0.1：计算 OpenAI 使用的 Token 数量</li><li><a href=https://github.com/rustprooflabs/pgdd>pgdd</a> v0.5.2：通过纯 SQL 接口，访问数据目录的元数据</li></ul><p>当然，也有一些使用原生 C 和 C++ 开发的强力扩展：</p><ul><li><a href=https://github.com/pgspider/parquet_s3_fdw>parquet_s3_fdw</a> 1.1.0：从 S3 存取 Parquet 格式文件，作为湖仓之用</li><li><a href=https://github.com/plv8/plv8>plv8</a> 3.2.2：使用 V8 引擎，允许在 PostgreSQL 中使用 Javascript 语言编写存储过程</li><li><a href=https://github.com/tvondra/md5hash>md5hash</a> 1.0.1：用于存储原生MD5哈希数据类型，而非文本。</li><li><a href=https://github.com/Percona-Lab/pg_tde>pg_tde</a> 1.0 alpha：PostgreSQL 的实验性加密存储引擎。</li><li><a href=https://github.com/df7cb/pg_dirtyread>pg_dirtyread</a> 2.6：从 PostgreSQL 表中读取未清理的死元组，用于脏读</li><li>新的 deb PGDG 扩展：<code>pg_roaringbitmap</code>, <code>pgfaceting</code>, <code>mobilitydb</code>, <code>pgsql-http</code>, <code>pg_hint_plan</code>, <code>pg_statviz</code>, <code>pg_rrule</code></li><li>新的 rpm PGDG 扩展：<code>pg_profile</code>, <code>pg_show_plans</code>, 使用 PGDG 的 <code>pgsql_http</code>, <code>pgsql_gzip</code>, <code>pg_net</code>, <code>pg_bigm</code> 替代 Pigsty 维护的 RPM。</li></ul><p><strong>新特性</strong></p><ul><li>允许 Pigsty 在特定 Docker 虚拟机镜像中运行。</li><li>针对 Ubuntu 与 EL 系操作系统发行版准备了 INFRA & PGSQL 模块的 arm64 软件包</li><li>新安装脚本，可从 cloudflare 下载软件，可以指定版本，提供更完善的提示信息。</li><li>新增的 PGSQL PITR 监控面板，用于在 PITR 过程中提供更好的可观测性</li><li>针对在 Docker 虚拟机镜像中运行 Pigsty 进行了一系列铺垫与准备。</li><li>新增了 <a href=https://github.com/Vonng/pigsty/issues/402>防呆设计</a>，避免在非 Pigsty 纳管的节点上运行 pgsql.yml 剧本 （<a href=https://github.com/AdamYLK>AdamYLK</a>）</li><li>针对每个支持的发行版大版本配置了独立的配置文件：el7, el8, el9, debian11, debian12, ubuntu20, ubuntu22</li></ul><p><strong>软件版本升级</strong></p><ul><li><strong>PostgreSQL 16.3</strong></li><li>Patroni 3.3.0</li><li>pgBackRest 2.51</li><li>VIP-Manager v2.5.0</li><li>Haproxy 2.9.7</li><li>Grafana 10.4.2</li><li>Prometheus 2.51</li><li>Loki & Promtail: 3.0.0 (警告：大版本非兼容性变更！)</li><li>Alertmanager 0.27.0</li><li>BlackBox Exporter 0.25.0</li><li>Node Exporter 1.8.0</li><li>pgBackrest Exporter 0.17.0</li><li>duckdb 0.10.2</li><li>etcd 3.5.13</li><li>minio-20240510014138 / mcli-20240509170424</li><li>pev2 v1.8.0 -> v1.11.0</li><li><strong>pgvector</strong> 0.6.1 -> 0.7.0</li><li>pg_tle: v1.3.4 -> v1.4.0</li><li>hydra: v1.1.1 -> v1.1.2</li><li>duckdb_fdw: v1.1.0 重新针对 libduckdb 0.10.2 进行编译</li><li>pg_bm25 0.5.6 -> pg_search 0.7.0</li><li>pg_analytics: 0.5.6 -> 0.6.1</li><li>pg_graphql: 1.5.0 -> 1.5.4</li><li>pg_net 0.8.0 -> 0.9.1</li><li>pg_sparse (deprecated)</li></ul><p><strong>Docker应用模板</strong></p><ul><li><a href=https://github.com/Vonng/pigsty/tree/master/app/odoo>Odoo</a>：开源 ERP 软件与插件</li><li><a href=https://github.com/Vonng/pigsty/tree/master/app/jupyter>Jupyter</a>：使用容器运行 Jupyter Notebook</li><li><a href=https://github.com/Vonng/pigsty/tree/master/app/polardb>PolarDB</a>：运行“国产数据库” PolarDB，应付信创检查！</li><li><a href=https://github.com/Vonng/pigsty/tree/master/app/supabase>supabase</a>：更新至最近的 GA 版本</li><li><a href=https://github.com/Vonng/pigsty/tree/master/app/bytebase>bytebase</a>：使用 <code>latest</code> 标签替代特定版本号。</li><li><a href=https://github.com/Vonng/pigsty/tree/master/app/pg_exporter>pg_exporter</a>：更新了 Docker 镜像的例子。</li></ul><p><strong>缺陷修复</strong></p><ul><li>修复了 pg_exporters 角色中的变量空白问题。</li><li>修复了 <code>minio_cluster</code> 变量没有在全局配置中注释掉的问题</li><li>修复了 EL7 模板中的 <code>postgis34</code> 插件名称问题，应该使用 <code>postgis33</code></li><li>修复了 EL8 <code>python3.11-cryptography</code> 依赖名的问题，上游现在变更为 <code>python3-cryptography</code>。</li><li>修复了 <code>/pg/bin/pg-role</code> 无法在非交互式 Shell 模式下获取操作系统用户名的问题</li><li>修复了 <code>/pg/bin/pg-pitr</code> 无法正确提示 <code>-X</code> <code>-P</code> 选项的问题</li></ul><p><strong>API变更</strong></p><ul><li>新参数 <code>node_write_etc_hosts</code>，用于控制是否向目标节点的 <code>/etc/hosts</code> 文件写入静态 DNS 解析记录</li><li>新增了 <code>prometheus_sd_dir</code> 参数，用于指定 Prometheus 静态服务发现的目标文件目录</li><li>configure 脚本新增了 <code>-x|--proxy</code> 参数，用于将当前环境的代理信息写入配置文件 by @waitingsong in <a href=https://github.com/Vonng/pigsty/pull/405>https://github.com/Vonng/pigsty/pull/405</a></li><li>不再使用 Promtail & Loki 解析 Infra 节点上的 Nginx 日志细节标签，因为这样会导致标签基数爆炸。</li><li>在 Prometheus 配置中使用 alertmanager API v2 替代 v1</li><li>在 PGSQL 模块中，使用 <code>/pg/cert/ca.crt</code> 代替 <code>/etc/pki/ca.crt</code>，降低对节点根证书的依赖。</li></ul><p><strong>新的贡献者</strong></p><ul><li>@NeroSong made their first contribution in <a href=https://github.com/Vonng/pigsty/pull/373>https://github.com/Vonng/pigsty/pull/373</a></li><li>@waitingsong made their first contribution in <a href=https://github.com/Vonng/pigsty/pull/405>https://github.com/Vonng/pigsty/pull/405</a></li></ul><p><strong>完整的变更日志</strong>: <a href=https://github.com/Vonng/pigsty/compar>https://github.com/Vonng/pigsty/compar</a></p><p><strong>离线软件包校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ec271a1d34b2b1360f78bfa635986c3a  pigsty-pkg-v2.7.0.el8.x86_64.tgz
</span></span><span style=display:flex><span>f3304bfd896b7e3234d81d8ff4b83577  pigsty-pkg-v2.7.0.debian12.x86_64.tgz
</span></span><span style=display:flex><span>5b071c2a651e8d1e68fc02e7e922f2b3  pigsty-pkg-v2.7.0.ubuntu22.x86_64.tgz
</span></span></code></pre></div><hr><h2 id=v260>v2.6.0</h2><p><strong>亮点特性</strong></p><ul><li>现已将 PostgreSQL 16 作为默认主要版本（16.2）</li><li>新增 <a href=https://www.paradedb.com/>ParadeDB</a> 扩展插件：<code>pg_analytics</code>, <code>pg_bm25</code>, and <code>pg_sparse</code></li><li>新增 <a href=https://duckdb.org/>DuckDB</a> 与 <code>duckdb_fdw</code> 插件支持</li><li>全球 Cloudflare CDN <a href=https://repo.pigsty.io>https://repo.pigsty.io</a> 与中国大陆CDN <a href=https://repo.pigsty.cc>https://repo.pigsty.cc</a></li></ul><p><strong>软件配置变更</strong></p><ul><li>使用 <code>node_repo_modules</code> 替换 <code>node_repo_method</code> 参数，并移除 <code>node_repo_local_urls</code> 参数。</li><li>暂时关闭 Grafana 统一告警功能，避免 &ldquo;Database Locked&rdquo; 错误。</li><li>新增 <code>node_repo_modules</code> 参数，用于指定在节点上添加的上游仓库源。</li><li>移除 <code>node_local_repo_urls</code>，其功能由 <code>node_repo_modules</code> & <code>repo_upstream</code> 替代。</li><li>移除 <code>node_repo_method</code> 参数，其功能由 <code>node_repo_modules</code> 替代。</li><li>在 <code>repo_upstream</code> 添加新的 <code>local</code> 源，并通过 <code>node_repo_modules</code> 使用，替代 <code>node_local_repo_urls</code> 的功能</li><li>重排 <code>node_default_packages</code>，<code>infra_packages</code>，<code>pg_packages</code>，<code>pg_extensions</code> 参数默认值。</li><li>在 <code>repo_upstream</code> 中替换 <code>repo_upstream.baseurl</code> 时，如果 EL8/9 PGDG小版本特定的仓库可用，使用 <code>major.minor</code> 而不是 <code>major</code> 替换 $releasever，提高小版本兼容性。</li></ul><p><strong>软件版本升级</strong></p><ul><li>Grafana 10.3</li><li>Prometheus 2.47</li><li>node_exporter 1.7.0</li><li>HAProxy 2.9.5</li><li>Loki / Promtail 2.9.4</li><li>minio-20240216110548 / mcli-20240217011557</li><li>etcd 3.5.11</li><li>Redis 7.2.4</li><li>Bytebase 2.13.2</li><li>DuckDB 0.10.0</li><li>FerretDB 1.19</li><li>Metabase：新Docker应用模板</li></ul><p><strong>PostgreSQL扩展插件</strong></p><ul><li>PostgreSQL 小版本升级： 16.2, 15.6, 14.11, 13.14, 12.18</li><li>PostgreSQL 16： 现在被提升为默认主版本</li><li>pg_exporter 0.6.1：安全修复</li><li>Patroni 3.2.2</li><li>pgBadger 12.4</li><li>pgBackRest 2.50</li><li>vip-manager 2.3.0</li><li>PostGIS 3.4.2</li><li>TimescaleDB 2.14.1</li><li>向量扩展 PGVector 0.6.0：新增并行创建 HNSW 索引功能</li><li>新增扩展插件 <a href=https://github.com/alitrack/duckdb_fdw>duckdb_fdw</a> v1.1 ，支持读写 DuckDB 数据 v1.1</li><li>新增扩展插件 <a href=https://github.com/pramsey/pgsql-gzip>pgsql-gzip</a> ，用于支持 Gzip 压缩解压缩 v1.0.0</li><li>新增扩展插件 <a href=https://github.com/paradedb/paradedb/tree/dev/pg_sparse>pg_sparse</a>，高效处理稀疏向量（ParadeDB） v0.5.6</li><li>新增扩展插件 <a href=https://github.com/paradedb/paradedb/tree/dev/pg_bm25>pg_bm25</a>，用于支持高质量全文检索 BM25 算法的插件（ParadeDB） v0.5.6</li><li>新增扩展插件 <a href=https://github.com/paradedb/paradedb/tree/dev/pg_analytics>pg_analytics</a>，支持 SIMD 与列式存储的PG分析插件（ParadeDB） v0.5.6</li><li>升级AIML插件 <a href=https://github.com/postgresml/postgresml>pgml</a> 至 v2.8.1，新增 PG 16 支持。</li><li>升级列式存储插件 <a href=https://github.com/hydradatabase/>hydra</a> 版本至 v1.1.1，新增 PG 16 支持。</li><li>升级图扩展插件 <a href=https://github.com/apache/age>age</a> 至 v1.5.0，新增 PG 16 支持。</li><li>升级GraphQL插件 <a href=https://github.com/supabase/pg_graphql>pg_graphql</a> 版本至 v1.5.0 ，支持 Supabase。</li></ul><pre tabindex=0><code>330e9bc16a2f65d57264965bf98174ff  pigsty-v2.6.0.tgz
81abcd0ced798e1198740ab13317c29a  pigsty-pkg-v2.6.0.debian11.x86_64.tgz
7304f4458c9abd3a14245eaf72f4eeb4  pigsty-pkg-v2.6.0.debian12.x86_64.tgz
f914fbb12f90dffc4e29f183753736bb  pigsty-pkg-v2.6.0.el7.x86_64.tgz
fc23d122d0743d1c1cb871ca686449c0  pigsty-pkg-v2.6.0.el8.x86_64.tgz
9d258dbcecefd232f3a18bcce512b75e  pigsty-pkg-v2.6.0.el9.x86_64.tgz
901ee668621682f99799de8932fb716c  pigsty-pkg-v2.6.0.ubuntu20.x86_64.tgz
39872cf774c1fe22697c428be2fc2c22  pigsty-pkg-v2.6.0.ubuntu22.x86_64.tgz
</code></pre><hr><h2 id=v251>v2.5.1</h2><p>跟进 PostgreSQL v16.1, v15.5, 14.10, 13.13, 12.17, 11.22 小版本例行更新。</p><p>现在 PostgreSQL 16 的所有重要扩展已经就位（新增 <code>pg_repack</code> 与 <code>timescaledb</code> 支持）</p><ul><li>软件更新：<ul><li>PostgreSQL to v16.1, v15.5, 14.10, 13.13, 12.17, 11.22</li><li>Patroni v3.2.0</li><li>PgBackrest v2.49</li><li>Citus 12.1</li><li>TimescaleDB 2.13</li><li>Grafana v10.2.0</li><li>FerretDB 1.15</li><li>SealOS 4.3.7</li><li>Bytebase 2.11.1</li></ul></li></ul><ul><li>移除 PGCAT 监控面板中查询对 <code>monitor</code> 模式前缀（允许用户将 <code>pg_stat_statements</code> 扩展装到别的地方）</li><li>新的配置模板 <code>wool.yml</code>，为阿里云免费99 ECS 单机针对设计。</li><li>为 EL9 新增 <code>python3-jmespath</code> 软件包，解决 Ansible 依赖更新后 bootstrap 缺少 jmespath 的问题</li></ul><pre tabindex=0><code>31ee48df1007151009c060e0edbd74de  pigsty-pkg-v2.5.1.el7.x86_64.tgz
a40f1b864ae8a19d9431bcd8e74fa116  pigsty-pkg-v2.5.1.el8.x86_64.tgz
c976cd4431fc70367124fda4e2eac0a7  pigsty-pkg-v2.5.1.el9.x86_64.tgz
7fc1b5bdd3afa267a5fc1d7cb1f3c9a7  pigsty-pkg-v2.5.1.debian11.x86_64.tgz
add0731dc7ed37f134d3cb5b6646624e  pigsty-pkg-v2.5.1.debian12.x86_64.tgz
99048d09fa75ccb8db8e22e2a3b41f28  pigsty-pkg-v2.5.1.ubuntu20.x86_64.tgz
431668425f8ce19388d38e5bfa3a948c  pigsty-pkg-v2.5.1.ubuntu22.x86_64.tgz
</code></pre><hr><h2 id=v250>v2.5.0</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://get.pigsty.cc/latest <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p><strong>亮点特性</strong></p><ul><li><p><a href=https://github.com/Vonng/pigsty/blob/main/files/pigsty/ubuntu.yml>Ubuntu</a> / <a href=https://github.com/Vonng/pigsty/blob/main/files/pigsty/debian.yml>Debian</a> 支持： bullseye, bookworm, jammy, focal</p></li><li><p>使用CDN <code>repo.pigsty.cc</code> 软件源，提供 rpm/deb 软件包下载。</p></li><li><p>Anolis 操作系统支持（ 兼容 EL 8.8 ）。</p></li><li><p>使用 PostgreSQL 16 替代 PostgreSQL 14 作为备选主要支持版本</p></li><li><p>新增了 PGSQL Exporter / PGSQL Patroni 监控面板，重做 PGSQL Query 面板</p></li><li><p>扩展更新：</p><ul><li>PostGIS 版本至 3.4（ EL8/EL9 ），EL7 仍使用 PostGIS 3.3</li><li>移除 <code>pg_embedding</code>，因为开发者不再对其进行维护，建议使用 <code>pgvector</code> 替换。</li><li>新扩展（EL）：点云插件 <code>pointcloud</code> 支持，Ubuntu原生带有此扩展。</li><li>新扩展（EL）： <code>imgsmlr</code>， <code>pg_similarity</code>，<code>pg_bigm</code> 用于搜索。</li><li>重新编译 <code>pg_filedump</code> 为 PG 大版本无关的软件包。</li><li>新收纳 <code>hydra</code> 列存储扩展，不再默认安装 <code>citus</code> 扩展。</li></ul></li><li><p>软件更新：</p><ul><li>Grafana 更新至 v10.1.5</li><li>Prometheus 更新至 v2.47</li><li>Promtail/Loki 更新至 v2.9.1</li><li>Node Exporter 更新至 v1.6.1</li><li>Bytebase 更新至 v2.10.0</li><li>patroni 更新至 v3.1.2</li><li>pgbouncer 更新至 v1.21.0</li><li>pg_exporter 更新至 v0.6.0</li><li>pgbackrest 更新至 v2.48.0</li><li>pgbadger 更新至 v12.2</li><li>pg_graphql 更新至 v1.4.0</li><li>pg_net 更新至 v0.7.3</li><li>ferretdb 更新至 v0.12.1</li><li>sealos 更新至 4.3.5</li><li>Supabase 支持更新至 <code>20231013070755</code></li></ul></li></ul><p><strong>Ubuntu 支持说明</strong></p><p>Pigsty 支持了 Ubuntu 22.04 (jammy) 与 20.04 (focal) 两个 LTS 版本，并提供相应的离线软件安装包。</p><p>相比 EL 系操作系统，一些参数的默认值需要显式指定调整，详情请参考 <a href=https://github.com/Vonng/pigsty/blob/main/files/pigsty/ubuntu.yml><code>ubuntu.yml</code></a></p><ul><li><code>repo_upstream</code>：按照 Ubuntu/Debian 的包名进行了调整</li><li><code>repo_packages</code>：按照 Ubuntu/Debian 的包名进行了调整</li><li><code>node_repo_local_urls</code>：默认值为 <code>['deb [trusted=yes] http://${admin_ip}/pigsty ./']</code></li><li><code>node_default_packages</code> ：<ul><li><code>zlib</code> -> <code>zlib1g</code>, <code>readline</code> -> <code>libreadline-dev</code></li><li><code>vim-minimal</code> -> <code>vim-tiny</code>, <code>bind-utils</code> -> <code>dnsutils</code>, <code>perf</code> -> <code>linux-tools-generic</code>,</li><li>新增软件包 <code>acl</code>，确保 Ansible 权限设置正常工作</li></ul></li><li><code>infra_packages</code>：所有含 <code>_</code> 的包要替换为 <code>-</code> 版本，此外 <code>postgresql-client-16</code> 用于替换 <code>postgresql16</code></li><li><code>pg_packages</code>：Ubuntu 下惯用 <code>-</code> 替代 <code>_</code>，不需要手工安装 <code>patroni-etcd</code> 包。</li><li><code>pg_extensions</code>：扩展名称与EL系不太一样，Ubuntu下缺少 <code>passwordcheck_cracklib</code> 扩展。</li><li><code>pg_dbsu_uid</code>： Ubuntu 下 Deb 包不显式指定uid，需要手动指定，Pigsty 默认分配为 <code>543</code></li></ul><p><strong>API变更</strong></p><p>默认值变化：</p><ul><li><p><code>repo_modules</code> 现在的默认值为 <code>infra,node,pgsql,redis,minio</code>，启用所有上游源</p></li><li><p><code>repo_upstream</code> 发生变化，现在添加了 Pigsty Infra/MinIO/Redis/PGSQL 模块化软件源</p></li><li><p><code>repo_packages</code> 发生变化，移除未使用的 <code>karma,mtail,dellhw_exporter</code>，移除了 PG14 主要扩展，新增了 PG16 主要扩展，添加了 virtualenv 包。</p></li><li><p><code>node_default_packages</code> 发生变化，默认安装 <code>python3-pip</code> 组件。</p></li><li><p><code>pg_libs</code>: <code>timescaledb</code> 从 shared_preload_libraries 中移除，现在默认不自动启用。</p></li><li><p><code>pg_extensions</code> 发生变化，不再默认安装 Citus 扩展，默认安装 <code>passwordcheck_cracklib</code> 扩展，EL8,9 PostGIS 默认版本升级至 3.4</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#000>pg_repack_${pg_version}* wal2json_${pg_version}* passwordcheck_cracklib_${pg_version}*</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>postgis34_${pg_version}* timescaledb-2-postgresql-${pg_version}* pgvector_${pg_version}*</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p>Patroni 所有模板默认移除 <code>wal_keep_size</code> 参数，避免触发 Patroni 3.1.1 的错误，其功能由 <code>min_wal_size</code> 覆盖。</p></li></ul><pre tabindex=0><code>87e0be2edc35b18709d7722976e305b0  pigsty-pkg-v2.5.0.el7.x86_64.tgz
e71304d6f53ea6c0f8e2231f238e8204  pigsty-pkg-v2.5.0.el8.x86_64.tgz
39728496c134e4352436d69b02226ee8  pigsty-pkg-v2.5.0.el9.x86_64.tgz
e3f548a6c7961af6107ffeee3eabc9a7  pigsty-pkg-v2.5.0.debian11.x86_64.tgz
1e469cc86a19702e48d7c1a37e2f14f9  pigsty-pkg-v2.5.0.debian12.x86_64.tgz
cc3af3b7c12f98969d3c6962f7c4bd8f  pigsty-pkg-v2.5.0.ubuntu20.x86_64.tgz
c5b2b1a4867eee624e57aed58ac65a80  pigsty-pkg-v2.5.0.ubuntu22.x86_64.tgz
</code></pre><hr><h2 id=v241>v2.4.1</h2><ul><li><a href=https://supabase.com/>Supabase</a> 支持：开源的 Firebase 替代，现可使用 Pigsty 本地托管的 PostgreSQL 实例作为数据存储。</li><li><a href=https://postgresml.org/>PostgresML</a> 支持：使用SQL完成经典机器学习算法，训练、微调、调用大语言模型（hugging face）。</li><li><a href=https://github.com/FerretDB/FerretDB>FerretDB</a> v1.10 支持，在 PostgreSQL 上提供 MongoDB API与协议兼容能力。</li><li>GraphQL扩展: <a href=https://github.com/supabase/pg_graphql><code>pg_graphql</code></a>：从现有模式中反射出 GraphQL 模式，提供库内 GraphQL 查询能力。</li><li>JWT支持扩展：<a href=https://github.com/michelp/pgjwt><code>pgjwt</code></a> 允许您使用 SQL 验证签发 JWT (JSON Web Tokens)。</li><li>密钥存储扩展: <a href=https://github.com/supabase/vault><code>vault</code></a> 可以在提供一个安全存储加密密钥的保险柜。</li><li>数据恢复扩展：<a href=https://github.com/df7cb/pg_filedump><code>pg_filedump</code></a>：可用于快速从PostgreSQL二进制文件中恢复数据</li><li>图数据库扩展：Apache <a href=https://age.apache.org/><code>age</code></a>，为 PostgreSQL 添加 OpenCypher 查询支持，类似 Neo4J</li><li>中文分词扩展：<a href=https://github.com/amutu/zhparser><code>zhparser</code></a>，为中文全文检索提供分词能力，类似 ElasticSearch。</li><li>高效位图扩展：<a href=https://github.com/ChenHuajun/pg_roaringbitmap><code>pg_roaringbitmap</code></a>，在 PostgreSQL 中提供 roaring bitmap 的支持，高效计数聚合统计。</li><li>向量嵌入替代：<a href=https://github.com/neondatabase/pg_embedding><code>pg_embedding</code></a>，提供了不同于 pgvector 的另一种 HNSW 替代实现。</li><li>可信语言扩展：<a href=https://github.com/aws/pg_tle><code>pg_tle</code></a>，由 AWS 出品的，允许您打包分发管理由可信存储过程语言编写的函数。</li><li>HTTP客户端扩展：<a href=https://github.com/pramsey/pgsql-http><code>pgsql-http</code></a>：使用 SQL 接口，curl API，发起 HTTP 请求，与各类系统交互。</li><li>异步HTTP扩展： <a href=https://github.com/supabase/pg_net><code>pg_net</code></a> 允许您使用 SQL 发起非阻塞的 HTTP/HTTPS 请求。</li><li>列式存储引擎：<a href=https://www.hydra.so/><code>hydra</code></a> 针对分析场景打造的向量化列存储引擎，原地替代 Citus 列存插件。</li><li>其他PGDG扩展：新收录8个由PGDG维护的扩展插件，Pigsty支持的插件总数达到 150+ 。</li><li>PostgreSQL 16 内核支持，监控云端 RDS / PolarDB for PostgreSQL。</li></ul><p><strong>亮点特性</strong></p><ul><li><a href=https://supabase.com/>Supabase</a> 支持：开源的 Firebase 替代，现可使用 Pigsty 托管的 PostgreSQL 实例存储数据。</li><li><a href=https://postgresml.org/>PostgresML</a> 支持：在 PostgreSQL 运行各类模型（hugging face），向量操作，经典机器学习算法。</li><li>GraphQL支持扩展: <a href=https://github.com/supabase/pg_graphql><code>pg_graphql</code></a>：从现有模式中反射出 GraphQL 模式，提供库内 GraphQL 查询能力。</li><li>异步HTTP客户端扩展： <a href=https://github.com/supabase/pg_net><code>pg_net</code></a> 允许您使用 SQL 发起非阻塞的 HTTP/HTTPS 请求</li><li>JWT支持扩展：<a href=https://github.com/michelp/pgjwt><code>pgjwt</code></a> 允许您使用 SQL 验证签发 JWT (JSON Web Tokens)</li><li>密钥存储扩展: <a href=https://github.com/supabase/vault><code>vault</code></a> 可以在保险柜里存储加密密钥</li><li>将 <a href=https://github.com/FerretDB/FerretDB>FerretDB</a> 版本升级至 v1.10</li><li>新增组件：<a href=https://github.com/df7cb/pg_filedump><code>pg_filedump</code></a>：可用于快速从PostgreSQL二进制文件中恢复数据</li><li>减少 EL9 离线软件包的大小，移除非必须依赖项 <code>proj-data*</code></li><li>修复了 Patroni 3.1.1 的错误</li></ul><pre tabindex=0><code>efabe7632d8994f3fb58f9838b8f9d7d  pigsty-pkg-v2.5.0.el7.x86_64.tgz # 1.1G
ea78957e8c8434b120d1c8c43d769b56  pigsty-pkg-v2.5.0.el8.x86_64.tgz # 1.4G
4ef280a7d28872814e34521978b851bb  pigsty-pkg-v2.5.0.el9.x86_64.tgz # 1.3G
</code></pre><hr><h2 id=v240>v2.4.0</h2><p>使用 <code>bash -c "$(curl -fsSL https://get.pigsty.cc/latest)"</code> 快速上手。</p><p><strong>最新特性</strong></p><ul><li>PostgreSQL 16 正式发布，Pigsty提供支持。</li><li>可以监控云数据库，RDS for PostgreSQL，以及 PolarDB，提供全新的 PGRDS 监控面板</li><li>正式提供商业支持与咨询服务。并发布首个 LTS 版本，为订阅客户提供最长5年的支持。</li><li>新扩展插件: Apache AGE, openCypher graph query engine on PostgreSQL</li><li>新扩展插件: zhparser, full text search for Chinese language</li><li>新扩展插件: pg_roaringbitmap, roaring bitmap for PostgreSQL</li><li>新扩展插件: pg_embedding, hnsw alternative to pgvector</li><li>新扩展插件: pg_tle, admin / manage stored procedure extensions</li><li>新扩展插件: pgsql-http, issue http request with SQL interface</li><li>新增插件： pg_auth_mon pg_checksums pg_failover_slots pg_readonly postgresql-unit pg_store_plans pg_uuidv7 set_user</li><li>Redis改进：支持 Redis 哨兵监控，配置主从集群的自动高可用。</li></ul><p><strong>API变化</strong></p><ul><li>新增参数，<code>REDIS</code>.<code>redis_sentinel_monitor</code>，用于指定 Sentinel 集群监控的主库列表</li></ul><p><strong>问题修复</strong></p><ul><li>修复 Grafana 10.1 注册数据源时缺少 <code>uid</code> 的问题</li></ul><pre tabindex=0><code>MD5 (pigsty-pkg-v2.4.0.el7.x86_64.tgz) = 257443e3c171439914cbfad8e9f72b17
MD5 (pigsty-pkg-v2.4.0.el8.x86_64.tgz) = 41ad8007ffbfe7d5e8ba5c4b51ff2adc
MD5 (pigsty-pkg-v2.4.0.el9.x86_64.tgz) = 9a950aed77a6df90b0265a6fa6029250
</code></pre><hr><h2 id=v231>v2.3.1</h2><p>使用 <code>bash -c "$(curl -fsSL https://get.pigsty.cc/latest)"</code> 快速开始。</p><p><strong>最新特性</strong></p><ul><li><code>pgvector</code> 更新至 0.5，添加 hnsw 算法支持。</li><li>支持 PostgreSQL 16 RC1 (el8/el9)</li><li>默认包中添加了 SealOS 用于快速部署Kubernetes集群。</li></ul><p><strong>问题修复</strong></p><ul><li>修复了 <code>infra</code>.<code>repo</code>.<code>repo_pkg</code> 任务：当 <code>repo_packages</code> 中包名包含 <code>*</code> 时，下载可能会受到 <code>/www/pigsty</code> 现有内容的影响。</li><li>将 <code>vip_dns_suffix</code> 的默认值由 <code>.vip</code> 调整为空字符串，即集群本身的名称将默认作为节点集群的 L2 VIP</li><li><code>modprobe watchdog</code> and <code>chown watchdog</code> if <code>patroni_watchdog_mode</code> is <code>required</code></li><li>当 <code>pg_dbsu_sudo</code> = <code>limit</code> and <code>patroni_watchdog_mode</code> = <code>required</code> 时，授予数据库 dbsu 以下命令的 sudo 执行权限<ul><li><code>/usr/bin/sudo /sbin/modprobe softdog</code>：在启动 Patroni 服务时确保 softdog 内核模块启用</li><li><code>/usr/bin/sudo /bin/chown {{ pg_dbsu }} /dev/watchdog</code>: 在启动 Patroni 服务时，确保 watchdog 属主正确</li></ul></li></ul><p><strong>文档更新</strong></p><ul><li>向英文文档中添加了更新内容。</li><li>添加了简体中文版本的内置文档，修复了 pigsty.cc 文档站的中文文档。</li></ul><p><strong>软件更新</strong></p><ul><li>PostgreSQL 16 RC1 for EL8/EL9</li><li>PGVector 0.5.0，支持 hnsw 索引</li><li>TimescaleDB 2.11.2</li><li>grafana 10.1.0</li><li>loki & promtail 2.8.4</li><li>redis-stack 7.2 on el7/8</li><li>mcli-20230829225506 / minio-20230829230735</li><li>ferretdb 1.9</li><li>sealos 4.3.3</li><li>pgbadger 1.12.2</li></ul><pre tabindex=0><code>ce69791eb622fa87c543096cdf11f970  pigsty-pkg-v2.3.1.el7.x86_64.tgz
495aba9d6d18ce1ebed6271e6c96b63a  pigsty-pkg-v2.3.1.el8.x86_64.tgz
38b45582cbc337ff363144980d0d7b64  pigsty-pkg-v2.3.1.el9.x86_64.tgz
</code></pre><hr><h2 id=v230>v2.3.0</h2><p>相关文章：《<a href=https://mp.weixin.qq.com/s/p5sP42xsAxKPhWb_T7DqSA>Pigsty v2.3 发布：应用生态丰富</a>》</p><p>发布注记：https://github.com/Vonng/pigsty/releases/tag/v2.3.0</p><p>使用 <code>bash -c "$(curl -fsSL https://get.pigsty.cc/latest)"</code> 快速开始。</p><p><strong>亮点特性</strong></p><ul><li>INFRA: 添加了对 NODE/PGSQL VIP 的监控支持</li><li>PGSQL: 通过小版本升级修复了 PostgreSQL <a href=https://www.postgresql.org/about/news/postgresql-154-149-1312-1216-1121-and-postgresql-16-beta-3-released-2689/>CVE-2023-39417</a>： 15.4, 14.9, 13.12, 12.16，以及 Patroni v3.1.0</li><li>NODE: 允许用户使用 <code>keepalived</code> 为一个节点集群绑定 L2 VIP</li><li>REPO: Pigsty 专用 yum 源优化精简，全站默认使用 HTTPS： <a href=https://get.pigsty.cc><code>get.pigsty.cc</code></a> 与 <a href=https://demo.pigsty.cc><code>demo.pigsty.cc</code></a></li><li>APP: 升级 <code>app/bytebase</code> 版本至 v2.6.0， <code>app/ferretdb</code> 版本至 v1.8；添加新的应用模板：<a href=https://nocodb.com/>nocodb</a>，开源的 Airtable。</li><li>REDIS: 升级版本至 v7.2，并重制了 Redis 监控面板。</li><li>MONGO: 添加基于 <a href=https://www.ferretdb.io/>FerretDB</a> 1.8 实现的基本支持。</li><li>MYSQL: 添加了 Prometheus / Grafana / CA 中的代码存根，便于后续纳管。</li></ul><p><strong>API变化</strong></p><p>新增一个新的参数组 <code>NODE</code>.<code>NODE_VIP</code>：包含 8 个新参数</p><ul><li><code>NODE</code>.<code>VIP</code>.<code>vip_enabled</code>：在此节点集群上启用 vip 吗？</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_address</code>：ipv4 格式的节点 vip 地址，如果启用了 vip，则必需</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_vrid</code>：必需，整数，1-255 在相同 VLAN 中应该是唯一的</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_role</code>：master/backup，默认为备份，用作初始角色</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_preempt</code>：可选，true/false，默认为 false，启用 vip 抢占</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_interface</code>：节点 vip 网络接口监听，eth0 默认</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_dns_suffix</code>：节点 vip dns 名称后缀，默认为空字符串</li><li><code>NODE</code>.<code>VIP</code>.<code>vip_exporter_port</code>：keepalived 导出器监听端口，默认为 9650</li></ul><pre tabindex=0><code>MD5 (pigsty-pkg-v2.3.0.el7.x86_64.tgz) = 81db95f1c591008725175d280ad23615
MD5 (pigsty-pkg-v2.3.0.el8.x86_64.tgz) = 6f4d169b36f6ec4aa33bfd5901c9abbe
MD5 (pigsty-pkg-v2.3.0.el9.x86_64.tgz) = 4bc9ae920e7de6dd8988ca7ee681459d
</code></pre><hr><h2 id=v220>v2.2.0</h2><p>相关文章：《<a href=https://mp.weixin.qq.com/s/NfQEL6fM8FA-ErijucXJ4g>Pigsty v2.2 发布 —— 监控系统大升级</a>》</p><p>发布注记：https://github.com/Vonng/pigsty/releases/tag/v2.2.0</p><p>快速开始： <code>bash -c "$(curl -fsSL https://get.pigsty.cc/latest)"</code></p><p><strong>亮点特性</strong></p><ul><li>监控面板重做: <a href=https://demo.pigsty.cc>https://demo.pigsty.cc</a></li><li>Vagrant沙箱重做: 支持 libvirt 与新的配置模板</li><li>Pigsty EL Yum 仓库: 统一收纳零碎 RPM，简化安装构建流程。</li><li>操作系统兼容性: 新增信创操作系统 UOS-v20-1050e 支持</li><li>新的配置模板：42 节点的生产仿真配置</li><li>统一使用官方 PGDG citus 软件包（el7）</li></ul><p><strong>软件升级</strong></p><ul><li>PostgreSQL 16 beta2</li><li>Citus 12 / PostGIS 3.3.3 / TimescaleDB 2.11.1 / PGVector 0.44</li><li>patroni 3.0.4 / pgbackrest 2.47 / pgbouncer 1.20</li><li>grafana 10.0.3 / loki/promtail/logcli 2.8.3</li><li>etcd 3.5.9 / haproxy v2.8.1 / redis v7.0.12</li><li>minio 20230711212934 / mcli 20230711233044</li></ul><p><strong>Bug修复</strong></p><ul><li>修复了 Docker 组权限的问题 <a href=https://github.com/Vonng/pigsty/commit/29434bdd39548d95d80a236de9099874ed564f9b>29434bd</a></li><li>将 <code>infra</code> 操作系统用户组作为额外的组，而不是首要用户组。</li><li>修复了 Redis Sentinel Systemd 服务的自动启用状态 <a href=https://github.com/Vonng/pigsty/commit/5c96feb598ad6e44daa7a595e34c87e67952777b>5c96feb</a></li><li>放宽了 <code>bootstrap</code> & <code>configure</code> 的检查，特别是当 <code>/etc/redhat-release</code> 不存在的时候。</li><li>升级到 Grafana 10，修复了 Grafana 9.x <a href=https://grafana.com/blog/2023/03/22/grafana-security-release-new-versions-with-security-fixes-for-cve-2023-1410/>CVE-2023-1410</a></li><li>在 CMDB <code>pglog</code> 模式中添加了 PG 14 - 16 的 command tags 与 错误代码。</li></ul><p><strong>API变化</strong></p><p>新增1个变量</p><ul><li><code>INFRA</code>.<code>NGINX</code>.<code>nginx_exporter_enabled</code>: 现在用户可以通过设置这个参数来禁用 nginx_exporter 。</li></ul><p>默认值变化:</p><ul><li><code>repo_modules</code>: <code>node,pgsql,infra</code> : redis 现在由 pigsty-el 仓库提供，不再需要 <code>redis</code> 模块。</li><li><code>repo_upstream</code>:<ul><li>新增 <code>pigsty-el</code>: 与具体EL版本无关的RPM: 例如 grafana, minio, pg_exporter, 等等……</li><li>新增 <code>pigsty-misc</code>: 与具体EL版本有关的RPM: 例如 redis, prometheus 全家桶，等等……</li><li>移除 <code>citus</code>: 现在 PGDG 中有完整的 EL7 - EL9 citus 12 支持</li><li>移除 <code>remi</code>: redis 现在由 pigsty-el 仓库提供，不再需要 <code>redis</code> 模块。</li></ul></li><li><code>repo_packages</code>:<ul><li>ansible python3 python3-pip python3-requests python3-jmespath python3.11-jmespath dnf-utils modulemd-tools # el7: python36-requests python36-idna yum-utils</li><li>grafana loki logcli promtail prometheus2 alertmanager karma pushgateway node_exporter blackbox_exporter nginx_exporter redis_exporter</li><li>redis etcd minio mcli haproxy vip-manager pg_exporter nginx createrepo_c sshpass chrony dnsmasq docker-ce docker-compose-plugin flamegraph</li><li>lz4 unzip bzip2 zlib yum pv jq git ncdu make patch bash lsof wget uuid tuned perf nvme-cli numactl grubby sysstat iotop htop rsync tcpdump</li><li>netcat socat ftp lrzsz net-tools ipvsadm bind-utils telnet audit ca-certificates openssl openssh-clients readline vim-minimal</li><li>postgresql13* wal2json_13* pg_repack_13* passwordcheck_cracklib_13* postgresql12* wal2json_12* pg_repack_12* passwordcheck_cracklib_12* timescaledb-tools</li><li>postgresql15 postgresql15* citus_15* pglogical_15* wal2json_15* pg_repack_15* pgvector_15* timescaledb-2-postgresql-15* postgis33_15* passwordcheck_cracklib_15* pg_cron_15*</li><li>postgresql14 postgresql14* citus_14* pglogical_14* wal2json_14* pg_repack_14* pgvector_14* timescaledb-2-postgresql-14* postgis33_14* passwordcheck_cracklib_14* pg_cron_14*</li><li>postgresql16* wal2json_16* pgvector_16* pg_squeeze_16* postgis34_16* passwordcheck_cracklib_16* pg_cron_16*</li><li>patroni patroni-etcd pgbouncer pgbadger pgbackrest pgloader pg_activity pg_partman_15 pg_permissions_15 pgaudit17_15 pgexportdoc_15 pgimportdoc_15 pg_statement_rollback_15*</li><li>orafce_15* mysqlcompat_15 mongo_fdw_15* tds_fdw_15* mysql_fdw_15 hdfs_fdw_15 sqlite_fdw_15 pgbouncer_fdw_15 multicorn2_15* powa_15* pg_stat_kcache_15* pg_stat_monitor_15* pg_qualstats_15 pg_track_settings_15 pg_wait_sampling_15 system_stats_15</li><li>plprofiler_15* plproxy_15 plsh_15* pldebugger_15 plpgsql_check_15* pgtt_15 pgq_15* pgsql_tweaks_15 count_distinct_15 hypopg_15 timestamp9_15* semver_15* prefix_15* rum_15 geoip_15 periods_15 ip4r_15 tdigest_15 hll_15 pgmp_15 extra_window_functions_15 topn_15</li><li>pg_background_15 e-maj_15 pg_catcheck_15 pg_prioritize_15 pgcopydb_15 pg_filedump_15 pgcryptokey_15 logerrors_15 pg_top_15 pg_comparator_15 pg_ivm_15* pgsodium_15* pgfincore_15* ddlx_15 credcheck_15 safeupdate_15 pg_squeeze_15* pg_fkpart_15 pg_jobmon_15</li></ul></li><li><code>repo_url_packages</code>:<ul><li><a href=https://get.pigsty.cc/rpm/pev.html>https://get.pigsty.cc/rpm/pev.html</a></li><li><a href=https://get.pigsty.cc/rpm/chart.tgz>https://get.pigsty.cc/rpm/chart.tgz</a></li></ul></li><li><code>node_default_packages</code>:<ul><li>lz4,unzip,bzip2,zlib,yum,pv,jq,git,ncdu,make,patch,bash,lsof,wget,uuid,tuned,nvme-cli,numactl,grubby,sysstat,iotop,htop,rsync,tcpdump</li><li>netcat,socat,ftp,lrzsz,net-tools,ipvsadm,bind-utils,telnet,audit,ca-certificates,openssl,readline,vim-minimal,node_exporter,etcd,haproxy,python3,python3-pip</li></ul></li><li><code>infra_packages</code><ul><li>grafana,loki,logcli,promtail,prometheus2,alertmanager,karma,pushgateway</li><li>node_exporter,blackbox_exporter,nginx_exporter,redis_exporter,pg_exporter</li><li>nginx,dnsmasq,ansible,postgresql15,redis,mcli,python3-requests</li></ul></li><li><code>PGSERVICE</code> in <code>.pigsty</code> 被移除了，取而代之的是 <code>PGDATABASE=postgres</code>，这用户只需 IP 地址就可以从管理节点访问特定实例。</li></ul><p>目录结构变化:</p><ul><li><code>bin/dns</code> and <code>bin/ssh</code> 现在被移动到 <code>vagrant/</code> 目录中。</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.2.0.el7.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> 5fb6a449a234e36c0d895a35c76add3c
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.2.0.el8.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> c7211730998d3b32671234e91f529fd0
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.2.0.el9.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> 385432fe86ee0f8cbccbbc9454472fdd
</span></span></code></pre></div><hr><h2 id=v210>v2.1.0</h2><p>相关文章：<a href=https://mp.weixin.qq.com/s/Wu9kWEFSI3oGUr8t3hrz_w>Pigsty v2.1 发布：向量扩展 / PG12-16 支持</a></p><p>发布注记：https://github.com/Vonng/pigsty/releases/tag/v2.1.0</p><p><strong>Highlight</strong></p><ul><li>PostgreSQL 16 beta 支持, 以及 12 ~ 15 的支持.</li><li>为 PG 12 - 15 新增了 PGVector 扩展支持，用于存储 AI 嵌入。</li><li>为 Grafana 添加了额外6个默认的扩展面板/数据源插件。</li><li>添加 <code>bin/profile</code> 脚本用于执行远程 Profiling ，生成火焰图。</li><li>添加 <code>bin/validate</code> 用于校验 <code>pigsty.yml</code> 配置文件合法性。</li><li>添加 <code>bin/repo-add</code> 用于快速向节点添加软件源定义。</li><li>PostgreSQL 16 可观测性：添加了 <code>pg_stat_io</code> 支持与相关监控面板</li></ul><p><strong>软件升级</strong></p><ul><li>PostgreSQL 15.3 , 14.8, 13.11, 12.15, 11.20, and 16 beta1</li><li>pgBackRest 2.46 / pgbouncer 1.19</li><li>Redis 7.0.11</li><li>Grafana v9.5.3</li><li>Loki / Promtail / Logcli 2.8.2</li><li>Prometheus 2.44</li><li>TimescaleDB 2.11.0</li><li>minio-20230518000536 / mcli-20230518165900</li><li>Bytebase v2.2.0</li></ul><p><strong>改进增强</strong></p><ul><li>当添加本地用户的公钥时，所有的 <code>id*.pub</code> 都会被添加到远程机器上（例如椭圆曲线算法生成的密钥文件）</li></ul><hr><h2 id=v202>v2.0.2</h2><p><a href=https://github.com/Vonng/pigsty/releases/tag/v2.0.2>https://github.com/Vonng/pigsty/releases/tag/v2.0.2</a></p><p><strong>亮点</strong></p><p>使用开箱即用的 <a href=https://github.com/pgvector/pgvector><code>pgvector</code></a> 存储 AI Embedding、索引、检索向量。</p><ul><li>新扩展 <a href=https://github.com/Vonng/pigsty/issues/267><code>pgvector</code></a></li><li><a href=https://github.com/Vonng/pigsty/issues/265>MinIO CVE-2023-28432</a> 问题修复</li></ul><p><strong>变更</strong></p><ul><li>新扩展插件 <a href=https://github.com/Vonng/pigsty/issues/267><code>pgvector</code></a> 用于存储 AI 嵌入，并执行向量相似度搜索。</li><li>修复 <a href=https://github.com/Vonng/pigsty/issues/265>MinIO CVE-2023-28432</a> ，使用 20230324 新提供的 policy API.</li><li>为 DNSMASQ systemd 服务添加动态重载命令</li><li>更新 PEV 版本至 v1.8</li><li>更新 grafana 版本至 v9.4.7</li><li>更新 MinIO 与 MCLI 版本至 20230324</li><li>更新 bytebase 版本至 v1.15.0</li><li>更新监控面板并修复死链接</li><li>更新了阿里云 Terraform 模板，默认使用 RockyLinux 9</li><li>使用 Grafana v9.4 的 Provisioning API</li><li>为众多管理任务添加了 asciinema 视频</li><li>修复了 EL8 PostgreSQL 的破损依赖：移除 anonymizer_15 faker_15 pgloader</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.2.el7.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> d46440a115d741386d29d6de646acfe2
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.2.el8.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> 5fa268b5545ac96b40c444210157e1e1
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.2.el9.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> c8b113d57c769ee86a22579fc98e8345
</span></span></code></pre></div><hr><h2 id=v201>v2.0.1</h2><p><a href=https://github.com/Vonng/pigsty/releases/tag/v2.0.1>https://github.com/Vonng/pigsty/releases/tag/v2.0.1</a></p><p>安全性改进，与对 <a href=https://github.com/Vonng/pigsty/releases/tag/v2.0.0>v2.0.0</a> 的 BUG 修复。</p><p><strong>改进</strong></p><ul><li>更换猪头 logo 以符合 PostgreSQL 商标政策。</li><li>将 grafana 版本升级至 v9.4，界面更佳且修复了 bug。</li><li>将 patroni 版本升级至 v3.0.1，其中包含了一些 bug 修复。</li><li>修改：将 grafana systemd 服务文件回滚到 rpm 默认的版本。</li><li>使用缓慢的 <code>copy</code> 代替 <code>rsync</code> 来复制 grafana 仪表板，更加可靠。</li><li>增强：bootstrap 执行后会添加回默认 repo 文件。</li><li>添加 asciinema 视频，用于各种管理任务。</li><li>安全增强模式：限制监控用户权限。</li><li>新的配置模板：<code>dual.yml</code>，用于双节点部署。</li><li>在 <code>crit.yml</code> 模板中启用 <code>log_connections</code> 和 <code>log_disconnections</code>。</li><li>在 <code>crit.yml</code> 模板中的 <code>pg_libs</code> 中启用 <code>$lib/passwordcheck</code>。</li><li>明确授予 <code>pg_monitor</code> 角色监视视图权限。</li><li>从 <code>dbuser_monitor</code> 中移除默认的 <code>dbrole_readonly</code> 以限制监控用户的权限</li><li>现在 patroni 监听在 <code>{{ inventory_hostname }}</code> 而不是 <code>0.0.0.0</code></li><li>现在你可以使用 <code>pg_listen</code> 控制 postgres/pgbouncer 监听的地址</li><li>现在你可以在 <code>pg_listen</code> 中使用 <code>${ip}</code>, <code>${lo}</code>, <code>${vip}</code> 占位符</li><li>将 Aliyun terraform 镜像从 centos 7.9 提升到 rocky Linux 9</li><li>将 bytebase 版本升级到 v1.14.0</li></ul><p><strong>BUG修复</strong></p><ul><li>为 alertmanager 添加缺失的 advertise 地址。</li><li>解决使用 <code>bin/pgsql-user</code> 创建数据库用户时，<code>pg_mode</code> 变量缺失问题。</li><li>在 <code>redis.yml</code> 中为 Redis 集群加入任务添加 <code>-a password</code> 选项。</li><li>在 <code>infra-rm.yml</code>.<code>remove infra data</code> 任务中补充缺失的默认值。</li><li>修复 prometheus 监控对象定义文件的属主为 <code>prometheus</code> 用户。</li><li>使用 管理员用户 而不是 root 去删除 DCS 中的元数据。</li><li>修复了由 grafana 9.4 bug 导致的问题：Meta数据源缺失。</li></ul><p><strong>注意事项</strong></p><p>EL8 pgdg 上游官方源处于依赖破损状态，请小心使用。涉及到的软件包: <code>postgis33_15, pgloader, postgresql_anonymizer_15*, postgresql_faker_15</code></p><p><strong>如何升级？</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span> tar -zcf /tmp/files.tgz files<span style=color:#000;font-weight:700>;</span> rm -rf ~/pigsty    <span style=color:#8f5902;font-style:italic># backup files dir and remove</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ~<span style=color:#000;font-weight:700>;</span> bash -c <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>curl -fsSL https://get.pigsty.cc/latest<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>      <span style=color:#8f5902;font-style:italic># get latest pigsty source</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span> rm -rf files<span style=color:#000;font-weight:700>;</span> tar -xf /tmp/files.tgz -C ~/pigsty  <span style=color:#8f5902;font-style:italic># restore files dir</span>
</span></span></code></pre></div><p><strong>Checksums</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.1.el7.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> 5cfbe98fd9706b9e0f15c1065971b3f6
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.1.el8.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> c34aa460925ae7548866bf51b8b8759c
</span></span><span style=display:flex><span>MD5 <span style=color:#ce5c00;font-weight:700>(</span>pigsty-pkg-v2.0.1.el9.x86_64.tgz<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> 055057cebd93c473a67fb63bcde22d33
</span></span></code></pre></div><p>特别感谢 <a href=https://github.com/cocoonkid>@cocoonkid</a> 提供的反馈。</p><hr><h2 id=v200>v2.0.0</h2><p>相关文章：</p><ul><li><a href=https://mp.weixin.qq.com/s/-E_-HZ7LvOze5lmzy3QbQA>更好的开源RDS替代：Pigsty</a></li><li><a href=https://mp.weixin.qq.com/s/WsR-c64OJfkMql7zX7XmDA>炮打 RDS，Pigsty v2.0 发布</a></li><li><a href=https://mp.weixin.qq.com/s/9lceZdyUZU9AzsqlAcpjTA>Pigsty v2 正式发布：更好的RDS PG开源替代</a></li><li><a href=https://mp.weixin.qq.com/s/g-ZPWqBwjzaxZKxyjVmFig>Pigsty 2.0 展望</a></li></ul><p>Pigsty <a href=https://github.com/Vonng/pigsty/releases/tag/v2.0.0>v2.0.0</a> 正式发布！</p><p>从v2.0.0开始，PIGSTY 现在是 &ldquo;PostgreSQL In Great STYle"的首字母缩写，即"全盛状态的PostgreSQL&rdquo;。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://get.pigsty.cc/latest <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><details><summary>Download directly from GitHub Release</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bash -c <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>curl -fsSL https://raw.githubusercontent.com/Vonng/pigsty/master/bin/get<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># or download tarball directly with curl (EL9)</span>
</span></span><span style=display:flex><span>curl -L https://github.com/Vonng/pigsty/releases/download/v2.0.0/pigsty-v2.0.0.tgz -o ~/pigsty.tgz
</span></span><span style=display:flex><span>curl -L https://github.com/Vonng/pigsty/releases/download/v2.0.0/pigsty-pkg-v2.0.0.el9.x86_64.tgz  -o /tmp/pkg.tgz
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL7: https://github.com/Vonng/pigsty/releases/download/v2.0.0/pigsty-pkg-v2.0.0.el7.x86_64.tgz</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL8: https://github.com/Vonng/pigsty/releases/download/v2.0.0/pigsty-pkg-v2.0.0.el8.x86_64.tgz</span>
</span></span></code></pre></div></details><p><strong>亮点</strong></p><ul><li>完美整合 PostgreSQL 15, PostGIS 3.3, Citus 11.2, TimescaleDB 2.10，分布式地理时序超融合数据库。</li><li>OS兼容性大幅增强：支持 EL7，8，9，以及 RHEL, CentOS, Rocky, OracleLinux, AlmaLinux等兼容发行版。</li><li>安全性改进：自签名CA，全局网络流量SSL加密，密码scram-sha-256认证，备份采用AES加密，重制的HBA规则系统。</li><li>Patroni升级至3.0，提供原生的高可用 Citus 分布式集群支持，默认启用FailSafe模式，无惧DCS故障致全局主库瘫痪。</li><li>提供基于 pgBackRest 的开箱即用的时间点恢复 PITR 支持，默认支持本地文件系统与专用MinIO/S3集群备份。</li><li>新模块 <code>ETCD</code>，可独立部署，简易扩缩容，自带监控高可用，彻底取代 Consul 作为高可用 PG 的 DCS。</li><li>新模块 <code>MINIO</code>，可独立部署，支持多盘多节点部署，用作S3本地替代，亦用于集中式 PostgreSQL 备份仓库。</li><li>大幅精简配置文件参数，无需默认值即可使用；模板自动根据机器规格调整主机与PG参数，HBA/服务的定义更简洁泛用。</li><li>受 Grafana 与 MinIO 影响，软件协议由 Apache License 2.0 变更为 AGPL 3.0</li></ul><p><strong>兼容性</strong></p><ul><li>支持 EL7, EL8, EL9 三个大版本，并提供三个版本对应的离线软件包，默认开发测试环境由EL7升级至EL9。</li><li>支持更多EL兼容Linux发行版：RHEL, CentOS, RockyLinux, AlmaLinux, OracleLinux等…</li><li>源码包与离线软件包的命名规则发生改变，现在版本号，操作系统版本号，架构都会体现在包名中。</li><li><code>PGSQL</code>: PostgreSQL 15.2, PostGIS 3.3, Citus 11.2, TimescaleDB 2.10 现可同时使用，协同工作。</li><li><code>PGSQL</code>: Patroni 升级至 3.0 版本，作为 PGSQL 的高可用组件。<ul><li>默认使用 ETCD 作为 DCS，取代 Consul，减少一个 Consul Agent 失效点。</li><li>因为 vip-manager 升级至 2.1 并使用 ETCDv3 API，彻底弃用 ETCDv2 API，Patroni同理</li><li>提供原生的高可用 Citus 分布式集群支持。使用完全开源所有功能的 Citus 11.2。</li><li>默认启用FailSafe模式，无惧DCS故障致全局主库瘫痪。</li></ul></li><li><code>PGSQL</code>: 引入 pgBackrest v2.44 提供开箱即用的 PostgreSQL 时间点恢复 PITR 功能<ul><li>默认使用主库上的备份目录创建备份仓库，滚动保留两天的恢复窗口。</li><li>默认备选备份仓库为专用 MinIO/S3 集群，滚动保留两周的恢复窗口，本地使用需要启用 MinIO 模块。</li></ul></li><li><code>ETCD</code> 现在作为一个独立部署的模块，带有完整的扩容/缩容方案与监控。</li><li><code>MINIO</code> 现在成为一个独立部署的模块，支持多盘多节点部署，用作S3本地替代，亦可用作集中式备份仓库。</li><li><code>NODE</code> 模块现在包含 <code>haproxy</code>, <code>docker</code>, <code>node_exporter</code>, <code>promtail</code> 功能组件<ul><li><code>chronyd</code> 现在取代 <code>ntpd</code> 成为所有节点默认的 NTP 服务。</li><li>HAPROXY 现从属于 <code>NODE</code> 的一部分，而不再是 <code>PGSQL</code> 专属，可以 NodePort 的方式对外暴露服务。</li><li>现在 <code>PGSQL</code> 模块可以使用专用的集中式 HAPROXY 集群统一对外提供服务。</li></ul></li><li><code>INFRA</code> 模块现在包含 <code>dnsmasq</code>, <code>nginx</code>, <code>prometheus</code>, <code>grafana</code>, <code>loki</code> 等组件<ul><li>Infra 模块中的 DNSMASQ 服务器默认启用，并添加为所有节点的默认 DNS 服务器之一。</li><li>添加了 <code>blackbox_exporter</code> 用于主机 PING 探测，<code>pushgateway</code> 用于批处理任务指标。</li><li><code>loki</code> 与 <code>promtail</code> 现在使用 Grafana 默认的软件包，使用官方的 Grafana Echarts 面板插件</li><li>提供针对 PostgreSQL 15 的新增可观测性位点的监控支持，添加 Patroni 监控</li></ul></li><li>软件版本升级<ul><li>PostgreSQL 15.2 / PostGIS 3.3 / TimescaleDB 2.10 / Citus 11.2</li><li>Patroni 3.0 / Pgbouncer 1.18 / pgBackRest 2.44 / vip-manager 2.1</li><li>HAProxy 2.7 / Etcd 3.5 / MinIO 20230131022419 / mcli 20230128202938</li><li>Prometheus 2.42 / Grafana 9.3 / Loki & Promtail 2.7 / Node Exporter 1.5</li></ul></li></ul><p><strong>安全性</strong></p><ul><li>启用了一个完整的本地自签名CA：<code>pigsty-ca</code>，用于签发内网组件所使用的证书。</li><li>创建用户/修改密码的操作将不再会在日志文件中留下痕迹。</li><li>Nginx 默认启用 SSL 支持（如需HTTPS，您需要在系统中信任<code>pigsty-ca</code>，或使用Chrome <code>thisisunsafe</code>）</li><li>ETCD 全面启用 SSL 加密客户端与服务端对等通信</li><li>PostgreSQL 添加并默认启用了 SSL 支持，管理链接默认都使用SSL访问。</li><li>Pgbouncer 添加了 SSL 支持，出于性能考虑默认不启用。</li><li>Patroni 添加了 SSL 支持，并默认限制了管理 API 只能从本机与管理节点使用密码认证方可访问。</li><li>PostgreSQL 的默认密码认证方式由 <code>md5</code> 改为 <code>scram-sha-256</code>。</li><li>Pgbouncer添加了认证查询支持，可以动态管理连接池用户。</li><li>pgBackRest 使用远端集中备份存储仓库时，默认使用 <code>AES-256-CBC</code> 加密备份数据。</li><li>提供高安全等级配置模板：强制使用全局 SSL，并要求使用管理员证书登陆。</li><li>所有默认HBA规则现在全部在配置文件中显式定义。</li></ul><p><strong>可维护性</strong></p><ul><li>现有的配置模板可根据机器规格（CPU/内存/存储）自动调整优化。</li><li>现在可以动态配置 Postgres/Pgbouncer/Patroni/pgBackRest 的日志目录：默认为：<code>/pg/log/&lt;type>/</code></li><li>原有的 IP 地址占位符 <code>10.10.10.10</code> 被替换为一个专用变量：<code>${admin_ip}</code>，可在多处引用，便于切换备用管理节点。</li><li>您可以指定 <code>region</code> 来使用不同地区的上游镜像源，以加快软件包的下载速度。</li><li>现在允许用户定义更细粒度的上游源地址，您可以根据不同的EL版本、架构，以及地区，使用不同的上游源。</li><li>提供了阿里云与AWS中国地区的 Terraform 模板，可用于一键拉起所需的 EC2 虚拟机。</li><li>提供了多种不同规格的 Vagrant 沙箱模板：<code>meta</code>, <code>full</code>, <code>el7/8/9</code>, <code>minio</code>, <code>build</code>, <code>citus</code></li><li>添加了新的专用剧本：<code>pgsql-monitor.yml</code> 用于监控现有的 Postgres 实例或 RDS。</li><li>添加了新的专用剧本：<code>pgsql-migration.yml</code> ，使用逻辑复制无缝迁移现有实例至 Pigsty管理的集群。</li><li>添加了一系列专用 Shell 实用命令，封装常见运维操作，方便用户使用。</li><li>优化了所有 Ansible Role 的实现，使其更加简洁、易读、易维护，无需默认参数即可使用。</li><li>允许在业务数据库/用户的层次上定义额外的 Pgbouncer 参数。</li></ul><p><strong>API变更</strong></p><p>Pigsty v2.0 进行了大量变更，新增64个参数，移除13个参数，重命名17个参数。</p><p><strong>新增的参数</strong></p><ul><li><code>INFRA</code>.<code>META</code>.<code>admin_ip</code> : 主元节点 IP 地址</li><li><code>INFRA</code>.<code>META</code>.<code>region</code> : 上游镜像区域：default|china|europe</li><li><code>INFRA</code>.<code>META</code>.<code>os_version</code> : 企业版 Linux 发行版本：7,8,9</li><li><code>INFRA</code>.<code>CA</code>.<code>ca_cn</code> : CA 通用名称，默认为 pigsty-ca</li><li><code>INFRA</code>.<code>CA</code>.<code>cert_validity</code> : 证书有效期，默认为 20 年</li><li><code>INFRA</code>.<code>REPO</code>.<code>repo_enabled</code> : 在 infra 节点上构建本地 yum 仓库吗？</li><li><code>INFRA</code>.<code>REPO</code>.<code>repo_upstream</code> : 上游 yum 仓库定义列表</li><li><code>INFRA</code>.<code>REPO</code>.<code>repo_home</code> : 本地 yum 仓库的主目录，通常与 nginx_home &lsquo;/www&rsquo; 相同</li><li><code>INFRA</code>.<code>NGINX</code>.<code>nginx_ssl_port</code> : https 监听端口</li><li><code>INFRA</code>.<code>NGINX</code>.<code>nginx_ssl_enabled</code> : 启用 nginx https 吗？</li><li><code>INFRA</code>.<code>PROMTETHEUS</code>.<code>alertmanager_endpoint</code> : altermanager 端点（ip|domain）：端口格式</li><li><code>NODE</code>.<code>NODE_TUNE</code>.<code>node_hugepage_ratio</code> : 内存 hugepage 比率，默认禁用，值为 0</li><li><code>NODE</code>.<code>HAPROXY</code>.<code>haproxy_service</code> : 要公开的 haproxy 服务列表</li><li><code>PGSQL</code>.<code>PG_ID</code>.<code>pg_mode</code> : pgsql 集群模式：pgsql,citus,gpsql</li><li><code>PGSQL</code>.<code>PG_BUSINESS</code>.<code>pg_dbsu_password</code> : dbsu 密码，默认为空字符串表示没有 dbsu 密码</li><li><code>PGSQL</code>.<code>PG_INSTALL</code>.<code>pg_log_dir</code> : postgres 日志目录，默认为 <code>/pg/data/log</code></li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_storage_type</code> : SSD|HDD，默认为 SSD</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>patroni_log_dir</code> : patroni 日志目录，默认为 <code>/pg/log</code></li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>patroni_ssl_enabled</code> : 使用 SSL 保护 patroni RestAPI 通信？</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>patroni_username</code> : patroni rest api 用户名</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>patroni_password</code> : patroni rest api 密码（重要：请更改此密码）</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>patroni_citus_db</code> : 由 patroni 管理的 citus 数据库，默认为 postgres</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_max_conn</code> : postgres 最大连接数，<code>auto</code> 将使用推荐值</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_shmem_ratio</code> : postgres 共享内存比率，默认为 0.25，范围 0.1~0.4</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_rto</code> : 恢复时间目标，故障转移的 ttl，默认为 30s</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_rpo</code> : 恢复点目标，默认最多丢失 1MB 数据</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_pwd_enc</code> : 密码加密算法：md5|scram-sha-256</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pgbouncer_log_dir</code> : pgbouncer 日志目录，默认为 <code>/var/log/pgbouncer</code></li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pgbouncer_auth_query</code> : 如果启用，查询 pg_authid 表以检索 biz 用户，而不是填充用户列表</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pgbouncer_sslmode</code> : pgbouncer 客户端的 SSL：disable|allow|prefer|require|verify-ca|verify-full</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_service_provider</code> : 专用的 haproxy 节点组名称，或者默认为本地节点的空字符串</li><li><code>PGSQL</code>.<code>PG_BOOTSTRAP</code>.<code>pg_default_service_dest</code> : 如果 svc.dest=&lsquo;default&rsquo;，则为默认服务目标</li><li><code>PGSQL</code>.<code>PG_BACKUP</code>.<code>pgbackrest_enabled</code> : 启用 pgbackrest 吗？</li><li><code>PGSQL</code>.<code>PG_BACKUP</code>.<code>pgbackrest_clean</code> : 初始化期间删除 pgbackrest 数据吗？</li><li><code>PGSQL</code>.<code>PG_BACKUP</code>.<code>pgbackrest_log_dir</code> : pgbackrest 日志目录，默认为 <code>/pg/log</code></li><li><code>PGSQL</code>.<code>PG_BACKUP</code>.<code>pgbackrest_method</code> : pgbackrest 备份仓库方法，local 或 minio</li><li><code>PGSQL</code>.<code>PG_BACKUP</code>.<code>pgbackrest_repo</code> : pgbackrest 备份仓库配置</li><li><code>PGSQL</code>.<code>PG_DNS</code>.<code>pg_dns_suffix</code> : pgsql dns 后缀，默认为空字符串</li><li><code>PGSQL</code>.<code>PG_DNS</code>.<code>pg_dns_target</code> : auto, primary, vip, none 或 ad hoc ip</li><li><code>ETCD</code>.<code>etcd_seq</code> : etcd 实例标识符，必需</li><li><code>ETCD</code>.<code>etcd_cluster</code> : etcd 集群和组名称，默认为 etcd</li><li><code>ETCD</code>.<code>etcd_safeguard</code> : 防止清除正在运行的 etcd 实例吗？</li><li><code>ETCD</code>.<code>etcd_clean</code> : 在初始化期间清除现有的 etcd 吗？</li><li><code>ETCD</code>.<code>etcd_data</code> : etcd 数据目录，默认为 /data/etcd</li><li><code>ETCD</code>.<code>etcd_port</code> : etcd 客户端端口，默认为 2379</li><li><code>ETCD</code>.<code>etcd_peer_port</code> : etcd 对等端口，默认为 2380</li><li><code>ETCD</code>.<code>etcd_init</code> : etcd 初始集群状态，新建或已存在</li><li><code>ETCD</code>.<code>etcd_election_timeout</code> : etcd 选举超时，默认为 1000ms</li><li><code>ETCD</code>.<code>etcd_heartbeat_interval</code> : etcd 心跳间隔，默认为 100ms</li><li><code>MINIO</code>.<code>minio_seq</code> : minio 实例标识符，必须参数</li><li><code>MINIO</code>.<code>minio_cluster</code> : minio 集群名称，默认为 minio</li><li><code>MINIO</code>.<code>minio_clean</code> : 初始化时清理 minio 吗？默认为 false</li><li><code>MINIO</code>.<code>minio_user</code> : minio 操作系统用户，默认为 <code>minio</code></li><li><code>MINIO</code>.<code>minio_node</code> : minio 节点名模式</li><li><code>MINIO</code>.<code>minio_data</code> : minio 数据目录，使用 {x&mldr;y} 来指定多个驱动器</li><li><code>MINIO</code>.<code>minio_domain</code> : minio 外部域名，默认为 <code>sss.pigsty</code></li><li><code>MINIO</code>.<code>minio_port</code> : minio 服务端口，默认为 9000</li><li><code>MINIO</code>.<code>minio_admin_port</code> : minio 控制台端口，默认为 9001</li><li><code>MINIO</code>.<code>minio_access_key</code> : 根访问密钥，默认为 <code>minioadmin</code></li><li><code>MINIO</code>.<code>minio_secret_key</code> : 根秘密密钥，默认为 <code>minioadmin</code></li><li><code>MINIO</code>.<code>minio_extra_vars</code> : minio 服务器的额外环境变量</li><li><code>MINIO</code>.<code>minio_alias</code> : 本地 minio 部署的别名</li><li><code>MINIO</code>.<code>minio_buckets</code> : 待创建的 minio 存储桶列表</li><li><code>MINIO</code>.<code>minio_users</code> : 待创建的 minio 用户列表</li></ul><p><strong>移除的参数</strong></p><ul><li><code>INFRA</code>.<code>CA</code>.<code>ca_homedir</code> : CA 主目录，现在固定为 <code>/etc/pki/</code></li><li><code>INFRA</code>.<code>CA</code>.<code>ca_cert</code> : CA 证书文件名，现在固定为 <code>ca.key</code></li><li><code>INFRA</code>.<code>CA</code>.<code>ca_key</code> : CA 密钥文件名，现在固定为 <code>ca.key</code></li><li><code>INFRA</code>.<code>REPO</code>.<code>repo_upstreams</code> : 已被 <code>repo_upstream</code> 替代</li><li><code>PGSQL</code>.<code>PG_INSTALL</code>.<code>pgdg_repo</code> : 现在由节点 playbooks 负责</li><li><code>PGSQL</code>.<code>PG_INSTALL</code>.<code>pg_add_repo</code> : 现在由节点 playbooks 负责</li><li><code>PGSQL</code>.<code>PG_IDENTITY</code>.<code>pg_backup</code> : 未使用且与部分名称冲突</li><li><code>PGSQL</code>.<code>PG_IDENTITY</code>.<code>pg_preflight_skip</code> : 不再使用，由 <code>pg_id</code> 替代</li><li><code>DCS</code>.<code>dcs_name</code> : 由于使用 etcd 而被移除</li><li><code>DCS</code>.<code>dcs_servers</code> : 被 ad hoc 组 <code>etcd</code> 替代</li><li><code>DCS</code>.<code>dcs_registry</code> : 由于使用 etcd 而被移除</li><li><code>DCS</code>.<code>dcs_safeguard</code> : 被 <code>etcd_safeguard</code> 替代</li><li><code>DCS</code>.<code>dcs_clean</code> : 被 <code>etcd_clean</code> 替代</li></ul><p><strong>重命名的参数</strong></p><ul><li><code>nginx_upstream</code> -> <code>infra_portal</code></li><li><code>repo_address</code> -> <code>repo_endpoint</code></li><li><code>pg_hostname</code> -> <code>node_id_from_pg</code></li><li><code>pg_sindex</code> -> <code>pg_group</code></li><li><code>pg_services</code> -> <code>pg_default_services</code></li><li><code>pg_services_extra</code> -> <code>pg_services</code></li><li><code>pg_hba_rules_extra</code> -> <code>pg_hba_rules</code></li><li><code>pg_hba_rules</code> -> <code>pg_default_hba_rules</code></li><li><code>pgbouncer_hba_rules_extra</code> -> <code>pgb_hba_rules</code></li><li><code>pgbouncer_hba_rules</code> -> <code>pgb_default_hba_rules</code></li><li><code>vip_mode</code> -> <code>pg_vip_enabled</code></li><li><code>vip_address</code> -> <code>pg_vip_address</code></li><li><code>vip_interface</code> -> <code>pg_vip_interface</code></li><li><code>node_packages_default</code> -> <code>node_default_packages</code></li><li><code>node_packages_meta</code> -> <code>infra_packages</code></li><li><code>node_packages_meta_pip</code> -> <code>infra_packages_pip</code></li><li><code>node_data_dir</code> -> <code>node_data</code></li></ul><p><strong>Checksums</strong></p><pre tabindex=0><code>MD5 (pigsty-pkg-v2.0.0-rc1.el7.x86_64.tgz) = af4b5db9dc38c860de609956a8f1f0d3
MD5 (pigsty-pkg-v2.0.0-rc1.el8.x86_64.tgz) = 5b7152e142df3e3cbc06de30bd70e433
MD5 (pigsty-pkg-v2.0.0-rc1.el9.x86_64.tgz) = 1362e2a5680fc1a3a014cc4f304100bd
</code></pre><p>特别感谢意大利用户 @alemacci 在 SSL加密，备份，多操作系统发行版适配与自适应参数模版上的贡献！</p><hr><h2 id=v151>v1.5.1</h2><p><strong>亮点</strong></p><p>重要：修复了PG14.0-14.3中 <code>CREATE INDEX|REINDEX CONCURRENTLY</code> 可能导致索引数据损坏的问题。</p><p>Pigsty v1.5.1 升级默认PostgreSQL版本至 14.4 强烈建议尽快更新。</p><p><strong>软件升级</strong></p><ul><li>postgres 升级至 to 14.4</li><li>haproxy 升级至 to 2.6.0</li><li>grafana 升级至 to 9.0.0</li><li>prometheus 升级至 2.36.0</li><li>patroni 升级至 2.1.4</li></ul><p><strong>问题修复</strong></p><ul><li>修复了<code>pgsql-migration.yml</code>中的TYPO</li><li>移除了HAProxy配置文件中的PID配置项</li><li>移除了默认软件包中的 i686 软件包</li><li>默认启用所有Systemd Redis Service</li><li>默认启用所有Systemd Patroni Service</li></ul><p><strong>API变更</strong></p><ul><li><code>grafana_database</code> 与 <code>grafana_pgurl</code> 被标记为过时API，将从后续版本移除</li></ul><p><strong>New Apps</strong></p><ul><li>wiki.js : 使用Postgres搭建本地维基百科</li><li>FerretDB ： 使用Postgres提供MongoDB API</li></ul><hr><h2 id=v150>v1.5.0</h2><p><strong>亮点概述</strong></p><ul><li>完善的Docker支持：在管理节点上默认启用并提供诸多开箱即用的软件模板：bytebase, pgadmin, pgweb, postgrest, minio等。</li><li>基础设施自我监控：Nginx， ETCD， Consul， Prometheus， Grafana， Loki 自我监控</li><li>CMDB升级：兼容性改善，支持Redis集群/Greenplum集群元数据，配置文件可视化。</li><li>服务发现改进：可以使用Consul自动发现所有待监控对象，并纳入Prometheus中。</li><li>更好的冷备份支持：默认定时备份任务，添加<code>pg_probackup</code>备份工具，一键创建延时从库。</li><li>ETCD现在可以用作PostgreSQL/Patroni的DCS服务，作为Consul的备选项。</li><li>Redis剧本/角色改善：现在允许对单个Redis实例，而非整个Redis节点进行初始化与移除。</li></ul><p><strong>详细变更列表</strong></p><p><strong>监控面板</strong></p><ul><li>CMDB Overview：可视化Pigsty CMDB Inventory。</li><li>DCS Overview：查阅Consul与ETCD集群的监控指标。</li><li>Nginx Overview：查阅Pigsty Web访问指标与访问日志。</li><li>Grafana Overview：Grafana自我监控</li><li>Prometheus Overview：Prometheus自我监控</li><li>INFRA Dashboard进行重制，反映基础设施整体状态</li></ul><p><strong>监控架构</strong></p><ul><li>现在允许使用 Consul 进行服务发现（当所有服务注册至Consul时）</li><li>现在所有的Infra组件会启用自我监控，并通过<code>infra_register</code>角色注册至Prometheus与Consul中。</li><li>指标收集器 pg_exporter 更新至 v0.5.0，添加新功能，<code>scale</code> 与 <code>default</code>，允许为指标指定一个倍乘因子，以及指定默认值。</li><li><code>pg_bgwriter</code>, <code>pg_wal</code>, <code>pg_query</code>, <code>pg_db</code>, <code>pgbouncer_stat</code> 关于时间的指标，单位由默认的毫秒或微秒统一缩放至秒。</li><li><code>pg_table</code> 中的相关计数器指标，现在配置有默认值 <code>0</code>，替代原有的<code>NaN</code>。</li><li><code>pg_class</code>指标收集器默认移除，相关指标添加至 <code>pg_table</code> 与 <code>pg_index</code> 收集器中。</li><li><code>pg_table_size</code> 指标收集器现在默认启用，默认设置有300秒的缓存时间。</li></ul><p><strong>部署方案</strong></p><ul><li>新增可选软件包 <code>docker.tgz</code>，带有常用应用镜像：Pgadmin, Pgweb, Postgrest, ByteBase, Kong, Minio等。</li><li>新增角色ETCD，可以在DCS Servers指定的节点上自动部署ETCD服务，并自动纳入监控。</li><li>允许通过 <code>pg_dcs_type</code> 指定PG高可用使用的DCS服务，Consul（默认），ETCD（备选）</li><li>允许通过 <code>node_crontab</code> 参数，为节点配置定时任务，例如数据库备份、VACUUM，统计收集等。</li><li>新增了 <code>pg_checksum</code> 选项，启用时，数据库集群将启用数据校验和（此前只有<code>crit</code>模板默认启用）</li><li>新增了<code>pg_delay</code>选项，当实例为Standby Cluster Leader时，此参数可以用于配置一个<strong>延迟从库</strong></li><li>新增了软件包 <code>pg_probackup</code>，默认角色<code>replicator</code>现在默认赋予了备份相关函数所需的权限。</li><li>Redis部署现在拆分为两个部分：Redis节点与Redis实例，通过<code>redis_port</code>参数可以精确控制一个具体实例。</li><li>Loki 与 Promtail 现在使用 <code>frpm</code> 制作的 RPM软件包进行安装。</li><li>DCS3配置模板现在使用一个3节点的<code>pg-meta</code>集群，与一个单节点的延迟从库。</li></ul><p><strong>软件升级</strong></p><ul><li>升级 PostgreSQL 至 14.3</li><li>升级 Redis 至 6.2.7</li><li>升级 PG Exporter 至 0.5.0</li><li>升级 Consul 至 1.12.0</li><li>升级 vip-manager 至 v1.0.2</li><li>升级 Grafana 至 v8.5.2</li><li>升级 Loki & Promtail 至 v2.5.0，使用frpm打包。</li></ul><p><strong>问题修复</strong></p><ul><li>修复了Loki 与 Promtail 默认配置文件名的问题</li><li>修复了Loki 与 Promtail 环境变量无法正确展开的问题</li><li>对英文文档进行了一次完整的翻译与修缮，文档依赖的JS资源现在直接从本地获取，无需互联网访问。</li></ul><p><strong>API变化</strong></p><p><strong>新参数</strong></p><ul><li><code>node_data_dir</code> : 主要的数据挂载路径，如果不存在会被创建。</li><li><code>node_crontab_overwrite</code> : 覆盖 <code>/etc/crontab</code> 而非追加内容。</li><li><code>node_crontab</code>: 要被追加或覆盖的 node crontab 内容。</li><li><code>nameserver_enabled</code>: 在这个基础设施节节点上启用 nameserver 吗？</li><li><code>prometheus_enabled</code>: 在这个基础设施节节点上启用 prometheus 吗？</li><li><code>grafana_enabled</code>: 在这个基础设施节节点上启用 grafana 吗？</li><li><code>loki_enabled</code>: 在这个基础设施节节点上启用 loki 吗？</li><li><code>docker_enable</code>: 在这个基础设施节点上启用 docker 吗？</li><li><code>consul_enable</code>: 启用 consul 服务器/代理吗？</li><li><code>etcd_enable</code>: 启用 etcd 服务器/客户端吗？</li><li><code>pg_checksum</code>: 启用 pg 集群数据校验和吗？</li><li><code>pg_delay</code>: 备份集群主库复制重放时的应用延迟。</li></ul><p><strong>参数重制</strong></p><p>现在 <code>*_clean</code> 是布尔类型的参数，用于在初始化期间清除现有实例。</p><p><code>*_safeguard</code> 也是布尔类型的参数，用于在执行任何剧本时，避免清除正在运行的实例。</p><ul><li><code>pg_exists_action</code> -> <code>pg_clean</code></li><li><code>pg_disable_purge</code> -> <code>pg_safeguard</code></li><li><code>dcs_exists_action</code> -> <code>dcs_clean</code></li><li><code>dcs_disable_purge</code> -> <code>dcs_safeguard</code></li></ul><p><strong>参数重命名</strong></p><ul><li><code>node_ntp_config</code> -> <code>node_ntp_enabled</code></li><li><code>node_admin_setup</code> -> <code>node_admin_enabled</code></li><li><code>node_admin_pks</code> -> <code>node_admin_pk_list</code></li><li><code>node_dns_hosts</code> -> <code>node_etc_hosts_default</code></li><li><code>node_dns_hosts_extra</code> -> <code>node_etc_hosts</code></li><li><code>node_dns_server</code> -> <code>node_dns_method</code></li><li><code>node_local_repo_url</code> -> <code>node_repo_local_urls</code></li><li><code>node_packages</code> -> <code>node_packages_default</code></li><li><code>node_extra_packages</code> -> <code>node_packages</code></li><li><code>node_packages_meta</code> -> <code>node_packages_meta</code></li><li><code>node_meta_pip_install</code> -> <code>node_packages_meta_pip</code></li><li><code>node_sysctl_params</code> -> <code>node_tune_params</code></li><li><code>app_list</code> -> <code>nginx_indexes</code></li><li><code>grafana_plugin</code> -> <code>grafana_plugin_method</code></li><li><code>grafana_cache</code> -> <code>grafana_plugin_cache</code></li><li><code>grafana_plugins</code> -> <code>grafana_plugin_list</code></li><li><code>grafana_git_plugin_git</code> -> <code>grafana_plugin_git</code></li><li><code>haproxy_admin_auth_enabled</code> -> <code>haproxy_auth_enabled</code></li><li><code>pg_shared_libraries</code> -> <code>pg_libs</code></li><li><code>dcs_type</code> -> <code>pg_dcs_type</code></li></ul><hr><h2 id=v141>v1.4.1</h2><p>日常错误修复 / Docker 支持 / 英文文档</p><p>现在，默认在元节点上启用 docker。您可以使用它启动海量的各类软件</p><p>现在提供英文文档。</p><ul><li><a href=https://github.com/Vonng/pigsty/commit/68f8c8da0576e043686137aca47bad01dd4e82c0>将 docker 添加到默认包列表</a></li><li><a href=https://github.com/Vonng/pigsty/commit/765077744836d8600a8703dce8623182784d65a7>将 docker-compose 添加到默认包列表</a></li><li><a href=https://github.com/Vonng/pigsty/commit/9b8b7c5209d09049716318b624001de3b567452a>默认禁用 nameserver & 默认启用 docker 角色</a></li></ul><p><strong>Bug 修复</strong></p><ul><li><a href=https://github.com/Vonng/pigsty/commit/100f31842d473001f946200d9b8e2e3e89add35a>修复 promtail & loki 配置变量问题</a></li><li>修复 grafana 旧版警报。</li><li>默认禁用 nameserver</li><li>为 patroni 快捷方式重命名 pg-alias.sh</li><li><a href=https://github.com/Vonng/pigsty/commit/62d74f15f8c164e5971d9d1d1215869359267b53>为所有仪表板禁用 exemplars 查询</a></li><li><a href=https://github.com/Vonng/pigsty/commit/b277f488b7ed0fd0a7eeeb995e2efd75a048e0ef>修复 loki 数据目录问题</a> <a href=https://github.com/Vonng/pigsty/issues/100>https://github.com/Vonng/pigsty/issues/100</a></li><li><a href=https://github.com/Vonng/pigsty/commit/1690b490205af24d5f0394aba99007c0d9ebc49d>将 autovacuum_freeze_max_age 从 100000000 更改为 1000000000</a></li></ul><hr><h2 id=v140>v1.4.0</h2><p><strong>架构</strong></p><ul><li>将系统解耦为4大类别：<code>INFRA</code>、<code>NODES</code>、<code>PGSQL</code>、<code>REDIS</code>，这使得pigsty更加清晰、更易于扩展。</li><li>单节点部署 = <code>INFRA</code> + <code>NODES</code> + <code>PGSQL</code></li><li>部署pgsql集群 = <code>NODES</code> + <code>PGSQL</code></li><li>部署redis集群 = <code>NODES</code> + <code>REDIS</code></li><li>部署其他数据库 = <code>NODES</code> + xxx（例如 <code>MONGO</code>、<code>KAFKA</code>&mldr;待定）</li></ul><p><strong>可访问性</strong></p><ul><li>为中国大陆提供CDN。</li><li>使用 <code>bash -c "$(curl -fsSL http://get.pigsty.cc/latest)"</code> 获取最新源代码。</li><li>使用新的 <code>download</code> 脚本下载并提取包。</li></ul><p><strong>监控增强</strong></p><ul><li>将监控系统分为5大类别：<code>INFRA</code>、<code>NODES</code>、<code>REDIS</code>、<code>PGSQL</code>、<code>APP</code></li><li>默认启用日志记录<ul><li>现在默认启用<code>loki</code>和<code>promtail</code>，带有预构建的 <a href=https://github.com/Vonng/loki-rpm>loki-rpm</a>。</li></ul></li><li>模型和标签<ul><li>为所有仪表板添加了一个隐藏的<code>ds</code> prometheus数据源变量，因此您只需选择一个新的数据源而不是修改Grafana数据源和仪表板。</li><li>为所有指标添加了一个<code>ip</code>标签，并将其用作数据库指标和节点指标之间的连接键。</li></ul></li><li>INFRA监控<ul><li>Infra主仪表板：INFRA概览</li><li>添加日志仪表板：日志实例</li><li>PGLOG分析和PGLOG会话现在被视为一个示例Pigsty APP。</li></ul></li><li>NODES监控应用<ul><li>如果您完全不关心数据库，现在可以单独使用Pigsty作为主机监控软件！</li><li>包括4个核心仪表板：节点概览 & 节点集群 & 节点实例 & 节点警报</li><li>为节点引入新的身份变量：<code>node_cluster</code> 和 <code>nodename</code></li><li>变量<code>pg_hostname</code>现在意味着将主机名设置为与postgres实例名相同，以保持向后兼容性</li><li>变量<code>nodename_overwrite</code> 控制是否用nodename覆盖节点的主机名</li><li>变量<code>nodename_exchange</code> 将nodename写入彼此的<code>/etc/hosts</code></li><li>所有节点指标引用都经过修订，通过<code>ip</code>连接</li><li>节点监控目标在<code>/etc/prometheus/targets/nodes</code>下单独管理</li></ul></li><li>PGSQL监控增强<ul><li>完全新的PGSQL集群，简化并专注于集群中的重要内容。</li><li>新仪表板PGSQL数据库是集群级对象监控。例如整个集群而不是单个实例的表和查询。</li><li>PGSQL警报仪表板现在只关注pgsql警报。</li><li>PGSQL Shard已添加到PGSQL中。</li></ul></li><li>Redis监控增强<ul><li>为所有redis仪表板添加节点监控。</li></ul></li></ul><p><strong>MatrixDB支持</strong></p><ul><li>通过<code>pigsty-matrix.yml</code> playbook可以部署MatrixDB（Greenplum 7）</li><li>MatrixDB监控仪表板：PGSQL MatrixDB</li><li>添加示例配置：<code>pigsty-mxdb.yml</code></li></ul><p><strong>监控增强</strong></p><ul><li>将监控系统分为5大类别：<code>INFRA</code>、<code>NODES</code>、<code>REDIS</code>、<code>PGSQL</code>、<code>APP</code></li><li>默认启用日志记录<ul><li>现在默认启用<code>loki</code>和<code>promtail</code>，带有预构建的 <a href=https://github.com/Vonng/loki-rpm>loki-rpm</a>。</li></ul></li><li>模型和标签<ul><li>为所有仪表板添加了一个隐藏的<code>ds</code> prometheus数据源变量，因此您只需选择一个新的数据源而不是修改Grafana数据源和仪表板。</li><li>为所有指标添加了一个<code>ip</code>标签，并将其用作数据库指标和节点指标之间的连接键。</li></ul></li><li>INFRA监控<ul><li>Infra主仪表板：INFRA概览</li><li>添加日志仪表板：日志实例</li><li>PGLOG分析和PGLOG会话现在被视为一个示例Pigsty APP。</li></ul></li><li>NODES监控应用<ul><li>如果您完全不关心数据库，现在可以单独使用Pigsty作为主机监控软件！</li><li>包括4个核心仪表板：节点概览 & 节点集群 & 节点实例 & 节点警报</li><li>为节点引入新的身份变量：<code>node_cluster</code> 和 <code>nodename</code></li><li>变量<code>pg_hostname</code>现在意味着将主机名设置为与postgres实例名相同，以保持向后兼容性</li><li>变量<code>nodename_overwrite</code> 控制是否用nodename覆盖节点的主机名</li><li>变量<code>nodename_exchange</code> 将nodename写入彼此的<code>/etc/hosts</code></li><li>所有节点指标引用都经过修订，通过<code>ip</code>连接</li><li>节点监控目标在<code>/etc/prometheus/targets/nodes</code>下单独管理</li></ul></li><li>PGSQL监控增强<ul><li>完全新的PGSQL集群，简化并专注于集群中的重要内容。</li><li>新仪表板PGSQL数据库是集群级对象监控。例如整个集群而不是单个实例的表和查询。</li><li>PGSQL警报仪表板现在只关注pgsql警报。</li><li>PGSQL Shard已添加到PGSQL中。</li></ul></li><li>Redis监控增强<ul><li>为所有redis仪表板添加节点监控。</li></ul></li></ul><p><strong>MatrixDB支持</strong></p><ul><li>通过<code>pigsty-matrix.yml</code> playbook可以部署MatrixDB（Greenplum 7）</li><li>MatrixDB监控仪表板：PGSQL MatrixDB</li><li>添加示例配置：<code>pigsty-mxdb.yml</code></li></ul><p><strong>置备改进</strong></p><p>现在 pigsty 的工作流如下：</p><pre tabindex=0><code> infra.yml ---&gt; 在单一的元节点上安装 pigsty
      |          然后将更多节点加入 pigsty 的管理下
      |
 nodes.yml ---&gt; 为 pigsty 准备节点（节点设置、dcs、node_exporter、promtail）
      |          然后选择一个 playbook 在这些节点上部署数据库集群
      |
      ^--&gt; pgsql.yml   在已准备好的节点上安装 postgres
      ^--&gt; redis.yml   在已准备好的节点上安装 redis

infra-demo.yml = 
           infra.yml -l meta     +
           nodes.yml -l pg-test  +
           pgsql.yml -l pg-test +
           infra-loki.yml + infra-jupyter.yml + infra-pgweb.yml
</code></pre><ul><li><code>nodes.yml</code>：用于设置和准备 pigsty 的节点，</li><li>在节点上设置 node、node_exporter、consul agent</li><li><code>node-remove.yml</code> 用于节点注销</li><li><code>pgsql.yml</code>：现在只在已准备好的节点上工作</li><li><code>pgsql-remove</code> 现在只负责 postgres 本身（dcs 和节点监控由 <code>node.yml</code> 负责）</li><li>添加一系列新选项以在 greenplum/matrixdb 中重用 <code>postgres</code> 角色</li><li><code>redis.yml</code>：现在在已准备好的节点上工作</li><li>而 <code>redis-remove.yml</code> 现在从节点上移除 redis。</li><li><code>pgsql-matrix.yml</code> 现在在已准备好的节点上安装 matrixdb（Greenplum 7）。</li></ul><p><strong>软件升级</strong></p><ul><li>PostgreSQL 14.2</li><li>PostGIS 3.2</li><li>TimescaleDB 2.6</li><li>Patroni 2.1.3 (Prometheus 指标 + 故障转移插槽)</li><li>HAProxy 2.5.5 (修复统计错误，更多指标)</li><li>PG 导出器 0.4.1 (超时参数等)</li><li>Grafana 8.4.4</li><li>Prometheus 2.33.4</li><li>Greenplum 6.19.4 / MatrixDB 4.4.0</li><li>Loki 现在作为 rpm 包提供，而不是 zip 存档。</li></ul><p><strong>错误修复</strong></p><ul><li>删除 patroni 的 consul 依赖，这使其更容易迁移到新的 consul 集群</li><li>修复 prometheus bin/new 脚本的默认数据目录路径：从 <code>/export/prometheus</code> 更改为 <code>/data/prometheus</code></li><li>在 vip-manager systemd 服务中添加重新启动秒数</li><li>修复错别字和任务</li></ul><p><strong>API 变更</strong></p><p><strong>新增变量</strong></p><ul><li><code>node_cluster</code>：节点集群的身份变量</li><li><code>nodename_overwrite</code>：如果设置，则 nodename 将设置为节点的主机名</li><li><code>nodename_exchange</code>：交换 play 主机之间的节点主机名（在 <code>/etc/hosts</code> 中）</li><li><code>node_dns_hosts_extra</code>：可以通过单个实例/集群轻松覆盖的额外静态 dns 记录</li><li><code>patroni_enabled</code>：如果禁用，postgres & patroni 的引导过程不会在 <code>postgres</code> 角色期间执行</li><li><code>pgbouncer_enabled</code>：如果禁用，pgbouncer 在 <code>postgres</code> 角色期间不会启动</li><li><code>pg_exporter_params</code>：生成监控目标 url 时为 pg_exporter 提供的额外 url 参数。</li><li><code>pg_provision</code>：布尔值变量，表示是否执行 <code>postgres</code> 角色的资源配置部分（模板，数据库，用户）</li><li><code>no_cmdb</code>：用于 <code>infra.yml</code> 和 <code>infra-demo.yml</code> 播放书，不会在元节点上创建 cmdb。</li></ul><pre tabindex=0><code>MD5 (app.tgz) = f887313767982b31a2b094e5589a75ea
MD5 (matrix.tgz) = 3d063437c482d94bd7e35df1a08bbc84
MD5 (pigsty.tgz) = e143b88ebea1474f9ebaffddc6072c49
MD5 (pkg.tgz) = 73e8f5ce995b1f1760cb63c1904fb91b
</code></pre><hr><h2 id=v131>v1.3.1</h2><p><strong>监控</strong></p><ul><li>PGSQL & PGCAT 仪表盘改进</li><li>优化 pgcat 实例 & pgcat 数据库的布局</li><li>在 pgsql 实例仪表盘中添加关键指标面板，与 pgsql 集群保持一致</li><li>在 pgcat 数据库中添加表/索引膨胀面板，移除 pgcat 膨胀仪表盘</li><li>在 pgcat 数据库仪表盘中添加索引信息</li><li>修复在 grafana 8.3 中的损坏面板</li><li>在 nginx 主页中添加 redis 索引</li></ul><p><strong>部署</strong></p><ul><li>新的 <code>infra-demo.yml</code> 剧本用于一次性引导</li><li>使用 <code>infra-jupyter.yml</code> 剧本部署可选的 jupyter lab 服务器</li><li>使用 <code>infra-pgweb.yml</code> 剧本部署可选的 pgweb 服务器</li><li>在 meta 节点上新的 <code>pg</code> 别名，可以从 admin 用户启动 postgres 集群（除了 postgres）</li><li>根据 <code>timescaledb-tune</code> 的建议调整所有 patroni 配置模板中的 <code>max_locks_per_transactions</code></li><li>在配置模板中添加 <code>citus.node_conninfo: 'sslmode=prefer'</code> 以便在没有 SSL 的情况下使用 citus</li><li>在 pgdg14 包列表中添加所有扩展（除了 pgrouting）</li><li>将 node_exporter 升级到 v1.3.1</li><li>将 PostgREST v9.0.0 添加到包列表。从 postgres 模式生成 API。</li></ul><p><strong>错误修复</strong></p><ul><li>Grafana 的安全漏洞（升级到 v8.3.1 <a href=https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/>问题</a>)</li><li>修复 <code>pg_instance</code> & <code>pg_service</code> 在 <code>register</code> 角色中从剧本的中间开始时的问题</li><li>修复在没有 <code>pg_cluster</code> 变量存在的主机上 nginx 主页渲染问题</li><li>在升级到 grafana 8.3.1 时修复样式问题</li></ul><hr><h2 id=v130>v1.3.0</h2><ul><li>【功能增强】Redis 部署（集群、哨兵、主从）</li><li>【功能增强】Redis 监控<ul><li>Redis 总览仪表盘</li><li>Redis 集群仪表盘</li><li>Redis 实例仪表盘
-【功能增强】 监控：PGCAT 大修</li><li>新仪表盘：PGCAT 实例</li><li>新仪表盘：PGCAT 数据库仪表盘</li><li>重做仪表盘：PGCAT 表格</li></ul></li><li>【功能增强】 监控：PGSQL 增强<ul><li>新面板：PGSQL 集群，添加 10 个关键指标面板（默认切换）</li><li>新面板：PGSQL 实例，添加 10 个关键指标面板（默认切换）</li><li>简化 & 重新设计：PGSQL 服务</li><li>在 PGCAT & PGSL 仪表盘之间添加交叉引用
-【功能增强】 监控部署</li><li>现在 grafana 数据源在仅监控部署期间自动注册
-【功能增强】 软件升级</li><li>将 PostgreSQL 13 添加到默认包列表</li><li>默认升级到 PostgreSQL 14.1</li><li>添加 greenplum rpm 和依赖项</li><li>添加 redis rpm & 源代码包</li><li>将 perf 添加为默认包</li></ul></li></ul><hr><h2 id=v120>v1.2.0</h2><ul><li>【功能增强】默认使用 PostgreSQL 14 版本</li><li>【功能增强】默认使用 TimescaleDB 2.5 扩展<ul><li>现在 timescaledb 和 postgis 默认在 cmdb 中启用</li></ul></li><li>【功能增强】 新增仅监控模式：<ul><li>仅通过可连接的 URL，您可以使用 pigsty 监控现有的 pg 实例</li><li>pg_exporter 将在本地的 meta 节点上部署</li><li>新仪表板 PGSQL Cluster Monly 用于远程集群</li></ul></li><li>【功能增强】软件升级<ul><li>grafana 升级到 8.2.2</li><li>pev2 升级到 v0.11.9</li><li>promscale 升级到 0.6.2</li><li>pgweb 升级到 0.11.9</li><li>新增扩展：pglogical、pg_stat_monitor、orafce
-【功能增强】自动检测机器规格并使用适当的 <code>node_tune</code> 和 <code>pg_conf</code> 模板
-【功能增强】重做与膨胀相关的视图，现在公开更多信息
-【功能增强】删除 timescale 和 citus 的内部监控
-【功能增强】新剧本 <code>pgsql-audit.yml</code> 用于创建审计报告
-【BUG修复】现在 pgbouncer_exporter 资源所有者是 {{ pg_dbsu }} 而不是 postgres
-【BUG修复】 修复在执行 <code>REINDEX TABLE CONCURRENTLY</code> 时 pg_exporter 在 pg_table pg_index 上的重复指标
-【功能增强】现在所有配置模板都减少到两个：auto 和 demo。(已删除：<code>pub4, pg14, demo4, tiny, oltp</code>)</li><li>如果 <code>vagrant</code> 是默认用户，则配置 <code>pigsty-demo</code>，否则使用 <code>pigsty-auto</code>。</li></ul></li></ul><p><strong>如何从 v1.1.1 升级</strong></p><p>在 1.2.0 中没有 API 变更。您仍然可以使用旧的 <code>pigsty.yml</code> 配置文件 (PG13)。
对于基础设施部分，重新执行 <code>repo</code> 将完成大部分工作。</p><p>至于数据库，您仍然可以使用现有的 PG13 实例。就地升级在涉及到像 PostGIS 和 Timescale 这样的扩展时非常棘手。我强烈推荐使用逻辑复制进行数据库迁移。
新的剧本 <code>pgsql-migration.yml</code> 将使这一过程变得容易得多。它将创建一系列的脚本，帮助您近乎零停机时间地迁移您的集群。</p><hr><h2 id=v111>v1.1.1</h2><ul><li>【功能增强】 用 <code>timescale</code> 版本替换 timescaledb 的 <code>apache</code> 版本</li><li>【功能增强】 升级 prometheus 到 2.30</li><li>【BUG修复】 现在 pg_exporter 配置目录的属主是 <code>{{ pg_dbsu }}</code>，而不再是 <code>prometheus</code></li></ul><p><strong>如何从v1.1.0升级？</strong></p><p>这个版本的主要变动是 TimescaleDB，使用 TimescaleDB License （TSL）的官方版本替代了 PGDG 仓库中的 Apache License v2 的版本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>stop/pause postgres instance with timescaledb
</span></span><span style=display:flex><span>yum remove -y timescaledb_13
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>timescale_timescaledb<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span>timescale_timescaledb
</span></span><span style=display:flex><span><span style=color:#000>baseurl</span><span style=color:#ce5c00;font-weight:700>=</span>https://packagecloud.io/timescale/timescaledb/el/7/<span style=color:#000>$basearch</span>
</span></span><span style=display:flex><span><span style=color:#000>repo_gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#000>gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#000>enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yum install timescaledb-2-postgresql13 
</span></span></code></pre></div><hr><h2 id=v110>v1.1.0</h2><ul><li>【增强功能】 增加 <code>pg_dummy_filesize</code> 以创建文件系统空间占位符</li><li>【增强功能】 主页大改版</li><li>【增强功能】 增加 Jupyter Lab 整合</li><li>【增强功能】 增加 pgweb 控制台整合</li><li>【增强功能】 增加 pgbadger 支持</li><li>【增强功能】 增加 pev2 支持，解释可视化工具</li><li>【增强功能】 增加 pglog 工具</li><li>【增强功能】 更新默认的 pkg.tgz 软件版本：<ul><li>PostgreSQL 升级至 v13.4（支持官方的 pg14）</li><li>pgbouncer 升级至 v1.16（指标定义更新）</li><li>Grafana 升级至 v8.1.4</li><li>Prometheus 升级至 v2.2.29</li><li>node_exporter 升级至 v1.2.2</li><li>haproxy 升级至 v2.1.1</li><li>consul 升级至 v1.10.2</li><li>vip-manager 升级至 v1.0.1</li></ul></li></ul><p><strong>API 变更</strong></p><ul><li><code>nginx_upstream</code> 现在持有不同的结构。（不兼容）</li><li>新的配置条目：<code>app_list</code>，渲染至主页的导航条目</li><li>新的配置条目：<code>docs_enabled</code>，在默认服务器上设置本地文档</li><li>新的配置条目：<code>pev2_enabled</code>，设置本地的 pev2 工具</li><li>新的配置条目：<code>pgbadger_enabled</code>，创建日志概要/报告目录</li><li>新的配置条目：<code>jupyter_enabled</code>，在元节点上启用 Jupyter Lab 服务器</li><li>新的配置条目：<code>jupyter_username</code>，指定运行 Jupyter Lab 的用户</li><li>新的配置条目：<code>jupyter_password</code>，指定 Jupyter Lab 的默认密码</li><li>新的配置条目：<code>pgweb_enabled</code>，在元节点上启用 pgweb 服务器</li><li>新的配置条目：<code>pgweb_username</code>，指定运行 pgweb 的用户</li><li>将内部标记 <code>repo_exist</code> 重命名为 <code>repo_exists</code></li><li>现在 <code>repo_address</code> 的默认值为 <code>pigsty</code> 而非 <code>yum.pigsty</code></li><li>现在 haproxy 的访问点为 <code>http://pigsty</code> 而非 <code>http://h.pigsty</code></li></ul><hr><h2 id=v101>v1.0.1</h2><p>2021-09-14</p><ul><li>文档更新<ul><li>现已支持中文文档</li><li>现已支持机器翻译的英文文档</li></ul></li><li>错误修复：<code>pgsql-remove</code> 不会移除主实例</li><li>错误修复：用 pg_cluster + pg_seq 替换 pg_instance<ul><li>Start-At-Task 可能因为 pg_instance 未定义而失败</li></ul></li><li>错误修复：从默认共享预加载库中移除 citus<ul><li>citus 会强制 max_prepared_transaction 的值为非零</li></ul></li><li>错误修复：在 <code>configure</code> 中进行 ssh sudo 检查：<ul><li>现在使用 <code>ssh -t sudo -n ls</code> 进行权限检查</li></ul></li><li>笔误修复：<code>pg-backup</code> 脚本的笔误</li><li>警报调整：移除 NTP 合理性检查警报（与 ClockSkew 重复）</li><li>导出器调整：移除 collector.systemd 以减少开销</li></ul><hr><h2 id=v100>v1.0.0</h2><p>v1 正式发布，监控系统全面改进</p><p><strong>亮点</strong></p><ul><li>监控系统全面改进<ul><li>在 Grafana 8.0 上新增仪表盘</li><li>新的度量定义，增加 PG14 支持</li><li>简化的标签系统：静态标签集：(job, cls, ins)</li><li>新的警报规则与衍生度量</li><li>同时监控多个数据库</li><li>实时日志搜索 & csvlog 分析</li><li>链接丰富的仪表盘，点击图形元素进行深入|汇总</li></ul></li><li>架构变更<ul><li>将 citus 和 timescaledb 加入默认安装部分</li><li>增加对 PostgreSQL 14beta2 的支持</li><li>简化 haproxy 管理页面索引</li><li>通过添加新的角色 <code>register</code> 来解耦基础设施和 pgsql</li><li>添加新角色 <code>loki</code> 和 <code>promtail</code> 用于日志记录</li><li>为管理员节点上的管理员用户添加新角色 <code>environ</code> 以设置环境</li><li>默认使用 <code>static</code> 服务发现用于 prometheus（而不是 <code>consul</code>）</li><li>添加新角色 <code>remove</code> 以优雅地移除集群和实例</li><li>升级 prometheus 和 grafana 的配置逻辑</li><li>升级到 vip-manager 1.0，node_exporter 1.2，pg_exporter 0.4，grafana 8.0</li><li>现在，每个实例上的每个数据库都可以自动注册为 grafana 数据源</li><li>将 consul 注册任务移到 <code>register</code> 角色，更改 consul 服务标签</li><li>添加 cmdb.sql 作为 pg-meta 基线定义（CMDB & PGLOG）</li></ul></li><li>应用框架<ul><li>可扩展框架用于新功能</li><li>核心应用：PostgreSQL 监控系统：<code>pgsql</code></li><li>核心应用：PostgreSQL 目录浏览器：<code>pgcat</code></li><li>核心应用：PostgreSQL Csvlog 分析器：<code>pglog</code></li><li>添加示例应用 <code>covid</code> 用于可视化 covid-19 数据</li><li>添加示例应用 <code>isd</code> 用于可视化 isd 数据</li></ul></li><li>其他<ul><li>添加 jupyterlab，为数据科学提供完整的 python 环境</li><li>添加 <code>vonng-echarts-panel</code> 以恢复对 Echarts 的支持</li><li>添加 wrap 脚本 <code>createpg</code>，<code>createdb</code>，<code>createuser</code></li><li>添加 cmdb 动态库存脚本：<code>load_conf.py</code>，<code>inventory_cmdb</code>，<code>inventory_conf</code></li><li>移除过时的剧本：<code>pgsql-monitor</code>，<code>pgsql-service</code>，<code>node-remove</code> 等&mldr;.</li></ul></li></ul><p><strong>API 变更</strong></p><ul><li>新变量: <code>node_meta_pip_install</code></li><li>新变量: <code>grafana_admin_username</code></li><li>新变量: <code>grafana_database</code></li><li>新变量: <code>grafana_pgurl</code></li><li>新变量: <code>pg_shared_libraries</code></li><li>新变量: <code>pg_exporter_auto_discovery</code></li><li>新变量: <code>pg_exporter_exclude_database</code></li><li>新变量: <code>pg_exporter_include_database</code></li><li>变量重命名: <code>grafana_url</code> 为 <a href="https://doc.pigsty.cc/#/zh-cn/v-meta?id=grafana_endpoint"><code>grafana_endpoint</code></a></li></ul><p><strong>Bug 修复</strong></p><ul><li>修复默认时区 Asia/Shanghai (CST) 问题</li><li>修复 pgbouncer & patroni 的 nofile 限制</li><li>当执行标签 <code>pgbouncer</code> 时，pgbouncer 的用户列表和数据库列表将会被生成</li></ul><hr><h2 id=v090>v0.9.0</h2><p>v0.9极大简化了安装流程，进行了大量日志相关改进，开发了命令行工具（Beta），并修复了一系列问题。</p><details><br><p><strong>新功能</strong></p><ul><li><p>一键安装模式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/bin/bash -c <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>curl -fsSL https://pigsty.cc/install<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div></li><li><p>开发命令行工具 <code>pigsty-cli</code>封装常用Ansible命令，目前pigsty-cli处于Beta状态</p></li><li><p>使用Loki与Promtail收集日志：</p><ul><li>默认收集Postgres，Pgbouncer，Patroni日志</li><li>新增部署脚本<code>infra-loki.yml</code> 与 <code>pgsql-promtail.yml</code></li><li>定义基于日志的监控指标</li><li>使用Grafana制作日志相关可视化面板。</li></ul></li><li><p>监控组件可以使用二进制安装，使用<code>files/get_bin.sh</code>下载监控二进制组件。</p></li><li><p>飞升模式：
当集群元节点初始化完成后，可以使用<code>bin/upgrade</code>升级为动态Inventory
使用pg-meta上的数据库代替YAML配置文件。</p></li></ul><p><strong>问题修复</strong></p><ul><li>集中修复日志相关问题：<ul><li>修复了HAProxy健康检查造成PG日志中大量 <code>connection reset by peer</code>的问题。</li><li>修复了HAProxy健康检查造成Patroni日志中大量出现<code>Connect Reset</code> Exception的问题</li><li>修复了Patroni日志时间戳格式，去除毫秒时间戳，附加完整时区信息。</li><li>为<code>dbuser_monitor</code>配置1秒的<code>log_min_duration_statement</code>，避免监控查询出现在日志中。</li></ul></li><li>重构Grafana角色<ul><li>在保持API不变的前提下重构Grafana角色。</li><li>使用CDN下载预打包的Grafana插件，加速插件下载</li></ul></li><li>其他问题修复<ul><li>修复了<code>pgbouncer-create-user</code> 未能正确处理 md5 密码的问题。</li><li>完善了数据库与用户创建SQL模版中参数空置检查。</li><li>修复了 NODE DNS配置时如果手工中断执行，DNS配置可能出错的问题。</li><li>重构了Makefile快捷方式 Makefile 中的错别字</li></ul></li></ul><p><strong>参数变更</strong></p><ul><li><code>node_disable_swap</code> 默认为 False，默认不会关闭SWAP。</li><li><code>node_sysctl_params</code> 不再有默认修改的系统参数。</li><li><code>grafana_plugin</code> 的默认值<code>install</code> 现在意味着当插件缓存不存在时，从CDN下载。</li><li><code>repo_url_packages</code> 现在从 Pigsty CDN 下载额外的RPM包，解决墙内无法访问的问题。</li><li><code>proxy_env.no_proxy</code>现在将Pigsty CDN加入到NOPROXY列表中。</li><li><code>grafana_customize</code> 现在默认为<code>false</code>，启用意味着安装Pigsty Pro版UI（默认不开源所以不要启用）</li><li><code>node_admin_pk_current</code>，新增选项，启用后会将当前用户的<code>~/.ssh/id_rsa.pub</code>添加至管理员的Key中</li><li><code>loki_clean</code>：新增选项，安装Loki时是否清除现有数据</li><li><code>loki_data_dir</code>：新增选项，指明安装Loki时的数据目录</li><li><code>promtail_enabled</code> 是否启用Promtail日志收集服务？</li><li><code>promtail_clean</code> 是否在安装promtail时移除已有状态信息？</li><li><code>promtail_port</code> promtail使用的默认端口，默认为9080</li><li><code>promtail_status_file</code> 保存Promtail状态信息的文件位置</li><li><code>promtail_send_url</code> 用于接收日志的loki服务endpoint</li></ul></details><hr><h2 id=v080>v0.8.0</h2><p>v0.8 针对 <strong>服务（Service）</strong> 接入部分进行了彻底的重做。现在除了默认的<code>primary</code>, <code>replica</code>服务外，用户可以自行定义新的服务。服务的接口可以支持多种不同的实现，例如L4 DPKG VIP可作为Haproxy的替代品与Pigsty集成。同时，针对用户反馈的一些问题进行了集中处理与改进。</p><details><br><p><strong>改动内容</strong></p><p>v0.8是供给方案定稿版本，此后供给系统的API将保持稳定。</p><p><strong>API变更</strong></p><p>原有<code>vip</code>与<code>haproxy</code>角色的所有配置项，现在迁移至<code>service</code>角色中。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#------------------------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># SERVICE PROVISION</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#------------------------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># default load balance weight (instance level)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - service - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                                  </span><span style=color:#8f5902;font-style:italic># how to expose postgres service in cluster?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># primary service will route {ip|name}:5433 to primary pgbouncer (5433-&gt;6432 rw)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># service name {{ pg_cluster }}_primary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5433</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dst_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbouncer    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 5433 route to pgbouncer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/primary    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># primary health check, success when instance is primary</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># select all instance as primary service candidate</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># replica service will route {ip|name}:5434 to replica pgbouncer (5434-&gt;6432 ro)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># service name {{ pg_cluster }}_replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5434</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dst_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbouncer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/read-only  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># read-only health check. (including primary)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># select all instance as replica service candidate</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector_backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary`]&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># primary are used as backup server in replica service</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># default service will route {ip|name}:5436 to primary postgres (5436-&gt;5432 primary)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># service&#39;s actual name is {{ pg_cluster }}-{{ service.name }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># service bind ip address, * for all, vip for cluster virtual ip address</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5436</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># bind port, mandatory</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dst_port: postgres      # target port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres|pgbouncer|port_number , pgbouncer(6432) by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_method: http      # health check method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>only http is available for now</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_port: patroni     # health check port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#000>patroni|pg_exporter|port_number , patroni by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/primary    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># health check url path, / as default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_code</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># health check http code, 200 as default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># instance selector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># haproxy specific fields</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>maxconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3000</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># default front-end connection</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>roundrobin  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># load balance algorithm (roundrobin by default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>default_server_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;inter 3s fastinter 1s downinter 5s rise 3 fall 3 on-marked-down shutdown-sessions slowstart 30s maxconn 3000 maxqueue 128 weight 100&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># offline service will route {ip|name}:5438 to offline postgres (5438-&gt;5432 offline)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>offline          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># service name {{ pg_cluster }}_replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5438</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dst_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/replica    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># offline MUST be a replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `offline` || pg_offline_query ]&#34;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># instances with pg_role == &#39;offline&#39; or instance marked with &#39;pg_offline_query == true&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector_backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `replica` &amp;&amp; !pg_offline_query]&#34;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># replica are used as backup server in offline service</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_services_extra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># extra services to be added</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - haproxy - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># enable haproxy among every cluster members</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_reload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># reload haproxy after config</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>roundrobin                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># roundrobin, leastconn</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_admin_auth_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># enable authentication for haproxy admin?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default haproxy admin username</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default haproxy admin password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9101</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># default admin/exporter port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_client_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>3h                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># client side connection timeout</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_server_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>3h                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># server side connection timeout</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - vip - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vip_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>none                               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># none | l2 | l4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vip_reload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                              </span><span style=color:#8f5902;font-style:italic># whether reload service after config</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># vip_address: 127.0.0.1                      # virtual ip address ip (l2 or l4)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># vip_cidrmask: 24                            # virtual ip address cidr mask (l2 only)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># vip_interface: eth0                         # virtual ip network interface (l2 only)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>新增选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - localization - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default to UTF8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default to C</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_lc_collate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default to C</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_lc_ctype</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en_US.UTF8                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default to en_US.UTF8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_reload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                               </span><span style=color:#8f5902;font-style:italic># reload postgres after hba changes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vip_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>none                               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># none | l2 | l4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vip_reload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                              </span><span style=color:#8f5902;font-style:italic># whether reload service after config</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>移除选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>haproxy_check_port                            <span style=color:#8f5902;font-style:italic># Haproxy相关参数已经被Service定义覆盖</span>
</span></span><span style=display:flex><span>haproxy_primary_port
</span></span><span style=display:flex><span>haproxy_replica_port
</span></span><span style=display:flex><span>haproxy_backend_port
</span></span><span style=display:flex><span>haproxy_weight
</span></span><span style=display:flex><span>haproxy_weight_fallback
</span></span><span style=display:flex><span>vip_enabled                                   <span style=color:#8f5902;font-style:italic># vip_enabled参数被vip_mode覆盖</span>
</span></span></code></pre></div><p><strong>服务管理</strong></p><p><code>pg_services</code> 与 <code>pg_services_extra</code> 定义了集群中的<strong>服务</strong>，每一个服务的定义结构如下例所示：</p><p>一个服务必须指定以下内容：</p><ul><li><p><strong>名称</strong>：服务的完整名称以数据库集群名为前缀，以<code>service.name</code>为后缀，通过<code>-</code>连接。例如在<code>pg-test</code>集群中<code>name=primary</code>的服务，其完整服务名称为<code>pg-test-primary</code>。</p></li><li><p><strong>端口</strong>：在Pigsty中，服务默认采用NodePort的形式对外暴露，因此暴露端口为必选项。但如果使用外部负载均衡服务接入方案，您也可以通过其他的方式区分服务。</p></li><li><p><strong>选择器</strong>：选择器指定了服务的成员，采用JMESPath的形式，从所有集群实例成员中筛选变量。默认的<code>[]</code>选择器会选取所有的集群成员。</p><p>此外<code>selector_backup</code>会选择或标记用于backup的实例列表（当集群中所有其他成员失效时方才接管服务）</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># default service will route {ip|name}:5436 to primary postgres (5436-&gt;5432 primary)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># service&#39;s actual name is {{ pg_cluster }}-{{ service.name }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># service bind ip address, * for all, vip for cluster virtual ip address</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>src_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5436</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># bind port, mandatory</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dst_port: postgres      # target port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres|pgbouncer|port_number , pgbouncer(6432) by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_method: http      # health check method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>only http is available for now</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_port: patroni     # health check port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#000>patroni|pg_exporter|port_number , patroni by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/primary    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># health check url path, / as default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>check_code</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># health check http code, 200 as default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># instance selector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># haproxy specific fields</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>maxconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3000</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># default front-end connection</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>roundrobin  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># load balance algorithm (roundrobin by default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>default_server_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;inter 3s fastinter 1s downinter 5s rise 3 fall 3 on-marked-down shutdown-sessions slowstart 30s maxconn 3000 maxqueue 128 weight 100&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>数据库管理</strong></p><p>数据库现在可以对locale的细分选项：<code>lc_ctype</code>与<code>lc_collate</code>分别进行指定。支持这一功能的主要原因是PG的扩展插件<code>pg_trgm</code>需要在<code>lc_ctype!=C</code>的环境中才能正常支持中文。</p><p><strong>旧接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># name is the only required field for a database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, database owner</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template1            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, template1 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, UTF8 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, C by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, true by default, false disable connect at all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># optional, false by default, true revoke connect from public # (only default user and owner have connect privilege on database)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>tablespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, &#39;pg_default&#39; is the default tablespace</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># optional, connection limit, -1 or none disable limit (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extension name and where to create</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extra parameters with ALTER DATABASE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>enable_partitionwise_join</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, add this database to pgbouncer list? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty meta database  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, comment string for database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>新的接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># name is the only required field for a database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># owner: postgres                 # optional, database owner</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># template: template1             # optional, template1 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># encoding: UTF8                # optional, UTF8 by default , must same as template database, leave blank to set to db default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># locale: C                     # optional, C by default , must same as template database, leave blank to set to db default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># lc_collate: C                 # optional, C by default , must same as template database, leave blank to set to db default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># lc_ctype: C                   # optional, C by default , must same as template database, leave blank to set to db default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, true by default, false disable connect at all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># optional, false by default, true revoke connect from public # (only default user and owner have connect privilege on database)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># tablespace: pg_default          # optional, &#39;pg_default&#39; is the default tablespace</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># optional, connection limit, -1 or none disable limit (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extension name and where to create</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extra parameters with ALTER DATABASE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>enable_partitionwise_join</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, add this database to pgbouncer list? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty meta database  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, comment string for database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><hr><h2 id=v070>v0.7.0</h2><p>v0.7 针对<strong>接入已有数据库实例</strong>进行了改进，现在用户可以采用 <strong>仅监控部署（Monly Deployment）</strong> 模式使用Pigsty。同时新增了专用于管理数据库与用户、以及单独部署监控的剧本，并对数据库与用户的定义进行改进。</p><details><br><p><strong>Features</strong></p><ul><li><a href=https://github.com/Vonng/pigsty/issues/25>Monitor Only Deployment Support #25</a></li><li><a href=https://github.com/Vonng/pigsty/issues/36>Split monolith static monitor target file into per-cluster conf #36</a></li><li><a href=https://github.com/Vonng/pigsty/issues/29>Add create user playbook #29</a></li><li><a href=https://github.com/Vonng/pigsty/issues/28>Add create database playbook #28</a></li><li><a href=https://github.com/Vonng/pigsty/issues/33>Database provisioning interface enhancement #33</a></li><li><a href=https://github.com/Vonng/pigsty/issues/34>User provisioning interface enhancement #34</a></li></ul><p><strong>Bug Fix</strong></p><ul><li><a href=https://github.com/Vonng/pigsty/issues/32>Create extension with schema typo #32</a></li><li><a href=https://github.com/Vonng/pigsty/issues/35>pgbouncer reload with systemctl not work #35</a></li></ul><p><strong>API变更</strong></p><p><strong>新增选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#204a87;font-weight:700>prometheus_sd_target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>batch                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># batch|single    监控目标定义文件采用单体还是每个实例一个</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>exporter_install</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>none                       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># none|yum|binary 监控Exporter的安装模式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>exporter_repo_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># 如果设置，这里的REPO连接会加入目标的Yum源中</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_exporter_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;--no-collector.softnet --collector.systemd --collector.ntp --collector.tcpstat --collector.processes&#39;</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># Node Exporter默认的命令行选项</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># 可选，PG Exporter监控对象的URL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 可选，PGBOUNCER EXPORTER监控对象的URL</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>移除选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#204a87;font-weight:700>exporter_binary_install</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 功能被 exporter_install 覆盖</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>定义结构变更</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>pg_default_roles                              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 变化细节参考 用户管理。</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>pg_users                                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 变化细节参考 用户管理。</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>pg_databases                                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 变化细节参考 数据库管理。</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>重命名选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#000>pg_default_privilegs -&gt; pg_default_privileges</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 很明显这是一个错别字</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>仅监控模式</strong></p><p>有时用户不希望使用Pigsty供给方案，只希望使用Pigsty监控系统管理现有PostgreSQL实例。</p><p>Pigsty提供了仅监控部署（monly, monitor-only模式，剥离供给方案部分，可用于监控现有PostgreSQL集群。</p><p>仅监控模式的部署流程与标准模式大体上保持一致，但省略了很多步骤</p><ul><li>在<strong>元节点</strong>上完成基础设施初始化的部分与标准流程保持一致，仍然通过<code>./infra.yml</code>完成。</li><li>不需要在<strong>数据库节点</strong>上完成 <strong>基础设施初始化</strong>。</li><li>不需要在<strong>数据库节点</strong>上执行数据库初始化的绝大多数任务，而是通过专用的<code>./pgsql-monitor.yml</code> 完成仅监控系统部署。</li><li>实际使用的配置项大大减少，只保留基础设施相关变量，与 监控系统相关的少量变量。</li></ul><p><strong>数据库管理</strong></p><p><a href=https://github.com/Vonng/pigsty/issues/33>Database provisioning interface enhancement #33</a></p><p><strong>旧接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># create a business database &#39;meta&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>meta]                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># create extra schema named &#39;meta&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span>{<span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis}]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># create extra extension postgis</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># overwrite database meta&#39;s default search_path</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public, monitor</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>新的接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># name is the only required field for a database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, database owner</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template1            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, template1 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, UTF8 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, C by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, true by default, false disable connect at all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># optional, false by default, true revoke connect from public # (only default user and owner have connect privilege on database)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>tablespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, &#39;pg_default&#39; is the default tablespace</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># optional, connection limit, -1 or none disable limit (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extension name and where to create</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># optional, extra parameters with ALTER DATABASE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>enable_partitionwise_join</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># optional, add this database to pgbouncer list? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty meta database  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># optional, comment string for database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>接口变更</strong></p><ul><li>Add new options: <code>template</code> , <code>encoding</code>, <code>locale</code>, <code>allowconn</code>, <code>tablespace</code>, <code>connlimit</code></li><li>Add new option <code>revokeconn</code>, which revoke connect privileges from public for this database</li><li>Add <code>comment</code> field for database</li></ul><p><strong>数据库变更</strong></p><p>在运行中集群中创建新数据库可以使用<code>pgsql-createdb.yml</code>剧本，在配置中定义完新数据库后，执行以下剧本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-createdb.yml -e <span style=color:#000>pg_database</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your_new_database_name&gt;
</span></span></code></pre></div><p>通过<code>-e pg_datbase=</code>告知需要创建的数据库名称，则该数据库即会被创建（或修改）。具体执行的命令参见集群主库<code>/pg/tmp/pg-db-{{ database.name}}.sql</code>文件。</p><p><strong>用户管理</strong></p><p><a href=https://github.com/Vonng/pigsty/issues/34>User provisioning interface enhancement #34</a></p><p><strong>旧接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># example production user have read-write access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># example user&#39;s password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># extra options</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_readwrite ]   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># dborole_admin|dbrole_readwrite|dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default test user for production usage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># add to pgbouncer</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>新接口定义</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># complete example of user/role definition for production user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_meta              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># example production user have read-write access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Meta          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># example user&#39;s password, can be encrypted</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># can login, true by default (should be false for role)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>superuser</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># is superuser? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>createdb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># can create database? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># can create role? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># can this role use inherited privileges?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>replication</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># can this role do replication? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># can this role bypass row level security? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># connection limit, -1 disable limit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>expire_at</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2030-12-31&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># &#39;timestamp&#39; when this role is expired</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>365</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># now + n days when this role is expired (OVERWRITE expire_at)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite]      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># dborole_admin|dbrole_readwrite|dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># add this user to pgbouncer? false by default (true for production user)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># user&#39;s default search path</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test user</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>接口变更</strong></p><ul><li><code>username</code> field rename to <code>name</code></li><li><code>groups</code> field rename to <code>roles</code></li><li><code>options</code> now split into separated configration entries:
<code>login</code>, <code>superuser</code>, <code>createdb</code>, <code>createrole</code>, <code>inherit</code>, <code>replication</code>,<code>bypassrls</code>,<code>connlimit</code></li><li><code>expire_at</code> and <code>expire_in</code> options</li><li><code>pgbouncer</code> option for user is now <code>false</code> by default</li></ul><p><strong>用户管理</strong></p><p>在运行中集群中创建新数据库可以使用<code>pgsql-createuser.yml</code>剧本，在配置中定义完新数据库后，执行以下剧本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-createuser.yml -e <span style=color:#000>pg_user</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your_new_user_name&gt;
</span></span></code></pre></div><p>通过<code>-e pg_user=</code>告知需要创建的数据库名称，则该数据库即会被创建（或修改）。具体执行的命令参见集群主库<code>/pg/tmp/pg-user-{{ user.name}}.sql</code>文件。</p></details><hr><h2 id=v060>v0.6.0</h2><p>v0.6 对数据库供给方案进行了修改与调整，根据用户的反馈添加了一系列实用功能与修正。针对监控系统的移植性进行优化，便于与其他外部数据库供给方案对接。</p><details><br><p><strong>BUG修复</strong></p><ul><li>修复了新版本Patroni重启后会重置PG HBA的问题</li><li>修复了PG Overview Dashboard标题中的别字</li><li>修复了沙箱集群<code>pg-test</code>的默认主库，原来为<code>pg-test-2</code>，应当为<code>pg-test-1</code></li><li>修复了过时代码注释</li></ul><p><strong>功能改进</strong></p><ul><li>改造Prometheus与监控供给方式<ul><li>允许在无基础设施的情况下对已有PG集群进行监控部署，便于监控系统与其他供给方案集成。<a href=https://github.com/Vonng/pigsty/issues/11>#11</a></li><li>基于Inventory渲染所有监控对象的静态列表，用于静态服务发现。<a href=https://github.com/Vonng/pigsty/issues/11>#11</a></li><li>Prometheus添加了静态对象模式，用于替代动态服务发现，集中进行身份管理 <a href=https://github.com/Vonng/pigsty/issues/11>#11</a></li><li>监控Exporter现在添加了<code>service_registry</code>选项，Consul服务注册变为可选项 <a href=https://github.com/Vonng/pigsty/issues/13>#13</a></li><li>Exporter现在可以通过拷贝二进制的方式直接安装：<code>exporter_binary_install</code>，<a href=https://github.com/Vonng/pigsty/issues>#14</a></li><li>Exporter现在具有<code>xxx_enabled</code>选项，控制是否启用该组件。</li></ul></li><li>Haproxy供给重构与改进 <a href=https://github.com/Vonng/pigsty/issues/8>#8</a><ul><li>新增了全局HAProxy管理界面导航，默认域名<code>h.pigsty</code></li><li>允许将主库加入只读服务集中，当集群中所有从库宕机时自动承接读流量。 <a href=https://github.com/Vonng/pigsty/issues/8>#8</a></li><li>允许位Haproxy实例管理界面启用认证 <code>haproxy_admin_auth_enabled</code></li><li>允许通过配置项调整每个服务对应后端的流量权重. <a href=https://github.com/Vonng/pigsty/issues/10>#10</a></li></ul></li><li>访问控制模型改进。<a href=https://github.com/Vonng/pigsty/issues/7>#7</a><ul><li>添加了默认角色<code>dbrole_offline</code>，用于慢查询，ETL，交互式查询场景。</li><li>修改默认HBA规则，允许<code>dbrole_offline</code>分组的用户访问<code>pg_role == 'offline'</code>及<code>pg_offline_query == true</code>的实例。</li></ul></li><li>软件更新 Release v0.6<ul><li>PostgreSQL 13.2</li><li>Prometheus 2.25</li><li>PG Exporter 0.3.2</li><li>Node Exporter 1.1</li><li>Consul 1.9.3</li><li>更新默认PG源：PostgreSQL现在默认使用浙江大学的镜像，加速下载安装</li></ul></li></ul><p><strong>接口变更</strong></p><p><strong>新增选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>service_registry</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consul                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 服务注册机制：none | consul | etcd | both</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>prometheus_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;--storage.tsdb.retention=30d&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># prometheus命令行选项</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>prometheus_sd_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consul                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Prometheus使用的服务发现机制：static|consul</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>prometheus_sd_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>2s                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Prometheus服务发现刷新间隔</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_offline_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># 设置后将允许dbrole_offline角色连接与查询该实例</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 设置后将安装配置Node Exporter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 设置后将安装配置PG Exporter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 设置后将安装配置Pgbouncer Exporter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>dcs_disable_purge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 双保险，强制 dcs_exists_action = abort 避免误删除DCS实例</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_disable_purge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># 双保险，强制 pg_exists_action = abort 避免误删除数据库实例</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># 配置实例的相对负载均衡权重</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_weight_fallback</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 配置集群主库在只读服务中的相对权重</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>移除选项</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>prometheus_metrics_path                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 与 exporter_metrics_path 重复</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>prometheus_retention                         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 功能被 prometheus_options 覆盖</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><hr><h2 id=v050>v0.5.0</h2><p>Pigsty 现在有了官方网站啦：<a href=https://pigsty.cc/>pigsty.cc</a> 🎉 !</p><details><br><p><strong>亮点特性</strong></p><ul><li>Pigsty官方 <a href=http://pigsty.cc/>文档站</a> 正式上线！</li><li>添加了数据库模板的定制支持，用户可以通过配置文件定制所需的数据库内部对象。</li><li>对默认 <a href=/docs/concept/sec/ac/>访问控制</a> 模型进行了改进</li><li>重构了HBA管理的逻辑，现在将由Pigsty替代Patroni直接负责生成HBA</li><li>将Grafana监控系统的供给方案从sqlite改为JSON文件静态Provision</li><li>将<code>pg-cluster-replication</code>面板加入Pigsty开源免费套餐。</li><li>最新的经过测试的离线安装包：<a href=https://github.com/Vonng/pigsty/releases/download/v0.5.0/pkg.tgz>pkg.tgz</a> (v0.5)</li></ul><p><strong>定制数据库</strong></p><p>您是否烦恼过单实例多租户的问题？比如总有研发拿着PostgreSQL当MySQL使，明明是一个Schema就能解决的问题，非要创建一个新的数据库出来，在一个实例中创建出几十个不同的DB。
不要忧伤，不要心急。Pigsty已经提供数据库内部对象的Provision方案，您可以轻松地在配置文件中指定所需的数据库内对象，包括：</p><ul><li>角色<ul><li>用户/角色名</li><li>密码</li><li>用户属性</li><li>用户备注</li><li>用户所属的权限组</li></ul></li><li>数据库<ul><li>属主</li><li>额外的模式</li><li>额外的扩展插件</li><li>数据库级的自定义配置参数</li></ul></li><li>数据库<ul><li>属主</li><li>额外的模式</li><li>额外的扩展插件</li><li>数据库级的自定义配置参数</li></ul></li><li>默认权限<ul><li>默认情况下这里配置的权限会应用至所有由 超级用户 和 管理员用户创建的对象上。</li></ul></li><li>默认扩展<ul><li>所有新创建的业务数据库都会安装有这些默认扩展</li></ul></li><li>默认模式<ul><li>所有新创建的业务数据库都会创建有这些默认的模式</li></ul></li></ul><p>配置样例</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 通常是每个DB集群配置的变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default test user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_readwrite ]   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># dborole_admin|dbrole_readwrite|dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># create a business database &#39;test&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span>{<span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis}]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># create extra extension postgis</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># overwrite database meta&#39;s default search_path</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public,monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 通常是整个环境统一配置的全局变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - system roles - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replicator          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system replication user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system replication password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_monitor          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system monitor user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system monitor password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system admin user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Admin              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># system admin password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - default roles - #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>dbrole_readonly                 # sample user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>NOLOGIN                         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># role can not login</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for readonly access        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># comment string</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username: dbrole_readwrite                # sample user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>one object for each user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>NOLOGIN</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for read-write access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_readonly ]              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># read-write includes read-only access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username: dbrole_admin                    # sample user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>one object for each user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>NOLOGIN BYPASSRLS               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># admin can bypass row level security</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readwrite,pg_monitor,pg_signal_backend]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># NOTE: replicator, monitor, admin password are overwritten by separated config entry</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># reset dbsu password to NULL (if dbsu is not postgres)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>SUPERUSER LOGIN</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>REPLICATION LOGIN</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pg_monitor, dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN CONNECTION LIMIT 10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system monitor user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pg_monitor, dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN BYPASSRLS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system admin user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_stats</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Stats</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>LOGIN</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>business read-only user for statistics</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_readonly]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># object created by dbsu and admin will have their privileges properly set</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_privilegs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE                         ON SCHEMAS   TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT                        ON TABLES    TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT                        ON SEQUENCES TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE                       ON FUNCTIONS TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT INSERT, UPDATE, DELETE        ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE,  UPDATE                ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRUNCATE, REFERENCES, TRIGGER ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT CREATE                        ON SCHEMAS   TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE                         ON TYPES     TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># schemas</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>monitor]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># extension</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_stat_statements&#39;,  schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pgstattuple&#39;,         schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_qualstats&#39;,        schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_buffercache&#39;,      schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pageinspect&#39;,         schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_prewarm&#39;,          schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_visibility&#39;,       schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_freespacemap&#39;,     schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: &#39;pg_repack&#39;,           schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres_fdw</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>file_fdw</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>btree_gist</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>btree_gin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_trgm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>intagg</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>intarray</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres host-based authentication rules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow meta node password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     all                         10.10.10.10/32      md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow intranet admin password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     +dbrole_admin               10.0.0.0/8          md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     +dbrole_admin               172.16.0.0/12       md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     +dbrole_admin               192.168.0.0/16      md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow intranet password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all             all                 10.0.0.0/8          md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all             all                 172.16.0.0/12       md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all             all                 192.168.0.0/16      md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow local read-write access (local production user via pgbouncer)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>local   all     +dbrole_readwrite                               md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     +dbrole_readwrite           127.0.0.1/32        md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow read-only user (stats, personal) password directly access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>local   all     +dbrole_readonly                               md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host    all     +dbrole_readonly           127.0.0.1/32        md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules_extra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pgbouncer host-based authentication rules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>local  all          all                                     md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host   all          all                     127.0.0.1/32    md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>intranet password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host   all          all                     10.0.0.0/8      md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host   all          all                     172.16.0.0/12   md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>host   all          all                     192.168.0.0/16  md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_hba_rules_extra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>数据库模板</strong></p><ul><li><a href=https://github.com/Vonng/pigsty/blob/main/roles/postgres/templates/pg-init-template.sql>pg-init-template.sql</a> 用于初始化<code>template1</code>数据的脚本模板</li><li><a href=https://github.com/Vonng/pigsty/blob/main/roles/postgres/templates/pg-init-business.sql>pg-init-business.sql</a> 用于初始化其他业务数据库的脚本模板</li></ul><p><strong>权限模型</strong></p><p>v0.5 改善了默认的权限模型，主要是针对单实例多租户的场景进行优化，并收紧权限控制。</p><ul><li>撤回了普通业务用户对非所属数据库的默认<code>CONNECT</code>权限</li><li>撤回了非管理员用户对所属数据库的默认<code>CREATE</code>权限</li><li>撤回了所有用户在<code>public</code>模式下的默认创建权限。</li></ul><p><strong>供给方式</strong></p><p>原先Pigsty采用直接拷贝Grafana自带的grafana.db的方式完成监控系统的初始化。
这种方式虽然简单粗暴管用，但不适合进行精细化的版本控制管理。在v0.5中，Pigsty采用了Grafana API完成了监控系统面板供给的工作。
您所需的就是在<code>grafana_url</code>中填入带有用户名密码的Grafana URL。
因此，监控系统可以背方便地添加至已有的Grafana中。</p></details><hr><h2 id=v040>v0.4.0</h2><p>第二个公开测试版v0.4现已正式发行！</p><details><br><p><strong>监控系统</strong></p><p>Pigsty v0.4对监控系统进行了整体升级改造，精心挑选了10个面板作为标准的Pigsty开源内容。同时，针对Grafana 7.3的不兼容升级进行了大量适配改造工作。使用升级的<code>pg_exporter v0.3.1</code>作为默认指标导出器，调整了监控报警规则的监控面板连接。</p><p><strong>Pigsty开源版</strong></p><p>Pigsty开源版选定了以下10个Dashboard作为开源内容。其他Dashboard作为可选的商业支持内容提供。</p><ul><li>PG Overview</li><li>PG Cluster</li><li>PG Service</li><li>PG Instance</li><li>PG Database</li><li>PG Query</li><li>PG Table</li><li>PG Table Catalog</li><li>PG Table Detail</li><li>Node</li></ul><p>尽管进行了少量阉割，这10个监控面板所涵盖的内容仍然可以吊打所有同类软件。</p><p><strong>软件升级</strong></p><p>Pigsty v0.4进行了大量软件适配工作，包括：</p><ul><li>Upgrade to PostgreSQL 13.1, Patroni 2.0.1-4, add citus to repo.</li><li>Upgrade to <a href=https://github.com/Vonng/pg_exporter/releases/tag/v0.3.1><code>pg_exporter 0.3.1</code></a></li><li>Upgrade to Grafana 7.3, Ton&rsquo;s of compatibility work</li><li>Upgrade to prometheus 2.23, with new UI as default</li><li>Upgrade to consul 1.9</li></ul><p><strong>其他改进</strong></p><ul><li>Update prometheus alert rules</li><li>Fix alertmanager info links</li><li>Fix bugs and typos.</li><li>add a simple backup script</li></ul><p><strong>离线安装包</strong></p><ul><li>v0.4的离线安装包（CentOS 7.8）已经可以从Github下载：<a href=https://github.com/Vonng/pigsty/releases/download/v0.4.0/pkg.tgz>pkg.tgz</a></li></ul></details><hr><h2 id=v030>v0.3.0</h2><p>首个Pigsty公开测试版本现在已经释出！</p><details><br><p><strong>监控系统</strong></p><p>Pigsty v0.3 包含以下8个监控面板作为开源内容：</p><ul><li>PG Overview</li><li>PG Cluster</li><li>PG Service</li><li>PG Instance</li><li>PG Database</li><li>PG Table Overview</li><li>PG Table Catalog</li><li>Node</li></ul><p><strong>离线安装包</strong></p><ul><li>v0.3 离线安装包（CentOS 7.8）已经可以从Github下载：<a href=https://github.com/Vonng/pigsty/releases/download/v0.3.0/pkg.tgz>pkg.tgz</a></li></ul></details></div><div class=td-content style=page-break-before:always><h1 id=pg-2abe214ea9ba5412d760ce23167f55bf>13 - 同类对比</h1><div class=lead>本文列出了与 Pigsty 生态位有重叠的产品与项目，并比较其在特性上的差异。</div><hr><h2 id=与-rds-对比>与 RDS 对比</h2><p><a href=https://pigsty.io>Pigsty</a> 是使用 Apache-2.0 开源的本地优先 RDS 替代，可以部署在您自己的物理机/虚拟机上，也可以部署在云服务器上。</p><p>因此，我们选择了全球份额第一的亚马逊云 <a href=https://aws.amazon.com/cn/rds/postgresql/>AWS RDS for PostgreSQL</a>，以及中国市场份额第一的阿里云 <a href=https://www.alibabacloud.com/zh/product/apsaradb-for-rds-postgresql>RDS for PostgreSQL</a> 作为参照对象。</p><p>阿里云 RDS 与 AWS RDS 均为闭源云数据库服务，通过租赁模式，仅在公有云上对外提供，以下对比基于最新的 PostgreSQL 16 主干版本进行，对比截止日期为 2024 年 2 月份。</p><hr><h3 id=功能特性>功能特性</h3><table class=full-width><thead><tr><th><strong>指标</strong></th><th><strong>Pigsty</strong></th><th><strong>Aliyun RDS</strong></th><th><strong>AWS RDS</strong></th></tr></thead><tbody><tr><td>大版本支持</td><td>13 - 18</td><td>13 - 18</td><td>13 - 18</td></tr><tr><td>只读从库</td><td><i class="fas fa-circle-check text-success"></i> 支持任意数量只读从库</td><td><i class="fas fa-circle-xmark text-danger"></i> 备实例不对用户开放</td><td><i class="fas fa-circle-xmark text-danger"></i> 备实例不对用户开放</td></tr><tr><td>读写分离</td><td><i class="fas fa-circle-check text-success"></i> 支持端口区分读写流量</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 独立收费组件</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 独立收费组件</td></tr><tr><td>快慢分离</td><td><i class="fas fa-circle-check text-success"></i> 支持离线 ETL 实例</td><td><i class="fas fa-circle-xmark text-danger"></i> 未见相关特性</td><td><i class="fas fa-circle-xmark text-danger"></i> 未见相关特性</td></tr><tr><td>异地灾备</td><td><i class="fas fa-circle-check text-success"></i> 支持备份集群</td><td><i class="fas fa-circle-check text-success"></i> 支持多可用区部署</td><td><i class="fas fa-circle-check text-success"></i> 支持多可用区部署</td></tr><tr><td>延迟从库</td><td><i class="fas fa-circle-check text-success"></i> 支持延迟实例</td><td><i class="fas fa-circle-xmark text-danger"></i> 未见相关特性</td><td><i class="fas fa-circle-xmark text-danger"></i> 未见相关特性</td></tr><tr><td>负载均衡</td><td><i class="fas fa-circle-check text-success"></i> HAProxy / LVS</td><td><i class="fas fa-circle-check text-success"></i> 独立收费组件</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 独立收费组件</td></tr><tr><td>连接池</td><td><i class="fas fa-circle-check text-success"></i> Pgbouncer</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 独立收费组件：RDS</td><td><i class="fa-solid fa-triangle-exclamation text-secondary"></i> 独立收费组件：RDS Proxy</td></tr><tr><td>高可用</td><td><i class="fas fa-circle-check text-success"></i> Patroni / etcd</td><td><i class="fas fa-circle-check text-success"></i> 需高可用版提供支持</td><td><i class="fas fa-circle-check text-success"></i> 需高可用版提供支持</td></tr><tr><td>时间点恢复</td><td><i class="fas fa-circle-check text-success"></i> pgBackRest / MinIO</td><td><i class="fas fa-circle-check text-success"></i> 提供备份支持</td><td><i class="fas fa-circle-check text-success"></i> 提供备份支持</td></tr><tr><td>指标监控</td><td><i class="fas fa-circle-check text-success"></i> VictoriaMetrics / Exporter</td><td><i class="fas fa-circle-check text-secondary"></i> 免费基础版/收费进阶版</td><td><i class="fas fa-circle-check text-secondary"></i> 免费基础版/收费进阶版</td></tr><tr><td>日志采集</td><td><i class="fas fa-circle-check text-success"></i> VictoriaLogs / Vector</td><td><i class="fas fa-circle-check text-success"></i> 基础支持</td><td><i class="fas fa-circle-check text-success"></i> 基础支持</td></tr><tr><td>可视化系统</td><td><i class="fas fa-circle-check text-success"></i> Grafana / Echarts</td><td><i class="fas fa-circle-check text-secondary"></i> 提供基本监控</td><td><i class="fas fa-circle-check text-secondary"></i> 提供基本监控</td></tr><tr><td>告警聚合通知</td><td><i class="fas fa-circle-check text-success"></i> AlterManager</td><td><i class="fas fa-circle-check text-success"></i> 基础支持</td><td><i class="fas fa-circle-check text-success"></i> 基础支持</td></tr></tbody></table><hr><h3 id=重要扩展>重要扩展</h3><p>这里列出了一些重要扩展，对比基于最新的 PostgreSQL 16 主干版本进行，截止至 2024-02-28</p><ul><li><a href=https://pgext.cloud/zh/list/><strong>Pigsty 扩展列表</strong></a></li><li><a href=https://docs.aws.amazon.com/AmazonRDS/latest/PostgreSQLReleaseNotes/postgresql-extensions.html><strong>AWS RDS 扩展列表</strong></a>:</li><li><a href=https://help.aliyun.com/zh/rds/apsaradb-rds-for-postgresql/extensions-supported-by-apsaradb-rds-for-postgresql><strong>阿里云 RDS 扩展列表</strong></a></li></ul><table class=full-width><thead><tr><th><strong>扩展名称</strong></th><th><strong>Pigsty RDS</strong> / PGDG 官方仓库</th><th style=text-align:center><strong>阿里云 RDS</strong></th><th style=text-align:center><strong>AWS RDS</strong></th></tr></thead><tbody><tr><td>加装扩展</td><td><i class="fas fa-circle-check text-success"></i> 自由加装</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i> 不允许</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i> 不允许</td></tr><tr><td>地理空间</td><td><i class="fas fa-circle-check text-success"></i> PostGIS 3.4.2</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> PostGIS 3.3.4 / Ganos 6.1</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> PostGIS 3.4.1</td></tr><tr><td>雷达点云</td><td><i class="fas fa-circle-check text-success"></i> PG PointCloud 1.2.5</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> Ganos PointCloud 6.1</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>向量嵌入</td><td><i class="fas fa-circle-check text-success"></i> PGVector 0.6.1 / Svector 0.5.6</td><td style=text-align:center><i class="fas fa-triangle-exclamation text-secondary"></i> pase 0.0.1</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> PGVector 0.6</td></tr><tr><td>机器学习</td><td><i class="fas fa-circle-check text-success"></i> PostgresML 2.8.1</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>时序扩展</td><td><i class="fas fa-circle-check text-success"></i> TimescaleDB 2.14.2</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>水平分布式</td><td><i class="fas fa-circle-check text-success"></i> Citus 12.1</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>列存扩展</td><td><i class="fas fa-circle-check text-success"></i> Hydra 1.1.1</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>全文检索</td><td><i class="fas fa-circle-check text-success"></i> pg_bm25 0.5.6<br></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>图数据库</td><td><i class="fas fa-circle-check text-success"></i> Apache AGE 1.5.0</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>GraphQL</td><td><i class="fas fa-circle-check text-success"></i> PG GraphQL 1.5.0</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>OLAP</td><td><i class="fas fa-circle-check text-success"></i> pg_analytics 0.5.6</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>消息队列</td><td><i class="fas fa-circle-check text-success"></i> pgq 3.5.0</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>DuckDB</td><td><i class="fas fa-circle-check text-success"></i> duckdb_fdw 1.1</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td></tr><tr><td>模糊分词</td><td><i class="fas fa-circle-check text-success"></i> zhparser 1.1 / pg_bigm 1.2</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> zhparser 1.0 / pg_jieba</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> pg_bigm 1.2</td></tr><tr><td>CDC抽取</td><td><i class="fas fa-circle-check text-success"></i> wal2json 2.5.3</td><td style=text-align:center><i class="fas fa-circle-xmark text-danger"></i></td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> wal2json 2.5</td></tr><tr><td>膨胀治理</td><td><i class="fas fa-circle-check text-success"></i> pg_repack 1.5.0</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> pg_repack 1.4.8</td><td style=text-align:center><i class="fas fa-circle-check text-success"></i> pg_repack 1.5.0</td></tr></tbody></table><details><summary>AWS RDS PG 可用扩展</summary><p>AWS RDS for PostgreSQL 16 可用扩展（已刨除PG自带扩展）</p><table><thead><tr><th style=text-align:left>name</th><th style=text-align:left>pg16</th><th style=text-align:left>pg15</th><th style=text-align:left>pg14</th><th style=text-align:left>pg13</th><th style=text-align:left>pg12</th><th style=text-align:left>pg11</th><th style=text-align:left>pg10</th></tr></thead><tbody><tr><td style=text-align:left>amcheck</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>yes</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>auto_explain</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td><td style=text-align:left>yes</td></tr><tr><td style=text-align:left>autoinc</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>bloom</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>bool_plperl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>btree_gin</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>btree_gist</td><td style=text-align:left>1.7</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td></tr><tr><td style=text-align:left>citext</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td></tr><tr><td style=text-align:left>cube</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>dblink</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>dict_int</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>dict_xsyn</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>earthdistance</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>fuzzystrmatch</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>hstore</td><td style=text-align:left>1.8</td><td style=text-align:left>1.8</td><td style=text-align:left>1.8</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td></tr><tr><td style=text-align:left>hstore_plperl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>insert_username</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>intagg</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>intarray</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.3</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>isn</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>jsonb_plperl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>lo</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>ltree</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>moddatetime</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>old_snapshot</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>pageinspect</td><td style=text-align:left>1.12</td><td style=text-align:left>1.11</td><td style=text-align:left>1.9</td><td style=text-align:left>1.8</td><td style=text-align:left>1.7</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td></tr><tr><td style=text-align:left>pg_buffercache</td><td style=text-align:left>1.4</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td></tr><tr><td style=text-align:left>pg_freespacemap</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>pg_prewarm</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>pg_stat_statements</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.9</td><td style=text-align:left>1.8</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td></tr><tr><td style=text-align:left>pg_trgm</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.3</td></tr><tr><td style=text-align:left>pg_visibility</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>pg_walinspect</td><td style=text-align:left>1.1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>pgcrypto</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td></tr><tr><td style=text-align:left>pgrowlocks</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>pgstattuple</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td></tr><tr><td style=text-align:left>plperl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>plpgsql</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>pltcl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>postgres_fdw</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>refint</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>null</td><td style=text-align:left>null</td><td style=text-align:left>null</td></tr><tr><td style=text-align:left>seg</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>sslinfo</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td></tr><tr><td style=text-align:left>tablefunc</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>tcn</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>tsm_system_rows</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>tsm_system_time</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>unaccent</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr><tr><td style=text-align:left>uuid-ossp</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td></tr></tbody></table></details><details><summary>Aliyun RDS PG 可用扩展</summary><p>阿里云 RDS for PostgreSQL 16 可用扩展（已刨除PG自带扩展）</p><table><thead><tr><th style=text-align:left>name</th><th style=text-align:left>pg16</th><th style=text-align:left>pg15</th><th style=text-align:left>pg14</th><th style=text-align:left>pg13</th><th style=text-align:left>pg12</th><th style=text-align:left>pg11</th><th style=text-align:left>pg10</th><th style=text-align:left>ali_desc</th></tr></thead><tbody><tr><td style=text-align:left>bloom</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供一种基于布鲁姆过滤器的索引访问方法。</td></tr><tr><td style=text-align:left>btree_gin</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.2</td><td style=text-align:left>提供一个为多种数据类型和所有enum类型实现B树等价行为的GIN操作符类示例。</td></tr><tr><td style=text-align:left>btree_gist</td><td style=text-align:left>1.7</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>提供一个为多种数据类型和所有enum类型实现B树等价行为的GiST操作符类示例。</td></tr><tr><td style=text-align:left>citext</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>提供一种大小写不敏感的字符串类型。</td></tr><tr><td style=text-align:left>cube</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.2</td><td style=text-align:left>提供一种数据类型来表示多维立方体。</td></tr><tr><td style=text-align:left>dblink</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>跨库操作表。</td></tr><tr><td style=text-align:left>dict_int</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>附加全文搜索词典模板的示例。</td></tr><tr><td style=text-align:left>earthdistance</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>提供两种不同的方法来计算地球表面的大圆距离。</td></tr><tr><td style=text-align:left>fuzzystrmatch</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>判断字符串之间的相似性和距离。</td></tr><tr><td style=text-align:left>hstore</td><td style=text-align:left>1.8</td><td style=text-align:left>1.8</td><td style=text-align:left>1.8</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>在单一PostgreSQL值中存储键值对。</td></tr><tr><td style=text-align:left>intagg</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>提供一个整数聚集器和一个枚举器。</td></tr><tr><td style=text-align:left>intarray</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.3</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>提供一些有用的函数和操作符来操纵不含空值的整数数组。</td></tr><tr><td style=text-align:left>isn</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>按照一个硬编码的前缀列表对输入进行验证，也被用来在输出时连接号码。</td></tr><tr><td style=text-align:left>ltree</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>用于表示存储在一个层次树状结构中的数据的标签。</td></tr><tr><td style=text-align:left>pg_buffercache</td><td style=text-align:left>1.4</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>提供一种方法实时检查共享缓冲区。</td></tr><tr><td style=text-align:left>pg_freespacemap</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>检查空闲空间映射（FSM）。</td></tr><tr><td style=text-align:left>pg_prewarm</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.1</td><td style=text-align:left>提供一种方便的方法把数据载入到操作系统缓冲区或者PostgreSQL缓冲区。</td></tr><tr><td style=text-align:left>pg_stat_statements</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.9</td><td style=text-align:left>1.8</td><td style=text-align:left>1.7</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>提供一种方法追踪服务器执行的所有SQL语句的执行统计信息。</td></tr><tr><td style=text-align:left>pg_trgm</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.6</td><td style=text-align:left>1.5</td><td style=text-align:left>1.4</td><td style=text-align:left>1.4</td><td style=text-align:left>1.3</td><td style=text-align:left>提供字母数字文本相似度的函数和操作符，以及支持快速搜索相似字符串的索引操作符类。</td></tr><tr><td style=text-align:left>pgcrypto</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>1.3</td><td style=text-align:left>为PostgreSQL提供了密码函数。</td></tr><tr><td style=text-align:left>pgrowlocks</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>提供一个函数来显示一个指定表的行锁定信息。</td></tr><tr><td style=text-align:left>pgstattuple</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>1.5</td><td style=text-align:left>提供多种函数来获得元组层的统计信息。</td></tr><tr><td style=text-align:left>plperl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供perl过程语言。</td></tr><tr><td style=text-align:left>plpgsql</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供SQL过程语言。</td></tr><tr><td style=text-align:left>pltcl</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供tcl过程语言。</td></tr><tr><td style=text-align:left>postgres_fdw</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>跨库操作表。</td></tr><tr><td style=text-align:left>sslinfo</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>1.2</td><td style=text-align:left>提供当前客户端提供的 SSL 证书的有关信息。</td></tr><tr><td style=text-align:left>tablefunc</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>包括多个返回表的函数。</td></tr><tr><td style=text-align:left>tsm_system_rows</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供表采样方法SYSTEM_ROWS。</td></tr><tr><td style=text-align:left>tsm_system_time</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>1</td><td style=text-align:left>提供了表采样方法SYSTEM_TIME。</td></tr><tr><td style=text-align:left>unaccent</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>文本搜索字典，它能从词位中移除重音（附加符号）。</td></tr><tr><td style=text-align:left>uuid-ossp</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>提供函数使用几种标准算法之一产生通用唯一标识符（UUID）。</td></tr><tr><td style=text-align:left>xml2</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>1.1</td><td style=text-align:left>提供XPath查询和XSLT功能。</td></tr></tbody></table></details><hr><h3 id=性能对比>性能对比</h3><table class=full-width><thead><tr><th><strong>指标</strong></th><th><strong>Pigsty</strong></th><th><strong>Aliyun RDS</strong></th><th><strong>AWS RDS</strong></th></tr></thead><tbody><tr><td>最佳性能</td><td><a href=https://github.com/Vonng/pgtpc/tree/master/sysbench>PGTPC on NVME SSD 评测</a> sysbench oltp_rw</td><td><a href=https://help.aliyun.com/document_detail/101470.html>RDS PG 性能白皮书</a> sysbench oltp 场景 每核 QPS 4000 ~ 8000</td><td></td></tr><tr><td>存储规格：最高档容量</td><td>32TB / <a href="https://en.shannon-sys.com/product.html?name=gen_4">NVME SSD</a></td><td>32 TB / <strong>ESSD PL3</strong></td><td>64 TB / <strong>io2</strong> <a href=https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/>EBS</a> Block Express</td></tr><tr><td>存储规格：最高档IOPS</td><td>4K随机读：最大3M，随机写 2000~350K</td><td>4K随机读：最大 1M</td><td>16K随机IOPS： 256K</td></tr><tr><td>存储规格：最高档延迟</td><td>4K随机读：75µs，随机写 15µs</td><td>4K随机读：200µs</td><td>500µs / 推断为16K随机IO</td></tr><tr><td>存储规格：最高档可靠性</td><td>UBER &lt; 1e-18，折合18个9 MTBF: 200万小时 5DWPD，持续三年</td><td>可靠性 9个9， 合 UBER 1e-9 <a href=https://help.aliyun.com/document_detail/476273.html>存储与数据可靠性</a></td><td><strong>持久性</strong>：99.999%，5个9 （0.001% 年故障率） <a href=https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/>io2 说明</a></td></tr><tr><td>存储规格：最高档成本</td><td>31.5 ¥/TB·月 ( 5年质保均摊 / 3.2T / 企业级 / MLC )</td><td>3200¥/TB·月 （原价 6400¥，包月4000¥） 3年预付整体打5折才有此价格</td><td>1900 ¥/TB·月 使用最大规格 65536GB / 256K IOPS 最大优惠</td></tr></tbody></table><hr><h3 id=可观测性>可观测性</h3><p>Pigsty 提供了近 3000 类监控指标，提供了 50+ 监控面板，覆盖了数据库监控、主机监控、连接池监控、负载均衡监控等方方面面，为用户提供无与伦比的可观测性体验。</p><p><img src=/img/pigsty/dashboard.jpg alt></p><p>Pigsty 提供了 638 与 PostgreSQL 有关的监控指标，而 AWS RDS 只有 99 个，阿里云 RDS 更是只有个位数指标：</p><p><img src=/img/docs/compare/aliyun.png alt></p><p>此外，也有一些项目提供了监控 PostgreSQL 的能力，但都相对比较简单初级：</p><ul><li><a href=https://pgwatch.com/>pgwatch</a>： 123 类指标</li><li><a href=https://github.com/CrunchyData/pgmonitor>pgmonitor</a> ： 156 类指标</li><li><a href=https://docs.datadoghq.com/integrations/postgres>datadog</a> ： 69 类指标</li><li><a href=https://pgdash.io/>pgDash</a></li><li><a href=https://severalnines.com/product/clustercontrol>ClusterControl</a></li><li><a href=https://pganalyze.com/>pganalyze</a></li><li><a href=https://help.aliyun.com/document_detail/102748.html>Aliyun RDS</a> ： 8 类指标</li><li><a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Monitoring.OS.html>AWS RDS</a> ： 99 类指标</li><li><a href=https://docs.microsoft.com/en-us/azure/postgresql/>Azure RDS</a></li></ul><hr><h3 id=可维护性>可维护性</h3><table class=full-width><thead><tr><th><strong>指标</strong></th><th><strong>Pigsty</strong></th><th><strong>Aliyun RDS</strong></th><th><strong>AWS RDS</strong></th></tr></thead><tbody><tr><td>系统易用性</td><td>简单</td><td>简单</td><td>简单</td></tr><tr><td>配置管理</td><td>配置文件 / CMDB 基于 Ansible Inventory</td><td>可使用 Terraform</td><td>可使用 Terraform</td></tr><tr><td>变更方式</td><td>幂等剧本 基于 Ansible Playbook</td><td>控制台点击操作</td><td>控制台点击操作</td></tr><tr><td>参数调优</td><td>自动根据节点适配 四种预置模板 OLTP, OLAP, TINY, CRIT</td><td></td><td></td></tr><tr><td>Infra as Code</td><td>原生支持</td><td>可使用 Terraform</td><td>可使用 Terraform</td></tr><tr><td>可定制参数点</td><td><a href=/docs/conf>Pigsty Parameters</a> 283 个</td><td></td><td></td></tr><tr><td>服务与支持</td><td>提供商业订阅支持兜底</td><td>提供售后工单支持</td><td>提供售后工单支持</td></tr><tr><td>无互联网部署</td><td>可离线安装部署</td><td>N/A</td><td>N/A</td></tr><tr><td>数据库迁移</td><td>提供从现有v10+ PG实例基于逻辑复制不停机迁移至Pigsty托管实例的剧本</td><td>提供上云辅助迁移 <a href="https://help.aliyun.com/document_detail/322179.html?spm=a2c4g.11186623.0.0.5fb374c9OOi4Dm">Aliyun RDS 数据同步</a></td><td></td></tr></tbody></table><hr><h3 id=成本>成本</h3><p>经验上看，软硬件资源的部分 RDS 单位成本是自建的 5 ～ 15 倍，租售比通常在一个月。详情请参考 <a href=/docs/about/compare/cost/><strong>成本分析</strong></a>。</p><table class=full-width><thead><tr><th>要素</th><th><strong>指标</strong></th><th><strong>Pigsty</strong></th><th><strong>Aliyun RDS</strong></th><th><strong>AWS RDS</strong></th></tr></thead><tbody><tr><td>成本</td><td>软件授权/服务费用</td><td>免费，硬件约 20 - 40 ¥/核·月</td><td>200 ～ 400 ¥/核·月</td><td>400 ~ 1300 ¥/核·月</td></tr><tr><td></td><td>服务支持费用</td><td>服务约 100 ¥/ 核·月</td><td>包含在 RDS 成本中</td><td></td></tr></tbody></table><hr><h2 id=其他本地数据库管控软件>其他本地数据库管控软件</h2><p>一些提供管理 PostgreSQL 能力的软件与供应商</p><ul><li><a href=https://aiven.io/>Aiven</a>： 闭源商业云托管方案</li><li><a href=https://www.percona.com/software/postgresql-distribution>Percona</a>： 商业咨询，简易PG发行版</li><li><a href=https://docs.severalnines.com/docs/clustercontrol/>ClusterControl</a>：商业数据库管控软件</li></ul><hr><h2 id=其他-kubernetes-operator>其他 Kubernetes Operator</h2><p>Pigsty 拒绝在生产环境中使用 Kubernetes 管理数据库，因此与这些方案在生态位上存在差异。</p><ul><li>PGO</li><li>StackGres</li><li>CloudNativePG</li><li>TemboOperator</li><li>PostgresOperator</li><li>PerconaOperator</li><li>Kubegres</li><li>KubeDB</li><li>KubeBlocks</li></ul><p>更多信息请参阅：</p><ul><li>《<a href=/blog/db/db-in-k8s/>将数据库放入K8S中是一个好主意吗？</a>》</li><li>《<a href=/blog/db/pg-in-docker/>将数据库放入容器中是一个好主意吗？</a>》</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-672b46ece90a421823ac1d5ec895c9f1>13.1 - 成本对比</h1><div class=lead>本文提供了一组成本数据，供您评估 Pigsty 自建，使用云数据库 RDS 所需的成本，以及常规的 DBA 薪酬参考。</div><hr><h2 id=总体概览>总体概览</h2><table class=full-width><thead><tr><th style=text-align:center>EC2</th><th style=text-align:center>核·月</th><th style=text-align:center>RDS</th><th style=text-align:center>核·月</th></tr></thead><tbody><tr><td style=text-align:center>DHH 自建核月价格（192C 384G）</td><td style=text-align:center><strong>25.32</strong></td><td style=text-align:center>初级开源数据库DBA参考工资</td><td style=text-align:center>15K/人·月</td></tr><tr><td style=text-align:center>IDC自建机房（独占物理机: 64C384G）</td><td style=text-align:center><strong>19.53</strong></td><td style=text-align:center>中级开源数据库DBA参考工资</td><td style=text-align:center>30K/人·月</td></tr><tr><td style=text-align:center>IDC自建机房（容器，超卖500%）</td><td style=text-align:center>7</td><td style=text-align:center>高级开源数据库DBA参考工资</td><td style=text-align:center>60K/人·月</td></tr><tr><td style=text-align:center>UCloud 弹性虚拟机（8C16G，有超卖）</td><td style=text-align:center>25</td><td style=text-align:center>ORACLE 数据库授权</td><td style=text-align:center>10000</td></tr><tr><td style=text-align:center>阿里云 弹性服务器 2x内存（独占无超卖）</td><td style=text-align:center>107</td><td style=text-align:center>阿里云 RDS PG 2x内存（独占）</td><td style=text-align:center>260</td></tr><tr><td style=text-align:center>阿里云 弹性服务器 4x内存（独占无超卖）</td><td style=text-align:center>138</td><td style=text-align:center>阿里云 RDS PG 4x内存（独占）</td><td style=text-align:center>320</td></tr><tr><td style=text-align:center>阿里云 弹性服务器 8x内存（独占无超卖）</td><td style=text-align:center>180</td><td style=text-align:center>阿里云 RDS PG 8x内存（独占）</td><td style=text-align:center>410</td></tr><tr><td style=text-align:center>AWS C5D.METAL 96C 200G (按月无预付)</td><td style=text-align:center>100</td><td style=text-align:center>AWS RDS PostgreSQL db.T2 (2x)</td><td style=text-align:center>440</td></tr><tr><td style=text-align:center>AWS C5D.METAL 96C 200G (预付三年)</td><td style=text-align:center>80</td><td style=text-align:center>AWS RDS PostgreSQL db.M5 (4x)</td><td style=text-align:center>611</td></tr><tr><td style=text-align:center>AWS C7A.METAL 192C 384G (预付三年)</td><td style=text-align:center>104.8</td><td style=text-align:center>AWS RDS PostgreSQL db.R6G (8x)</td><td style=text-align:center>786</td></tr></tbody></table><hr><h2 id=rds成本参考>RDS成本参考</h2><table class=full-width><thead><tr><th>付费模式</th><th>价格</th><th>折合每年（万¥）</th></tr></thead><tbody><tr><td>IDC自建（单物理机）</td><td>¥7.5w / 5年</td><td>1.5</td></tr><tr><td>IDC自建（2～3台组HA）</td><td>¥15w / 5年</td><td>3.0 ~ 4.5</td></tr><tr><td>阿里云 RDS 按需</td><td>¥87.36/时</td><td>76.5</td></tr><tr><td>阿里云 RDS 月付（基准）</td><td>¥4.2w / 月</td><td>50</td></tr><tr><td>阿里云 RDS 年付（85折）</td><td>¥425095 / 年</td><td>42.5</td></tr><tr><td>阿里云 RDS 3年付（5折）</td><td>¥750168 / 3年</td><td>25</td></tr><tr><td>AWS 按需</td><td>$25,817 / 月</td><td>217</td></tr><tr><td>AWS 1年不预付</td><td>$22,827 / 月</td><td>191.7</td></tr><tr><td>AWS 3年全预付</td><td>12w$ + 17.5k$/月</td><td>175</td></tr><tr><td>AWS 中国/宁夏按需</td><td>¥197,489 / 月</td><td>237</td></tr><tr><td>AWS 中国/宁夏1年不预付</td><td>¥143,176 / 月</td><td>171</td></tr><tr><td>AWS 中国/宁夏3年全预付</td><td>¥647k + 116k/月</td><td>160.6</td></tr></tbody></table><p>我们可以对比一下自建与云数据库的成本差异：</p><table class=full-width><thead><tr><th>方式</th><th>折合每年（万元）</th></tr></thead><tbody><tr><td>IDC托管服务器 64C / 384G / 3.2TB NVME SSD 660K IOPS (2～3台)</td><td>3.0 ~ 4.5</td></tr><tr><td>阿里云 RDS PG 高可用版 pg.x4m.8xlarge.2c, 64C / 256GB / 3.2TB ESSD PL3</td><td>25 ～ 50</td></tr><tr><td>AWS RDS PG 高可用版 db.m5.16xlarge, 64C / 256GB / 3.2TB io1 x 80k IOPS</td><td>160 ～ 217</td></tr></tbody></table><hr><h2 id=ecs-成本参考>ECS 成本参考</h2><h3 id=排除-nvme-ssd--essd-pl3-后的纯算力价格对比>排除 NVMe SSD / ESSD PL3 后的纯算力价格对比</h3><p>以阿里云为例，纯算力包月模式的价格是自建基准的 5 ～ 7 倍，预付五年的价格是自建的 2 倍</p><table class=full-width><thead><tr><th style=text-align:center>付费模式</th><th style=text-align:center>单价（¥/核·月）</th><th style=text-align:center>相对于标准价格</th><th style=text-align:center>自建溢价倍率</th></tr></thead><tbody><tr><td style=text-align:center>按量付费（1.5倍）</td><td style=text-align:center>¥ 202</td><td style=text-align:center>160 %</td><td style=text-align:center>9.2 ~ 11.2</td></tr><tr><td style=text-align:center>包月（标准价格）</td><td style=text-align:center>¥ 126</td><td style=text-align:center>100 %</td><td style=text-align:center>5.7 ～ 7.0</td></tr><tr><td style=text-align:center>预付一年（65折）</td><td style=text-align:center>¥ 83.7</td><td style=text-align:center>66 %</td><td style=text-align:center>3.8 ～ 4.7</td></tr><tr><td style=text-align:center>预付二年（55折）</td><td style=text-align:center>¥ 70.6</td><td style=text-align:center>56 %</td><td style=text-align:center>3.2 ~ 3.9</td></tr><tr><td style=text-align:center>预付三年（44折）</td><td style=text-align:center>¥ 55.1</td><td style=text-align:center>44 %</td><td style=text-align:center>2.5 ~ 3.1</td></tr><tr><td style=text-align:center>预付四年（35折）</td><td style=text-align:center>¥ 45</td><td style=text-align:center>35 %</td><td style=text-align:center>2.0 ~ 2.5</td></tr><tr><td style=text-align:center>预付五年（30折）</td><td style=text-align:center>¥ 38.5</td><td style=text-align:center>30 %</td><td style=text-align:center>1.8 ~ 2.1</td></tr><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>DHH @ 2023</td><td style=text-align:center>¥ 22.0</td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>探探 IDC 自建</td><td style=text-align:center>¥ 18.0</td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><h3 id=含-nvme-ssd--essd-pl3-情况下的等效价格对比>含 NVMe SSD / ESSD PL3 情况下的等效价格对比</h3><p>包含常用规格后的 NVMe SSD 规格之后，纯算力包月模式的价格是自建基准的 11 ～ 14 倍，预付五年的价格是自建的 9 倍左右。</p><table class=full-width><thead><tr><th style=text-align:center>付费模式</th><th style=text-align:center>单价（¥/核·月）</th><th style=text-align:center>+ 40GB ESSD PL3</th><th style=text-align:center>自建溢价比例</th></tr></thead><tbody><tr><td style=text-align:center>按量付费（1.5倍）</td><td style=text-align:center>¥ 202</td><td style=text-align:center>¥ 362</td><td style=text-align:center>14.3 ～ 18.6</td></tr><tr><td style=text-align:center>包月（标准价格）</td><td style=text-align:center>¥ 126</td><td style=text-align:center>¥ 286</td><td style=text-align:center>11.3 ～ 14.7</td></tr><tr><td style=text-align:center>预付一年（65折）</td><td style=text-align:center>¥ 83.7</td><td style=text-align:center>¥ 244</td><td style=text-align:center>9.6 ～ 12.5</td></tr><tr><td style=text-align:center>预付二年（55折）</td><td style=text-align:center>¥ 70.6</td><td style=text-align:center>¥ 230</td><td style=text-align:center>9.1 ～ 11.8</td></tr><tr><td style=text-align:center>预付三年（44折）</td><td style=text-align:center>¥ 55.1</td><td style=text-align:center>¥ 215</td><td style=text-align:center>8.5 ～ 11.0</td></tr><tr><td style=text-align:center>预付四年（35折）</td><td style=text-align:center>¥ 45</td><td style=text-align:center>¥ 205</td><td style=text-align:center>8.1 ～ 10.5</td></tr><tr><td style=text-align:center>预付五年（30折）</td><td style=text-align:center>¥ 38.5</td><td style=text-align:center>¥ 199</td><td style=text-align:center>7.9 ～ 10.2</td></tr><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>DHH @ 2023</td><td style=text-align:center>¥ 25.3</td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>探探 IDC 自建</td><td style=text-align:center>¥ 19.5</td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><blockquote><p>DHH案例：192核配12.8TB Gen4 SSD (1c:66)；探探案例： 64核配3.2T Gen3 MLC SSD (1c:50)。</p><p>云上价格每核配比40GB ESSD PL3（1核:4x内存:40x磁盘）计算。</p></blockquote><hr><h2 id=ebs成本参考>EBS成本参考</h2><table class=full-width><thead><tr><th><strong>评估因素</strong></th><th><strong>本地</strong> <strong>PCI-E NVME SSD</strong></th><th><strong>Aliyun ESSD PL3</strong></th><th><strong>AWS io2 Block Express</strong></th></tr></thead><tbody><tr><td>容量</td><td>32TB</td><td>32 TB</td><td>64 TB</td></tr><tr><td>IOPS</td><td>4K随机读：600K ~ 1.1M 4K随机写 200K ~ 350K</td><td>4K随机读：最大 1M</td><td>16K随机IOPS： 256K</td></tr><tr><td>延迟</td><td>4K随机读：75µs 4K随机写：15µs</td><td>4K 随机读： 200µs</td><td>随机IO：500µs 上下文推断为16K</td></tr><tr><td>可靠性</td><td>UBER &lt; 1e-18，折合18个9 MTBF: 200万小时 5DWPD，持续三年</td><td>数据可靠性 9个9 <a href=https://help.aliyun.com/document_detail/476273.html>存储与数据可靠性</a></td><td><strong>持久性</strong>：99.999%，5个9 （0.001% 年故障率） <a href=https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/>io2 说明</a></td></tr><tr><td>成本</td><td>**16 ¥/TB·**<strong>月</strong> ( 5年均摊 / 3.2T MLC ) 5 年质保，¥3000 零售</td><td>**3200¥/TB·**<strong>月</strong> （原价 6400¥，包月4000¥） 3年预付整体打5折才有此价格</td><td>**1900 ¥/TB·**<strong>月</strong> 使用最大规格 65536GB 256K IOPS 最优惠状态</td></tr><tr><td>SLA</td><td>5年质保 出问题直接换新</td><td><a href="https://terms.aliyun.com/legal-agreement/terms/suit_bu1_ali_cloud/suit_bu1_ali_cloud201910310944_35008.html?spm=a2c4g.11186623.0.0.270e6e37n8Exh5">Aliyun RDS SLA</a> 可用性 99.99%: 月费 15% 99%: 月费 30% 95%: 月费 100%</td><td><a href=https://d1.awsstatic.com/legal/amazonrdsservice/Amazon-RDS-Service-Level-Agreement-Chinese.pdf>Amazon RDS SLA</a> 可用性 99.95%: 月费 15% 99%: 月费 25% 95%: 月费 100%</td></tr></tbody></table><hr><h2 id=s3成本参考>S3成本参考</h2><table class=full-width><thead><tr><th style=text-align:center>Date</th><th style=text-align:center>$/GB·月</th><th style=text-align:center>¥/TB·5年</th><th style=text-align:center>HDD ¥/TB</th><th style=text-align:center>SSD ¥/TB</th></tr></thead><tbody><tr><td style=text-align:center><a href=https://aws.amazon.com/cn/blogs/aws/amazon_s3/>2006</a>.03</td><td style=text-align:center>0.150</td><td style=text-align:center>63000</td><td style=text-align:center>2800</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=http://aws.typepad.com/aws/2010/11/what-can-i-say-another-amazon-s3-price-reduction.html>2010</a>.11</td><td style=text-align:center>0.140</td><td style=text-align:center>58800</td><td style=text-align:center>1680</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=http://aws.typepad.com/aws/2012/11/amazon-s3-price-reduction-december-1-2012.html>2012</a>.12</td><td style=text-align:center>0.095</td><td style=text-align:center>39900</td><td style=text-align:center>420</td><td style=text-align:center>15400</td></tr><tr><td style=text-align:center><a href=http://aws.typepad.com/aws/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html>2014</a>.04</td><td style=text-align:center>0.030</td><td style=text-align:center>12600</td><td style=text-align:center>371</td><td style=text-align:center>9051</td></tr><tr><td style=text-align:center><a href=https://aws.amazon.com/ru/blogs/aws/aws-storage-update-s3-glacier-price-reductions/>2016</a>.12</td><td style=text-align:center>0.023</td><td style=text-align:center>9660</td><td style=text-align:center>245</td><td style=text-align:center>3766</td></tr><tr><td style=text-align:center><a href=https://aws.amazon.com/cn/s3/pricing>2023</a>.12</td><td style=text-align:center>0.023</td><td style=text-align:center>9660</td><td style=text-align:center>105</td><td style=text-align:center>280</td></tr><tr><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center><strong>其他参考价</strong></td><td style=text-align:center><strong>高性能存储</strong></td><td style=text-align:center><strong>顶配底折价</strong></td><td style=text-align:center><strong>与采购NVMe SSD</strong></td><td style=text-align:center><strong>价格参考</strong></td></tr><tr><td style=text-align:center>S3 Express</td><td style=text-align:center>0.160</td><td style=text-align:center>67200</td><td style=text-align:center>DHH 12T</td><td style=text-align:center>1400</td></tr><tr><td style=text-align:center>EBS io2</td><td style=text-align:center>0.125 + IOPS</td><td style=text-align:center>114000</td><td style=text-align:center>Shannon 3.2T</td><td style=text-align:center>900</td></tr></tbody></table><hr><h2 id=下云合集>下云合集</h2><p>曾几何时，“<strong>上云</strong>“近乎成为技术圈的政治正确，整整一代应用开发者的视野被云遮蔽。就让我们用实打实的数据分析与亲身经历，讲清楚公有云租赁模式的价值与陷阱 —— 在这个降本增效的时代中，供您借鉴与参考 —— 请看 《<a href=/blog/cloud/exit/>云计算泥石流：合订本</a>》</p><p><strong>云基础资源篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/1OSRcBfd58s0tgZTUZHB9g>重新拿回计算机硬件的红利</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/HathxpQ_KUuqxyrtyCDzWw>扒皮对象存储：从降本到杀猪</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/UxjiUBTpb1pRUfGtR9V3ag>云盘是不是杀猪盘？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/LefEAXTcBH-KBJNhXNoc7A>云数据库是不是智商税</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/ANFnbDXwuhKI99fgYRZ9ug>垃圾腾讯云CDN：从入门到放弃</a></p></li></ul><hr><p><strong>云商业模式篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/Yp_PU8nmyK-NVq0clD98RQ>FinOps终点是下云</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/2w0bLJI7TvUNp1tzLYbvsA>云计算为啥还没挖沙子赚钱？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/LC5jAhuVObRcrTLxI1FUQA>云SLA是不是安慰剂？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/TksQ108v_nGaW11-87Es3A>杀猪盘真的降价了吗？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/Yp6L0hh4b4HuJQRPD3aJYw>范式转移：从云到本地优先</a></p></li></ul><hr><p><strong>下云奥德赛篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/yIVal-9U6_TXX-dZpVtjBg>下云高可用的秘诀：拒绝智力自慰</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/xaa079P4DRCz0hzNovGoOA>半年下云省千万：DHH下云FAQ答疑</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/CicctyvV1xk5B-AsKfzPjw>是时候放弃云计算了吗？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/H2S3TV-AsqS43A5Hh-XMhQ>下云奥德赛</a></p></li></ul><hr><p><strong>云故障复盘篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/FIOB_Oqefx1oez1iu7AGGg>从降本增笑到真的降本增效</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/OIlR0rolEQff9YfCpj3wIQ>我们能从阿里云史诗级故障中学到什么</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/3F1ud-tWB3eymu1-dxSHMA>阿里云周爆：云数据库管控又挂了</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/cTge3xOlIQCALQc8Mi-P8w>【阿里】云计算史诗级大翻车来了</a></p></li></ul><hr><p><strong>RDS翻车篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/-E_-HZ7LvOze5lmzy3QbQA>更好的开源RDS替代：Pigsty</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/CMRrqI2yBWlNbACHpNgL1g>驳《再论为什么你不应该招DBA》</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/AGEW1iHQkQy4NQyYC2GonQ>云RDS：从删库到跑路</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/4a8Qy4O80xqsnytC4l9lRg>数据库应该放入K8S里吗？</a></p></li><li><p><a href=https://mp.weixin.qq.com/s/kFftay1IokBDqyMuArqOpg>把数据库放入Docker是一个好主意吗？</a></p></li></ul><hr><p><strong>云厂商画像篇</strong></p><ul><li><p><a href=https://mp.weixin.qq.com/s/8ZffsCgchv8LH5ujv0lRGQ>互联网技术大师速成班 </a>【转载】</p></li><li><p><a href=https://mp.weixin.qq.com/s/qSTEf9txjHNTHeEFv3NkWg>门内的国企如何看门外的云厂商</a>【转载】</p></li><li><p><a href=https://mp.weixin.qq.com/s/1dse1KSCq2xG-QaL1JzZ8Q>卡在政企客户门口的阿里云</a>【转载】</p></li><li><p><a href=https://mp.weixin.qq.com/s/OxhhJ4U1P43di_eaE1uGPw>互联网故障背后的草台班子们</a>【转载】</p></li><li><p><a href=https://mp.weixin.qq.com/s/y9IradwxTxOsUGcOHia1XQ>云厂商眼中的客户：又穷又闲又缺爱</a>【转载】</p></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>