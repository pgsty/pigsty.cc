<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/ferret/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/ferret/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>模块：FERRET | PIGSTY</title><meta name=description content="使用 FerretDB 为 PostgreSQL 添加 MongoDB 兼容的协议支持"><meta property="og:url" content="https://pigsty.cc/docs/ferret/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="模块：FERRET"><meta property="og:description" content="使用 FerretDB 为 PostgreSQL 添加 MongoDB 兼容的协议支持"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="模块：FERRET"><meta itemprop=description content="使用 FerretDB 为 PostgreSQL 添加 MongoDB 兼容的协议支持"><meta itemprop=dateModified content="2026-02-14T08:23:39+08:00"><meta itemprop=wordCount content="29"><meta itemprop=keywords content="参考"><meta name=twitter:card content="summary"><meta name=twitter:title content="模块：FERRET"><meta name=twitter:description content="使用 FerretDB 为 PostgreSQL 添加 MongoDB 兼容的协议支持"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/ferret/>返回本页常规视图</a>.</p></div><h1 class=title>模块：FERRET</h1><div class=lead>使用 FerretDB 为 PostgreSQL 添加 MongoDB 兼容的协议支持</div><ul><li>1: <a href=#pg-3ee77bafb8707ed993c76a9ef3e52930>使用方法</a></li><li>2: <a href=#pg-14fbf7388cc09805ce5c6ec5e61c8035>集群配置</a></li><li>3: <a href=#pg-845c7b3fabc455f1465fbda82928737e>参数列表</a></li><li>4: <a href=#pg-908ffe719614bac78a06d2b23dd9965f>管理预案</a></li><li>5: <a href=#pg-fc5633ca2a2a94bc983ed21e93e60a13>管理剧本</a></li><li>6: <a href=#pg-fc7faa40914266400f7d1239351538e3>监控告警</a></li><li>7: <a href=#pg-c4cf8f99da4d8ae6071821c19c005545>指标列表</a></li><li>8: <a href=#pg-47a988886b865f7f87240d3d57a1c10b>常见问题</a></li></ul><div class=content><p><strong>FERRET</strong> 是 Pigsty 中的一个 <strong>可选</strong> 模块，用于部署 <a href=https://github.com/FerretDB/FerretDB><strong>FerretDB</strong></a> ——
这是一个构建在 PostgreSQL 内核与 <a href=https://pgext.cloud/e/documentdb>DocumentDB</a> 扩展之上的协议转换中间件。
能够对接使用 MongoDB 驱动的应用程序，并将这些请求转换为对 PostgreSQL 的操作。</p><p>Pigsty 是 FerretDB 社区的合作伙伴，我们提供 <a href=https://github.com/FerretDB/FerretDB><strong>FerretDB</strong></a> 与 <a href=https://pgext.cloud/e/documentdb><strong>DocumentDB</strong></a>（微软维护版本）的二进制包，
并提供了开箱即用的配置模板 <a href=https://github.com/pgsty/pigsty/blob/v4.1.0/conf/mongo.yml><code>mongo.yml</code></a>，帮助您轻松部署企业级质量的 FerretDB 集群。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3ee77bafb8707ed993c76a9ef3e52930>1 - 使用方法</h1><div class=lead>安装客户端工具，连接并使用 FerretDB</div><p>本文档介绍如何安装 MongoDB 客户端工具并连接到 FerretDB。</p><hr><h2 id=安装客户端工具>安装客户端工具</h2><p>您可以使用 MongoDB 的命令行工具 <a href=https://www.mongodb.com/docs/mongodb-shell/>MongoSH</a> 来访问 FerretDB。</p><p>使用 <code>pig</code> 命令添加 MongoDB 仓库，然后使用 <code>yum</code> 或 <code>apt</code> 安装 <code>mongosh</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add mongo -u         <span style=color:#8f5902;font-style:italic># 添加 MongoDB 官方仓库</span>
</span></span><span style=display:flex><span>yum install mongodb-mongosh   <span style=color:#8f5902;font-style:italic># RHEL/CentOS/Rocky/Alma</span>
</span></span><span style=display:flex><span>apt install mongodb-mongosh   <span style=color:#8f5902;font-style:italic># Debian/Ubuntu</span>
</span></span></code></pre></div><p>安装完成后，您可以使用 <code>mongosh</code> 命令连接到 FerretDB。</p><hr><h2 id=连接到-ferretdb>连接到 FerretDB</h2><p>您可以使用任何语言的 MongoDB 驱动程序通过 MongoDB 连接字符串访问 FerretDB。以下是使用 <code>mongosh</code> CLI 工具的示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mongosh <span style=color:#4e9a06>&#39;mongodb://postgres:DBUser.Postgres@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span>Current Mongosh Log ID:	696b5bb93441875f86284d0b
</span></span><span style=display:flex><span>Connecting to:		mongodb://&lt;credentials&gt;@10.10.10.10:27017/?directConnection<span style=color:#ce5c00;font-weight:700>=</span>true<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>appName</span><span style=color:#ce5c00;font-weight:700>=</span>mongosh+2.6.0
</span></span><span style=display:flex><span>Using MongoDB:		7.0.77
</span></span><span style=display:flex><span>Using Mongosh:		2.6.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test&gt;
</span></span></code></pre></div><h3 id=使用连接字符串>使用连接字符串</h3><p>FerretDB 的身份验证完全基于 PostgreSQL。Pigsty 默认使用 <code>scram-sha-256</code>，在 FerretDB 2.x 中对应 <code>SCRAM-SHA-256</code> 认证。通常客户端会自动协商，你可以直接使用 PostgreSQL 用户名与密码。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://postgres:DBUser.Postgres@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 若客户端认证协商失败，可显式指定：</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://postgres:DBUser.Postgres@10.10.10.10:27017/?authMechanism=SCRAM-SHA-256&#39;</span>
</span></span></code></pre></div><p>连接字符串格式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mongodb://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;<span style=color:#ce5c00;font-weight:700>[</span>?authMechanism<span style=color:#ce5c00;font-weight:700>=</span>SCRAM-SHA-256<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h3 id=使用不同的用户>使用不同的用户</h3><p>您可以使用任何已在 PostgreSQL 中创建的用户连接到 FerretDB：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用超级管理员用户</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_dba:DBUser.DBA@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用普通管理员用户</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用普通只读用户</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_view:DBUser.Viewer@10.10.10.10:27017&#39;</span>
</span></span></code></pre></div><hr><h2 id=基本操作>基本操作</h2><p>连接到 FerretDB 后，您可以像使用 MongoDB 一样进行操作。以下是一些基本操作示例：</p><h3 id=数据库操作>数据库操作</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 显示所有数据库
</span></span></span><span style=display:flex><span><span style=color:#000>show</span> <span style=color:#000>dbs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 显示所有集合
</span></span></span><span style=display:flex><span><span style=color:#000>show</span> <span style=color:#000>collections</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 切换/创建数据库
</span></span></span><span style=display:flex><span><span style=color:#000>use</span> <span style=color:#000>mydb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 删除当前数据库
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dropDatabase</span><span style=color:#000;font-weight:700>();</span>
</span></span></code></pre></div><h3 id=集合操作>集合操作</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>createCollection</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;users&#39;</span><span style=color:#000;font-weight:700>);</span>     <span style=color:#8f5902;font-style:italic>// 创建集合
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>drop</span><span style=color:#000;font-weight:700>();</span>                  <span style=color:#8f5902;font-style:italic>// 删除集合
</span></span></span></code></pre></div><h3 id=文档操作>文档操作</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 插入单个文档
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>insertOne</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Alice&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;alice@example.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 插入多个文档
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>insertMany</span><span style=color:#000;font-weight:700>([</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Bob&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>25</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Charlie&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>35</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 查询文档
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>find</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>find</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>$gt</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>25</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>findOne</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Alice&#39;</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 更新文档
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>updateOne</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Alice&#39;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span> <span style=color:#000>$set</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>31</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 删除文档
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>deleteOne</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Bob&#39;</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>deleteMany</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>$lt</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h3 id=索引操作>索引操作</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 创建索引
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>createIndex</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 查看索引
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getIndexes</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 删除索引
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>users</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dropIndex</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;name_1&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><hr><h2 id=与-mongodb-的差异>与 MongoDB 的差异</h2><p>FerretDB 实现了 MongoDB 的线协议，但底层使用 PostgreSQL 存储数据。这意味着：</p><ul><li>MongoDB 命令会被翻译为 SQL 语句执行</li><li>大多数基本操作与 MongoDB 兼容</li><li>某些高级功能可能有差异或不支持</li></ul><p>您可以查阅以下资源了解详细信息：</p><ul><li><a href=https://docs.ferretdb.io/reference/supported-commands/>FerretDB 支持的命令</a></li><li><a href=https://docs.ferretdb.io/diff/>与 MongoDB 的差异</a></li><li><a href=https://docs.ferretdb.io/security/authentication/>FerretDB 认证机制</a></li></ul><hr><h2 id=程序语言驱动>程序语言驱动</h2><p>除了 <code>mongosh</code> 命令行工具，您还可以使用各种编程语言的 MongoDB 驱动程序连接到 FerretDB：</p><h3 id=python>Python</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>pymongo</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>MongoClient</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MongoClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;mongodb://dbuser_dba:DBUser.DBA@10.10.10.10:27017&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>db</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>client</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>test</span>
</span></span><span style=display:flex><span><span style=color:#000>collection</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>users</span>
</span></span><span style=display:flex><span><span style=color:#000>collection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>insert_one</span><span style=color:#000;font-weight:700>({</span><span style=color:#4e9a06>&#39;name&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Alice&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;age&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><h3 id=nodejs>Node.js</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>MongoClient</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;mongodb&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>uri</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>MongoClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>run</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>connect</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>db</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>db</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;test&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>collection</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>collection</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;users&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>collection</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>insertOne</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Alice&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=go>Go</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;go.mongodb.org/mongo-driver/mongo&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;go.mongodb.org/mongo-driver/mongo/options&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>uri</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>client</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>err</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8> </span><span style=color:#000>mongo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Connect</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TODO</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8> </span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Client</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>ApplyURI</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-14fbf7388cc09805ce5c6ec5e61c8035>2 - 集群配置</h1><div class=lead>配置 FerretDB 模块，定义集群拓扑</div><p>在部署 FerretDB 集群之前，您需要使用相关 <a href=/docs/ferret/param>参数</a> 在配置清单中定义它。</p><hr><h2 id=ferretdb-集群>FerretDB 集群</h2><p>以下示例使用默认单节点 <code>pg-meta</code> 集群的 <code>postgres</code> 数据库作为 FerretDB 的底层存储：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># ferretdb for mongodb on postgresql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># ./mongo.yml -l ferret</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>ferret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>mongo_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>mongo_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ferret</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>mongo_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;postgres://dbuser_dba:DBUser.DBA@10.10.10.10:5432/postgres&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>这里，<a href=/docs/ferret/param#mongo_cluster><code>mongo_cluster</code></a> 和 <a href=/docs/ferret/param#mongo_seq><code>mongo_seq</code></a> 是基本的身份参数。对于 FerretDB，还需要 <a href=/docs/ferret/param#mongo_pgurl><code>mongo_pgurl</code></a> 来指定底层 PostgreSQL 的位置。</p><p>请注意，<code>mongo_pgurl</code> 参数需要一个 PostgreSQL <strong>超级用户</strong>。此示例使用默认的 <code>dbuser_dba</code>，生产环境中也可以改用专用超级用户。</p><p>请注意，FerretDB 的 <a href=https://docs.ferretdb.io/security/authentication/>身份验证</a> 完全基于 PostgreSQL。您可以使用 FerretDB 或 PostgreSQL 创建其他常规用户。</p><hr><h2 id=postgresql-集群>PostgreSQL 集群</h2><p>FerretDB 2.0+ 需要一个扩展：<a href=https://pgext.cloud/e/documentdb>DocumentDB</a>，它依赖于几个其他扩展。以下是为 FerretDB 创建 PostgreSQL 集群的模板：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># pgsql (singleton on current node)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># postgres cluster: pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin   ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres, extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>documentdb, postgis, vector, pg_cron, rum ]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># WARNING: demo/dev only. Avoid world access for dbsu in production.</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: postgres    , db: all ,addr: world ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;dbsu password access everywhere&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all         , db: all ,addr: localhost ,order: 1 ,auth: trust ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;documentdb localhost trust access&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all         , db: all ,addr: local     ,order: 1 ,auth: trust ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;documentdb local trust access&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all         , db: all ,addr: intra ,auth: pwd ,title: &#39;everyone intranet access with password&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>cron.database_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>documentdb, postgis, pgvector, pg_cron, rum</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_documentdb, pg_documentdb_core, pg_documentdb_extended_rum, pg_cron, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>关键配置要点：</p><ul><li><strong>用户配置</strong>：<code>mongo_pgurl</code> 对应用户必须具备超级用户权限（示例使用 <code>dbuser_dba</code>）</li><li><strong>数据库配置</strong>：数据库需要安装 <code>documentdb</code> 扩展及其依赖</li><li><strong>HBA 规则</strong>：建议包含 <code>localhost/local</code> 的 <code>trust</code> 规则以满足 documentdb 本地访问需求，同时为业务网段配置密码认证</li><li><strong>共享库</strong>：需要在 <code>pg_libs</code> 中预加载 <code>pg_documentdb</code>、<code>pg_documentdb_core</code>、<code>pg_documentdb_extended_rum</code></li></ul><hr><h2 id=高可用性>高可用性</h2><p>您可以使用 <a href=/docs/pgsql/service/>服务</a> 连接到高可用的 PostgreSQL 集群，并部署多个 FerretDB 实例副本，并为 FerretDB 层绑定 L2 VIP 以实现高可用性。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>ferret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.45</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>mongo_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.46</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>mongo_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.47</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>mongo_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>mongo_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ferret</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>mongo_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;postgres://dbuser_dba:DBUser.DBA@10.10.10.3:5436/postgres&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.99</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>在这个高可用配置中：</p><ul><li><strong>多实例部署</strong>：在三个节点上部署 FerretDB 实例，所有实例连接到同一个 PostgreSQL 后端</li><li><strong>VIP 配置</strong>：使用 Keepalived 绑定虚拟 IP <code>10.10.10.99</code>，实现 FerretDB 层的故障转移</li><li><strong>服务地址</strong>：使用 PostgreSQL 的服务地址（端口 5436 通常是主库服务），确保连接到正确的主库</li></ul><p>这样配置后，客户端可以通过 VIP 地址连接到 FerretDB，即使某个 FerretDB 实例故障，VIP 也会自动漂移到其他可用实例。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-845c7b3fabc455f1465fbda82928737e>3 - 参数列表</h1><div class=lead>使用 9 个参数自定义 FerretDB 组件</div><h2 id=参数概览>参数概览</h2><p><strong><code>FERRET</code></strong> 参数组用于 FerretDB 部署与配置，包括身份标识、底层 PostgreSQL 连接、监听端口以及 SSL 设置。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#mongo_seq><code>mongo_seq</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>mongo 实例号，必选身份参数</td></tr><tr><td style=text-align:left><a href=#mongo_cluster><code>mongo_cluster</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>mongo 集群名，必选身份参数</td></tr><tr><td style=text-align:left><a href=#mongo_pgurl><code>mongo_pgurl</code></a></td><td style=text-align:center><code>pgurl</code></td><td style=text-align:center><code>C/I</code></td><td style=text-align:left>FerretDB 底层使用的 PGURL 连接串</td></tr><tr><td style=text-align:left><a href=#mongo_ssl_enabled><code>mongo_ssl_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>是否启用 SSL？默认为 <code>false</code></td></tr><tr><td style=text-align:left><a href=#mongo_listen><code>mongo_listen</code></a></td><td style=text-align:center><code>ip</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>监听地址，默认留空则监听所有地址</td></tr><tr><td style=text-align:left><a href=#mongo_port><code>mongo_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>服务端口，默认使用 <code>27017</code></td></tr><tr><td style=text-align:left><a href=#mongo_ssl_port><code>mongo_ssl_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>TLS 监听端口，默认使用 <code>27018</code></td></tr><tr><td style=text-align:left><a href=#mongo_exporter_port><code>mongo_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Exporter 端口，默认使用 <code>9216</code></td></tr><tr><td style=text-align:left><a href=#mongo_extra_vars><code>mongo_extra_vars</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>额外环境变量，默认为空白字符串</td></tr></tbody></table><hr><h2 id=默认值>默认值</h2><p>默认参数定义在 <a href=https://github.com/pgsty/pigsty/blob/v4.1.0/roles/ferret/defaults/main.yml><code>roles/ferret/defaults/main.yml</code></a> 中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># mongo_cluster:        #CLUSTER  # mongo 集群名称，必选身份参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># mongo_seq: 0          #INSTANCE # mongo 实例序列号，必选身份参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># mongo_pgurl: &#39;postgres:///&#39;     # mongo/ferretdb 底层 postgresql url，必选</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_ssl_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb ssl 启用，默认为 false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_listen</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb 监听地址，&#39;&#39; 表示所有地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>27017</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb 监听端口，默认为 27017</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_ssl_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>27018</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb tls 监听端口，默认为 27018</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9216</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb exporter 端口，默认为 9216</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_extra_vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># mongo/ferretdb 的额外环境变量</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=mongo_cluster><code>mongo_cluster</code></h2><p>参数名称：<code>mongo_cluster</code>，类型：<code>string</code>，级别：<code>C</code></p><p>mongo 集群名称，必选身份参数。</p><p>没有默认值，您必须为生产环境显式定义它。</p><p>集群名称需要符合正则表达式 <code>[a-z][a-z0-9-]*</code>，建议使用描述性名称。</p><hr><h2 id=mongo_seq><code>mongo_seq</code></h2><p>参数名称：<code>mongo_seq</code>，类型：<code>int</code>，级别：<code>I</code></p><p>mongo 实例序列号，集群内需要唯一的整数标识。</p><p>您必须为每个 mongo 实例显式定义序列号，整数从 0 或 1 开始。</p><hr><h2 id=mongo_pgurl><code>mongo_pgurl</code></h2><p>参数名称：<code>mongo_pgurl</code>，类型：<code>pgurl</code>，级别：<code>C/I</code></p><p>FerretDB 连接的底层 PostgreSQL URL，必选参数。</p><p>没有默认值，您必须显式定义它。这是 FerretDB 将用作其后端存储的 PostgreSQL 数据库连接串。</p><p>格式：<code>postgres://username:password@host:port/database</code></p><p>请注意：</p><ul><li>用户需要是 PostgreSQL 超级用户</li><li>目标数据库需要安装 <code>documentdb</code> 扩展</li><li>建议使用专用的 <code>mongod</code> 用户</li></ul><hr><h2 id=mongo_ssl_enabled><code>mongo_ssl_enabled</code></h2><p>参数名称：<code>mongo_ssl_enabled</code>，类型：<code>bool</code>，级别：<code>C</code></p><p>是否为 FerretDB 启用 SSL/TLS 加密。</p><p>默认值为 <code>false</code>。设置为 <code>true</code> 以启用 mongo 连接的 SSL/TLS 加密。</p><p>启用后，FerretDB 将会：</p><ul><li>生成并签发 SSL 证书</li><li>在 <a href=#mongo_ssl_port><code>mongo_ssl_port</code></a> 端口上监听加密连接</li></ul><hr><h2 id=mongo_listen><code>mongo_listen</code></h2><p>参数名称：<code>mongo_listen</code>，类型：<code>ip</code>，级别：<code>C</code></p><p>mongo 绑定的监听地址。</p><p>默认值为空字符串 <code>''</code>，这意味着监听所有可用地址（<code>0.0.0.0</code>）。您可以指定特定的 IP 地址进行绑定。</p><hr><h2 id=mongo_port><code>mongo_port</code></h2><p>参数名称：<code>mongo_port</code>，类型：<code>port</code>，级别：<code>C</code></p><p>mongo 客户端连接的服务端口。</p><p>默认值为 <code>27017</code>，这是标准的 MongoDB 端口。如果您需要避免端口冲突或有安全考虑，可以更改此端口。</p><hr><h2 id=mongo_ssl_port><code>mongo_ssl_port</code></h2><p>参数名称：<code>mongo_ssl_port</code>，类型：<code>port</code>，级别：<code>C</code></p><p>mongo 加密连接的 TLS 监听端口。</p><p>默认值为 <code>27018</code>。当通过 <a href=#mongo_ssl_enabled><code>mongo_ssl_enabled</code></a> 启用 SSL/TLS 时，FerretDB 将在此端口上接受加密连接。</p><hr><h2 id=mongo_exporter_port><code>mongo_exporter_port</code></h2><p>参数名称：<code>mongo_exporter_port</code>，类型：<code>port</code>，级别：<code>C</code></p><p>mongo 指标收集的 Exporter 端口。</p><p>默认值为 <code>9216</code>。此端口由 FerretDB 内置的指标导出器使用，向 Prometheus 暴露监控指标。</p><hr><h2 id=mongo_extra_vars><code>mongo_extra_vars</code></h2><p>参数名称：<code>mongo_extra_vars</code>，类型：<code>string</code>，级别：<code>C</code></p><p>FerretDB 服务器的额外环境变量。</p><p>默认值为空字符串 <code>''</code>。您可以指定将传递给 FerretDB 进程的额外环境变量，格式为 <code>KEY=VALUE</code>，多个变量用空格分隔。</p><p>例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>mongo_extra_vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;FERRETDB_LOG_LEVEL=debug FERRETDB_TELEMETRY=disable&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-908ffe719614bac78a06d2b23dd9965f>4 - 管理预案</h1><div class=lead>创建、移除、扩展、收缩、升级 FerretDB 集群</div><p>本文档介绍 FerretDB 集群的日常管理操作。</p><hr><h2 id=创建-ferretdb-集群>创建 FerretDB 集群</h2><p>在 <a href=/docs/setup/config>配置清单</a> 中 <a href=/docs/ferret/config>定义</a> FerretDB 集群后，您可以使用以下命令安装它：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./mongo.yml -l ferret   <span style=color:#8f5902;font-style:italic># 在 ferret 分组上安装 FerretDB</span>
</span></span></code></pre></div><p>由于 FerretDB 使用 PostgreSQL 作为其底层存储，多次运行此剧本通常是安全的（幂等性）。</p><p>FerretDB 服务配置了失败自动重启（<code>Restart=on-failure</code>），为这个无状态代理层提供了基本的容错能力。</p><hr><h2 id=移除-ferretdb-集群>移除 FerretDB 集群</h2><p>要移除 FerretDB 集群，请使用 <code>mongo_purge</code> 参数运行 <a href=/docs/ferret/playbook#mongoyml><code>mongo.yml</code></a> 剧本的 <code>mongo_purge</code> 子任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./mongo.yml -l ferret -e <span style=color:#000>mongo_purge</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> -t mongo_purge
</span></span></code></pre></div><p><strong>重要</strong>：请务必使用 <code>-l &lt;cluster></code> 参数限制执行范围，避免误删其他集群。</p><p>此命令将会：</p><ul><li>停止 FerretDB 服务</li><li>移除 systemd 服务文件</li><li>清理配置文件和证书</li><li>从 Prometheus 监控中注销</li></ul><hr><h2 id=连接到-ferretdb>连接到 FerretDB</h2><p>您可以使用 MongoDB 连接串，用任何语言的 MongoDB 驱动访问 FerretDB。以下是使用 <a href=/docs/ferret/usage#%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7><code>mongosh</code></a> 命令行工具的示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://test:test@10.10.10.11:27017/test&#39;</span>
</span></span></code></pre></div><p>Pigsty 管理的 PostgreSQL 集群默认使用 <code>scram-sha-256</code>。FerretDB 2.x 对应使用 <code>SCRAM-SHA-256</code> 认证，绝大多数客户端会自动协商；如果遇到协商失败，可在连接串中显式追加 <code>authMechanism=SCRAM-SHA-256</code>。参阅 <a href=https://docs.ferretdb.io/security/authentication/>FerretDB：认证</a> 获取详细信息。</p><p>您也可以使用其他 PostgreSQL 用户来访问 FerretDB，只要在连接串中指定即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_dba:DBUser.DBA@10.10.10.10:27017&#39;</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_dba:DBUser.DBA@10.10.10.10:27017/?authMechanism=SCRAM-SHA-256&#39;</span>
</span></span></code></pre></div><hr><h2 id=快速上手>快速上手</h2><p>连接到 FerretDB 后，您可以像使用 MongoDB 一样进行操作：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#39;</span>
</span></span></code></pre></div><p>MongoDB 的命令会被翻译为 SQL 命令，在底层的 PostgreSQL 中执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000>use</span> <span style=color:#000>test</span>                            <span style=color:#8f5902;font-style:italic>// CREATE SCHEMA test;
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dropDatabase</span><span style=color:#000;font-weight:700>()</span>                   <span style=color:#8f5902;font-style:italic>// DROP SCHEMA test;
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>createCollection</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;posts&#39;</span><span style=color:#000;font-weight:700>)</span>        <span style=color:#8f5902;font-style:italic>// CREATE TABLE posts(_data JSONB,...)
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>posts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>insert</span><span style=color:#000;font-weight:700>({</span>                   <span style=color:#8f5902;font-style:italic>// INSERT INTO posts VALUES(...);
</span></span></span><span style=display:flex><span>    <span style=color:#000>title</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Post One&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Body of post one&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>category</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;News&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>tags</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;news&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;events&#39;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;John Doe&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;author&#39;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000>date</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87>Date</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>posts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>find</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>limit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>pretty</span><span style=color:#000;font-weight:700>()</span>   <span style=color:#8f5902;font-style:italic>// SELECT * FROM posts LIMIT 2;
</span></span></span><span style=display:flex><span><span style=color:#000>db</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>posts</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>createIndex</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>title</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>})</span>  <span style=color:#8f5902;font-style:italic>// CREATE INDEX ON posts(_data-&gt;&gt;&#39;title&#39;);
</span></span></span></code></pre></div><p>如果您不熟悉 MongoDB，这里有一个快速上手教程，同样适用于 FerretDB：<a href=https://www.mongodb.com/docs/mongodb-shell/crud/>Perform CRUD Operations with MongoDB Shell</a></p><hr><h2 id=压力测试>压力测试</h2><p>如果您希望生成一些样例负载，可以使用 <code>mongosh</code> 执行以下简易测试脚本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; benchmark.js <span style=color:#4e9a06>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>const coll = &#34;testColl&#34;;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>const numDocs = 10000;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>for (let i = 0; i &lt; numDocs; i++) {  // insert
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  db.getCollection(coll).insert({ num: i, name: &#34;MongoDB Benchmark Test&#34; });
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>for (let i = 0; i &lt; numDocs; i++) {  // select
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  db.getCollection(coll).find({ num: i });
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>for (let i = 0; i &lt; numDocs; i++) {  // update
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  db.getCollection(coll).update({ num: i }, { $set: { name: &#34;Updated&#34; } });
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>for (let i = 0; i &lt; numDocs; i++) {  // delete
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  db.getCollection(coll).deleteOne({ num: i });
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://dbuser_meta:DBUser.Meta@10.10.10.10:27017&#39;</span> benchmark.js
</span></span></code></pre></div><p>您可以查阅 FerretDB 支持的 <a href=https://docs.ferretdb.io/reference/supported-commands/>MongoDB 命令</a>，同时还有一些 <a href=https://docs.ferretdb.io/diff/>已知的区别</a>。对于基本的使用来说，这些差异通常不是什么大问题。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fc5633ca2a2a94bc983ed21e93e60a13>5 - 管理剧本</h1><div class=lead>可在 FERRET 模块中使用的 Ansible 剧本</div><p>Pigsty 提供了一个内置剧本 <a href=https://github.com/pgsty/pigsty/blob/v4.1.0/mongo.yml><code>mongo.yml</code></a> 用于在节点上安装 FerretDB。</p><p><strong>重要说明</strong>：此剧本仅在定义了 <a href=/docs/ferret/param#mongo_seq><code>mongo_seq</code></a> 参数的主机上执行。
对于未定义 <code>mongo_seq</code> 的主机，剧本会安全跳过所有任务，因此可以安全地在混合主机组上运行。</p><hr><h2 id=mongoyml><code>mongo.yml</code></h2><p>剧本地址：<a href=https://github.com/pgsty/pigsty/blob/v4.1.0/mongo.yml><code>mongo.yml</code></a></p><p>功能说明：在定义了 <code>mongo_seq</code> 的目标主机上安装 MongoDB/FerretDB。</p><p>此剧本包含以下子任务：</p><table class=full-width><thead><tr><th>子任务</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td><code>mongo_check</code></td><td style=text-align:left>检查 mongo 身份参数</td></tr><tr><td><code>mongo_dbsu</code></td><td style=text-align:left>创建操作系统用户 mongod</td></tr><tr><td><code>mongo_install</code></td><td style=text-align:left>安装 ferretdb RPM/DEB 包</td></tr><tr><td><code>mongo_purge</code></td><td style=text-align:left>清理现有 FerretDB（默认不执行）</td></tr><tr><td><code>mongo_config</code></td><td style=text-align:left>配置 FerretDB 服务</td></tr><tr><td><code>mongo_cert</code></td><td style=text-align:left>签发 FerretDB SSL 证书</td></tr><tr><td><code>mongo_launch</code></td><td style=text-align:left>启动 FerretDB 服务</td></tr><tr><td><code>mongo_register</code></td><td style=text-align:left>将 FerretDB 注册到 Prometheus</td></tr></tbody></table><hr><h2 id=任务详解>任务详解</h2><h3 id=mongo_check><code>mongo_check</code></h3><p>检查必选的身份参数是否已定义：</p><ul><li><code>mongo_cluster</code>：集群名称</li><li><code>mongo_seq</code>：实例序号</li><li><code>mongo_pgurl</code>：PostgreSQL 连接串</li></ul><p>如果任一参数缺失，剧本将报错退出。</p><h3 id=mongo_dbsu><code>mongo_dbsu</code></h3><p>创建 FerretDB 运行所需的操作系统用户和组：</p><ul><li>创建 <code>mongod</code> 用户组</li><li>创建 <code>mongod</code> 用户，家目录为 <code>/var/lib/mongod</code></li></ul><h3 id=mongo_install><code>mongo_install</code></h3><p>安装 FerretDB 软件包：</p><ul><li>在 RPM 系发行版上安装 <code>ferretdb2</code> 包</li><li>在 DEB 系发行版上安装对应的 deb 包</li></ul><h3 id=mongo_purge><code>mongo_purge</code></h3><p>清理现有的 FerretDB 集群。此任务默认不执行，需要显式指定：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./mongo.yml -l &lt;cluster&gt; -e <span style=color:#000>mongo_purge</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> -t mongo_purge
</span></span></code></pre></div><p><strong>重要</strong>：请务必使用 <code>-l &lt;cluster></code> 参数限制执行范围。</p><p>清理操作包括：</p><ul><li>停止并禁用 ferretdb 服务</li><li>移除 systemd 服务文件</li><li>移除配置文件和 SSL 证书</li><li>从 Prometheus 监控目标中注销</li></ul><h3 id=mongo_config><code>mongo_config</code></h3><p>配置 FerretDB 服务：</p><ul><li>渲染环境变量配置文件 <code>/etc/default/ferretdb</code></li><li>创建 systemd 服务文件</li></ul><h3 id=mongo_cert><code>mongo_cert</code></h3><p>当 <a href=/docs/ferret/param#mongo_ssl_enabled><code>mongo_ssl_enabled</code></a> 设置为 <code>true</code> 时，此任务会：</p><ul><li>生成 FerretDB 的 SSL 私钥</li><li>创建证书签名请求（CSR）</li><li>使用 CA 签发 SSL 证书</li><li>将证书文件部署到 <code>/var/lib/mongod/</code></li></ul><h3 id=mongo_launch><code>mongo_launch</code></h3><p>启动 FerretDB 服务：</p><ul><li>重新加载 systemd 配置</li><li>启动并启用 ferretdb 服务</li><li>等待服务在指定端口上可用（默认 27017）</li></ul><p>FerretDB 服务配置了 <code>Restart=on-failure</code>，因此当进程意外崩溃时会自动重启。这为这个无状态代理服务提供了基本的容错能力。</p><h3 id=mongo_register><code>mongo_register</code></h3><p>将 FerretDB 实例注册到 Prometheus 监控系统：</p><ul><li>在所有 <code>infra</code> 节点上创建监控目标文件</li><li>目标文件路径：<code>/infra/targets/mongo/&lt;cluster>-&lt;seq>.yml</code></li><li>包含实例的 IP、标签和指标端口信息</li></ul><hr><h2 id=使用示例>使用示例</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 在 ferret 分组上部署 FerretDB</span>
</span></span><span style=display:flex><span>./mongo.yml -l ferret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅执行配置任务</span>
</span></span><span style=display:flex><span>./mongo.yml -l ferret -t mongo_config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重新签发 SSL 证书</span>
</span></span><span style=display:flex><span>./mongo.yml -l ferret -t mongo_cert
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重启 FerretDB 服务</span>
</span></span><span style=display:flex><span>./mongo.yml -l ferret -t mongo_launch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 清理 FerretDB 集群</span>
</span></span><span style=display:flex><span>./mongo.yml -l ferret -e <span style=color:#000>mongo_purge</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> -t mongo_purge
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-fc7faa40914266400f7d1239351538e3>6 - 监控告警</h1><div class=lead>FerretDB 模块的监控仪表板与告警规则</div><p><a href=/docs/ferret><code>FERRET</code></a> 模块目前提供了一个监控仪表板。</p><hr><h2 id=mongo-overview>Mongo Overview</h2><p><a href=https://demo.pigsty.cc/d/mongo-overview>Mongo Overview</a>：Mongo/FerretDB 集群概览</p><p>这个监控面板提供了关于 FerretDB 的基本监控指标，包括：</p><ul><li><strong>实例状态</strong>：FerretDB 实例的运行状态</li><li><strong>客户端连接</strong>：客户端连接数量和请求统计</li><li><strong>资源使用</strong>：CPU、内存、Goroutine 数量等</li><li><strong>PostgreSQL 连接池</strong>：后端 PostgreSQL 连接池状态</li></ul><p><a href=https://demo.pigsty.cc/d/mongo-overview><img src=/img/dashboard/mongo-overview.jpg alt=mongo-overview.jpg></a></p><p>由于 FerretDB 底层使用 PostgreSQL 作为存储引擎，更多的监控指标请参考 <a href=/docs/pgsql/monitor>PostgreSQL 监控</a>。</p><hr><h2 id=监控指标>监控指标</h2><p>FerretDB 通过内置的 Exporter 在 <a href=/docs/ferret/param#mongo_exporter_port><code>mongo_exporter_port</code></a>（默认 9216）端口暴露 Prometheus 格式的监控指标。</p><p>关键指标类别包括：</p><table class=full-width><thead><tr><th style=text-align:left>指标前缀</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>ferretdb_*</code></td><td style=text-align:left>FerretDB 核心指标</td></tr><tr><td style=text-align:left><code>ferretdb_client_*</code></td><td style=text-align:left>客户端连接和请求统计</td></tr><tr><td style=text-align:left><code>ferretdb_postgresql_*</code></td><td style=text-align:left>PostgreSQL 后端状态</td></tr><tr><td style=text-align:left><code>go_*</code></td><td style=text-align:left>Go 运行时指标</td></tr><tr><td style=text-align:left><code>process_*</code></td><td style=text-align:left>进程级别指标</td></tr></tbody></table><p>完整的指标列表请参阅 <a href=/docs/ferret/metric>指标列表</a>。</p><hr><h2 id=告警规则>告警规则</h2><p>Pigsty v4.1 默认规则集中未内置专门的 FerretDB 告警规则（<code>files/victoria/rules/*.yml</code>）。您可以基于 <code>ferretdb_up</code> 指标按需添加自定义告警，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>FerretDBDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ferretdb_up == 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>severity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>critical</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;FerretDB instance {{ $labels.ins }} is down&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;FerretDB instance {{ $labels.ins }} on {{ $labels.ip }} has been down for more than 1 minute.&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>由于 FerretDB 是无状态的代理层，主要的监控和告警应集中在底层 PostgreSQL 集群。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c4cf8f99da4d8ae6071821c19c005545>7 - 指标列表</h1><div class=lead>FerretDB 模块提供的完整监控指标列表与释义</div><p><a href=/docs/ferret><strong><code>MONGO</code></strong></a> 模块包含有 54 类可用监控指标。</p><table class=full-width><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>ferretdb_client_accepts_total</td><td>Unknown</td><td><code>error</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_client_duration_seconds_bucket</td><td>Unknown</td><td><code>error</code>, <code>le</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_client_duration_seconds_count</td><td>Unknown</td><td><code>error</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_client_duration_seconds_sum</td><td>Unknown</td><td><code>error</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_client_requests_total</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>opcode</code>, <code>instance</code>, <code>command</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_client_responses_total</td><td>Unknown</td><td><code>result</code>, <code>argument</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>opcode</code>, <code>instance</code>, <code>command</code>, <code>job</code></td><td>N/A</td></tr><tr><td>ferretdb_postgresql_metadata_databases</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>The current number of database in the registry.</td></tr><tr><td>ferretdb_postgresql_pool_size</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>The current number of pools.</td></tr><tr><td>ferretdb_up</td><td>gauge</td><td><code>cls</code>, <code>version</code>, <code>commit</code>, <code>ip</code>, <code>ins</code>, <code>dirty</code>, <code>telemetry</code>, <code>package</code>, <code>update_available</code>, <code>uuid</code>, <code>instance</code>, <code>job</code>, <code>branch</code>, <code>debug</code></td><td>FerretDB instance state.</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>quantile</code>, <code>job</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>cls</code>, <code>version</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes allocated and still in use.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of OS threads created.</td></tr><tr><td>mongo_up</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>promhttp_metric_handler_errors_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>cause</code></td><td>Total number of internal errors encountered by the promhttp metric handler.</td></tr><tr><td>promhttp_metric_handler_requests_in_flight</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>Current number of scrapes being served.</td></tr><tr><td>promhttp_metric_handler_requests_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>code</code></td><td>Total number of scrapes by HTTP status code.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>ins</code>, <code>instance</code>, <code>job</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-47a988886b865f7f87240d3d57a1c10b>8 - 常见问题</h1><div class=lead>FerretDB 与 DocumentDB 模块常见问题答疑</div><hr><h2 id=为什么要使用-ferretdb>为什么要使用 FerretDB？</h2><p><a href=https://www.mongodb.com/licensing/server-side-public-license/faq>MongoDB</a> <strong>曾经</strong> 是一项令人惊叹的技术，让开发者能够抛开关系型数据库的"模式束缚"，快速构建应用程序。
然而随着时间推移，MongoDB 放弃了它的开源本质，将许可证更改为 SSPL，这使得许多开源项目和早期商业项目无法使用它。
大多数 MongoDB 用户其实并不需要 MongoDB 提供的高级功能，但他们确实需要一个易于使用的开源文档数据库解决方案。为了填补这个空白，<a href=https://ferretdb.io>FerretDB</a> 应运而生。</p><p>PostgreSQL 的 JSON 功能支持已经足够完善了：二进制存储 JSONB，GIN 任意字段索引，各种 JSON 处理函数，JSON PATH 和 JSON Schema，它早已是一个功能完备，性能强大的文档数据库。
但是提供替代的功能，与 <strong>直接仿真</strong> 还是不一样的。FerretDB 可以为使用 MongoDB 驱动的应用程序提供一个丝滑迁移到 PostgreSQL 的过渡方案。</p><hr><h2 id=pigsty-对-ferretdb-的支持历史>Pigsty 对 FerretDB 的支持历史？</h2><p>Pigsty 从 1.x 开始就提供了基于 Docker 的 FerretDB 模板，在 v2.3 中提供了原生部署支持。
它作为一个选装项，对丰富 PostgreSQL 生态大有裨益。Pigsty 社区已经与 FerretDB 社区成为了合作伙伴，后续将进行深度的合作与适配支持。</p><p><strong>FERRET</strong> 是 Pigsty 中的一个 <strong>可选</strong> 模块。自 v2.0 以来，它需要 <a href=https://pgext.cloud/e/documentdb><code>documentdb</code></a> 扩展才能工作。
Pigsty 已经打包了这个扩展，并提供了一个 <a href=https://github.com/pgsty/pigsty/blob/v4.1.0/conf/mongo.yml><code>mongo.yml</code></a> 模板，帮助您轻松部署 FerretDB 集群。</p><hr><h2 id=安装-mongosh>安装 MongoSH</h2><p>您可以使用 <a href=https://www.mongodb.com/docs/mongodb-shell/>MongoSH</a> 作为客户端工具访问 FerretDB 集群。</p><p>推荐使用 <code>pig</code> 命令添加 MongoDB 仓库并安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add mongo -u   <span style=color:#8f5902;font-style:italic># 添加 MongoDB 官方仓库</span>
</span></span><span style=display:flex><span>yum install mongodb-mongosh   <span style=color:#8f5902;font-style:italic># RHEL/CentOS/Rocky/Alma</span>
</span></span><span style=display:flex><span>apt install mongodb-mongosh   <span style=color:#8f5902;font-style:italic># Debian/Ubuntu</span>
</span></span></code></pre></div><p>您也可以手动添加 MongoDB 仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># RHEL/CentOS 系</span>
</span></span><span style=display:flex><span>cat &gt; /etc/yum.repos.d/mongo.repo <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[mongodb-org-7.0]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>name=MongoDB Repository
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>baseurl=https://repo.mongodb.org/yum/redhat/\$releasever/mongodb-org/7.0/\$basearch/
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>gpgkey=https://www.mongodb.org/static/pgp/server-7.0.asc
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>yum install -y mongodb-mongosh
</span></span></code></pre></div><hr><h2 id=认证方式>认证方式</h2><p>FerretDB 的身份验证完全基于底层 PostgreSQL。Pigsty 管理的 PostgreSQL 集群默认使用 <code>scram-sha-256</code>，FerretDB 2.x 对应使用 <code>SCRAM-SHA-256</code>。通常客户端会自动协商，如遇认证协商失败可显式指定机制：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://user:password@host:27017&#39;</span>
</span></span><span style=display:flex><span>mongosh <span style=color:#4e9a06>&#39;mongodb://user:password@host:27017/?authMechanism=SCRAM-SHA-256&#39;</span>
</span></span></code></pre></div><hr><h2 id=与-mongodb-的兼容性>与 MongoDB 的兼容性</h2><p>FerretDB 实现了 MongoDB 的线协议，但底层使用 PostgreSQL 存储。这意味着：</p><ul><li>大多数基本的 CRUD 操作与 MongoDB 兼容</li><li>某些高级功能可能不支持或有差异</li><li>聚合管道支持有限</li></ul><p>详细的兼容性信息请参阅：</p><ul><li><a href=https://docs.ferretdb.io/reference/supported-commands/>FerretDB 支持的命令</a></li><li><a href=https://docs.ferretdb.io/diff/>与 MongoDB 的差异</a></li></ul><hr><h2 id=为什么需要超级用户>为什么需要超级用户</h2><p>FerretDB 2.0+ 使用 <code>documentdb</code> 扩展，该扩展需要超级用户权限来创建和管理内部结构。因此，在 <a href=/docs/ferret/param#mongo_pgurl><code>mongo_pgurl</code></a> 中指定的用户必须是 PostgreSQL 超级用户。</p><p>建议创建一个专用的 <code>mongod</code> 超级用户供 FerretDB 使用，而不是使用默认的 <code>postgres</code> 用户。</p><hr><h2 id=如何实现高可用>如何实现高可用</h2><p>FerretDB 本身是无状态的，所有数据都存储在底层的 PostgreSQL 中。要实现高可用：</p><ol><li><strong>PostgreSQL 层</strong>：使用 Pigsty 的 PGSQL 模块部署高可用 PostgreSQL 集群</li><li><strong>FerretDB 层</strong>：部署多个 FerretDB 实例，使用 VIP 或负载均衡器</li></ol><p>详细配置请参阅 <a href=/docs/ferret/config#%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7>高可用配置</a>。</p><hr><h2 id=性能如何>性能如何</h2><p>FerretDB 的性能取决于底层的 PostgreSQL 集群。由于需要将 MongoDB 命令翻译为 SQL，会有一定的性能开销。对于大多数 OLTP 场景，性能是可接受的。</p><p>如果您需要更高的性能，可以：</p><ul><li>使用更快的存储（NVMe SSD）</li><li>增加 PostgreSQL 的资源配置</li><li>优化 PostgreSQL 参数</li><li>使用连接池减少连接开销</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>