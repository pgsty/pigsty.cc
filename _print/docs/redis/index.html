<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/redis/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/redis/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>模块：REDIS | PIGSTY</title><meta name=description content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"><meta property="og:url" content="https://pigsty.cc/docs/redis/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="模块：REDIS"><meta property="og:description" content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="模块：REDIS"><meta itemprop=description content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"><meta itemprop=dateModified content="2026-02-05T14:43:56+08:00"><meta itemprop=wordCount content="7"><meta itemprop=keywords content="参考,REDIS"><meta name=twitter:card content="summary"><meta name=twitter:title content="模块：REDIS"><meta name=twitter:description content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/redis/>返回本页常规视图</a>.</p></div><h1 class=title>模块：REDIS</h1><div class=lead>Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。</div><ul><li>1: <a href=#pg-fc15b08dead0af0ef0581be1e78f1089>集群配置</a></li><li>2: <a href=#pg-107d691b6855a16e3959ebbb20893769>参数列表</a></li><li>3: <a href=#pg-a4ac99db4d7e939afec8be333eb8e254>预置剧本</a></li><li>4: <a href=#pg-d30f775631874dbea209c56a3cf88d88>管理预案</a></li><li>5: <a href=#pg-81482490a3974d936d1dca668f5c2d09>监控告警</a></li><li>6: <a href=#pg-5bcac294a078899a139a79dc1fb2b009>指标列表</a></li><li>7: <a href=#pg-b2e89e0d2e5fa7361edacff6f86e00ea>常见问题</a></li></ul><div class=content><p>Redis 是广为流行的开源“高性能”内存数据结构服务器，PostgreSQL 的好搭子。
Pigsty 中的 Redis 是一套生产就绪的完整解决方案，支持主从复制、哨兵高可用与原生集群模式，集成了监控与日志功能，并提供自动化的安装、配置与运维管理剧本。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-fc15b08dead0af0ef0581be1e78f1089>1 - 集群配置</h1><div class=lead>根据需求场景选择合适的 Redis 模式，并通过配置清单表达您的需求</div><hr><h2 id=概念>概念</h2><p>Redis的实体概念模型与 <a href=/docs/concept/model/pgsql#%E5%85%B7%E4%BD%93%E6%A0%B7%E4%BE%8B>PostgreSQL</a> 几乎相同，同样包括 <strong>集群（Cluster）</strong> 与 <strong>实例（Instance）</strong> 的概念。注意这里的Cluster指的不是Redis原生集群方案中的集群。</p><p>REDIS模块与PGSQL模块核心的区别在于，Redis通常采用 <strong>单机多实例</strong> 部署，而不是 PostgreSQL 的 1:1 部署：一个物理/虚拟机节点上通常会部署 <strong>多个</strong> Redis实例，以充分利用多核CPU。因此 <a href=/docs/redis/config/>配置</a> 和 <a href=/docs/redis/admin/>管理</a> Redis实例的方式与PGSQL稍有不同。</p><p>在Pigsty管理的Redis中，节点完全隶属于集群，即目前尚不允许在一个节点上部署两个不同集群的Redis实例，但这并不影响您在一个节点上部署多个独立 Redis 主从实例。当然这样也会有一些局限性，例如在这种情况下您就无法为同一个节点上的不同实例指定不同的密码了。</p><hr><h2 id=身份参数>身份参数</h2><p>Redis <a href=/docs/redis/config#%E8%BA%AB%E4%BB%BD%E5%8F%82%E6%95%B0><strong>身份参数</strong></a> 是定义Redis集群时必须提供的信息，包括：</p><table class=full-width><thead><tr><th style=text-align:center>名称</th><th style=text-align:center>属性</th><th style=text-align:center>说明</th><th style=text-align:center>例子</th></tr></thead><tbody><tr><td style=text-align:center><a href=/docs/redis/param#redis_cluster><code>redis_cluster</code></a></td><td style=text-align:center><strong>必选</strong>，集群级别</td><td style=text-align:center>集群名</td><td style=text-align:center><code>redis-test</code></td></tr><tr><td style=text-align:center><a href=/docs/redis/param#redis_node><code>redis_node</code></a></td><td style=text-align:center><strong>必选</strong>，节点级别</td><td style=text-align:center>节点号</td><td style=text-align:center><code>1</code>,<code>2</code></td></tr><tr><td style=text-align:center><a href=/docs/redis/param#redis_instances><code>redis_instances</code></a></td><td style=text-align:center><strong>必选</strong>，节点级别</td><td style=text-align:center>实例定义</td><td style=text-align:center><code>{ 6001 : {} ,6002 : {}}</code></td></tr></tbody></table><ul><li><a href=/docs/redis/param#redis_cluster><code>redis_cluster</code></a>：Redis集群名称，作为集群资源的顶层命名空间。</li><li><a href=/docs/redis/param#redis_node><code>redis_node</code></a>：Redis节点标号，整数，在集群内唯一，用于区分不同节点。</li><li><a href=/docs/redis/param#redis_instances><code>redis_instances</code></a>：JSON对象，Key为实例端口号，Value为包含实例其他配置JSON对象。</li></ul><hr><h2 id=工作模式>工作模式</h2><p>Redis有三种不同的工作模式，由 <a href=/docs/redis/param#redis_mode><code>redis_mode</code></a> 参数指定：</p><ul><li><code>standalone</code>：默认的独立主从模式</li><li><code>cluster</code>：Redis原生分布式集群模式</li><li><code>sentinel</code>：哨兵模式，可以为主从模式的 Redis 提供高可用能力</li></ul><p>下面给出了三种Redis集群的定义样例：</p><ul><li>一个1节点，一主一从的 Redis Standalone 集群：<code>redis-ms</code></li><li>一个1节点，3实例的Redis Sentinel集群：<code>redis-sentinel</code></li><li>一个2节点，6实例的 Redis Cluster集群： <code>redis-cluster</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-ms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># redis 经典主从集群</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_cluster: redis-ms ,redis_password: &#39;redis.ms&#39; ,redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>64MB }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># redis 哨兵 x 3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>26379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,26380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,26381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;redis.meta&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sentinel</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># primary list for redis sentinel, use cls as name, primary ip:port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-ms, host: 10.10.10.10, port: 6379 ,password: redis.ms, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># redis 原生集群： 3主 x 3从</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 ,redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 ,redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_cluster: redis-test ,redis_password: &#39;redis.test&#39; ,redis_mode: cluster, redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>32MB }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=局限性>局限性</h2><ul><li>一个节点只能属于一个 Redis 集群，这意味着您不能将一个节点同时分配给两个不同的Redis集群。</li><li>在每个 Redis 节点上，您需要为 Redis实例 分配唯一的端口号，避免端口冲突。</li><li>通常同一个 Reids 集群会使用同一个密码，但一个 Redis节点上的多个 Redis 实例无法设置不同的密码（因为 redis_exporter 只允许使用一个密码）</li><li>Redis Cluster自带高可用，而Redis主从的高可用需要在 Sentinel 中额外进行手工配置：因为我们不知道您是否会部署 Sentinel。</li><li>好在配置 Redis 主从实例的高可用非常简单，可以通过Sentinel进行配置，详情请参考 <a href=/docs/redis/admin#%E8%AE%BE%E7%BD%AEredis%E4%B8%BB%E4%BB%8E%E9%AB%98%E5%8F%AF%E7%94%A8>管理-设置Redis主从高可用</a></li></ul><hr><h2 id=典型配置示例>典型配置示例</h2><p>以下是一些常见场景的 Redis 配置示例：</p><h3 id=缓存集群纯内存>缓存集群（纯内存）</h3><p>适用于对数据持久性要求不高的纯缓存场景：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-cache</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;cache.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>2GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mem_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allkeys-lru   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 内存满时淘汰最近最少使用的Key</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 禁用 RDB 持久化</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 禁用 AOF 持久化</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=session-存储集群>Session 存储集群</h3><p>适用于 Web 应用 Session 存储，需要一定的持久性：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-session</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-session</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;session.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mem_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>volatile-lru  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 只淘汰设置了过期时间的Key</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;300 1&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 5分钟至少1个变更时保存</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=消息队列集群>消息队列集群</h3><p>适用于简单的消息队列场景，需要较高的数据可靠性：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-queue</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-queue</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;queue.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>4GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mem_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>noeviction    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 内存满时拒绝写入，不淘汰数据</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;60 1&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 1分钟至少1个变更时保存</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># 启用 AOF 获得更好的持久性</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=高可用主从集群>高可用主从集群</h3><p>带有 Sentinel 自动故障转移的主从集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 主从集群</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-ha</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>                              </span><span style=color:#8f5902;font-style:italic># 主库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 从库1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 3 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 从库2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-ha</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ha.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>8GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 哨兵集群（管理上述主从集群）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-sentinel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>26379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>26379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 3 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>26379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-sentinel</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;sentinel.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sentinel</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>64MB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-ha, host: 10.10.10.10, port: 6379, password: &#39;ha.password&#39;, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=大容量原生集群>大容量原生集群</h3><p>适用于大数据量、高吞吐场景的原生分布式集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 3 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 4 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;cluster.password&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster_replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 每个主分片1个从库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>16GB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每个实例最大内存</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;900 1&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 这将创建一个 6主6从 的原生集群</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 总容量约 96GB (6 * 16GB)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=安全加固配置>安全加固配置</h3><p>生产环境推荐的安全配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-secure</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis-secure</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;StrongP@ssw0rd!&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 使用强密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_bind_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 绑定到内网IP而非 0.0.0.0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>4GB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rename_commands</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 重命名危险命令</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>FLUSHDB</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;DANGEROUS_FLUSHDB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>FLUSHALL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;DANGEROUS_FLUSHALL&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DEBUG</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># 禁用命令</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>CONFIG</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ADMIN_CONFIG&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-107d691b6855a16e3959ebbb20893769>2 - 参数列表</h1><div class=lead>REDIS 模块提供了 18 个部署参数 + 3 个移除参数</div><p>REDIS 模块的参数列表，共有 <strong>21</strong> 个参数，分为两个部分：</p><ul><li><a href=#redis><strong><code>REDIS</code></strong></a>：18 个参数，用于 Redis 集群的部署与配置</li><li><a href=#redis_remove><strong><code>REDIS_REMOVE</code></strong></a>：3 个参数，控制 Redis 集群的移除</li></ul><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>架构变化：Pigsty v3.6+</div><p>自 Pigsty v3.6 起，<code>redis.yml</code> 剧本不再包含移除功能，移除相关参数已迁移至独立的 <code>redis_remove</code> 角色和 <code>redis-rm.yml</code> 剧本。</p></div><hr><h2 id=参数概览>参数概览</h2><p><a href=#redis><code>REDIS</code></a> 参数组用于 Redis 集群的部署与配置，包括身份标识、实例定义、工作模式、内存配置、持久化以及监控。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#redis_cluster><code>redis_cluster</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis数据库集群名称，必选身份参数</td></tr><tr><td style=text-align:left><a href=#redis_instances><code>redis_instances</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>Redis节点上的实例定义</td></tr><tr><td style=text-align:left><a href=#redis_node><code>redis_node</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>Redis节点编号，正整数，集群内唯一，必选身份参数</td></tr><tr><td style=text-align:left><a href=#redis_fs_main><code>redis_fs_main</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis主数据目录，默认为 <code>/data</code></td></tr><tr><td style=text-align:left><a href=#redis_exporter_enabled><code>redis_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis Exporter 是否启用？</td></tr><tr><td style=text-align:left><a href=#redis_exporter_port><code>redis_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis Exporter监听端口</td></tr><tr><td style=text-align:left><a href=#redis_exporter_options><code>redis_exporter_options</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C/I</code></td><td style=text-align:left>Redis Exporter命令参数</td></tr><tr><td style=text-align:left><a href=#redis_mode><code>redis_mode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis集群模式：sentinel，cluster，standalone</td></tr><tr><td style=text-align:left><a href=#redis_conf><code>redis_conf</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis配置文件模板，sentinel 除外</td></tr><tr><td style=text-align:left><a href=#redis_bind_address><code>redis_bind_address</code></a></td><td style=text-align:center><code>ip</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis监听地址，默认值 <code>0.0.0.0</code>，留空则绑定主机IP</td></tr><tr><td style=text-align:left><a href=#redis_max_memory><code>redis_max_memory</code></a></td><td style=text-align:center><code>size</code></td><td style=text-align:center><code>C/I</code></td><td style=text-align:left>Redis可用的最大内存</td></tr><tr><td style=text-align:left><a href=#redis_mem_policy><code>redis_mem_policy</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis内存逐出策略</td></tr><tr><td style=text-align:left><a href=#redis_password><code>redis_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis密码，默认留空则禁用密码</td></tr><tr><td style=text-align:left><a href=#redis_rdb_save><code>redis_rdb_save</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis RDB 保存指令，字符串列表，空数组则禁用RDB</td></tr><tr><td style=text-align:left><a href=#redis_aof_enabled><code>redis_aof_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis AOF 是否启用？</td></tr><tr><td style=text-align:left><a href=#redis_rename_commands><code>redis_rename_commands</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis危险命令重命名列表</td></tr><tr><td style=text-align:left><a href=#redis_cluster_replicas><code>redis_cluster_replicas</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis原生集群中每个主库配几个从库？</td></tr><tr><td style=text-align:left><a href=#redis_sentinel_monitor><code>redis_sentinel_monitor</code></a></td><td style=text-align:center><code>master[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>Redis哨兵监控的主库列表，只在哨兵集群上使用</td></tr></tbody></table><p><a href=#redis_remove><code>REDIS_REMOVE</code></a> 参数组控制 Redis 集群的移除行为，包括防误删保险、数据清理以及软件包卸载。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#redis_safeguard><code>redis_safeguard</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>禁止移除正在运行的Redis实例</td></tr><tr><td style=text-align:left><a href=#redis_rm_data><code>redis_rm_data</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>移除Redis实例时是否一并移除数据目录？</td></tr><tr><td style=text-align:left><a href=#redis_rm_pkg><code>redis_rm_pkg</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>移除Redis实例时是否卸载Redis软件包？</td></tr></tbody></table><hr><h2 id=默认参数>默认参数</h2><p><code>REDIS</code>：18 个参数，定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis/defaults/main.yml><code>roles/redis/defaults/main.yml</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># REDIS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#redis_cluster:             &lt;集群&gt; # Redis数据库集群名称，必选身份参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#redis_node: 1              &lt;节点&gt; # Redis节点编号，正整数，集群内唯一，必选身份参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#redis_instances: {}        &lt;节点&gt; # Redis节点上的实例定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_fs_main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Redis主数据目录，默认为 `/data`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Redis Exporter 是否启用？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9121</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Redis Exporter监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_exporter_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Redis Exporter命令参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>standalone           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Redis集群模式：sentinel，cluster，standalone</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis.conf           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Redis配置文件模板，sentinel 除外</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_bind_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.0.0.0&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Redis监听地址，默认 `0.0.0.0`，留空则会绑定主机IP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1GB            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Redis可用的最大内存</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_mem_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allkeys-lru    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Redis内存逐出策略</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Redis密码，默认留空则禁用密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;1200 1&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Redis RDB 保存指令，字符串列表，空数组则禁用RDB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Redis AOF 是否启用？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_rename_commands</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Redis危险命令重命名列表</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_cluster_replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Redis原生集群中每个主库配几个从库？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Redis哨兵监控的主库列表，仅用于哨兵集群</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>REDIS_REMOVE</code>：3 个参数，定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis_remove/defaults/main.yml><code>roles/redis_remove/defaults/main.yml</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># REDIS_REMOVE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 禁止移除正在运行的Redis实例</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_rm_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 移除Redis实例时是否一并移除数据目录？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_rm_pkg</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 移除Redis实例时是否卸载Redis软件包？</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=redis><code>REDIS</code></h2><p>本节包含 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis/defaults/main.yml><code>redis</code></a> 角色的参数，
这些是 <a href=/docs/redis/playbook#redisyml><code>redis.yml</code></a> 剧本使用的操作标志参数。</p><h3 id=redis_cluster><code>redis_cluster</code></h3><p>参数名称： <code>redis_cluster</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>身份参数，必选参数，必须显式在集群层面配置，将用作集群内资源的命名空间。</p><p>需要遵循特定命名规则：<code>[a-z][a-z0-9-]*</code>，以兼容不同约束对身份标识的要求，建议使用<code>redis-</code>作为集群名前缀。</p><h3 id=redis_node><code>redis_node</code></h3><p>参数名称： <code>redis_node</code>， 类型： <code>int</code>， 层次：<code>I</code></p><p>Redis节点序列号，身份参数，必选参数，必须显式在节点（Host）层面配置。</p><p>自然数，在集群中应当是唯一的，用于区别与标识集群内的不同节点，从0或1开始分配。</p><h3 id=redis_instances><code>redis_instances</code></h3><p>参数名称： <code>redis_instances</code>， 类型： <code>dict</code>， 层次：<code>I</code></p><p>当前 Redis 节点上的 Redis 实例定义，必选参数，必须显式在节点（Host）层面配置。</p><p>内容为JSON KV对象格式。Key为数值类型端口号，Value为该实例特定的JSON配置项。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-test: # redis native cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>3m x 3s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 ,redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 ,redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>} ,6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_cluster: redis-test ,redis_password: &#39;redis.test&#39; ,redis_mode: cluster, redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>32MB }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>每一个Redis实例在对应节点上监听一个唯一端口，实例配置项中<code>replica_of</code> 用于设置一个实例的上游主库地址，构建主从复制关系。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.13 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>6381</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.13 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=redis_fs_main><code>redis_fs_main</code></h3><p>参数名称： <code>redis_fs_main</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>Redis使用的主数据盘挂载点，默认为<code>/data</code>，Pigsty会在该目录下创建<code>redis</code>目录，用于存放Redis数据。</p><p>所以实际存储数据的目录为 <code>/data/redis</code>，该目录的属主为操作系统用户 <code>redis</code>，内部结构详情请参考 <a href=/docs/ref/fhs#redis-fhs>FHS：Redis</a></p><h3 id=redis_exporter_enabled><code>redis_exporter_enabled</code></h3><p>参数名称： <code>redis_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否启用Redis监控组件 Redis Exporter？</p><p>默认启用，在每个Redis节点上部署一个，默认监听 <a href=#redis_exporter_port><code>redis_exporter_port</code></a> <code>9121</code> 端口。所有本节点上 Redis 实例的监控指标都由它负责抓取。</p><p>将此参数设为 <code>false</code> 时，<code>roles/redis/tasks/exporter.yml</code> 仍会渲染配置文件，但会跳过 <code>redis_exporter</code> systemd 服务的启动步骤（<code>redis_exporter_launch</code> 任务带有 <code>when: redis_exporter_enabled|bool</code> 判断），可用于在节点上保留手工配置的 exporter。</p><h3 id=redis_exporter_port><code>redis_exporter_port</code></h3><p>参数名称： <code>redis_exporter_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>Redis Exporter监听端口，默认值为：<code>9121</code></p><h3 id=redis_exporter_options><code>redis_exporter_options</code></h3><p>参数名称： <code>redis_exporter_options</code>， 类型： <code>string</code>， 层次：<code>C/I</code></p><p>传给 Redis Exporter 的额外命令行参数，会被渲染到 <code>/etc/default/redis_exporter</code> 中（参见 <code>roles/redis/tasks/exporter.yml</code>），默认为空字符串。<code>REDIS_EXPORTER_OPTS</code> 最终会附加到 systemd 服务的 <code>ExecStart=/bin/redis_exporter $REDIS_EXPORTER_OPTS</code>，可用于配置额外的抓取目标或过滤行为。</p><h3 id=redis_mode><code>redis_mode</code></h3><p>参数名称： <code>redis_mode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Redis集群的工作模式，有三种选项：<code>standalone</code>, <code>cluster</code>, <code>sentinel</code>，默认值为 <code>standalone</code></p><ul><li><code>standalone</code>：默认，独立的Redis主从模式</li><li><code>cluster</code>： Redis原生集群模式</li><li><code>sentinel</code>：Redis高可用组件：哨兵</li></ul><p>当使用<code>standalone</code>模式时，Pigsty会根据 <code>replica_of</code> 参数设置Redis主从复制关系。</p><p>当使用<code>cluster</code>模式时，Pigsty会根据 <a href=#redis_cluster_replicas><code>redis_cluster_replicas</code></a> 参数使用所有定义的实例创建原生Redis集群。</p><p>当 <code>redis_mode=sentinel</code> 时，<code>redis.yml</code> 会执行 <code>redis-ha</code> 阶段（<code>redis.yml</code> 第 80<del>130 行）将 <a href=#redis_sentinel_monitor><code>redis_sentinel_monitor</code></a> 中的目标批量下发到所有哨兵；当 <code>redis_mode=cluster</code> 时还会执行 <code>redis-join</code> 阶段（<code>redis.yml</code> 第 134</del>180 行）调用 <code>redis-cli --cluster create --cluster-yes ... --cluster-replicas {{ redis_cluster_replicas }}</code>。这两个阶段均在普通 <code>./redis.yml -l &lt;cluster></code> 中自动触发，也可以通过 <code>-t redis-ha</code> 或 <code>-t redis-join</code> 单独运行。</p><h3 id=redis_conf><code>redis_conf</code></h3><p>参数名称： <code>redis_conf</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>Redis 配置模板路径，Sentinel除外。</p><p>默认值：<code>redis.conf</code>，这是一个模板文件，位于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis/templates/redis.conf><code>roles/redis/templates/redis.conf</code></a>。</p><p>如果你想使用自己的 Redis 配置模板，你可以将它放在 <code>templates/</code> 目录中，并设置此参数为模板文件名。</p><p>注意： Redis Sentinel 使用的是另一个不同的模板文件，即 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis/templates/redis-sentinel.conf><code>roles/redis/templates/redis-sentinel.conf</code></a>。</p><h3 id=redis_bind_address><code>redis_bind_address</code></h3><p>参数名称： <code>redis_bind_address</code>， 类型： <code>ip</code>， 层次：<code>C</code></p><p>Redis服务器绑定的IP地址，空字符串将使用配置清单中定义的主机名。</p><p>默认值：<code>0.0.0.0</code>，这将绑定到此主机上的所有可用 IPv4 地址。</p><p>在生产环境中出于安全性考虑，建议仅绑定内网 IP，即将此值设置为空字符串 <code>''</code></p><p>当该值为空字符串时，模板 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis/templates/redis.conf><code>roles/redis/templates/redis.conf</code></a>
会使用 <code>inventory_hostname</code> 渲染 <code>bind &lt;ip></code>，从而绑定到清单中声明的管理地址。</p><h3 id=redis_max_memory><code>redis_max_memory</code></h3><p>参数名称： <code>redis_max_memory</code>， 类型： <code>size</code>， 层次：<code>C/I</code></p><p>每个 Redis 实例使用的最大内存配置，默认值：<code>1GB</code>。</p><h3 id=redis_mem_policy><code>redis_mem_policy</code></h3><p>参数名称： <code>redis_mem_policy</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Redis 内存回收策略，默认值：<code>allkeys-lru</code>，</p><ul><li><code>noeviction</code>：内存达限时不保存新值：当使用主从复制时仅适用于主库</li><li><code>allkeys-lru</code>：保持最近使用的键；删除最近最少使用的键（LRU）</li><li><code>allkeys-lfu</code>：保持频繁使用的键；删除最少频繁使用的键（LFU）</li><li><code>volatile-lru</code>：删除带有真实过期字段的最近最少使用的键</li><li><code>volatile-lfu</code>：删除带有真实过期字段的最少频繁使用的键</li><li><code>allkeys-random</code>：随机删除键以为新添加的数据腾出空间</li><li><code>volatile-random</code>：随机删除带有过期字段的键</li><li><code>volatile-ttl</code>：删除带有真实过期字段和最短剩余生存时间（TTL）值的键。</li></ul><p>详情请参阅 <a href=https://redis.io/docs/ref/eviction/>Redis内存回收策略</a>。</p><h3 id=redis_password><code>redis_password</code></h3><p>参数名称： <code>redis_password</code>， 类型： <code>password</code>， 层次：<code>C/N</code></p><p>Redis 密码，空字符串将禁用密码，这是默认行为。</p><p>注意，由于 redis_exporter 的实现限制，您每个节点只能设置一个 <code>redis_password</code>。这通常不是问题，因为 pigsty 不允许在同一节点上部署两个不同的 Redis 集群。</p><p>Pigsty 会自动将此密码写入 <code>/etc/default/redis_exporter</code>（<code>REDIS_PASSWORD=...</code>）并在 <code>redis-ha</code> 阶段用于 <code>redis-cli -a &lt;password></code>，因此无需重复配置 exporter 或 Sentinel 的认证口令。</p><blockquote><p>请在生产环境中使用强密码</p></blockquote><h3 id=redis_rdb_save><code>redis_rdb_save</code></h3><p>参数名称： <code>redis_rdb_save</code>， 类型： <code>string[]</code>， 层次：<code>C</code></p><p>Redis RDB 保存指令，使用空列表则禁用 RDB。</p><p>默认值是 <code>["1200 1"]</code>：如果最近20分钟至少有1个键更改，则将数据集转储到磁盘。</p><p>详情请参考 <a href=https://redis.io/docs/management/persistence/>Redis持久化</a>。</p><h3 id=redis_aof_enabled><code>redis_aof_enabled</code></h3><p>参数名称： <code>redis_aof_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>启用 Redis AOF 吗？默认值是 <code>false</code>，即不使用 AOF。</p><h3 id=redis_rename_commands><code>redis_rename_commands</code></h3><p>参数名称： <code>redis_rename_commands</code>， 类型： <code>dict</code>， 层次：<code>C</code></p><p>重命名 Redis 危险命令，这是一个 k:v 字典：<code>old: new</code>，old是待重命名的命令名称，new是重命名后的名字。</p><p>默认值：<code>{}</code>，你可以通过设置此值来隐藏像 <code>FLUSHDB</code> 和 <code>FLUSHALL</code> 这样的危险命令，下面是一个例子：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>&#34;keys&#34;: </span><span style=color:#4e9a06>&#34;op_keys&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>&#34;flushdb&#34;: </span><span style=color:#4e9a06>&#34;op_flushdb&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>&#34;flushall&#34;: </span><span style=color:#4e9a06>&#34;op_flushall&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>&#34;config&#34;: </span><span style=color:#4e9a06>&#34;op_config&#34;</span><span style=color:#f8f8f8>  
</span></span></span><span style=display:flex><span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=redis_cluster_replicas><code>redis_cluster_replicas</code></h3><p>参数名称： <code>redis_cluster_replicas</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>在 Redis 原生集群中，应当为一个 Master/Primary 实例配置多少个从库？默认值为： <code>1</code>，即每个主库配一个从库。</p><h3 id=redis_sentinel_monitor><code>redis_sentinel_monitor</code></h3><p>参数名称： <code>redis_sentinel_monitor</code>， 类型： <code>master[]</code>， 层次：<code>C</code></p><p>Redis哨兵监控的主库列表，只在哨兵集群上使用。每个待纳管的主库定义方式如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># primary list for redis sentinel, use cls as name, primary ip:port</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-src, host: 10.10.10.45, port: 6379 ,password: redis.src, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-dst, host: 10.10.10.48, port: 6379 ,password: redis.dst, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>其中，<code>name</code>，<code>host</code> 是必选参数，<code>port</code>，<code>password</code>，<code>quorum</code> 是可选参数，<code>quorum</code> 用于设置判定主库失效所需的法定人数数，通常大于哨兵实例数的一半（默认为1）。</p><p>从 Pigsty 4.0 开始还可以为某个条目添加 <code>remove: true</code>，此时 <code>redis-ha</code> 阶段只会执行 <code>SENTINEL REMOVE &lt;name></code>，用于清理不再需要的目标。</p><hr><h2 id=redis_remove><code>REDIS_REMOVE</code></h2><p>本节包含 <a href=https://github.com/pgsty/pigsty/blob/main/roles/redis_remove/defaults/main.yml><code>redis_remove</code></a> 角色的参数，
这些是 <a href=/docs/redis/playbook#redis-rmyml><code>redis-rm.yml</code></a> 剧本使用的操作标志参数。</p><h3 id=redis_safeguard><code>redis_safeguard</code></h3><p>参数名称： <code>redis_safeguard</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>Redis 的防误删安全保险开关：打开后 <code>redis-rm.yml</code> 剧本无法移除正在运行的 Redis 实例。</p><p>默认值为 <code>false</code>，如果设置为 <code>true</code>，那么 <code>redis-rm.yml</code> 剧本会拒绝执行，防止误删正在运行的 Redis 实例。</p><p>可以通过命令行参数 <code>-e redis_safeguard=false</code> 强制覆盖此保护。</p><h3 id=redis_rm_data><code>redis_rm_data</code></h3><p>参数名称： <code>redis_rm_data</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>移除 Redis 实例时，是否一并移除 Redis 数据目录？默认为 <code>true</code>。</p><p>数据目录（<code>/data/redis/</code>）包含了 Redis 的 RDB 与 AOF 文件，如果不移除它们，那么新部署的 Redis 实例将会从这些备份文件中加载数据。</p><p>设置为 <code>false</code> 可以保留数据目录用于后续恢复。</p><h3 id=redis_rm_pkg><code>redis_rm_pkg</code></h3><p>参数名称： <code>redis_rm_pkg</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>移除 Redis 实例时，是否一并卸载 Redis 与 redis_exporter 软件包？默认为 <code>false</code>。</p><p>通常情况下不需要卸载软件包，仅当需要彻底清理节点时才需要启用此选项。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a4ac99db4d7e939afec8be333eb8e254>3 - 预置剧本</h1><div class=lead>如何使用预置的 ansible 剧本来管理 Redis 集群，常用管理命令速查。</div><p>REDIS模块提供了两个剧本，用于部署/移除 Redis 集群/节点/实例：</p><ul><li><a href=#redisyml><code>redis.yml</code></a>：部署 Redis 集群/节点/实例</li><li><a href=#redis-rmyml><code>redis-rm.yml</code></a>：移除 Redis 集群/节点/实例</li></ul><hr><h2 id=redisyml><code>redis.yml</code></h2><p>用于部署 Redis 的 <a href=https://github.com/pgsty/pigsty/blob/main/redis.yml><code>redis.yml</code></a> 剧本包含以下子任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>redis_node        : 初始化redis节点
</span></span><span style=display:flex><span>  - redis_install : 安装redis <span style=color:#000;font-weight:700>&amp;</span> redis_exporter
</span></span><span style=display:flex><span>  - redis_user    : 创建操作系统用户 redis
</span></span><span style=display:flex><span>  - redis_dir     : 配置 redis的FHS目录结构
</span></span><span style=display:flex><span>redis_exporter    : 配置 redis_exporter 监控
</span></span><span style=display:flex><span>  - redis_exporter_config  : 生成redis_exporter配置
</span></span><span style=display:flex><span>  - redis_exporter_launch  : 启动redis_exporter
</span></span><span style=display:flex><span>redis_instance    : 初始化并重启redis集群/节点/实例
</span></span><span style=display:flex><span>  - redis_config  : 生成redis实例配置
</span></span><span style=display:flex><span>  - redis_launch  : 启动redis实例
</span></span><span style=display:flex><span>redis_register    : 将redis注册到基础设施中
</span></span><span style=display:flex><span>redis_ha          : 配置redis哨兵（仅sentinel模式）
</span></span><span style=display:flex><span>redis_join        : 组建redis原生集群（仅cluster模式）
</span></span></code></pre></div><h3 id=操作级别>操作级别</h3><p><code>redis.yml</code> 支持三种操作级别，通过 <code>-l</code> 限制目标范围，通过 <code>-e redis_port=&lt;port></code> 指定单个实例：</p><table class=full-width><thead><tr><th style=text-align:left>操作级别</th><th style=text-align:left>限制参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>集群</strong></td><td style=text-align:left><code>-l &lt;cluster></code></td><td style=text-align:left>部署整个 Redis 集群的所有节点和实例</td></tr><tr><td style=text-align:left><strong>节点</strong></td><td style=text-align:left><code>-l &lt;ip></code></td><td style=text-align:left>部署指定节点上的所有 Redis 实例</td></tr><tr><td style=text-align:left><strong>实例</strong></td><td style=text-align:left><code>-l &lt;ip> -e redis_port=&lt;port></code></td><td style=text-align:left>仅部署指定节点上的单个实例</td></tr></tbody></table><h3 id=集群级别操作>集群级别操作</h3><p>部署整个 Redis 集群，包括所有节点上的所有实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l redis-ms           <span style=color:#8f5902;font-style:italic># 部署名为 redis-ms 的整个集群</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-test         <span style=color:#8f5902;font-style:italic># 部署名为 redis-test 的整个集群</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-sentinel     <span style=color:#8f5902;font-style:italic># 部署哨兵集群</span>
</span></span></code></pre></div><p>集群级别操作会：</p><ul><li>在所有节点上安装 Redis 软件包</li><li>在所有节点上创建 redis 用户和目录结构</li><li>启动所有节点上的 redis_exporter</li><li>部署并启动所有定义的 Redis 实例</li><li>将所有实例注册到监控系统</li><li>如果是 <code>sentinel</code> 模式，配置哨兵监控目标</li><li>如果是 <code>cluster</code> 模式，组建原生集群</li></ul><h3 id=节点级别操作>节点级别操作</h3><p>仅部署指定节点上的所有 Redis 实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l 10.10.10.10        <span style=color:#8f5902;font-style:italic># 部署该节点上的所有实例</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.11        <span style=color:#8f5902;font-style:italic># 部署另一个节点</span>
</span></span></code></pre></div><p>节点级别操作适用于：</p><ul><li>向现有集群<strong>扩容新节点</strong></li><li>重新部署某个节点上的所有实例</li><li>节点故障恢复后重新初始化</li></ul><blockquote><p><strong>注意</strong>：节点级别命令仍会进入 <code>redis-ha</code> / <code>redis-join</code> 的模式判断：在 <code>sentinel</code> 模式下会刷新哨兵纳管目标，在 <code>cluster</code> 模式下可能再次触发 <code>--cluster create</code>（该步骤 <code>ignore_errors: true</code>，但并非幂等）。扩容原生集群时仍建议手工执行 <code>redis-cli --cluster add-node</code> 与 <code>reshard</code>。</p></blockquote><h3 id=实例级别操作>实例级别操作</h3><p>通过 <code>-e redis_port=&lt;port></code> 参数指定单个实例进行操作：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅部署 10.10.10.10 上的 6379 端口实例</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.10 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅部署 10.10.10.11 上的 6380 端口实例</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.11 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6380</span>
</span></span></code></pre></div><p>实例级别操作适用于：</p><ul><li>向现有节点<strong>添加新实例</strong></li><li>重新部署单个故障实例</li><li>更新单个实例的配置</li></ul><p>当指定 <code>redis_port</code> 时：</p><ul><li>仅渲染该端口对应的配置文件</li><li>仅启动/重启该端口对应的 systemd 服务</li><li>会重写该节点的监控注册文件（内容来自 <code>redis_instances</code> 全量定义）</li><li><strong>不会</strong>启停 <code>redis_exporter</code> 或重载 Vector 日志配置</li><li><strong>不会</strong>影响同节点上的其他 Redis 实例进程</li></ul><h3 id=常用标签>常用标签</h3><p>可以通过 <code>-t &lt;tag></code> 参数选择性执行部分任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅安装软件包，不启动服务</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-ms -t redis_node
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅更新配置并重启实例</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-ms -t redis_config,redis_launch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅更新监控注册</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-ms -t redis_register
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅配置哨兵监控目标（sentinel模式）</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-sentinel -t redis-ha
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅组建原生集群（cluster模式，首次部署后自动执行）</span>
</span></span><span style=display:flex><span>./redis.yml -l redis-cluster -t redis-join
</span></span></code></pre></div><h3 id=幂等性说明>幂等性说明</h3><p><code>redis.yml</code> 的大部分任务可安全重复执行，但 <code>redis-join</code> 例外：</p><ul><li><code>redis_node</code> / <code>redis_exporter</code> / <code>redis_instance</code> / <code>redis_register</code> 重复执行会覆盖配置并重启实例</li><li><code>redis-ha</code> 重复执行会按 <code>redis_sentinel_monitor</code> 重新下发 <code>SENTINEL REMOVE/MONITOR</code></li><li><code>redis-join</code> 使用 <code>redis-cli --cluster create</code>，不是幂等操作；重复执行在已建集群上通常会报错（剧本当前为 <code>ignore_errors: true</code>）</li></ul><blockquote><p><strong>提示</strong>：如果只想更新配置而不想重启所有实例，可以使用 <code>-t redis_config</code> 仅渲染配置，然后手动重启需要的实例。</p></blockquote><hr><h2 id=redis-rmyml><code>redis-rm.yml</code></h2><p>用于移除 Redis 的 <a href=https://github.com/pgsty/pigsty/blob/main/redis-rm.yml><code>redis-rm.yml</code></a> 剧本包含以下子任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>redis_safeguard  : 安全检查，当 <span style=color:#000>redis_safeguard</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> 时拒绝执行
</span></span><span style=display:flex><span>redis_deregister : 从监控系统移除注册信息
</span></span><span style=display:flex><span>  - rm_metrics   : 删除 /infra/targets/redis/*.yml
</span></span><span style=display:flex><span>  - rm_logs      : 撤销 /etc/vector/redis.yaml
</span></span><span style=display:flex><span>redis_exporter   : 停止并禁用 redis_exporter
</span></span><span style=display:flex><span>redis            : 停止并禁用 redis 实例
</span></span><span style=display:flex><span>redis_data       : 删除数据目录（当 <span style=color:#000>redis_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span>true）
</span></span><span style=display:flex><span>redis_pkg        : 卸载软件包（当 <span style=color:#000>redis_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span>true）
</span></span></code></pre></div><h3 id=操作级别-1>操作级别</h3><p><code>redis-rm.yml</code> 同样支持三种操作级别：</p><table class=full-width><thead><tr><th style=text-align:left>操作级别</th><th style=text-align:left>限制参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>集群</strong></td><td style=text-align:left><code>-l &lt;cluster></code></td><td style=text-align:left>移除整个 Redis 集群的所有节点和实例</td></tr><tr><td style=text-align:left><strong>节点</strong></td><td style=text-align:left><code>-l &lt;ip></code></td><td style=text-align:left>移除指定节点上的所有 Redis 实例</td></tr><tr><td style=text-align:left><strong>实例</strong></td><td style=text-align:left><code>-l &lt;ip> -e redis_port=&lt;port></code></td><td style=text-align:left>仅移除指定节点上的单个实例</td></tr></tbody></table><h3 id=集群级别移除>集群级别移除</h3><p>移除整个 Redis 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis-rm.yml -l redis-ms        <span style=color:#8f5902;font-style:italic># 移除整个 redis-ms 集群</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-test      <span style=color:#8f5902;font-style:italic># 移除整个 redis-test 集群</span>
</span></span></code></pre></div><p>集群级别移除会：</p><ul><li>从监控系统注销所有节点的所有实例</li><li>停止所有节点上的 redis_exporter</li><li>停止并禁用所有 Redis 实例</li><li>删除所有数据目录（如果 <code>redis_rm_data=true</code>）</li><li>卸载软件包（如果 <code>redis_rm_pkg=true</code>）</li></ul><h3 id=节点级别移除>节点级别移除</h3><p>仅移除指定节点上的所有 Redis 实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis-rm.yml -l 10.10.10.10     <span style=color:#8f5902;font-style:italic># 移除该节点上的所有实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.11     <span style=color:#8f5902;font-style:italic># 移除另一个节点</span>
</span></span></code></pre></div><p>节点级别移除适用于：</p><ul><li>集群<strong>缩容</strong>，下线整个节点</li><li>节点退役前的清理</li><li>节点迁移前的准备</li></ul><p>节点级别移除会：</p><ul><li>从监控系统注销该节点的所有实例</li><li>停止该节点上的 redis_exporter</li><li>停止该节点上的所有 Redis 实例</li><li>删除该节点上的所有数据目录</li><li>删除该节点上的 Vector 日志配置</li></ul><h3 id=实例级别移除>实例级别移除</h3><p>通过 <code>-e redis_port=&lt;port></code> 参数指定移除单个实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅移除 10.10.10.10 上的 6379 端口实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.10 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅移除 10.10.10.11 上的 6380 端口实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.11 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6380</span>
</span></span></code></pre></div><p>实例级别移除适用于：</p><ul><li>移除节点上的<strong>单个从库</strong></li><li>移除不再需要的实例</li><li>主从切换后移除原主库</li></ul><p>当指定 <code>redis_port</code> 时的行为差异：</p><table class=full-width><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>节点级别（无 redis_port）</th><th style=text-align:left>实例级别（有 redis_port）</th></tr></thead><tbody><tr><td style=text-align:left>监控注册</td><td style=text-align:left>删除整个节点的注册文件</td><td style=text-align:left>仅从注册文件中移除该实例</td></tr><tr><td style=text-align:left>redis_exporter</td><td style=text-align:left>停止并禁用</td><td style=text-align:left><strong>不操作</strong>（其他实例还需要）</td></tr><tr><td style=text-align:left>Redis 实例</td><td style=text-align:left>停止所有实例</td><td style=text-align:left>仅停止指定端口的实例</td></tr><tr><td style=text-align:left>数据目录</td><td style=text-align:left>删除 <code>/data/redis/</code> 整个目录</td><td style=text-align:left>仅删除 <code>/data/redis/&lt;cluster>-&lt;node>-&lt;port>/</code></td></tr><tr><td style=text-align:left>Vector 配置</td><td style=text-align:left>删除 <code>/etc/vector/redis.yaml</code></td><td style=text-align:left><strong>不操作</strong>（其他实例还需要）</td></tr><tr><td style=text-align:left>软件包</td><td style=text-align:left>可选卸载</td><td style=text-align:left><strong>不操作</strong></td></tr></tbody></table><h3 id=控制参数>控制参数</h3><p><code>redis-rm.yml</code> 提供以下控制参数：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>redis_safeguard</code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>安全保险，设为 <code>true</code> 时拒绝执行移除操作</td></tr><tr><td style=text-align:left><code>redis_rm_data</code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>是否删除数据目录（RDB/AOF 文件）</td></tr><tr><td style=text-align:left><code>redis_rm_pkg</code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>是否卸载 Redis 软件包</td></tr></tbody></table><p>使用示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 移除集群但保留数据目录</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-ms -e <span style=color:#000>redis_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 移除集群并卸载软件包</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-ms -e <span style=color:#000>redis_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 绕过安全保险强制移除</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-ms -e <span style=color:#000>redis_safeguard</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span></code></pre></div><h3 id=安全保险机制>安全保险机制</h3><p>当集群配置了 <code>redis_safeguard: true</code> 时，<code>redis-rm.yml</code> 会拒绝执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-production</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 生产环境开启保护</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./redis-rm.yml -l redis-production
</span></span><span style=display:flex><span>TASK <span style=color:#ce5c00;font-weight:700>[</span>ABORT due to redis_safeguard enabled<span style=color:#ce5c00;font-weight:700>]</span> ***
</span></span><span style=display:flex><span>fatal: <span style=color:#ce5c00;font-weight:700>[</span>10.10.10.10<span style=color:#ce5c00;font-weight:700>]</span>: FAILED! <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;msg&#34;</span>: <span style=color:#4e9a06>&#34;Abort due to redis_safeguard...&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>需要显式覆盖才能执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis-rm.yml -l redis-production -e <span style=color:#000>redis_safeguard</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span></code></pre></div><hr><h2 id=快速参考>快速参考</h2><h3 id=部署操作速查>部署操作速查</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 部署整个集群</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;cluster&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 扩容：部署新节点（cluster 模式下随后手工 add-node）</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;new-node-ip&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 扩容：在现有节点上添加新实例（先在配置中添加定义）</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;ip&gt; -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;new-port&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 更新配置并重启</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;cluster&gt; -t redis_config,redis_launch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 仅更新单个实例配置</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;ip&gt; -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;port&gt; -t redis_config,redis_launch
</span></span></code></pre></div><h3 id=移除操作速查>移除操作速查</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 移除整个集群</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l &lt;cluster&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 缩容：移除整个节点</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l &lt;ip&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 缩容：移除单个实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l &lt;ip&gt; -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;port&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 移除但保留数据</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l &lt;cluster&gt; -e <span style=color:#000>redis_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 彻底清理（包括软件包）</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l &lt;cluster&gt; -e <span style=color:#000>redis_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><h3 id=包装脚本>包装脚本</h3><p>Pigsty 提供了便捷的包装脚本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 部署</span>
</span></span><span style=display:flex><span>bin/redis-add &lt;cluster&gt;           <span style=color:#8f5902;font-style:italic># 部署集群</span>
</span></span><span style=display:flex><span>bin/redis-add &lt;ip&gt;                <span style=color:#8f5902;font-style:italic># 部署节点</span>
</span></span><span style=display:flex><span>bin/redis-add &lt;ip&gt; &lt;port&gt;         <span style=color:#8f5902;font-style:italic># 部署实例</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 移除</span>
</span></span><span style=display:flex><span>bin/redis-rm &lt;cluster&gt;            <span style=color:#8f5902;font-style:italic># 移除集群</span>
</span></span><span style=display:flex><span>bin/redis-rm &lt;ip&gt;                 <span style=color:#8f5902;font-style:italic># 移除节点</span>
</span></span><span style=display:flex><span>bin/redis-rm &lt;ip&gt; &lt;port&gt;          <span style=color:#8f5902;font-style:italic># 移除实例</span>
</span></span></code></pre></div><hr><h2 id=示例演示>示例演示</h2><p>使用 Redis 剧本初始化 Redis 集群：</p><p><a href=https://asciinema.org/a/568808><img src=https://asciinema.org/a/568808.svg alt=asciicast></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d30f775631874dbea209c56a3cf88d88>4 - 管理预案</h1><div class=lead>Redis 集群管理 SOP，创建、销毁、扩容、缩容与高可用的详细说明</div><p>以下是一些常见的 Redis 管理任务 SOP（预案）：</p><p><strong>基础运维</strong></p><ul><li><a href=#%E5%88%9D%E5%A7%8B%E5%8C%96redis>初始化Redis</a></li><li><a href=#%E4%B8%8B%E7%BA%BFredis>下线Redis</a></li><li><a href=#%E9%87%8D%E6%96%B0%E9%85%8D%E7%BD%AEredis>重新配置Redis</a></li><li><a href=#%E4%BD%BF%E7%94%A8redis%E5%AE%A2%E6%88%B7%E7%AB%AF>使用Redis客户端</a></li></ul><p><strong>高可用管理</strong></p><ul><li><a href=#%E6%89%8B%E5%B7%A5%E8%AE%BE%E7%BD%AEredis%E4%BB%8E%E5%BA%93>手工设置Redis从库</a></li><li><a href=#%E8%AE%BE%E7%BD%AEredis%E4%B8%BB%E4%BB%8E%E9%AB%98%E5%8F%AF%E7%94%A8>设置Redis主从高可用</a></li><li><a href=#%E5%88%9D%E5%A7%8B%E5%8C%96-redis-%E5%8E%9F%E7%94%9F%E9%9B%86%E7%BE%A4>初始化Redis原生集群</a></li></ul><p><strong>扩缩容与迁移</strong></p><ul><li><a href=#%E6%89%A9%E5%AE%B9redis%E8%8A%82%E7%82%B9>扩容Redis节点</a></li><li><a href=#%E7%BC%A9%E5%AE%B9redis%E8%8A%82%E7%82%B9>缩容Redis节点</a></li><li><a href=#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D>数据备份与恢复</a></li></ul><p><strong>故障排查</strong></p><ul><li><a href=#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD>常见问题诊断</a></li><li><a href=#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98>性能调优</a></li></ul><p>更多问题请参考 <a href=/docs/redis/faq/>FAQ：REDIS</a>。</p><hr><h3 id=初始化redis>初始化Redis</h3><p>您可以使用 <a href=/docs/redis/playbook#redisyml><code>redis.yml</code></a> 剧本来初始化 Redis 集群、节点、或实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 初始化集群内所有 Redis 实例</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;cluster&gt;      <span style=color:#8f5902;font-style:italic># 初始化 redis 集群</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 初始化特定节点上的所有 Redis 实例</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.10    <span style=color:#8f5902;font-style:italic># 初始化 redis 节点</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 初始化特定 Redis 实例：  10.10.10.11:6379</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.11 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span> -t redis
</span></span></code></pre></div><p>你也可以使用包装脚本命令行脚本来初始化：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/redis-add redis-ms          <span style=color:#8f5902;font-style:italic># 初始化 redis 集群 &#39;redis-ms&#39;</span>
</span></span><span style=display:flex><span>bin/redis-add 10.10.10.10       <span style=color:#8f5902;font-style:italic># 初始化 redis 节点 &#39;10.10.10.10&#39;</span>
</span></span><span style=display:flex><span>bin/redis-add 10.10.10.10 <span style=color:#0000cf;font-weight:700>6379</span>  <span style=color:#8f5902;font-style:italic># 初始化 redis 实例 &#39;10.10.10.10:6379&#39;</span>
</span></span></code></pre></div><hr><h3 id=下线redis>下线Redis</h3><p>您可以使用 <a href=/docs/redis/playbook#redis-rmyml><code>redis-rm.yml</code></a> 剧本来下线 Redis 集群、节点、或实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 下线 Redis 集群 `redis-test`</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 下线 Redis 集群 `redis-test` 并卸载 Redis 软件包</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l redis-test -e <span style=color:#000>redis_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 下线 Redis 节点 10.10.10.13 上的所有实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.13
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 下线特定 Redis 实例 10.10.10.13:6379</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.13 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span>
</span></span></code></pre></div><p>你也可以使用包装脚本来下线 Redis 集群/节点/实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/redis-rm redis-ms          <span style=color:#8f5902;font-style:italic># 下线 redis 集群 &#39;redis-ms&#39;</span>
</span></span><span style=display:flex><span>bin/redis-rm 10.10.10.10       <span style=color:#8f5902;font-style:italic># 下线 redis 节点 &#39;10.10.10.10&#39;</span>
</span></span><span style=display:flex><span>bin/redis-rm 10.10.10.10 <span style=color:#0000cf;font-weight:700>6379</span>  <span style=color:#8f5902;font-style:italic># 下线 redis 实例 &#39;10.10.10.10:6379&#39;</span>
</span></span></code></pre></div><hr><h3 id=重新配置redis>重新配置Redis</h3><p>您可以部分执行 <a href=/docs/redis/playbook#redisyml><code>redis.yml</code></a> 剧本来重新配置 Redis 集群、节点、或实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l &lt;cluster&gt; -t redis_config,redis_launch
</span></span></code></pre></div><p>请注意，redis 无法在线重载配置，您只能使用 launch 任务进行重启来让配置生效。</p><hr><h2 id=使用redis客户端>使用Redis客户端</h2><p>使用 <code>redis-cli</code> 访问 Reids 实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> <span style=color:#8f5902;font-style:italic># &lt;--- 使用 Host 与 Port 访问对应 Redis 实例</span>
</span></span><span style=display:flex><span>10.10.10.10:6379&gt; auth redis.ms    <span style=color:#8f5902;font-style:italic># &lt;--- 使用密码验证</span>
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>10.10.10.10:6379&gt; <span style=color:#204a87>set</span> a <span style=color:#0000cf;font-weight:700>10</span>         <span style=color:#8f5902;font-style:italic># &lt;--- 设置一个Key</span>
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>10.10.10.10:6379&gt; get a            <span style=color:#8f5902;font-style:italic># &lt;--- 获取 Key 的值</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;10&#34;</span>
</span></span></code></pre></div><p>Redis提供了<code>redis-benchmark</code>工具，可以用于Redis的性能评估，或生成一些负载用于测试。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>redis-benchmark -h 10.10.10.13 -p <span style=color:#0000cf;font-weight:700>6379</span>
</span></span></code></pre></div><hr><h3 id=手工设置redis从库>手工设置Redis从库</h3><p><a href=https://redis.io/commands/replicaof/>https://redis.io/commands/replicaof/</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 将一个 Redis 实例提升为主库</span>
</span></span><span style=display:flex><span>&gt; REPLICAOF NO ONE
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;OK&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 将一个 Redis 实例设置为另一个实例的从库</span>
</span></span><span style=display:flex><span>&gt; REPLICAOF 127.0.0.1 <span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;OK&#34;</span>
</span></span></code></pre></div><hr><h3 id=设置redis主从高可用>设置Redis主从高可用</h3><p>Redis独立主从集群可以通过 Redis 哨兵集群配置自动高可用，详细用户请参考 <a href=https://redis.io/docs/management/sentinel/>Sentinel官方文档</a></p><p>以四节点 <a href=/docs/deploy/sandbox><strong>沙箱</strong></a> 为例，一套 Redis Sentinel 集群 <code>redis-meta</code>，可以用来管理很多套独立 Redis 主从集群。</p><p>以一主一从的Redis普通主从集群 <code>redis-ms</code> 为例，您需要在每个 Sentinel 实例上，使用 <code>SENTINEL MONITOR</code> 添加目标，并使用 <code>SENTINEL SET</code> 提供密码，高可用就配置完毕了。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 对于每一个 sentinel，将 redis 主服务器纳入哨兵管理：（26379,26380,26381）</span>
</span></span><span style=display:flex><span>$ redis-cli -h 10.10.10.11 -p <span style=color:#0000cf;font-weight:700>26379</span> -a redis.meta
</span></span><span style=display:flex><span>10.10.10.11:26379&gt; SENTINEL MONITOR redis-ms 10.10.10.10 <span style=color:#0000cf;font-weight:700>6379</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>10.10.10.11:26379&gt; SENTINEL SET redis-ms auth-pass redis.ms      <span style=color:#8f5902;font-style:italic># 如果启用了授权，需要配置密码</span>
</span></span></code></pre></div><p>如果您想移除某个由 Sentinel 管理的 Redis 主从集群，使用 <code>SENTINEL REMOVE &lt;name></code> 移除即可。</p><p>您可以使用定义在 Sentinel 集群上的 <a href=/docs/redis/param#redis_sentinel_monitor><code>redis_sentinel_monitor</code></a> 参数，来自动配置管理哨兵监控管理的主库列表。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis_sentinel_monitor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 需要被监控的主库列表，端口、密码、法定人数（应为1/2以上的哨兵数量）为可选参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-src, host: 10.10.10.45, port: 6379 ,password: redis.src, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: redis-dst, host: 10.10.10.48, port: 6379 ,password: redis.dst, quorum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>redis.yml</code> 中的 <code>redis-ha</code> 阶段会根据该列表在每个哨兵实例上渲染 <code>/tmp/&lt;cluster>.monitor</code> 并依次执行 <code>SENTINEL REMOVE</code> 与 <code>SENTINEL MONITOR</code> 命令，
从而保证哨兵纳管状态与清单保持一致。如果只想移除某个目标而不再重新添加，可以在监控对象上设置 <code>remove: true</code>，剧本会在 <code>SENTINEL REMOVE</code> 后跳过重新注册。</p><p>使用以下命令刷新 Redis 哨兵集群上的纳管主库列表：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l redis-meta -t redis-ha   <span style=color:#8f5902;font-style:italic># 如果您的 Sentinel 集群名称不是 redis-meta，请在这里替换。</span>
</span></span></code></pre></div><hr><h3 id=初始化-redis-原生集群>初始化 Redis 原生集群</h3><p>当 <a href=/docs/redis/param#redis_mode><code>redis_mode</code></a> 设置为 <code>cluster</code> 时，<code>redis.yml</code> 会额外执行 <code>redis-join</code> 阶段 ：
在 <code>/tmp/&lt;cluster>-join.sh</code> 中使用 <code>redis-cli --cluster create --cluster-yes ... --cluster-replicas {{ redis_cluster_replicas }}</code> 把所有实例拼成原生集群。
该步骤在首次部署时自动运行，后续重新执行 <code>./redis.yml -l &lt;cluster> -t redis-join</code> 将再次生成并运行相同命令；
由于 <code>--cluster create</code> 并非幂等操作， 只有在你确认需要重建整个原生集群时才应单独触发这一阶段。</p><hr><h3 id=扩容redis节点>扩容Redis节点</h3><h4 id=扩容独立主从集群>扩容独立主从集群</h4><p>向现有的 Redis 主从集群添加新节点/实例时，首先在配置清单中添加新的定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-ms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 1 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>}, 6380</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_node: 2 , redis_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>6379</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>replica_of</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;10.10.10.10 6379&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 新增节点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>redis_cluster: redis-ms ,redis_password: &#39;redis.ms&#39; ,redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>64MB }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后仅针对新节点执行部署：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l 10.10.10.11   <span style=color:#8f5902;font-style:italic># 仅部署新增的节点</span>
</span></span></code></pre></div><h4 id=扩容原生集群>扩容原生集群</h4><p>向 Redis 原生集群添加新节点需要额外的步骤：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 在配置清单中添加新节点</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 部署新节点</span>
</span></span><span style=display:flex><span>./redis.yml -l 10.10.10.14
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 将新节点添加到集群中（手动执行）</span>
</span></span><span style=display:flex><span>redis-cli --cluster add-node 10.10.10.14:6379 10.10.10.12:6379
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 重新分配槽位（如需要）</span>
</span></span><span style=display:flex><span>redis-cli --cluster reshard 10.10.10.12:6379
</span></span></code></pre></div><h4 id=扩容哨兵集群>扩容哨兵集群</h4><p>向 Sentinel 集群添加新实例后，需要同时完成实例部署与纳管目标刷新：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 在配置清单中添加新的哨兵实例，部署实例</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;sentinel-cluster&gt; -t redis_instance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 重新下发 redis_sentinel_monitor 到所有哨兵</span>
</span></span><span style=display:flex><span>./redis.yml -l &lt;sentinel-cluster&gt; -t redis-ha
</span></span></code></pre></div><hr><h3 id=缩容redis节点>缩容Redis节点</h3><h4 id=缩容独立主从集群>缩容独立主从集群</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 如果要移除的是从库，直接移除即可</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.11 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 如果要移除的是主库，先进行主从切换</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6380</span> REPLICAOF NO ONE      <span style=color:#8f5902;font-style:italic># 提升从库</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> REPLICAOF 10.10.10.10 <span style=color:#0000cf;font-weight:700>6380</span>  <span style=color:#8f5902;font-style:italic># 降级原主库</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 然后移除原主库</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.10 -e <span style=color:#000>redis_port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 更新配置清单，移除相关定义</span>
</span></span></code></pre></div><h4 id=缩容原生集群>缩容原生集群</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 先迁移数据槽位</span>
</span></span><span style=display:flex><span>redis-cli --cluster reshard 10.10.10.12:6379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --cluster-from &lt;node-id&gt; --cluster-to &lt;target-node-id&gt; --cluster-slots &lt;count&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 从集群中移除节点</span>
</span></span><span style=display:flex><span>redis-cli --cluster del-node 10.10.10.12:6379 &lt;node-id&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 下线实例</span>
</span></span><span style=display:flex><span>./redis-rm.yml -l 10.10.10.14
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 更新配置清单</span>
</span></span></code></pre></div><hr><h3 id=数据备份与恢复>数据备份与恢复</h3><h4 id=手动备份>手动备份</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 触发 RDB 快照</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> -a &lt;password&gt; BGSAVE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看快照状态</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> -a &lt;password&gt; LASTSAVE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 复制 RDB 文件（默认位置）</span>
</span></span><span style=display:flex><span>cp /data/redis/redis-ms-1-6379/dump.rdb /backup/redis-ms-<span style=color:#204a87;font-weight:700>$(</span>date +%Y%m%d<span style=color:#204a87;font-weight:700>)</span>.rdb
</span></span></code></pre></div><h4 id=数据恢复>数据恢复</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 停止 Redis 实例</span>
</span></span><span style=display:flex><span>sudo systemctl stop redis-ms-1-6379
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 替换 RDB 文件</span>
</span></span><span style=display:flex><span>cp /backup/redis-ms-20241231.rdb /data/redis/redis-ms-1-6379/dump.rdb
</span></span><span style=display:flex><span>chown redis:redis /data/redis/redis-ms-1-6379/dump.rdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 启动 Redis 实例</span>
</span></span><span style=display:flex><span>sudo systemctl start redis-ms-1-6379
</span></span></code></pre></div><h4 id=使用-aof-持久化>使用 AOF 持久化</h4><p>如果需要更高的数据安全性，可以启用 AOF：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-ms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;900 1&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;300 10&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;60 10000&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 同时保留 RDB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>重新部署以应用 AOF 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./redis.yml -l redis-ms -t redis_config,redis_launch
</span></span></code></pre></div><hr><h3 id=常见问题诊断>常见问题诊断</h3><h4 id=连接问题排查>连接问题排查</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查 Redis 服务状态</span>
</span></span><span style=display:flex><span>systemctl status redis-ms-1-6379
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查端口监听</span>
</span></span><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查防火墙</span>
</span></span><span style=display:flex><span>sudo iptables -L -n <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 测试连接</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> PING
</span></span></code></pre></div><h4 id=内存问题排查>内存问题排查</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看内存使用情况</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> INFO memory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看大 Key</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> --bigkeys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看内存分析报告</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> MEMORY DOCTOR
</span></span></code></pre></div><h4 id=性能问题排查>性能问题排查</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看慢查询日志</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> SLOWLOG GET <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 实时监控命令</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> MONITOR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看客户端连接</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> CLIENT LIST
</span></span></code></pre></div><h4 id=复制问题排查>复制问题排查</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看复制状态</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6379</span> INFO replication
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查复制延迟</span>
</span></span><span style=display:flex><span>redis-cli -h 10.10.10.10 -p <span style=color:#0000cf;font-weight:700>6380</span> INFO replication <span style=color:#000;font-weight:700>|</span> grep lag
</span></span></code></pre></div><hr><h3 id=性能调优>性能调优</h3><h4 id=内存优化>内存优化</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_max_memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>4GB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 根据可用内存设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_mem_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allkeys-lru  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 缓存场景推荐 LRU</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis.conf</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=持久化优化>持久化优化</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 纯缓存场景：禁用持久化</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 禁用 RDB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 禁用 AOF</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 数据安全场景：同时启用 RDB 和 AOF</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>redis-data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_rdb_save</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;900 1&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;300 10&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;60 10000&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>redis_aof_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=连接池配置建议>连接池配置建议</h4><p>客户端应用连接 Redis 时，建议：</p><ul><li>使用连接池，避免频繁创建连接</li><li>设置合理的超时时间（推荐 1-3 秒）</li><li>启用 TCP keepalive</li><li>对于高并发场景，考虑使用 Pipeline 批量操作</li></ul><h4 id=监控关键指标>监控关键指标</h4><p>通过 Grafana 仪表盘关注以下指标：</p><ul><li><strong>内存使用率</strong>：<code>redis:ins:mem_usage</code> > 80% 时需要关注</li><li><strong>CPU 使用率</strong>：<code>redis:ins:cpu_usage</code> > 70% 时需要关注</li><li><strong>QPS</strong>：关注突增和异常波动</li><li><strong>响应时间</strong>：<code>redis:ins:rt</code> > 1ms 时需要排查</li><li><strong>连接数</strong>：关注连接数增长趋势</li><li><strong>复制延迟</strong>：主从复制场景下需要关注</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-81482490a3974d936d1dca668f5c2d09>5 - 监控告警</h1><div class=lead>如何监控 redis？有哪些告警规则值得关注？</div><hr><h2 id=监控面板>监控面板</h2><p>REDIS 模块提供了 3 个监控面板</p><ul><li>Redis Overview：redis 集群概览</li><li>Redis Cluster：redis 集群详情</li><li>Redis Instance：redis 实例详情</li></ul><hr><h2 id=监控>监控</h2><p>Pigsty 提供了三个与 <a href=/docs/redis><code>REDIS</code></a> 模块有关的监控仪表盘：</p><hr><h3 id=redis-overview>Redis Overview</h3><p><a href=https://demo.pigsty.cc/d/redis-overview>Redis Overview</a>：关于所有Redis集群/实例的详细信息</p><p><a href=https://demo.pigsty.cc/d/redis-overview><img src=/img/dashboard/redis-overview.jpg alt=redis-overview.jpg></a></p><hr><h3 id=redis-cluster>Redis Cluster</h3><p><a href=https://demo.pigsty.cc/d/redis-cluster>Redis Cluster</a>：关于单个Redis集群的详细信息</p><details><summary>Redis Cluster Dashboard</summary><p><a href=https://demo.pigsty.cc/d/redis-cluster><img src=/img/dashboard/redis-cluster.jpg alt=redis-cluster.jpg></a></p></details><br><hr><h3 id=redis-instance>Redis Instance</h3><p><a href=https://demo.pigsty.cc/d/redis-instance>Redis Instance</a>： 关于单个Redis实例的详细信息</p><details><summary>Redis Instance Dashboard</summary><p><a href=https://demo.pigsty.cc/d/redis-instance><img src=/img/dashboard/redis-instance.jpg alt=redis-instance></a></p></details><br><hr><h2 id=告警规则>告警规则</h2><p>Pigsty 针对 redis 提供了以下六条预置告警规则，定义于 <a href=https://github.com/pgsty/pigsty/blob/main/files/victoria/rules/redis.yml><code>files/victoria/rules/redis.yml</code></a></p><ul><li><code>RedisDown</code>：redis 实例不可用</li><li><code>RedisRejectConn</code>：redis 实例拒绝连接</li><li><code>RedisRTHigh</code>：redis 实例响应时间过高</li><li><code>RedisCPUHigh</code>：redis 实例 CPU 使用率过高</li><li><code>RedisMemHigh</code>：redis 实例内存使用率过高</li><li><code>RedisQPSHigh</code>：redis 实例 QPS 过高</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                         Error                                #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis down triggers a P0 alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CRIT RedisDown: {{ $labels.ins }} {{ $labels.instance }} {{ $value }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      redis_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value }} == 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-5m&amp;to=now&amp;var-ins={{$labels.ins}}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis reject connection in last 5m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisRejectConn</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis:ins:conn_reject &gt; 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CRIT RedisRejectConn: {{ $labels.ins }} {{ $labels.instance }} {{ $value }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      redis:ins:conn_reject[cls={{ $labels.cls }}, ins={{ $labels.ins }}][5m] = {{ $value }} &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-10m&amp;to=now&amp;viewPanel=88&amp;fullscreen&amp;var-ins={{ $labels.ins }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                         Latency                              #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis avg query response time &gt; 160 µs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisRTHigh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis:ins:rt &gt; 0.00016</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 1, severity: WARN, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WARN RedisRTHigh: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      pg:ins:query_rt[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 160µs
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-10m&amp;to=now&amp;viewPanel=97&amp;fullscreen&amp;var-ins={{ $labels.ins }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                        Saturation                            #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis cpu usage more than 70% for 1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisCPUHigh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis:ins:cpu_usage &gt; 0.70</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 1, severity: WARN, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WARN RedisCPUHigh: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      redis:ins:cpu_all[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 60%
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-10m&amp;to=now&amp;viewPanel=43&amp;fullscreen&amp;var-ins={{ $labels.ins }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis mem usage more than 70% for 1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisMemHigh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis:ins:mem_usage &gt; 0.70</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 1, severity: WARN, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WARN RedisMemHigh: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      redis:ins:mem_usage[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 80%
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-10m&amp;to=now&amp;viewPanel=7&amp;fullscreen&amp;var-ins={{ $labels.ins }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                         Traffic                              #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis qps more than 32000 for 5m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>RedisQPSHigh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis:ins:qps &gt; 32000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>5m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 2, severity: INFO, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>redis }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;INFO RedisQPSHigh: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      redis:ins:qps[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 16000
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/redis-instance?from=now-10m&amp;to=now&amp;viewPanel=96&amp;fullscreen&amp;var-ins={{ $labels.ins }}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5bcac294a078899a139a79dc1fb2b009>6 - 指标列表</h1><div class=lead>Pigsty REDIS 模块提供的完整监控指标列表与释义</div><p><a href=/docs/redis><strong><code>REDIS</code></strong></a> 模块包含有 275 类可用监控指标。</p><table class=full-width><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>ALERTS</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>level</code>, <code>severity</code>, <code>instance</code>, <code>category</code>, <code>ins</code>, <code>alertname</code>, <code>job</code>, <code>alertstate</code></td><td>N/A</td></tr><tr><td>ALERTS_FOR_STATE</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>level</code>, <code>severity</code>, <code>instance</code>, <code>category</code>, <code>ins</code>, <code>alertname</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:aof_rewrite_time</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:blocked_clients</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:clients</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cmd_qps</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cmd_rt</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cmd_time</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:conn_rate</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:conn_reject</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_sys</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_sys_child</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_usage</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_usage_child</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_user</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:cpu_user_child</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:fork_time</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:key_evict</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:key_expire</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:key_hit</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:key_hit_rate</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:key_miss</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:mem_max</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:mem_usage</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:mem_usage_max</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:mem_used</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:net_traffic</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:qps</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:qps_mu</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:qps_realtime</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:qps_sigma</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:rt</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:rt_mu</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:rt_sigma</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:rx</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:size</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:cls:tx</td><td>Unknown</td><td><code>cls</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:env:blocked_clients</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:clients</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:cmd_qps</td><td>Unknown</td><td><code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:env:cmd_rt</td><td>Unknown</td><td><code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:env:cmd_time</td><td>Unknown</td><td><code>cmd</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:env:conn_rate</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:conn_reject</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:cpu_usage</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:cpu_usage_child</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:key_evict</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:key_expire</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:key_hit</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:key_hit_rate</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:key_miss</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:mem_usage</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:net_traffic</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:qps</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:qps_mu</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:qps_realtime</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:qps_sigma</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:rt</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:rt_mu</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:rt_sigma</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:rx</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:env:tx</td><td>Unknown</td><td><code>job</code></td><td>N/A</td></tr><tr><td>redis:ins</td><td>Unknown</td><td><code>cls</code>, <code>id</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:blocked_clients</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:clients</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cmd_qps</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cmd_rt</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cmd_time</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:conn_rate</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:conn_reject</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_sys</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_sys_child</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_usage</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_usage_child</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_user</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:cpu_user_child</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:key_evict</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:key_expire</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:key_hit</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:key_hit_rate</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:key_miss</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:lsn_rate</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:mem_usage</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:net_traffic</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:qps</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:qps_mu</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:qps_realtime</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:qps_sigma</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:rt</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:rt_mu</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:rt_sigma</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:rx</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:ins:tx</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:node:ip</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:node:mem_alloc</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:node:mem_total</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:node:mem_used</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis:node:qps</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_active_defrag_running</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>active_defrag_running metric</td></tr><tr><td>redis_allocator_active_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_active_bytes metric</td></tr><tr><td>redis_allocator_allocated_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_allocated_bytes metric</td></tr><tr><td>redis_allocator_frag_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_frag_bytes metric</td></tr><tr><td>redis_allocator_frag_ratio</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_frag_ratio metric</td></tr><tr><td>redis_allocator_resident_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_resident_bytes metric</td></tr><tr><td>redis_allocator_rss_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_rss_bytes metric</td></tr><tr><td>redis_allocator_rss_ratio</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>allocator_rss_ratio metric</td></tr><tr><td>redis_aof_current_rewrite_duration_sec</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_current_rewrite_duration_sec metric</td></tr><tr><td>redis_aof_enabled</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_enabled metric</td></tr><tr><td>redis_aof_last_bgrewrite_status</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_last_bgrewrite_status metric</td></tr><tr><td>redis_aof_last_cow_size_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_last_cow_size_bytes metric</td></tr><tr><td>redis_aof_last_rewrite_duration_sec</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_last_rewrite_duration_sec metric</td></tr><tr><td>redis_aof_last_write_status</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_last_write_status metric</td></tr><tr><td>redis_aof_rewrite_in_progress</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_rewrite_in_progress metric</td></tr><tr><td>redis_aof_rewrite_scheduled</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>aof_rewrite_scheduled metric</td></tr><tr><td>redis_blocked_clients</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>blocked_clients metric</td></tr><tr><td>redis_client_recent_max_input_buffer_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>client_recent_max_input_buffer_bytes metric</td></tr><tr><td>redis_client_recent_max_output_buffer_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>client_recent_max_output_buffer_bytes metric</td></tr><tr><td>redis_clients_in_timeout_table</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>clients_in_timeout_table metric</td></tr><tr><td>redis_cluster_connections</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_connections metric</td></tr><tr><td>redis_cluster_current_epoch</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_current_epoch metric</td></tr><tr><td>redis_cluster_enabled</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_enabled metric</td></tr><tr><td>redis_cluster_known_nodes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_known_nodes metric</td></tr><tr><td>redis_cluster_messages_received_total</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_messages_received_total metric</td></tr><tr><td>redis_cluster_messages_sent_total</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_messages_sent_total metric</td></tr><tr><td>redis_cluster_my_epoch</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_my_epoch metric</td></tr><tr><td>redis_cluster_size</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_size metric</td></tr><tr><td>redis_cluster_slots_assigned</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_slots_assigned metric</td></tr><tr><td>redis_cluster_slots_fail</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_slots_fail metric</td></tr><tr><td>redis_cluster_slots_ok</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_slots_ok metric</td></tr><tr><td>redis_cluster_slots_pfail</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_slots_pfail metric</td></tr><tr><td>redis_cluster_state</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_state metric</td></tr><tr><td>redis_cluster_stats_messages_meet_received</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_meet_received metric</td></tr><tr><td>redis_cluster_stats_messages_meet_sent</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_meet_sent metric</td></tr><tr><td>redis_cluster_stats_messages_ping_received</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_ping_received metric</td></tr><tr><td>redis_cluster_stats_messages_ping_sent</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_ping_sent metric</td></tr><tr><td>redis_cluster_stats_messages_pong_received</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_pong_received metric</td></tr><tr><td>redis_cluster_stats_messages_pong_sent</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cluster_stats_messages_pong_sent metric</td></tr><tr><td>redis_commands_duration_seconds_total</td><td>counter</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total amount of time in seconds spent per command</td></tr><tr><td>redis_commands_failed_calls_total</td><td>counter</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total number of errors prior command execution per command</td></tr><tr><td>redis_commands_latencies_usec_bucket</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>le</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_commands_latencies_usec_count</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_commands_latencies_usec_sum</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_commands_processed_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>commands_processed_total metric</td></tr><tr><td>redis_commands_rejected_calls_total</td><td>counter</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total number of errors within command execution per command</td></tr><tr><td>redis_commands_total</td><td>counter</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total number of calls per command</td></tr><tr><td>redis_config_io_threads</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>config_io_threads metric</td></tr><tr><td>redis_config_maxclients</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>config_maxclients metric</td></tr><tr><td>redis_config_maxmemory</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>config_maxmemory metric</td></tr><tr><td>redis_connected_clients</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>connected_clients metric</td></tr><tr><td>redis_connected_slave_lag_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>slave_ip</code>, <code>instance</code>, <code>slave_state</code>, <code>ins</code>, <code>slave_port</code>, <code>job</code></td><td>Lag of connected slave</td></tr><tr><td>redis_connected_slave_offset_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>slave_ip</code>, <code>instance</code>, <code>slave_state</code>, <code>ins</code>, <code>slave_port</code>, <code>job</code></td><td>Offset of connected slave</td></tr><tr><td>redis_connected_slaves</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>connected_slaves metric</td></tr><tr><td>redis_connections_received_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>connections_received_total metric</td></tr><tr><td>redis_cpu_sys_children_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_sys_children_seconds_total metric</td></tr><tr><td>redis_cpu_sys_main_thread_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_sys_main_thread_seconds_total metric</td></tr><tr><td>redis_cpu_sys_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_sys_seconds_total metric</td></tr><tr><td>redis_cpu_user_children_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_user_children_seconds_total metric</td></tr><tr><td>redis_cpu_user_main_thread_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_user_main_thread_seconds_total metric</td></tr><tr><td>redis_cpu_user_seconds_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>cpu_user_seconds_total metric</td></tr><tr><td>redis_db_keys</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>db</code>, <code>job</code></td><td>Total number of keys by DB</td></tr><tr><td>redis_db_keys_expiring</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>db</code>, <code>job</code></td><td>Total number of expiring keys by DB</td></tr><tr><td>redis_defrag_hits</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>defrag_hits metric</td></tr><tr><td>redis_defrag_key_hits</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>defrag_key_hits metric</td></tr><tr><td>redis_defrag_key_misses</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>defrag_key_misses metric</td></tr><tr><td>redis_defrag_misses</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>defrag_misses metric</td></tr><tr><td>redis_dump_payload_sanitizations</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>dump_payload_sanitizations metric</td></tr><tr><td>redis_errors_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>err</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total number of errors per error type</td></tr><tr><td>redis_evicted_keys_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>evicted_keys_total metric</td></tr><tr><td>redis_expired_keys_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>expired_keys_total metric</td></tr><tr><td>redis_expired_stale_percentage</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>expired_stale_percentage metric</td></tr><tr><td>redis_expired_time_cap_reached_total</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>expired_time_cap_reached_total metric</td></tr><tr><td>redis_exporter_build_info</td><td>gauge</td><td><code>cls</code>, <code>golang_version</code>, <code>ip</code>, <code>commit_sha</code>, <code>instance</code>, <code>version</code>, <code>ins</code>, <code>job</code>, <code>build_date</code></td><td>redis exporter build_info</td></tr><tr><td>redis_exporter_last_scrape_connect_time_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>exporter_last_scrape_connect_time_seconds metric</td></tr><tr><td>redis_exporter_last_scrape_duration_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>exporter_last_scrape_duration_seconds metric</td></tr><tr><td>redis_exporter_last_scrape_error</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>The last scrape error status.</td></tr><tr><td>redis_exporter_scrape_duration_seconds_count</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_exporter_scrape_duration_seconds_sum</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_exporter_scrapes_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Current total redis scrapes.</td></tr><tr><td>redis_instance_info</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>os</code>, <code>role</code>, <code>instance</code>, <code>run_id</code>, <code>redis_version</code>, <code>tcp_port</code>, <code>process_id</code>, <code>ins</code>, <code>redis_mode</code>, <code>maxmemory_policy</code>, <code>redis_build_id</code>, <code>job</code></td><td>Information about the Redis instance</td></tr><tr><td>redis_io_threaded_reads_processed</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>io_threaded_reads_processed metric</td></tr><tr><td>redis_io_threaded_writes_processed</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>io_threaded_writes_processed metric</td></tr><tr><td>redis_io_threads_active</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>io_threads_active metric</td></tr><tr><td>redis_keyspace_hits_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>keyspace_hits_total metric</td></tr><tr><td>redis_keyspace_misses_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>keyspace_misses_total metric</td></tr><tr><td>redis_last_key_groups_scrape_duration_milliseconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Duration of the last key group metrics scrape in milliseconds</td></tr><tr><td>redis_last_slow_execution_duration_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>The amount of time needed for last slow execution, in seconds</td></tr><tr><td>redis_latency_percentiles_usec</td><td>summary</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>quantile</code>, <code>ins</code>, <code>job</code></td><td>A summary of latency percentile distribution per command</td></tr><tr><td>redis_latency_percentiles_usec_count</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_latency_percentiles_usec_sum</td><td>Unknown</td><td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>redis_latest_fork_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>latest_fork_seconds metric</td></tr><tr><td>redis_lazyfree_pending_objects</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>lazyfree_pending_objects metric</td></tr><tr><td>redis_loading_dump_file</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>loading_dump_file metric</td></tr><tr><td>redis_master_last_io_seconds_ago</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td><td>Master last io seconds ago</td></tr><tr><td>redis_master_link_up</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td><td>Master link status on Redis slave</td></tr><tr><td>redis_master_repl_offset</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>master_repl_offset metric</td></tr><tr><td>redis_master_sync_in_progress</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td><td>Master sync in progress</td></tr><tr><td>redis_mem_clients_normal</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>mem_clients_normal metric</td></tr><tr><td>redis_mem_clients_slaves</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>mem_clients_slaves metric</td></tr><tr><td>redis_mem_fragmentation_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>mem_fragmentation_bytes metric</td></tr><tr><td>redis_mem_fragmentation_ratio</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>mem_fragmentation_ratio metric</td></tr><tr><td>redis_mem_not_counted_for_eviction_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>mem_not_counted_for_eviction_bytes metric</td></tr><tr><td>redis_memory_max_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_max_bytes metric</td></tr><tr><td>redis_memory_used_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_bytes metric</td></tr><tr><td>redis_memory_used_dataset_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_dataset_bytes metric</td></tr><tr><td>redis_memory_used_lua_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_lua_bytes metric</td></tr><tr><td>redis_memory_used_overhead_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_overhead_bytes metric</td></tr><tr><td>redis_memory_used_peak_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_peak_bytes metric</td></tr><tr><td>redis_memory_used_rss_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_rss_bytes metric</td></tr><tr><td>redis_memory_used_scripts_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_scripts_bytes metric</td></tr><tr><td>redis_memory_used_startup_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>memory_used_startup_bytes metric</td></tr><tr><td>redis_migrate_cached_sockets_total</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>migrate_cached_sockets_total metric</td></tr><tr><td>redis_module_fork_in_progress</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>module_fork_in_progress metric</td></tr><tr><td>redis_module_fork_last_cow_size</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>module_fork_last_cow_size metric</td></tr><tr><td>redis_net_input_bytes_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>net_input_bytes_total metric</td></tr><tr><td>redis_net_output_bytes_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>net_output_bytes_total metric</td></tr><tr><td>redis_number_of_cached_scripts</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>number_of_cached_scripts metric</td></tr><tr><td>redis_process_id</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>process_id metric</td></tr><tr><td>redis_pubsub_channels</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>pubsub_channels metric</td></tr><tr><td>redis_pubsub_patterns</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>pubsub_patterns metric</td></tr><tr><td>redis_pubsubshard_channels</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>pubsubshard_channels metric</td></tr><tr><td>redis_rdb_bgsave_in_progress</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_bgsave_in_progress metric</td></tr><tr><td>redis_rdb_changes_since_last_save</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_changes_since_last_save metric</td></tr><tr><td>redis_rdb_current_bgsave_duration_sec</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_current_bgsave_duration_sec metric</td></tr><tr><td>redis_rdb_last_bgsave_duration_sec</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_last_bgsave_duration_sec metric</td></tr><tr><td>redis_rdb_last_bgsave_status</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_last_bgsave_status metric</td></tr><tr><td>redis_rdb_last_cow_size_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_last_cow_size_bytes metric</td></tr><tr><td>redis_rdb_last_save_timestamp_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rdb_last_save_timestamp_seconds metric</td></tr><tr><td>redis_rejected_connections_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>rejected_connections_total metric</td></tr><tr><td>redis_repl_backlog_first_byte_offset</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>repl_backlog_first_byte_offset metric</td></tr><tr><td>redis_repl_backlog_history_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>repl_backlog_history_bytes metric</td></tr><tr><td>redis_repl_backlog_is_active</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>repl_backlog_is_active metric</td></tr><tr><td>redis_replica_partial_resync_accepted</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>replica_partial_resync_accepted metric</td></tr><tr><td>redis_replica_partial_resync_denied</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>replica_partial_resync_denied metric</td></tr><tr><td>redis_replica_resyncs_full</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>replica_resyncs_full metric</td></tr><tr><td>redis_replication_backlog_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>replication_backlog_bytes metric</td></tr><tr><td>redis_second_repl_offset</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>second_repl_offset metric</td></tr><tr><td>redis_sentinel_master_ckquorum_status</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>message</code>, <code>instance</code>, <code>ins</code>, <code>master_name</code>, <code>job</code></td><td>Master ckquorum status</td></tr><tr><td>redis_sentinel_master_ok_sentinels</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>The number of okay sentinels monitoring this master</td></tr><tr><td>redis_sentinel_master_ok_slaves</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>The number of okay slaves of the master</td></tr><tr><td>redis_sentinel_master_sentinels</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>The number of sentinels monitoring this master</td></tr><tr><td>redis_sentinel_master_setting_ckquorum</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>Show the current ckquorum config for each master</td></tr><tr><td>redis_sentinel_master_setting_down_after_milliseconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>Show the current down-after-milliseconds config for each master</td></tr><tr><td>redis_sentinel_master_setting_failover_timeout</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>Show the current failover-timeout config for each master</td></tr><tr><td>redis_sentinel_master_setting_parallel_syncs</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>Show the current parallel-syncs config for each master</td></tr><tr><td>redis_sentinel_master_slaves</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>The number of slaves of the master</td></tr><tr><td>redis_sentinel_master_status</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_status</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td><td>Master status on Sentinel</td></tr><tr><td>redis_sentinel_masters</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>The number of masters this sentinel is watching</td></tr><tr><td>redis_sentinel_running_scripts</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Number of scripts in execution right now</td></tr><tr><td>redis_sentinel_scripts_queue_length</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Queue of user scripts to execute</td></tr><tr><td>redis_sentinel_simulate_failure_flags</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Failures simulations</td></tr><tr><td>redis_sentinel_tilt</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Sentinel is in TILT mode</td></tr><tr><td>redis_slave_expires_tracked_keys</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>slave_expires_tracked_keys metric</td></tr><tr><td>redis_slave_info</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>read_only</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td><td>Information about the Redis slave</td></tr><tr><td>redis_slave_priority</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>slave_priority metric</td></tr><tr><td>redis_slave_repl_offset</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td><td>Slave replication offset</td></tr><tr><td>redis_slowlog_last_id</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Last id of slowlog</td></tr><tr><td>redis_slowlog_length</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Total slowlog</td></tr><tr><td>redis_start_time_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Start time of the Redis instance since unix epoch in seconds.</td></tr><tr><td>redis_target_scrape_request_errors_total</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Errors in requests to the exporter</td></tr><tr><td>redis_total_error_replies</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>total_error_replies metric</td></tr><tr><td>redis_total_reads_processed</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>total_reads_processed metric</td></tr><tr><td>redis_total_system_memory_bytes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>total_system_memory_bytes metric</td></tr><tr><td>redis_total_writes_processed</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>total_writes_processed metric</td></tr><tr><td>redis_tracking_clients</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>tracking_clients metric</td></tr><tr><td>redis_tracking_total_items</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>tracking_total_items metric</td></tr><tr><td>redis_tracking_total_keys</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>tracking_total_keys metric</td></tr><tr><td>redis_tracking_total_prefixes</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>tracking_total_prefixes metric</td></tr><tr><td>redis_unexpected_error_replies</td><td>counter</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>unexpected_error_replies metric</td></tr><tr><td>redis_up</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>Information about the Redis instance</td></tr><tr><td>redis_uptime_in_seconds</td><td>gauge</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>uptime_in_seconds metric</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b2e89e0d2e5fa7361edacff6f86e00ea>7 - 常见问题</h1><div class=lead>Pigsty REDIS 模块常见问题答疑</div><hr><h2 id=redis移除失败abort-due-to-redis_safeguard-enabled>Redis移除失败：ABORT due to redis_safeguard enabled</h2><p>这意味着正准备移除的 Redis 实例打开了防误删保险：当 <a href=/docs/redis/param#redis_safeguard><code>redis_safeguard</code></a> 设置为 <code>true</code> 时，<code>redis-rm.yml</code> 剧本会拒绝执行，防止误删正在运行的 Redis 实例。</p><p>您可以通过命令行参数 <code>-e redis_safeguard=false</code> 来覆盖此保护，强制移除 Redis 实例。这就是 <code>redis_safeguard</code> 的设计目的。</p><hr><h2 id=如何在某个节点上添加一个新的redis实例>如何在某个节点上添加一个新的Redis实例？</h2><p>使用 <code>bin/redis-add &lt;ip> &lt;port></code> 在节点上部署一个新的redis实例。</p><hr><h2 id=如何从节点上移除一个特定实例>如何从节点上移除一个特定实例？</h2><p>使用 <code>bin/redis-rm &lt;ip> &lt;port></code> 从节点上移除一个单独的redis实例。</p><hr><h2 id=是否有计划升级到-valkey-或最新版本>是否有计划升级到 Valkey 或最新版本？</h2><p>当前 Pigsty v4.1 仍以 Redis 7.2 BSD 分支作为默认实现，尚未切换到 Redis 新许可证版本或 Valkey 作为默认组件。
不同操作系统渠道里的 Redis 小版本可能不同（例如 APT 渠道可见 7.2.7），请以您实际使用仓库中的包版本为准。</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>