<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/pgsql/ext/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/pgsql/ext/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>扩展插件 | PIGSTY</title><meta name=description content="利用 PostgreSQL 扩展的协同超能力"><meta property="og:url" content="https://pigsty.cc/docs/pgsql/ext/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="扩展插件"><meta property="og:description" content="利用 PostgreSQL 扩展的协同超能力"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="扩展插件"><meta itemprop=description content="利用 PostgreSQL 扩展的协同超能力"><meta itemprop=dateModified content="2026-02-14T08:23:51+08:00"><meta itemprop=wordCount content="51"><meta itemprop=keywords content="参考,PGSQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="扩展插件"><meta name=twitter:description content="利用 PostgreSQL 扩展的协同超能力"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/pgsql/ext/>返回本页常规视图</a>.</p></div><h1 class=title>扩展插件</h1><div class=lead>利用 PostgreSQL 扩展的协同超能力</div><ul><li>1: <a href=#pg-cb575384aee4c018fb0db527378640fd>快速开始</a></li><li>2: <a href=#pg-37c08dbc246cb158947abfb17f172ecc>扩展简介</a></li><li>3: <a href=#pg-6c21bc6ef6cf2173aeb9948071de953f>软件包</a></li><li>4: <a href=#pg-96a6a67c2f3d2429fabeed6f98b76c7f>下载扩展</a></li><li>5: <a href=#pg-128bcfdba2d6b955af1661f0a806fd9e>安装扩展</a></li><li>6: <a href=#pg-8c405665bb423ccc536997bd9c3a64ca>配置扩展</a></li><li>7: <a href=#pg-5b462599a5e29b51a35ede5bb5e310a8>启用扩展</a></li><li>8: <a href=#pg-aeb68b34de12844024f2519dd13df6f0>更新扩展</a></li><li>9: <a href=#pg-13869765de25ae294c556ad54ac4ee27>移除扩展</a></li><li>10: <a href=#pg-cd40e09e16b398209123543c21e68960>默认扩展</a></li><li>11: <a href=#pg-fef9a9d4af92d185f18fab30d92a530d>扩展仓库</a></li></ul><div class=content><p>Pigsty 提供 <a href=https://pgext.cloud/zh/list><strong>451</strong> 扩展</a>，覆盖时序、地理、向量、全文检索、分析、特性增强等 16 大类别，开箱即用。</p><p>在 Pigsty 中使用扩展涉及四个核心步骤：<a href=/docs/pgsql/ext/download><strong>下载</strong></a>、<a href=/docs/pgsql/ext/install><strong>安装</strong></a>、<a href=/docs/pgsql/ext/config><strong>配置/加载</strong></a> 与 <a href=/docs/pgsql/ext/create><strong>启用</strong></a>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, vector ]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 启用：在数据库中创建扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 配置：预加载扩展库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector ] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 安装：安装扩展软件包</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><img src=/img/pigsty/ecosystem.png alt></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-cb575384aee4c018fb0db527378640fd>1 - 快速开始</h1><div class=lead>使用扩展的四步流程速览</div><p>在 Pigsty 中使用扩展需要四个步骤：<strong>下载</strong>、<strong>安装</strong>、<strong>配置</strong>、<strong>启用</strong>。</p><ol><li><strong>下载</strong>：将扩展软件包下载到本地仓库（Pigsty 默认已下载主流扩展）</li><li><strong>安装</strong>：在集群节点上安装扩展软件包</li><li><strong>配置</strong>：部分扩展需要预加载或配置参数</li><li><strong>启用</strong>：在数据库中执行 <code>CREATE EXTENSION</code> 创建扩展</li></ol><hr><h2 id=声明式配置>声明式配置</h2><p>在 Pigsty 配置清单中声明扩展，集群初始化时自动完成安装与启用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, vector ]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 在数据库中启用扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 预加载扩展库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector ] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 安装扩展软件包</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>执行 <code>./pgsql.yml</code> 初始化集群后，<code>postgis</code>、<code>timescaledb</code>、<code>vector</code> 三个扩展即在 <code>meta</code> 数据库中可用。</p><hr><h2 id=命令式操作>命令式操作</h2><p>对于已有集群，可以使用命令行方式添加扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 安装扩展软件包</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-meta -t pg_extension -e <span style=color:#4e9a06>&#39;{&#34;pg_extensions&#34;:[&#34;pgvector&#34;]}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 预加载扩展（如需要，修改后需重启）</span>
</span></span><span style=display:flex><span>pg edit-config pg-meta --force -p <span style=color:#000>shared_preload_libraries</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 在数据库中启用扩展</span>
</span></span><span style=display:flex><span>psql -d meta -c <span style=color:#4e9a06>&#39;CREATE EXTENSION vector;&#39;</span>
</span></span></code></pre></div><p>也可以使用 <a href=https://pgext.cloud/pig>pig</a> 包管理器直接安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig install pgvector        <span style=color:#8f5902;font-style:italic># 安装扩展包</span>
</span></span><span style=display:flex><span>pig extension create vector  <span style=color:#8f5902;font-style:italic># 在数据库中启用</span>
</span></span></code></pre></div><hr><h2 id=流程速查>流程速查</h2><table class=full-width><thead><tr><th style=text-align:center>步骤</th><th style=text-align:left>参数/命令</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:center>下载</td><td style=text-align:left><a href=/docs/infra/param#repo_extra_packages><code>repo_extra_packages</code></a></td><td style=text-align:left>指定下载到本地仓库的扩展包</td></tr><tr><td style=text-align:center>安装</td><td style=text-align:left><a href=/docs/pgsql/param#pg_extensions><code>pg_extensions</code></a></td><td style=text-align:left>指定集群要安装的扩展包</td></tr><tr><td style=text-align:center>配置</td><td style=text-align:left><a href=/docs/pgsql/param#pg_libs><code>pg_libs</code></a></td><td style=text-align:left>预加载扩展到 <code>shared_preload_libraries</code></td></tr><tr><td style=text-align:center>启用</td><td style=text-align:left><a href=/docs/pgsql/config/db><code>pg_databases.extensions</code></a></td><td style=text-align:left>在数据库中自动执行 <code>CREATE EXTENSION</code></td></tr></tbody></table><blockquote><p>详细说明请参阅各子章节：<a href=/docs/pgsql/ext/download/>下载</a>、<a href=/docs/pgsql/ext/install/>安装</a>、<a href=/docs/pgsql/ext/config/>配置</a>、<a href=/docs/pgsql/ext/create/>启用</a></p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-37c08dbc246cb158947abfb17f172ecc>2 - 扩展简介</h1><div class=lead>PostgreSQL 扩展的核心概念与 Pigsty 扩展生态</div><p>扩展是 PostgreSQL 的灵魂所在。Pigsty 收录了 451 个预编译、开箱即用的扩展插件，充分释放 PostgreSQL 的潜能。</p><hr><h2 id=扩展是什么>扩展是什么</h2><p>PostgreSQL 扩展（Extension）是一种模块化机制，允许在不修改核心代码的情况下增强数据库功能。
一个扩展通常包含三部分：</p><ul><li><strong>控制文件</strong>（<code>.control</code>）：必需，包含扩展元数据</li><li><strong>SQL 脚本</strong>（<code>.sql</code>）：可选，定义函数、类型、操作符等数据库对象</li><li><strong>动态库</strong>（<code>.so</code>）：可选，提供 C 语言实现的高性能功能</li></ul><p>扩展可以为 PostgreSQL 添加：新数据类型、索引方法、函数与操作符、外部数据访问、过程语言、性能监控、安全审计等能力。</p><hr><h2 id=核心扩展>核心扩展</h2><p>Pigsty 收录的扩展中，以下是最具代表性的：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://postgis.net/><strong>PostGIS</strong></a></td><td style=text-align:left>地理空间数据类型与索引，GIS 事实标准</td></tr><tr><td style=text-align:left><a href=https://www.timescale.com/><strong>TimescaleDB</strong></a></td><td style=text-align:left>时序数据库，支持持续聚合、列存储、自动压缩</td></tr><tr><td style=text-align:left><a href=https://github.com/pgvector/pgvector><strong>PGVector</strong></a></td><td style=text-align:left>向量数据类型与 HNSW/IVFFlat 索引，AI 应用必备</td></tr><tr><td style=text-align:left><a href=https://www.citusdata.com/><strong>Citus</strong></a></td><td style=text-align:left>分布式数据库，水平分片扩展能力</td></tr><tr><td style=text-align:left><a href=https://github.com/duckdb/pg_duckdb><strong>pg_duckdb</strong></a></td><td style=text-align:left>嵌入 DuckDB 分析引擎，OLAP 加速</td></tr><tr><td style=text-align:left><a href=https://www.paradedb.com/><strong>ParadeDB</strong></a></td><td style=text-align:left>ElasticSearch 级别的全文搜索能力</td></tr><tr><td style=text-align:left><a href=https://age.apache.org/><strong>Apache AGE</strong></a></td><td style=text-align:left>图数据库，支持 OpenCypher 查询语言</td></tr><tr><td style=text-align:left><a href=https://github.com/supabase/pg_graphql><strong>pg_graphql</strong></a></td><td style=text-align:left>原生 GraphQL 查询支持</td></tr></tbody></table><p>绝大多数扩展可以并存甚至组合使用，产生 1+1 远大于 2 的协同效应。</p><hr><h2 id=扩展类别>扩展类别</h2><p>Pigsty 将扩展划分为 16 个类别：</p><table class=full-width><thead><tr><th style=text-align:center>类别</th><th style=text-align:left>别名</th><th style=text-align:left>说明</th><th style=text-align:left>典型扩展</th></tr></thead><tbody><tr><td style=text-align:center>时序</td><td style=text-align:left><code>time</code></td><td style=text-align:left>时序数据处理</td><td style=text-align:left>timescaledb, pg_cron, periods</td></tr><tr><td style=text-align:center>地理</td><td style=text-align:left><code>gis</code></td><td style=text-align:left>地理空间数据</td><td style=text-align:left>postgis, h3, pgrouting</td></tr><tr><td style=text-align:center>向量</td><td style=text-align:left><code>rag</code></td><td style=text-align:left>向量检索与 AI</td><td style=text-align:left>pgvector, vchord, pg_vectorize</td></tr><tr><td style=text-align:center>搜索</td><td style=text-align:left><code>fts</code></td><td style=text-align:left>全文检索</td><td style=text-align:left>pgroonga, zhparser, pg_bigm</td></tr><tr><td style=text-align:center>分析</td><td style=text-align:left><code>olap</code></td><td style=text-align:left>OLAP 与分析</td><td style=text-align:left>pg_duckdb, pg_mooncake, citus</td></tr><tr><td style=text-align:center>特性</td><td style=text-align:left><code>feat</code></td><td style=text-align:left>功能增强</td><td style=text-align:left>age, pg_graphql, hll, rum</td></tr><tr><td style=text-align:center>语言</td><td style=text-align:left><code>lang</code></td><td style=text-align:left>过程语言</td><td style=text-align:left>plpython3u, pljava, plv8</td></tr><tr><td style=text-align:center>类型</td><td style=text-align:left><code>type</code></td><td style=text-align:left>数据类型</td><td style=text-align:left>hstore, ltree, ip4r</td></tr><tr><td style=text-align:center>工具</td><td style=text-align:left><code>util</code></td><td style=text-align:left>实用工具</td><td style=text-align:left>http, pg_net, pgjwt</td></tr><tr><td style=text-align:center>函数</td><td style=text-align:left><code>func</code></td><td style=text-align:left>函数库</td><td style=text-align:left>pg_uuidv7, topn, tdigest</td></tr><tr><td style=text-align:center>管理</td><td style=text-align:left><code>admin</code></td><td style=text-align:left>运维管理</td><td style=text-align:left>pg_repack, pg_squeeze, pgagent</td></tr><tr><td style=text-align:center>统计</td><td style=text-align:left><code>stat</code></td><td style=text-align:left>监控统计</td><td style=text-align:left>pg_stat_statements, pg_qualstats, auto_explain</td></tr><tr><td style=text-align:center>安全</td><td style=text-align:left><code>sec</code></td><td style=text-align:left>安全审计</td><td style=text-align:left>pgaudit, pgsodium, pg_tde</td></tr><tr><td style=text-align:center>外联</td><td style=text-align:left><code>fdw</code></td><td style=text-align:left>外部数据访问</td><td style=text-align:left>postgres_fdw, mysql_fdw, oracle_fdw</td></tr><tr><td style=text-align:center>兼容</td><td style=text-align:left><code>sim</code></td><td style=text-align:left>数据库兼容</td><td style=text-align:left>orafce, babelfish</td></tr><tr><td style=text-align:center>同步</td><td style=text-align:left><code>etl</code></td><td style=text-align:left>数据同步</td><td style=text-align:left>pglogical, wal2json, decoderbufs</td></tr></tbody></table><p>使用类别别名可以批量安装整个类别的扩展，例如 <code>pg_extensions: [ pgsql-gis, pgsql-rag ]</code>。</p><hr><h2 id=预定义扩展集>预定义扩展集</h2><p>Pigsty 提供了若干预定义的扩展集（Stack），方便按场景选用：</p><table class=full-width><thead><tr><th style=text-align:left>扩展集</th><th style=text-align:left>包含扩展</th></tr></thead><tbody><tr><td style=text-align:left><code>gis-stack</code></td><td style=text-align:left>postgis, pgrouting, pointcloud, h3, q3c, ogr_fdw</td></tr><tr><td style=text-align:left><code>rag-stack</code></td><td style=text-align:left>pgvector, vchord, pgvectorscale, pg_similarity, pg_tiktoken</td></tr><tr><td style=text-align:left><code>fts-stack</code></td><td style=text-align:left>pgroonga, pg_bigm, zhparser, hunspell</td></tr><tr><td style=text-align:left><code>olap-stack</code></td><td style=text-align:left>pg_duckdb, pg_mooncake, timescaledb, pg_partman, plproxy</td></tr><tr><td style=text-align:left><code>feat-stack</code></td><td style=text-align:left>age, hll, rum, pg_graphql, pg_jsonschema, jsquery</td></tr><tr><td style=text-align:left><code>stat-stack</code></td><td style=text-align:left>pg_show_plans, pg_stat_kcache, pg_qualstats, pg_wait_sampling</td></tr><tr><td style=text-align:left><code>supa-stack</code></td><td style=text-align:left>pg_graphql, pg_jsonschema, wrappers, pgvector, pgsodium, vault</td></tr></tbody></table><p>在 <code>pg_extensions</code> 中直接使用这些名称即可安装整套扩展。</p><hr><h2 id=扩展资源>扩展资源</h2><ul><li><a href=https://pgext.cloud/zh/list><strong>扩展目录</strong></a>：查阅所有可用扩展的详细信息</li><li><a href=https://pgext.cloud/zh/repo/><strong>扩展仓库</strong></a>：Pigsty 扩展软件仓库</li><li><a href=https://pgext.cloud/pig><strong>pig 包管理器</strong></a>：命令行扩展管理工具</li><li><a href=https://github.com/pgsty/pigsty><strong>GitHub Pigsty</strong></a>：Pigsty 源代码仓库</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c21bc6ef6cf2173aeb9948071de953f>3 - 软件包</h1><div class=lead>扩展包别名与类别命名规则</div><p>Pigsty 使用<strong>包别名</strong>机制简化扩展的安装与管理。</p><hr><h2 id=包别名机制>包别名机制</h2><p>管理扩展涉及多个层面的名称映射：</p><table class=full-width><thead><tr><th style=text-align:left>层面</th><th style=text-align:left>示例 <code>pgvector</code></th><th style=text-align:left>示例 <code>postgis</code></th></tr></thead><tbody><tr><td style=text-align:left>扩展名</td><td style=text-align:left><code>vector</code></td><td style=text-align:left><code>postgis</code>, <code>postgis_topology</code>, &mldr;</td></tr><tr><td style=text-align:left>包别名</td><td style=text-align:left><code>pgvector</code></td><td style=text-align:left><code>postgis</code></td></tr><tr><td style=text-align:left>RPM 包名</td><td style=text-align:left><code>pgvector_18</code></td><td style=text-align:left><code>postgis36_18*</code></td></tr><tr><td style=text-align:left>DEB 包名</td><td style=text-align:left><code>postgresql-18-pgvector</code></td><td style=text-align:left><code>postgresql-18-postgis-3*</code></td></tr></tbody></table><p>Pigsty 提供<strong>包别名</strong>抽象层，让用户无需关心具体的 RPM/DEB 包名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector, postgis, timescaledb ] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 使用包别名</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty 会根据操作系统和 PostgreSQL 版本自动翻译为正确的包名。</p><blockquote><p>注意：<code>CREATE EXTENSION</code> 时使用的是<strong>扩展名</strong>（如 <code>vector</code>），而非包别名（<code>pgvector</code>）。</p></blockquote><hr><h2 id=类别别名>类别别名</h2><p>所有扩展被划分为 16 个类别，可使用类别别名批量安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用通用类别别名（自动适配当前 PG 版本）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-gis, pgsql-rag, pgsql-fts ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或使用版本特定的类别别名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pg18-gis, pg18-rag, pg18-fts ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>除 <code>olap</code> 类别外，所有类别的扩展都可以同时安装。<code>olap</code> 类别中存在互斥：<code>pg_duckdb</code> 与 <code>pg_mooncake</code> 冲突。</p><hr><h2 id=类别列表>类别列表</h2><table class=full-width><thead><tr><th style=text-align:center>类别</th><th style=text-align:left>说明</th><th style=text-align:left>典型扩展</th></tr></thead><tbody><tr><td style=text-align:center><code>time</code></td><td style=text-align:left>时序类</td><td style=text-align:left>timescaledb, pg_cron, periods</td></tr><tr><td style=text-align:center><code>gis</code></td><td style=text-align:left>地理类</td><td style=text-align:left>postgis, h3, pgrouting</td></tr><tr><td style=text-align:center><code>rag</code></td><td style=text-align:left>向量类</td><td style=text-align:left>pgvector, pgml, vchord</td></tr><tr><td style=text-align:center><code>fts</code></td><td style=text-align:left>搜索类</td><td style=text-align:left>pg_trgm, zhparser, pgroonga</td></tr><tr><td style=text-align:center><code>olap</code></td><td style=text-align:left>分析类</td><td style=text-align:left>citus, pg_duckdb, pg_analytics</td></tr><tr><td style=text-align:center><code>feat</code></td><td style=text-align:left>特性类</td><td style=text-align:left>age, pg_graphql, rum</td></tr><tr><td style=text-align:center><code>lang</code></td><td style=text-align:left>语言类</td><td style=text-align:left>plpython3u, pljava, plv8</td></tr><tr><td style=text-align:center><code>type</code></td><td style=text-align:left>类型类</td><td style=text-align:left>hstore, ltree, citext</td></tr><tr><td style=text-align:center><code>util</code></td><td style=text-align:left>工具类</td><td style=text-align:left>http, pg_net, pgjwt</td></tr><tr><td style=text-align:center><code>func</code></td><td style=text-align:left>函数类</td><td style=text-align:left>pgcrypto, uuid-ossp, pg_uuidv7</td></tr><tr><td style=text-align:center><code>admin</code></td><td style=text-align:left>管理类</td><td style=text-align:left>pg_repack, pgagent, pg_squeeze</td></tr><tr><td style=text-align:center><code>stat</code></td><td style=text-align:left>统计类</td><td style=text-align:left>pg_stat_statements, pg_qualstats, auto_explain</td></tr><tr><td style=text-align:center><code>sec</code></td><td style=text-align:left>安全类</td><td style=text-align:left>pgaudit, pgcrypto, pgsodium</td></tr><tr><td style=text-align:center><code>fdw</code></td><td style=text-align:left>外部类</td><td style=text-align:left>postgres_fdw, mysql_fdw, oracle_fdw</td></tr><tr><td style=text-align:center><code>sim</code></td><td style=text-align:left>兼容类</td><td style=text-align:left>orafce, babelfishpg_tds</td></tr><tr><td style=text-align:center><code>etl</code></td><td style=text-align:left>数据类</td><td style=text-align:left>pglogical, wal2json, decoderbufs</td></tr></tbody></table><hr><h2 id=查阅扩展目录>查阅扩展目录</h2><p>您可以在 <a href=https://pgext.cloud/zh/list>Pigsty 扩展目录</a> 网站上查阅所有可用扩展的详细信息，包括：</p><ul><li>扩展名称、描述、版本</li><li>支持的 PostgreSQL 版本</li><li>支持的操作系统发行版</li><li>安装方式、预加载需求</li><li>许可证、来源仓库</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-96a6a67c2f3d2429fabeed6f98b76c7f>4 - 下载扩展</h1><div class=lead>从软件仓库下载扩展包到本地</div><p>在安装扩展前，需要确保扩展软件包已下载到本地仓库或可从上游获取。</p><hr><h2 id=默认行为>默认行为</h2><p>Pigsty 在安装过程中会自动下载默认 PostgreSQL 版本可用的主流扩展到本地软件仓库。</p><p>使用本地仓库的优势：</p><ul><li>加速安装，避免重复下载</li><li>减少网络流量消耗</li><li>提高交付可靠性</li><li>确保版本一致性</li></ul><hr><h2 id=下载新扩展>下载新扩展</h2><p>要下载额外的扩展，将其添加到 <a href=/docs/infra/param#repo_extra_packages><code>repo_extra_packages</code></a> 并重建仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_extra_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector, postgis, timescaledb, pg_duckdb ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重新下载软件包到本地仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 刷新所有节点的软件源缓存</span>
</span></span><span style=display:flex><span>./node.yml -t node_repo
</span></span></code></pre></div><hr><h2 id=使用上游仓库>使用上游仓库</h2><p>也可以直接从互联网上游仓库安装，无需预先下载：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 在节点上添加上游软件源</span>
</span></span><span style=display:flex><span>./node.yml -t node_repo -e <span style=color:#000>node_repo_modules</span><span style=color:#ce5c00;font-weight:700>=</span>node,pgsql
</span></span></code></pre></div><p>这种方式适合：</p><ul><li>快速测试最新版本</li><li>安装冷门扩展</li><li>网络条件良好的环境</li></ul><p>但可能面临：</p><ul><li>网络不稳定影响安装</li><li>版本不一致风险</li></ul><hr><h2 id=扩展来源>扩展来源</h2><p>扩展软件包来自两个主要源：</p><table class=full-width><thead><tr><th style=text-align:left>仓库</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>PGDG</strong></td><td style=text-align:left>PostgreSQL 官方仓库，提供核心扩展</td></tr><tr><td style=text-align:left><strong>Pigsty</strong></td><td style=text-align:left>Pigsty 补充仓库，提供额外扩展</td></tr></tbody></table><p>Pigsty 仓库只收录 PGDG 仓库中不存在的扩展。一旦某扩展进入 PGDG 仓库，Pigsty 仓库会移除或与其保持一致。</p><p>仓库地址：</p><ul><li>PGDG YUM: <a href=https://download.postgresql.org/pub/repos/yum/>https://download.postgresql.org/pub/repos/yum/</a></li><li>PGDG APT: <a href=https://apt.postgresql.org/pub/repos/apt/>https://apt.postgresql.org/pub/repos/apt/</a></li><li>Pigsty YUM: <a href=https://repo.pigsty.io/yum/>https://repo.pigsty.io/yum/</a></li><li>Pigsty APT: <a href=https://repo.pigsty.io/apt/>https://repo.pigsty.io/apt/</a></li></ul><p>详细的仓库配置请参阅 <a href=/docs/pgsql/ext/repo/>扩展仓库</a>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-128bcfdba2d6b955af1661f0a806fd9e>5 - 安装扩展</h1><div class=lead>在集群节点上安装扩展软件包</div><p>Pigsty 使用操作系统的包管理器（yum/apt）安装扩展软件包。</p><hr><h2 id=相关参数>相关参数</h2><p>两个参数用于指定要安装的扩展：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>用途</th><th style=text-align:left>默认行为</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/pgsql/param#pg_packages><code>pg_packages</code></a></td><td style=text-align:left>全局通用软件包</td><td style=text-align:left>确保存在（不升级）</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/param#pg_extensions><code>pg_extensions</code></a></td><td style=text-align:left>集群特定扩展</td><td style=text-align:left>安装最新版本</td></tr></tbody></table><p><code>pg_packages</code> 通常用于指定所有集群都需要的基础组件（PostgreSQL 内核、Patroni、pgBouncer 等）和必选扩展。</p><p><code>pg_extensions</code> 用于指定特定集群需要的扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># 全局基础包</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-main pgsql-common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># 集群扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>postgis timescaledb pgvector</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=集群初始化时安装>集群初始化时安装</h2><p>在集群配置中声明扩展，初始化时自动安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector, pg_duckdb ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>执行 <code>./pgsql.yml</code> 初始化集群时，扩展会自动安装。</p><hr><h2 id=已有集群安装扩展>已有集群安装扩展</h2><p>对于已初始化的集群，有多种方式安装扩展：</p><h3 id=使用-pigsty-剧本>使用 Pigsty 剧本</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 修改配置后使用剧本安装</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-meta -t pg_extension
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或直接在命令行指定扩展</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-meta -t pg_extension -e <span style=color:#4e9a06>&#39;{&#34;pg_extensions&#34;:[&#34;pg_duckdb&#34;]}&#39;</span>
</span></span></code></pre></div><h3 id=使用-pig-包管理器>使用 pig 包管理器</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 pig 安装扩展</span>
</span></span><span style=display:flex><span>pig install pg_duckdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 批量安装</span>
</span></span><span style=display:flex><span>ansible pg-meta -b -a <span style=color:#4e9a06>&#39;pig install pg_duckdb pgvector&#39;</span>
</span></span></code></pre></div><h3 id=直接使用包管理器>直接使用包管理器</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 系统</span>
</span></span><span style=display:flex><span>sudo yum install -y pg_duckdb_18*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Debian/Ubuntu 系统</span>
</span></span><span style=display:flex><span>sudo apt install -y postgresql-18-pg-duckdb
</span></span></code></pre></div><hr><h2 id=使用包别名>使用包别名</h2><p>Pigsty 支持使用标准化的包别名，自动翻译为对应 PG 版本的包名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgvector          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 自动翻译为 pgvector_18* (EL) 或 postgresql-18-pgvector (Debian)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>postgis           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 自动翻译为 postgis36_18* (EL) 或 postgresql-18-postgis-3* (Debian)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-gis         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 类别别名，安装整个 GIS 类别的扩展</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>也可以直接使用原始包名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgvector_18*                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># EL 系统的原始包名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>postgresql-18-pgvector         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Debian 系统的原始包名</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>包别名定义参见：</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el8.x86_64.yml>EL8 扩展列表</a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/el9.x86_64.yml>EL9 扩展列表</a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/d12.x86_64.yml>D12 扩展列表</a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u22.x86_64.yml>U22 扩展列表</a></li><li><a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/u24.x86_64.yml>U24 扩展列表</a></li></ul><hr><h2 id=验证安装>验证安装</h2><p>安装后可在数据库中验证：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看已安装的扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_available_extensions</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>name</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;vector&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展文件是否存在
</span></span></span><span style=display:flex><span><span style=color:#a40000>\</span><span style=color:#000>dx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8c405665bb423ccc536997bd9c3a64ca>6 - 配置扩展</h1><div class=lead>预加载扩展库与配置扩展参数</div><p>部分扩展需要预加载动态库或配置参数后才能使用，本节介绍如何配置扩展。</p><hr><h2 id=预加载扩展>预加载扩展</h2><p>大多数扩展安装后可直接使用 <code>CREATE EXTENSION</code> 启用，但部分使用 PostgreSQL Hook 机制的扩展需要<strong>预加载</strong>。</p><p>预加载通过 <code>shared_preload_libraries</code> 参数指定，修改后需<strong>重启数据库</strong>生效。</p><h3 id=需要预加载的扩展>需要预加载的扩展</h3><p>以下是常见的需要预加载的扩展：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>timescaledb</code></td><td style=text-align:left>时序数据库扩展，必须放在最前面</td></tr><tr><td style=text-align:left><code>citus</code></td><td style=text-align:left>分布式数据库扩展，必须放在最前面</td></tr><tr><td style=text-align:left><code>pg_stat_statements</code></td><td style=text-align:left>SQL 语句统计，Pigsty 默认启用</td></tr><tr><td style=text-align:left><code>auto_explain</code></td><td style=text-align:left>自动记录慢查询执行计划，Pigsty 默认启用</td></tr><tr><td style=text-align:left><code>pg_cron</code></td><td style=text-align:left>定时任务调度</td></tr><tr><td style=text-align:left><code>pg_net</code></td><td style=text-align:left>异步 HTTP 请求</td></tr><tr><td style=text-align:left><code>pg_tle</code></td><td style=text-align:left>可信语言扩展</td></tr><tr><td style=text-align:left><code>pgaudit</code></td><td style=text-align:left>审计日志</td></tr><tr><td style=text-align:left><code>pg_stat_kcache</code></td><td style=text-align:left>内核统计信息</td></tr><tr><td style=text-align:left><code>pg_squeeze</code></td><td style=text-align:left>在线表空间回收</td></tr><tr><td style=text-align:left><code>pgml</code></td><td style=text-align:left>PostgresML 机器学习</td></tr></tbody></table><p>完整列表请参阅 <a href=https://pgext.cloud/zh/list>扩展目录</a>（带 <code>LOAD</code> 标记）。</p><h3 id=预加载顺序>预加载顺序</h3><p><code>shared_preload_libraries</code> 中扩展的加载顺序很重要：</p><ul><li><code>timescaledb</code> 和 <code>citus</code> 必须放在<strong>最前面</strong></li><li>如果同时使用，<code>citus</code> 应在 <code>timescaledb</code> 之前</li><li>统计类扩展应在 <code>pg_stat_statements</code> 之后，以使用相同的 query_id</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;citus, timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=集群初始化时配置>集群初始化时配置</h2><p>在创建新集群时，使用 <a href=/docs/pgsql/param#pg_libs><code>pg_libs</code></a> 参数指定预加载的扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>timescaledb, postgis, pgvector ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>pg_libs</code> 的值将在集群初始化时写入 <code>shared_preload_libraries</code>。</p><h3 id=默认值>默认值</h3><p><a href=/docs/pgsql/param#pg_libs><code>pg_libs</code></a> 的默认值是 <code>pg_stat_statements, auto_explain</code>，这两个 Contrib 扩展提供基本的可观测性：</p><ul><li><code>pg_stat_statements</code>：跟踪所有 SQL 语句的执行统计</li><li><code>auto_explain</code>：自动记录慢查询的执行计划</li></ul><hr><h2 id=已有集群修改配置>已有集群修改配置</h2><p>对于已初始化的集群，使用 <code>patronictl</code> 修改 <code>shared_preload_libraries</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 添加 timescaledb 到预加载库</span>
</span></span><span style=display:flex><span>pg edit-config pg-meta --force -p <span style=color:#000>shared_preload_libraries</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重启集群使配置生效</span>
</span></span><span style=display:flex><span>pg restart pg-meta
</span></span></code></pre></div><p>也可以直接修改 <code>postgresql.conf</code> 或使用 <code>ALTER SYSTEM</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SYSTEM</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>shared_preload_libraries</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>修改后需重启 PostgreSQL 服务生效。</p><hr><h2 id=扩展参数配置>扩展参数配置</h2><p>许多扩展有可配置的参数，可以在以下位置设置：</p><h3 id=集群初始化时>集群初始化时</h3><p>使用 <a href=/docs/pgsql/param#pg_parameters><code>pg_parameters</code></a> 参数指定：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_cron, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>cron.database_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pg_cron 使用的数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_stat_statements.track</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 跟踪所有语句</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>auto_explain.log_min_duration</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1000</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 记录超过 1 秒的查询</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=运行时修改>运行时修改</h3><p>使用 <code>ALTER SYSTEM</code> 或 <code>patronictl</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 修改参数
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SYSTEM</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SET</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_stat_statements</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>track</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 重新加载配置
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_reload_conf</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 patronictl 修改</span>
</span></span><span style=display:flex><span>pg edit-config pg-meta --force -p <span style=color:#4e9a06>&#39;pg_stat_statements.track=all&#39;</span>
</span></span></code></pre></div><hr><h2 id=注意事项>注意事项</h2><ol><li><p><strong>预加载错误会阻止启动</strong>：如果 <code>shared_preload_libraries</code> 中的扩展不存在或加载失败，PostgreSQL 将无法启动。确保扩展已正确安装后再添加预加载。</p></li><li><p><strong>修改需重启</strong>：<code>shared_preload_libraries</code> 的修改需要重启 PostgreSQL 服务才能生效。</p></li><li><p><strong>部分功能可用</strong>：某些扩展在不预加载的情况下可以部分使用，但完整功能需要预加载。</p></li><li><p><strong>查看当前配置</strong>：使用以下命令查看当前的预加载库：</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHOW</span><span style=color:#f8f8f8> </span><span style=color:#000>shared_preload_libraries</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5b462599a5e29b51a35ede5bb5e310a8>7 - 启用扩展</h1><div class=lead>在数据库中创建和启用扩展</div><p>安装扩展软件包后，需要在数据库中执行 <code>CREATE EXTENSION</code> 才能使用扩展功能。</p><hr><h2 id=查看可用扩展>查看可用扩展</h2><p>安装扩展软件包后，可以查看可用的扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看所有可用扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_available_extensions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看特定扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_available_extensions</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>name</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;vector&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看已启用的扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=创建扩展>创建扩展</h2><p>使用 <code>CREATE EXTENSION</code> 在数据库中启用扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 创建扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>vector</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 创建扩展到指定 Schema
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SCHEMA</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 自动安装依赖的扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis_topology</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 如果不存在则创建
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>vector</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>注意：<code>CREATE EXTENSION</code> 使用的是<strong>扩展名</strong>（如 <code>vector</code>），而非包别名（<code>pgvector</code>）。</p></blockquote><hr><h2 id=集群初始化时启用>集群初始化时启用</h2><p>在 <a href=/docs/pgsql/param#pg_databases><code>pg_databases</code></a> 中声明扩展，集群初始化时自动创建：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>vector }                        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 使用默认 Schema</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public }       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 指定 Schema</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_stat_statements, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty 会在数据库创建后自动执行 <code>CREATE EXTENSION</code>。</p><hr><h2 id=需要预加载的扩展>需要预加载的扩展</h2><p>部分扩展需要先添加到 <code>shared_preload_libraries</code> 并重启后才能创建：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>timescaledb } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 需要预加载</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>如果未预加载就尝试创建，会收到错误信息。</p><p>需要预加载的常见扩展：<code>timescaledb</code>, <code>citus</code>, <code>pg_cron</code>, <code>pg_net</code>, <code>pgaudit</code> 等。详见 <a href=/docs/pgsql/ext/config/>配置扩展</a>。</p><hr><h2 id=扩展依赖>扩展依赖</h2><p>某些扩展依赖于其他扩展，需要按顺序创建：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- postgis_topology 依赖 postgis
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis_topology</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 或使用 CASCADE 自动安装依赖
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis_topology</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=不需要创建的扩展>不需要创建的扩展</h2><p>少数扩展不通过 SQL 接口对外服务，无需执行 <code>CREATE EXTENSION</code>：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>wal2json</code></td><td style=text-align:left>逻辑解码插件，直接在复制槽中使用</td></tr><tr><td style=text-align:left><code>decoderbufs</code></td><td style=text-align:left>逻辑解码插件</td></tr><tr><td style=text-align:left><code>decoder_raw</code></td><td style=text-align:left>逻辑解码插件</td></tr></tbody></table><p>这些扩展安装后即可使用，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 使用 wal2json 创建逻辑复制槽
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_create_logical_replication_slot</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;test_slot&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;wal2json&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=查看扩展信息>查看扩展信息</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展详情
</span></span></span><span style=display:flex><span><span style=color:#a40000>\</span><span style=color:#000>dx</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8> </span><span style=color:#000>vector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展包含的对象
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension_config_dump</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;vector&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展版本
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>extversion</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>extname</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;vector&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-aeb68b34de12844024f2519dd13df6f0>8 - 更新扩展</h1><div class=lead>升级 PostgreSQL 扩展版本</div><p>扩展更新涉及两个层面：<strong>软件包更新</strong>（操作系统层面）和<strong>扩展对象更新</strong>（数据库层面）。</p><hr><h2 id=更新软件包>更新软件包</h2><p>使用包管理器更新扩展的软件包：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 系统</span>
</span></span><span style=display:flex><span>sudo yum update pgvector_18*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Debian/Ubuntu 系统</span>
</span></span><span style=display:flex><span>sudo apt update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sudo apt upgrade postgresql-18-pgvector
</span></span></code></pre></div><p>使用 Pigsty 批量更新：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 更新指定集群的扩展包</span>
</span></span><span style=display:flex><span>./pgsql.yml -l pg-meta -t pg_extension -e <span style=color:#4e9a06>&#39;{&#34;pg_extensions&#34;:[&#34;pgvector&#34;]}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 pig 包管理器</span>
</span></span><span style=display:flex><span>pig update pgvector
</span></span></code></pre></div><hr><h2 id=更新扩展对象>更新扩展对象</h2><p>软件包更新后，数据库中的扩展对象可能需要同步更新。</p><h3 id=查看可更新的扩展>查看可更新的扩展</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看已安装扩展及其版本
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>default_version</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>installed_version</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_available_extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>installed_version</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看可升级的扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>installed_version</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>default_version</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_available_extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>installed_version</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>AND</span><span style=color:#f8f8f8> </span><span style=color:#000>installed_version</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>&lt;&gt;</span><span style=color:#f8f8f8> </span><span style=color:#000>default_version</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=执行扩展更新>执行扩展更新</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 更新到最新版本
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UPDATE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 更新到指定版本
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>UPDATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.8.0&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=查看更新路径>查看更新路径</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展的可用升级路径
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension_update_paths</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;pgvector&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=注意事项>注意事项</h2><ol><li><p><strong>备份优先</strong>：更新扩展前建议先备份数据库，特别是涉及数据类型变更的扩展。</p></li><li><p><strong>检查兼容性</strong>：某些扩展的大版本升级可能不兼容，需查阅扩展的升级文档。</p></li><li><p><strong>预加载扩展</strong>：如果更新的是需要预加载的扩展（如 <code>timescaledb</code>），更新后可能需要重启数据库。</p></li><li><p><strong>依赖关系</strong>：如果其他扩展依赖于被更新的扩展，需要按依赖顺序更新。</p></li><li><p><strong>复制环境</strong>：在主从复制环境中，应先在从库测试更新，确认无误后再更新主库。</p></li></ol><hr><h2 id=常见问题>常见问题</h2><h3 id=更新失败>更新失败</h3><p>如果 <code>ALTER EXTENSION UPDATE</code> 失败，可能是因为：</p><ul><li>没有可用的升级路径</li><li>扩展正在被使用</li><li>权限不足</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看扩展依赖
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_depend</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>refobjid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>oid</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>extname</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgvector&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=回滚更新>回滚更新</h3><p>PostgreSQL 扩展通常不支持直接回滚。如需回滚：</p><ol><li>从备份恢复</li><li>或者：卸载新版本扩展，安装旧版本软件包，重新创建扩展</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-13869765de25ae294c556ad54ac4ee27>9 - 移除扩展</h1><div class=lead>卸载 PostgreSQL 扩展</div><p>移除扩展涉及两个层面：<strong>删除扩展对象</strong>（数据库层面）和<strong>卸载软件包</strong>（操作系统层面）。</p><hr><h2 id=删除扩展对象>删除扩展对象</h2><p>使用 <code>DROP EXTENSION</code> 从数据库中删除扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 删除扩展
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 如果有依赖对象，需要级联删除
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p><strong>警告</strong>：<code>CASCADE</code> 会删除所有依赖于该扩展的对象（表、函数、视图等），请谨慎使用。</p></blockquote><h3 id=查看扩展依赖>查看扩展依赖</h3><p>删除前建议先检查依赖关系：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看依赖于某扩展的对象
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>classid</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>regclass</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>objid</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>deptype</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_depend</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>refobjid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>oid</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_extension</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>extname</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgvector&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 查看使用了扩展类型的表
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>relname</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>table_name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>attname</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>column_name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>typname</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>type_name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_attribute</span><span style=color:#f8f8f8> </span><span style=color:#000>a</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>JOIN</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_class</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>c</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>attrelid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>oid</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>JOIN</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_type</span><span style=color:#f8f8f8> </span><span style=color:#000>t</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8> </span><span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>atttypid</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>oid</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>typname</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;vector&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=移除预加载>移除预加载</h2><p>如果扩展在 <code>shared_preload_libraries</code> 中，删除后需要从预加载列表移除：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 修改 shared_preload_libraries，移除扩展</span>
</span></span><span style=display:flex><span>pg edit-config pg-meta --force -p <span style=color:#000>shared_preload_libraries</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重启使配置生效</span>
</span></span><span style=display:flex><span>pg restart pg-meta
</span></span></code></pre></div><hr><h2 id=卸载软件包>卸载软件包</h2><p>从数据库中删除扩展后，可以选择卸载软件包：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 系统</span>
</span></span><span style=display:flex><span>sudo yum remove pgvector_18*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Debian/Ubuntu 系统</span>
</span></span><span style=display:flex><span>sudo apt remove postgresql-18-pgvector
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 pig 包管理器</span>
</span></span><span style=display:flex><span>pig remove pgvector
</span></span></code></pre></div><blockquote><p>通常保留软件包不会有问题，仅在需要释放磁盘空间或解决冲突时才需要卸载。</p></blockquote><hr><h2 id=注意事项>注意事项</h2><ol><li><p><strong>数据丢失风险</strong>：使用 <code>CASCADE</code> 会删除依赖对象，可能导致数据丢失。</p></li><li><p><strong>应用兼容性</strong>：删除扩展前确保应用程序不再使用该扩展的功能。</p></li><li><p><strong>预加载顺序</strong>：如果删除的是预加载扩展，务必同时从 <code>shared_preload_libraries</code> 中移除，否则数据库可能无法启动。</p></li><li><p><strong>主从环境</strong>：在主从复制环境中，<code>DROP EXTENSION</code> 会自动复制到从库。</p></li></ol><hr><h2 id=操作顺序>操作顺序</h2><p>完整的扩展移除流程：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 检查依赖关系</span>
</span></span><span style=display:flex><span>psql -d mydb -c <span style=color:#4e9a06>&#34;SELECT * FROM pg_depend WHERE refobjid = (SELECT oid FROM pg_extension WHERE extname = &#39;pgvector&#39;);&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 删除数据库中的扩展</span>
</span></span><span style=display:flex><span>psql -d mydb -c <span style=color:#4e9a06>&#34;DROP EXTENSION pgvector;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 如果是预加载扩展，从 shared_preload_libraries 移除</span>
</span></span><span style=display:flex><span>pg edit-config pg-meta --force -p <span style=color:#000>shared_preload_libraries</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 重启数据库（如果修改了预加载配置）</span>
</span></span><span style=display:flex><span>pg restart pg-meta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 5. 可选：卸载软件包</span>
</span></span><span style=display:flex><span>sudo yum remove pgvector_18*
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-cd40e09e16b398209123543c21e68960>10 - 默认扩展</h1><div class=lead>Pigsty 默认安装的 PostgreSQL 扩展</div><p>Pigsty 在初始化 PostgreSQL 集群时，会默认安装和启用一些核心扩展。</p><hr><h2 id=默认安装的扩展>默认安装的扩展</h2><p>通过 <a href=/docs/pgsql/param#pg_packages><code>pg_packages</code></a> 默认安装的扩展：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>pg_repack</code></td><td style=text-align:left>在线处理表膨胀，重要的维护工具</td></tr><tr><td style=text-align:left><code>wal2json</code></td><td style=text-align:left>逻辑解码输出 JSON 格式变更，CDC 场景常用</td></tr></tbody></table><p>通过 <a href=/docs/pgsql/param#pg_extensions><code>pg_extensions</code></a> 可选安装的扩展（默认注释）：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>postgis</code></td><td style=text-align:left>地理空间数据库扩展</td></tr><tr><td style=text-align:left><code>timescaledb</code></td><td style=text-align:left>时序数据库扩展</td></tr><tr><td style=text-align:left><code>pgvector</code></td><td style=text-align:left>向量数据类型与索引</td></tr></tbody></table><hr><h2 id=默认启用的扩展>默认启用的扩展</h2><p>通过 <a href=/docs/pgsql/param#pg_default_extensions><code>pg_default_extensions</code></a> 在所有数据库中默认启用的扩展：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>Schema</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>pg_stat_statements</code></td><td style=text-align:left>monitor</td><td style=text-align:left>SQL 语句执行统计</td></tr><tr><td style=text-align:left><code>pgstattuple</code></td><td style=text-align:left>monitor</td><td style=text-align:left>元组级统计信息</td></tr><tr><td style=text-align:left><code>pg_buffercache</code></td><td style=text-align:left>monitor</td><td style=text-align:left>缓冲区缓存检查</td></tr><tr><td style=text-align:left><code>pageinspect</code></td><td style=text-align:left>monitor</td><td style=text-align:left>页面级检查</td></tr><tr><td style=text-align:left><code>pg_prewarm</code></td><td style=text-align:left>monitor</td><td style=text-align:left>关系预热</td></tr><tr><td style=text-align:left><code>pg_visibility</code></td><td style=text-align:left>monitor</td><td style=text-align:left>可见性映射检查</td></tr><tr><td style=text-align:left><code>pg_freespacemap</code></td><td style=text-align:left>monitor</td><td style=text-align:left>空闲空间映射检查</td></tr><tr><td style=text-align:left><code>postgres_fdw</code></td><td style=text-align:left>public</td><td style=text-align:left>PostgreSQL 外部数据包装器</td></tr><tr><td style=text-align:left><code>file_fdw</code></td><td style=text-align:left>public</td><td style=text-align:left>文件外部数据包装器</td></tr><tr><td style=text-align:left><code>btree_gist</code></td><td style=text-align:left>public</td><td style=text-align:left>B-tree GiST 操作符类</td></tr><tr><td style=text-align:left><code>btree_gin</code></td><td style=text-align:left>public</td><td style=text-align:left>B-tree GIN 操作符类</td></tr><tr><td style=text-align:left><code>pg_trgm</code></td><td style=text-align:left>public</td><td style=text-align:left>三元组匹配</td></tr><tr><td style=text-align:left><code>intagg</code></td><td style=text-align:left>public</td><td style=text-align:left>整数聚合器</td></tr><tr><td style=text-align:left><code>intarray</code></td><td style=text-align:left>public</td><td style=text-align:left>整数数组函数</td></tr><tr><td style=text-align:left><code>pg_repack</code></td><td style=text-align:left>-</td><td style=text-align:left>在线重组表</td></tr></tbody></table><p>这些扩展提供基础的监控、运维和功能增强能力。</p><hr><h2 id=默认预加载的扩展>默认预加载的扩展</h2><p>通过 <a href=/docs/pgsql/param#pg_libs><code>pg_libs</code></a> 默认预加载到 <code>shared_preload_libraries</code> 的扩展：</p><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>pg_stat_statements</code></td><td style=text-align:left>跟踪所有 SQL 语句的执行统计</td></tr><tr><td style=text-align:left><code>auto_explain</code></td><td style=text-align:left>自动记录慢查询的执行计划</td></tr></tbody></table><p>这两个扩展提供基本的可观测性，强烈建议保留。</p><hr><h2 id=自定义默认扩展>自定义默认扩展</h2><p>可以通过修改配置参数来自定义默认安装和启用的扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 修改默认安装的扩展包</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pgsql-main pgsql-common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>pg_repack_$v* wal2json_$v*</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 修改默认安装的扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>postgis, timescaledb, pgvector ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 修改默认预加载的扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 修改默认启用的扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_default_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_stat_statements, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_repack }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># ... 添加更多</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>详细的扩展使用方法请参阅：</p><ul><li><a href=/docs/pgsql/ext/start/>快速开始</a>：使用扩展的流程速览</li><li><a href=/docs/pgsql/ext/intro/>扩展简介</a>：扩展的核心概念</li><li><a href=/docs/pgsql/ext/install/>安装扩展</a>：如何安装扩展</li><li><a href=/docs/pgsql/ext/config/>配置扩展</a>：预加载与参数配置</li><li><a href=/docs/pgsql/ext/create/>启用扩展</a>：在数据库中创建扩展</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fef9a9d4af92d185f18fab30d92a530d>11 - 扩展仓库</h1><div class=lead>Pigsty 扩展软件仓库配置</div><p>Pigsty 提供补充扩展仓库，在 PGDG 官方仓库基础上提供额外的扩展包。</p><hr><h2 id=yum-仓库>YUM 仓库</h2><p>适用于 EL 7/8/9/10 及其兼容系统（RHEL、Rocky、AlmaLinux、CentOS 等）。</p><h3 id=添加仓库>添加仓库</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 添加 GPG 公钥</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/key <span style=color:#000;font-weight:700>|</span> sudo tee /etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty &gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 添加仓库配置</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/yum/repo <span style=color:#000;font-weight:700>|</span> sudo tee /etc/yum.repos.d/pigsty.repo &gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 刷新缓存</span>
</span></span><span style=display:flex><span>sudo yum makecache
</span></span></code></pre></div><h3 id=中国大陆镜像>中国大陆镜像</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/key <span style=color:#000;font-weight:700>|</span> sudo tee /etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty &gt;/dev/null
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/yum/repo <span style=color:#000;font-weight:700>|</span> sudo tee /etc/yum.repos.d/pigsty.repo &gt;/dev/null
</span></span></code></pre></div><h3 id=仓库地址>仓库地址</h3><ul><li>国际: <a href=https://repo.pigsty.io/yum/>https://repo.pigsty.io/yum/</a></li><li>中国: <a href=https://repo.pigsty.cc/yum/>https://repo.pigsty.cc/yum/</a></li></ul><hr><h2 id=apt-仓库>APT 仓库</h2><p>适用于 Debian 11/12/13 和 Ubuntu 22.04/24.04 及其兼容系统。</p><h3 id=添加仓库-1>添加仓库</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 添加 GPG 公钥</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/key <span style=color:#000;font-weight:700>|</span> sudo gpg --dearmor -o /etc/apt/keyrings/pigsty.gpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 获取发行版代号并添加仓库</span>
</span></span><span style=display:flex><span><span style=color:#000>distro_codename</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>lsb_release -cs<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>sudo tee /etc/apt/sources.list.d/pigsty.list &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.io/apt/infra generic main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.io/apt/pgsql ${distro_codename} main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 刷新缓存</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span></code></pre></div><h3 id=中国大陆镜像-1>中国大陆镜像</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/key <span style=color:#000;font-weight:700>|</span> sudo gpg --dearmor -o /etc/apt/keyrings/pigsty.gpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>distro_codename</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>lsb_release -cs<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>sudo tee /etc/apt/sources.list.d/pigsty.list &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.cc/apt/infra generic main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.cc/apt/pgsql/${distro_codename} ${distro_codename} main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><h3 id=仓库地址-1>仓库地址</h3><ul><li>国际: <a href=https://repo.pigsty.io/apt/>https://repo.pigsty.io/apt/</a></li><li>中国: <a href=https://repo.pigsty.cc/apt/>https://repo.pigsty.cc/apt/</a></li></ul><hr><h2 id=gpg-签名>GPG 签名</h2><p>所有软件包均使用 GPG 签名：</p><ul><li>指纹: <code>9592A7BC7A682E7333376E09E7935D8DB9BD8B20</code></li><li>短 ID: <code>B9BD8B20</code></li></ul><hr><h2 id=仓库策略>仓库策略</h2><p>Pigsty 仓库遵循以下原则：</p><ol><li><strong>补充性</strong>：只收录 PGDG 仓库中不存在的扩展</li><li><strong>一致性</strong>：扩展进入 PGDG 仓库后，Pigsty 仓库会移除或保持一致</li><li><strong>兼容性</strong>：支持 PostgreSQL 13-18 多个大版本</li><li><strong>多平台</strong>：支持 x86_64 和 aarch64 架构</li></ol><hr><h2 id=相关资源>相关资源</h2><ul><li><a href=https://pgext.cloud/zh/list>Pigsty 扩展目录</a>：查阅所有可用扩展</li><li><a href=https://download.postgresql.org/pub/repos/yum/>PGDG YUM 仓库</a></li><li><a href=https://apt.postgresql.org/pub/repos/apt/>PGDG APT 仓库</a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>