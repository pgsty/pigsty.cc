<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/pgsql/kernel/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/pgsql/kernel/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>内核分支 | PIGSTY</title><meta name=description content="如何在 Pigsty 中使用其他 PostgreSQL 内核分支？例如 Citus，Babelfish，IvorySQL，PolarDB 等"><meta property="og:url" content="https://pigsty.cc/docs/pgsql/kernel/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="内核分支"><meta property="og:description" content="如何在 Pigsty 中使用其他 PostgreSQL 内核分支？例如 Citus，Babelfish，IvorySQL，PolarDB 等"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="内核分支"><meta itemprop=description content="如何在 Pigsty 中使用其他 PostgreSQL 内核分支？例如 Citus，Babelfish，IvorySQL，PolarDB 等"><meta itemprop=dateModified content="2026-02-14T08:23:51+08:00"><meta itemprop=wordCount content="78"><meta itemprop=keywords content="参考,概念,PGSQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="内核分支"><meta name=twitter:description content="如何在 Pigsty 中使用其他 PostgreSQL 内核分支？例如 Citus，Babelfish，IvorySQL，PolarDB 等"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/pgsql/kernel/>返回本页常规视图</a>.</p></div><h1 class=title>内核分支</h1><div class=lead>如何在 Pigsty 中使用其他 PostgreSQL 内核分支？例如 Citus，Babelfish，IvorySQL，PolarDB 等</div><ul><li>1: <a href=#pg-6b647bd80a1130f992c12a77393a87c3>PostgreSQL</a></li><li>2: <a href=#pg-2f9342f89a206383c945315b79c7967f>Supabase</a></li><li>3: <a href=#pg-7200791b1d0ca9c1c30f1e8d7dc9ece2>Citus</a></li><li>4: <a href=#pg-86f570780ad542823d4ed958af36ce0f>Babelfish</a></li><li>5: <a href=#pg-d4592799fc81bf53d57e017444a325f6>IvorySQL</a></li><li>6: <a href=#pg-293b566be2331c0d55a3457bdfb0a860>PolarDB PG</a></li><li>7: <a href=#pg-ffed78d77ebf7627086f9da938f9b9f6>PolarDB Oracle</a></li><li>8: <a href=#pg-5e2941fff6b5b682be30d52c9d82b986>Percona</a></li><li>9: <a href=#pg-e59a81d2edf1c2072f834e4d8ef376db>PostgresML</a></li><li>10: <a href=#pg-8b89390bfb5e407f5413ce18cede184b>OpenHalo</a></li><li>11: <a href=#pg-227e1bd7e26827efbe4f8ed91ee4c679>Greenplum</a></li><li>12: <a href=#pg-311f723c83095a738bfb441159db0044>OrioleDB</a></li><li>13: <a href=#pg-a970dfd99688547f0ffb0bf4d5c4de61>Cloudberry</a></li><li>14: <a href=#pg-2342a2eaca8515e616cb1dfa8c4db39d>Neon</a></li></ul><div class=content><p>在 Pigsty 中，您可以使用不同 &ldquo;<strong>风味</strong>&rdquo; 的 PostgreSQL 分支替换 &ldquo;原生PG内核&rdquo;，实现特殊的功能与效果。</p><p>Pigsty 支持各种 PostgreSQL 内核和兼容分支，使您能够模拟不同的数据库系统，同时利用 PostgreSQL 的生态系统。每个内核都能提供独特的功能和兼容性层。</p><table class=full-width><thead><tr><th style=text-align:left>内核</th><th style=text-align:left>关键特性</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/pgsql><strong>PostgreSQL</strong></a></td><td style=text-align:left><strong>451扩展</strong></td><td style=text-align:left>原版 PostgreSQL，配备 451 扩展</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/citus><strong>Citus</strong></a></td><td style=text-align:left><strong>水平扩展</strong></td><td style=text-align:left>通过原生扩展实现分布式 PostgreSQL</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/babelfish><strong>WiltonDB</strong></a></td><td style=text-align:left><strong>SQL Server 兼容</strong></td><td style=text-align:left>SQL Server 线协议兼容</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/ivorysql><strong>IvorySQL</strong></a></td><td style=text-align:left><strong>Oracle 兼容</strong></td><td style=text-align:left>Oracle 语法和 PL/SQL 兼容</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/openhalo><strong>OpenHalo</strong></a></td><td style=text-align:left><strong>MySQL 兼容</strong></td><td style=text-align:left>MySQL 线协议兼容</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/percona><strong>Percona</strong></a></td><td style=text-align:left><strong>透明数据加密</strong></td><td style=text-align:left>带有 pg_tde 的 Percona 发行版</td></tr><tr><td style=text-align:left><a href=/docs/ferret><strong>FerretDB</strong></a></td><td style=text-align:left><strong>MongoDB 迁移</strong></td><td style=text-align:left>MongoDB 线协议兼容</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/orioledb><strong>OrioleDB</strong></a></td><td style=text-align:left><strong>OLTP 优化</strong></td><td style=text-align:left>Zheap，无膨胀，S3 存储</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/polardb><strong>PolarDB</strong></a></td><td style=text-align:left><strong>Aurora 风格 RAC</strong></td><td style=text-align:left>RAC，中国国产合规</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/supabase><strong>Supabase</strong></a></td><td style=text-align:left><strong>后端即服务</strong></td><td style=text-align:left>基于 PostgreSQL 的 BaaS，Firebase 替代方案</td></tr><tr><td style=text-align:left><a href=/docs/pgsql/kernel/cloudberry><strong>Cloudberry</strong></a></td><td style=text-align:left><strong>MPP数仓与数据分析</strong></td><td style=text-align:left>大规模并行处理数据仓库</td></tr></tbody></table></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6b647bd80a1130f992c12a77393a87c3>1 - PostgreSQL</h1><div class=lead>带有 451 扩展的原版 PostgreSQL 内核</div><p><a href=https://www.postgresql.org/>PostgreSQL</a> 是世界上最先进和最受欢迎的开源数据库。</p><p>Pigsty 支持 PostgreSQL 13 ~ 18，并提供 451 个 PG 扩展。</p><hr><h2 id=快速开始>快速开始</h2><p>使用 <a href=https://github.com/pgsty/pigsty/blob/main/conf/pgsql.yml><code>pgsql</code></a> 配置模板 <a href=/docs/setup/install><strong>安装</strong></a> Pigsty。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -c pgsql     <span style=color:#8f5902;font-style:italic># 使用 postgres 内核</span>
</span></span><span style=display:flex><span>./deploy.yml             <span style=color:#8f5902;font-style:italic># 使用 pigsty 设置一切</span>
</span></span></code></pre></div><p>大多数 <a href=/docs/conf/>配置模板</a> 默认使用 PostgreSQL 内核，例如：</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/meta.yml><code>meta</code></a> : <strong>默认</strong>，带有核心扩展（vector、postgis、timescale）的 postgres</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/rich.yml><code>rich</code></a> : 安装了所有扩展的 postgres</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/slim.yml><code>slim</code></a> : 仅 postgres，无监控基础设施</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/full.yml><code>full</code></a> : 用于 HA 演示的 4 节点沙盒</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/pgsql.yml><code>pgsql</code></a> : 最小的 postgres 内核配置示例</li></ul><hr><h2 id=配置>配置</h2><p>原版 PostgreSQL 内核不需要特殊调整：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin   ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta, baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>vector ]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行全量备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main, pgsql-common ]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pg 内核和通用工具</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_extensions: [ pg18-time ,pg18-gis ,pg18-rag ,pg18-fts ,pg18-olap ,pg18-feat ,pg18-lang ,pg18-type ,pg18-util ,pg18-func ,pg18-admin ,pg18-stat ,pg18-sec ,pg18-fdw ,pg18-sim ,pg18-etl]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=版本选择>版本选择</h2><p>要使用不同的 PostgreSQL 主版本，您可以使用 <code>-v</code> 参数进行配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -c pgsql            <span style=color:#8f5902;font-style:italic># 默认就是 postgresql 18，无需显式指定</span>
</span></span><span style=display:flex><span>./configure -c pgsql -v <span style=color:#0000cf;font-weight:700>17</span>      <span style=color:#8f5902;font-style:italic># 使用 postgresql 17</span>
</span></span><span style=display:flex><span>./configure -c pgsql -v <span style=color:#0000cf;font-weight:700>16</span>      <span style=color:#8f5902;font-style:italic># 使用 postgresql 16</span>
</span></span><span style=display:flex><span>./configure -c pgsql -v <span style=color:#0000cf;font-weight:700>15</span>      <span style=color:#8f5902;font-style:italic># 使用 postgresql 15</span>
</span></span><span style=display:flex><span>./configure -c pgsql -v <span style=color:#0000cf;font-weight:700>14</span>      <span style=color:#8f5902;font-style:italic># 使用 postgresql 14</span>
</span></span><span style=display:flex><span>./configure -c pgsql -v <span style=color:#0000cf;font-weight:700>13</span>      <span style=color:#8f5902;font-style:italic># 使用 postgresql 13</span>
</span></span></code></pre></div><p>如果 PostgreSQL 集群已经安装，您需要在安装新版本之前卸载它：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-rm.yml <span style=color:#8f5902;font-style:italic># -l pg-meta</span>
</span></span></code></pre></div><hr><h2 id=扩展生态>扩展生态</h2><p>Pigsty 为 PostgreSQL 提供了丰富的扩展生态，包括：</p><ul><li><strong>时序类</strong>：timescaledb, pg_cron, periods</li><li><strong>地理类</strong>：postgis, h3, pgrouting</li><li><strong>向量类</strong>：pgvector, pgml, vchord</li><li><strong>搜索类</strong>：pg_trgm, zhparser, pgroonga</li><li><strong>分析类</strong>：citus, pg_duckdb, pg_analytics</li><li><strong>特性类</strong>：age, pg_graphql, rum</li><li><strong>语言类</strong>：plpython3u, pljava, plv8</li><li><strong>类型类</strong>：hstore, ltree, citext</li><li><strong>工具类</strong>：http, pg_net, pgjwt</li><li><strong>函数类</strong>：pgcrypto, uuid-ossp, pg_uuidv7</li><li><strong>管理类</strong>：pg_repack, pgagent, pg_squeeze</li><li><strong>统计类</strong>：pg_stat_statements, pg_qualstats, auto_explain</li><li><strong>安全类</strong>：pgaudit, pgcrypto, pgsodium</li><li><strong>外部类</strong>：postgres_fdw, mysql_fdw, oracle_fdw</li><li><strong>兼容类</strong>：orafce, babelfishpg_tds</li><li><strong>数据类</strong>：pglogical, wal2json, decoderbufs</li></ul><p>详情请参考 <a href=https://pgext.cloud/zh/list>扩展目录</a>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2f9342f89a206383c945315b79c7967f>2 - Supabase</h1><div class=lead>如何使用Pigsty自建Supabase，一键拉起开源Firebase替代，后端全栈全家桶。</div><blockquote><p><a href=https://supabase.com/>Supabase</a> —— Build in a weekend, Scale to millions</p></blockquote><p>Supabase 是一个开源的 Firebase 替代，对 PostgreSQL 进行了封装，并提供了认证，开箱即用的 API，边缘函数，实时订阅，对象存储，向量嵌入能力。
这是一个低代码的一站式后端平台，能让你几乎告别大部分后端开发的工作，只需要懂数据库设计与前端即可快速出活！</p><p>Supabase 的口号是：“<strong>花个周末写写，随便扩容至百万</strong>”。诚然，在小微规模（4c8g）内的 Supabase <a href=https://supabase.com/pricing>极有性价比</a>，堪称赛博菩萨。
—— 但当你真的增长到百万用户时 —— 确实应该认真考虑托管自建 Supabase 了 —— 无论是出于功能，性能，还是成本上的考虑。</p><p>Pigsty 为您提供完整的 Supabase 一键自建方案。自建的 Supabase 可以享受完整的 PostgreSQL 监控，IaC，PITR 与高可用，
而且相比 Supabase 云服务，提供了多达 <a href=https://pgext.cloud><strong>451</strong></a> 个开箱即用的 PostgreSQL 扩展，并能够更充分地利用现代硬件的性能与成本优势。</p><p>完整自建教程，请参考：《<a href=/docs/app/supabase><strong>Supabase自建手册</strong></a>》</p><p><img src=/img/pigsty/supabase.webp alt></p><hr><h2 id=快速上手>快速上手</h2><p>Pigsty 默认提供的 <a href=https://github.com/Vonng/pigsty/blob/main/conf/supa.yml><code>supa.yml</code></a> 配置模板定义了一套单节点 Supabase。</p><p>首先，使用 Pigsty <a href=/docs/setup/install>标准安装流程</a> 安装 Supabase 所需的 MinIO 与 PostgreSQL 实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash
</span></span><span style=display:flex><span>./bootstrap          <span style=color:#8f5902;font-style:italic># 环境检查，安装依赖</span>
</span></span><span style=display:flex><span>./configure -c supa  <span style=color:#8f5902;font-style:italic># 重要：请在配置文件中修改密码等关键信息！</span>
</span></span><span style=display:flex><span>./deploy.yml         <span style=color:#8f5902;font-style:italic># 安装 Pigsty，拉起 PGSQL 与 MINIO！</span>
</span></span></code></pre></div><p>请在部署 Supabase 前，根据您的实际情况，修改 <code>pigsty.yml</code> 配置文件中 <a href=#%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82>关于 Supabase 的参数</a>（主要是密码！）</p><p>然后，运行 <a href=https://github.com/Vonng/pigsty/blob/main/supabase.yml><code>supabase.yml</code></a> 完成剩余的工作，拉起 Supabase 容器</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./docker.yml       <span style=color:#8f5902;font-style:italic># 安装 Docker 模块</span>
</span></span><span style=display:flex><span>./app.yml          <span style=color:#8f5902;font-style:italic># 拉起 Supabase 无状态部分！</span>
</span></span></code></pre></div><p>中国区域用户注意，请您配置合适的 Docker 镜像站点或代理服务器绕过 GFW 以拉取 DockerHub 镜像。
对于 <a href=/docs/about/service>专业订阅</a> ，我们提供在没有互联网访问的情况下，<a href=/docs/setup/offline>离线安装</a> Pigsty 与 Supabase 的能力。</p><p>Pigsty 默认通过管理节点/INFRA节点上的 Nginx 对外暴露 Web 服务，您可以在本地添加 <code>supa.pigsty</code> 的 DNS 解析指向该节点，
然后通过浏览器访问 <code>https://supa.pigsty</code> 即可进入 Supabase Studio 管理界面。</p><blockquote><p>默认用户名与密码：supabase / pigsty</p></blockquote><link rel=stylesheet href=/css/asciinema-player.css><script src=/js/asciinema-player.min.js></script><div id=asciinema-913fe6b5e34ef94a5d10a82176a4fd69 class="asciinema-container td-max-width-on-larger-screens" style="margin:1em 0"></div><script>(function(){var n,s="asciinema-913fe6b5e34ef94a5d10a82176a4fd69",o="/demo/supabase.cast",e="auto",i=null;function a(){var e=document.documentElement.getAttribute("data-bs-theme");return e==="dark"?"solarized-dark":e==="light"?"solarized-light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"solarized-dark":"solarized-light"}function r(){return e==="auto"?a():e}function t(){var e,t=document.getElementById(s);t.innerHTML="",e={theme:r(),speed:"1.3",startAt:0,fit:"width"},e.autoPlay=!0,e.loop=!0,e.markers=[[0,"检查环境"],[11,"安装"],[43,"配置"],[307,"Docker"],[321,"域名"],[340,"App"],[350,"检查"]],i=AsciinemaPlayer.create(o,t,e)}t(),e==="auto"&&(n=new MutationObserver(function(e){e.forEach(function(e){e.attributeName==="data-bs-theme"&&t()})}),n.observe(document.documentElement,{attributes:!0}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){var e=document.documentElement.getAttribute("data-bs-theme");(!e||e==="auto")&&t()}))})()</script><hr><h2 id=配置细节>配置细节</h2><p><code>./configure -c supa</code> 会生成 <code>~/pigsty/pigsty.yml</code>。在执行 <code>./deploy.yml</code> 之前，请至少检查并修改其中的密码、密钥、域名等敏感配置。</p><p>更完整的配置说明请参阅：《<a href=/docs/app/supabase>Supabase自建手册</a>》。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7200791b1d0ca9c1c30f1e8d7dc9ece2>3 - Citus</h1><div class=lead>使用 Pigsty 部署原生高可用的 Citus 水平分片集群，将 PostgreSQL 无缝伸缩到多套分片并加速 OLTP/OLAP 查询。</div><p>Pigsty 原生支持 Citus。这是一个基于原生 PostgreSQL 内核的分布式水平扩展插件。</p><p><img src=/img/pigsty/citus.jpg alt></p><hr><h2 id=安装>安装</h2><p>Citus 是一个 PostgreSQL <a href=/docs/pgsql/ext/>扩展插件</a>，可以按照标准插件安装的流程，在原生 PostgreSQL 集群上加装启用。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t pg_extension -e <span style=color:#4e9a06>&#39;{&#34;pg_extensions&#34;:[&#34;citus&#34;]}&#39;</span>
</span></span></code></pre></div><hr><h2 id=配置>配置</h2><p>要定义一个 citus 集群，您需要指定以下参数：</p><ul><li><a href=/docs/pgsql/param#pg_mode><code>pg_mode</code></a> 必须设置为 <code>citus</code>，而不是默认的 <code>pgsql</code></li><li>在每个分片集群上都必须定义分片名 <a href=/docs/pgsql/param#pg_shard><code>pg_shard</code></a> 和分片号 <a href=/docs/pgsql/param#pg_group><code>pg_group</code></a></li><li>必须定义 <a href=/docs/pgsql/param#pg_primary_db><code>pg_primary_db</code></a> 来指定由 Patroni 管理的 Citus 数据库。</li><li>如果您想使用 <a href=/docs/pgsql/param#pg_dbsu><code>pg_dbsu</code></a> 的 <code>postgres</code> 而不是默认的 <a href=/docs/pgsql/param#pg_admin_username><code>pg_admin_username</code></a> 来执行管理命令，那么 <a href=/docs/pgsql/param#pg_dbsu_password><code>pg_dbsu_password</code></a> 必须设置为非空的纯文本密码</li></ul><p>此外，还需要额外的 hba 规则，允许从本地和其他数据节点进行 SSL 访问。</p><p>您可以将每个 Citus 集群分别定义为独立的分组，像标准的 PostgreSQL 集群一样，如 <a href=https://github.com/Vonng/pigsty/blob/main/conf/citus.yml><code>conf/dbms/citus.yml</code></a> 所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 0号分片</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus0 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 1号分片</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus1 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 2号分片</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus2 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-citus3</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 3号分片</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.14</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-citus3 , pg_group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                               </span><span style=color:#8f5902;font-style:italic># 所有 Citus 集群的全局参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgsql 集群模式需要设置为： citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-citus               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 水平分片名称： pg-citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_primary_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus 数据库名称：meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_dbsu_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Postgres</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 如果使用 dbsu ，那么需要为其配置一个密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus }, { name: postgis }, { name: timescaledb } ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: 127.0.0.1/32 ,auth: ssl ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from localhost&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: intra        ,auth: ssl ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from intranet&#39;</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>您也可以在一个分组内指定所有 Citus 集群成员的身份参数，如 <a href=https://github.com/Vonng/pigsty/blob/main/conf/prod.yml#L298><code>prod.yml</code></a> 所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==========================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg-citus: 10 node citus cluster (5 x primary-replica pair)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==========================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-citus</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus group</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.50</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 0, pg_cluster: pg-citus0 ,pg_vip_address: 10.10.10.60/24 ,pg_seq: 0, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.51</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 0, pg_cluster: pg-citus0 ,pg_vip_address: 10.10.10.60/24 ,pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.52</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 1, pg_cluster: pg-citus1 ,pg_vip_address: 10.10.10.61/24 ,pg_seq: 0, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.53</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 1, pg_cluster: pg-citus1 ,pg_vip_address: 10.10.10.61/24 ,pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.54</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 2, pg_cluster: pg-citus2 ,pg_vip_address: 10.10.10.62/24 ,pg_seq: 0, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.55</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 2, pg_cluster: pg-citus2 ,pg_vip_address: 10.10.10.62/24 ,pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.56</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 3, pg_cluster: pg-citus3 ,pg_vip_address: 10.10.10.63/24 ,pg_seq: 0, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.57</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 3, pg_cluster: pg-citus3 ,pg_vip_address: 10.10.10.63/24 ,pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.58</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 4, pg_cluster: pg-citus4 ,pg_vip_address: 10.10.10.64/24 ,pg_seq: 0, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.59</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_group: 4, pg_cluster: pg-citus4 ,pg_vip_address: 10.10.10.64/24 ,pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode: citus                    # pgsql cluster mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard: pg-citus                # citus shard name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_primary_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>test              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># primary database used by citus</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_dbsu_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Postgres</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># all dbsu password access for citus cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;citus postgis timescaledb pgvector&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;citus, timescaledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># citus will be added by patroni automatically</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: test ,password: test ,pgbouncer: true ,roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: test ,owner: test ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>citus }, { name: postgis } ] } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: 10.10.10.0/24 ,auth: trust ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;trust citus cluster members&#39;</span><span style=color:#f8f8f8>        </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: 127.0.0.1/32  ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from localhost&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: &#39;all&#39; ,db: all  ,addr: intra         ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all user ssl access from intranet&#39;</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=使用>使用</h2><p>您可以像访问普通集群一样，访问任意节点：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pgbench -i postgres://test:test@pg-citus0/test
</span></span><span style=display:flex><span>pgbench -nv -P1 -T1000 -c <span style=color:#0000cf;font-weight:700>2</span> postgres://test:test@pg-citus0/test
</span></span></code></pre></div><p>默认情况下，您对某一个 Shard 进行的变更，都只发生在这套集群上，而不会同步到其他 Shard。</p><p>如果你希望将写入分布到所有 Shard，可以使用 Citus 提供的 API 函数，将表标记为：</p><ul><li><strong>水平分片表</strong>（自动分区，需要指定分区键）</li><li><strong>引用表</strong>（全量复制：不需要指定分区键）：</li></ul><p>从 Citus 11.2 开始，任何 Citus 数据库节点都可以扮演协调者的角色，即，任意一个主节点都可以写入：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql -h pg-citus0 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#34;SELECT create_distributed_table(&#39;pgbench_accounts&#39;, &#39;aid&#39;); SELECT truncate_local_data_after_distributing_table(&#39;public.pgbench_accounts&#39;);&#34;</span>
</span></span><span style=display:flex><span>psql -h pg-citus0 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#34;SELECT create_reference_table(&#39;pgbench_branches&#39;)         ; SELECT truncate_local_data_after_distributing_table(&#39;public.pgbench_branches&#39;);&#34;</span>
</span></span><span style=display:flex><span>psql -h pg-citus0 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#34;SELECT create_reference_table(&#39;pgbench_history&#39;)          ; SELECT truncate_local_data_after_distributing_table(&#39;public.pgbench_history&#39;);&#34;</span>
</span></span><span style=display:flex><span>psql -h pg-citus0 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#34;SELECT create_reference_table(&#39;pgbench_tellers&#39;)          ; SELECT truncate_local_data_after_distributing_table(&#39;public.pgbench_tellers&#39;);&#34;</span>
</span></span></code></pre></div><p>将表分布出去后，你可以在其他节点上也访问到：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql -h pg-citus1 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#39;\dt+&#39;</span>
</span></span></code></pre></div><p>例如，全表扫描可以发现执行计划已经变为分布式计划</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant@meta-1:~$ psql -h pg-citus3 -d <span style=color:#204a87>test</span> -c <span style=color:#4e9a06>&#39;explain select * from pgbench_accounts&#39;</span>
</span></span><span style=display:flex><span>                                               QUERY PLAN
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span> Custom Scan <span style=color:#ce5c00;font-weight:700>(</span>Citus Adaptive<span style=color:#ce5c00;font-weight:700>)</span>  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#ce5c00;font-weight:700>=</span>0.00..0.00 <span style=color:#000>rows</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>100000</span> <span style=color:#000>width</span><span style=color:#ce5c00;font-weight:700>=</span>352<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   Task Count: <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span>   Tasks Shown: One of <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span>   -&gt;  Task
</span></span><span style=display:flex><span>         Node: <span style=color:#000>host</span><span style=color:#ce5c00;font-weight:700>=</span>10.10.10.52 <span style=color:#000>port</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000>dbname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>test</span>
</span></span><span style=display:flex><span>         -&gt;  Seq Scan on pgbench_accounts_102008 pgbench_accounts  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#ce5c00;font-weight:700>=</span>0.00..81.66 <span style=color:#000>rows</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3066</span> <span style=color:#000>width</span><span style=color:#ce5c00;font-weight:700>=</span>97<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span> rows<span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>你可以从几个不同的主节点发起写入：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pgbench -nv -P1 -T1000 -c <span style=color:#0000cf;font-weight:700>2</span> postgres://test:test@pg-citus1/test
</span></span><span style=display:flex><span>pgbench -nv -P1 -T1000 -c <span style=color:#0000cf;font-weight:700>2</span> postgres://test:test@pg-citus2/test
</span></span><span style=display:flex><span>pgbench -nv -P1 -T1000 -c <span style=color:#0000cf;font-weight:700>2</span> postgres://test:test@pg-citus3/test
</span></span><span style=display:flex><span>pgbench -nv -P1 -T1000 -c <span style=color:#0000cf;font-weight:700>2</span> postgres://test:test@pg-citus4/test
</span></span></code></pre></div><p>当某个节点出现故障时，Patroni 提供的原生高可用支持会将备用节点提升并自动顶上。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>test</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#8f5902;font-style:italic># select * from  pg_dist_node;</span>
</span></span><span style=display:flex><span> nodeid <span style=color:#000;font-weight:700>|</span> groupid <span style=color:#000;font-weight:700>|</span>  nodename   <span style=color:#000;font-weight:700>|</span> nodeport <span style=color:#000;font-weight:700>|</span> noderack <span style=color:#000;font-weight:700>|</span> hasmetadata <span style=color:#000;font-weight:700>|</span> isactive <span style=color:#000;font-weight:700>|</span> noderole <span style=color:#000;font-weight:700>|</span> nodecluster <span style=color:#000;font-weight:700>|</span> metadatasynced <span style=color:#000;font-weight:700>|</span> shouldhaveshards
</span></span><span style=display:flex><span>--------+---------+-------------+----------+----------+-------------+----------+----------+-------------+----------------+------------------
</span></span><span style=display:flex><span>      <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span>       <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>|</span> 10.10.10.51 <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000;font-weight:700>|</span> default  <span style=color:#000;font-weight:700>|</span> t           <span style=color:#000;font-weight:700>|</span> t        <span style=color:#000;font-weight:700>|</span> primary  <span style=color:#000;font-weight:700>|</span> default     <span style=color:#000;font-weight:700>|</span> t              <span style=color:#000;font-weight:700>|</span> f
</span></span><span style=display:flex><span>      <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>|</span>       <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>|</span> 10.10.10.54 <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000;font-weight:700>|</span> default  <span style=color:#000;font-weight:700>|</span> t           <span style=color:#000;font-weight:700>|</span> t        <span style=color:#000;font-weight:700>|</span> primary  <span style=color:#000;font-weight:700>|</span> default     <span style=color:#000;font-weight:700>|</span> t              <span style=color:#000;font-weight:700>|</span> t
</span></span><span style=display:flex><span>      <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>|</span>       <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span> 10.10.10.52 <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000;font-weight:700>|</span> default  <span style=color:#000;font-weight:700>|</span> t           <span style=color:#000;font-weight:700>|</span> t        <span style=color:#000;font-weight:700>|</span> primary  <span style=color:#000;font-weight:700>|</span> default     <span style=color:#000;font-weight:700>|</span> t              <span style=color:#000;font-weight:700>|</span> t
</span></span><span style=display:flex><span>      <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>|</span>       <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>|</span> 10.10.10.58 <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000;font-weight:700>|</span> default  <span style=color:#000;font-weight:700>|</span> t           <span style=color:#000;font-weight:700>|</span> t        <span style=color:#000;font-weight:700>|</span> primary  <span style=color:#000;font-weight:700>|</span> default     <span style=color:#000;font-weight:700>|</span> t              <span style=color:#000;font-weight:700>|</span> t
</span></span><span style=display:flex><span>      <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>|</span>       <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>|</span> 10.10.10.56 <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>5432</span> <span style=color:#000;font-weight:700>|</span> default  <span style=color:#000;font-weight:700>|</span> t           <span style=color:#000;font-weight:700>|</span> t        <span style=color:#000;font-weight:700>|</span> primary  <span style=color:#000;font-weight:700>|</span> default     <span style=color:#000;font-weight:700>|</span> t              <span style=color:#000;font-weight:700>|</span> t
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-86f570780ad542823d4ed958af36ce0f>4 - Babelfish</h1><div class=lead>使用 WiltonDB 与 Babelfish 创建兼容 Microsoft SQL Server 的 PostgreSQL 数据库集群！（线缆协议级仿真）</div><blockquote><p><a href=https://babelfishpg.org/>Babelfish</a> 是一个基于 PostgreSQL 的 MSSQL（微软 SQL Server）兼容性方案，由 AWS 开源。</p></blockquote><hr><h2 id=概览>概览</h2><p>Pigsty 允许用户使用 Babelfish 与 WiltonDB 创建 Microsoft SQL Server 兼容的 PostgreSQL 集群！</p><ul><li><a href=https://babelfishpg.org/>Babelfish</a> ：一个由 AWS 开源的 MSSQL（微软 SQL Server） 兼容性扩展插件</li><li><a href=https://github.com/wiltondb/wiltondb>WiltonDB</a>： 一个专注于整合 Babelfish 的 PostgreSQL 内核发行版</li></ul><p>Babelfish 是一个 PostgreSQL 扩展插件，但只能在一个轻微修改过的 PostgreSQL 内核 Fork 上工作，WiltonDB 在 EL/Ubuntu 系统下提供了编译后的Fork内核二进制与扩展二进制软件包。</p><p>Pigsty 可以使用 WiltonDB 替代原生的 PostgreSQL 内核，提供开箱即用的 MSSQL 兼容集群。MSSQL集群使用与管理与一套标准的 PostgreSQL 15 集群并无差异，您可以使用 Pigsty 提供的所有功能，如高可用，备份，监控等。</p><p>WiltonDB 带有包括 Babelfish 在内的若干扩展插件，但不能使用 PostgreSQL 原生的扩展插件。</p><p>MSSQL 兼容集群在启动后，除了监听 PostgreSQL 默认的端口外，还会监听 MSSQL 默认的 <code>1433</code> 端口，并在此端口上通过 TDS WireProtocol 提供 MSSQL 服务。
您可以用任何 MSSQL 客户端连接至 Pigsty 提供的 MSSQL 服务，如 SQL Server Management Studio，或者使用 <code>sqlcmd</code> 命令行工具。</p><p><img src=/img/pigsty/mssql.jpg alt></p><hr><h2 id=安装>安装</h2><p>WiltonDB 与原生 PostgreSQL 内核冲突，在一个节点上只能选择一个内核进行安装，使用以下命令在线安装 WiltonDB 内核。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t node_install -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;local,mssql&#34;,&#34;node_packages&#34;:[&#34;wiltondb&#34;]}&#39;</span>
</span></span></code></pre></div><p>请注意 WiltonDB 仅在 EL 与 Ubuntu 系统中可用，目前尚未提供 Debian 支持。</p><p>Pigsty 专业版提供了 WiltonDB 离线安装包，可以从本地软件源安装 WiltonDB。</p><hr><h2 id=配置>配置</h2><p>在安装部署 MSSQL 模块时需要特别注意以下事项：</p><ul><li>WiltonDB 在 EL (7/8/9) 和 Ubuntu (20.04/22.04) 中可用，<strong>在Debian系统中不可用</strong>。</li><li>WiltonDB 目前基于 PostgreSQL 15 编译，因此需要指定 <code>pg_version: 15</code> 。</li><li>在 EL 系统上，<code>wiltondb</code> 的二进制默认会安装至 <code>/usr/bin/</code> 目录下，而在 Ubuntu 系统上则会安装至 <code>/usr/lib/postgresql/15/bin/</code> 目录下，与 PostgreSQL 官方二进制文件放置位置不同。</li><li>WiltonDB 兼容模式下，HBA 密码认证规则需要使用 <code>md5</code>，而非 <code>scram-sha-256</code>，因此需要覆盖 Pigsty 默认的 HBA 规则集，将 SQL Server 需要的 <code>md5</code> 认证规则，插入到 <code>dbrole_readonly</code> 通配认证规则之前</li><li>WiltonDB 只能针对一个首要数据库启用，同时应当指定一个用户作为 Babelfish 的超级用户，以便 Babelfish 可以创建数据库和用户，默认为 <code>mssql</code> 与 <code>dbuser_myssql</code>，如果修改，请一并修改 <code>files/mssql.sql</code> 中的用户。</li><li>WiltonDB TDS 线缆协议兼容插件 <code>babelfishpg_tds</code> 需要在 <code>shared_preload_libraries</code> 中启用</li><li>WiltonDB 扩展在启用后，默认监听 MSSQL <code>1433</code> 端口，您可以覆盖 Pigsty 默认的服务定义，将 <code>primary</code> 与 <code>replica</code> 服务的端口指向 <code>1433</code> ，而不是 <code>5432</code> / <code>6432</code> 端口。</li></ul><p>以下参数需要针对 MSSQL 数据库集群进行配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PGSQL &amp; MSSQL (Babelfish &amp; Wilton)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PG Installation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,node,mssql</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># add mssql and os upstream repos</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mssql                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Microsoft SQL Server Compatible Mode</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;babelfishpg_tds, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># add timescaledb to shared_preload_libraries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># The current WiltonDB major version is 15</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>wiltondb                       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># install forked version of postgresql with babelfishpg support</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># do not install any vanilla postgresql extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PG Provision</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># overwrite default HBA rules for babelfish cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: local     ,auth: ident ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;dbsu access via local os user ident&#39;</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: local     ,auth: ident ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;dbsu replication from local os ident&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;replicator replication from localhost&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;replicator replication from intranet&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: postgres    ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;replicator postgres db from intranet&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor from localhost with password&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;monitor from infra host with password&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;admin @ infra nodes with pwd &amp; ssl&#39;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: ssl   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;admin @ everywhere with ssl &amp; pwd&#39;</span><span style=color:#f8f8f8>    </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user: dbuser_mssql ,db: mssql       ,addr: intra     ,auth: md5   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow mssql dbsu intranet access&#39;</span><span style=color:#f8f8f8>     </span>}<span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- use md5 auth method for mssql user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: localhost ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgbouncer read/write via local socket&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;read/write biz user via password&#39;</span><span style=color:#f8f8f8>     </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39; ,db: all    ,addr: intra     ,auth: pwd   ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow etl offline tasks from intranet&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># route primary &amp; replica service to mssql port 1433</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: primary ,port: 5433 ,dest: 1433  ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replica ,port: 5434 ,dest: 1433  ,check: /read-only ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary` || pg_role == `offline` ]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: default ,port: 5436 ,dest: postgres ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: offline ,port: 5438 ,dest: postgres ,check: /replica   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `offline` || pg_offline_query ]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `replica` &amp;&amp; !pg_offline_query]&#34;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>您可以定义 MSSQL 业务数据库与业务用户：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pgsql (singleton on current node)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># this is an example single-node postgres cluster with postgis &amp; timescaledb installed, with one biz database &amp; two biz users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;---- primary instance with read-write capability</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                           </span><span style=color:#8f5902;font-style:italic># create MSSQL superuser</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_mssql ,password: DBUser.MSSQL ,superuser: true, pgbouncer: true ,roles: [dbrole_admin], comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>superuser &amp; owner for babelfish  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_primary_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mssql               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use `mssql` as the primary sql server database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mssql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mssql.sql            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># init babelfish database &amp; user</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>uuid-ossp          }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>babelfishpg_common }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>babelfishpg_tsql   }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>babelfishpg_tds    }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>babelfishpg_money  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_hint_plan       }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system_stats       }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tds_fdw            }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_mssql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>&#39;babelfishpg_tsql.migration_mode&#39; </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;multi-db&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>babelfish cluster, a MSSQL compatible pg cluster</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=访问>访问</h2><p>您可以使用任何 SQL Server 兼容的客户端工具来访问这个数据库集群。</p><p>Microsoft 提供了 <a href="https://learn.microsoft.com/en-us/sql/tools/sqlcmd/sqlcmd-use-utility?view=sql-server-ver16">sqlcmd</a> 作为官方的命令行工具。</p><p>除此之外，他们还提供了一个 Go 语言版本的命令行工具 <a href=https://github.com/microsoft/go-sqlcmd>go-sqlcmd</a>。</p><p>安装 <code>go-sqlcmd</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://github.com/microsoft/go-sqlcmd/releases/download/v1.4.0/sqlcmd-v1.4.0-linux-amd64.tar.bz2
</span></span><span style=display:flex><span>tar xjvf sqlcmd-v1.4.0-linux-amd64.tar.bz2
</span></span><span style=display:flex><span>sudo mv sqlcmd* /usr/bin/
</span></span></code></pre></div><p>快速上手 <code>go-sqlcmd</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sqlcmd -S 10.10.10.10,1433 -U dbuser_mssql -P DBUser.MSSQL
</span></span><span style=display:flex><span>1&gt; <span style=color:#204a87;font-weight:700>select</span> @@version
</span></span><span style=display:flex><span>2&gt; go
</span></span><span style=display:flex><span>version                                                                                                                                                                                                                                                         
</span></span><span style=display:flex><span>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span>Babelfish <span style=color:#204a87;font-weight:700>for</span> PostgreSQL with SQL Server Compatibility - 12.0.2000.8
</span></span><span style=display:flex><span>Oct <span style=color:#0000cf;font-weight:700>22</span> <span style=color:#0000cf;font-weight:700>2023</span> 17:48:32
</span></span><span style=display:flex><span>Copyright <span style=color:#ce5c00;font-weight:700>(</span>c<span style=color:#ce5c00;font-weight:700>)</span> Amazon Web Services
</span></span><span style=display:flex><span>PostgreSQL 15.4 <span style=color:#ce5c00;font-weight:700>(</span>EL 1:15.4.wiltondb3.3_2-2.el8<span style=color:#ce5c00;font-weight:700>)</span> on x86_64-redhat-linux-gnu <span style=color:#ce5c00;font-weight:700>(</span>Babelfish 3.3.0<span style=color:#ce5c00;font-weight:700>)</span>                                        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span> row affected<span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>使用 Pigsty 提供的服务机制，可以使用 5433 / 5434 端口始终连接到主库/从库上的 1433 端口。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 访问任意集群成员上的 5433 端口，指向主库上的 1433 MSSQL 端口 </span>
</span></span><span style=display:flex><span>sqlcmd -S 10.10.10.11,5433 -U dbuser_mssql -P DBUser.MSSQL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 访问任意集群成员上的 5434 端口，指向任意可读库上的 1433 MSSQL 端口</span>
</span></span><span style=display:flex><span>sqlcmd -S 10.10.10.11,5434 -U dbuser_mssql -P DBUser.MSSQL
</span></span></code></pre></div><hr><h2 id=扩展>扩展</h2><p>绝大多数 <strong>PGSQL</strong> 模块的 <a href=/docs/pgsql/ext/><strong>扩展插件</strong></a>（非纯 SQL 类）都无法直接在 MSSQL 模块的 WiltonDB 内核上使用，需要重新编译。</p><p>目前 WiltonDB 自带了以下扩展插件，除了 PostgreSQL Contrib 扩展，四个 BabelfishPG 核心扩展之外，还提供了 <code>pg_hint_pan</code>，<code>tds_fdw</code>，以及 <code>system_stats</code> 三个第三方扩展。</p><table class=full-width><thead><tr><th>扩展名</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>dblink</td><td>1.2</td><td>connect to other PostgreSQL databases from within a database</td></tr><tr><td>adminpack</td><td>2.1</td><td>administrative functions for PostgreSQL</td></tr><tr><td>dict_int</td><td>1.0</td><td>text search dictionary template for integers</td></tr><tr><td>intagg</td><td>1.1</td><td>integer aggregator and enumerator (obsolete)</td></tr><tr><td>dict_xsyn</td><td>1.0</td><td>text search dictionary template for extended synonym processing</td></tr><tr><td>amcheck</td><td>1.3</td><td>functions for verifying relation integrity</td></tr><tr><td>autoinc</td><td>1.0</td><td>functions for autoincrementing fields</td></tr><tr><td>bloom</td><td>1.0</td><td>bloom access method - signature file based index</td></tr><tr><td>fuzzystrmatch</td><td>1.1</td><td>determine similarities and distance between strings</td></tr><tr><td>intarray</td><td>1.5</td><td>functions, operators, and index support for 1-D arrays of integers</td></tr><tr><td>btree_gin</td><td>1.3</td><td>support for indexing common datatypes in GIN</td></tr><tr><td>btree_gist</td><td>1.7</td><td>support for indexing common datatypes in GiST</td></tr><tr><td>hstore</td><td>1.8</td><td>data type for storing sets of (key, value) pairs</td></tr><tr><td>hstore_plperl</td><td>1.0</td><td>transform between hstore and plperl</td></tr><tr><td>isn</td><td>1.2</td><td>data types for international product numbering standards</td></tr><tr><td>hstore_plperlu</td><td>1.0</td><td>transform between hstore and plperlu</td></tr><tr><td>jsonb_plperl</td><td>1.0</td><td>transform between jsonb and plperl</td></tr><tr><td>citext</td><td>1.6</td><td>data type for case-insensitive character strings</td></tr><tr><td>jsonb_plperlu</td><td>1.0</td><td>transform between jsonb and plperlu</td></tr><tr><td>jsonb_plpython3u</td><td>1.0</td><td>transform between jsonb and plpython3u</td></tr><tr><td>cube</td><td>1.5</td><td>data type for multidimensional cubes</td></tr><tr><td>hstore_plpython3u</td><td>1.0</td><td>transform between hstore and plpython3u</td></tr><tr><td>earthdistance</td><td>1.1</td><td>calculate great-circle distances on the surface of the Earth</td></tr><tr><td>lo</td><td>1.1</td><td>Large Object maintenance</td></tr><tr><td>file_fdw</td><td>1.0</td><td>foreign-data wrapper for flat file access</td></tr><tr><td>insert_username</td><td>1.0</td><td>functions for tracking who changed a table</td></tr><tr><td>ltree</td><td>1.2</td><td>data type for hierarchical tree-like structures</td></tr><tr><td>ltree_plpython3u</td><td>1.0</td><td>transform between ltree and plpython3u</td></tr><tr><td>pg_walinspect</td><td>1.0</td><td>functions to inspect contents of PostgreSQL Write-Ahead Log</td></tr><tr><td>moddatetime</td><td>1.0</td><td>functions for tracking last modification time</td></tr><tr><td>old_snapshot</td><td>1.0</td><td>utilities in support of old_snapshot_threshold</td></tr><tr><td>pgcrypto</td><td>1.3</td><td>cryptographic functions</td></tr><tr><td>pgrowlocks</td><td>1.2</td><td>show row-level locking information</td></tr><tr><td>pageinspect</td><td>1.11</td><td>inspect the contents of database pages at a low level</td></tr><tr><td>pg_surgery</td><td>1.0</td><td>extension to perform surgery on a damaged relation</td></tr><tr><td>seg</td><td>1.4</td><td>data type for representing line segments or floating-point intervals</td></tr><tr><td>pgstattuple</td><td>1.5</td><td>show tuple-level statistics</td></tr><tr><td>pg_buffercache</td><td>1.3</td><td>examine the shared buffer cache</td></tr><tr><td>pg_freespacemap</td><td>1.2</td><td>examine the free space map (FSM)</td></tr><tr><td>postgres_fdw</td><td>1.1</td><td>foreign-data wrapper for remote PostgreSQL servers</td></tr><tr><td>pg_prewarm</td><td>1.2</td><td>prewarm relation data</td></tr><tr><td>tcn</td><td>1.0</td><td>Triggered change notifications</td></tr><tr><td>pg_trgm</td><td>1.6</td><td>text similarity measurement and index searching based on trigrams</td></tr><tr><td>xml2</td><td>1.1</td><td>XPath querying and XSLT</td></tr><tr><td>refint</td><td>1.0</td><td>functions for implementing referential integrity (obsolete)</td></tr><tr><td>pg_visibility</td><td>1.2</td><td>examine the visibility map (VM) and page-level visibility info</td></tr><tr><td>pg_stat_statements</td><td>1.10</td><td>track planning and execution statistics of all SQL statements executed</td></tr><tr><td>sslinfo</td><td>1.2</td><td>information about SSL certificates</td></tr><tr><td>tablefunc</td><td>1.0</td><td>functions that manipulate whole tables, including crosstab</td></tr><tr><td>tsm_system_rows</td><td>1.0</td><td>TABLESAMPLE method which accepts number of rows as a limit</td></tr><tr><td>tsm_system_time</td><td>1.0</td><td>TABLESAMPLE method which accepts time in milliseconds as a limit</td></tr><tr><td>unaccent</td><td>1.1</td><td>text search dictionary that removes accents</td></tr><tr><td>uuid-ossp</td><td>1.1</td><td>generate universally unique identifiers (UUIDs)</td></tr><tr><td>plpgsql</td><td>1.0</td><td>PL/pgSQL procedural language</td></tr><tr><td>babelfishpg_money</td><td>1.1.0</td><td>babelfishpg_money</td></tr><tr><td>system_stats</td><td>2.0</td><td>EnterpriseDB system statistics for PostgreSQL</td></tr><tr><td>tds_fdw</td><td>2.0.3</td><td>Foreign data wrapper for querying a TDS database (Sybase or Microsoft SQL Server)</td></tr><tr><td>babelfishpg_common</td><td>3.3.3</td><td>Transact SQL Datatype Support</td></tr><tr><td>babelfishpg_tds</td><td>1.0.0</td><td>TDS protocol extension</td></tr><tr><td>pg_hint_plan</td><td>1.5.1</td><td></td></tr><tr><td>babelfishpg_tsql</td><td>3.3.1</td><td>Transact SQL compatibility</td></tr></tbody></table><ul><li>Pigsty 专业版提供离线安装 MSSQL 兼容模块的能力</li><li>Pigsty <a href=/docs/about/service/><strong>专业版</strong></a> 提供可选的 MSSQL 兼容内核扩展移植定制服务，可以将 PGSQL 模块中可用的 <a href=/docs/pgsql/ext/><strong>扩展</strong></a> 移植到 MSSQL 集群中。</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d4592799fc81bf53d57e017444a325f6>5 - IvorySQL</h1><div class=lead>使用瀚高开源的 IvorySQL 内核，基于 PostgreSQL 集群实现 Oracle 语法/PLSQL 兼容性。</div><p><a href=https://www.ivorysql.org/>IvorySQL</a> 是一个开源的，旨在基于 PG 提供 “Oracle兼容性” 的 PostgreSQL 内核分支。</p><hr><h2 id=概览>概览</h2><p>IvorySQL 内核支持在 Pigsty 开源版本中提供，您的服务器需要互联网访问，直接从 IvorySQL 的官方仓库下载相关软件包。</p><p>请注意，直接将 IvorySQL 加入 Pigsty 默认软件仓库中会影响原生 PostgreSQL 内核的安装。Pigsty 专业版提供包括 IvorySQL 内核在内的离线安装解决方案。</p><p><img src=/img/pigsty/ivory.jpg alt></p><p>当前 IvorySQL 的最新版本为 <strong>5.0</strong>，对应的 PostgreSQL 版本为 <strong>18</strong>。请注意，IvorySQL 当前仅在 EL8/EL9 上可用。</p><blockquote><p>最后一个支持 EL7 的 IvorySQL 版本为 3.3，对应 PostgreSQL 16.3；最后一个基于 PostgreSQL 17 的版本为 IvorySQL 4.4</p></blockquote><hr><h2 id=安装>安装</h2><p>如果您的环境有互联网访问，您可以使用以下方式，直接将 IvorySQL 仓库加入到节点上，然后执行 PGSQL 剧本进行安装</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t node_repo -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;local,node,pgsql,ivory&#34;}&#39;</span>
</span></span></code></pre></div><hr><h2 id=配置>配置</h2><p>以下参数需要针对 IvorySQL 数据库集群进行配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Ivory SQL Configuration</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,node,pgsql,ivory </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># add ivorysql upstream repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ivory                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># IvorySQL Oracle Compatible Mode</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;ivorysql patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;liboracle_parser, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># do not install any vanilla postgresql extensions</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>使用 Oracle 兼容性模式时，需要动态加载 <code>liboracle_parser</code> 扩展插件。</p></blockquote><hr><h2 id=客户端访问>客户端访问</h2><p>IvorySQL 等效于 PostgreSQL 16，任何兼容 PostgreSQL 线缆协议的客户端工具都可以访问 IvorySQL 集群。</p><hr><h2 id=扩展列表>扩展列表</h2><p>绝大多数 <strong>PGSQL</strong> 模块的 <a href=/docs/pgsql/ext/><strong>扩展插件</strong></a> （非纯 SQL 类）都无法直接在 IvorySQL 内核上使用，如果需要使用，请针对新内核从源码重新编译安装。</p><p>目前 IvorySQL 内核自带了以下 <strong>101</strong> 个扩展插件。</p><table class=full-width><thead><tr><th>name</th><th>version</th><th>comment</th></tr></thead><tbody><tr><td>hstore_plperl</td><td>1.0</td><td>transform between hstore and plperl</td></tr><tr><td>plisql</td><td>1.0</td><td>PL/iSQL procedural language</td></tr><tr><td>hstore_plperlu</td><td>1.0</td><td>transform between hstore and plperlu</td></tr><tr><td>adminpack</td><td>2.1</td><td>administrative functions for PostgreSQL</td></tr><tr><td>insert_username</td><td>1.0</td><td>functions for tracking who changed a table</td></tr><tr><td>dblink</td><td>1.2</td><td>connect to other PostgreSQL databases from within a database</td></tr><tr><td>dict_int</td><td>1.0</td><td>text search dictionary template for integers</td></tr><tr><td>amcheck</td><td>1.3</td><td>functions for verifying relation integrity</td></tr><tr><td>intagg</td><td>1.1</td><td>integer aggregator and enumerator (obsolete)</td></tr><tr><td>autoinc</td><td>1.0</td><td>functions for autoincrementing fields</td></tr><tr><td>bloom</td><td>1.0</td><td>bloom access method - signature file based index</td></tr><tr><td>dict_xsyn</td><td>1.0</td><td>text search dictionary template for extended synonym processing</td></tr><tr><td>btree_gin</td><td>1.3</td><td>support for indexing common datatypes in GIN</td></tr><tr><td>earthdistance</td><td>1.1</td><td>calculate great-circle distances on the surface of the Earth</td></tr><tr><td>file_fdw</td><td>1.0</td><td>foreign-data wrapper for flat file access</td></tr><tr><td>fuzzystrmatch</td><td>1.2</td><td>determine similarities and distance between strings</td></tr><tr><td>btree_gist</td><td>1.7</td><td>support for indexing common datatypes in GiST</td></tr><tr><td>intarray</td><td>1.5</td><td>functions, operators, and index support for 1-D arrays of integers</td></tr><tr><td>citext</td><td>1.6</td><td>data type for case-insensitive character strings</td></tr><tr><td>isn</td><td>1.2</td><td>data types for international product numbering standards</td></tr><tr><td>ivorysql_ora</td><td>1.0</td><td>Oracle Compatible extenison on Postgres Database</td></tr><tr><td>jsonb_plperl</td><td>1.0</td><td>transform between jsonb and plperl</td></tr><tr><td>cube</td><td>1.5</td><td>data type for multidimensional cubes</td></tr><tr><td>dummy_index_am</td><td>1.0</td><td>dummy_index_am - index access method template</td></tr><tr><td>dummy_seclabel</td><td>1.0</td><td>Test code for SECURITY LABEL feature</td></tr><tr><td>hstore</td><td>1.8</td><td>data type for storing sets of (key, value) pairs</td></tr><tr><td>jsonb_plperlu</td><td>1.0</td><td>transform between jsonb and plperlu</td></tr><tr><td>lo</td><td>1.1</td><td>Large Object maintenance</td></tr><tr><td>ltree</td><td>1.2</td><td>data type for hierarchical tree-like structures</td></tr><tr><td>moddatetime</td><td>1.0</td><td>functions for tracking last modification time</td></tr><tr><td>old_snapshot</td><td>1.0</td><td>utilities in support of old_snapshot_threshold</td></tr><tr><td>ora_btree_gin</td><td>1.0</td><td>support for indexing oracle datatypes in GIN</td></tr><tr><td>pg_trgm</td><td>1.6</td><td>text similarity measurement and index searching based on trigrams</td></tr><tr><td>ora_btree_gist</td><td>1.0</td><td>support for oracle indexing common datatypes in GiST</td></tr><tr><td>pg_visibility</td><td>1.2</td><td>examine the visibility map (VM) and page-level visibility info</td></tr><tr><td>pg_walinspect</td><td>1.1</td><td>functions to inspect contents of PostgreSQL Write-Ahead Log</td></tr><tr><td>pgcrypto</td><td>1.3</td><td>cryptographic functions</td></tr><tr><td>pgstattuple</td><td>1.5</td><td>show tuple-level statistics</td></tr><tr><td>pageinspect</td><td>1.12</td><td>inspect the contents of database pages at a low level</td></tr><tr><td>pgrowlocks</td><td>1.2</td><td>show row-level locking information</td></tr><tr><td>pg_buffercache</td><td>1.4</td><td>examine the shared buffer cache</td></tr><tr><td>pg_stat_statements</td><td>1.10</td><td>track planning and execution statistics of all SQL statements executed</td></tr><tr><td>pg_freespacemap</td><td>1.2</td><td>examine the free space map (FSM)</td></tr><tr><td>plsample</td><td>1.0</td><td>PL/Sample</td></tr><tr><td>pg_prewarm</td><td>1.2</td><td>prewarm relation data</td></tr><tr><td>pg_surgery</td><td>1.0</td><td>extension to perform surgery on a damaged relation</td></tr><tr><td>seg</td><td>1.4</td><td>data type for representing line segments or floating-point intervals</td></tr><tr><td>postgres_fdw</td><td>1.1</td><td>foreign-data wrapper for remote PostgreSQL servers</td></tr><tr><td>refint</td><td>1.0</td><td>functions for implementing referential integrity (obsolete)</td></tr><tr><td>test_ext_req_schema1</td><td>1.0</td><td>Required extension to be referenced</td></tr><tr><td>spgist_name_ops</td><td>1.0</td><td>Test opclass for SP-GiST</td></tr><tr><td>test_ext_req_schema2</td><td>1.0</td><td>Test schema referencing of required extensions</td></tr><tr><td>test_shm_mq</td><td>1.0</td><td>Test code for shared memory message queues</td></tr><tr><td>sslinfo</td><td>1.2</td><td>information about SSL certificates</td></tr><tr><td>test_slru</td><td>1.0</td><td>Test code for SLRU</td></tr><tr><td>tablefunc</td><td>1.0</td><td>functions that manipulate whole tables, including crosstab</td></tr><tr><td>bool_plperl</td><td>1.0</td><td>transform between bool and plperl</td></tr><tr><td>tcn</td><td>1.0</td><td>Triggered change notifications</td></tr><tr><td>test_ext_req_schema3</td><td>1.0</td><td>Test schema referencing of 2 required extensions</td></tr><tr><td>test_bloomfilter</td><td>1.0</td><td>Test code for Bloom filter library</td></tr><tr><td>test_copy_callbacks</td><td>1.0</td><td>Test code for COPY callbacks</td></tr><tr><td>test_ginpostinglist</td><td>1.0</td><td>Test code for ginpostinglist.c</td></tr><tr><td>test_custom_rmgrs</td><td>1.0</td><td>Test code for custom WAL resource managers</td></tr><tr><td>test_integerset</td><td>1.0</td><td>Test code for integerset</td></tr><tr><td>test_ddl_deparse</td><td>1.0</td><td>Test code for DDL deparse feature</td></tr><tr><td>tsm_system_rows</td><td>1.0</td><td>TABLESAMPLE method which accepts number of rows as a limit</td></tr><tr><td>test_ext1</td><td>1.0</td><td>Test extension 1</td></tr><tr><td>tsm_system_time</td><td>1.0</td><td>TABLESAMPLE method which accepts time in milliseconds as a limit</td></tr><tr><td>test_ext2</td><td>1.0</td><td>Test extension 2</td></tr><tr><td>unaccent</td><td>1.1</td><td>text search dictionary that removes accents</td></tr><tr><td>test_ext3</td><td>1.0</td><td>Test extension 3</td></tr><tr><td>test_ext4</td><td>1.0</td><td>Test extension 4</td></tr><tr><td>uuid-ossp</td><td>1.1</td><td>generate universally unique identifiers (UUIDs)</td></tr><tr><td>test_ext5</td><td>1.0</td><td>Test extension 5</td></tr><tr><td>worker_spi</td><td>1.0</td><td>Sample background worker</td></tr><tr><td>test_ext6</td><td>1.0</td><td>test_ext6</td></tr><tr><td>test_lfind</td><td>1.0</td><td>Test code for optimized linear search functions</td></tr><tr><td>xml2</td><td>1.1</td><td>XPath querying and XSLT</td></tr><tr><td>test_ext7</td><td>1.0</td><td>Test extension 7</td></tr><tr><td>plpgsql</td><td>1.0</td><td>PL/pgSQL procedural language</td></tr><tr><td>test_ext8</td><td>1.0</td><td>Test extension 8</td></tr><tr><td>test_parser</td><td>1.0</td><td>example of a custom parser for full-text search</td></tr><tr><td>test_pg_dump</td><td>1.0</td><td>Test pg_dump with an extension</td></tr><tr><td>test_ext_cine</td><td>1.0</td><td>Test extension using CREATE IF NOT EXISTS</td></tr><tr><td>test_predtest</td><td>1.0</td><td>Test code for optimizer/util/predtest.c</td></tr><tr><td>test_ext_cor</td><td>1.0</td><td>Test extension using CREATE OR REPLACE</td></tr><tr><td>test_rbtree</td><td>1.0</td><td>Test code for red-black tree library</td></tr><tr><td>test_ext_cyclic1</td><td>1.0</td><td>Test extension cyclic 1</td></tr><tr><td>test_ext_cyclic2</td><td>1.0</td><td>Test extension cyclic 2</td></tr><tr><td>test_ext_extschema</td><td>1.0</td><td>test @extschema@</td></tr><tr><td>test_regex</td><td>1.0</td><td>Test code for backend/regex/</td></tr><tr><td>test_ext_evttrig</td><td>1.0</td><td>Test extension - event trigger</td></tr><tr><td>bool_plperlu</td><td>1.0</td><td>transform between bool and plperlu</td></tr><tr><td>plperl</td><td>1.0</td><td>PL/Perl procedural language</td></tr><tr><td>plperlu</td><td>1.0</td><td>PL/PerlU untrusted procedural language</td></tr><tr><td>hstore_plpython3u</td><td>1.0</td><td>transform between hstore and plpython3u</td></tr><tr><td>jsonb_plpython3u</td><td>1.0</td><td>transform between jsonb and plpython3u</td></tr><tr><td>ltree_plpython3u</td><td>1.0</td><td>transform between ltree and plpython3u</td></tr><tr><td>plpython3u</td><td>1.0</td><td>PL/Python3U untrusted procedural language</td></tr><tr><td>pltcl</td><td>1.0</td><td>PL/Tcl procedural language</td></tr><tr><td>pltclu</td><td>1.0</td><td>PL/TclU untrusted procedural language</td></tr></tbody></table><p>请注意，Pigsty 不对使用 IvorySQL 内核承担任何质保责任，使用此内核遇到的任何问题与需求请联系原厂解决。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-293b566be2331c0d55a3457bdfb0a860>6 - PolarDB PG</h1><div class=lead>使用阿里云开源的 PolarDB for PostgreSQL 内核提供国产信创资质支持，与类似 Oracle RAC 的使用体验。</div><hr><h2 id=概览>概览</h2><p>Pigsty 允许使用 PolarDB 创建带有 “国产化信创资质” 的 PostgreSQL 集群！</p><p>PolarDB for PostgreSQL 基本等效于 PostgreSQL 15，任何兼容 PostgreSQL 线缆协议的客户端工具都可以访问 PolarDB 集群。</p><p>Pigsty 的 PGSQL 仓库中提供了 EL7 / EL8 的 PolarDB PG 开源版安装包，但不会在 Pigsty 安装时下载到本地软件仓库。</p><p>如果您需要 PolarDB PG 的离线安装支持，请考虑我们的 <a href=/docs/about/service>专业订阅服务</a></p><p><img src=/img/pigsty/polar.jpg alt></p><hr><h2 id=安装>安装</h2><p>如果您的环境有互联网访问，您可以使用以下方式，直接将 Pigsty PGSQL 及依赖仓库加入到节点上，</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,node,pgsql</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后在 <code>pg_packages</code> 中，使用 <code>polardb</code> 替换原生的 <code>postgresql</code> 软件包。</p><hr><h2 id=配置>配置</h2><p>以下参数需要针对 PolarDB 数据库集群进行特殊配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PGSQL &amp; PolarDB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;polardb patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># do not install any vanilla postgresql extensions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>polar                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PolarDB Compatible Mode</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># default roles and users in postgres cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readonly  ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-only access     }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_offline   ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for restricted read-only access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readwrite ,login: false ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-write access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin     ,login: false ,roles: [pg_monitor, dbrole_readwrite] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true  ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator   ,superuser: true  ,replication: true ,roles: [pg_monitor, dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;- superuser is required for replication</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor ,roles: [pg_monitor] ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>这里特别注意，PolarDB PG 要求 <code>replicator</code> 复制用户为 Superuser，与原生 PG 不同。</p><hr><h2 id=扩展列表>扩展列表</h2><p>绝大多数 <strong>PGSQL</strong> 模块的 <a href=/docs/pgsql/ext/><strong>扩展插件</strong></a> （非纯 SQL 类）都无法直接在 PolarDB 内核上使用，如果需要使用，请针对新内核从源码重新编译安装。</p><p>目前 PolarDB 内核自带了以下 <strong>61</strong> 个扩展插件，除去 Contrib 扩展外，提供的额外扩展包括：</p><ul><li><code>polar_csn</code> 1.0 : polar_csn</li><li><code>polar_monitor</code> 1.2 : examine the polardb information</li><li><code>polar_monitor_preload</code> 1.1 : examine the polardb information</li><li><code>polar_parameter_check</code> 1.0 : kernel extension for parameter validation</li><li><code>polar_px</code> 1.0 : Parallel Execution extension</li><li><code>polar_stat_env</code> 1.0 : env stat functions for PolarDB</li><li><code>polar_stat_sql</code> 1.3 : Kernel statistics gathering, and sql plan nodes information gathering</li><li><code>polar_tde_utils</code> 1.0 : Internal extension for TDE</li><li><code>polar_vfs</code> 1.0 : polar_vfs</li><li><code>polar_worker</code> 1.0 : polar_worker</li><li><code>timetravel</code> 1.0 : functions for implementing time travel</li><li><code>vector</code> 0.5.1 : vector data type and ivfflat and hnsw access methods</li><li><code>smlar</code> 1.0 : compute similary of any one-dimensional arrays</li></ul><p>PolarDB 可用的完整插件列表：</p><table class=full-width><thead><tr><th>name</th><th>version</th><th>comment</th></tr></thead><tbody><tr><td>hstore_plpython2u</td><td>1.0</td><td>transform between hstore and plpython2u</td></tr><tr><td>dict_int</td><td>1.0</td><td>text search dictionary template for integers</td></tr><tr><td>adminpack</td><td>2.0</td><td>administrative functions for PostgreSQL</td></tr><tr><td>hstore_plpython3u</td><td>1.0</td><td>transform between hstore and plpython3u</td></tr><tr><td>amcheck</td><td>1.1</td><td>functions for verifying relation integrity</td></tr><tr><td>hstore_plpythonu</td><td>1.0</td><td>transform between hstore and plpythonu</td></tr><tr><td>autoinc</td><td>1.0</td><td>functions for autoincrementing fields</td></tr><tr><td>insert_username</td><td>1.0</td><td>functions for tracking who changed a table</td></tr><tr><td>bloom</td><td>1.0</td><td>bloom access method - signature file based index</td></tr><tr><td>file_fdw</td><td>1.0</td><td>foreign-data wrapper for flat file access</td></tr><tr><td>dblink</td><td>1.2</td><td>connect to other PostgreSQL databases from within a database</td></tr><tr><td>btree_gin</td><td>1.3</td><td>support for indexing common datatypes in GIN</td></tr><tr><td>fuzzystrmatch</td><td>1.1</td><td>determine similarities and distance between strings</td></tr><tr><td>lo</td><td>1.1</td><td>Large Object maintenance</td></tr><tr><td>intagg</td><td>1.1</td><td>integer aggregator and enumerator (obsolete)</td></tr><tr><td>btree_gist</td><td>1.5</td><td>support for indexing common datatypes in GiST</td></tr><tr><td>hstore</td><td>1.5</td><td>data type for storing sets of (key, value) pairs</td></tr><tr><td>intarray</td><td>1.2</td><td>functions, operators, and index support for 1-D arrays of integers</td></tr><tr><td>citext</td><td>1.5</td><td>data type for case-insensitive character strings</td></tr><tr><td>cube</td><td>1.4</td><td>data type for multidimensional cubes</td></tr><tr><td>hstore_plperl</td><td>1.0</td><td>transform between hstore and plperl</td></tr><tr><td>isn</td><td>1.2</td><td>data types for international product numbering standards</td></tr><tr><td>jsonb_plperl</td><td>1.0</td><td>transform between jsonb and plperl</td></tr><tr><td>dict_xsyn</td><td>1.0</td><td>text search dictionary template for extended synonym processing</td></tr><tr><td>hstore_plperlu</td><td>1.0</td><td>transform between hstore and plperlu</td></tr><tr><td>earthdistance</td><td>1.1</td><td>calculate great-circle distances on the surface of the Earth</td></tr><tr><td>pg_prewarm</td><td>1.2</td><td>prewarm relation data</td></tr><tr><td>jsonb_plperlu</td><td>1.0</td><td>transform between jsonb and plperlu</td></tr><tr><td>pg_stat_statements</td><td>1.6</td><td>track execution statistics of all SQL statements executed</td></tr><tr><td>jsonb_plpython2u</td><td>1.0</td><td>transform between jsonb and plpython2u</td></tr><tr><td>jsonb_plpython3u</td><td>1.0</td><td>transform between jsonb and plpython3u</td></tr><tr><td>jsonb_plpythonu</td><td>1.0</td><td>transform between jsonb and plpythonu</td></tr><tr><td>pg_trgm</td><td>1.4</td><td>text similarity measurement and index searching based on trigrams</td></tr><tr><td>pgstattuple</td><td>1.5</td><td>show tuple-level statistics</td></tr><tr><td>ltree</td><td>1.1</td><td>data type for hierarchical tree-like structures</td></tr><tr><td>ltree_plpython2u</td><td>1.0</td><td>transform between ltree and plpython2u</td></tr><tr><td>pg_visibility</td><td>1.2</td><td>examine the visibility map (VM) and page-level visibility info</td></tr><tr><td>ltree_plpython3u</td><td>1.0</td><td>transform between ltree and plpython3u</td></tr><tr><td>ltree_plpythonu</td><td>1.0</td><td>transform between ltree and plpythonu</td></tr><tr><td>seg</td><td>1.3</td><td>data type for representing line segments or floating-point intervals</td></tr><tr><td>moddatetime</td><td>1.0</td><td>functions for tracking last modification time</td></tr><tr><td>pgcrypto</td><td>1.3</td><td>cryptographic functions</td></tr><tr><td>pgrowlocks</td><td>1.2</td><td>show row-level locking information</td></tr><tr><td>pageinspect</td><td>1.7</td><td>inspect the contents of database pages at a low level</td></tr><tr><td>pg_buffercache</td><td>1.3</td><td>examine the shared buffer cache</td></tr><tr><td>pg_freespacemap</td><td>1.2</td><td>examine the free space map (FSM)</td></tr><tr><td>tcn</td><td>1.0</td><td>Triggered change notifications</td></tr><tr><td>plperl</td><td>1.0</td><td>PL/Perl procedural language</td></tr><tr><td>uuid-ossp</td><td>1.1</td><td>generate universally unique identifiers (UUIDs)</td></tr><tr><td>plperlu</td><td>1.0</td><td>PL/PerlU untrusted procedural language</td></tr><tr><td>refint</td><td>1.0</td><td>functions for implementing referential integrity (obsolete)</td></tr><tr><td>xml2</td><td>1.1</td><td>XPath querying and XSLT</td></tr><tr><td>plpgsql</td><td>1.0</td><td>PL/pgSQL procedural language</td></tr><tr><td>plpython3u</td><td>1.0</td><td>PL/Python3U untrusted procedural language</td></tr><tr><td>pltcl</td><td>1.0</td><td>PL/Tcl procedural language</td></tr><tr><td>pltclu</td><td>1.0</td><td>PL/TclU untrusted procedural language</td></tr><tr><td>polar_csn</td><td>1.0</td><td>polar_csn</td></tr><tr><td>sslinfo</td><td>1.2</td><td>information about SSL certificates</td></tr><tr><td>polar_monitor</td><td>1.2</td><td>examine the polardb information</td></tr><tr><td>polar_monitor_preload</td><td>1.1</td><td>examine the polardb information</td></tr><tr><td>polar_parameter_check</td><td>1.0</td><td>kernel extension for parameter validation</td></tr><tr><td>polar_px</td><td>1.0</td><td>Parallel Execution extension</td></tr><tr><td>tablefunc</td><td>1.0</td><td>functions that manipulate whole tables, including crosstab</td></tr><tr><td>polar_stat_env</td><td>1.0</td><td>env stat functions for PolarDB</td></tr><tr><td>smlar</td><td>1.0</td><td>compute similary of any one-dimensional arrays</td></tr><tr><td>timetravel</td><td>1.0</td><td>functions for implementing time travel</td></tr><tr><td>tsm_system_rows</td><td>1.0</td><td>TABLESAMPLE method which accepts number of rows as a limit</td></tr><tr><td>polar_stat_sql</td><td>1.3</td><td>Kernel statistics gathering, and sql plan nodes information gathering</td></tr><tr><td>tsm_system_time</td><td>1.0</td><td>TABLESAMPLE method which accepts time in milliseconds as a limit</td></tr><tr><td>polar_tde_utils</td><td>1.0</td><td>Internal extension for TDE</td></tr><tr><td>polar_vfs</td><td>1.0</td><td>polar_vfs</td></tr><tr><td>polar_worker</td><td>1.0</td><td>polar_worker</td></tr><tr><td>unaccent</td><td>1.1</td><td>text search dictionary that removes accents</td></tr><tr><td>postgres_fdw</td><td>1.0</td><td>foreign-data wrapper for remote PostgreSQL servers</td></tr></tbody></table><ul><li>Pigsty 专业版提供 PolarDB 离线安装支持，扩展插件编译支持，以及针对 PolarDB 集群进行专门适配的监控与管控支持。</li><li>Pigsty 与阿里云内核团队有合作，可以提供有偿内核兜底支持服务。</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ffed78d77ebf7627086f9da938f9b9f6>7 - PolarDB Oracle</h1><div class=lead>使用阿里云商业版本的 PolarDB for Oracle 内核（闭源，PG14，仅在特殊企业版定制中可用）</div><p>Pigsty 允许使用 PolarDB 创建带有 “国产化信创资质” 的 PolarDB for Oracle 集群！</p><p>根据 【<a href=http://www.itsec.gov.cn/aqkkcp/cpgg/202312/t20231226_162074.html>安全可靠测评结果公告（2023年第1号）</a>】，附表三、集中式数据库。PolarDB v2.0 属于自主可控，安全可靠的国产信创数据库。</p><p>PolarDB for Oracle 是基于 PolarDB for PostgreSQL 进行二次开发的 Oracle 兼容版本，两者共用同一套内核，通过 <code>--compatibility-mode</code> 参数进行区分。</p><p>我们与阿里云内核团队合作，提供基于 PolarDB v2.0 内核与 Pigsty 的完整数据库解决方案，请联系销售咨询，或在阿里云市场自行采购。</p><p>PolarDB for Oracle 内核目前仅在 EL 系统中可用。</p><p><img src=/img/pigsty/polar.jpg alt></p><hr><h2 id=扩展>扩展</h2><p>目前 PolarDB 2.0 (Oracle兼容) 内核自带了以下 <strong>188</strong> 个扩展插件：</p><table class=full-width><thead><tr><th>name</th><th>default_version</th><th>comment</th></tr></thead><tbody><tr><td>cube</td><td>1.5</td><td>data type for multidimensional cubes</td></tr><tr><td>ip4r</td><td>2.4</td><td>NULL</td></tr><tr><td>adminpack</td><td>2.1</td><td>administrative functions for PostgreSQL</td></tr><tr><td>dict_xsyn</td><td>1.0</td><td>text search dictionary template for extended synonym processing</td></tr><tr><td>amcheck</td><td>1.4</td><td>functions for verifying relation integrity</td></tr><tr><td>autoinc</td><td>1.0</td><td>functions for autoincrementing fields</td></tr><tr><td>hstore</td><td>1.8</td><td>data type for storing sets of (key, value) pairs</td></tr><tr><td>bloom</td><td>1.0</td><td>bloom access method - signature file based index</td></tr><tr><td>earthdistance</td><td>1.1</td><td>calculate great-circle distances on the surface of the Earth</td></tr><tr><td>hstore_plperl</td><td>1.0</td><td>transform between hstore and plperl</td></tr><tr><td>bool_plperl</td><td>1.0</td><td>transform between bool and plperl</td></tr><tr><td>file_fdw</td><td>1.0</td><td>foreign-data wrapper for flat file access</td></tr><tr><td>bool_plperlu</td><td>1.0</td><td>transform between bool and plperlu</td></tr><tr><td>fuzzystrmatch</td><td>1.1</td><td>determine similarities and distance between strings</td></tr><tr><td>hstore_plperlu</td><td>1.0</td><td>transform between hstore and plperlu</td></tr><tr><td>btree_gin</td><td>1.3</td><td>support for indexing common datatypes in GIN</td></tr><tr><td>hstore_plpython2u</td><td>1.0</td><td>transform between hstore and plpython2u</td></tr><tr><td>btree_gist</td><td>1.6</td><td>support for indexing common datatypes in GiST</td></tr><tr><td>hll</td><td>2.17</td><td>type for storing hyperloglog data</td></tr><tr><td>hstore_plpython3u</td><td>1.0</td><td>transform between hstore and plpython3u</td></tr><tr><td>citext</td><td>1.6</td><td>data type for case-insensitive character strings</td></tr><tr><td>hstore_plpythonu</td><td>1.0</td><td>transform between hstore and plpythonu</td></tr><tr><td>hypopg</td><td>1.3.1</td><td>Hypothetical indexes for PostgreSQL</td></tr><tr><td>insert_username</td><td>1.0</td><td>functions for tracking who changed a table</td></tr><tr><td>dblink</td><td>1.2</td><td>connect to other PostgreSQL databases from within a database</td></tr><tr><td>decoderbufs</td><td>0.1.0</td><td>Logical decoding plugin that delivers WAL stream changes using a Protocol Buffer format</td></tr><tr><td>intagg</td><td>1.1</td><td>integer aggregator and enumerator (obsolete)</td></tr><tr><td>dict_int</td><td>1.0</td><td>text search dictionary template for integers</td></tr><tr><td>intarray</td><td>1.5</td><td>functions, operators, and index support for 1-D arrays of integers</td></tr><tr><td>isn</td><td>1.2</td><td>data types for international product numbering standards</td></tr><tr><td>jsonb_plperl</td><td>1.0</td><td>transform between jsonb and plperl</td></tr><tr><td>jsonb_plperlu</td><td>1.0</td><td>transform between jsonb and plperlu</td></tr><tr><td>jsonb_plpython2u</td><td>1.0</td><td>transform between jsonb and plpython2u</td></tr><tr><td>jsonb_plpython3u</td><td>1.0</td><td>transform between jsonb and plpython3u</td></tr><tr><td>jsonb_plpythonu</td><td>1.0</td><td>transform between jsonb and plpythonu</td></tr><tr><td>lo</td><td>1.1</td><td>Large Object maintenance</td></tr><tr><td>log_fdw</td><td>1.0</td><td>foreign-data wrapper for csvlog</td></tr><tr><td>ltree</td><td>1.2</td><td>data type for hierarchical tree-like structures</td></tr><tr><td>ltree_plpython2u</td><td>1.0</td><td>transform between ltree and plpython2u</td></tr><tr><td>ltree_plpython3u</td><td>1.0</td><td>transform between ltree and plpython3u</td></tr><tr><td>ltree_plpythonu</td><td>1.0</td><td>transform between ltree and plpythonu</td></tr><tr><td>moddatetime</td><td>1.0</td><td>functions for tracking last modification time</td></tr><tr><td>old_snapshot</td><td>1.0</td><td>utilities in support of old_snapshot_threshold</td></tr><tr><td>oracle_fdw</td><td>1.2</td><td>foreign data wrapper for Oracle access</td></tr><tr><td>oss_fdw</td><td>1.1</td><td>foreign-data wrapper for OSS access</td></tr><tr><td>pageinspect</td><td>2.1</td><td>inspect the contents of database pages at a low level</td></tr><tr><td>pase</td><td>0.0.1</td><td>ant ai similarity search</td></tr><tr><td>pg_bigm</td><td>1.2</td><td>text similarity measurement and index searching based on bigrams</td></tr><tr><td>pg_freespacemap</td><td>1.2</td><td>examine the free space map (FSM)</td></tr><tr><td>pg_hint_plan</td><td>1.4</td><td>controls execution plan with hinting phrases in comment of special form</td></tr><tr><td>pg_buffercache</td><td>1.5</td><td>examine the shared buffer cache</td></tr><tr><td>pg_prewarm</td><td>1.2</td><td>prewarm relation data</td></tr><tr><td>pg_repack</td><td>1.4.8-1</td><td>Reorganize tables in PostgreSQL databases with minimal locks</td></tr><tr><td>pg_sphere</td><td>1.0</td><td>spherical objects with useful functions, operators and index support</td></tr><tr><td>pg_cron</td><td>1.5</td><td>Job scheduler for PostgreSQL</td></tr><tr><td>pg_jieba</td><td>1.1.0</td><td>a parser for full-text search of Chinese</td></tr><tr><td>pg_stat_kcache</td><td>2.2.1</td><td>Kernel statistics gathering</td></tr><tr><td>pg_stat_statements</td><td>1.9</td><td>track planning and execution statistics of all SQL statements executed</td></tr><tr><td>pg_surgery</td><td>1.0</td><td>extension to perform surgery on a damaged relation</td></tr><tr><td>pg_trgm</td><td>1.6</td><td>text similarity measurement and index searching based on trigrams</td></tr><tr><td>pg_visibility</td><td>1.2</td><td>examine the visibility map (VM) and page-level visibility info</td></tr><tr><td>pg_wait_sampling</td><td>1.1</td><td>sampling based statistics of wait events</td></tr><tr><td>pgaudit</td><td>1.6.2</td><td>provides auditing functionality</td></tr><tr><td>pgcrypto</td><td>1.3</td><td>cryptographic functions</td></tr><tr><td>pgrowlocks</td><td>1.2</td><td>show row-level locking information</td></tr><tr><td>pgstattuple</td><td>1.5</td><td>show tuple-level statistics</td></tr><tr><td>pgtap</td><td>1.2.0</td><td>Unit testing for PostgreSQL</td></tr><tr><td>pldbgapi</td><td>1.1</td><td>server-side support for debugging PL/pgSQL functions</td></tr><tr><td>plperl</td><td>1.0</td><td>PL/Perl procedural language</td></tr><tr><td>plperlu</td><td>1.0</td><td>PL/PerlU untrusted procedural language</td></tr><tr><td>plpgsql</td><td>1.0</td><td>PL/pgSQL procedural language</td></tr><tr><td>plpython2u</td><td>1.0</td><td>PL/Python2U untrusted procedural language</td></tr><tr><td>plpythonu</td><td>1.0</td><td>PL/PythonU untrusted procedural language</td></tr><tr><td>plsql</td><td>1.0</td><td>Oracle compatible PL/SQL procedural language</td></tr><tr><td>pltcl</td><td>1.0</td><td>PL/Tcl procedural language</td></tr><tr><td>pltclu</td><td>1.0</td><td>PL/TclU untrusted procedural language</td></tr><tr><td>polar_bfile</td><td>1.0</td><td>The BFILE data type enables access to binary file LOBs that are stored in file systems outside Database</td></tr><tr><td>polar_bpe</td><td>1.0</td><td>polar_bpe</td></tr><tr><td>polar_builtin_cast</td><td>1.1</td><td>Internal extension for builtin casts</td></tr><tr><td>polar_builtin_funcs</td><td>2.0</td><td>implement polar builtin functions</td></tr><tr><td>polar_builtin_type</td><td>1.5</td><td>polar_builtin_type for PolarDB</td></tr><tr><td>polar_builtin_view</td><td>1.5</td><td>polar_builtin_view</td></tr><tr><td>polar_catalog</td><td>1.2</td><td>polardb pg extend catalog</td></tr><tr><td>polar_channel</td><td>1.0</td><td>polar_channel</td></tr><tr><td>polar_constraint</td><td>1.0</td><td>polar_constraint</td></tr><tr><td>polar_csn</td><td>1.0</td><td>polar_csn</td></tr><tr><td>polar_dba_views</td><td>1.0</td><td>polar_dba_views</td></tr><tr><td>polar_dbms_alert</td><td>1.2</td><td>implement polar_dbms_alert - supports asynchronous notification of database events.</td></tr><tr><td>polar_dbms_application_info</td><td>1.0</td><td>implement polar_dbms_application_info - record names of executing modules or transactions in the database.</td></tr><tr><td>polar_dbms_pipe</td><td>1.1</td><td>implements polar_dbms_pipe - package lets two or more sessions in the same instance communicate.</td></tr><tr><td>polar_dbms_aq</td><td>1.2</td><td>implement dbms_aq - provides an interface to Advanced Queuing.</td></tr><tr><td>polar_dbms_lob</td><td>1.3</td><td>implement dbms_lob - provides subprograms to operate on BLOBs, CLOBs, and NCLOBs.</td></tr><tr><td>polar_dbms_output</td><td>1.2</td><td>implement polar_dbms_output - enables you to send messages from stored procedures.</td></tr><tr><td>polar_dbms_lock</td><td>1.0</td><td>implement polar_dbms_lock - provides an interface to Oracle Lock Management services.</td></tr><tr><td>polar_dbms_aqadm</td><td>1.3</td><td>polar_dbms_aqadm - procedures to manage Advanced Queuing configuration and administration information.</td></tr><tr><td>polar_dbms_assert</td><td>1.0</td><td>implement polar_dbms_assert - provide an interface to validate properties of the input value.</td></tr><tr><td>polar_dbms_metadata</td><td>1.0</td><td>implement polar_dbms_metadata - provides a way for you to retrieve metadata from the database dictionary.</td></tr><tr><td>polar_dbms_random</td><td>1.0</td><td>implement polar_dbms_random - a built-in random number generator, not intended for cryptography</td></tr><tr><td>polar_dbms_crypto</td><td>1.1</td><td>implement dbms_crypto - provides an interface to encrypt and decrypt stored data.</td></tr><tr><td>polar_dbms_redact</td><td>1.0</td><td>implement polar_dbms_redact - provides an interface to mask data from queries by an application.</td></tr><tr><td>polar_dbms_debug</td><td>1.1</td><td>server-side support for debugging PL/SQL functions</td></tr><tr><td>polar_dbms_job</td><td>1.0</td><td>polar_dbms_job</td></tr><tr><td>polar_dbms_mview</td><td>1.1</td><td>implement polar_dbms_mview - enables to refresh materialized views.</td></tr><tr><td>polar_dbms_job_preload</td><td>1.0</td><td>polar_dbms_job_preload</td></tr><tr><td>polar_dbms_obfuscation_toolkit</td><td>1.1</td><td>implement polar_dbms_obfuscation_toolkit - enables an application to get data md5.</td></tr><tr><td>polar_dbms_rls</td><td>1.1</td><td>implement polar_dbms_rls - a fine-grained access control administrative built-in package</td></tr><tr><td>polar_multi_toast_utils</td><td>1.0</td><td>polar_multi_toast_utils</td></tr><tr><td>polar_dbms_session</td><td>1.2</td><td>implement polar_dbms_session - support to set preferences and security levels.</td></tr><tr><td>polar_odciconst</td><td>1.0</td><td>implement ODCIConst - Provide some built-in constants in Oracle.</td></tr><tr><td>polar_dbms_sql</td><td>1.2</td><td>implement polar_dbms_sql - provides an interface to execute dynamic SQL.</td></tr><tr><td>polar_osfs_toolkit</td><td>1.0</td><td>osfs library tools and functions extension</td></tr><tr><td>polar_dbms_stats</td><td>14.0</td><td>stabilize plans by fixing statistics</td></tr><tr><td>polar_monitor</td><td>1.5</td><td>monitor functions for PolarDB</td></tr><tr><td>polar_osfs_utils</td><td>1.0</td><td>osfs library utils extension</td></tr><tr><td>polar_dbms_utility</td><td>1.3</td><td>implement polar_dbms_utility - provides various utility subprograms.</td></tr><tr><td>polar_parameter_check</td><td>1.0</td><td>kernel extension for parameter validation</td></tr><tr><td>polar_dbms_xmldom</td><td>1.0</td><td>implement dbms_xmldom and dbms_xmlparser - support standard DOM interface and xml parser object</td></tr><tr><td>polar_parameter_manager</td><td>1.1</td><td>Extension to select parameters for manger.</td></tr><tr><td>polar_faults</td><td>1.0.0</td><td>simulate some database faults for end user or testing system.</td></tr><tr><td>polar_monitor_preload</td><td>1.1</td><td>examine the polardb information</td></tr><tr><td>polar_proxy_utils</td><td>1.0</td><td>Extension to provide operations about proxy.</td></tr><tr><td>polar_feature_utils</td><td>1.2</td><td>PolarDB feature utilization</td></tr><tr><td>polar_global_awr</td><td>1.0</td><td>PolarDB Global AWR Report</td></tr><tr><td>polar_publication</td><td>1.0</td><td>support polardb pg logical replication</td></tr><tr><td>polar_global_cache</td><td>1.0</td><td>polar_global_cache</td></tr><tr><td>polar_px</td><td>1.0</td><td>Parallel Execution extension</td></tr><tr><td>polar_serverless</td><td>1.0</td><td>polar serverless extension</td></tr><tr><td>polar_resource_manager</td><td>1.0</td><td>a background process that forcibly frees user session process memory</td></tr><tr><td>polar_sys_context</td><td>1.1</td><td>implement polar_sys_context - returns the value of parameter associated with the context namespace at the current instant.</td></tr><tr><td>polar_gpc</td><td>1.3</td><td>polar_gpc</td></tr><tr><td>polar_tde_utils</td><td>1.0</td><td>Internal extension for TDE</td></tr><tr><td>polar_gtt</td><td>1.1</td><td>polar_gtt</td></tr><tr><td>polar_utl_encode</td><td>1.2</td><td>implement polar_utl_encode - provides functions that encode RAW data into a standard encoded format</td></tr><tr><td>polar_htap</td><td>1.1</td><td>extension for PolarDB HTAP</td></tr><tr><td>polar_htap_db</td><td>1.0</td><td>extension for PolarDB HTAP database level operation</td></tr><tr><td>polar_io_stat</td><td>1.0</td><td>polar io stat in multi dimension</td></tr><tr><td>polar_utl_file</td><td>1.0</td><td>implement utl_file - support PL/SQL programs can read and write operating system text files</td></tr><tr><td>polar_ivm</td><td>1.0</td><td>polar_ivm</td></tr><tr><td>polar_sql_mapping</td><td>1.2</td><td>Record error sqls and mapping them to correct one</td></tr><tr><td>polar_stat_sql</td><td>1.0</td><td>Kernel statistics gathering, and sql plan nodes information gathering</td></tr><tr><td>tds_fdw</td><td>2.0.2</td><td>Foreign data wrapper for querying a TDS database (Sybase or Microsoft SQL Server)</td></tr><tr><td>xml2</td><td>1.1</td><td>XPath querying and XSLT</td></tr><tr><td>polar_upgrade_catalogs</td><td>1.1</td><td>Upgrade catalogs for old version instance</td></tr><tr><td>polar_utl_i18n</td><td>1.1</td><td>polar_utl_i18n</td></tr><tr><td>polar_utl_raw</td><td>1.0</td><td>implement utl_raw - provides SQL functions for manipulating RAW datatypes.</td></tr><tr><td>timescaledb</td><td>2.9.2</td><td>Enables scalable inserts and complex queries for time-series data</td></tr><tr><td>polar_vfs</td><td>1.0</td><td>polar virtual file system for different storage</td></tr><tr><td>polar_worker</td><td>1.0</td><td>polar_worker</td></tr><tr><td>postgres_fdw</td><td>1.1</td><td>foreign-data wrapper for remote PostgreSQL servers</td></tr><tr><td>refint</td><td>1.0</td><td>functions for implementing referential integrity (obsolete)</td></tr><tr><td>roaringbitmap</td><td>0.5</td><td>support for Roaring Bitmaps</td></tr><tr><td>tsm_system_time</td><td>1.0</td><td>TABLESAMPLE method which accepts time in milliseconds as a limit</td></tr><tr><td>vector</td><td>0.5.0</td><td>vector data type and ivfflat and hnsw access methods</td></tr><tr><td>rum</td><td>1.3</td><td>RUM index access method</td></tr><tr><td>unaccent</td><td>1.1</td><td>text search dictionary that removes accents</td></tr><tr><td>seg</td><td>1.4</td><td>data type for representing line segments or floating-point intervals</td></tr><tr><td>sequential_uuids</td><td>1.0.2</td><td>generator of sequential UUIDs</td></tr><tr><td>uuid-ossp</td><td>1.1</td><td>generate universally unique identifiers (UUIDs)</td></tr><tr><td>smlar</td><td>1.0</td><td>compute similary of any one-dimensional arrays</td></tr><tr><td>varbitx</td><td>1.1</td><td>varbit functions pack</td></tr><tr><td>sslinfo</td><td>1.2</td><td>information about SSL certificates</td></tr><tr><td>tablefunc</td><td>1.0</td><td>functions that manipulate whole tables, including crosstab</td></tr><tr><td>tcn</td><td>1.0</td><td>Triggered change notifications</td></tr><tr><td>zhparser</td><td>1.0</td><td>a parser for full-text search of Chinese</td></tr><tr><td>address_standardizer</td><td>3.3.2</td><td>Ganos PostGIS address standardizer</td></tr><tr><td>address_standardizer_data_us</td><td>3.3.2</td><td>Ganos PostGIS address standardizer data us</td></tr><tr><td>ganos_fdw</td><td>6.0</td><td>Ganos Spatial FDW extension for POLARDB</td></tr><tr><td>ganos_geometry</td><td>6.0</td><td>Ganos geometry lite extension for POLARDB</td></tr><tr><td>ganos_geometry_pyramid</td><td>6.0</td><td>Ganos Geometry Pyramid extension for POLARDB</td></tr><tr><td>ganos_geometry_sfcgal</td><td>6.0</td><td>Ganos geometry lite sfcgal extension for POLARDB</td></tr><tr><td>ganos_geomgrid</td><td>6.0</td><td>Ganos geometry grid extension for POLARDB</td></tr><tr><td>ganos_importer</td><td>6.0</td><td>Ganos Spatial importer extension for POLARDB</td></tr><tr><td>ganos_networking</td><td>6.0</td><td>Ganos networking</td></tr><tr><td>ganos_pointcloud</td><td>6.0</td><td>Ganos pointcloud extension For POLARDB</td></tr><tr><td>ganos_pointcloud_geometry</td><td>6.0</td><td>Ganos_pointcloud LIDAR data and ganos_geometry data for POLARDB</td></tr><tr><td>ganos_raster</td><td>6.0</td><td>Ganos raster extension for POLARDB</td></tr><tr><td>ganos_scene</td><td>6.0</td><td>Ganos scene extension for POLARDB</td></tr><tr><td>ganos_sfmesh</td><td>6.0</td><td>Ganos surface mesh extension for POLARDB</td></tr><tr><td>ganos_spatialref</td><td>6.0</td><td>Ganos spatial reference extension for POLARDB</td></tr><tr><td>ganos_trajectory</td><td>6.0</td><td>Ganos trajectory extension for POLARDB</td></tr><tr><td>ganos_vomesh</td><td>6.0</td><td>Ganos volumn mesh extension for POLARDB</td></tr><tr><td>postgis_tiger_geocoder</td><td>3.3.2</td><td>Ganos PostGIS tiger geocoder</td></tr><tr><td>postgis_topology</td><td>3.3.2</td><td>Ganos PostGIS topology</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-5e2941fff6b5b682be30d52c9d82b986>8 - Percona</h1><div class=lead>支持 TDE 透明加密的 Percona Postgres 发行版</div><p><a href=https://www.percona.com/postgresql/software/postgresql-distribution>Percona Postgres</a> 是一个带有 <a href=https://docs.percona.com/pg-tde/index.html><code>pg_tde</code></a>（透明数据加密）扩展的补丁 Postgres 内核。</p><p>它与 PostgreSQL 18.1 兼容，在所有 Pigsty 支持的平台上都可用。</p><ul><li><a href=https://andreas.scherbaum.la/post/2025-06-30_performance-test-for-percona-transparent-data-encryption-tde/>Percona 透明数据加密（TDE）性能测试</a></li></ul><hr><h2 id=快速开始>快速开始</h2><p>使用 Pigsty <a href=/docs/setup/install><strong>标准安装流程</strong></a>，配合 <a href=https://github.com/pgsty/pigsty/blob/main/conf/pgtde.yml><code>pgtde</code></a> 配置模板。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>./configure -c pgtde     <span style=color:#8f5902;font-style:italic># 使用 percona postgres 内核</span>
</span></span><span style=display:flex><span>./deploy.yml             <span style=color:#8f5902;font-style:italic># 使用 pigsty 设置一切</span>
</span></span></code></pre></div><hr><h2 id=配置>配置</h2><p>需要调整以下参数来部署 Percona 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin   ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cmdb.sql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty tde database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pigsty]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>vector, postgis, pg_tde ,pgaudit, { name: pg_stat_monitor, schema: monitor } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行全量备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Percona PostgreSQL TDE 临时设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>percona-main, pgsql-common ] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 安装 percona postgres 包</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_tde, pgaudit, pg_stat_statements, pg_stat_monitor, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=扩展>扩展</h2><p>Percona 提供了 80 个可用的扩展，包括 <code>pg_tde</code>, <code>pgvector</code>, <code>postgis</code>, <code>pgaudit</code>, <code>set_user</code>, <code>pg_stat_monitor</code> 等实用三方扩展。</p><table class=full-width><thead><tr><th>扩展名</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>pg_tde</td><td>2.1</td><td>Percona 透明数据加密访问方法</td></tr><tr><td>vector</td><td>0.8.1</td><td>向量数据类型及 ivfflat 和 hnsw 访问方法</td></tr><tr><td>postgis</td><td>3.5.4</td><td>PostGIS 几何和地理空间类型及函数</td></tr><tr><td>pgaudit</td><td>18.0</td><td>提供审计功能</td></tr><tr><td>pg_stat_monitor</td><td>2.3</td><td>PostgreSQL 查询性能监控工具</td></tr><tr><td>set_user</td><td>4.2.0</td><td>类似 SET ROLE 但带有额外日志记录</td></tr><tr><td>pg_repack</td><td>1.5.3</td><td>以最小锁定重组 PostgreSQL 数据库中的表</td></tr><tr><td>hstore</td><td>1.8</td><td>用于存储(键,值)对集合的数据类型</td></tr><tr><td>ltree</td><td>1.3</td><td>用于层次树状结构的数据类型</td></tr><tr><td>pg_trgm</td><td>1.6</td><td>基于三元组的文本相似度测量和索引搜索</td></tr></tbody></table><p>完整的 80 个扩展列表请参考 <a href=https://docs.percona.com/postgresql/18/extensions.html>Percona Postgres 官方文档</a>。</p><hr><h2 id=关键特性>关键特性</h2><ul><li><strong>透明数据加密</strong>：使用 pg_tde 扩展提供静态数据加密</li><li><strong>PostgreSQL 18 兼容</strong>：基于最新 PostgreSQL 18 版本</li><li><strong>企业级扩展</strong>：包含 pgaudit、pg_stat_monitor 等企业级功能</li><li><strong>完整生态</strong>：支持 pgvector、PostGIS 等流行扩展</li></ul><blockquote><p><strong>注意</strong>：目前处于稳定阶段 - 在生产使用前请彻底评估。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-e59a81d2edf1c2072f834e4d8ef376db>9 - PostgresML</h1><div class=lead>如何使用 Pigsty 部署 PostgresML，在数据库内进行机器学习、模型训练、推理、Embedding 与 RAG。</div><p><a href=https://postgresml.org/>PostgresML</a> 是一个 PostgreSQL 扩展，支持最新的大语言模型（LLM）、向量操作、经典机器学习以及传统的 Postgres 应用负载。</p><p>PostgresML (pgml) 是一个用 Rust 编写的 PostgreSQL 扩展。您可以运行独立的 Docker 镜像，但本文档不是 docker-compose 模板介绍，仅供参考。</p><p>PostgresML 官方支持 Ubuntu 22.04，但我们也为 EL 8/9 维护了 RPM 版本，如果您不需要 CUDA 和 NVIDIA 相关功能的话。</p><p>您需要在数据库节点上能够访问互联网，以便从 PyPI 下载 Python 依赖，并从 HuggingFace 下载模型。</p><hr><h2 id=配置>配置</h2><p>PostgresML 是一个用 Rust 编写的扩展，官方支持 Ubuntu。Pigsty 在 EL8 和 EL9 上维护了 PostgresML 的 RPM 版本。</p><p><strong>创建新集群</strong></p><p>PostgresML 2.7.9 可用于 PostgreSQL 15，支持 Ubuntu 22.04（官方）、Debian 12 和 EL 8/9（Pigsty 维护）。要启用 <code>pgml</code>，首先需要安装扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_meta     ,password: DBUser.Meta     ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_view     ,password: DBUser.Viewer   ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span>{<span style=color:#204a87;font-weight:700>name: postgis, schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public}, {name: timescaledb}]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgml, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pgml_15 pgvector_15 wal2json_15 repack_15&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># ubuntu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#pg_extensions: [ &#39;postgresql-pgml-15 postgresql-15-pgvector postgresql-15-wal2json postgresql-15-repack&#39; ]  # ubuntu</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>在 EL 8/9 中，扩展名为 <code>pgml_15</code>，对应的 Ubuntu/Debian 名称为 <code>postgresql-pgml-15</code>。同时需要将 <code>pgml</code> 添加到 <code>pg_libs</code> 中。</p><p><strong>在现有集群上启用</strong></p><p>要在现有集群上启用 <code>pgml</code>，可以使用 Ansible 的 <code>package</code> 模块安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible pg-meta -m package -b -a <span style=color:#4e9a06>&#39;name=pgml_15&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ansible el8,el9 -m package -b -a &#39;name=pgml_15&#39;           # EL 8/9</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ansible u22 -m package -b -a &#39;name=postgresql-pgml-15&#39;    # Ubuntu 22.04 jammy</span>
</span></span></code></pre></div><hr><h2 id=python-依赖>Python 依赖</h2><p>您还需要在集群节点上安装 PostgresML 的 Python 依赖。官方教程：<a href=https://postgresml.org/docs/guides/developer-docs/installation>安装指南</a></p><p><strong>安装 Python 和 PIP</strong></p><p>确保已安装 <code>python3</code>、<code>pip</code> 和 <code>venv</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Ubuntu 22.04 (python3.10)，需要使用 apt 安装 pip 和 venv</span>
</span></span><span style=display:flex><span>sudo apt install -y python3 python3-pip python3-venv
</span></span></code></pre></div><p>对于 EL 8 / EL9 及兼容发行版，可以使用 python3.11：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 8/9，可以升级默认的 pip 和 virtualenv</span>
</span></span><span style=display:flex><span>sudo yum install -y python3.11 python3.11-pip       <span style=color:#8f5902;font-style:italic># 安装最新的 python3.11</span>
</span></span><span style=display:flex><span>python3.11 -m pip install --upgrade pip virtualenv  <span style=color:#8f5902;font-style:italic># 在 EL8 / EL9 上使用 python3.11</span>
</span></span></code></pre></div><details><summary>使用 PyPI 镜像</summary><p>对于中国大陆用户，建议使用清华大学 PyPI <a href=https://mirrors.tuna.tsinghua.edu.cn/help/pypi/>镜像</a>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip config <span style=color:#204a87>set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple    <span style=color:#8f5902;font-style:italic># 设置全局镜像（推荐）</span>
</span></span><span style=display:flex><span>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package        <span style=color:#8f5902;font-style:italic># 单次安装时使用</span>
</span></span></code></pre></div></details><p><strong>安装依赖包</strong></p><p>创建 Python 虚拟环境，并使用 <code>pip</code> 从 <a href=https://github.com/postgresml/postgresml/blob/master/pgml-extension/requirements.txt><code>requirements.txt</code></a> 和 <a href=https://github.com/postgresml/postgresml/blob/master/pgml-extension/requirements-xformers.txt><code>requirements-xformers.txt</code></a> 安装依赖。</p><blockquote><p>如果您使用的是 EL 8/9，需要将以下命令中的 <code>python3</code> 替换为 <code>python3.11</code>。</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>su - postgres<span style=color:#000;font-weight:700>;</span>                          <span style=color:#8f5902;font-style:italic># 使用数据库超级用户创建虚拟环境</span>
</span></span><span style=display:flex><span>mkdir -p /data/pgml<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> /data/pgml<span style=color:#000;font-weight:700>;</span>     <span style=color:#8f5902;font-style:italic># 创建虚拟环境目录</span>
</span></span><span style=display:flex><span>python3    -m venv /data/pgml           <span style=color:#8f5902;font-style:italic># 创建虚拟环境目录（Ubuntu 22.04）</span>
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> /data/pgml/bin/activate          <span style=color:#8f5902;font-style:italic># 激活虚拟环境</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 写入 Python 依赖并使用 pip 安装</span>
</span></span><span style=display:flex><span>cat &gt; /data/pgml/requirments.txt <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>accelerate==0.22.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>auto-gptq==0.4.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>bitsandbytes==0.41.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>catboost==1.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>ctransformers==0.2.27
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>datasets==2.14.5
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deepspeed==0.10.3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>huggingface-hub==0.17.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>InstructorEmbedding==1.0.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>lightgbm==4.1.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>orjson==3.9.7
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>pandas==2.1.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>rich==13.5.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>rouge==1.0.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>sacrebleu==2.3.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>sacremoses==0.0.53
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>scikit-learn==1.3.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>sentencepiece==0.1.99
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>sentence-transformers==2.2.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>tokenizers==0.13.3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>torch==2.0.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>torchaudio==2.0.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>torchvision==0.15.2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>tqdm==4.66.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>transformers==4.33.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>xgboost==2.0.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>langchain==0.0.287
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>einops==0.6.1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>pynvml==11.5.0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 在虚拟环境中使用 pip 安装依赖</span>
</span></span><span style=display:flex><span>python3 -m pip install -r /data/pgml/requirments.txt
</span></span><span style=display:flex><span>python3 -m pip install <span style=color:#000>xformers</span><span style=color:#ce5c00;font-weight:700>==</span>0.0.21 --no-dependencies
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 此外，有 3 个 Python 包需要使用 sudo 全局安装！</span>
</span></span><span style=display:flex><span>sudo python3 -m pip install xgboost lightgbm scikit-learn
</span></span></code></pre></div><hr><h2 id=启用-postgresml>启用 PostgresML</h2><p>在所有集群节点上安装 <code>pgml</code> 扩展和 Python 依赖后，就可以在 PostgreSQL 集群上启用 <code>pgml</code> 了。</p><p>使用 <code>patronictl</code> 命令 <a href=https://pigsty.io/docs/pgsql/admin/#config-cluster>配置集群</a>，将 <code>pgml</code> 添加到 <code>shared_preload_libraries</code>，并在 <code>pgml.venv</code> 中指定您的虚拟环境目录：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>shared_preload_libraries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgml, timescaledb, pg_stat_statements, auto_explain</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgml.venv</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data/pgml&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后重启数据库集群，并使用 SQL 命令创建扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>vector</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- 建议同时安装 pgvector！
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>pgml</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>-- 在当前数据库中创建 PostgresML
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>pgml</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>-- 打印 PostgresML 版本信息
</span></span></span></code></pre></div><p>如果一切正常，您应该会看到类似以下输出：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create extension pgml;</span>
</span></span><span style=display:flex><span>INFO:  Python version: 3.11.2 <span style=color:#ce5c00;font-weight:700>(</span>main, Oct  <span style=color:#0000cf;font-weight:700>5</span> 2023, 16:06:03<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>[</span>GCC 8.5.0 <span style=color:#0000cf;font-weight:700>20210514</span> <span style=color:#ce5c00;font-weight:700>(</span>Red Hat 8.5.0-18<span style=color:#ce5c00;font-weight:700>)]</span>
</span></span><span style=display:flex><span>INFO:  Scikit-learn 1.3.0, XGBoost 2.0.0, LightGBM 4.1.0, NumPy 1.26.1
</span></span><span style=display:flex><span>CREATE EXTENSION
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># SELECT pgml.version(); -- 打印 PostgresML 版本信息</span>
</span></span><span style=display:flex><span> version
</span></span><span style=display:flex><span>---------
</span></span><span style=display:flex><span> 2.7.8
</span></span></code></pre></div><p>大功告成！更多详情请参阅 PostgresML 官方文档：https://postgresml.org/docs/guides/use-cases/</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8b89390bfb5e407f5413ce18cede184b>10 - OpenHalo</h1><div class=lead>MySQL 兼容的 Postgres 14 分支</div><p><a href=https://www.openhalo.org/>OpenHalo</a> 是一个开源的 PostgreSQL 内核，提供 MySQL 线协议兼容性。</p><p>OpenHalo 基于 PostgreSQL 14.10 内核版本，提供与 MySQL 5.7.32-log / 8.0 版本的线协议兼容性。</p><p>Pigsty 在所有支持的 Linux 平台上为 OpenHalo 提供部署支持。</p><hr><h2 id=快速开始>快速开始</h2><p>使用 Pigsty 的 <a href=/docs/setup/install><strong>标准安装流程</strong></a> 和 <a href=https://github.com/pgsty/pigsty/blob/main/conf/mysql.yml><code>mysql</code></a> 配置模板。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>./configure -c mysql    <span style=color:#8f5902;font-style:italic># 使用 MySQL（openHalo）配置模板</span>
</span></span><span style=display:flex><span>./deploy.yml            <span style=color:#8f5902;font-style:italic># 安装，生产部署请先在 pigsty.yml 中修改密码</span>
</span></span></code></pre></div><p>对于生产部署，请确保在运行安装剧本之前修改 <code>pigsty.yml</code> 配置文件中的密码参数。</p><hr><h2 id=配置>配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: postgres, extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>aux_mysql]}</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># mysql 兼容数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pigsty]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行全量备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># OpenHalo 临时设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mysql                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># HaloDB 的 MySQL 兼容模式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 当前 HaloDB 兼容 PG 主版本 14</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>openhalodb, pgsql-common ] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 安装 openhalodb 而不是 postgresql 内核</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=使用>使用</h2><p>访问 MySQL 时，实际连接使用的是 <code>postgres</code> 数据库。请注意，MySQL 中的"数据库"概念实际上对应于 PostgreSQL 中的"Schema"。因此，<code>use mysql</code> 实际上使用的是 <code>postgres</code> 数据库内的 <code>mysql</code> Schema。</p><p>用于 MySQL 的用户名和密码与 PostgreSQL 中的相同。您可以使用标准的 PostgreSQL 方法管理用户和权限。</p><h3 id=客户端访问>客户端访问</h3><p>OpenHalo 提供 MySQL 线协议兼容性，默认监听端口 3306，允许 MySQL 客户端和驱动程序直接连接。</p><p>Pigsty 的 <a href=https://github.com/pgsty/pigsty/blob/main/conf/mysql.yml><code>conf/mysql</code></a> 配置默认安装 <code>mysql</code> 客户端工具。</p><p>您可以使用以下命令访问 MySQL：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mysql -h 127.0.0.1 -u dbuser_dba
</span></span></code></pre></div><p>目前，OpenHalo 官方确保 Navicat 可以正常访问此 MySQL 端口，但 Intellij IDEA 的 DataGrip 访问会导致错误。</p><hr><h2 id=修改说明>修改说明</h2><p>Pigsty 安装的 <a href=https://github.com/pgsty/openHalo>OpenHalo</a> 内核基于 <a href=https://github.com/HaloTech-Co-Ltd/openHalo>HaloTech-Co-Ltd/openHalo</a> 内核进行了少量修改：</p><ul><li>将默认数据库名称从 <code>halo0root</code> 改回 <code>postgres</code></li><li>从默认版本号中删除 <code>1.0.</code> 前缀，恢复为 <code>14.10</code></li><li>修改默认配置文件以启用 MySQL 兼容性并默认监听端口 <code>3306</code></li></ul><p>请注意，Pigsty 不为使用 OpenHalo 内核提供任何保证。使用此内核时遇到的任何问题或需求应与原始供应商联系。</p><blockquote><p><strong>警告</strong>：目前处于实验阶段 - 在生产使用前请彻底评估。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-227e1bd7e26827efbe4f8ed91ee4c679>11 - Greenplum</h1><div class=lead>使用 Pigsty 部署/监控 Greenplum 集群，构建大规模并行处理（MPP）的 PostgreSQL 数据仓库集群！</div><p>Pigsty 支持部署 Greenplum 集群，及其衍生发行版 YMatrixDB，并提供了将现有 Greenplum 部署纳入 Pigsty 监控的能力。</p><hr><h2 id=概览>概览</h2><p>Greenplum / YMatrix 集群部署能力仅在专业版本/企业版本中提供，目前不对外开源。</p><hr><h2 id=安装>安装</h2><p>Pigsty 提供了 Greenplum 6 (@el7) 与 Greenplum 7 (@el8) 的安装包，开源版本用户可以自行安装配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 7 Only (Greenplum6)</span>
</span></span><span style=display:flex><span>./node.yml -t node_install  -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;pgsql&#34;,&#34;node_packages&#34;:[&#34;open-source-greenplum-db-6&#34;]}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 8 Only (Greenplum7)</span>
</span></span><span style=display:flex><span>./node.yml -t node_install  -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;pgsql&#34;,&#34;node_packages&#34;:[&#34;open-source-greenplum-db-7&#34;]}&#39;</span>
</span></span></code></pre></div><hr><h2 id=配置>配置</h2><p>要定义 Greenplum 集群，需要用到 <code>pg_mode</code> = <code>gpsql</code>，并使用额外的身份参数 <code>pg_shard</code> 与 <code>gp_role</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#================================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                        GPSQL Clusters                          #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#================================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cluster: mx-mdw (gp master)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mx-mdw</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-mdw-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>gp_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>master         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># this cluster is used as greenplum master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgsql sharding name &amp; gpsql deployment name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-mdw      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># this master cluster name is mx-mdw</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: matrixmgr , extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>matrixdbts } ] }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta , password: DBUser.Meta , pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor , password: DBUser.Monitor , roles: [ dbrole_readonly ], superuser</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># enable pgbouncer for greenplum master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># enable pgbouncer_exporter for greenplum master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_exporter_params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;host=127.0.0.1&amp;sslmode=disable&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># use 127.0.0.1 as local monitor host</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cluster: mx-sdw (gp master)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mx-sdw</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-sdw-1       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># greenplum segment node</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># greenplum segment instances</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6000</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg1, pg_seq: 1, pg_role: primary , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9633</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6001</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg2, pg_seq: 2, pg_role: replica , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9634</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-sdw-2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6000</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg2, pg_seq: 1, pg_role: primary , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9633</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6001</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg3, pg_seq: 2, pg_role: replica , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9634</span><span style=color:#f8f8f8>  </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-sdw-3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_instances</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6000</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg3, pg_seq: 1, pg_role: primary , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9633</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>6001</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: mx-seg1, pg_seq: 2, pg_role: replica , pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9634</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>gp_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>segment              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># these are nodes for gp segments</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_shard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgsql sharding name &amp; gpsql deployment name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mx-sdw            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># these segment clusters name is mx-sdw</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_preflight_skip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># skip preflight check (since pg_seq &amp; pg_role &amp; pg_cluster not exists)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_exporter_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_exporter_basic.yml                            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use basic config to avoid segment server crash</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_exporter_params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;options=-c%20gp_role%3Dutility&amp;sslmode=disable&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># use gp_role = utility to connect to segments</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>此外，PG Exporter 需要额外的连接参数，才能连接到 Greenplum Segment 实例上采集监控指标。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-311f723c83095a738bfb441159db0044>12 - OrioleDB</h1><div class=lead>PostgreSQL 的下一代 OLTP 引擎</div><p><a href=https://orioledb.com/>OrioleDB</a> 是一个 PostgreSQL 存储引擎扩展，声称能够提供 4 倍 OLTP 性能，没有 xid 环绕和表膨胀问题，并具有"云原生"（数据存储在 S3）能力。</p><p>OrioleDB 的最新版本基于 <a href=https://github.com/orioledb/postgres>补丁版 PostgreSQL 17.0</a> 和一个额外的 <a href=https://github.com/orioledb/orioledb>扩展</a></p><p>您可以使用 Pigsty 将 OrioleDB 作为 RDS 运行，它与 PG 17 兼容，在所有支持的 Linux 平台上都可用。
最新版本为 beta12，基于 PG 17_11 补丁。</p><hr><h2 id=快速开始>快速开始</h2><p>按照 Pigsty <a href=/docs/setup/install><strong>标准安装</strong></a> 流程，使用 <a href=https://github.com/pgsty/pigsty/blob/main/conf/oriole.yml><code>oriole</code></a> 配置模板。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>./configure -c oriole    <span style=color:#8f5902;font-style:italic># 使用 OrioleDB 配置模板</span>
</span></span><span style=display:flex><span>./deploy.yml             <span style=color:#8f5902;font-style:italic># 使用 OrioleDB 安装 Pigsty</span>
</span></span></code></pre></div><p>对于生产部署，请确保在运行 <code>install</code> 剧本之前修改 <code>pigsty.yml</code> 配置中的密码参数。</p><hr><h2 id=配置>配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty], extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>orioledb]}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行全量备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># OrioleDB 临时设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oriole                                        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># oriole 兼容模式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>orioledb, pgsql-common ]                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 安装 OrioleDB 内核</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;orioledb, pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 加载 OrioleDB 扩展</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=使用>使用</h2><p>要使用 OrioleDB，您需要安装 <code>orioledb_17</code> 和 <code>oriolepg_17</code> 包（目前仅提供 RPM 版本）。</p><p>使用 <code>pgbench</code> 初始化类似 TPC-B 的表，包含 100 个仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pgbench -is <span style=color:#0000cf;font-weight:700>100</span> meta
</span></span><span style=display:flex><span>pgbench -nv -P1 -c10 -S -T1000 meta
</span></span><span style=display:flex><span>pgbench -nv -P1 -c50 -S -T1000 meta
</span></span><span style=display:flex><span>pgbench -nv -P1 -c10    -T1000 meta
</span></span><span style=display:flex><span>pgbench -nv -P1 -c50    -T1000 meta
</span></span></code></pre></div><p>接下来，您可以使用 <code>orioledb</code> 存储引擎重建这些表并观察性能差异：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 创建 OrioleDB 表
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts_o</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>LIKE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INCLUDING</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8> </span><span style=color:#000>orioledb</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches_o</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>LIKE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INCLUDING</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8> </span><span style=color:#000>orioledb</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history_o</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>LIKE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INCLUDING</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8> </span><span style=color:#000>orioledb</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers_o</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>LIKE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INCLUDING</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ALL</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8> </span><span style=color:#000>orioledb</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 从常规表复制数据到 OrioleDB 表
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>INSERT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INTO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>INSERT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INTO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>INSERT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INTO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8>  </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>INSERT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>INTO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- 删除原始表并重命名 OrioleDB 表
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>RENAME</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_accounts</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>RENAME</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_branches</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>RENAME</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_history</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers_o</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>RENAME</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TO</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbench_tellers</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=关键特性>关键特性</h2><ul><li><strong>无 XID 回绕</strong>：消除事务 ID 回绕维护</li><li><strong>无表膨胀</strong>：高级存储管理防止表膨胀</li><li><strong>云存储</strong>：对 S3 兼容对象存储的原生支持</li><li><strong>OLTP 优化</strong>：专为事务工作负载设计</li><li><strong>改进性能</strong>：更好的空间利用率和查询性能</li></ul><blockquote><p><strong>注意</strong>：目前处于 Beta 阶段 - 在生产使用前请彻底评估。</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-a970dfd99688547f0ffb0bf4d5c4de61>13 - Cloudberry</h1><div class=lead>使用 Pigsty 部署/监控 Cloudberry 集群，一个由 Greenplum 分叉而来的 MPP 数据仓库集群！</div><hr><h2 id=安装>安装</h2><p>Pigsty 提供了 Greenplum 6 (@el7) 与 Greenplum 7 (@el8) 的安装包，开源版本用户可以自行安装配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 7 Only (Greenplum6)</span>
</span></span><span style=display:flex><span>./node.yml -t node_install  -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;pgsql&#34;,&#34;node_packages&#34;:[&#34;cloudberrydb&#34;]}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># EL 8 Only (Greenplum7)</span>
</span></span><span style=display:flex><span>./node.yml -t node_install  -e <span style=color:#4e9a06>&#39;{&#34;node_repo_modules&#34;:&#34;pgsql&#34;,&#34;node_packages&#34;:[&#34;cloudberrydb&#34;]}&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2342a2eaca8515e616cb1dfa8c4db39d>14 - Neon</h1><div class=lead>使用 Neon 开源的 Serverless 版本 PostgreSQL 内核，自建灵活伸缩，Scale To Zero，灵活分叉的PG服务。</div><p><a href=https://github.com/neondatabase/neon><strong>Neon</strong></a> 采用了存储与计算分离架构，提供了丝滑的自动扩缩容，Scale to Zero，以及数据库版本分叉等独家能力。</p><p>Neon 官网：https://neon.tech/</p><p>Neon 编译后的二进制产物过于庞大，目前不对开源版用户提供，目前处于试点阶段，有需求请联系 Pigsty 销售。</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>