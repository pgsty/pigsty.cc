<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/pgsql/param/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/pgsql/param/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>参数列表 | PIGSTY</title><meta name=description content="PGSQL 模块提供的 PostgreSQL 相关配置参数详解"><meta property="og:url" content="https://pigsty.cc/docs/pgsql/param/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="参数列表"><meta property="og:description" content="PGSQL 模块提供的 PostgreSQL 相关配置参数详解"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="参数列表"><meta itemprop=description content="PGSQL 模块提供的 PostgreSQL 相关配置参数详解"><meta itemprop=dateModified content="2026-02-14T08:23:51+08:00"><meta itemprop=wordCount content="7903"><meta itemprop=keywords content="参考"><meta name=twitter:card content="summary"><meta name=twitter:title content="参数列表"><meta name=twitter:description content="PGSQL 模块提供的 PostgreSQL 相关配置参数详解"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/pgsql/param/>返回本页常规视图</a>.</p></div><h1 class=title>参数列表</h1><div class=lead>PGSQL 模块提供的 PostgreSQL 相关配置参数详解</div><ul></ul><div class=content><p><a href=/docs/pgsql><code>PGSQL</code></a> 模块需要在 Pigsty 管理的节点上安装（即节点已经配置了 <a href=/docs/node><code>NODE</code></a> 模块），同时还要求您的部署中有一套可用的 <a href=/docs/etcd><code>ETCD</code></a> 集群来存储集群元数据。</p><p>在单个节点上安装 <code>PGSQL</code> 模块将创建一个独立的 PGSQL 服务器/实例，即 <a href=/docs/pgsql/config/cluster#%E8%AF%BB%E5%86%99%E4%B8%BB%E5%BA%93>主实例</a>。
在额外节点上安装将创建 <a href=/docs/pgsql/config/cluster#%E5%8F%AA%E8%AF%BB%E4%BB%8E%E5%BA%93>只读副本</a>，可以作为备用实例，并用于承载分担只读请求。
您还可以创建用于 ETL/OLAP/交互式查询的 <a href=/docs/pgsql/config/cluster#%E7%A6%BB%E7%BA%BF%E4%BB%8E%E5%BA%93>离线</a> 实例， 使用 <a href=/docs/pgsql/config/cluster#%E5%90%8C%E6%AD%A5%E5%A4%87%E5%BA%93>同步备库</a> 和 <a href=/docs/pgsql/config/cluster#%E6%B3%95%E5%AE%9A%E4%BA%BA%E6%95%B0%E6%8F%90%E4%BA%A4>法定人数提交</a> 来提高数据一致性，
甚至搭建 <a href=/docs/pgsql/config/cluster#%E5%A4%87%E4%BB%BD%E9%9B%86%E7%BE%A4>备份集群</a> 和 <a href=/docs/pgsql/config/cluster#%E5%BB%B6%E8%BF%9F%E9%9B%86%E7%BE%A4>延迟集群</a> 以快速应对人为失误与软件缺陷导致的数据损失。</p><p>您可以定义多个 PGSQL 集群并进一步组建一个水平分片集群： Pigsty 支持原生的 <a href=/docs/pgsql/config/cluster#citus%E9%9B%86%E7%BE%A4>citus 集群组</a>，可以将您的标准 PGSQL 集群原地升级为一个分布式的数据库集群。</p><blockquote><p>Pigsty v4.1 默认使用 PostgreSQL 18，并提供 <code>pg_io_method</code>、<code>pgbackrest_exporter</code>、<code>pgbouncer_exporter</code> 等相关参数。</p></blockquote><hr><table class=full-width><thead><tr><th style=text-align:left>参数组</th><th style=text-align:left>功能说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_id><code>PG_ID</code></a></td><td style=text-align:left>PostgreSQL 集群与实例的身份标识参数</td></tr><tr><td style=text-align:left><a href=#pg_business><code>PG_BUSINESS</code></a></td><td style=text-align:left>业务用户、数据库、服务与访问控制规则定义</td></tr><tr><td style=text-align:left><a href=#pg_install><code>PG_INSTALL</code></a></td><td style=text-align:left>PostgreSQL 安装相关：版本、路径、软件包</td></tr><tr><td style=text-align:left><a href=#pg_bootstrap><code>PG_BOOTSTRAP</code></a></td><td style=text-align:left>PostgreSQL 集群初始化引导：Patroni 高可用</td></tr><tr><td style=text-align:left><a href=#pg_provision><code>PG_PROVISION</code></a></td><td style=text-align:left>PostgreSQL 集群模板置备：角色、权限、扩展</td></tr><tr><td style=text-align:left><a href=#pg_backup><code>PG_BACKUP</code></a></td><td style=text-align:left>pgBackRest 备份与恢复配置</td></tr><tr><td style=text-align:left><a href=#pg_access><code>PG_ACCESS</code></a></td><td style=text-align:left>服务暴露、连接池、VIP、DNS 等客户端访问配置</td></tr><tr><td style=text-align:left><a href=#pg_monitor><code>PG_MONITOR</code></a></td><td style=text-align:left>PostgreSQL 监控 Exporter 配置</td></tr><tr><td style=text-align:left><a href=#pg_remove><code>PG_REMOVE</code></a></td><td style=text-align:left>PostgreSQL 实例清理与卸载配置</td></tr></tbody></table><hr><h2 id=参数概览>参数概览</h2><hr><p><a href=#pg_id><code>PG_ID</code></a> 参数组用于定义 PostgreSQL 集群与实例的身份标识，包括集群名称、实例序号、角色、分片等核心身份参数。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_mode><code>pg_mode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsql 集群模式: pgsql,citus,mssql,mysql,polar,ivory,oracle,gpsql</td></tr><tr><td style=text-align:left><a href=#pg_cluster><code>pg_cluster</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsql 集群名称, 必选身份参数</td></tr><tr><td style=text-align:left><a href=#pg_seq><code>pg_seq</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>pgsql 实例号, 必选身份参数</td></tr><tr><td style=text-align:left><a href=#pg_role><code>pg_role</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>pgsql 实例角色, 必选身份参数, 可为 primary，replica，offline</td></tr><tr><td style=text-align:left><a href=#pg_instances><code>pg_instances</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>在一个节点上定义多个 pg 实例，使用 <code>{port:ins_vars}</code> 格式</td></tr><tr><td style=text-align:left><a href=#pg_upstream><code>pg_upstream</code></a></td><td style=text-align:center><code>ip</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>级联从库或备份集群或的复制上游节点IP地址</td></tr><tr><td style=text-align:left><a href=#pg_shard><code>pg_shard</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsql 分片名，对 citus 与 gpsql 等水平分片集群为必选身份参数</td></tr><tr><td style=text-align:left><a href=#pg_group><code>pg_group</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsql 分片号，正整数，对 citus 与 gpsql 等水平分片集群为必选身份参数</td></tr><tr><td style=text-align:left><a href=#gp_role><code>gp_role</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>这个集群的 greenplum 角色，可以是 master 或 segment</td></tr><tr><td style=text-align:left><a href=#pg_exporters><code>pg_exporters</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在该节点上设置额外的 pg_exporters 用于监控远程 postgres 实例</td></tr><tr><td style=text-align:left><a href=#pg_offline_query><code>pg_offline_query</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>设置为 true 将此只读实例标记为特殊的离线从库，承载 Offline 服务，允许离线查询</td></tr></tbody></table><hr><p><a href=#pg_business><code>PG_BUSINESS</code></a> 参数组用于定义业务用户、数据库、服务与访问控制规则，以及默认的系统用户凭据。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_users><code>pg_users</code></a></td><td style=text-align:center><code>user[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 业务用户</td></tr><tr><td style=text-align:left><a href=#pg_databases><code>pg_databases</code></a></td><td style=text-align:center><code>database[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 业务数据库</td></tr><tr><td style=text-align:left><a href=#pg_services><code>pg_services</code></a></td><td style=text-align:center><code>service[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 业务服务</td></tr><tr><td style=text-align:left><a href=#pg_hba_rules><code>pg_hba_rules</code></a></td><td style=text-align:center><code>hba[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 的业务 hba 规则</td></tr><tr><td style=text-align:left><a href=#pgb_hba_rules><code>pgb_hba_rules</code></a></td><td style=text-align:center><code>hba[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer 的业务 hba 规则</td></tr><tr><td style=text-align:left><a href=#pg_crontab><code>pg_crontab</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres dbsu 的定时任务</td></tr><tr><td style=text-align:left><a href=#pg_replication_username><code>pg_replication_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 复制用户名，默认为 <code>replicator</code></td></tr><tr><td style=text-align:left><a href=#pg_replication_password><code>pg_replication_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 复制密码，默认为 <code>DBUser.Replicator</code></td></tr><tr><td style=text-align:left><a href=#pg_admin_username><code>pg_admin_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 管理员用户名，默认为 <code>dbuser_dba</code></td></tr><tr><td style=text-align:left><a href=#pg_admin_password><code>pg_admin_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 管理员明文密码，默认为 <code>DBUser.DBA</code></td></tr><tr><td style=text-align:left><a href=#pg_monitor_username><code>pg_monitor_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 监控用户名，默认为 <code>dbuser_monitor</code></td></tr><tr><td style=text-align:left><a href=#pg_monitor_password><code>pg_monitor_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>postgres 监控密码，默认为 <code>DBUser.Monitor</code></td></tr><tr><td style=text-align:left><a href=#pg_dbsu_password><code>pg_dbsu_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>dbsu 密码，默认为空字符串意味着不设置 dbsu 密码，最好不要设置。</td></tr></tbody></table><hr><p><a href=#pg_install><code>PG_INSTALL</code></a> 参数组用于配置 PostgreSQL 安装相关选项，包括版本、路径、软件包与扩展插件。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_dbsu><code>pg_dbsu</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>操作系统 dbsu 名称，默认为 postgres，最好不要更改</td></tr><tr><td style=text-align:left><a href=#pg_dbsu_uid><code>pg_dbsu_uid</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>操作系统 dbsu uid 和 gid，对于默认的 postgres 用户和组为 26</td></tr><tr><td style=text-align:left><a href=#pg_dbsu_sudo><code>pg_dbsu_sudo</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>dbsu sudo 权限, none,limit,all,nopass，默认为 limit</td></tr><tr><td style=text-align:left><a href=#pg_dbsu_home><code>pg_dbsu_home</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgresql 主目录，默认为 <code>/var/lib/pgsql</code></td></tr><tr><td style=text-align:left><a href=#pg_dbsu_ssh_exchange><code>pg_dbsu_ssh_exchange</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 pgsql 集群之间交换 postgres dbsu ssh 密钥</td></tr><tr><td style=text-align:left><a href=#pg_version><code>pg_version</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>要安装的 postgres 主版本，默认为 18</td></tr><tr><td style=text-align:left><a href=#pg_bin_dir><code>pg_bin_dir</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 二进制目录，默认为 <code>/usr/pgsql/bin</code></td></tr><tr><td style=text-align:left><a href=#pg_log_dir><code>pg_log_dir</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 日志目录，默认为 <code>/pg/log/postgres</code></td></tr><tr><td style=text-align:left><a href=#pg_packages><code>pg_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>要安装的 pg 包，<code>${pg_version}</code> 将被替换为实际主版本号</td></tr><tr><td style=text-align:left><a href=#pg_extensions><code>pg_extensions</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>要安装的 pg 扩展，<code>${pg_version}</code> 将被替换为实际主版本号</td></tr></tbody></table><hr><p><a href=#pg_bootstrap><code>PG_BOOTSTRAP</code></a> 参数组用于配置 PostgreSQL 集群初始化引导，包括 Patroni 高可用、数据目录、存储、连接、编码等核心设置。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_data><code>pg_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 数据目录，默认为 <code>/pg/data</code></td></tr><tr><td style=text-align:left><a href=#pg_fs_main><code>pg_fs_main</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 主数据的挂载点/路径，默认为 <code>/data/postgres</code></td></tr><tr><td style=text-align:left><a href=#pg_fs_backup><code>pg_fs_backup</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg 备份数据的挂载点/路径，默认为 <code>/data/backups</code></td></tr><tr><td style=text-align:left><a href=#pg_storage_type><code>pg_storage_type</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg 主数据的存储类型，SSD、HDD，默认为 SSD，影响自动优化的参数。</td></tr><tr><td style=text-align:left><a href=#pg_dummy_filesize><code>pg_dummy_filesize</code></a></td><td style=text-align:center><code>size</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>/pg/dummy</code> 的大小，默认保留 64MB 磁盘空间用于紧急抢修</td></tr><tr><td style=text-align:left><a href=#pg_listen><code>pg_listen</code></a></td><td style=text-align:center><code>ip(s)</code></td><td style=text-align:center><code>C/I</code></td><td style=text-align:left>postgres/pgbouncer 的监听地址，用逗号分隔的IP列表，默认为 <code>0.0.0.0</code></td></tr><tr><td style=text-align:left><a href=#pg_port><code>pg_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 监听端口，默认为 5432</td></tr><tr><td style=text-align:left><a href=#pg_localhost><code>pg_localhost</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 的 Unix 套接字目录，用于本地连接</td></tr><tr><td style=text-align:left><a href=#pg_namespace><code>pg_namespace</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 etcd 中的顶级键命名空间，被 patroni & vip 用于高可用管理</td></tr><tr><td style=text-align:left><a href=#patroni_enabled><code>patroni_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>如果禁用，初始化期间不会创建 postgres 集群</td></tr><tr><td style=text-align:left><a href=#patroni_mode><code>patroni_mode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni 工作模式：default,pause,remove</td></tr><tr><td style=text-align:left><a href=#patroni_port><code>patroni_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni 监听端口，默认为 8008</td></tr><tr><td style=text-align:left><a href=#patroni_log_dir><code>patroni_log_dir</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni 日志目录，默认为 <code>/pg/log/patroni</code></td></tr><tr><td style=text-align:left><a href=#patroni_ssl_enabled><code>patroni_ssl_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>使用 SSL 保护 patroni RestAPI 通信？</td></tr><tr><td style=text-align:left><a href=#patroni_watchdog_mode><code>patroni_watchdog_mode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni 看门狗模式：automatic,required,off，默认为 off</td></tr><tr><td style=text-align:left><a href=#patroni_username><code>patroni_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni restapi 用户名，默认为 <code>postgres</code></td></tr><tr><td style=text-align:left><a href=#patroni_password><code>patroni_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>patroni restapi 密码，默认为 <code>Patroni.API</code></td></tr><tr><td style=text-align:left><a href=#pg_primary_db><code>pg_primary_db</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>指定集群中首要使用的数据库名，Citus等模式会用到，默认为 <code>postgres</code></td></tr><tr><td style=text-align:left><a href=#pg_parameters><code>pg_parameters</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>覆盖 postgresql.auto.conf 中的 PostgreSQL 参数</td></tr><tr><td style=text-align:left><a href=#pg_files><code>pg_files</code></a></td><td style=text-align:center><code>path[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>拷贝至PGDATA目录中的额外文件列表 (例如许可证文件)</td></tr><tr><td style=text-align:left><a href=#pg_conf><code>pg_conf</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>配置模板：oltp,olap,crit,tiny，默认为 <code>oltp.yml</code></td></tr><tr><td style=text-align:left><a href=#pg_max_conn><code>pg_max_conn</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 最大连接数，<code>auto</code> 将使用推荐值</td></tr><tr><td style=text-align:left><a href=#pg_shared_buffer_ratio><code>pg_shared_buffer_ratio</code></a></td><td style=text-align:center><code>float</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>postgres 共享缓冲区内存比率，默认为 0.25，范围 0.1~0.4</td></tr><tr><td style=text-align:left><a href=#pg_rto><code>pg_rto</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>RTO 模式：<code>fast</code>,<code>norm</code>,<code>safe</code>,<code>wide</code>，默认 <code>norm</code></td></tr><tr><td style=text-align:left><a href=#pg_rto_plan><code>pg_rto_plan</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>RTO 预设配置，定义 Patroni HA 与 HAProxy 健康检查的超时参数</td></tr><tr><td style=text-align:left><a href=#pg_rpo><code>pg_rpo</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>恢复点目标（字节），默认为 <code>1MiB</code></td></tr><tr><td style=text-align:left><a href=#pg_libs><code>pg_libs</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>预加载的库，默认为 <code>pg_stat_statements,auto_explain</code></td></tr><tr><td style=text-align:left><a href=#pg_delay><code>pg_delay</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>备份集群主库的WAL重放应用延迟，用于制备延迟从库</td></tr><tr><td style=text-align:left><a href=#pg_checksum><code>pg_checksum</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>为 postgres 集群启用数据校验和？</td></tr><tr><td style=text-align:left><a href=#pg_pwd_enc><code>pg_pwd_enc</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>密码加密算法：固定为 scram-sha-256</td></tr><tr><td style=text-align:left><a href=#pg_encoding><code>pg_encoding</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>数据库集群编码，默认为 <code>UTF8</code></td></tr><tr><td style=text-align:left><a href=#pg_locale><code>pg_locale</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>数据库集群本地化设置，默认为 <code>C</code></td></tr><tr><td style=text-align:left><a href=#pg_lc_collate><code>pg_lc_collate</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>数据库集群排序，默认为 <code>C</code></td></tr><tr><td style=text-align:left><a href=#pg_lc_ctype><code>pg_lc_ctype</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>数据库字符类型，默认为 <code>C</code></td></tr><tr><td style=text-align:left><a href=#pg_io_method><code>pg_io_method</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>PostgreSQL IO 方法：<code>auto</code>, <code>sync</code>, <code>worker</code>, <code>io_uring</code></td></tr><tr><td style=text-align:left><a href=#pg_etcd_password><code>pg_etcd_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>此 PostgreSQL 集群在 etcd 中使用的密码，默认使用集群名</td></tr><tr><td style=text-align:left><a href=#pgsodium_key><code>pgsodium_key</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsodium 加密主密钥，64 位十六进制数字，默认使用 sha256(pg_cluster)</td></tr><tr><td style=text-align:left><a href=#pgsodium_getkey_script><code>pgsodium_getkey_script</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsodium 获取密钥脚本路径，默认使用模板中的 pgsodium_getkey</td></tr></tbody></table><hr><p><a href=#pg_provision><code>PG_PROVISION</code></a> 参数组用于配置 PostgreSQL 集群模板置备，包括默认角色、权限、模式、扩展与 HBA 规则。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_provision><code>pg_provision</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在引导后置备 postgres 集群内部的业务对象？</td></tr><tr><td style=text-align:left><a href=#pg_init><code>pg_init</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>为集群模板提供初始化脚本，默认为 <code>pg-init</code></td></tr><tr><td style=text-align:left><a href=#pg_default_roles><code>pg_default_roles</code></a></td><td style=text-align:center><code>role[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>postgres 集群中的默认预定义角色和系统用户</td></tr><tr><td style=text-align:left><a href=#pg_default_privileges><code>pg_default_privileges</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>由管理员用户创建数据库内对象时的默认权限</td></tr><tr><td style=text-align:left><a href=#pg_default_schemas><code>pg_default_schemas</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>要创建的默认模式列表</td></tr><tr><td style=text-align:left><a href=#pg_default_extensions><code>pg_default_extensions</code></a></td><td style=text-align:center><code>extension[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>要创建的默认扩展列表</td></tr><tr><td style=text-align:left><a href=#pg_reload><code>pg_reload</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>A</code></td><td style=text-align:left>更改HBA后，是否立即重载 postgres 配置</td></tr><tr><td style=text-align:left><a href=#pg_default_hba_rules><code>pg_default_hba_rules</code></a></td><td style=text-align:center><code>hba[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>postgres 基于主机的认证规则，全局PG默认HBA</td></tr><tr><td style=text-align:left><a href=#pgb_default_hba_rules><code>pgb_default_hba_rules</code></a></td><td style=text-align:center><code>hba[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>pgbouncer 默认的基于主机的认证规则，全局PGB默认HBA</td></tr></tbody></table><hr><p><a href=#pg_backup><code>PG_BACKUP</code></a> 参数组用于配置 pgBackRest 备份与恢复，包括仓库类型、路径、保留策略等。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pgbackrest_enabled><code>pgbackrest_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 pgsql 主机上启用 pgbackrest？</td></tr><tr><td style=text-align:left><a href=#pgbackrest_log_dir><code>pgbackrest_log_dir</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbackrest 日志目录，默认为 <code>/pg/log/pgbackrest</code></td></tr><tr><td style=text-align:left><a href=#pgbackrest_method><code>pgbackrest_method</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbackrest 使用的仓库：local,minio,等&mldr;</td></tr><tr><td style=text-align:left><a href=#pgbackrest_init_backup><code>pgbackrest_init_backup</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbackrest 初始化完成后是否立即执行全量备份？默认为 <code>true</code></td></tr><tr><td style=text-align:left><a href=#pgbackrest_repo><code>pgbackrest_repo</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>pgbackrest 仓库定义</td></tr></tbody></table><hr><p><a href=#pg_access><code>PG_ACCESS</code></a> 参数组用于配置服务暴露、连接池、VIP、DNS 等客户端访问相关选项。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pgbouncer_enabled><code>pgbouncer_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>如果禁用，则不会配置 pgbouncer 连接池</td></tr><tr><td style=text-align:left><a href=#pgbouncer_port><code>pgbouncer_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer 监听端口，默认为 6432</td></tr><tr><td style=text-align:left><a href=#pgbouncer_log_dir><code>pgbouncer_log_dir</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer 日志目录，默认为 <code>/pg/log/pgbouncer</code></td></tr><tr><td style=text-align:left><a href=#pgbouncer_auth_query><code>pgbouncer_auth_query</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>使用 AuthQuery 来从 postgres 获取未列出的业务用户？</td></tr><tr><td style=text-align:left><a href=#pgbouncer_poolmode><code>pgbouncer_poolmode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>池化模式：transaction,session,statement，默认为 transaction</td></tr><tr><td style=text-align:left><a href=#pgbouncer_sslmode><code>pgbouncer_sslmode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer 客户端 SSL 模式，默认为禁用</td></tr><tr><td style=text-align:left><a href=#pgbouncer_ignore_param><code>pgbouncer_ignore_param</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer 忽略的启动参数列表</td></tr><tr><td style=text-align:left><a href=#pg_weight><code>pg_weight</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>在服务中的相对负载均衡权重，默认为 100，范围 0-255</td></tr><tr><td style=text-align:left><a href=#pg_service_provider><code>pg_service_provider</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>专用的 haproxy 节点组名称，或默认空字符，使用本地节点上的 haproxy</td></tr><tr><td style=text-align:left><a href=#pg_default_service_dest><code>pg_default_service_dest</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>如果 svc.dest=&lsquo;default&rsquo;，默认服务指向哪里？postgres 或 pgbouncer</td></tr><tr><td style=text-align:left><a href=#pg_default_services><code>pg_default_services</code></a></td><td style=text-align:center><code>service[]</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>postgres 默认服务定义列表，全局共用。</td></tr><tr><td style=text-align:left><a href=#pg_vip_enabled><code>pg_vip_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>是否为 pgsql 主节点启用 L2 VIP？默认不启用</td></tr><tr><td style=text-align:left><a href=#pg_vip_address><code>pg_vip_address</code></a></td><td style=text-align:center><code>cidr4</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>vip 地址的格式为 <code>&lt;ipv4>/&lt;mask></code>，启用 vip 时为必选参数</td></tr><tr><td style=text-align:left><a href=#pg_vip_interface><code>pg_vip_interface</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C/I</code></td><td style=text-align:left>监听的 vip 网络接口，默认为 eth0</td></tr><tr><td style=text-align:left><a href=#pg_dns_suffix><code>pg_dns_suffix</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgsql dns 后缀，默认为空</td></tr><tr><td style=text-align:left><a href=#pg_dns_target><code>pg_dns_target</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>PG DNS 解析到哪里？auto、primary、vip、none 或者特定的 IP 地址</td></tr></tbody></table><hr><p><a href=#pg_monitor><code>PG_MONITOR</code></a> 参数组用于配置 PostgreSQL 监控 Exporter，包括 pg_exporter、pgbouncer_exporter 和 pgbackrest_exporter。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_exporter_enabled><code>pg_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 pgsql 主机上启用 pg_exporter 吗？</td></tr><tr><td style=text-align:left><a href=#pg_exporter_config><code>pg_exporter_config</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter 配置文件/模板名称</td></tr><tr><td style=text-align:left><a href=#pg_exporter_cache_ttls><code>pg_exporter_cache_ttls</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter 收集器阶梯TTL配置，默认为 &lsquo;1,10,60,300&rsquo;</td></tr><tr><td style=text-align:left><a href=#pg_exporter_port><code>pg_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter 监听端口，默认为 9630</td></tr><tr><td style=text-align:left><a href=#pg_exporter_params><code>pg_exporter_params</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter dsn 中传入的额外 URL 参数</td></tr><tr><td style=text-align:left><a href=#pg_exporter_url><code>pg_exporter_url</code></a></td><td style=text-align:center><code>pgurl</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>如果指定，则覆盖自动生成的 postgres DSN 连接串</td></tr><tr><td style=text-align:left><a href=#pg_exporter_auto_discovery><code>pg_exporter_auto_discovery</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>监控是否启用自动数据库发现？默认启用</td></tr><tr><td style=text-align:left><a href=#pg_exporter_exclude_database><code>pg_exporter_exclude_database</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>启用自动发现时，排除在外的数据库名称列表，用逗号分隔</td></tr><tr><td style=text-align:left><a href=#pg_exporter_include_database><code>pg_exporter_include_database</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>启用自动发现时，只监控这个列表中的数据库，名称用逗号分隔</td></tr><tr><td style=text-align:left><a href=#pg_exporter_connect_timeout><code>pg_exporter_connect_timeout</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter 连接超时，单位毫秒，默认为 200</td></tr><tr><td style=text-align:left><a href=#pg_exporter_options><code>pg_exporter_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pg_exporter 的额外命令行参数选项</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter_enabled><code>pgbouncer_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 pgsql 主机上启用 pgbouncer_exporter 吗？</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter_port><code>pgbouncer_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer_exporter 监听端口，默认为 9631</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter_url><code>pgbouncer_exporter_url</code></a></td><td style=text-align:center><code>pgurl</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>如果指定，则覆盖自动生成的 pgbouncer dsn 连接串</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter_options><code>pgbouncer_exporter_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbouncer_exporter 的额外命令行参数选项</td></tr><tr><td style=text-align:left><a href=#pgbackrest_exporter_enabled><code>pgbackrest_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>在 pgsql 主机上启用 pgbackrest_exporter 吗？</td></tr><tr><td style=text-align:left><a href=#pgbackrest_exporter_port><code>pgbackrest_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbackrest_exporter 监听端口，默认为 9854</td></tr><tr><td style=text-align:left><a href=#pgbackrest_exporter_options><code>pgbackrest_exporter_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>pgbackrest_exporter 的额外命令行参数选项</td></tr></tbody></table><hr><p><a href=#pg_remove><code>PG_REMOVE</code></a> 参数组用于配置 PostgreSQL 实例清理与卸载行为，包括数据目录、备份、软件包的删除控制。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_rm_data><code>pg_rm_data</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>删除 pgsql 实例时是否清理 postgres 数据目录？</td></tr><tr><td style=text-align:left><a href=#pg_rm_backup><code>pg_rm_backup</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>删除主库时是否一并清理 pgbackrest 备份？</td></tr><tr><td style=text-align:left><a href=#pg_rm_pkg><code>pg_rm_pkg</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>删除 pgsql 实例时是否卸载相关软件包？</td></tr><tr><td style=text-align:left><a href=#pg_safeguard><code>pg_safeguard</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>防误删保险，阻止误执行 pgsql 清理操作？默认为 false</td></tr></tbody></table><hr><h2 id=pg_id><code>PG_ID</code></h2><p>以下是一些常用的参数，用于标识 PGSQL 模块中的 <a href=/docs/concept/model/pgsql>实体</a>：集群、实例、服务等&mldr;</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_cluster:           #CLUSTER  # pgsql 集群名称，必需的标识参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_seq: 0             #INSTANCE # pgsql 实例序列号，必需的标识参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_role: replica      #INSTANCE # pgsql 角色，必需的，可以是 primary,replica,offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_instances: {}      #INSTANCE # 在节点上定义多个 pg 实例，使用 `{port:ins_vars}` 格式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_upstream:          #INSTANCE # 备用集群或级联副本的 repl 上游 ip 地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_shard:             #CLUSTER  # pgsql 分片名称，分片集群的可选标识</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># pg_group: 0           #CLUSTER  # pgsql 分片索引号，分片集群的可选标识</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># gp_role: master       #CLUSTER  # 此集群的 greenplum 角色，可以是 master 或 segment</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_offline_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>#INSTANCE # 设置为 true 以在此实例上启用离线查询</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>您必须显式指定这些<strong>身份参数</strong>，它们没有默认值：</p><table class=full-width><thead><tr><th style=text-align:center>名称</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th>扩展说明</th></tr></thead><tbody><tr><td style=text-align:center><a href=#pg_cluster><code>pg_cluster</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><strong>C</strong></td><td><strong>PG 数据库集群名称</strong></td></tr><tr><td style=text-align:center><a href=#pg_seq><code>pg_seq</code></a></td><td style=text-align:center><code>number</code></td><td style=text-align:center><strong>I</strong></td><td><strong>PG 数据库实例 ID</strong></td></tr><tr><td style=text-align:center><a href=#pg_role><code>pg_role</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><strong>I</strong></td><td><strong>PG 数据库实例角色</strong></td></tr><tr><td style=text-align:center><a href=#pg_shard><code>pg_shard</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><strong>C</strong></td><td><strong>数据库分片名称</strong></td></tr><tr><td style=text-align:center><a href=#pg_group><code>pg_group</code></a></td><td style=text-align:center><code>number</code></td><td style=text-align:center><strong>C</strong></td><td><strong>数据库分片序号</strong></td></tr></tbody></table><ul><li><a href=#pg_cluster><code>pg_cluster</code></a>: 它标识集群的名称，该名称在集群级别配置。</li><li><a href=#pg_role><code>pg_role</code></a>: 在实例级别配置，标识 ins 的角色。只有 <code>primary</code> 角色会特别处理。如果不填写，默认为 <code>replica</code> 角色和特殊的 <code>delayed</code> 和 <code>offline</code> 角色。</li><li><a href=#pg_seq><code>pg_seq</code></a>: 用于在集群内标识 ins，通常是从 0 或 1 递增的整数，一旦分配就不会更改。</li><li><code>{{ pg_cluster }}-{{ pg_seq }}</code> 用于唯一标识 ins，即 <code>pg_instance</code>。</li><li><code>{{ pg_cluster }}-{{ pg_role }}</code> 用于标识集群内的服务，即 <code>pg_service</code>。</li><li><a href=#pg_shard><code>pg_shard</code></a> 和 <a href=#pg_group><code>pg_group</code></a> 用于水平分片集群，仅用于 citus、greenplum 和 matrixdb。</li></ul><p><a href=#pg_cluster><code>pg_cluster</code></a>、<a href=#pg_role><code>pg_role</code></a>、<a href=#pg_seq><code>pg_seq</code></a> 是核心<strong>标识参数</strong>，对于任何 Postgres 集群都是<strong>必选</strong>的，并且必须显式指定。以下是一个示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>所有其他参数都可以从全局配置或默认配置继承，但标识参数必须<strong>明确指定</strong>和<strong>手动分配</strong>。</p><h3 id=pg_mode><code>pg_mode</code></h3><p>参数名称： <code>pg_mode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>PostgreSQL 集群模式，默认值为 <code>pgsql</code>，即标准的 PostgreSQL 集群。</p><p>可用的模式选项包括：</p><ul><li><code>pgsql</code>：标准的 PostgreSQL 集群</li><li><code>citus</code>：Citus 分布式数据库集群</li><li><code>mssql</code>：Babelfish MSSQL 线缆协议兼容内核</li><li><code>mysql</code>：OpenHalo/HaloDB MySQL 线协议兼容内核</li><li><code>ivory</code>：IvorySQL Oracle 兼容内核</li><li><code>polar</code>：PolarDB for PostgreSQL 内核</li><li><code>oracle</code>：PolarDB for Oracle 内核</li><li><code>gpsql</code>：Greenplum 并行数据库集群（监控）</li></ul><p>如果 <code>pg_mode</code> 设置为 <code>citus</code> 或 <code>gpsql</code>，则需要两个额外的必选身份参数 <a href=#pg_shard><code>pg_shard</code></a> 和 <a href=#pg_group><code>pg_group</code></a> 来定义水平分片集群的身份。</p><p>在这两种情况下，每一个 PostgreSQL 集群都是一组更大的业务单元的一部分。</p><h3 id=pg_cluster><code>pg_cluster</code></h3><p>参数名称： <code>pg_cluster</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>PostgreSQL 集群名称，必选的身份标识参数，没有默认值</p><p>集群名将用作资源的命名空间。</p><p>集群命名需要遵循特定的命名模式：<code>[a-z][a-z0-9-]*</code>，即，只使用数字与小写字母，且不以数字开头，以符合标识上的不同约束的要求。</p><h3 id=pg_seq><code>pg_seq</code></h3><p>参数名称： <code>pg_seq</code>， 类型： <code>int</code>， 层次：<code>I</code></p><p>PostgreSQL 实例序列号，必选的身份标识参数，无默认值。</p><p>此实例的序号，在其<strong>集群</strong>内是唯一分配的，通常使用自然数，从0或1开始分配，通常不会回收重用。</p><h3 id=pg_role><code>pg_role</code></h3><p>参数名称： <code>pg_role</code>， 类型： <code>enum</code>， 层次：<code>I</code></p><p>PostgreSQL 实例角色，必选的身份标识参数，无默认值。取值可以是：<code>primary</code>, <code>replica</code>, <code>offline</code></p><p>PGSQL 实例的角色，可以是：<code>primary</code>、<code>replica</code>、<code>standby</code> 或 <code>offline</code>。</p><ul><li><code>primary</code>: 主实例，在集群中有且仅有一个。</li><li><code>replica</code>: 用于承载在线只读流量的副本，高负载下可能会有轻微复制延迟（10ms~100ms, 100KB）。</li><li><code>offline</code>: 用于处理离线只读流量的离线副本，如统计分析/ETL/个人查询等。</li></ul><h3 id=pg_instances><code>pg_instances</code></h3><p>参数名称： <code>pg_instances</code>， 类型： <code>dict</code>， 层次：<code>I</code></p><p>使用 <code>{port:ins_vars}</code> 的形式在一台主机上定义多个 PostgreSQL 实例。</p><p>此参数是为在单个节点上的多实例部署保留的参数，Pigsty 尚未实现此功能，并强烈建议独占节点部署。</p><h3 id=pg_upstream><code>pg_upstream</code></h3><p>参数名称： <code>pg_upstream</code>， 类型： <code>ip</code>， 层次：<code>I</code></p><p><a href=/docs/pgsql/config/cluster#%E5%A4%87%E4%BB%BD%E9%9B%86%E7%BE%A4>备份集群</a> 或级联从库的上游实例 IP 地址。</p><p>在集群的 <code>primary</code> 实例上设置 <code>pg_upstream</code> ，表示此集群是一个 <a href=/docs/pgsql/config/cluster#%E5%A4%87%E4%BB%BD%E9%9B%86%E7%BE%A4>备份集群</a>，该实例将作为 <code>standby leader</code>，从上游集群接收并应用更改。</p><p>对非 <code>primary</code> 实例设置 <code>pg_upstream</code> 参数将指定一个具体实例作为物理复制的上游，如果与主实例 ip 地址不同，此实例将成为 <strong>级联副本</strong> 。确保上游 IP 地址是同一集群中的另一个实例是用户的责任。</p><h3 id=pg_shard><code>pg_shard</code></h3><p>参数名称： <code>pg_shard</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>PostgreSQL 水平分片名称，对于分片集群来说（例如 citus 集群），这是的必选标识参数。</p><p>当多个标准的 PostgreSQL 集群一起以水平分片方式为同一业务提供服务时，Pigsty 将此组集群标记为 <strong>水平分片集群</strong>。</p><p><a href=#pg_shard><code>pg_shard</code></a> 是分片组名称。它通常是 <a href=#pg_cluster><code>pg_cluster</code></a> 的前缀。</p><p>例如，如果我们有一个分片组 <code>pg-citus</code>，并且其中有4个集群，它们的标识参数将是：</p><pre tabindex=0><code>cls pg_shard: pg-citus
cls pg_group = 0:   pg-citus0
cls pg_group = 1:   pg-citus1
cls pg_group = 2:   pg-citus2
cls pg_group = 3:   pg-citus3
</code></pre><h3 id=pg_group><code>pg_group</code></h3><p>参数名称： <code>pg_group</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>PostgreSQL 水平分片集群的分片索引号，对于分片集群来说（例如 citus 集群），这是的必选标识参数。</p><p>此参数与 <a href=#pg_shard>pg_shard</a> 配对使用，通常可以使用非负整数作为索引号。</p><h3 id=gp_role><code>gp_role</code></h3><p>参数名称： <code>gp_role</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>PostgreSQL 集群的 Greenplum/Matrixdb 角色，可以是 <code>master</code> 或 <code>segment</code>。</p><ul><li><code>master</code>: 标记 postgres 集群为 greenplum 主实例（协调节点），这是默认值。</li><li><code>segment</code> 标记 postgres 集群为 greenplum 段集群（数据节点）。</li></ul><p>此参数仅用于 Greenplum/MatrixDB 数据库 （<a href=#pg_mode><code>pg_mode</code></a> 为 <code>gpsql</code>），对于普通的 PostgreSQL 集群没有意义。</p><h3 id=pg_exporters><code>pg_exporters</code></h3><p>参数名称： <code>pg_exporters</code>， 类型： <code>dict</code>， 层次：<code>C</code></p><p>额外用于 <a href=/docs/pgsql/monitor>监控</a> 远程 PostgreSQL 实例的 Exporter 定义，默认值：<code>{}</code></p><p>如果您希望监控远程 PostgreSQL 实例，请在监控系统所在节点（Infra节点）集群上的 <code>pg_exporters</code> 参数中定义它们，并使用 <a href=/docs/pgsql/playbook#pgsql-monitoryml><code>pgsql-monitor.yml</code></a> 剧本来完成部署。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># list all remote instances here, alloc a unique unused local port as k</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>20001</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-foo, pg_seq: 1, pg_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>20004</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-foo, pg_seq: 2, pg_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.11</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>20002</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-bar, pg_seq: 1, pg_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.12</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>20003</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster: pg-bar, pg_seq: 1, pg_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.13</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_offline_query><code>pg_offline_query</code></h3><p>参数名称： <code>pg_offline_query</code>， 类型： <code>bool</code>， 层次：<code>I</code></p><p>设置为 <code>true</code> 以在此实例上启用离线查询，默认为 <code>false</code>。</p><p>当某个 PostgreSQL 实例启用此参数时， 属于 <code>dbrole_offline</code> 分组的用户可以直接连接到该 PostgreSQL 实例上执行离线查询（慢查询，交互式查询，ETL/分析类查询）。</p><p>带有此标记的实例在效果上类似于为实例设置 <code>pg_role</code> = <code>offline</code> ，唯一的区别在于 <code>offline</code> 实例默认不会承载 <code>replica</code> 服务的请求，是作为专用的离线/分析从库实例而存在的。</p><p>如果您没有富余的实例可以专门用于此目的，则可以挑选一台普通的从库，在实例层次启用此参数，以便在需要时承载离线查询。</p><hr><h2 id=pg_business><code>PG_BUSINESS</code></h2><p>定制集群模板：用户，数据库，服务，权限规则。</p><p>用户需<strong>重点关注</strong>此部分参数，因为这里是业务声明自己所需数据库对象的地方。</p><ul><li>业务用户定义： <a href=#pg_users><strong><code>pg_users</code></strong></a></li><li>业务数据库定义： <a href=#pg_databases><strong><code>pg_databases</code></strong></a></li><li>集群专有服务定义： <a href=#pg_services><strong><code>pg_services</code></strong></a> （全局定义：<a href=#pg_default_services><strong><code>pg_default_services</code></strong></a>）</li><li>PostgreSQL集群/实例特定的HBA规则： <a href=#pg_hba_rules><strong><code>pg_hba_rules</code></strong></a></li><li>Pgbouncer连接池特定HBA规则： <a href=#pgb_hba_rules><strong><code>pgb_hba_rules</code></strong></a></li><li>定时任务（crontab）定义： <a href=#pg_crontab><strong><code>pg_crontab</code></strong></a></li></ul><p><a href=/docs/concept/sec/ac/#%E9%BB%98%E8%AE%A4%E8%A7%92%E8%89%B2%E4%B8%8E%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7>默认</a> 的数据库用户及其凭据，强烈建议在生产环境中修改这些用户的密码。</p><ul><li>PG管理员用户：<a href=#pg_admin_username><code>pg_admin_username</code></a> / <a href=#pg_admin_password><code>pg_admin_password</code></a></li><li>PG复制用户： <a href=#pg_replication_username><code>pg_replication_username</code></a> / <a href=#pg_replication_password><code>pg_replication_password</code></a></li><li>PG监控用户：<a href=#pg_monitor_username><code>pg_monitor_username</code></a> / <a href=#pg_monitor_password><code>pg_monitor_password</code></a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres business object definition, overwrite in group vars</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># postgres business users</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># postgres business databases</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># postgres business services</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># business hba rules for postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgb_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># business hba rules for pgbouncer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># crontab entries for postgres dbsu</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># global credentials, overwrite in global vars</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># dbsu password, empty string means no dbsu password by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_dba</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_users><code>pg_users</code></h3><p>参数名称： <code>pg_users</code>， 类型： <code>user[]</code>， 层次：<code>C</code></p><p>PostgreSQL 业务用户列表，需要在 PG 集群层面进行定义。默认值为：<code>[]</code> 空列表。</p><p>每一个数组元素都是一个 <a href=/docs/pgsql/config/user><strong>用户/角色</strong></a> 定义，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_meta              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 必选，`name` 是用户定义的唯一必选字段</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>create                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，用户状态：create（创建，默认）、absent（删除）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Meta          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，密码，可以是 scram-sha-256 哈希字符串或明文</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>login</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 可选，默认为 true，是否可以登录</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>superuser</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 可选，默认为 false，是否是超级用户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createdb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 可选，默认为 false，是否可以创建数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>createrole</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 可选，默认为 false，是否可以创建角色</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>inherit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，默认为 true，是否自动继承所属角色权限</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>replication</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 可选，默认为 false，是否可以发起流复制连接</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bypassrls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 可选，默认为 false，是否可以绕过行级安全</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，用户连接数限制，默认 -1 不限制</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_in</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3650</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 可选，从创建时起 N 天后过期（优先级比 expire_at 高）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expire_at</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;2030-12-31&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 可选，过期日期，使用 YYYY-MM-DD 格式（优先级没 expire_in 高）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，用户备注信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，所属角色数组</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 可选，角色级配置参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>search_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 可选，是否加入连接池用户列表，默认 false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，用户级别的池化模式，默认 transaction</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 可选，用户级别的连接池最大连接数，默认 -1 不限制</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>用户级连接池限额字段统一使用 <code>pool_connlimit</code>（对应 Pgbouncer <code>max_user_connections</code>）。</p></blockquote><h3 id=pg_databases><code>pg_databases</code></h3><p>参数名称： <code>pg_databases</code>， 类型： <code>database[]</code>， 层次：<code>C</code></p><p>PostgreSQL 业务数据库列表，需要在 PG 集群层面进行定义。默认值为：<code>[]</code> 空列表。</p><p>每一个数组元素都是一个 <a href=/docs/pgsql/config/db><strong>业务数据库</strong></a> 定义，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 必选，`name` 是数据库定义的唯一必选字段</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>state</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>create                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，数据库状态：create（创建，默认）、absent（删除）、recreate（重建）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>baseline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>cmdb.sql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，数据库 sql 的基线定义文件路径（ansible 搜索路径中的相对路径，如 files/）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 可选，是否将此数据库添加到 pgbouncer 数据库列表？默认为 true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>pigsty]              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，要创建的附加模式，由模式名称字符串组成的数组</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 可选，要安装的附加扩展：扩展对象的数组</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgis , schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可以指定将扩展安装到某个模式中，也可以不指定（不指定则安装到 search_path 首位模式中）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>timescaledb }              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 例如有的扩展会创建并使用固定的模式，就不需要指定模式。</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty meta database  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，数据库的说明与备注信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，数据库所有者，不指定则为当前用户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>template1            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，要使用的模板，默认为 template1，目标必须是一个模板数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>FILE_COPY            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，克隆策略：FILE_COPY 或 WAL_LOG（PG15+），不指定使用 PG 默认</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，不指定则继承模板/集群配置（UTF8）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，不指定则继承模板/集群配置（C）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_collate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，不指定则继承模板/集群配置（C）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>lc_ctype</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，不指定则继承模板/集群配置（C）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>locale_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>libc          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，本地化提供者：libc、icu、builtin（PG15+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en-US              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，ICU 本地化规则（PG15+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>icu_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，ICU 排序规则（PG16+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>builtin_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C.UTF-8        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，内置本地化提供者规则（PG17+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tablespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_default         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，默认表空间，默认为 &#39;pg_default&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>is_template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 可选，是否标记为模板数据库，允许任何有 CREATEDB 权限的用户克隆</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>allowconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 可选，是否允许连接，默认为 true。显式设置 false 将完全禁止连接到此数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 可选，撤销公共连接权限。默认为 false，设置为 true 时，属主和管理员之外用户的 CONNECT 权限会被回收</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>register_datasource</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 可选，是否将此数据库注册到 grafana 数据源？默认为 true，显式设置为 false 会跳过注册</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，数据库连接限制，默认为 -1 ，不限制，设置为正整数则会限制连接数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 可选，数据库级参数，通过 ALTER DATABASE SET 设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>work_mem</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;64MB&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>statement_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;30s&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_auth_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_meta    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，连接到此 pgbouncer 数据库的所有连接都将使用此用户进行验证（启用 pgbouncer_auth_query 才有用）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，数据库级别的 pgbouncer 池化模式，默认为 transaction</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，数据库级别的 pgbouncer 默认池子大小，默认为 64</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_reserve</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 可选，数据库级别的 pgbouncer 池子保留空间，默认为 32，当默认池子不够用时，最多再申请这么多条突发连接</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_size_min</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 可选，数据库级别的 pgbouncer 池的最小大小，默认为 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pool_connlimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 可选，数据库级别的最大数据库连接数，默认为 100</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>自 Pigsty <code>v4.1.0</code> 起，数据库连接池参数统一使用 <code>pool_reserve</code> 与 <code>pool_connlimit</code>，旧别名 <code>pool_size_reserve</code> / <code>pool_max_db_conn</code> 已收敛。</p></blockquote><p>在每个数据库定义对象中，只有 <code>name</code> 是必选字段，其他的字段都是可选项。</p><h3 id=pg_services><code>pg_services</code></h3><p>参数名称： <code>pg_services</code>， 类型： <code>service[]</code>， 层次：<code>C</code></p><p>PostgreSQL 服务列表，需要在 PG 集群层面进行定义。默认值为：<code>[]</code> ，空列表。</p><p>用于在数据库集群层面定义额外的服务，数组中的每一个对象定义了一个 <a href=/docs/pgsql/service/#%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1><strong>服务</strong></a>，一个完整的服务定义样例如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>standby                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 必选，服务名称，最终的 svc 名称会使用 `pg_cluster` 作为前缀，例如：pg-meta-standby</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5435</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 必选，暴露的服务端口（作为 kubernetes 服务节点端口模式）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># 可选，服务绑定的 IP 地址，默认情况下为所有 IP 地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># 必选，服务成员选择器，使用 JMESPath 来筛选配置清单</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary`]&#34;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 可选，服务成员选择器（备份），也就是当默认选择器选中的实例都宕机后，服务才会由这里选中的实例成员来承载</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>dest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，目标端口，default|postgres|pgbouncer|&lt;port_number&gt;，默认为 &#39;default&#39;，Default的意思就是使用 pg_default_service_dest 的取值来最终决定</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>check</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/sync                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，健康检查 URL 路径，默认为 /，这里使用 Patroni API：/sync ，只有同步备库和主库才会返回 200 健康状态码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>maxconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 可选，允许的前端连接最大数，默认为5000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>roundrobin            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 可选，haproxy 负载均衡算法（默认为 roundrobin，其他选项：leastconn）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#options: &#39;inter 3s fastinter 1s downinter 5s rise 3 fall 3 on-marked-down shutdown-sessions slowstart 30s maxconn 3000 maxqueue 128 weight 100&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 注意：健康检查相关参数（inter, fastinter, downinter, rise, fall）现在由 pg_rto_plan 统一控制</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 默认 norm 模式参数：inter 2s fastinter 1s downinter 2s rise 3 fall 3</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>请注意，本参数用于在集群层面添加额外的服务。如果您想在全局定义所有 PostgreSQL 数据库都要提供的服务，可以使用 <a href=#pg_default_services><code>pg_default_services</code></a> 参数。</p><h3 id=pg_hba_rules><code>pg_hba_rules</code></h3><p>参数名称： <code>pg_hba_rules</code>， 类型： <code>hba[]</code>， 层次：<code>C</code></p><p>数据库集群/实例的客户端IP黑白名单规则。默认为：<code>[]</code> 空列表。</p><p>对象数组，每一个对象都代表一条规则， <a href=/docs/pgsql/config/hba#%E8%A7%84%E5%88%99%E5%AD%97%E6%AE%B5>hba</a> 规则对象的定义形式如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow intranet password access</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>host   all  all  10.0.0.0/8      md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>host   all  all  172.16.0.0/12   md5</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>host   all  all  192.168.0.0/16  md5</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li><code>title</code>： 规则的标题名称，会被渲染为 HBA 文件中的注释。</li><li><code>rules</code>：规则数组，每个元素是一条标准的 HBA 规则字符串。</li><li><code>role</code>：规则的应用范围，哪些实例角色会启用这条规则？<ul><li><code>common</code>：对于所有实例生效</li><li><code>primary</code>, <code>replica</code>,<code>offline</code>： 只针对特定的角色 <a href=#pg_role><code>pg_role</code></a> 实例生效。</li><li>特例：<code>role: 'offline'</code> 的规则除了会应用在 <code>pg_role : offline</code> 的实例上，对于带有 <a href=#pg_offline_query><code>pg_offline_query</code></a> 标记的实例也生效。</li></ul></li></ul><p>除了上面这种原生 HBA 规则定义形式，Pigsty 还提供了另外一种更为简便的别名形式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>addr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;intra&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># world|intra|infra|admin|local|localhost|cluster|&lt;cidr&gt;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>auth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pwd&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># trust|pwd|ssl|cert|deny|&lt;official auth method&gt;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># all|${dbsu}|${repl}|${admin}|${monitor}|&lt;user&gt;|&lt;group&gt;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># all|replication|....</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># raw hba string precedence over above all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>allow intranet password access</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><a href=#pg_default_hba_rules><code>pg_default_hba_rules</code></a> 与本参数基本类似，但它是用于定义全局的 HBA 规则，而本参数通常用于定制某个集群/实例的 HBA 规则。</p><h3 id=pgb_hba_rules><code>pgb_hba_rules</code></h3><p>参数名称： <code>pgb_hba_rules</code>， 类型： <code>hba[]</code>， 层次：<code>C</code></p><p>Pgbouncer 业务HBA规则，默认值为： <code>[]</code>， 空数组。</p><p>此参数与 <a href=#pg_hba_rules><code>pg_hba_rules</code></a> 基本类似，都是 <a href=/docs/pgsql/config/hba#%E8%A7%84%E5%88%99%E5%AD%97%E6%AE%B5>hba</a> 规则对象的数组，区别在于本参数是为 Pgbouncer 准备的。</p><p><a href=#pgb_default_hba_rules><code>pgb_default_hba_rules</code></a> 与本参数基本类似，但它是用于定义全局连接池 HBA 规则，而本参数通常用于定制某个连接池集群/实例的 HBA 规则。</p><h3 id=pg_crontab><code>pg_crontab</code></h3><p>参数名称： <code>pg_crontab</code>， 类型： <code>string[]</code>， 层次：<code>C</code></p><p>PostgreSQL 数据库超级用户（dbsu，默认 <code>postgres</code>）的定时任务列表，默认值为：<code>[]</code> 空数组。</p><p>每个数组元素是一行 crontab 条目，使用标准的用户 crontab 格式：<code>分 时 日 月 周 命令</code>（<strong>无需指定用户名</strong>）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#39;00 01 * * * /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点全量备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#39;00 13 * * * /pg/bin/pg-backup&#39;</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># 每天下午 1 点增量备份</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>此参数会将定时任务写入 postgres 用户的个人 crontab 文件：</p><ul><li>EL 系统：<code>/var/spool/cron/postgres</code></li><li>Debian 系统：<code>/var/spool/cron/crontabs/postgres</code></li></ul><blockquote><p><strong>注意</strong>：此参数用于取代在 <a href=/docs/node/param#node_crontab><code>node_crontab</code></a> 中配置 postgres 用户任务的旧做法。
因为 <code>node_crontab</code> 在 NODE 初始化阶段写入 <code>/etc/crontab</code>，此时 <code>postgres</code> 用户可能尚未创建，会导致 cron 报错。</p></blockquote><p>移除集群时，此 crontab 文件会被一并删除。</p><h3 id=pg_replication_username><code>pg_replication_username</code></h3><p>参数名称： <code>pg_replication_username</code>， 类型： <code>username</code>， 层次：<code>G</code></p><p>PostgreSQL 物理复制用户名，默认使用 <code>replicator</code>，不建议修改此参数。</p><h3 id=pg_replication_password><code>pg_replication_password</code></h3><p>参数名称： <code>pg_replication_password</code>， 类型： <code>password</code>， 层次：<code>G</code></p><p>PostgreSQL 物理复制用户密码，默认值为：<code>DBUser.Replicator</code>。</p><blockquote><p>警告：请在生产环境中修改此密码！</p></blockquote><h3 id=pg_admin_username><code>pg_admin_username</code></h3><p>参数名称： <code>pg_admin_username</code>， 类型： <code>username</code>， 层次：<code>G</code></p><p>PostgreSQL / Pgbouncer 管理员名称，默认为：<code>dbuser_dba</code>。</p><p>这是全局使用的数据库管理员，具有数据库的 Superuser 权限与连接池的流量管理权限，请务必控制使用范围。</p><h3 id=pg_admin_password><code>pg_admin_password</code></h3><p>参数名称： <code>pg_admin_password</code>， 类型： <code>password</code>， 层次：<code>G</code></p><p>PostgreSQL / Pgbouncer 管理员密码，默认为： <code>DBUser.DBA</code>。</p><blockquote><p>警告：请在生产环境中修改此密码！</p></blockquote><h3 id=pg_monitor_username><code>pg_monitor_username</code></h3><p>参数名称： <code>pg_monitor_username</code>， 类型： <code>username</code>， 层次：<code>G</code></p><p>PostgreSQL/Pgbouncer 监控用户名，默认为：<code>dbuser_monitor</code>。</p><p>这是一个用于监控的数据库/连接池用户，不建议修改此用户名。</p><p>但如果您的现有数据库使用了不同的监控用户，可以在指定监控目标时使用此参数传入使用的监控用户名。</p><h3 id=pg_monitor_password><code>pg_monitor_password</code></h3><p>参数名称： <code>pg_monitor_password</code>， 类型： <code>password</code>， 层次：<code>G</code></p><p>PostgreSQL/Pgbouncer 监控用户使用的密码，默认为：<code>DBUser.Monitor</code>。</p><p>请尽可能不要在密码中使用 <code>@:/</code> 这些容易与 URL 分隔符混淆的字符，减少不必要的麻烦。</p><blockquote><p>警告：请在生产环境中修改此密码！</p></blockquote><h3 id=pg_dbsu_password><code>pg_dbsu_password</code></h3><p>参数名称： <code>pg_dbsu_password</code>， 类型： <code>password</code>， 层次：<code>G/C</code></p><p>PostgreSQL <a href=#pg_dbsu><code>pg_dbsu</code></a> 超级用户密码，默认是空字符串，即不为其设置密码。</p><p>我们不建议为 dbsu 配置密码登陆，这会增大攻击面。例外情况是：<a href=#pg_mode><code>pg_mode</code></a> = <code>citus</code>，这时候需要为每个分片集群的 dbsu 配置密码，以便在分片集群内部进行连接。</p><hr><h2 id=pg_install><code>PG_INSTALL</code></h2><p>本节负责安装 PostgreSQL 及其扩展。如果您希望安装不同大版本与扩展插件，修改 <a href=#pg_version><code>pg_version</code></a> 与 <a href=#pg_extensions><code>pg_extensions</code></a> 即可，不过请注意，并不是所有扩展都在所有大版本可用。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># os 数据库超级用户名称，默认为 postgres，最好不要更改</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_uid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># os 数据库超级用户 uid 和 gid，默认为 26，适用于默认的 postgres 用户和组</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>limit              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 数据库超级用户 sudo 权限，可选 none,limit,all,nopass。默认为 limit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/var/lib/pgsql     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgresql 主目录，默认为 `/var/lib/pgsql`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dbsu_ssh_exchange</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 是否在相同的 pgsql 集群中交换 postgres 数据库超级用户的 ssh 密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 要安装的 postgres 主版本，默认为 18</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_bin_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/usr/pgsql/bin       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres 二进制目录，默认为 `/usr/pgsql/bin`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_log_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/log/postgres     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres 日志目录，默认为 `/pg/log/postgres`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># pg packages to be installed, alias can be used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-main pgsql-common</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># pg extensions to be installed, alias can be used</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_dbsu><code>pg_dbsu</code></h3><p>参数名称： <code>pg_dbsu</code>， 类型： <code>username</code>， 层次：<code>C</code></p><p>PostgreSQL 使用的操作系统 dbsu 用户名， 默认为 <code>postgres</code>，改这个用户名是不太明智的。</p><p>不过在特定情况下，您可能会使用到不同于 <code>postgres</code> 的用户名，例如在安装配置 Greenplum / MatrixDB 时，需要使用 <code>gpadmin</code> / <code>mxadmin</code> 作为相应的操作系统超级用户。</p><h3 id=pg_dbsu_uid><code>pg_dbsu_uid</code></h3><p>参数名称： <code>pg_dbsu_uid</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>操作系统数据库超级用户的 uid 和 gid，<code>26</code> 是 PGDG RPM 默认的 postgres 用户 UID/GID。</p><p>对于 Debian/Ubuntu 系统，没有默认值，且 <code>26</code> 号用户经常被占用。因此Pigsty 在检测到安装环境为 Debian 系，且 uid 为 <code>26</code> 时，会自动使用替换的 <code>pg_dbsu_uid = 543</code>。</p><h3 id=pg_dbsu_sudo><code>pg_dbsu_sudo</code></h3><p>参数名称： <code>pg_dbsu_sudo</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>数据库超级用户的 sudo 权限，可以是 <code>none</code>、<code>limit</code>、<code>all</code> 或 <code>nopass</code>。默认为 <code>limit</code></p><ul><li><p><code>none</code>: 无 Sudo 权限</p></li><li><p><code>limit</code>: 有限的 sudo 权限，用于执行与数据库相关的组件的 <code>systemctl</code> 命令（默认选项）。</p></li><li><p><code>all</code>: 完全的 <code>sudo</code> 权限，需要密码。</p></li><li><p><code>nopass</code>: 不需要密码的完全 <code>sudo</code> 权限（不推荐）。</p></li><li><p>默认值为 <code>limit</code>，只允许执行 <code>sudo systemctl &lt;start|stop|reload> &lt;postgres|patroni|pgbouncer|...> </code>。</p></li></ul><h3 id=pg_dbsu_home><code>pg_dbsu_home</code></h3><p>参数名称： <code>pg_dbsu_home</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>postgresql 主目录，默认为 <code>/var/lib/pgsql</code>，与官方的 pgdg RPM 保持一致。</p><h3 id=pg_dbsu_ssh_exchange><code>pg_dbsu_ssh_exchange</code></h3><p>参数名称： <code>pg_dbsu_ssh_exchange</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否在同一 PostgreSQL 集群中交换操作系统 dbsu 的 ssh 密钥？</p><p>默认值为 <code>true</code>，意味着同一集群中的数据库超级用户可以互相 ssh 访问。</p><h3 id=pg_version><code>pg_version</code></h3><p>参数名称： <code>pg_version</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>要安装的 postgres 主版本，默认为 <code>18</code>。</p><p>请注意，PostgreSQL 的物理流复制不能跨主要版本，因此最好不要在实例级别上配置此项。</p><p>您可以使用 <a href=#pg_packages><code>pg_packages</code></a> 和 <a href=#pg_extensions><code>pg_extensions</code></a> 中的参数来为特定的 PG 大版本安装不同的软件包与扩展。</p><h3 id=pg_bin_dir><code>pg_bin_dir</code></h3><p>参数名称： <code>pg_bin_dir</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>PostgreSQL 二进制程序目录，默认为 <code>/usr/pgsql/bin</code>。</p><p>默认值是在安装过程中手动创建的软链接，指向安装的特定的 Postgres 版本目录。</p><p>例如 <code>/usr/pgsql -> /usr/pgsql-15</code>。在 Ubuntu/Debian 上则指向 <code>/usr/lib/postgresql/15/bin</code>。</p><p>更多详细信息，请查看 <a href=/docs/ref/fhs#postgres-fhs>PGSQL 文件结构</a>。</p><h3 id=pg_log_dir><code>pg_log_dir</code></h3><p>参数名称： <code>pg_log_dir</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>PostgreSQL 日志目录，默认为：<code>/pg/log/postgres</code>，Vector 日志代理会使用此变量收集 PostgreSQL 日志。</p><p>请注意，如果日志目录 <a href=#pg_log_dir><code>pg_log_dir</code></a> 以数据库目录 <a href=#pg_data><code>pg_data</code></a> 作为前缀，则不会显式创建（数据库目录初始化时自动创建）。</p><h3 id=pg_packages><code>pg_packages</code></h3><p>参数名称： <code>pg_packages</code>， 类型： <code>string[]</code>， 层次：<code>C</code></p><p>要安装的 PostgreSQL 软件包（RPM/DEB），这是一个包名数组，元素可以是空格或逗号分隔的包别名。</p><p>Pigsty v4 将默认值收敛为两个别名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-main pgsql-common</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li><code>pgsql-main</code>：映射到当前平台上的 PostgreSQL 内核、客户端、PL 语言以及 <code>pg_repack</code>、<code>wal2json</code>、<code>pgvector</code> 等核心扩展。</li><li><code>pgsql-common</code>：映射到运行数据库必需的配套组件，例如 Patroni、Pgbouncer、pgBackRest、pg_exporter、vip-manager 等守护进程。</li></ul><p>别名的具体定义可以在 <a href=https://github.com/Vonng/pigsty/tree/main/roles/node_id/vars><code>roles/node_id/vars/</code></a> 中的 <code>pg_package_map</code> 查到，Pigsty 会先根据操作系统和架构解析别名，再将 <code>$v</code>/<code>${pg_version}</code> 替换为实际主版本 <a href=#pg_version><code>pg_version</code></a>，最后安装真实的软件包。这样可以屏蔽不同发行版之间的包名差异。</p><p>如果需要额外的软件包（例如特定 FDW 或扩展），可以直接在 <code>pg_packages</code> 中追加别名或真实包名。但请记得保留 <code>pgsql-main pgsql-common</code>，否则会缺失核心组件。</p><h3 id=pg_extensions><code>pg_extensions</code></h3><p>参数名称： <code>pg_extensions</code>， 类型： <code>string[]</code>， 层次：<code>G/C</code></p><p>要安装的 PostgreSQL 扩展包（RPM/DEB），这是一个由扩展包名或别名组成的数组。</p><p>从 v4 开始默认值为空列表 <code>[]</code>，Pigsty 不再强制安装大体量扩展，用户可以按需选择，避免占用额外的磁盘与依赖。</p><p>如果需要安装扩展，请像下面这样填充：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>postgis timescaledb pgvector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>pgsql-fdw    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 使用别名一次性安装常用 FDW</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>pg_package_map</code> 中提供了大量别名，方便在不同发行版之间屏蔽包名差异。以下是 EL9 平台可用的扩展组合供参考（按需挑选即可）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pg_extensions: <span style=color:#8f5902;font-style:italic># extensions to be installed on this cluster</span>
</span></span><span style=display:flex><span>  - timescaledb periods temporal_tables emaj table_version pg_cron pg_later pg_background pg_timetable
</span></span><span style=display:flex><span>  - postgis pgrouting pointcloud pg_h3 q3c ogr_fdw geoip <span style=color:#8f5902;font-style:italic>#pg_geohash #mobilitydb</span>
</span></span><span style=display:flex><span>  - pgvector pgvectorscale pg_vectorize pg_similarity pg_tiktoken pgml <span style=color:#8f5902;font-style:italic>#smlar</span>
</span></span><span style=display:flex><span>  - pg_search pg_bigm zhparser hunspell
</span></span><span style=display:flex><span>  - hydra pg_analytics pg_lakehouse pg_duckdb duckdb_fdw pg_fkpart pg_partman plproxy <span style=color:#8f5902;font-style:italic>#pg_strom citus</span>
</span></span><span style=display:flex><span>  - pg_hint_plan age hll rum pg_graphql pg_jsonschema jsquery index_advisor hypopg imgsmlr pg_ivm pgmq pgq <span style=color:#8f5902;font-style:italic>#rdkit</span>
</span></span><span style=display:flex><span>  - pg_tle plv8 pllua plprql pldebugger plpgsql_check plprofiler plsh <span style=color:#8f5902;font-style:italic>#pljava plr pgtap faker dbt2</span>
</span></span><span style=display:flex><span>  - prefix semver pgunit md5hash asn1oid roaringbitmap pgfaceting pgsphere pg_country pg_currency pgmp numeral pg_rational pguint ip4r timestamp9 chkpass <span style=color:#8f5902;font-style:italic>#pg_uri #pgemailaddr #acl #debversion #pg_rrule</span>
</span></span><span style=display:flex><span>  - topn pg_gzip pg_http pg_net pg_html5_email_address pgsql_tweaks pg_extra_time pg_timeit count_distinct extra_window_functions first_last_agg tdigest aggs_for_arrays pg_arraymath pg_idkit pg_uuidv7 permuteseq pg_hashids
</span></span><span style=display:flex><span>  - sequential_uuids pg_math pg_random pg_base36 pg_base62 floatvec pg_financial pgjwt pg_hashlib shacrypt cryptint pg_ecdsa pgpcre icu_ext envvar url_encode <span style=color:#8f5902;font-style:italic>#pg_zstd #aggs_for_vecs #quantile #lower_quantile #pgqr #pg_protobuf</span>
</span></span><span style=display:flex><span>  - pg_repack pg_squeeze pg_dirtyread pgfincore pgdd ddlx pg_prioritize pg_checksums pg_readonly safeupdate pg_permissions pgautofailover pg_catcheck preprepare pgcozy pg_orphaned pg_crash pg_cheat_funcs pg_savior table_log pg_fio <span style=color:#8f5902;font-style:italic>#pgpool pgagent</span>
</span></span><span style=display:flex><span>  - pg_profile pg_show_plans pg_stat_kcache pg_stat_monitor pg_qualstats pg_store_plans pg_track_settings pg_wait_sampling system_stats pg_meta pgnodemx pg_sqlog bgw_replstatus pgmeminfo toastinfo pagevis powa pg_top <span style=color:#8f5902;font-style:italic>#pg_statviz #pgexporter_ext #pg_mon</span>
</span></span><span style=display:flex><span>  - passwordcheck supautils pgsodium pg_vault anonymizer pg_tde pgsmcrypto pgaudit pgauditlogtofile pg_auth_mon credcheck pgcryptokey pg_jobmon logerrors login_hook set_user pg_snakeoil pgextwlist pg_auditor noset <span style=color:#8f5902;font-style:italic>#sslutils</span>
</span></span><span style=display:flex><span>  - wrappers multicorn odbc_fdw mysql_fdw tds_fdw sqlite_fdw pgbouncer_fdw mongo_fdw redis_fdw pg_redis_pubsub kafka_fdw hdfs_fdw firebird_fdw aws_s3 log_fdw <span style=color:#8f5902;font-style:italic>#oracle_fdw #db2_fdw #jdbc_fdw</span>
</span></span><span style=display:flex><span>  - orafce pgtt session_variable pg_statement_rollback pg_dbms_metadata pg_dbms_lock pgmemcache <span style=color:#8f5902;font-style:italic>#pg_dbms_job #wiltondb</span>
</span></span><span style=display:flex><span>  - pglogical pgl_ddl_deploy pg_failover_slots wal2json wal2mongo decoderbufs decoder_raw mimeo pgcopydb pgloader pg_fact_loader pg_bulkload pg_comparator pgimportdoc pgexportdoc <span style=color:#8f5902;font-style:italic>#repmgr #slony</span>
</span></span><span style=display:flex><span>  - gis-stack rag-stack fdw-stack fts-stack etl-stack feat-stack olap-stack supa-stack stat-stack json-stack
</span></span></code></pre></div><p>完整列表请参考：<a href=https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a></p><hr><h2 id=pg_bootstrap><code>PG_BOOTSTRAP</code></h2><p>使用 Patroni 引导拉起 PostgreSQL 集群，并设置 1:1 对应的 Pgbouncer 连接池。</p><p>它还会使用 <a href=#pg_provision><code>PG_PROVISION</code></a> 中定义的默认角色、用户、权限、模式、扩展来初始化数据库集群</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/data                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres data directory, `/pg/data` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_fs_main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/postgres       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres main data directory, `/data/postgres` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_fs_backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/backups      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres backup data directory, `/data/backups` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_storage_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>SSD             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># storage type for pg main data, SSD,HDD, SSD by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dummy_filesize</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>64MiB         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># size of `/pg/dummy`, hold 64MB disk space for emergency use</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_listen</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.0.0.0&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># postgres/pgbouncer listen addresses, comma separated list</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5432</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># postgres listen port, 5432 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_localhost</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/var/run/postgresql</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres unix socket dir for localhost connection</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># if disabled, no postgres cluster will be created during init</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_mode: default             # patroni working mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default,pause,remove</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># top level key namespace in etcd, used by patroni &amp; vip</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8008</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># patroni listen port, 8008 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_log_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/log/patroni </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># patroni log dir, `/pg/log/patroni` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_ssl_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># secure patroni RestAPI communications with SSL?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_watchdog_mode: off        # patroni watchdog mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>automatic,required,off. off by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># patroni restapi username, `postgres` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>patroni_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Patroni.API    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># patroni restapi password, `Patroni.API` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_etcd_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># etcd password for this pg cluster, &#39;&#39; to use pg_cluster</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_primary_db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># primary database name, used by citus,etc... ,postgres by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># extra parameters in postgresql.auto.conf</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># extra files to be copied to postgres data directory (e.g. license)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_conf: oltp.yml                 # config template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp,olap,crit,tiny. `oltp.yml` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_max_conn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>auto                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres max connections, `auto` will use recommended value</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_shared_buffer_ratio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.25</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># postgres shared buffers ratio, 0.25 by default, 0.1~0.4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_io_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>worker             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># io method for postgres, auto,sync,worker,io_uring, worker by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto: norm                      # shared rto mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fast,norm,safe,wide (or seconds for compatibility)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rpo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1048576</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># recovery point objective in bytes, `1MiB` at most by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_libs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;pg_stat_statements, auto_explain&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># preloaded libraries, `pg_stat_statements,auto_explain` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_delay</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># replication apply delay for standby cluster leader</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_checksum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># enable data checksum for postgres cluster?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_pwd_enc: scram-sha-256         # passwords encryption algorithm</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fixed to scram-sha-256</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_encoding</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>UTF8                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># database cluster encoding, `UTF8` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_locale</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># database cluster local, `C` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_lc_collate</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># database cluster collate, `C` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_lc_ctype</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>C                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># database character type, `C` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#pgsodium_key: &#34;&#34;                 # pgsodium key, 64 hex digit, default to sha256(pg_cluster)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#pgsodium_getkey_script: &#34;&#34;       # pgsodium getkey script path, pgsodium_getkey by default</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_data><code>pg_data</code></h3><p>参数名称： <code>pg_data</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>Postgres 数据目录，默认为 <code>/pg/data</code>。</p><p>这是一个指向底层实际数据目录的符号链接，在多处被使用，请不要修改它。参阅 <a href=/docs/ref/fhs>PGSQL文件结构</a> 获取详细信息。</p><h3 id=pg_fs_main><code>pg_fs_main</code></h3><p>参数名称： <code>pg_fs_main</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>PostgreSQL 主数据盘的挂载点/文件系统路径，默认为<code>/data/postgres</code>。</p><p>默认值：<code>/data/postgres</code>，它将直接用作 PostgreSQL 主数据目录的父目录。</p><p>建议使用 NVME SSD 作为 PostgreSQL 主数据存储，Pigsty默认为SSD存储进行了优化，但是也支持HDD。</p><p>您可以更改 <a href=#pg_storage_type><code>pg_storage_type</code></a> 为 <code>HDD</code> 以针对HDD存储进行优化。</p><h3 id=pg_fs_backup><code>pg_fs_backup</code></h3><p>参数名称： <code>pg_fs_backup</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>PostgreSQL 备份数据盘的挂载点/文件系统路径，默认为<code>/data/backups</code>。</p><p>如果您使用的是默认的 <a href=#pgbackrest_method><code>pgbackrest_method</code></a> = <code>local</code>，建议为备份存储使用一个单独的磁盘。</p><p>备份磁盘应足够大，以容纳所有的备份，至少足以容纳3个基础备份+2天的WAL归档。 通常容量不是什么大问题，因为您可以使用便宜且大的机械硬盘作为备份盘。</p><p>建议为备份存储使用一个单独的磁盘，否则 Pigsty 将回退到主数据磁盘，并占用主数据盘的容量与IO。</p><h3 id=pg_storage_type><code>pg_storage_type</code></h3><p>参数名称： <code>pg_storage_type</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>PostgreSQL 数据存储介质的类型：<code>SSD</code>或<code>HDD</code>，默认为<code>SSD</code>。</p><p>默认值：<code>SSD</code>，它会影响一些调优参数，如 <code>random_page_cost</code> 和 <code>effective_io_concurrency</code> 。</p><h3 id=pg_dummy_filesize><code>pg_dummy_filesize</code></h3><p>参数名称： <code>pg_dummy_filesize</code>， 类型： <code>size</code>， 层次：<code>C</code></p><p><code>/pg/dummy</code>的大小，默认值为<code>64MiB</code>，用于紧急使用的64MB磁盘空间。</p><p>当磁盘已满时，删除占位符文件可以为紧急使用释放一些空间，建议生产使用至少<code>8GiB</code>。</p><h3 id=pg_listen><code>pg_listen</code></h3><p>参数名称： <code>pg_listen</code>， 类型： <code>ip</code>， 层次：<code>C</code></p><p>PostgreSQL / Pgbouncer 的监听地址，默认为<code>0.0.0.0</code>（所有ipv4地址）。</p><p>您可以在此变量中使用占位符，例如：<code>'${ip},${lo}'</code>或<code>'${ip},${vip},${lo}'</code>：</p><ul><li><code>${ip}</code>：转换为 <code>inventory_hostname</code>，它是配置清单中定义的首要内网IP地址。</li><li><code>${vip}</code>：如果启用了 <a href=#pg_vip_enabled><code>pg_vip_enabled</code></a>，将使用 <a href=#pg_vip_address><code>pg_vip_address</code></a> 的主机部分。</li><li><code>${lo}</code>：将替换为<code>127.0.0.1</code></li></ul><p>对于高安全性要求的生产环境，建议限制监听的IP地址。</p><h3 id=pg_port><code>pg_port</code></h3><p>参数名称： <code>pg_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>PostgreSQL 服务器监听的端口，默认为 <code>5432</code>。</p><h3 id=pg_localhost><code>pg_localhost</code></h3><p>参数名称： <code>pg_localhost</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>本地主机连接 PostgreSQL 使用的 Unix套接字目录，默认值为<code>/var/run/postgresql</code>。</p><p>PostgreSQL 和 Pgbouncer 本地连接的Unix套接字目录，<a href=/docs/concept/arch/pgsql#pg_exporter><code>pg_exporter</code></a> 和 patroni 都会优先使用 Unix 套接字访问 PostgreSQL。</p><h3 id=pg_namespace><code>pg_namespace</code></h3><p>参数名称： <code>pg_namespace</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>在 <a href=/docs/concept/arch/pgsql#etcd>etcd</a> 中使用的顶级命名空间，由 patroni 和 vip-manager 使用，默认值是：<code>/pg</code>，不建议更改。</p><h3 id=patroni_enabled><code>patroni_enabled</code></h3><p>参数名称： <code>patroni_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否启用 Patroni ？默认值为：<code>true</code>。</p><p>如果禁用，则在初始化期间不会创建Postgres集群。Pigsty将跳过拉起 patroni的任务，当试图向现有的postgres实例添加一些组件时，可以使用此参数。</p><h3 id=patroni_mode><code>patroni_mode</code></h3><p>参数名称： <code>patroni_mode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Patroni 工作模式：<code>default</code>，<code>pause</code>，<code>remove</code>。默认值：<code>default</code>。</p><ul><li><code>default</code>：正常使用 Patroni 引导 PostgreSQL 集群</li><li><code>pause</code>：与<code>default</code>相似，但在引导后进入维护模式</li><li><code>remove</code>：使用Patroni初始化集群，然后删除Patroni并使用原始 PostgreSQL。</li></ul><h3 id=patroni_port><code>patroni_port</code></h3><p>参数名称： <code>patroni_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>patroni监听端口，默认为<code>8008</code>，不建议更改。</p><p>Patroni API服务器在此端口上监听健康检查和API请求。</p><h3 id=patroni_log_dir><code>patroni_log_dir</code></h3><p>参数名称： <code>patroni_log_dir</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>patroni 日志目录，默认为 <code>/pg/log/patroni</code>，由 Vector 日志代理收集。</p><h3 id=patroni_ssl_enabled><code>patroni_ssl_enabled</code></h3><p>参数名称： <code>patroni_ssl_enabled</code>， 类型： <code>bool</code>， 层次：<code>G</code></p><p>使用SSL保护patroni RestAPI通信吗？默认值为<code>false</code>。</p><p>此参数是一个全局标志，只能在部署之前预先设置。因为如果为 patroni 启用了SSL，您将必须使用 HTTPS 而不是 HTTP 执行健康检查、获取指标，调用API。</p><h3 id=patroni_watchdog_mode><code>patroni_watchdog_mode</code></h3><p>参数名称： <code>patroni_watchdog_mode</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>patroni看门狗模式：<code>automatic</code>，<code>required</code>，<code>off</code>，默认值为 <code>off</code>。</p><p>在主库故障的情况下，Patroni 可以使用 <a href=https://patroni.readthedocs.io/en/latest/watchdog.html><strong>看门狗</strong></a> 来强制关机旧主库节点以避免脑裂。</p><ul><li><code>off</code>：不使用<code>看门狗</code>。完全不进行 Fencing （默认行为）</li><li><code>automatic</code>：如果内核启用了<code>softdog</code>模块并且看门狗属于dbsu，则启用 <code>watchdog</code>。</li><li><code>required</code>：强制启用 <code>watchdog</code>，如果<code>softdog</code>不可用则拒绝启动 Patroni/PostgreSQL。</li></ul><p>默认值为<code>off</code>，您不应该在 Infra节点 启用看门狗，数据一致性优先于可用性的关键系统，特别是与钱有关的业务集群可以考虑打开此选项。</p><blockquote><p><strong>注意</strong>：当使用 <a href=#pg_conf><code>pg_conf</code></a> = <code>crit</code> 配置模板时，<code>off</code> 会被自动提升为 <code>automatic</code>，以确保关键业务系统的数据一致性。</p></blockquote><p>请注意，如果您的所有访问流量都使用 HAproxy 健康检查 <a href=/docs/pgsql/service/#%E6%8E%A5%E5%85%A5%E6%9C%8D%E5%8A%A1><strong>服务接入</strong></a>，正常是不存在脑裂风险的。</p><h3 id=patroni_username><code>patroni_username</code></h3><p>参数名称： <code>patroni_username</code>， 类型： <code>username</code>， 层次：<code>C</code></p><p>Patroni REST API 用户名，默认为 <code>postgres</code>，与 <a href=#patroni_password><code>patroni_password</code></a> 配对使用。</p><p>Patroni的危险 REST API （比如重启集群）由额外的用户名/密码保护，查看 <a href=/docs/pgsql/admin/cluster#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4>配置集群</a> 和 <a href=https://patroni.readthedocs.io/en/latest/rest_api.html>Patroni RESTAPI</a> 以获取详细信息。</p><h3 id=patroni_password><code>patroni_password</code></h3><p>参数名称： <code>patroni_password</code>， 类型： <code>password</code>， 层次：<code>C</code></p><p>Patroni REST API 密码，默认为<code>Patroni.API</code>。</p><blockquote><p>警告：务必生产环境中修改此参数！</p></blockquote><h3 id=pg_primary_db><code>pg_primary_db</code></h3><p>参数名称： <code>pg_primary_db</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>指定集群中的主数据库名称，用于 citus 等业务数据库，默认为 <code>postgres</code>。</p><p>例如，在使用 Patroni 管理高可用的 Citus 集群时，您必须选择一个 “主数据库”。</p><p>此外，在这里指定的数据库名称，将在 PGSQL 模块安装完成后，显示在打印的连接串中。</p><h3 id=pg_parameters><code>pg_parameters</code></h3><p>参数名称： <code>pg_parameters</code>， 类型： <code>dict</code>， 层次：<code>G/C/I</code></p><p>可用于指定并管理 <code>postgresql.auto.conf</code> 中的配置参数。</p><p>当集群所有实例完成初始化后，<code>pg_param</code> 任务将会把本字典中的 key / value 键值对依次覆盖写入 <code>/pg/data/postgresql.auto.conf</code> 中。</p><blockquote><p>注意：请不要手工修改该配置文件，或通过 <code>ALTER SYSTEM</code> 修改集群配置参数，修改会在下一次配置同步时被覆盖。</p></blockquote><p>该变量的优先级大于 Patroni / DCS 中的集群配置（即优先级高于集群配置，由 Patroni <code>edit-config</code> 编辑的配置），因此通常可以在实例级别覆盖集群默认参数。</p><p>当您的集群成员有着不同的规格（不推荐的行为！）时，您可以通过本参数对每个实例的配置进行精细化管理。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary , pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;5GB&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role: replica , pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;4GB&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role: replica , pg_parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>shared_buffers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;3GB&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>请注意，一些 <a href=https://patroni.readthedocs.io/en/latest/patroni_configuration.html#important-rules>重要的集群参数</a>（对主从库参数值有要求）是 Patroni 直接通过命令行参数管理的，具有最高优先级，无法通过此方式覆盖，对于这些参数，您必须使用 Patroni <code>edit-config</code> 进行管理与配置。</p><p>在主从上必须保持一致的 PostgreSQL 参数（不一致会导致从库无法启动！）：</p><ul><li><code>wal_level</code></li><li><code>max_connections</code></li><li><code>max_locks_per_transaction</code></li><li><code>max_worker_processes</code></li><li><code>max_prepared_transactions</code></li><li><code>track_commit_timestamp</code></li></ul><p>在主从上最好保持一致的参数（考虑到主从切换的可能性）：</p><ul><li><code>listen_addresses</code></li><li><code>port</code></li><li><code>cluster_name</code></li><li><code>hot_standby</code></li><li><code>wal_log_hints</code></li><li><code>max_wal_senders</code></li><li><code>max_replication_slots</code></li><li><code>wal_keep_segments</code></li><li><code>wal_keep_size</code></li></ul><p>您可以设置不存在的参数（例如来自扩展的 GUC，从而配置 <code>ALTER SYSTEM</code> 无法修改的“尚未存在”的参数），但将现有配置修改为非法值可能会导致 PostgreSQL 无法启动，请谨慎配置！</p><h3 id=pg_files><code>pg_files</code></h3><p>参数名称： <code>pg_files</code>， 类型： <code>path[]</code>， 层次：<code>C</code></p><p>用于指定需要拷贝至PGDATA目录的文件列表，默认为空数组：<code>[]</code></p><p>在本参数中指定的文件将会被拷贝至 <code>{{ pg_data }}</code> 目录下，这主要用于下发特殊商业版本 PostgreSQL 内核要求的 License 文件。</p><p>目前仅有 PolarDB （Oracle兼容）内核需要许可证文件，例如，您可以将 <code>license.lic</code> 文件放置在 <code>files/</code> 目录下，并在 <code>pg_files</code> 中指定：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>license.lic ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_conf><code>pg_conf</code></h3><p>参数名称： <code>pg_conf</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>配置模板：<code>{oltp,olap,crit,tiny}.yml</code>，默认为<code>oltp.yml</code>。</p><ul><li><code>tiny.yml</code>：为小节点、虚拟机、小型演示优化（1-8核，1-16GB）</li><li><code>oltp.yml</code>：为OLTP工作负载和延迟敏感应用优化（4C8GB+）（默认模板）</li><li><code>olap.yml</code>：为OLAP工作负载和吞吐量优化（4C8G+）</li><li><code>crit.yml</code>：为数据一致性和关键应用优化（4C8G+）</li></ul><p>默认值：<code>oltp.yml</code>，但是 <a href=/docs/setup/install#%E9%85%8D%E7%BD%AE>配置</a> 程序将在当前节点为小节点时将此值设置为 <code>tiny.yml</code>。</p><p>您可以拥有自己的模板，只需将其放在<code>templates/&lt;mode>.yml</code>下，并将此值设置为模板名称即可使用。</p><h3 id=pg_max_conn><code>pg_max_conn</code></h3><p>参数名称： <code>pg_max_conn</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>PostgreSQL 服务器最大连接数。你可以选择一个介于 50 到 5000 之间的值，或使用 <code>auto</code> 选择推荐值。</p><p>默认值为 <code>auto</code>，会根据 <a href=#pg_conf><code>pg_conf</code></a> 和 <a href=#pg_default_service_dest><code>pg_default_service_dest</code></a> 来设定最大连接数。</p><ul><li>tiny: 100</li><li>olap: 200</li><li>oltp: 200 (pgbouncer) / 1000 (postgres)<ul><li>pg_default_service_dest = pgbouncer : 200</li><li>pg_default_service_dest = postgres : 1000</li></ul></li><li>crit: 200 (pgbouncer) / 1000 (postgres)<ul><li>pg_default_service_dest = pgbouncer : 200</li><li>pg_default_service_dest = postgres : 1000</li></ul></li></ul><p>不建议将此值设定为超过 5000，否则你还需要手动增加 haproxy 服务的连接限制。</p><p>Pgbouncer 的事务池可以缓解过多的 OLTP 连接问题，因此默认情况下不建议设置很大的连接数。</p><p>对于 OLAP 场景， <a href=#pg_default_service_dest><code>pg_default_service_dest</code></a> 修改为 <code>postgres</code> 可以绕过连接池。</p><h3 id=pg_shared_buffer_ratio><code>pg_shared_buffer_ratio</code></h3><p>参数名称： <code>pg_shared_buffer_ratio</code>， 类型： <code>float</code>， 层次：<code>C</code></p><p>Postgres 共享缓冲区内存比例，默认为 <code>0.25</code>，正常范围在 <code>0.1</code>~<code>0.4</code> 之间。</p><p>默认值：<code>0.25</code>，意味着节点内存的 25% 将被用作 PostgreSQL 的分片缓冲区。如果您想为 PostgreSQL 启用大页，那么此参数值应当适当小于 <a href=/docs/node/param#node_hugepage_ratio><code>node_hugepage_ratio</code></a>。</p><p>将此值设定为大于 0.4（40%）通常不是好主意，但在极端情况下可能有用。</p><p>注意，共享缓冲区只是 PostgreSQL 中共享内存的一部分，要计算总共享内存，使用 <code>show shared_memory_size_in_huge_pages;</code>。</p><h3 id=pg_rto><code>pg_rto</code></h3><p>参数名称： <code>pg_rto</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>恢复时间目标（RTO）模式，用于控制 Patroni 与 HAProxy 的超时参数，默认为 <code>norm</code>。</p><p>Pigsty 提供四种预设的 RTO 模式，分别针对不同的网络条件与部署场景进行了优化：</p><table><thead><tr><th style=text-align:left>模式</th><th style=text-align:left>适用场景</th><th style=text-align:left>网络条件</th><th style=text-align:left>平均 RTO</th><th style=text-align:left>最坏 RTO</th><th style=text-align:left>误切风险</th></tr></thead><tbody><tr><td style=text-align:left><code>fast</code></td><td style=text-align:left>同机柜/同交换机</td><td style=text-align:left>&lt; 1ms，极稳定</td><td style=text-align:left><strong>14s</strong></td><td style=text-align:left><strong>29s</strong></td><td style=text-align:left>较高</td></tr><tr><td style=text-align:left><code>norm</code></td><td style=text-align:left>同机房（默认）</td><td style=text-align:left>1-5ms，正常</td><td style=text-align:left><strong>21s</strong></td><td style=text-align:left><strong>43s</strong></td><td style=text-align:left>中等</td></tr><tr><td style=text-align:left><code>safe</code></td><td style=text-align:left>同省跨机房</td><td style=text-align:left>10-50ms，跨机房</td><td style=text-align:left><strong>43s</strong></td><td style=text-align:left><strong>91s</strong></td><td style=text-align:left>较低</td></tr><tr><td style=text-align:left><code>wide</code></td><td style=text-align:left>跨地域/跨洲</td><td style=text-align:left>100-200ms，公网</td><td style=text-align:left><strong>92s</strong></td><td style=text-align:left><strong>207s</strong></td><td style=text-align:left>极低</td></tr></tbody></table><p>减小 RTO 可以加快故障恢复速度，但会增加误切风险（网络抖动被误判为故障）。您需要根据实际网络条件选择合适的模式。
更多详情请参阅 <a href=/docs/concept/ha/rto/><strong>RTO 利弊权衡</strong></a> 文档。</p><p>为了向后兼容，也支持直接指定秒数，系统会自动映射到最接近的模式：<code>&lt; 30</code> → <code>fast</code>，<code>30-44</code> → <code>norm</code>，<code>45-89</code> → <code>safe</code>，<code>≥ 90</code> → <code>wide</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>norm  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 默认模式，适合同机房部署</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>safe  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 跨机房部署推荐</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># 兼容旧版写法，等效于 norm</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_rto_plan><code>pg_rto_plan</code></h3><p>参数名称： <code>pg_rto_plan</code>， 类型： <code>dict</code>， 层次：<code>G</code></p><p>RTO 预设配置字典，定义了 Patroni 高可用与 HAProxy 健康检查的具体超时参数，默认值包含四种预设模式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto_plan</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># [ttl, loop, retry, start, margin, inter, fastinter, downinter, rise, fall]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>fast</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;1s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;0.5s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;1s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># rto &lt; 30s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>norm</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;2s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;1s&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;2s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># rto &lt; 45s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>safe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#f8f8f8>  </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>45</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;3s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;1.5s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;3s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># rto &lt; 90s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wide</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>120</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>95</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;4s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;2s&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;4s&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># rto &lt; 150s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>每个模式是一个包含 10 个参数的数组，用于同时控制 Patroni 和 HAProxy 的超时行为：</p><table><thead><tr><th style=text-align:center>索引</th><th style=text-align:left>参数名</th><th style=text-align:left>组件</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:center>0</td><td style=text-align:left><code>ttl</code></td><td style=text-align:left>Patroni</td><td style=text-align:left>主库锁 TTL（秒）</td></tr><tr><td style=text-align:center>1</td><td style=text-align:left><code>loop_wait</code></td><td style=text-align:left>Patroni</td><td style=text-align:left>主循环休眠间隔（秒）</td></tr><tr><td style=text-align:center>2</td><td style=text-align:left><code>retry_timeout</code></td><td style=text-align:left>Patroni</td><td style=text-align:left>DCS/PostgreSQL 重试超时</td></tr><tr><td style=text-align:center>3</td><td style=text-align:left><code>primary_start_timeout</code></td><td style=text-align:left>Patroni</td><td style=text-align:left>主库恢复等待时间</td></tr><tr><td style=text-align:center>4</td><td style=text-align:left><code>safety_margin</code></td><td style=text-align:left>Patroni</td><td style=text-align:left>Watchdog 安全边界</td></tr><tr><td style=text-align:center>5</td><td style=text-align:left><code>inter</code></td><td style=text-align:left>HAProxy</td><td style=text-align:left>健康检查间隔</td></tr><tr><td style=text-align:center>6</td><td style=text-align:left><code>fastinter</code></td><td style=text-align:left>HAProxy</td><td style=text-align:left>状态变化时的快速检查间隔</td></tr><tr><td style=text-align:center>7</td><td style=text-align:left><code>downinter</code></td><td style=text-align:left>HAProxy</td><td style=text-align:left>服务器宕机时的检查间隔</td></tr><tr><td style=text-align:center>8</td><td style=text-align:left><code>rise</code></td><td style=text-align:left>HAProxy</td><td style=text-align:left>标记为 UP 所需的连续成功检查次数</td></tr><tr><td style=text-align:center>9</td><td style=text-align:left><code>fall</code></td><td style=text-align:left>HAProxy</td><td style=text-align:left>标记为 DOWN 所需的连续失败检查次数</td></tr></tbody></table><p>此参数允许用户通过覆盖默认值来自定义 RTO 行为，或添加新的 RTO 模式。例如，如果您需要一个更激进的 RTO 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rto_plan</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ultra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.5s&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.25s&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;0.5s&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 极速模式，仅限低延迟环境</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p><strong>注意</strong>：修改此参数需要谨慎，不恰当的超时配置可能导致集群不稳定或频繁误切换。</p></blockquote><h3 id=pg_rpo><code>pg_rpo</code></h3><p>参数名称： <code>pg_rpo</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>以字节为单位的恢复点目标（RPO），默认值：<code>1048576</code>。</p><p>默认为 1MiB，这意味着在故障转移期间最多可以容忍 1MiB 的数据丢失。</p><p>当主节点宕机并且所有副本都滞后时，你必须做出一个艰难的选择，<strong>在可用性和一致性之间进行权衡</strong>：</p><ul><li>提升一个从库成为新的主库，并尽快将系统恢复服务，但要付出可接受的数据丢失代价（例如，少于 1MB）。</li><li>等待主库重新上线（可能永远不会），或人工干预以避免任何数据丢失。</li></ul><p>你可以使用 <code>crit.yml</code> <a href=#pg_conf>conf</a> 模板来确保在故障转移期间没有数据丢失，但这会牺牲一些性能。</p><h3 id=pg_libs><code>pg_libs</code></h3><p>参数名称： <code>pg_libs</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>预加载的动态共享库，默认为 <code>pg_stat_statements,auto_explain</code>，这是两个 PostgreSQL 自带的扩展，强烈建议启用。</p><p>对于现有集群，您可以直接 <a href=/docs/pgsql/admin/cluster#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4>配置集群</a> 的 <code>shared_preload_libraries</code> 参数并应用生效。</p><p>如果您想使用 TimescaleDB 或 Citus 扩展，您需要将 <code>timescaledb</code> 或 <code>citus</code> 添加到此列表中。<code>timescaledb</code> 和 <code>citus</code> 应当放在这个列表的最前面，例如：</p><pre tabindex=0><code>citus,timescaledb,pg_stat_statements,auto_explain
</code></pre><p>其他需要动态加载的扩展也可以添加到这个列表中，例如 <code>pg_cron</code>， <code>pgml</code> 等，通常 <code>citus</code> 和 <code>timescaledb</code> 有着最高的优先级，应该添加到列表的最前面。</p><h3 id=pg_delay><code>pg_delay</code></h3><p>参数名称： <code>pg_delay</code>， 类型： <code>interval</code>， 层次：<code>I</code></p><p>延迟备库复制延迟，默认值：<code>0</code>。</p><p>如果此值被设置为一个正值，备用集群主库在应用 WAL 变更之前将被延迟这个时间。设置为 <code>1h</code> 意味着该集群中的数据将始终滞后原集群一个小时。</p><p>查看 <a href=/docs/pgsql/config/cluster#%E5%BB%B6%E8%BF%9F%E9%9B%86%E7%BE%A4>延迟备用集群</a> 以获取详细信息。</p><h3 id=pg_checksum><code>pg_checksum</code></h3><p>参数名称： <code>pg_checksum</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>为 PostgreSQL 集群启用数据校验和吗？默认值是 <code>true</code>，启用。</p><p>这个参数只能在 PGSQL 部署之前设置（但你可以稍后手动启用它）。</p><p>数据校验和可以帮助检测磁盘损坏和硬件故障，从 Pigsty v3.5 开始默认启用此功能以确保数据完整性。</p><h3 id=pg_pwd_enc><code>pg_pwd_enc</code></h3><p>参数名称： <code>pg_pwd_enc</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>密码加密算法，Pigsty v4 以后固定为 <code>scram-sha-256</code>。</p><p>所有新建用户都会使用 SCRAM 凭据。<code>md5</code> 已被淘汰，如需兼容旧客户端，请在业务连接池或客户端驱动中升级至 SCRAM。</p><h3 id=pg_encoding><code>pg_encoding</code></h3><p>参数名称： <code>pg_encoding</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>数据库集群编码，默认为 <code>UTF8</code>。</p><p>不建议使用其他非 <code>UTF8</code> 系编码。</p><h3 id=pg_locale><code>pg_locale</code></h3><p>参数名称： <code>pg_locale</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>数据库集群本地化规则集 (Locale)，默认为 <code>C</code>。</p><p>此参数控制数据库的默认 Locale 设置，影响排序规则、字符分类等行为。使用 <code>C</code> 或 <code>POSIX</code> 可以获得最佳的性能和可预测的排序行为。</p><p>如果您需要特定语言的本地化支持，可以设置为相应的 Locale，例如 <code>en_US.UTF-8</code> 或 <code>zh_CN.UTF-8</code>。请注意，Locale 设置会影响索引的排序顺序，因此在集群初始化后无法更改。</p><h3 id=pg_lc_collate><code>pg_lc_collate</code></h3><p>参数名称： <code>pg_lc_collate</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>数据库集群本地化排序规则，默认为 <code>C</code>。</p><p>除非您知道自己在做什么，否则不建议修改集群级别的本地排序规则设置。</p><h3 id=pg_lc_ctype><code>pg_lc_ctype</code></h3><p>参数名称： <code>pg_lc_ctype</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>数据库字符集 CTYPE，默认为 <code>C</code>。</p><p>从 Pigsty v3.5 开始，为了与 <code>pg_lc_collate</code> 保持一致，默认值改为 <code>C</code>。</p><h3 id=pg_io_method><code>pg_io_method</code></h3><p>参数名称： <code>pg_io_method</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>PostgreSQL 的 IO 方法，默认为 <code>worker</code>。可选值包括：</p><ul><li><code>auto</code>：根据操作系统自动选择，在 Debian 系列或 EL 10+ 上使用 <code>io_uring</code>，否则使用 <code>worker</code></li><li><code>sync</code>：使用传统的同步 IO 方式</li><li><code>worker</code>：使用后台工作进程处理 IO（默认选项）</li><li><code>io_uring</code>：使用 Linux 的 io_uring 异步 IO 接口</li></ul><p>此参数仅适用于 PostgreSQL 17 及以上版本，控制 PostgreSQL 数据块层的 IO 策略。</p><ul><li>在 PostgreSQL 17 中，<code>io_uring</code> 可以提供更高的 IO 性能，但需要操作系统内核支持（Linux 5.1+）并安装 <code>liburing</code> 库。</li><li>在 PostgreSQL 18 中，默认 IO 方法已从 <code>sync</code> 改为 <code>worker</code>，使用后台工作进程处理异步 IO，无需额外依赖。</li><li>如果您使用 Debian 12/Ubuntu 22+ 或 EL 10+ 系统，并希望获得最佳 IO 性能，可以考虑设置为 <code>io_uring</code>。</li></ul><p>请注意，在不支持 <code>io_uring</code> 的系统上设置此值可能导致 PostgreSQL 启动失败，因此 <code>auto</code> 或 <code>worker</code> 是更安全的选择。</p><h3 id=pg_etcd_password><code>pg_etcd_password</code></h3><p>参数名称： <code>pg_etcd_password</code>， 类型： <code>password</code>， 层次：<code>C</code></p><p>此 PostgreSQL 集群在 etcd 中使用的密码，默认为空字符串 <code>''</code>。</p><p>如果设置为空字符串，则会使用 <a href=#pg_cluster><code>pg_cluster</code></a> 参数值作为密码（对于 Citus 集群则使用 <a href=#pg_shard><code>pg_shard</code></a> 参数值）。</p><p>此密码用于 Patroni 连接 etcd 以及 vip-manager 访问 etcd 时的认证。</p><h3 id=pgsodium_key><code>pgsodium_key</code></h3><p>参数名称： <code>pgsodium_key</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>用于 pgsodium 扩展的加密主密钥，由 64 位十六进制数字组成。</p><p>默认不设置此参数，如果未指定，Pigsty 会使用 <code>sha256(pg_cluster)</code> 的值自动生成一个确定性的密钥。</p><p><a href=https://github.com/michelp/pgsodium>pgsodium</a> 是一个基于 libsodium 的 PostgreSQL 扩展，提供加密函数和透明列加密功能。
如果您需要使用 pgsodium 的加密功能，建议显式指定一个安全的随机密钥，并妥善保管。</p><p>生成随机密钥的命令示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl rand -hex <span style=color:#0000cf;font-weight:700>32</span>   <span style=color:#8f5902;font-style:italic># 生成 64 位十六进制密钥</span>
</span></span></code></pre></div><h3 id=pgsodium_getkey_script><code>pgsodium_getkey_script</code></h3><p>参数名称： <code>pgsodium_getkey_script</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>pgsodium 获取密钥脚本的路径，默认使用 Pigsty 模板中的 <code>pgsodium_getkey</code> 脚本。</p><p>此脚本用于在 PostgreSQL 启动时获取 pgsodium 的主密钥。默认脚本会从环境变量或配置文件中读取密钥。</p><p>如果您有自定义的密钥管理需求（如使用 HashiCorp Vault、AWS KMS 等），可以提供自定义脚本路径。</p><h2 id=pg_provision><code>PG_PROVISION</code></h2><p>如果说 <a href=#pg_bootstrap><code>PG_BOOTSTRAP</code></a> 是创建一个新的集群，那么 PG_PROVISION 就是在集群中创建默认的对象，包括：</p><ul><li><a href=/docs/concept/sec/ac/#%E9%BB%98%E8%AE%A4%E8%A7%92%E8%89%B2%E4%B8%8E%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7>默认角色</a></li><li><a href=/docs/concept/sec/ac/#%E9%BB%98%E8%AE%A4%E8%A7%92%E8%89%B2%E4%B8%8E%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7>默认用户</a></li><li><a href=/docs/concept/sec/ac/#%E9%BB%98%E8%AE%A4%E6%9D%83%E9%99%90%E7%AD%96%E7%95%A5>默认权限</a></li><li><a href=/docs/pgsql/config/hba#pg_default_hba_rules>默认HBA规则</a></li><li>默认模式</li><li>默认扩展</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_provision</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 在引导后提供postgres集群</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_init</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-init                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 集群模板的初始化脚本，默认为`pg-init`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># postgres集群中的默认角色和用户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readonly  ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-only access     }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_offline   ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for restricted read-only access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readwrite ,login: false ,roles: [dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-write access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin     ,login: false ,roles: [pg_monitor, dbrole_readwrite] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true  ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator ,replication: true  ,roles: [pg_monitor, dbrole_readonly] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor ,roles: [pg_monitor, dbrole_readonly] ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_privileges</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 管理员用户创建时的默认权限</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT INSERT     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT DELETE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRUNCATE   ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT REFERENCES ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRIGGER    ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT CREATE     ON SCHEMAS   TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_schemas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor ]  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 默认模式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 默认扩展</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_stat_statements ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgstattuple        ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_buffercache     ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pageinspect        ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_prewarm         ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_visibility      ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_freespacemap    ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres_fdw       ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: file_fdw           ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: btree_gist         ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: btree_gin          ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_trgm            ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: intagg             ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: intarray           ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_repack }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_reload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># HBA变化后是否重载配置？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># postgres 默认 HBA 规则集，按 order 排序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: local     ,auth: ident ,title: &#39;dbsu access via local os user ident&#39;  ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: local     ,auth: ident ,title: &#39;dbsu replication from local os ident&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: localhost ,auth: pwd   ,title: &#39;replicator replication from localhost&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: intra     ,auth: pwd   ,title: &#39;replicator replication from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: postgres    ,addr: intra     ,auth: pwd   ,title: &#39;replicator postgres db from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;monitor from localhost with password&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: pwd   ,title: &#39;monitor from infra host with password&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: ssl   ,title: &#39;admin @ infra nodes with pwd &amp; ssl&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>450</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: ssl   ,title: &#39;admin @ everywhere with ssl &amp; pwd&#39;    ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: localhost ,auth: pwd   ,title: &#39;pgbouncer read/write via local socket&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>550</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;read/write biz user via password&#39;     ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>600</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39; ,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;allow etl offline tasks from intranet&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>650</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgb_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># pgbouncer 默认 HBA 规则集，按 order 排序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: local     ,auth: peer  ,title: &#39;dbsu local admin access with os ident&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;allow all user local access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: intra     ,auth: pwd   ,title: &#39;monitor access via intranet with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other monitor access addr&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;admin access via intranet with pwd&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other admin access addr&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;allow all user intra access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_provision-1><code>pg_provision</code></h3><p>参数名称： <code>pg_provision</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>在集群拉起后，完整本节定义的 PostgreSQL 集群置备工作。默认值为<code>true</code>。</p><p>如果禁用，不会置备 PostgreSQL 集群。对于一些特殊的 &ldquo;PostgreSQL&rdquo; 集群，比如 Greenplum，可以关闭此选项跳过置备阶段。</p><h3 id=pg_init><code>pg_init</code></h3><p>参数名称： <code>pg_init</code>， 类型： <code>string</code>， 层次：<code>G/C</code></p><p>用于初始化数据库模板的Shell脚本位置，默认为 <code>pg-init</code>，该脚本会被拷贝至<code>/pg/bin/pg-init</code>后执行。</p><p>该脚本位于 <a href=https://github.com/Vonng/pigsty/blob/main/roles/pgsql/templates/pg-init><code>roles/pgsql/templates/pg-init</code></a></p><p>你可以在该脚本中添加自己的逻辑，或者提供一个新的脚本放置在 <code>templates/</code> 目录下，并将 <code>pg_init</code> 设置为新的脚本名称。使用自定义脚本时请保留现有的初始化逻辑。</p><h3 id=pg_default_roles><code>pg_default_roles</code></h3><p>参数名称： <code>pg_default_roles</code>， 类型： <code>role[]</code>， 层次：<code>G/C</code></p><p>Postgres 集群中的默认角色和用户。</p><p>Pigsty有一个内置的角色系统，请查看 <a href=/docs/concept/sec/ac/#%E5%9B%9B%E5%B1%82%E8%A7%92%E8%89%B2%E6%A8%A1%E5%9E%8B>PGSQL访问控制：角色系统</a> 了解详情。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># postgres集群中的默认角色和用户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readonly  ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-only access     }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_offline   ,login: false ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for restricted read-only access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_readwrite ,login: false ,roles: [dbrole_readonly]               ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for global read-write access }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbrole_admin     ,login: false ,roles: [pg_monitor, dbrole_readwrite]  ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>role for object creation }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true                                          ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator ,replication: true  ,roles: [pg_monitor, dbrole_readonly]   ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor   ,roles: [pg_monitor, dbrole_readonly] ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_default_privileges><code>pg_default_privileges</code></h3><p>参数名称： <code>pg_default_privileges</code>， 类型： <code>string[]</code>， 层次：<code>G/C</code></p><p>每个数据库中的默认权限（<code>DEFAULT PRIVILEGE</code>）设置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_privileges</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 管理员用户创建时的默认权限</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_readonly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SCHEMAS   TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON TABLES    TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT SELECT     ON SEQUENCES TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT EXECUTE    ON FUNCTIONS TO dbrole_offline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT INSERT     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT DELETE     ON TABLES    TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT USAGE      ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT UPDATE     ON SEQUENCES TO dbrole_readwrite</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRUNCATE   ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT REFERENCES ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT TRIGGER    ON TABLES    TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>GRANT CREATE     ON SCHEMAS   TO dbrole_admin</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty 基于默认角色系统提供了相应的默认权限设置，请查看 <a href=/docs/concept/sec/ac/#%E9%BB%98%E8%AE%A4%E6%9D%83%E9%99%90%E7%AD%96%E7%95%A5>PGSQL访问控制：权限</a> 了解详情。</p><h3 id=pg_default_schemas><code>pg_default_schemas</code></h3><p>参数名称： <code>pg_default_schemas</code>， 类型： <code>string[]</code>， 层次：<code>G/C</code></p><p>要创建的默认模式，默认值为：<code>[ monitor ]</code>，这将在所有数据库上创建一个<code>monitor</code>模式，用于放置各种监控扩展、表、视图、函数。</p><h3 id=pg_default_extensions><code>pg_default_extensions</code></h3><p>参数名称： <code>pg_default_extensions</code>， 类型： <code>extension[]</code>， 层次：<code>G/C</code></p><p>要在所有数据库中默认创建启用的扩展列表，默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_extensions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default extensions to be created</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_stat_statements ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pgstattuple        ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_buffercache     ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pageinspect        ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_prewarm         ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_visibility      ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_freespacemap    ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>monitor }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres_fdw       ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: file_fdw           ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: btree_gist         ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: btree_gin          ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: pg_trgm            ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: intagg             ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: intarray           ,schema</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>public  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_repack }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>唯一的三方扩展是 <code>pg_repack</code>，这对于数据库维护很重要，所有其他扩展都是内置的 PostgreSQL Contrib 扩展插件。</p><p>监控相关的扩展默认安装在 <code>monitor</code> 模式中，该模式由 <a href=#pg_default_schemas><code>pg_default_schemas</code></a> 创建。</p><h3 id=pg_reload><code>pg_reload</code></h3><p>参数名称： <code>pg_reload</code>， 类型： <code>bool</code>， 层次：<code>A</code></p><p>在hba更改后重新加载 PostgreSQL，默认值为<code>true</code></p><p>当您想在应用HBA更改之前进行检查时，将其设置为<code>false</code>以禁用自动重新加载配置。</p><h3 id=pg_default_hba_rules><code>pg_default_hba_rules</code></h3><p>参数名称： <code>pg_default_hba_rules</code>， 类型： <code>hba[]</code>， 层次：<code>G/C</code></p><p>PostgreSQL 基于主机的认证规则，全局默认规则定义。默认值为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># postgres default host-based authentication rules, order by `order`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: local     ,auth: ident ,title: &#39;dbsu access via local os user ident&#39;  ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: local     ,auth: ident ,title: &#39;dbsu replication from local os ident&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: localhost ,auth: pwd   ,title: &#39;replicator replication from localhost&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: replication ,addr: intra     ,auth: pwd   ,title: &#39;replicator replication from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${repl}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: postgres    ,addr: intra     ,auth: pwd   ,title: &#39;replicator postgres db from intranet&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;monitor from localhost with password&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: pwd   ,title: &#39;monitor from infra host with password&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: infra     ,auth: ssl   ,title: &#39;admin @ infra nodes with pwd &amp; ssl&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>450</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: ssl   ,title: &#39;admin @ everywhere with ssl &amp; pwd&#39;    ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>500</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: localhost ,auth: pwd   ,title: &#39;pgbouncer read/write via local socket&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>550</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_readonly&#39;,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;read/write biz user via password&#39;     ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>600</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;+dbrole_offline&#39; ,db: all    ,addr: intra     ,auth: pwd   ,title: &#39;allow etl offline tasks from intranet&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>650</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认值为常见场景提供了足够的安全级别，请查看 <a href=/docs/pgsql/config/hba>PGSQL身份验证</a> 了解详情。</p><p>本参数为 <a href=/docs/pgsql/config/hba#%E8%A7%84%E5%88%99%E5%AD%97%E6%AE%B5>HBA</a> 规则对象组成的数组，在形式上与 <a href=#pg_hba_rules><code>pg_hba_rules</code></a> 完全一致。
建议在全局配置统一的 <a href=#pg_default_hba_rules><code>pg_default_hba_rules</code></a>，针对特定集群使用 <a href=#pg_hba_rules><code>pg_hba_rules</code></a> 进行额外定制。两个参数中的规则都会依次应用，后者优先级更高。</p><h3 id=pgb_default_hba_rules><code>pgb_default_hba_rules</code></h3><p>参数名称： <code>pgb_default_hba_rules</code>， 类型： <code>hba[]</code>， 层次：<code>G/C</code></p><p>pgbouncer default host-based authentication rules, array or <a href=/docs/pgsql/config/hba#%E8%A7%84%E5%88%99%E5%AD%97%E6%AE%B5>hba</a> rule object.</p><p>default value provides a fair enough security level for common scenarios, check <a href=/docs/pgsql/config/hba>PGSQL Authentication</a> for details.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgb_default_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># pgbouncer default host-based authentication rules, order by `order`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${dbsu}&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: local     ,auth: peer  ,title: &#39;dbsu local admin access with os ident&#39;,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: localhost ,auth: pwd   ,title: &#39;allow all user local access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>150</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: pgbouncer   ,addr: intra     ,auth: pwd   ,title: &#39;monitor access via intranet with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${monitor}&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other monitor access addr&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>250</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;admin access via intranet with pwd&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>300</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${admin}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,db: all         ,addr: world     ,auth: deny  ,title: &#39;reject all other admin access addr&#39;   ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>350</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#204a87;font-weight:700>user: &#39;all&#39;        ,db: all         ,addr: intra     ,auth: pwd   ,title: &#39;allow all user intra access with pwd&#39; ,order</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>400</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认的Pgbouncer HBA规则很简单：</p><ol><li>允许从<strong>本地</strong>使用密码登陆</li><li>允许从内网网断使用密码登陆</li></ol><p>用户可以按照自己的需求进行定制。</p><p>本参数在形式上与 <a href=#pgb_hba_rules><code>pgb_hba_rules</code></a> 完全一致，建议在全局配置统一的 <a href=#pgb_default_hba_rules><code>pgb_default_hba_rules</code></a>，针对特定集群使用 <a href=#pgb_hba_rules><code>pgb_hba_rules</code></a> 进行额外定制。两个参数中的规则都会依次应用，后者优先级更高。</p><hr><h2 id=pg_backup><code>PG_BACKUP</code></h2><p>本节定义了用于 <a href=https://pgbackrest.org/>pgBackRest</a> 的变量，它被用于 PGSQL 时间点恢复 PITR 。</p><p>查看 <a href=/docs/pgsql/tutorial/pitr>PGSQL 备份 & PITR</a> 以获取详细信息。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># 在 pgsql 主机上启用 pgBackRest 吗？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_log_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/log/pgbackrest</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 日志目录，默认为 `/pg/log/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 仓库方法：local, minio, [用户定义...]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_init_backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># pgbackrest 初始化完成后是否立即执行全量备份？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># pgbackrest 仓库：https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># 默认使用本地 posix 文件系统的 pgbackrest 仓库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 本地备份目录，默认为 `/pg/backup`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 按计数保留完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 使用本地文件系统仓库时，最多保留 3 个完整备份，至少保留 2 个</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># pgbackrest 的可选 minio 仓库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 是与 s3 兼容的，所以使用 s3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 端点域名，默认为 `sss.pigsty`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 区域，默认为 us-east-1，对 minio 无效</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 桶名称，默认为 `pgsql`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 的 minio 用户访问密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Backup </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 的 minio 用户秘密密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对 minio 使用路径风格的 uri，而不是主机风格</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 备份路径，默认为 `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio 端口，默认为 9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/pki/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca 文件路径，默认为 `/etc/pki/ca.crt`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>block</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 启用块级增量备份（pgBackRest 2.46+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 将小文件打包成一个文件</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20MiB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对象存储文件打包阈值，默认 20MiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>128MiB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对象存储文件打包目标大小，默认 128MiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 为远程备份仓库启用 AES 加密</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES 加密密码，默认为 &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 在 minio 仓库上按时间保留完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 保留过去 14 天的完整备份</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pgbackrest_enabled><code>pgbackrest_enabled</code></h3><p>参数名称： <code>pgbackrest_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否在 PGSQL 节点上启用 pgBackRest？默认值为： <code>true</code></p><p>在使用本地文件系统备份仓库（<code>local</code>）时，只有集群主库才会真正启用 <code>pgbackrest</code>。其他实例只会初始化一个空仓库。</p><h3 id=pgbackrest_log_dir><code>pgbackrest_log_dir</code></h3><p>参数名称： <code>pgbackrest_log_dir</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>pgBackRest 日志目录，默认为 <code>/pg/log/pgbackrest</code>，Vector 日志代理会引用此参数收集日志。</p><h3 id=pgbackrest_method><code>pgbackrest_method</code></h3><p>参数名称： <code>pgbackrest_method</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>pgBackRest 仓库方法：默认可选项为：<code>local</code>、<code>minio</code> 或其他用户定义的方法，默认为 <code>local</code>。</p><p>此参数用于确定用于 pgBackRest 的仓库，所有可用的仓库方法都在 <a href=#pgbackrest_repo><code>pgbackrest_repo</code></a> 中定义。</p><p>Pigsty 默认使用 <code>local</code> 备份仓库，这将在主实例的 <code>/pg/backup</code> 目录上创建一个备份仓库。底层存储路径由 <a href=#pg_fs_backup><code>pg_fs_backup</code></a> 指定。</p><h3 id=pgbackrest_init_backup><code>pgbackrest_init_backup</code></h3><p>参数名称： <code>pgbackrest_init_backup</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>在 pgBackRest 初始化完成后是否立即执行一次全量备份？默认为 <code>true</code>。</p><p>此操作仅在集群主库（primary）且非级联从库（无 <a href=#pg_upstream><code>pg_upstream</code></a> 定义）时执行。启用此参数可以确保在集群初始化后立即拥有一个基础备份，以便在需要时进行恢复。</p><h3 id=pgbackrest_repo><code>pgbackrest_repo</code></h3><p>参数名称： <code>pgbackrest_repo</code>， 类型： <code>dict</code>， 层次：<code>G/C</code></p><p>pgBackRest 仓库文档：https://pgbackrest.org/configuration.html#section-repository</p><p>默认值包括两种仓库方法：<code>local</code> 和 <code>minio</code>，定义如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># pgbackrest 仓库：https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># 默认使用本地 posix 文件系统的 pgbackrest 仓库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 本地备份目录，默认为 `/pg/backup`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 按计数保留完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 使用本地文件系统仓库时，最多保留 3 个完整备份，至少保留 2 个</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># pgbackrest 的可选 minio 仓库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 是与 s3 兼容的，所以使用 s3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 端点域名，默认为 `sss.pigsty`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 区域，默认为 us-east-1，对 minio 无效</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 桶名称，默认为 `pgsql`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 的 minio 用户访问密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Backup </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 的 minio 用户秘密密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对 minio 使用路径风格的 uri，而不是主机风格</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 备份路径，默认为 `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio 端口，默认为 9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/pki/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca 文件路径，默认为 `/etc/pki/ca.crt`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>block</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 启用块级增量备份（pgBackRest 2.46+）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 将小文件打包成一个文件</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20MiB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对象存储文件打包阈值，默认 20MiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>128MiB          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 对象存储文件打包目标大小，默认 128MiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 为远程备份仓库启用 AES 加密</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES 加密密码，默认为 &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 在 minio 仓库上按时间保留完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 保留过去 14 天的完整备份</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>您可以定义新的备份仓库，例如使用 AWS S3，GCP 或其他云供应商的 S3 兼容存储服务。</p><p><strong>块级增量备份 (Block Incremental Backup)</strong>：从 pgBackRest 2.46 版本开始支持 <code>block: y</code> 选项，可以实现块级增量备份。
这意味着在增量备份时，pgBackRest 只会备份发生变化的数据块，而不是整个变化的文件，从而大幅减少备份数据量和备份时间。
此功能对于大型数据库特别有用，建议在对象存储仓库上启用此选项。</p><hr><h2 id=pg_access><code>PG_ACCESS</code></h2><p>本节负责数据库访问路径，包括：</p><ul><li>在每个 PGSQL 节点上部署 Pgbouncer 连接池并设定默认行为</li><li>通过本地或专用 haproxy 节点发布服务端口</li><li>绑定可选的 L2 VIP、注册 DNS 记录</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># if disabled, pgbouncer will not be launched on pgsql host</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6432</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># pgbouncer listen port, 6432 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_log_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/log/pgbouncer </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbouncer log dir, `/pg/log/pgbouncer` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_auth_query</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># query postgres to retrieve unlisted business users?</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_poolmode: transaction   # pooling mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>transaction,session,statement, transaction by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_sslmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disable       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbouncer client ssl mode, disable by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_ignore_param</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>extra_float_digits, application_name, TimeZone, DateStyle, IntervalStyle, search_path ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic>#INSTANCE # relative load balance weight in service, 100 by default, 0-255</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_service_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># dedicate haproxy node group name, or empty string for local nodes by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_service_dest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbouncer</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># default service destination if svc.dest=&#39;default&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># postgres default service definitions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: primary ,port: 5433 ,dest: default  ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replica ,port: 5434 ,dest: default  ,check: /read-only ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary` || pg_role == `offline` ]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: default ,port: 5436 ,dest: postgres ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: offline ,port: 5438 ,dest: postgres ,check: /replica   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `offline` || pg_offline_query ]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `replica` &amp;&amp; !pg_offline_query]&#34;</span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># enable a l2 vip for pgsql primary? false by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>127.0.0.1</span><span style=color:#000>/24     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># vip address in `&lt;ipv4&gt;/&lt;mask&gt;` format, require if vip is enabled</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth0           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># vip network interface to listen, eth0 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dns_suffix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># pgsql dns suffix, &#39;&#39; by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_dns_target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>auto              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># auto, primary, vip, none, or ad hoc ip</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pgbouncer_enabled><code>pgbouncer_enabled</code></h3><p>参数名称： <code>pgbouncer_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>默认值为 <code>true</code>，如果禁用，将不会在 <a href=/docs/concept/arch/node#pgsql%E8%8A%82%E7%82%B9><strong>PGSQL节点</strong></a> 上配置连接池 Pgbouncer。</p><h3 id=pgbouncer_port><code>pgbouncer_port</code></h3><p>参数名称： <code>pgbouncer_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>Pgbouncer 监听端口，默认为 <code>6432</code>。</p><h3 id=pgbouncer_log_dir><code>pgbouncer_log_dir</code></h3><p>参数名称： <code>pgbouncer_log_dir</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>Pgbouncer 日志目录，默认为 <code>/pg/log/pgbouncer</code>，Vector 日志代理会根据此参数收集 Pgbouncer 日志。</p><h3 id=pgbouncer_auth_query><code>pgbouncer_auth_query</code></h3><p>参数名称： <code>pgbouncer_auth_query</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否允许 Pgbouncer 查询 PostgreSQL，以允许未显式列出的用户通过连接池访问 PostgreSQL？默认值是 <code>false</code>。</p><p>如果启用，pgbouncer 用户将使用 <code>SELECT username, password FROM monitor.pgbouncer_auth($1)</code> 对 postgres 数据库进行身份验证，否则，只有带有 <code>pgbouncer: true</code> 的业务用户才被允许连接到 Pgbouncer 连接池。</p><h3 id=pgbouncer_poolmode><code>pgbouncer_poolmode</code></h3><p>参数名称： <code>pgbouncer_poolmode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Pgbouncer 连接池池化模式：<code>transaction</code>,<code>session</code>,<code>statement</code>，默认为 <code>transaction</code>。</p><ul><li><code>session</code>：会话级池化，具有最佳的功能兼容性。</li><li><code>transaction</code>：事务级池化，具有更好的性能（许多小连接），可能会破坏某些会话级特性，如<code>NOTIFY/LISTEN</code> 等&mldr;</li><li><code>statements</code>：语句级池化，用于简单的只读查询。</li></ul><p>如果您的应用出现功能兼容性问题，可以考虑修改此参数为 <code>session</code>。</p><h3 id=pgbouncer_sslmode><code>pgbouncer_sslmode</code></h3><p>参数名称： <code>pgbouncer_sslmode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Pgbouncer 客户端 ssl 模式，默认为 <code>disable</code>。</p><p>注意，启用 SSL 可能会对你的 pgbouncer 产生巨大的性能影响。</p><ul><li><code>disable</code>：如果客户端请求 TLS 则忽略（默认）</li><li><code>allow</code>：如果客户端请求 TLS 则使用。如果没有则使用纯TCP。不验证客户端证书。</li><li><code>prefer</code>：与 allow 相同。</li><li><code>require</code>：客户端必须使用 TLS。如果没有则拒绝客户端连接。不验证客户端证书。</li><li><code>verify-ca</code>：客户端必须使用有效的客户端证书的TLS。</li><li><code>verify-full</code>：与 verify-ca 相同。</li></ul><h3 id=pgbouncer_ignore_param><code>pgbouncer_ignore_param</code></h3><p>参数名称： <code>pgbouncer_ignore_param</code>， 类型： <code>string[]</code>， 层次：<code>C</code></p><p>PgBouncer 忽略的启动参数列表，默认值为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>extra_float_digits, application_name, TimeZone, DateStyle, IntervalStyle, search_path ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>这些参数会被配置到 PgBouncer 配置文件中的 <code>ignore_startup_parameters</code> 选项。当客户端连接时设置这些参数时，PgBouncer 不会因为连接池中的连接参数不匹配而创建新的连接。</p><p>这允许不同的客户端使用相同的连接池，即使它们设置了不同的这些参数值。此参数在 Pigsty v3.5 中新增。</p><hr><h3 id=pg_weight><code>pg_weight</code></h3><p>参数名称： <code>pg_weight</code>， 类型： <code>int</code>， 层次：<code>I</code></p><p>服务中的相对负载均衡权重，默认为100，范围0-255。</p><p>默认值： <code>100</code>。您必须在实例变量中定义它，并 <a href=/docs/pgsql/admin/cluster#%E5%88%B7%E6%96%B0%E6%9C%8D%E5%8A%A1>重载服务</a> 以生效。</p><h3 id=pg_service_provider><code>pg_service_provider</code></h3><p>参数名称： <code>pg_service_provider</code>， 类型： <code>string</code>， 层次：<code>G/C</code></p><p>专用的haproxy节点组名，或默认为本地节点的空字符串。</p><p>如果指定，PostgreSQL服务将注册到专用的haproxy节点组，而不是当下的 PGSQL 集群节点。</p><p>请记住为每个服务在专用的 haproxy 节点上分配<strong>唯一</strong>的端口！</p><p>例如，如果我们在3节点的 <code>pg-test</code> 集群上定义以下参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_service_provider</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use load balancer on group `infra`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># alloc port 10001 and 10002 for pg-test primary/replica service  </span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: primary ,port: 10001 ,dest: postgres  ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replica ,port: 10002 ,dest: postgres  ,check: /read-only ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary` || pg_role == `offline` ]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_default_service_dest><code>pg_default_service_dest</code></h3><p>参数名称： <code>pg_default_service_dest</code>， 类型： <code>enum</code>， 层次：<code>G/C</code></p><p>当定义一个 <a href=/docs/pgsql/service#%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1>服务</a> 时，如果 <code>svc.dest='default'</code>，此参数将用作默认值。</p><p>默认值： <code>pgbouncer</code>，意味着5433主服务和5434副本服务将默认将流量路由到 pgbouncer。</p><p>如果您不想使用pgbouncer，将其设置为<code>postgres</code>。流量将直接路由到 postgres。</p><h3 id=pg_default_services><code>pg_default_services</code></h3><p>参数名称： <code>pg_default_services</code>， 类型： <code>service[]</code>， 层次：<code>G/C</code></p><p>postgres默认服务定义</p><p>默认值是四个默认服务定义，如 <a href=/docs/pgsql/service/#%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0>PGSQL Service</a> 所述</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_default_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># postgres default service definitions</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: primary ,port: 5433 ,dest: default  ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replica ,port: 5434 ,dest: default  ,check: /read-only ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `primary` || pg_role == `offline` ]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: default ,port: 5436 ,dest: postgres ,check: /primary   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[]&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: offline ,port: 5438 ,dest: postgres ,check: /replica   ,selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `offline` || pg_offline_query ]&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;[? pg_role == `replica` &amp;&amp; !pg_offline_query]&#34;</span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_vip_enabled><code>pg_vip_enabled</code></h3><p>参数名称： <code>pg_vip_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>为 PGSQL 集群启用 L2 VIP吗？默认值是<code>false</code>，表示不创建 L2 VIP。</p><p>启用 L2 VIP 后，会有一个 VIP 绑定在集群主实例节点上，由 <code>vip-manager</code> 管理，根据 <code>etcd</code> 中的数据进行判断。</p><p>L2 VIP只能在相同的L2网络中使用，这可能会对您的网络拓扑产生额外的限制。</p><h3 id=pg_vip_address><code>pg_vip_address</code></h3><p>参数名称： <code>pg_vip_address</code>， 类型： <code>cidr4</code>， 层次：<code>C</code></p><p>如果启用vip，则需要<code>&lt;ipv4>/&lt;mask></code>格式的vip地址。</p><p>默认值： <code>127.0.0.1/24</code>。这个值由两部分组成：<code>ipv4</code>和<code>mask</code>，用<code>/</code>分隔。</p><h3 id=pg_vip_interface><code>pg_vip_interface</code></h3><p>参数名称： <code>pg_vip_interface</code>， 类型： <code>string</code>， 层次：<code>C/I</code></p><p>vip network interface to listen, <code>eth0</code> by default.</p><p>L2 VIP 监听的网卡接口，默认为 <code>eth0</code>。</p><p>它应该是您节点的首要网卡名，即您在配置清单中使用的IP地址。</p><p>如果您的节点有多块名称不同的网卡，您可以在实例变量上进行覆盖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: replica ,pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth0 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role: primary ,pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role: replica ,pg_vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># 为这个集群启用L2 VIP，默认绑定到主实例</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pg_vip_address: 10.10.10.3/24 # L2网络CIDR: 10.10.10.0/24, vip地址</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># pg_vip_interface: eth1      # 如果您的节点有统一的接口，您可以在这里定义它</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_dns_suffix><code>pg_dns_suffix</code></h3><p>参数名称： <code>pg_dns_suffix</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>PostgreSQL DNS 名称后缀，默认为空字符串。</p><p>在默认情况下，PostgreQL 集群名会作为 DNS 域名注册到 Infra 节点的 <code>dnsmasq</code> 中对外提供解析。</p><p>您可以通过本参数指定一个域名后缀，这样会使用 <code>{{ pg_cluster }}{{ pg_dns_suffix }}</code> 作为集群 DNS 名称。</p><p>例如，如果您将 <code>pg_dns_suffix</code> 设置为 <code>.db.vip.company.tld</code>，那么 <code>pg-test</code> 的集群 DNS 名称将是 <code>pg-test.db.vip.company.tld</code></p><h3 id=pg_dns_target><code>pg_dns_target</code></h3><p>参数名称： <code>pg_dns_target</code>， 类型： <code>enum</code>， 层次：<code>C</code></p><p>Could be: <code>auto</code>, <code>primary</code>, <code>vip</code>, <code>none</code>, or an ad hoc ip address, which will be the target IP address of cluster DNS record.</p><p>default values: <code>auto</code> , which will bind to <code>pg_vip_address</code> if <code>pg_vip_enabled</code>, or fallback to cluster primary instance ip address.</p><ul><li><code>vip</code>: bind to <code>pg_vip_address</code></li><li><code>primary</code>: resolve to cluster primary instance ip address</li><li><code>auto</code>: resolve to <code>pg_vip_address</code> if <code>pg_vip_enabled</code>, or fallback to cluster primary instance ip address.</li><li><code>none</code>: do not bind to any ip address</li><li><code>&lt;ipv4></code>: bind to the given IP address</li></ul><p>可以是：<code>auto</code>、<code>primary</code>、<code>vip</code>、<code>none</code>或一个特定的IP地址，它将是集群DNS记录的解析目标IP地址。</p><p>默认值： <code>auto</code>，如果<code>pg_vip_enabled</code>，将绑定到<code>pg_vip_address</code>，否则会回退到集群主实例的 IP 地址。</p><ul><li><code>vip</code>：绑定到<code>pg_vip_address</code></li><li><code>primary</code>：解析为集群主实例IP地址</li><li><code>auto</code>：如果 <a href=#pg_vip_enabled><code>pg_vip_enabled</code></a>，解析为 <a href=#pg_vip_address><code>pg_vip_address</code></a>，或回退到集群主实例ip地址。</li><li><code>none</code>：不绑定到任何ip地址</li><li><code>&lt;ipv4></code>：绑定到指定的IP地址</li></ul><hr><h2 id=pg_monitor><code>PG_MONITOR</code></h2><p>PG_MONITOR 组的参数用于监控 PostgreSQL 数据库、Pgbouncer 连接池与 pgBackRest 备份系统的状态。</p><p>此参数组定义了三个 Exporter 的配置：<code>pg_exporter</code> 用于监控 PostgreSQL，<code>pgbouncer_exporter</code> 用于监控连接池，<code>pgbackrest_exporter</code> 用于监控备份状态。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 在 pgsql 主机上启用 pg_exporter 吗？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg_exporter.yml   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pg_exporter 配置文件名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_cache_ttls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;1,10,60,300&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># pg_exporter 收集器 ttl 阶段（秒），默认为 &#39;1,10,60,300&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9630</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># pg_exporter 监听端口，默认为 9630</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;sslmode=disable&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># pg_exporter dsn 的额外 url 参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 如果指定，将覆盖自动生成的 pg dsn</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_auto_discovery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 启用自动数据库发现？默认启用</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_exclude_database</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;template0,template1,postgres&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 在自动发现过程中不会被监控的数据库的 csv 列表</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_include_database</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 在自动发现过程中将被监控的数据库的 csv 列表</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_connect_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># pg_exporter 连接超时（毫秒），默认为 200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_exporter_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 覆盖 pg_exporter 的额外选项</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 在 pgsql 主机上启用 pgbouncer_exporter 吗？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9631</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># pgbouncer_exporter 监听端口，默认为 9631</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 如果指定，将覆盖自动生成的 pgbouncer dsn</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbouncer_exporter_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 覆盖 pgbouncer_exporter 的额外选项</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 在 pgsql 主机上启用 pgbackrest_exporter 吗？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9854</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># pgbackrest_exporter 监听端口，默认为 9854</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_exporter_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 覆盖 pgbackrest_exporter 的额外选项</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_exporter_enabled><code>pg_exporter_enabled</code></h3><p>参数名称： <code>pg_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否在 PGSQL 节点上启用 pg_exporter？默认值为：<code>true</code>。</p><p>PG Exporter 用于监控 PostgreSQL 数据库实例，如果不想安装 pg_exporter 可以设置为 <code>false</code>。</p><h3 id=pg_exporter_config><code>pg_exporter_config</code></h3><p>参数名称： <code>pg_exporter_config</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>pg_exporter 配置文件名，PG Exporter 和 PGBouncer Exporter 都会使用这个配置文件。默认值：<code>pg_exporter.yml</code>。</p><p>如果你想使用自定义配置文件，你可以在这里定义它。你的自定义配置文件应当放置于 <code>files/&lt;name>.yml</code>。</p><p>例如，当您希望监控一个远程的 PolarDB 数据库实例时，可以使用样例配置：<code>files/polar_exporter.yml</code>。</p><h3 id=pg_exporter_cache_ttls><code>pg_exporter_cache_ttls</code></h3><p>参数名称： <code>pg_exporter_cache_ttls</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>pg_exporter 收集器 TTL 阶梯（秒），默认为 &lsquo;1,10,60,300&rsquo;</p><p>默认值：<code>1,10,60,300</code>，它将为不同的度量收集器使用不同的TTL值： 1s, 10s, 60s, 300s。</p><p>PG Exporter 内置了缓存机制，避免多个 Prometheus 重复抓取对数据库产生不当影响，所有指标收集器按 TTL 分为四类：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>ttl_fast</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{{ pg_exporter_cache_ttls.split(&#39;,&#39;)[0]|int }}&#34;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># critical queries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ttl_norm</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{{ pg_exporter_cache_ttls.split(&#39;,&#39;)[1]|int }}&#34;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># common queries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ttl_slow</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{{ pg_exporter_cache_ttls.split(&#39;,&#39;)[2]|int }}&#34;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># slow queries (e.g table size)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ttl_slowest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{{ pg_exporter_cache_ttls.split(&#39;,&#39;)[3]|int }}&#34;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># ver slow queries (e.g bloat)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>例如，在默认配置下，存活类指标默认最多缓存 <code>1s</code>，大部分普通指标会缓存 <code>10s</code>（应当与监控抓取间隔 <a href=/docs/infra/param#vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></a> 相同）。
少量变化缓慢的查询会有 <code>60s</code> 的TTL，极个别大开销监控查询会有 <code>300s</code> 的TTL。</p><h3 id=pg_exporter_port><code>pg_exporter_port</code></h3><p>参数名称： <code>pg_exporter_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>pg_exporter 监听端口号，默认值为：<code>9630</code></p><h3 id=pg_exporter_params><code>pg_exporter_params</code></h3><p>参数名称： <code>pg_exporter_params</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>pg_exporter 所使用 DSN 中额外的 URL PATH 参数。</p><p>默认值：<code>sslmode=disable</code>，它将禁用用于监控连接的 SSL（因为默认使用本地 unix 套接字）。</p><h3 id=pg_exporter_url><code>pg_exporter_url</code></h3><p>参数名称： <code>pg_exporter_url</code>， 类型： <code>pgurl</code>， 层次：<code>C</code></p><p>如果指定了本参数，将会覆盖自动生成的 PostgreSQL DSN，使用指定的 DSN 连接 PostgreSQL 。默认值为空字符串。</p><p>如果没有指定此参数，PG Exporter 默认会使用以下的连接串访问 PostgreSQL ：</p><pre tabindex=0><code>postgres://{{ pg_monitor_username }}:{{ pg_monitor_password }}@{{ pg_host }}:{{ pg_port }}/postgres{% if pg_exporter_params != &#39;&#39; %}?{{ pg_exporter_params }}{% endif %}
</code></pre><p>当您想监控一个远程的 PostgreSQL 实例时，或者需要使用不同的监控用户/密码，配置选项时，可以使用这个参数。</p><h3 id=pg_exporter_auto_discovery><code>pg_exporter_auto_discovery</code></h3><p>参数名称： <code>pg_exporter_auto_discovery</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>启用自动数据库发现吗？ 默认启用：<code>true</code>。</p><p>PG Exporter 默认会连接到 DSN 中指定的数据库 （默认为管理数据库 <code>postgres</code>） 收集全局指标，如果您希望收集所有业务数据库的指标，可以开启此选项。
PG Exporter 会自动发现目标 PostgreSQL 实例中的所有数据库，并在这些数据库中收集 <strong>库级监控指标</strong>。</p><h3 id=pg_exporter_exclude_database><code>pg_exporter_exclude_database</code></h3><p>参数名称： <code>pg_exporter_exclude_database</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>如果启用了数据库自动发现（默认启用），在这个参数指定的列表中的数据库将不会被监控。
默认值为： <code>template0,template1,postgres</code>，即管理数据库 <code>postgres</code> 与模板数据库会被排除在自动监控的数据库之外。</p><p>作为例外，DSN 中指定的数据库不受此参数影响，例如，PG Exporter 如果连接的是 <code>postgres</code> 数据库，那么即使 <code>postgres</code> 在此列表中，也会被监控。</p><h3 id=pg_exporter_include_database><code>pg_exporter_include_database</code></h3><p>参数名称： <code>pg_exporter_include_database</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>如果启用了数据库自动发现（默认启用），在这个参数指定的列表中的数据库才会被监控。默认值为空字符串，即不启用此功能。</p><p>参数的形式是由逗号分隔的数据库名称列表，例如：<code>db1,db2,db3</code>。</p><p>此参数相对于 [<code>pg_exporter_exclude_database</code>] 有更高的优先级，相当于白名单模式。如果您只希望监控特定的数据库，可以使用此参数。</p><h3 id=pg_exporter_connect_timeout><code>pg_exporter_connect_timeout</code></h3><p>参数名称： <code>pg_exporter_connect_timeout</code>， 类型： <code>int</code>， 层次：<code>C</code></p><p>pg_exporter 连接超时（毫秒），默认为 <code>200</code> （单位毫秒）</p><p>当 PG Exporter 尝试连接到 PostgreSQL 数据库时，最多会等待多长时间？超过这个时间，PG Exporter 将会放弃连接并报错。</p><p>默认值 200毫秒 对于绝大多数场景（例如：同可用区监控）都是足够的，但是如果您监控的远程 PostgreSQL 位于另一个大洲，您可能需要增加此值以避免连接超时。</p><h3 id=pg_exporter_options><code>pg_exporter_options</code></h3><p>参数名称： <code>pg_exporter_options</code>， 类型： <code>arg</code>， 层次：<code>C</code></p><p>传给 PG Exporter 的命令行参数，默认值为：<code>""</code> 空字符串。</p><p>当使用空字符串时，会使用默认的命令参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>if</span> pg_exporter_port !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span> %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--web.listen-address=:{{ pg_exporter_port }} {{ pg_exporter_options }}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>else</span> %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--web.listen-address=:{{ pg_exporter_port }} --log.level=info&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% endif %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>注意，请不要在本参数中覆盖 <a href=#pg_exporter_port><code>pg_exporter_port</code></a> 的端口配置。</p><h3 id=pgbouncer_exporter_enabled><code>pgbouncer_exporter_enabled</code></h3><p>参数名称： <code>pgbouncer_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>在 PGSQL 节点上，是否启用 pgbouncer_exporter ？默认值为：<code>true</code>。</p><h3 id=pgbouncer_exporter_port><code>pgbouncer_exporter_port</code></h3><p>参数名称： <code>pgbouncer_exporter_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>pgbouncer_exporter 监听端口号，默认值为：<code>9631</code></p><h3 id=pgbouncer_exporter_url><code>pgbouncer_exporter_url</code></h3><p>参数名称： <code>pgbouncer_exporter_url</code>， 类型： <code>pgurl</code>， 层次：<code>C</code></p><p>如果指定了本参数，将会覆盖自动生成的 pgbouncer DSN，使用指定的 DSN 连接 pgbouncer。默认值为空字符串。</p><p>如果没有指定此参数，Pgbouncer Exporter 默认会使用以下的连接串访问 Pgbouncer：</p><pre tabindex=0><code>postgres://{{ pg_monitor_username }}:{{ pg_monitor_password }}@:{{ pgbouncer_port }}/pgbouncer?host={{ pg_localhost }}&amp;sslmode=disable
</code></pre><p>当您想监控一个远程的 Pgbouncer 实例时，或者需要使用不同的监控用户/密码，配置选项时，可以使用这个参数。</p><h3 id=pgbouncer_exporter_options><code>pgbouncer_exporter_options</code></h3><p>参数名称： <code>pgbouncer_exporter_options</code>， 类型： <code>arg</code>， 层次：<code>C</code></p><p>传给 Pgbouncer Exporter 的命令行参数，默认值为：<code>""</code> 空字符串。</p><p>当使用空字符串时，会使用默认的命令参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>if</span> pgbouncer_exporter_options !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span> %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--web.listen-address=:{{ pgbouncer_exporter_port }} {{ pgbouncer_exporter_options }}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>else</span> %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_EXPORTER_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;--web.listen-address=:{{ pgbouncer_exporter_port }} --log.level=info&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>% endif %<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>注意，请不要在本参数中覆盖 <a href=#pgbouncer_exporter_port><code>pgbouncer_exporter_port</code></a> 的端口配置。</p><h3 id=pgbackrest_exporter_enabled><code>pgbackrest_exporter_enabled</code></h3><p>参数名称： <code>pgbackrest_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p><p>是否在 PGSQL 节点上启用 pgbackrest_exporter？默认值为：<code>true</code>。</p><p>pgbackrest_exporter 用于监控 pgBackRest 备份系统的状态，包括备份的大小、时间、类型、持续时长等关键指标。</p><h3 id=pgbackrest_exporter_port><code>pgbackrest_exporter_port</code></h3><p>参数名称： <code>pgbackrest_exporter_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>pgbackrest_exporter 监听端口号，默认值为：<code>9854</code>。</p><p>此端口需要在 Prometheus 服务发现配置中引用，用于抓取备份相关的监控指标。</p><h3 id=pgbackrest_exporter_options><code>pgbackrest_exporter_options</code></h3><p>参数名称： <code>pgbackrest_exporter_options</code>， 类型： <code>arg</code>， 层次：<code>C</code></p><p>传给 pgbackrest_exporter 的命令行参数，默认值为：<code>""</code> 空字符串。</p><p>当使用空字符串时，会使用默认的命令参数配置。您可以在此指定额外的参数选项来调整 exporter 的行为。</p><hr><h2 id=pg_remove><code>PG_REMOVE</code></h2><p><a href=/docs/pgsql/playbook#pgsql-rmyml><code>pgsql-rm.yml</code></a> 会调用 <code>pg_remove</code> 角色来安全地移除 PostgreSQL 实例。本节参数用于控制清理行为，避免误删。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rm_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># remove postgres data during remove? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rm_backup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># remove pgbackrest backup during primary remove? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_rm_pkg</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># uninstall postgres packages during remove? true by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># stop pg_remove running if pg_safeguard is enabled, false by default</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=pg_rm_data><code>pg_rm_data</code></h3><p>参数名称： <code>pg_rm_data</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>删除 PGSQL 实例时是否清理 <a href=#pg_data><code>pg_data</code></a> 以及软链，默认值 <code>true</code>。</p><p>该开关既影响 <code>pgsql-rm.yml</code>，也影响其他触发 <code>pg_remove</code> 的场景。设为 <code>false</code> 可以保留数据目录，便于手动检查或重新挂载。</p><h3 id=pg_rm_backup><code>pg_rm_backup</code></h3><p>参数名称： <code>pg_rm_backup</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>删除主库时是否一并清理 pgBackRest 仓库与配置，默认值 <code>true</code>。</p><p>该参数仅对 <code>pg_role=primary</code> 的主实例生效：<code>pg_remove</code> 会先停止 pgBackRest、删除当前集群的 stanza，并在 <code>pgbackrest_method == 'local'</code> 时移除 <a href=#pg_fs_backup><code>pg_fs_backup</code></a> 中的数据。备用集群或上游备份不会受到影响。</p><h3 id=pg_rm_pkg><code>pg_rm_pkg</code></h3><p>参数名称： <code>pg_rm_pkg</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>在清理 PGSQL 实例时是否卸载 <a href=#pg_packages><code>pg_packages</code></a> 安装的所有软件包，默认值 <code>true</code>。</p><p>如果只想暂时停机并保留二进制文件，可将其设为 <code>false</code>，否则 <code>pg_remove</code> 会调用系统包管理器彻底卸载 PostgreSQL 相关组件。</p><h3 id=pg_safeguard><code>pg_safeguard</code></h3><p>参数名称： <code>pg_safeguard</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>防误删保险，默认值为 <code>false</code>。当显式设置为 <code>true</code> 时，<code>pg_remove</code> 会立即终止并提示，必须使用 <code>-e pg_safeguard=false</code> 或在变量中关闭后才会继续。</p><p>建议在生产环境批量清理前先开启此开关，确认命令与目标节点无误后再解除，以避免误操作导致实例被删除。</p></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>