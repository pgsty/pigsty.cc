<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/pig/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/pig/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>PIG 包管理器 | PIGSTY</title><meta name=description content="PostgreSQL 扩展生态包管理器"><meta property="og:url" content="https://pigsty.cc/docs/pig/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="PIG 包管理器"><meta property="og:description" content="PostgreSQL 扩展生态包管理器"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="PIG 包管理器"><meta itemprop=description content="PostgreSQL 扩展生态包管理器"><meta itemprop=dateModified content="2026-02-12T23:41:54+08:00"><meta itemprop=wordCount content="178"><meta itemprop=keywords content="PIG"><meta name=twitter:card content="summary"><meta name=twitter:title content="PIG 包管理器"><meta name=twitter:description content="PostgreSQL 扩展生态包管理器"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/pig/>返回本页常规视图</a>.</p></div><h1 class=title>PIG 包管理器</h1><div class=lead>PostgreSQL 扩展生态包管理器</div><ul><li>1: <a href=#pg-045afba09315eeff77997f9807e743f8>上手</a></li><li>2: <a href=#pg-2e96076c3764e112eecf0b926837054b>简介</a></li><li>3: <a href=#pg-69af5501e65fc45d0fad0a48d3b90b48>安装</a></li><li>4: <a href=#pg-7992c175dfd135ebeeb79a8b42f8c996>版本</a></li><li>5: <a href=#pg-d37896a8eedd5fa7780c0840a941ee42>命令参考</a></li><li>6: <a href=#pg-4c25303eb196cdde39b80054ff3140e5>pig</a></li><li>7: <a href=#pg-0b34463beffbb6b4de1918e740bdc496>pig repo</a></li><li>8: <a href=#pg-64e9fc41b68abc137743c08861cd712e>pig ext</a></li><li>9: <a href=#pg-afe295f820847945a33f6ba709a26753>pig build</a></li><li>10: <a href=#pg-4f56b148399117cd1ee1067d3e359a50>pig sty</a></li><li>11: <a href=#pg-c1564ad605ae16c3505e326f8fac8171>pig postgres</a></li><li>12: <a href=#pg-8a4e12d310edfe7066367b6d57b2a3a6>pig patroni</a></li><li>13: <a href=#pg-2b6374792422c32fdc25e41897f5070e>pig pgbackrest</a></li><li>14: <a href=#pg-90fc61ecd98b3b848f30917622966cb5>pig pitr</a></li></ul><div class=content><p>—— <strong>Postgres Install Genius，PostgreSQL 生态中缺失的扩展包管理器</strong></p><p>PIG 包管理器是一个专门用于安装、管理、构建 PostgreSQL 及其扩展的命令行工具，使用 Go 开发，开箱即用，简单易用，小巧玲珑（4MB）。
PIG 包管理器并非重新发明的土鳖轮子，而是 <strong>依托</strong> （PiggyBack）现有 Linux 发行版包管理器 （<code>apt</code>/<code>dnf</code>）的一个高级抽象层。
它屏蔽了不同操作系统，不同芯片架构，以及不同 PG 大版本的管理差异，让您用简单的几行命令，就可以完成 PG 内核与 444+ 扩展的安装与管理。</p><p>PIG 的命令设计同样适合自动化脚本：提供统一的参数风格、清晰的错误提示，以及如 <code>--dry-run</code> 等安全开关。</p><p>请注意：对于扩展安装来说，<strong>pig 并非必须组件</strong>，您依然可以使用 apt / dnf 等包管理器直接访问 <a href=/docs/repo/pgsql/><strong>Pigsty PGSQL</strong></a> 仓库。</p><ul><li><a href=/docs/pig/intro/><strong>简介</strong></a>：为什么需要专用的 PG 包管理器？</li><li><a href=/docs/pig/start/><strong>上手</strong></a>：快速上手与样例</li><li><a href=/docs/pig/install/><strong>安装</strong></a>：下载、安装、更新 pig</li></ul><h2 id=快速上手>快速上手</h2><p>使用以下命令即可在您的系统上 <a href=/docs/pig/install/><strong>安装</strong></a> PIG 包管理器：</p><p><strong>默认安装</strong>（Cloudflare CDN）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p><strong>中国镜像</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>安装完成后，几行命令即可 <a href=/docs/pig/start/><strong>快速开始</strong></a> 。例如，若需安装 PG 18 与相应的 <a href=https://pgext.cloud/e/pg_duckdb><strong><code>pg_duckdb</code></strong></a> 扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig repo <span style=color:#204a87>set</span>                        <span style=color:#8f5902;font-style:italic># 一次性设置好 Linux, Pigsty + PGDG 仓库（覆盖式！）</span>
</span></span><span style=display:flex><span>$ pig install pg18                    <span style=color:#8f5902;font-style:italic># 安装 PostgreSQL 18 内核（原生 PGDG 包）</span>
</span></span><span style=display:flex><span>$ pig install pg_duckdb -v <span style=color:#0000cf;font-weight:700>18</span>         <span style=color:#8f5902;font-style:italic># 安装 pg_duckdb 扩展（针对当前 pg 18）</span>
</span></span><span style=display:flex><span>$ pig install -y postgis timescaledb  <span style=color:#8f5902;font-style:italic># 针对当前活跃PG版本，安装多个扩展</span>
</span></span><span style=display:flex><span>$ pig install -y vector               <span style=color:#8f5902;font-style:italic># 您可以使用扩展名称（vector）或者扩展包名称（pgvector）来安装扩展！</span>
</span></span></code></pre></div><h2 id=命令参考>命令参考</h2><p>你可以执行 <code>pig help &lt;command></code> 获取子命令的详细帮助。</p><p><strong>扩展管理</strong>：</p><ul><li><a href=/docs/pig/repo/><strong>pig repo</strong></a>：管理 APT/YUM 软件仓库</li><li><a href=/docs/pig/ext/><strong>pig ext</strong></a>：管理 PostgreSQL 扩展</li><li><a href=/docs/pig/build/><strong>pig build</strong></a>：从源码构建扩展</li></ul><p><strong>Pigsty 管理</strong>：</p><ul><li><a href=/docs/pig/sty/><strong>pig sty</strong></a>：管理 Pigsty 安装</li><li><a href=/docs/pig/pg/><strong>pig postgres</strong></a>：管理本地 PostgreSQL 服务</li><li><a href=/docs/pig/pt/><strong>pig patroni</strong></a>：管理 Patroni HA 集群</li><li><a href=/docs/pig/pb/><strong>pig pgbackrest</strong></a>：管理 pgBackRest 备份</li><li><a href=/docs/pig/pitr/><strong>pig pitr</strong></a>：编排式时间点恢复</li></ul><h2 id=关于>关于</h2><p><code>pig</code> 命令行工具由 <a href=https://vonng.com/en/>Vonng</a>（冯若航 <a href=mailto:rh@vonng.com>rh@vonng.com</a>）开发，并以 <a href="https://github.com/pgsty/pig/?tab=Apache-2.0-1-ov-file#readme">Apache 2.0</a> 许可证开源。</p><p>您还可以参考 <a href=https://pgsty.com><strong>PIGSTY</strong></a> 项目，提供了包括扩展交付在内的完整 PostgreSQL RDS DBaaS 使用体验。</p><ul><li><a href=https://github.com/pgsty/pgext><strong>PGEXT</strong></a>：扩展数据与管理工具</li><li><a href=https://github.com/pgsty/pig><strong>PIG</strong></a>：PostgreSQL 包管理器</li><li><a href=https://github.com/pgsty/pigsty><strong>PIGSTY</strong></a>：开箱即用的 PostgreSQL 发行版</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-045afba09315eeff77997f9807e743f8>1 - 上手</h1><div class=lead>快速上手 pig，PostgreSQL 包管理器</div><p>下面是一个简单的上手教程，带您体验 PIG 包管理器的核心能力。</p><h2 id=简短版本>简短版本</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash   <span style=color:#8f5902;font-style:italic># 从 Cloudflare 安装 PIG</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>                                   <span style=color:#8f5902;font-style:italic># 一次性设置好 Linux, Pigsty + PGDG 仓库（覆盖式！）</span>
</span></span><span style=display:flex><span>pig install -v <span style=color:#0000cf;font-weight:700>18</span> -y pg18 pg_duckdb vector     <span style=color:#8f5902;font-style:italic># 安装 PG 18 内核，pg_duckdb, pgvector 扩展……</span>
</span></span></code></pre></div><h2 id=安装>安装</h2><p>您可以使用以下命令 <a href=/docs/pig/install/><strong>一键安装</strong></a> <code>pig</code>：</p><p><strong>中国大陆</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p><strong>全球网站</strong>（Cloudflare CDN）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>PIG 二进制包大约 4 MB，在 Linux 上会自动使用 <code>rpm</code> 或 <code>dpkg</code> 安装最新可用版本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -fsSL https://repo.pigsty.cc/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>kernel</span> <span style=color:#ce5c00;font-weight:700>=</span> Linux
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>=</span> x86_64
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>package</span> <span style=color:#ce5c00;font-weight:700>=</span> deb
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>pkg_url</span> <span style=color:#ce5c00;font-weight:700>=</span> https://repo.pigsty.cc/pkg/pig/v1.0.0/pig_1.0.0-1_amd64.deb
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>download</span> <span style=color:#ce5c00;font-weight:700>=</span> /tmp/pig_1.0.0-1_amd64.deb
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> downloading pig v1.0.0
</span></span><span style=display:flex><span>curl -fSL https://repo.pigsty.cc/pkg/pig/v1.0.0/pig_1.0.0-1_amd64.deb -o /tmp/pig_1.0.0-1_amd64.deb
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>######################################################################## 100.0%</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>md5sum</span> <span style=color:#ce5c00;font-weight:700>=</span> a543882aa905713a0c50088d4e848951b6957a37a1594d7e9f3fe46453d5ce66
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> installing: dpkg -i /tmp/pig_1.0.0-1_amd64.deb
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span>Reading database ... <span style=color:#0000cf;font-weight:700>166001</span> files and directories currently installed.<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>Preparing to unpack /tmp/pig_1.0.0-1_amd64.deb ...
</span></span><span style=display:flex><span>Unpacking pig <span style=color:#ce5c00;font-weight:700>(</span>1.0.0-1<span style=color:#ce5c00;font-weight:700>)</span> ...
</span></span><span style=display:flex><span>Setting up pig <span style=color:#ce5c00;font-weight:700>(</span>1.0.0-1<span style=color:#ce5c00;font-weight:700>)</span> ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>INFO<span style=color:#ce5c00;font-weight:700>]</span> pig v1.0.0 installed successfully
</span></span><span style=display:flex><span>check https://pgext.cloud <span style=color:#204a87;font-weight:700>for</span> details
</span></span></code></pre></div><h2 id=检查环境>检查环境</h2><p>PIG 是一个由 Go 编写的二进制程序，默认安装路径为 <code>/usr/bin/pig</code>，<code>pig version</code> 会打印版本信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig version
</span></span><span style=display:flex><span>pig version 1.0.0 linux/amd64
</span></span><span style=display:flex><span>build: HEAD dc8f343 2026-01-26T15:52:04Z
</span></span></code></pre></div><p>使用 <code>pig status</code> 命令，会打印当前环境的状态，操作系统代码，PG的安装情况，仓库的可访问性与延迟。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [Configuration] ================================</span>
</span></span><span style=display:flex><span>Pig Version      : 1.0.0
</span></span><span style=display:flex><span>Pig Config       : /home/vagrant/.pig/config.yml
</span></span><span style=display:flex><span>Log Level        : info
</span></span><span style=display:flex><span>Log Path         : stderr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [OS Environment] ===============================</span>
</span></span><span style=display:flex><span>OS Distro Code   : u24
</span></span><span style=display:flex><span>OS OSArch        : arm64
</span></span><span style=display:flex><span>OS Package Type  : deb
</span></span><span style=display:flex><span>OS Vendor ID     : ubuntu
</span></span><span style=display:flex><span>OS Version       : <span style=color:#0000cf;font-weight:700>24</span>
</span></span><span style=display:flex><span>OS Version Full  : 24.04
</span></span><span style=display:flex><span>OS Version Code  : noble
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [PG Environment] ===============================</span>
</span></span><span style=display:flex><span>Installed:
</span></span><span style=display:flex><span>- PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>  <span style=color:#0000cf;font-weight:700>398</span> Extensions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active:
</span></span><span style=display:flex><span>PG Version      :  PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>Config Path     :  /usr/bin/pg_config
</span></span><span style=display:flex><span>Binary Path     :  /usr/lib/postgresql/18/bin
</span></span><span style=display:flex><span>Library Path    :  /usr/lib/postgresql/18/lib
</span></span><span style=display:flex><span>Extension Path  :  /usr/share/postgresql/18/extension
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [Pigsty Environment] ===========================</span>
</span></span><span style=display:flex><span>Inventory Path   : Not Found
</span></span><span style=display:flex><span>Pigsty Home      : Not Found
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [Network Conditions] ===========================</span>
</span></span><span style=display:flex><span>pigsty.cc  ping ok: <span style=color:#0000cf;font-weight:700>802</span> ms
</span></span><span style=display:flex><span>pigsty.io  ping ok: <span style=color:#0000cf;font-weight:700>1410</span> ms
</span></span><span style=display:flex><span>Internet Access   :  <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>Pigsty Repo       :  pigsty.io
</span></span><span style=display:flex><span>Inferred Region   :  china
</span></span><span style=display:flex><span>Latest Pigsty Ver :  v4.1.0
</span></span></code></pre></div><h2 id=自动化建议>自动化建议</h2><p>对于生产环境恢复任务，建议先使用 <code>--dry-run</code> 预览 PITR 执行计划，再决定是否实际执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pitr -d --dry-run         <span style=color:#8f5902;font-style:italic># 仅预览恢复步骤，不执行</span>
</span></span><span style=display:flex><span>pig pitr -d -y                <span style=color:#8f5902;font-style:italic># 跳过确认（自动化场景）</span>
</span></span></code></pre></div><h2 id=列出扩展>列出扩展</h2><p>使用 <code>pig ext list</code> 命令，可以打印内置的 PG 扩展数据目录。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig ext list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Name                            Status              Version     Cate   Flags   License       Repo     PGVer  Package                               Description
</span></span><span style=display:flex><span>----                            ------              -------     ----   ------  -------       ------   -----  ------------                          ---------------------
</span></span><span style=display:flex><span>timescaledb                     installed  2.24.0      TIME   -dsl--  Timescale     PIGSTY   15-18  postgresql-18-timescaledb-tsl         Enables scalable inserts and complex queries <span style=color:#204a87;font-weight:700>for</span> time-series dat
</span></span><span style=display:flex><span>timescaledb_toolkit             installed  1.22.0      TIME   -ds-t-  Timescale     PIGSTY   15-18  postgresql-18-timescaledb-toolkit     Library of analytical hyperfunctions, time-series pipelining, an
</span></span><span style=display:flex><span>timeseries                      installed  0.2.0       TIME   -d----  PostgreSQL    PIGSTY   13-18  postgresql-18-pg-timeseries           Convenience API <span style=color:#204a87;font-weight:700>for</span> <span style=color:#204a87>time</span> series stack
</span></span><span style=display:flex><span>periods                         installed  1.2.3       TIME   -ds---  PostgreSQL    PGDG     13-18  postgresql-18-periods                 Provide Standard SQL functionality <span style=color:#204a87;font-weight:700>for</span> PERIODs and SYSTEM VERSIO
</span></span><span style=display:flex><span>temporal_tables                 installed  1.2.2       TIME   -ds--r  BSD 2-Clause  PIGSTY   13-18  postgresql-18-temporal-tables         temporal tables
</span></span><span style=display:flex><span>.........
</span></span><span style=display:flex><span>pg_fact_loader                  not avail  2.0.1       ETL    -ds--x  MIT           PGDG     13-17  postgresql-18-pg-fact-loader          build fact tables with Postgres
</span></span><span style=display:flex><span>pg_bulkload                     installed  3.1.23      ETL    bds---  BSD 3-Clause  PIGSTY   13-18  postgresql-18-pg-bulkload             pg_bulkload is a high speed data loading utility <span style=color:#204a87;font-weight:700>for</span> PostgreSQL
</span></span><span style=display:flex><span>test_decoding                   available  -           ETL    --s--x  PostgreSQL    CONTRIB  13-18  postgresql-18                         SQL-based test/example module <span style=color:#204a87;font-weight:700>for</span> WAL logical decoding
</span></span><span style=display:flex><span>pgoutput                        available  -           ETL    --s---  PostgreSQL    CONTRIB  13-18  postgresql-18                         Logical Replication output plugin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>450</span> Rows<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>Status: installed, available, not avail <span style=color:#000;font-weight:700>|</span> Flags: <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> HasBin, <span style=color:#000>d</span> <span style=color:#ce5c00;font-weight:700>=</span> HasDDL, <span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>=</span> HasLib, <span style=color:#000>l</span> <span style=color:#ce5c00;font-weight:700>=</span> NeedLoad, <span style=color:#000>t</span> <span style=color:#ce5c00;font-weight:700>=</span> Trusted, <span style=color:#000>r</span> <span style=color:#ce5c00;font-weight:700>=</span> Relocatable, <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> Unknown<span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>所有的扩展元数据都在一份名为 <a href=https://github.com/pgsty/pig/blob/main/cli/ext/assets/extension.csv><code>extension.csv</code></a> 的数据文件中定义，
这份文件会随着 pig 版本发布不断更新，您可以直接使用 <a href=/docs/pig/ext/#ext-reload><code>pig ext reload</code></a> 命令更新这份数据文件。
更新后的文件会默认放置于 <code>~/.pig/extension.csv</code> 中，您可以查阅与更改 —— 您也可以在本项目中找到该数据文件的 <a href=https://github.com/pgsty/pgext/blob/main/db/extension.csv><strong>权威版本</strong></a>。</p><h2 id=添加仓库>添加仓库</h2><p>要想安装扩展，首先需要添加上游仓库。<a href=/docs/pig/repo/><code>pig repo</code></a> 可用于管理 Linux APT/YUM/DNF 软件仓库配置。</p><p>您可以使用简单粗暴直接的版本 <a href=/docs/pig/repo/#repo-set><code>pig repo set</code></a> 覆盖式写入现有仓库配置，该命令确保系统中只存在必须的仓库配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>                <span style=color:#8f5902;font-style:italic># 一次性配置好所有仓库，包括 Linux 系统仓库，PGDG，PIGSTY (PGSQL+INFRA) 仓库</span>
</span></span></code></pre></div><blockquote><p><strong>警告</strong>：<code>pig repo set</code> 会备份并清理现有的仓库配置，然后添加所需的仓库，实现 Overwrite 语义，请务必注意！</p></blockquote><p>或者选择使用温和的 <a href=/docs/pig/repo/#repo-add><code>pig repo add</code></a> 添加所需的仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add pgdg pigsty     <span style=color:#8f5902;font-style:italic># 添加 PGDG 官方仓库 和 PIGSTY 补充仓库</span>
</span></span><span style=display:flex><span>pig repo add pgsql           <span style=color:#8f5902;font-style:italic># 【可选】您也可以选择将 PGDG 和 PIGSTY 合在一起，当成一个 &#34;pgsql&#34; 模块整体添加</span>
</span></span><span style=display:flex><span>pig repo update              <span style=color:#8f5902;font-style:italic># 更新缓存：apt update / yum makecache</span>
</span></span></code></pre></div><p>PIG 会检测您的网络环境，并选择使用 Cloudflare 全球 CDN，或者中国境内云 CDN，但您可以通过 <code>--region</code> 参数强制指定区域。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>      --region<span style=color:#ce5c00;font-weight:700>=</span>china              <span style=color:#8f5902;font-style:italic># 使用中国区域镜像仓库加速下载</span>
</span></span><span style=display:flex><span>pig repo add pgdg --region<span style=color:#ce5c00;font-weight:700>=</span>default --update   <span style=color:#8f5902;font-style:italic># 强制指定使用 PGDG 上游仓库</span>
</span></span></code></pre></div><p>PIG 本身不支持离线安装，您可以自行下载 RPM/DEB 包，拷贝到网络隔离的生产服务器安装。
相关项目 PIGSTY 提供本地软件仓库，支持可以使用 pig 从本地软件仓库安装已经下载好的扩展。</p><h2 id=安装-pg>安装 PG</h2><p>添加仓库后，您可以使用 <a href=/docs/pig/ext/#ext-add><code>pig ext add</code></a> 子命令安装扩展（以及相关软件包）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext add -v <span style=color:#0000cf;font-weight:700>18</span> -y pgsql timescaledb postgis vector pg_duckdb pg_mooncake <span style=color:#8f5902;font-style:italic># 安装 PG 18 内核与扩展，自动确认</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 该命令会自动执行翻译，将软件包翻译为</span>
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate <span style=color:#204a87>alias</span> <span style=color:#4e9a06>&#39;pgsql&#39;</span> to package: postgresql<span style=color:#000>$v</span> postgresql<span style=color:#000>$v</span>-server postgresql<span style=color:#000>$v</span>-libs postgresql<span style=color:#000>$v</span>-contrib postgresql<span style=color:#000>$v</span>-plperl postgresql<span style=color:#000>$v</span>-plpython3 postgresql<span style=color:#000>$v</span>-pltcl
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate extension <span style=color:#4e9a06>&#39;timescaledb&#39;</span> to package: timescaledb-tsl_18
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate extension <span style=color:#4e9a06>&#39;postgis&#39;</span> to package: postgis36_18
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate extension <span style=color:#4e9a06>&#39;vector&#39;</span> to package: pgvector_18
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate extension <span style=color:#4e9a06>&#39;pg_duckdb&#39;</span> to package: pg_duckdb_18
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> translate extension <span style=color:#4e9a06>&#39;pg_mooncake&#39;</span> to package: pg_mooncake_18
</span></span><span style=display:flex><span>INFO<span style=color:#ce5c00;font-weight:700>[</span>20:34:44<span style=color:#ce5c00;font-weight:700>]</span> installing packages: dnf install -y postgresql18 postgresql18-server postgresql18-libs postgresql18-contrib postgresql18-plperl postgresql18-plpython3 postgresql18-pltcl timescaledb-tsl_18 postgis36_18 pgvector_18 pg_duckdb_18 pg_mooncake_18
</span></span></code></pre></div><p>这里使用了 &ldquo;别名翻译&rdquo; 机制，将清爽的 PG 内核/扩展 逻辑包名翻译为实际的 RPM/DEB 列表。如果您不需要别名翻译机制，可以直接使用 <code>apt/dnf</code> 安装，
或者使用变体 <code>pig install</code> 的 <code>-n|--no-translation</code> 参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig install vector     <span style=color:#8f5902;font-style:italic># 带有翻译机制，安装当前 PG 18 对应的 pgvector_18 或 postgresql-18-pgvector</span>
</span></span><span style=display:flex><span>pig install vector -n  <span style=color:#8f5902;font-style:italic># 关闭翻译机制，安装名为 vector 的日志收集组件（来自 pigsty-infra 仓库）</span>
</span></span></code></pre></div><h2 id=别名翻译>别名翻译</h2><p>PostgreSQL 内核与扩展对应着一系列的 RPM/DEB 包，记住这些包是一件麻烦事，所以 pig 提供了许多常用的别名，帮助您简化安装过程：</p><p>例如在 EL 系统上， 下面的别名将会被翻译为右侧的对应 RPM 包列表：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgsql</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;postgresql$v postgresql$v-server postgresql$v-libs postgresql$v-contrib postgresql$v-plperl postgresql$v-plpython3 postgresql$v-pltcl&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>         </span><span style=color:#4e9a06>&#34;postgresql18 postgresql18-server postgresql18-libs postgresql18-contrib postgresql18-plperl postgresql18-plpython3 postgresql18-pltcl&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18-client</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#4e9a06>&#34;postgresql18&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18-server</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#4e9a06>&#34;postgresql18-server postgresql18-libs postgresql18-contrib&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18-devel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#4e9a06>&#34;postgresql18-devel&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg18-basic</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#4e9a06>&#34;pg_repack_18 wal2json_18 pgvector_18&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg17-mini</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;postgresql17 postgresql17-server postgresql17-libs postgresql17-contrib&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg16-full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;postgresql16 postgresql16-server postgresql16-libs postgresql16-contrib postgresql16-plperl postgresql16-plpython3 postgresql16-pltcl postgresql16-llvmjit postgresql16-test postgresql16-devel&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg15-main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;postgresql15 postgresql15-server postgresql15-libs postgresql15-contrib postgresql15-plperl postgresql15-plpython3 postgresql15-pltcl pg_repack_15 wal2json_15 pgvector_15&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg14-core</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#4e9a06>&#34;postgresql14 postgresql14-server postgresql14-libs postgresql14-contrib postgresql14-plperl postgresql14-plpython3 postgresql14-pltcl&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>注意这里的 <code>$v</code> 占位符会被替换为 PG 大版本号，因此当您使用 <code>pgsql</code> 别名时，<code>$v</code> 会被实际替代为 18，17 这样的大版本号。
因此，当您安装 <code>pg18-server</code> 别名时，EL 上实际安装的是 <code>postgresql18-server</code>, <code>postgresql18-libs</code>, <code>postgresql18-contrib</code>，在 Debian / Ubuntu 上安装的是 <code>postgresql-18</code> ，pig 会处理好所有细节。</p><details><summary>常用 PostgreSQL 别名</summary><p><a href=https://github.com/pgsty/pig/blob/main/cli/ext/catalog.go#L206>EL 使用的别名翻译列表</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql&#34;</span>:        <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plperl postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plpython3 postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pltcl&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-mini&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-core&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plperl postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plpython3 postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pltcl&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-full&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plperl postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plpython3 postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pltcl postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-llvmjit postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-test postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-devel&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-main&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plperl postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-plpython3 postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pltcl pg_repack_</span><span style=color:#000>$v</span><span style=color:#4e9a06> wal2json_</span><span style=color:#000>$v</span><span style=color:#4e9a06> pgvector_</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-client&#34;</span>: <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-server&#34;</span>: <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-server postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-libs postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-contrib&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-devel&#34;</span>:  <span style=color:#4e9a06>&#34;postgresql</span><span style=color:#000>$v</span><span style=color:#4e9a06>-devel&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-basic&#34;</span>:  <span style=color:#4e9a06>&#34;pg_repack_</span><span style=color:#000>$v</span><span style=color:#4e9a06> wal2json_</span><span style=color:#000>$v</span><span style=color:#4e9a06> pgvector_</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span></code></pre></div><p><a href=https://github.com/pgsty/pig/blob/main/cli/ext/catalog.go#L270>Debian / Ubuntu 系统使用的别名翻译</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql&#34;</span>:        <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plpython3-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plperl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-pltcl-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-mini&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-core&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plpython3-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plperl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-pltcl-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-full&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plpython3-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plperl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-pltcl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-server-dev-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-main&#34;</span>:   <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plpython3-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-plperl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-pltcl-</span><span style=color:#000>$v</span><span style=color:#4e9a06> postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-repack postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-wal2json postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pgvector&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-client&#34;</span>: <span style=color:#4e9a06>&#34;postgresql-client-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-server&#34;</span>: <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-devel&#34;</span>:  <span style=color:#4e9a06>&#34;postgresql-server-dev-</span><span style=color:#000>$v</span><span style=color:#4e9a06>&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;pgsql-basic&#34;</span>:  <span style=color:#4e9a06>&#34;postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-repack postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-wal2json postgresql-</span><span style=color:#000>$v</span><span style=color:#4e9a06>-pgvector&#34;</span>,
</span></span></code></pre></div><p>上面这些别名可以直接使用，并通过参数实例化大版本号，也可以使用另一种带有大版本号的别名变体：即将 <code>pgsql</code> 替换为 <code>pg18</code>, <code>pg17</code>, <code>pgxx</code> 等具体大版本号。
例如，对于 PostgreSQL 18，可以直接使用下面这些别名：</p><table class=full-width><thead><tr><th style=text-align:left><code>pgsql</code></th><th style=text-align:left><code>pg18</code></th><th style=text-align:left><code>pg17</code></th><th style=text-align:left><code>pg16</code></th><th style=text-align:left><code>pg15</code></th><th style=text-align:left><code>pg14</code></th><th style=text-align:left><code>pg13</code></th></tr></thead><tbody><tr><td style=text-align:left><code>pgsql</code></td><td style=text-align:left><strong><code>pg18</code></strong></td><td style=text-align:left><code>pg17</code></td><td style=text-align:left><code>pg16</code></td><td style=text-align:left><code>pg15</code></td><td style=text-align:left><code>pg14</code></td><td style=text-align:left><code>pg13</code></td></tr><tr><td style=text-align:left><code>pgsql-mini</code></td><td style=text-align:left><code>pg18-mini</code></td><td style=text-align:left><code>pg17-mini</code></td><td style=text-align:left><code>pg16-mini</code></td><td style=text-align:left><code>pg15-mini</code></td><td style=text-align:left><code>pg14-mini</code></td><td style=text-align:left><code>pg13-mini</code></td></tr><tr><td style=text-align:left><code>pgsql-core</code></td><td style=text-align:left><code>pg18-core</code></td><td style=text-align:left><code>pg17-core</code></td><td style=text-align:left><code>pg16-core</code></td><td style=text-align:left><code>pg15-core</code></td><td style=text-align:left><code>pg14-core</code></td><td style=text-align:left><code>pg13-core</code></td></tr><tr><td style=text-align:left><code>pgsql-full</code></td><td style=text-align:left><code>pg18-full</code></td><td style=text-align:left><code>pg17-full</code></td><td style=text-align:left><code>pg16-full</code></td><td style=text-align:left><code>pg15-full</code></td><td style=text-align:left><code>pg14-full</code></td><td style=text-align:left><code>pg13-full</code></td></tr><tr><td style=text-align:left><code>pgsql-main</code></td><td style=text-align:left><code>pg18-main</code></td><td style=text-align:left><code>pg17-main</code></td><td style=text-align:left><code>pg16-main</code></td><td style=text-align:left><code>pg15-main</code></td><td style=text-align:left><code>pg14-main</code></td><td style=text-align:left><code>pg13-main</code></td></tr><tr><td style=text-align:left><code>pgsql-client</code></td><td style=text-align:left><code>pg18-client</code></td><td style=text-align:left><code>pg17-client</code></td><td style=text-align:left><code>pg16-client</code></td><td style=text-align:left><code>pg15-client</code></td><td style=text-align:left><code>pg14-client</code></td><td style=text-align:left><code>pg13-client</code></td></tr><tr><td style=text-align:left><code>pgsql-server</code></td><td style=text-align:left><code>pg18-server</code></td><td style=text-align:left><code>pg17-server</code></td><td style=text-align:left><code>pg16-server</code></td><td style=text-align:left><code>pg15-server</code></td><td style=text-align:left><code>pg14-server</code></td><td style=text-align:left><code>pg13-server</code></td></tr><tr><td style=text-align:left><code>pgsql-devel</code></td><td style=text-align:left><code>pg18-devel</code></td><td style=text-align:left><code>pg17-devel</code></td><td style=text-align:left><code>pg16-devel</code></td><td style=text-align:left><code>pg15-devel</code></td><td style=text-align:left><code>pg14-devel</code></td><td style=text-align:left><code>pg13-devel</code></td></tr><tr><td style=text-align:left><code>pgsql-basic</code></td><td style=text-align:left><code>pg18-basic</code></td><td style=text-align:left><code>pg17-basic</code></td><td style=text-align:left><code>pg16-basic</code></td><td style=text-align:left><code>pg15-basic</code></td><td style=text-align:left><code>pg14-basic</code></td><td style=text-align:left><code>pg13-basic</code></td></tr></tbody></table></details><h2 id=安装扩展>安装扩展</h2><p>pig 会检测当前系统环境中的 PostgreSQL 安装情况。如果检测到环境中（以 <code>PATH</code> 中的 <code>pg_config</code> 为准）有活跃的 PG 安装，那么 pig 会自动安装对应 PG 大版本所需的扩展，无需您显式指定 PG 大版本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig install pg_smtp_client          <span style=color:#8f5902;font-style:italic># 更简单</span>
</span></span><span style=display:flex><span>pig install pg_smtp_client -v <span style=color:#0000cf;font-weight:700>18</span>    <span style=color:#8f5902;font-style:italic># 显示指定大版本，更稳定可靠</span>
</span></span><span style=display:flex><span>pig install pg_smtp_client -p /usr/lib/postgresql/16/bin/pg_config   <span style=color:#8f5902;font-style:italic># 另一种指定 PG 版本的方式</span>
</span></span><span style=display:flex><span>dnf install pg_smtp_client_18       <span style=color:#8f5902;font-style:italic># 最直接……，但并非所有扩展都这么简单……</span>
</span></span></code></pre></div><p>提示：如需将特定大版本的 PostgreSQL 内核二进制加入 <code>PATH</code>，可用 <code>pig ext link</code> 命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext link pg18             <span style=color:#8f5902;font-style:italic># 创建 /usr/pgsql 软链接，并写入 /etc/profile.d/pgsql.sh</span>
</span></span><span style=display:flex><span>. /etc/profile.d/pgsql.sh     <span style=color:#8f5902;font-style:italic># 立即生效，更新 PATH 环境变量</span>
</span></span></code></pre></div><p>如果你想要安装特定版本的软件，可以使用 <code>name=ver</code> 的语法：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext add -v <span style=color:#0000cf;font-weight:700>17</span> <span style=color:#000>pgvector</span><span style=color:#ce5c00;font-weight:700>=</span>0.7.2 <span style=color:#8f5902;font-style:italic># install pgvector 0.7.2 for PG 17</span>
</span></span><span style=display:flex><span>pig ext add <span style=color:#000>pg16</span><span style=color:#ce5c00;font-weight:700>=</span>16.5            <span style=color:#8f5902;font-style:italic># install PostgreSQL 16 with a specific minor version</span>
</span></span></code></pre></div><blockquote><p><strong>警告</strong>：请注意，目前只有 PGDG YUM 仓库提供扩展历史版本，PIGSTY 仓库与 PGDG APT 仓库都只提供扩展的 <strong>最新版本</strong>。</p></blockquote><h2 id=显示扩展>显示扩展</h2><p><a href=/docs/pig/ext/#ext-status><code>pig ext status</code></a> 命令可以用于显示当前安装的扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig ext status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Installed:
</span></span><span style=display:flex><span>- PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>  <span style=color:#0000cf;font-weight:700>398</span> Extensions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active:
</span></span><span style=display:flex><span>PG Version      :  PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>Config Path     :  /usr/bin/pg_config
</span></span><span style=display:flex><span>Binary Path     :  /usr/lib/postgresql/18/bin
</span></span><span style=display:flex><span>Library Path    :  /usr/lib/postgresql/18/lib
</span></span><span style=display:flex><span>Extension Path  :  /usr/share/postgresql/18/extension
</span></span><span style=display:flex><span>Extension Stat  :  <span style=color:#0000cf;font-weight:700>329</span> Installed <span style=color:#ce5c00;font-weight:700>(</span>PIGSTY 234, PGDG 95<span style=color:#ce5c00;font-weight:700>)</span> + <span style=color:#0000cf;font-weight:700>69</span> <span style=color:#000>CONTRIB</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>398</span> Total
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Name                          Version  Cate  Flags   License     Repo    Package                               Description
</span></span><span style=display:flex><span>----                          -------  ----  ------  -------     ------  ------------                          ---------------------
</span></span><span style=display:flex><span>timescaledb                   2.24.0   TIME  -dsl--  Timescale   PIGSTY  postgresql-18-timescaledb-tsl         Enables scalable inserts and complex queries <span style=color:#204a87;font-weight:700>for</span> time-series dat
</span></span><span style=display:flex><span>timescaledb_toolkit           1.22.0   TIME  -ds-t-  Timescale   PIGSTY  postgresql-18-timescaledb-toolkit     Library of analytical hyperfunctions, time-series pipelining, an
</span></span><span style=display:flex><span>timeseries                    0.2.0    TIME  -d----  PostgreSQL  PIGSTY  postgresql-18-pg-timeseries           Convenience API <span style=color:#204a87;font-weight:700>for</span> <span style=color:#204a87>time</span> series stack
</span></span><span style=display:flex><span>periods                       1.2.3    TIME  -ds---  PostgreSQL  PGDG    postgresql-18-periods                 Provide Standard SQL functionality <span style=color:#204a87;font-weight:700>for</span> PERIODs and SYSTEM VERSIO
</span></span><span style=display:flex><span>temporal_tables               1.2.2    TIME  -ds--r  BSD 2-Clause PIGSTY postgresql-18-temporal-tables         temporal tables
</span></span><span style=display:flex><span>postgis                       3.6.1    GIS   -ds---  GPL-2.0     PGDG    postgresql-18-postgis-3               PostGIS geometry and geography spatial types and functions
</span></span><span style=display:flex><span>postgis_topology              3.6.1    GIS   -ds---  GPL-2.0     PGDG    postgresql-18-postgis-3               PostGIS topology spatial types and functions
</span></span><span style=display:flex><span>postgis_raster                3.6.1    GIS   -ds---  GPL-2.0     PGDG    postgresql-18-postgis-3               PostGIS raster types and functions
</span></span><span style=display:flex><span>vector                        0.8.1    RAG   -ds--r  PostgreSQL  PGDG    postgresql-18-pgvector                vector data <span style=color:#204a87>type</span> and ivfflat and hnsw access methods
</span></span><span style=display:flex><span>pg_duckdb                     1.1.0    OLAP  -dsl--  MIT         PIGSTY  postgresql-18-pg-duckdb               DuckDB Embedded in Postgres
</span></span></code></pre></div><p>如果您的当前系统路径中找不到 PostgreSQL（以 <code>PATH</code> 中的 <code>pg_config</code> 为准），建议显式通过 <code>-v|-p</code> 指定 PG 大版本号或 <code>pg_config</code> 路径，以避免版本探测歧义。</p><h2 id=扫描扩展>扫描扩展</h2><p><a href=/docs/pig/ext/#ext-scan><code>pig ext scan</code></a> 提供更底层的扩展扫描功能，将扫描指定 PostgreSQL 目录下的共享库，从而发现安装了哪些扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pig ext scan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Installed:
</span></span><span style=display:flex><span>- PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>  <span style=color:#0000cf;font-weight:700>398</span> Extensions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active:
</span></span><span style=display:flex><span>PG Version      :  PostgreSQL 18.1 <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu 18.1-1.pgdg24.04+2<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>Config Path     :  /usr/bin/pg_config
</span></span><span style=display:flex><span>Binary Path     :  /usr/lib/postgresql/18/bin
</span></span><span style=display:flex><span>Library Path    :  /usr/lib/postgresql/18/lib
</span></span><span style=display:flex><span>Extension Path  :  /usr/share/postgresql/18/extension
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Name                 Version  SharedLibs                                       Description                       Meta
</span></span><span style=display:flex><span>----                 -------  ----------                                       ---------------------             ------
</span></span><span style=display:flex><span>timescaledb          2.24.0   Enables scalable inserts and complex queries...  <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/timescaledb-2.24.0 <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>trusted</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>...
</span></span><span style=display:flex><span>timescaledb_toolkit  1.22.0   Library of analytical hyperfunctions...          <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>superuser</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/timescaledb_toolkit <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>...
</span></span><span style=display:flex><span>periods              1.2      Provide Standard SQL functionality <span style=color:#204a87;font-weight:700>for</span> PERIODs   <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/periods <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>requires</span><span style=color:#ce5c00;font-weight:700>=</span>btree_gist <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>periods.so
</span></span><span style=display:flex><span>pg_cron              1.6      Job scheduler <span style=color:#204a87;font-weight:700>for</span> PostgreSQL                     <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>schema</span><span style=color:#ce5c00;font-weight:700>=</span>pg_catalog <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/pg_cron <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>pg_cron.so
</span></span><span style=display:flex><span>postgis              3.6.1    PostGIS geometry and geography spatial types...  <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/postgis-3 <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>postgis-3.so
</span></span><span style=display:flex><span>vector               0.8.1    vector data <span style=color:#204a87>type</span> and ivfflat and hnsw access...  <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>vector.so
</span></span><span style=display:flex><span>pg_duckdb            1.1.0    DuckDB Embedded in Postgres                      <span style=color:#000>module_pathname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$libdir</span>/pg_duckdb <span style=color:#000>relocatable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>schema</span><span style=color:#ce5c00;font-weight:700>=</span>public <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>=</span>...
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h2 id=容器实战>容器实战</h2><p>您可以创建一台全新的虚拟机，或者使用下面的 Docker 容器进行功能测试，创建一个 <code>d13</code> 目录，创建 <code>Dockerfile</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>debian:13</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>root</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WORKDIR</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>/root</span>/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CMD</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt install -y ca-certificates curl <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> curl https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash<span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t d13:latest .
</span></span><span style=display:flex><span>docker run -it d13:latest /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span> --region<span style=color:#ce5c00;font-weight:700>=</span>china    <span style=color:#8f5902;font-style:italic># 添加中国区域的仓库</span>
</span></span><span style=display:flex><span>pig install -y pg18            <span style=color:#8f5902;font-style:italic># 安装 PGDG 18 内核包</span>
</span></span><span style=display:flex><span>pig install -y postgis timescaledb pgvector pg_duckdb
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2e96076c3764e112eecf0b926837054b>2 - 简介</h1><div class=lead>为什么我们还需要一个新的包管理器？尤其是针对 Postgres 扩展？</div><p>你是否曾因安装或升级 PostgreSQL 扩展而头疼？翻查过时的文档、晦涩难懂的配置脚本，或是在 GitHub 上苦寻分支与补丁？
Postgres 丰富的扩展生态同时意味着复杂的部署流程 —— 在多发行版、多架构环境下尤为棘手。而 PIG 可以为您解决这些烦恼。</p><p>这正是 <strong>Pig</strong> 诞生的初衷。Pig 由 Go 语言开发，致力于一站式管理 Postgres 及其 <a href=https://pgext.cloud/zh/list>450+</a> 扩展。
无论是 TimescaleDB、Citus、PGVector，还是 30+ Rust 扩展，亦或 自建 Supabase 所需的全部组件 —— Pig 统一的 CLI 让一切触手可及。
它彻底告别源码编译与杂乱仓库，直接提供版本对齐的 RPM/DEB 包，完美兼容 Debian、Ubuntu、RedHat 等主流发行版，支持 x86 与 Arm 架构，无需猜测，无需折腾。</p><p>Pig 并非重复造轮子，而是充分利用系统原生包管理器（APT、YUM、DNF），严格遵循 <a href=/docs/repo/pgdg/>PGDG 官方</a> 打包规范，确保无缝集成。
你无需在"标准做法"与"快捷方式"之间权衡；Pig 尊重现有仓库，遵循操作系统最佳实践，与现有仓库和软件包和谐共存。
如果你的 Linux 系统和 PostgreSQL 大版本不在 <a href=#linux-%E5%85%BC%E5%AE%B9%E6%80%A7>支持的列表</a> 中，你还可以使用 <a href=/docs/pig/build/><code>pig build</code></a> 直接针对特定组合编译扩展。</p><p>想让你的 Postgres 如虎添翼、远离繁琐？欢迎访问 <a href=https://pigsty.cc/docs/pig>PIG 官方文档</a> 获取文档、指南，并查阅庞大的 <a href=https://pgext.cloud/zh/list>扩展列表</a>，
让你的本地 Postgres 数据库一键进化为全能的多模态数据中台。
如果说 <a href=https://medium.com/@fengruohang/postgres-is-eating-the-database-world-157c204dcfc4>Postgres 的未来是无可匹敌的可扩展性</a>，那么 Pig 就是帮你解锁它的神灯。毕竟，从没有人抱怨 &ldquo;扩展太多&rdquo;。</p><h2 id=自动化友好>自动化友好</h2><p>PIG 的命令体系可直接用于自动化脚本：参数风格统一、输出稳定，并在高风险操作中提供 <code>--dry-run</code> 或确认步骤，减少误操作风险。</p><blockquote><p>《<a href=https://www.postgresql.org/about/news/announce-pig-the-postgres-extension-wizard-2988/>ANNOUNCE pig: The Postgres Extension Wizard</a>》</p></blockquote><hr><h2 id=linux-兼容性>Linux 兼容性</h2><p>PIG 与 Pigsty 扩展仓库支持以下 Linux 发行版和 PostgreSQL 版本组合：</p><table class=full-width><thead><tr><th style=text-align:left>OS 代码</th><th style=text-align:left>厂商</th><th style=text-align:center>大版本</th><th style=text-align:center>小版本</th><th style=text-align:left>全名</th><th style=text-align:left>PG 版本</th><th style=text-align:center>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>el7.x86_64</code></td><td style=text-align:left>EL</td><td style=text-align:center>7</td><td style=text-align:center>7.9</td><td style=text-align:left>CentOS 7 x86</td><td style=text-align:left>13-15</td><td style=text-align:center>EOL</td></tr><tr><td style=text-align:left><code>el8.x86_64</code></td><td style=text-align:left>EL</td><td style=text-align:center>8</td><td style=text-align:center>8.10</td><td style=text-align:left>RockyLinux 8 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>即将EOL</td></tr><tr><td style=text-align:left><code>el8.aarch64</code></td><td style=text-align:left>EL</td><td style=text-align:center>8</td><td style=text-align:center>8.10</td><td style=text-align:left>RockyLinux 8 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>即将EOL</td></tr><tr><td style=text-align:left><code>el9.x86_64</code></td><td style=text-align:left>EL</td><td style=text-align:center>9</td><td style=text-align:center>9.7</td><td style=text-align:left>RockyLinux 9 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>el9.aarch64</code></td><td style=text-align:left>EL</td><td style=text-align:center>9</td><td style=text-align:center>9.7</td><td style=text-align:left>RockyLinux 9 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>el10.x86_64</code></td><td style=text-align:left>EL</td><td style=text-align:center>10</td><td style=text-align:center>10.1</td><td style=text-align:left>RockyLinux 10 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>el10.aarch64</code></td><td style=text-align:left>EL</td><td style=text-align:center>10</td><td style=text-align:center>10.1</td><td style=text-align:left>RockyLinux 10 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>d11.x86_64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>11</td><td style=text-align:center>11.11</td><td style=text-align:left>Debian 11 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>EOL</td></tr><tr><td style=text-align:left><code>d11.aarch64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>11</td><td style=text-align:center>11.11</td><td style=text-align:left>Debian 11 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>EOL</td></tr><tr><td style=text-align:left><code>d12.x86_64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>12</td><td style=text-align:center>12.13</td><td style=text-align:left>Debian 12 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>d12.aarch64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>12</td><td style=text-align:center>12.13</td><td style=text-align:left>Debian 12 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>d13.x86_64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>13</td><td style=text-align:center>13.3</td><td style=text-align:left>Debian 13 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>d13.aarch64</code></td><td style=text-align:left>Debian</td><td style=text-align:center>13</td><td style=text-align:center>13.3</td><td style=text-align:left>Debian 13 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>u20.x86_64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>20</td><td style=text-align:center>20.04.6</td><td style=text-align:left>Ubuntu 20.04 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>EOL</td></tr><tr><td style=text-align:left><code>u20.aarch64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>20</td><td style=text-align:center>20.04.6</td><td style=text-align:left>Ubuntu 20.04 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>EOL</td></tr><tr><td style=text-align:left><code>u22.x86_64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>22</td><td style=text-align:center>22.04.5</td><td style=text-align:left>Ubuntu 22.04 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>u22.aarch64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>22</td><td style=text-align:center>22.04.5</td><td style=text-align:left>Ubuntu 22.04 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>u24.x86_64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>24</td><td style=text-align:center>24.04.3</td><td style=text-align:left>Ubuntu 24.04 x86</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left><code>u24.aarch64</code></td><td style=text-align:left>Ubuntu</td><td style=text-align:center>24</td><td style=text-align:center>24.04.3</td><td style=text-align:left>Ubuntu 24.04 ARM</td><td style=text-align:left>13-18</td><td style=text-align:center>✅</td></tr></tbody></table><p><strong>说明：</strong></p><ul><li><strong>EL</strong> 指 RHEL 兼容发行版，包括 RHEL、CentOS、RockyLinux、AlmaLinux、OracleLinux 等</li><li><strong>EOL</strong> 表示该操作系统已经或即将停止支持，建议升级到更新版本</li><li><strong>✅</strong> 表示完整支持，推荐使用</li><li>PG 版本 13-18 表示支持 PostgreSQL 13、14、15、16、17、18 六个大版本</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-69af5501e65fc45d0fad0a48d3b90b48>3 - 安装</h1><div class=lead>如何下载与安装 pig 包管理器</div><h2 id=脚本安装>脚本安装</h2><p>安装 <code>pig</code> 最简单的方式是运行以下安装脚本：</p><p><strong>默认安装</strong>（Cloudflare CDN）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p><strong>中国镜像</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/pig <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>该脚本会从 Pigsty <a href=/docs/repo/>软件仓库</a> 下载最新版 <code>pig</code> 的 RPM / DEB 包，并通过 <code>rpm</code> 或 <code>dpkg</code> 进行安装。</p><h2 id=指定版本>指定版本</h2><p>您可以指定特定版本进行安装，将版本号作为参数传入即可：</p><p><strong>默认安装</strong>（Cloudflare CDN）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash -s 1.0.0
</span></span></code></pre></div><p><strong>中国镜像</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/pig <span style=color:#000;font-weight:700>|</span> bash -s 1.0.0
</span></span></code></pre></div><h2 id=发布页下载>发布页下载</h2><p>你也可以直接从 Pigsty 仓库下载 <code>pig</code> 安装包（<code>RPM</code>/<code>DEB</code>/ 压缩包）：<a href=https://github.com/pgsty/pig/releases/tag/v1.0.0>GitHub v1.0.0 稳定版发布页</a></p><pre tabindex=0><code>latest
└── v1.0.0
    ├── pig_1.0.0-1_amd64.deb
    ├── pig_1.0.0-1_arm64.deb
    ├── pig-1.0.0-1.aarch64.rpm
    ├── pig-1.0.0-1.x86_64.rpm
    ├── pig-v1.0.0.linux-amd64.tar.gz
    ├── pig-v1.0.0.linux-arm64.tar.gz
    ├── pig-v1.0.0.darwin-amd64.tar.gz
    └── pig-v1.0.0.darwin-arm64.tar.gz
</code></pre><p>将其解压后，将二进制文件放入您的 PATH 系统路径中即可。</p><h2 id=仓库安装>仓库安装</h2><p><code>pig</code> 软件位于 <a href=/docs/repo/infra/><code>pigsty-infra</code></a> 仓库中。你可以将该仓库添加到操作系统后，使用操作系统的包管理器进行安装：</p><h3 id=yum>YUM</h3><p>对于 RHEL，RockyLinux，CentOS，Alma Linux，OracleLinux 等 EL 系发行版：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/yum.repos.d/pigsty-infra.repo &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[pigsty-infra]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>name=Pigsty Infra for $basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>baseurl=https://repo.pigsty.io/yum/infra/$basearch
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>enabled = 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>gpgcheck = 0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>module_hotfixes=1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo yum makecache<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo yum install -y pig
</span></span></code></pre></div><h3 id=apt>APT</h3><p>对于 Debian，Ubuntu 等 DEB 系发行版：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/apt/sources.list.d/pigsty-infra.list &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>deb [trusted=yes] https://repo.pigsty.io/apt/infra generic main
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt update<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>sudo apt install -y pig
</span></span></code></pre></div><h2 id=更新>更新</h2><p>若要将现有 <code>pig</code> 版本升级至最新可用版本，可以使用以下命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig update            <span style=color:#8f5902;font-style:italic># 将 pig 自身升级到最新版</span>
</span></span></code></pre></div><p>若要将现有 <code>pig</code> 的扩展数据升级至最新可用版本，可以使用以下命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext reload        <span style=color:#8f5902;font-style:italic># 将 pig 扩展数据更新至最新版本</span>
</span></span></code></pre></div><h2 id=卸载>卸载</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt remove -y pig     <span style=color:#8f5902;font-style:italic># Debian / Ubuntu 等 Debian 系统</span>
</span></span><span style=display:flex><span>yum remove -y pig     <span style=color:#8f5902;font-style:italic># RHEL / CentOS / RockyLinux 等 EL 系发行版</span>
</span></span><span style=display:flex><span>rm -rf /usr/bin/pig   <span style=color:#8f5902;font-style:italic># 若直接使用二进制安装，删除二进制文件即可</span>
</span></span></code></pre></div><h2 id=构建>构建</h2><p>你也可以自行构建 <code>pig</code>。<code>pig</code> 使用 Go 语言开发，构建非常容易，源码托管在 <a href=https://github.com/pgsty/pig>github.com/pgsty/pig</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/pgsty/pig.git<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> pig
</span></span><span style=display:flex><span>go get -u<span style=color:#000;font-weight:700>;</span> go build
</span></span></code></pre></div><p>所有 RPM / DEB 包都通过 GitHub CI/CD 流程使用 goreleaser 自动化构建。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7992c175dfd135ebeeb79a8b42f8c996>4 - 版本</h1><div class=lead>pig —— PostgreSQL 包管理器的发布说明</div><p>最新稳定版本是 <a href=https://github.com/pgsty/pig/releases/tag/v1.1.0>v1.1.0</a>。</p><table class=full-width><thead><tr><th style=text-align:center>版本</th><th style=text-align:center>日期</th><th>摘要</th><th style=text-align:right>GitHub</th></tr></thead><tbody><tr><td style=text-align:center><a href=#v110>v1.1.0</a></td><td style=text-align:center>2026-02-12</td><td>451 扩展，Agent-Native CLI 框架</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v1.1.0>v1.0.0</a></td></tr><tr><td style=text-align:center><a href=#v100>v1.0.0</a></td><td style=text-align:center>2026-01-26</td><td>444, 新增 pg/pt/pb/pitr 子命令，可用性矩阵</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v1.0.0>v1.0.0</a></td></tr><tr><td style=text-align:center><a href=#v080>v0.8.0</a></td><td style=text-align:center>2025-12-26</td><td>440 extensions，移除 sysupdate 仓库</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.8.0>v0.8.0</a></td></tr><tr><td style=text-align:center><a href=#v075>v0.7.5</a></td><td style=text-align:center>2025-12-12</td><td>常规扩展更新，使用修复后的阿里云镜像</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.5>v0.7.5</a></td></tr><tr><td style=text-align:center><a href=#v074>v0.7.4</a></td><td style=text-align:center>2025-12-01</td><td>更新 ivory/pgtde 内核与 pgdg extras 仓库</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.4>v0.7.4</a></td></tr><tr><td style=text-align:center><a href=#v073>v0.7.3</a></td><td style=text-align:center>2025-11-24</td><td>修复 el10 & debian13 仓库配置</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.3>v0.7.3</a></td></tr><tr><td style=text-align:center><a href=#v072>v0.7.2</a></td><td style=text-align:center>2025-11-20</td><td>437 个扩展，修复 pig build 的一些问题</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.2>v0.7.2</a></td></tr><tr><td style=text-align:center><a href=#v071>v0.7.1</a></td><td style=text-align:center>2025-11-10</td><td>新网站，改进容器内的使用体验</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.1>v0.7.1</a></td></tr><tr><td style=text-align:center><a href=#v070>v0.7.0</a></td><td style=text-align:center>2025-11-05</td><td>强化 build 能力，大批量包更新</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.7.0>v0.7.0</a></td></tr><tr><td style=text-align:center><a href=#v062>v0.6.2</a></td><td style=text-align:center>2025-10-03</td><td>正式提供 PG 18 支持</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.6.2>v0.6.2</a></td></tr><tr><td style=text-align:center><a href=#v061>v0.6.1</a></td><td style=text-align:center>2025-08-14</td><td>CI/CD, el10 存根, PGDG 中国镜像</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.6.1>v0.6.1</a></td></tr><tr><td style=text-align:center><a href=#v060>v0.6.0</a></td><td style=text-align:center>2025-07-17</td><td>423 个扩展，percona pg_tde，mcp 工具箱</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.6.0>v0.6.0</a></td></tr><tr><td style=text-align:center><a href=#v050>v0.5.0</a></td><td style=text-align:center>2025-06-30</td><td>422 个扩展，新的扩展目录</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.5.0>v0.5.0</a></td></tr><tr><td style=text-align:center><a href=#v042>v0.4.2</a></td><td style=text-align:center>2025-05-27</td><td>421 个扩展，halo 和 oriole deb</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.4.2>v0.4.2</a></td></tr><tr><td style=text-align:center><a href=#v041>v0.4.1</a></td><td style=text-align:center>2025-05-07</td><td>414 个扩展，pg18 别名支持</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.4.1>v0.4.1</a></td></tr><tr><td style=text-align:center><a href=#v040>v0.4.0</a></td><td style=text-align:center>2025-05-01</td><td>do 和 pt 子命令，halo 和 orioledb</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.4.0>v0.4.0</a></td></tr><tr><td style=text-align:center><a href=#v034>v0.3.4</a></td><td style=text-align:center>2025-04-05</td><td>常规更新</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.3.4>v0.3.4</a></td></tr><tr><td style=text-align:center><a href=#v033>v0.3.3</a></td><td style=text-align:center>2025-03-25</td><td>别名、仓库、依赖</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.3.3>v0.3.3</a></td></tr><tr><td style=text-align:center><a href=#v032>v0.3.2</a></td><td style=text-align:center>2025-03-21</td><td>新扩展</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.3.2>v0.3.2</a></td></tr><tr><td style=text-align:center><a href=#v031>v0.3.1</a></td><td style=text-align:center>2025-03-19</td><td>轻微错误修复</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.3.1>v0.3.1</a></td></tr><tr><td style=text-align:center><a href=#v030>v0.3.0</a></td><td style=text-align:center>2025-02-24</td><td>新主页和扩展目录</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.3.0>v0.3.0</a></td></tr><tr><td style=text-align:center><a href=#v022>v0.2.2</a></td><td style=text-align:center>2025-02-22</td><td>404 个扩展</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.2.2>v0.2.2</a></td></tr><tr><td style=text-align:center><a href=#v020>v0.2.0</a></td><td style=text-align:center>2025-02-14</td><td>400 个扩展</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.2.0>v0.2.0</a></td></tr><tr><td style=text-align:center><a href=#v014>v0.1.4</a></td><td style=text-align:center>2025-02-12</td><td>常规错误修复</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.1.4>v0.1.4</a></td></tr><tr><td style=text-align:center><a href=#v013>v0.1.3</a></td><td style=text-align:center>2025-01-23</td><td>390 个扩展</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.1.3>v0.1.3</a></td></tr><tr><td style=text-align:center><a href=#v012>v0.1.2</a></td><td style=text-align:center>2025-01-12</td><td>anon 扩展和其他 350 个扩展</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.1.2>v0.1.2</a></td></tr><tr><td style=text-align:center><a href=#v011>v0.1.1</a></td><td style=text-align:center>2025-01-09</td><td>更新扩展列表</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.1.1>v0.1.1</a></td></tr><tr><td style=text-align:center><a href=#v010>v0.1.0</a></td><td style=text-align:center>2024-12-29</td><td>repo、ext、sty 和自更新</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.1.0>v0.1.0</a></td></tr><tr><td style=text-align:center><a href=#v001>v0.0.1</a></td><td style=text-align:center>2024-12-23</td><td>创世发布</td><td style=text-align:right><a href=https://github.com/pgsty/pig/releases/tag/v0.0.1>v0.0.1</a></td></tr></tbody></table><hr><h1 id=v110>v1.1.0</h1><p>该版本是从 <code>v1.0.0</code> 到 <code>v1.1.0</code> 的一次规划中架构级升级（79 commits，193 files 变更），
核心目标是把 pig 从“人类可用 CLI”推进到“Agent-native 可编排 CLI”。</p><p>新增七个扩展，总可用扩展数量达到 451 个。</p><p><strong>新功能</strong></p><ul><li>Agent-native 统一输出框架落地：引入全局 <code>--output</code>（<code>text/yaml/json/json-pretty</code>），为 <code>ext/repo/pg/pt/pb/pitr/status/version/context</code> 等命令提供统一 <code>Result</code> 结构、稳定状态码与可机器解析输出。</li><li>引入 ANCS（Agent Native Command Schema）元数据体系：为命令补齐 <code>type/volatility/parallel/risk/confirm/os_user/cost</code> 等语义字段，<code>help</code> 在结构化模式下可直接输出命令能力树，便于 Agent 自动发现能力与风险边界。</li><li>新增 <code>pig context</code>（<code>pig ctx</code>）环境快照命令：一次调用聚合主机、PostgreSQL、Patroni、pgBackRest、扩展信息，专门面向 Agent 工作流做上下文注入。</li><li>Plan 能力从 PITR 扩展到更多高风险动作：新增 <code>pig ext add/rm --plan</code>、<code>pig pg stop/restart --plan</code>、<code>pig pt switchover/failover --plan</code>，并与 <code>pig pitr --plan/--dry-run</code> 统一为可审阅执行计划（动作、影响面、风险、预期结果）。</li><li>结构化结果覆盖进一步完善：<code>pgbackrest info</code> 可嵌入原生 JSON 信息，Patroni/PostgreSQL/PITR/Repo/Ext 子系统的结构化返回与辅助 DTO 统一，兼容自动化消费。</li><li>兼容层增强：对 <code>pg_exporter/pg_probe/do/sty</code> 等存量命令引入 legacy structured wrapper，在保留旧交互行为的同时提供结构化执行结果与输出捕获。</li><li>Pigsty 版本更新至 v4.1.0</li></ul><p><strong>扩展更新</strong></p><table><thead><tr><th style=text-align:left>扩展</th><th style=text-align:left>旧版本</th><th style=text-align:left>新版本</th></tr></thead><tbody><tr><td style=text-align:left>timescaledb</td><td style=text-align:left>2.24.0</td><td style=text-align:left>2.25.0</td></tr><tr><td style=text-align:left>citus</td><td style=text-align:left>14.0.0-2</td><td style=text-align:left>14.0.0-3</td></tr><tr><td style=text-align:left>pg_incremental</td><td style=text-align:left>1.2.0</td><td style=text-align:left>1.4.1</td></tr><tr><td style=text-align:left>pg_bigm</td><td style=text-align:left>1.2-20240606</td><td style=text-align:left>1.2-20250903</td></tr><tr><td style=text-align:left>pg_net</td><td style=text-align:left>0.20.0</td><td style=text-align:left>0.20.2</td></tr><tr><td style=text-align:left>pgmq</td><td style=text-align:left>1.9.0</td><td style=text-align:left>1.10.0</td></tr><tr><td style=text-align:left>pg_textsearch</td><td style=text-align:left>0.4.0</td><td style=text-align:left>0.5.0</td></tr><tr><td style=text-align:left>pljs</td><td style=text-align:left>1.0.4</td><td style=text-align:left>1.0.5</td></tr><tr><td style=text-align:left>sslutils</td><td style=text-align:left>1.4-1</td><td style=text-align:left>1.4-2</td></tr><tr><td style=text-align:left>table_version</td><td style=text-align:left>1.11.0</td><td style=text-align:left>1.11.1</td></tr><tr><td style=text-align:left>supautils</td><td style=text-align:left>3.0.2</td><td style=text-align:left>3.1.0</td></tr><tr><td style=text-align:left>pg_math</td><td style=text-align:left>1.0</td><td style=text-align:left>1.1.0</td></tr><tr><td style=text-align:left>pgsentinel</td><td style=text-align:left>1.3.1</td><td style=text-align:left>1.4.0</td></tr><tr><td style=text-align:left>pg_uri</td><td style=text-align:left>1.20151224</td><td style=text-align:left>1.20251029</td></tr><tr><td style=text-align:left>pgcollection</td><td style=text-align:left>1.1.0</td><td style=text-align:left>1.1.1</td></tr><tr><td style=text-align:left>pg_readonly</td><td style=text-align:left>1.0.3</td><td style=text-align:left>1.0.4</td></tr><tr><td style=text-align:left>timestamp9</td><td style=text-align:left>1.4.0-1</td><td style=text-align:left>1.4.0-2</td></tr><tr><td style=text-align:left>pg_uint128</td><td style=text-align:left>1.1.1</td><td style=text-align:left>1.2.0</td></tr><tr><td style=text-align:left>pg_roaringbitmap</td><td style=text-align:left>0.5.5</td><td style=text-align:left>1.1.0</td></tr><tr><td style=text-align:left>plprql</td><td style=text-align:left>18.0.0</td><td style=text-align:left>18.0.1</td></tr><tr><td style=text-align:left>pglinter</td><td style=text-align:left>1.0.1</td><td style=text-align:left>1.1.0</td></tr><tr><td style=text-align:left>pg_jsonschema</td><td style=text-align:left>0.3.3</td><td style=text-align:left>0.3.4</td></tr><tr><td style=text-align:left>pg_anon</td><td style=text-align:left>2.5.1</td><td style=text-align:left>3.0.1</td></tr><tr><td style=text-align:left>vchord</td><td style=text-align:left>1.0.0</td><td style=text-align:left>1.1.0</td></tr><tr><td style=text-align:left>pg_search</td><td style=text-align:left>0.21.4</td><td style=text-align:left>0.21.6/0.21.7</td></tr><tr><td style=text-align:left>pg_graphql</td><td style=text-align:left>1.5.12-1</td><td style=text-align:left>1.5.12-2</td></tr><tr><td style=text-align:left>pg_summarize</td><td style=text-align:left>0.0.1-2</td><td style=text-align:left>0.0.1-3</td></tr><tr><td style=text-align:left>nominatim_fdw</td><td style=text-align:left>-</td><td style=text-align:left>1.1.0</td></tr><tr><td style=text-align:left>pg_utl_smtp</td><td style=text-align:left>-</td><td style=text-align:left>1.0.0</td></tr><tr><td style=text-align:left>pg_strict</td><td style=text-align:left>-</td><td style=text-align:left>1.0.2</td></tr><tr><td style=text-align:left>pg_track_optimizer</td><td style=text-align:left>-</td><td style=text-align:left>0.9.1</td></tr><tr><td style=text-align:left>pgmb</td><td style=text-align:left>-</td><td style=text-align:left>1.0.0</td></tr></tbody></table><p><strong>Bug 修复</strong></p><ul><li>安全修复：修复 <code>pig build proxy</code> 在异常地址输入下的解析 panic 问题。</li><li>安全修复：修复 <code>pig pg log</code> 文件名路径穿越风险，阻止通过 <code>../../</code> 访问日志目录外文件。</li><li>安全加固：加强 installer/repo 路径处理与引号处理，降低路径注入与异常路径误用风险。</li><li>构建链路可靠性修复：<code>pig build get/pkg/ext</code> 在下载或构建失败时正确传递错误并返回非零退出码；修复 DEB 构建中 <code>pg_ver</code> 不匹配导致的误报失败。</li><li>仓库与目录刷新修复：<code>ext/repo reload</code> 支持静默镜像回退；<code>repo add/set/rm</code> 在缓存更新失败时正确返回错误状态。</li><li>扩展管理修复：<code>ext update</code> 调整为显式目标更新并修复状态漂移问题；<code>ext import</code> 将请求的 DEB 资源下载到指定 repo 目录。</li><li>输出与可观察性修复：修复结构化输出 exit code 与文本渲染一致性问题；修复 <code>pg status</code> 权限处理与解析稳定性问题。</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>95245dc035270df2b02cdd5d19afac57ccf4949a61b07b1b806fffde3a3b780e  pig-1.1.0-1.aarch64.rpm
</span></span><span style=display:flex><span>8b1a26f1b5dd002841a0b31904eea8ce94d1e6c4acde4704a78d9e121e1656f4  pig-1.1.0-1.x86_64.rpm
</span></span><span style=display:flex><span>dbd079510513f1cd0521b0871cc6fe3eed8f7fa26f66c04c682568c43e24c456  pig-v1.1.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>3f3ba081b54569a7de4d9a8fce72c02c84d9e1cbeb53173567f970c7291af251  pig-v1.1.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>ad61384bf01cbb8346ce869da0bc893203ad316c516fb9420cb748f1519a005e  pig-v1.1.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>7713632beea1e6ca5c3e2e7172c4adee13a2b1b256755f6c2898b6ca98ee1e00  pig-v1.1.0.linux-arm64.tar.gz
</span></span><span style=display:flex><span>70cfc41b7b0aad48f29e12c22c34afd55b938bf50868ac8ab067b9cb62ccb867  pig_1.1.0-1_amd64.deb
</span></span><span style=display:flex><span>fc5cf16671254f8f3495ff7e80c9d77d06b2328c1a247f90f96cf1e918e0ad0e  pig_1.1.0-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v1.1.0</p><hr><h2 id=v100>v1.0.0</h2><p>本版本引入三组主要的新子命令（<code>pig pg</code>、<code>pig pt</code>、<code>pig pb</code>），用于管理 PostgreSQL、Patroni 和 pgBackRest，同时新增编排式 PITR 命令，并增强扩展可用性显示。</p><p><strong>新增命令</strong></p><ul><li><p><code>pig pg</code> - PostgreSQL 实例管理</p><ul><li><code>pg init/start/stop/restart/reload/status</code> - 控制与管理 PostgreSQL 实例</li><li><code>pg role/promote</code> - 检测和切换实例角色（主库/从库）</li><li><code>pg psql/ps/kill</code> - 连接与会话管理</li><li><code>pg vacuum/analyze/freeze/repack</code> - 数据库维护操作</li><li><code>pg log</code> - 日志查看（list/tail/cat/less）</li></ul></li><li><p><code>pig pt</code> - Patroni 集群管理</p><ul><li><code>pt list/config</code> - 查看集群状态与配置</li><li><code>pt restart/reload/reinit</code> - 管理集群成员</li><li><code>pt switchover/failover</code> - 集群切换操作</li><li><code>pt pause/resume</code> - 控制自动故障切换</li><li><code>pt start/stop/status/log</code> - Patroni 服务管理</li></ul></li><li><p><code>pig pb</code> - pgBackRest 备份管理</p><ul><li><code>pb info/ls</code> - 查看备份信息</li><li><code>pb backup/restore/expire</code> - 备份操作</li><li><code>pb create/upgrade/delete</code> - Stanza 管理</li><li><code>pb check/start/stop/log</code> - 控制操作</li></ul></li><li><p><code>pig pitr</code> - 编排式时间点恢复</p><ul><li>自动协调 Patroni/PostgreSQL</li><li>多种恢复目标：时间、LSN、XID、还原点</li><li>支持 dry-run 模式与恢复后指引</li></ul></li></ul><p><strong>新功能</strong></p><ul><li>为 <code>pig ext avail</code> 和 <code>pig ext ls</code> 添加可用性矩阵</li></ul><p><strong>改进</strong></p><ul><li>统一 pg/pt/pb 命令别名风格</li><li>规范化错误消息格式</li><li>代码重构与清理</li></ul><p><strong>Bug 修复</strong></p><ul><li>修复 UTIL 扩展分类缺失问题</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>306637079e942bcac9ccbc089cd09a80051898f8db1630269bb1acd3fbdaa872  pig-1.0.0-1.aarch64.rpm
</span></span><span style=display:flex><span>d2b9440410f00efbca174d63b507c39d97fc55f402d8e9290ee054c1b1c6414c  pig-1.0.0-1.x86_64.rpm
</span></span><span style=display:flex><span>c8a169e48a8168ee03db508ca2edc22b56ecf6997bae924e9023796ab7ae4e62  pig-v1.0.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>c0996037bfeffeae241b545e69d46c06e7fec2d7d456885229f3af9a7f9ea2f8  pig-v1.0.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>13837c6f2379edf965888bad9e373e69f70cb72e8428bca18c2c804e2bd879f6  pig-v1.0.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>08207dfedd6f72745631596a3d3293de65cc12e1544956a643d1da2165d2c876  pig-v1.0.0.linux-arm64.tar.gz
</span></span><span style=display:flex><span>a543882aa905713a0c50088d4e848951b6957a37a1594d7e9f3fe46453d5ce66  pig_1.0.0-1_amd64.deb
</span></span><span style=display:flex><span>4cd6ec54261b09025c12e9c56bcc0cd3c11779ea0e8becdbd4f901cf2e7c8995  pig_1.0.0-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v1.0.0</p><hr><h2 id=v080>v0.8.0</h2><p><strong>扩展更新</strong></p><ul><li>扩展总数达到 440 个</li><li>新增扩展：<a href=https://github.com/benodiwal/pg_ai_query>pg_ai_query</a> 0.1.1</li><li>新增扩展：<a href=https://github.com/timescale/pg_textsearch>pg_textsearch</a> 0.1.0</li><li>新增扩展：<a href=https://github.com/clickhouse/pg_clickhouse/>pg_clickhouse</a> 0.1.0</li><li>pg_biscuit 从 1.0 升级至 2.0.1（切换至新仓库，更名为 biscuit）</li><li>pg_search 从 0.20.3 升级至 0.20.5</li><li>pg_duckdb 升级至官方正式版 1.1.1</li><li>vchord_bm25 从 0.2.2 升级至 0.3.0</li><li>pg_semver 从 0.40.0 升级至 0.41.0</li><li>pg_timeseries 从 0.1.7 升级至 0.1.8</li><li>修复 debian/ubuntu pg18 扩展问题：supautils、pg_summarize、pg_vectorize、pg_tiktoken、pg_tzf、pglite_fusion、pgsmcrypto、pgx_ulid、plprql</li><li>pigsty 版本号同步至 4.0.0</li></ul><p><strong>仓库更新</strong></p><ul><li>因上游变更移除 pgdg yum sysupdate 仓库</li><li>因上游变更移除 pgdg yum llvmjit 软件包</li><li>修复 el9.aarch64 上 patroni 3.0.4 重复软件包问题</li><li>为 el 仓库定义添加优先级，docker 仓库不可用时自动跳过</li><li>添加 epel 10 / pgdg 9/10 操作系统小版本热修复</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e457832fb290e2f9975bf719966dc36e650bdcbf8505d319c9e0431f4c03bc9e  pig-0.8.0-1.aarch64.rpm
</span></span><span style=display:flex><span>c97b1bfdd7541f0f464cab0ecc273e65535c8dd2603c38d5cf8dccbf7e95b523  pig-0.8.0-1.x86_64.rpm
</span></span><span style=display:flex><span>d892f06d3d3b440671529f40e6cc7949686e0167e2a4758adc666b8a3d75254d  pig-v0.8.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>222413bafdf5a62dc682dac32ea1118cbc34ec3544e2a1b85076ec450b9cc7ae  pig-v0.8.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>d50aa9806bbab8fee5ad9228e104fc9e7ead48729228116b5bf889000791fedc  pig-v0.8.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>d2f410f7b243a8323c8d479f462a0267ac72d217aa4a506c80b5a9927d12dff8  pig-v0.8.0.linux-arm64.tar.gz
</span></span><span style=display:flex><span>4ccd330a995911d4f732e8c9d62aa0db479c21c9596f64c4bc129ec43f156abe  pig_0.8.0-1_amd64.deb
</span></span><span style=display:flex><span>5cb9eccce659110f3ba58e502575564bd6befffd51992a43d84df5a17f8eb8a0  pig_0.8.0-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.8.0</p><hr><h2 id=v075>v0.7.5</h2><p><strong>扩展更新</strong></p><ul><li>timescaledb 2.23.1 -> 2.24.0</li><li>pg_search 0.20.0 -> 0.20.3</li><li>convert 0.0.4 -> 0.0.5</li><li>pglinter 1.0.0 -> 1.0.1</li><li>pgdd 0.6.0 -> 0.6.1</li><li>pg_session_jwt 0.3.3 -> 0.4.0</li><li>pg_anon 2.4.1 -> 2.5.1</li><li>pg_enigma 0.4.0 -> 0.5.0</li><li>wrappers 0.5.6 -> 0.5.7</li><li>pg_vectorize 0.25.0 -> 0.26.0</li></ul><p><strong>仓库更新</strong></p><p>使用修复后的阿里云 PGDG 镜像仓库</p><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>9de11ac1404fc4100074113f2a5d50e4ec42c353b6e122a0b29edc17e53feca6  pig-0.7.5-1.aarch64.rpm
</span></span><span style=display:flex><span>071d655580f1cc63b33d41a8fb49368556b7b5a276318f4bd772a6ab50e22b34  pig-0.7.5-1.x86_64.rpm
</span></span><span style=display:flex><span>befe0a8f786e5243669ed7219acde8156d13d9adb0a5c2fb88ccf0f614a51f9b  pig-v0.7.5.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>4766b4e9ba390a32a7115e9f2dd6b65cf158439e28f9c099bab5c7f2e588bae2  pig-v0.7.5.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>dc45726c5e7fccd502cacaffc94c659570844151cdc279f2cac6500836071ade  pig-v0.7.5.linux-amd64.tar.gz
</span></span><span style=display:flex><span>1483cf967d4bc9c12d4c6724567644d6b88fcd2a93aaf1d317fc6ad4e1672c13  pig-v0.7.5.linux-arm64.tar.gz
</span></span><span style=display:flex><span>0152b7bd254eccadd640e563845abd9fa62efa68f11c6b67a5f9f0eebfa2d92e  pig_0.7.5-1_amd64.deb
</span></span><span style=display:flex><span>7d22116d26ca09c5e2b8afbf086bb1acb1aea1148905efcc38944c18908fb105  pig_0.7.5-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.5</p><hr><h2 id=v074>v0.7.4</h2><ul><li>更新扩展版本与元数据：<code>pg_search</code>，<code>pgmq</code>，<code>pg_stat_monitor</code></li><li>更新 PGDG 仓库 URL 变化，<code>extras</code> 仓库现在位于 yum 仓库顶层</li><li>将 ivorysql 更新至 5.0 版本，与 PG 18 兼容</li><li>将 Percona Postgres TDE 内核更新至 18.1</li></ul><p><strong>Checksums</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>5769b0051f04dcda22dd92b30b8effc8ddfa40097308bded76ce2b38d012ce57  pig-0.7.4-1.aarch64.rpm
</span></span><span style=display:flex><span>d15c829fa2e3ce8dcd1adc063c107607b8e70f2cf747646aaa2fa257cdbf979c  pig-0.7.4-1.x86_64.rpm
</span></span><span style=display:flex><span>bb4c90e253a3d470e50316e633a41e90ed2d4a5c5a1fd3a8dbb68ee87d831d47  pig-v0.7.4.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>faaf7ac7b08390f5048c081bb7a78100714387e35dc890e26d9746fc1caef415  pig-v0.7.4.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>037cacddd0dc1283f13dd2c9bace87ad7f2c74ffc245e629f1420be94bbf93df  pig-v0.7.4.linux-amd64.tar.gz
</span></span><span style=display:flex><span>2ce819b2c3686cfb9f86790fdf61acd30bf7798bd6cd3c4f589df22e273dc867  pig-v0.7.4.linux-arm64.tar.gz
</span></span><span style=display:flex><span>97f62d62f1cca61ce6d335efed88e3855d94ea2cd4ed941f2755fbac73931fcd  pig_0.7.4-1_amd64.deb
</span></span><span style=display:flex><span>d2b80af89ed42601716f6b41eda3f8bee16db34023527df9deef8a43aa25a498  pig_0.7.4-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.4</p><hr><h2 id=v073>v0.7.3</h2><ul><li>新增 pig repo reload 命令，更新仓库元数据</li><li>修复 EL PGDG sysupdate aarch64 仓库问题。</li><li>修复 EL10.aarch64 PGDG 仓库重命名问题。</li><li>订正了若干扩展版本</li><li>更新 Pigsty 版本至 3.7.0</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>786d72f6b685d6d6abf5f255f0a7de9204988a05630a26a53bfc7631823c0c6f  pig-0.7.3-1.aarch64.rpm
</span></span><span style=display:flex><span>da59e24ef79d1164e348bacc43e3222e8e2778ec0e103e7ffc0c6df064758e8f  pig-0.7.3-1.x86_64.rpm
</span></span><span style=display:flex><span>73062a979749095e89abc07dd583d34d4f57908bb4ee935cf7640f129ca6a2cb  pig-v0.7.3.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>ca5f5576f6d0d9be1d10cad769821be9daa62220b2fb56b94d6e4c0cede6da61  pig-v0.7.3.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>d193b4b87cf9a6e4775b1b07709802d30f0233ccb1b728843a09decb545168d3  pig-v0.7.3.linux-amd64.tar.gz
</span></span><span style=display:flex><span>e7f612df0e8e4d9fac6df3765862b9e491bb50aad651856abf7a6935986e6f99  pig-v0.7.3.linux-arm64.tar.gz
</span></span><span style=display:flex><span>3d5306ce95dcf704dd498b05325d942637564b13115f1e5a5bb9ef6781df1ba6  pig_0.7.3-1_amd64.deb
</span></span><span style=display:flex><span>32e695ba2d49a741d8cd92008f8f2dec29f10754d35b732035f48517b382c30d  pig_0.7.3-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.3</p><hr><h2 id=v072>v0.7.2</h2><ul><li><p>批量更新扩展，数量达到 437 个</p></li><li><p>新增 PGDG EL10 Sysupdate 仓库</p></li><li><p>新增 LLVM APT 仓库</p></li><li><p>在 pig build 命令中使用可选的本地 extension.csv 扩展定义问题。</p></li><li><p>更新的扩展： vchord pg_later pgvectorscale pglite_fusion pgx_ulid pg_search citus timescaledb pg_profile pg_stat_monitor documentdb</p></li><li><p>新增的扩展：pglinter pg_typeid pg_enigma pg_retry pg_biscuit pg_weighted_statistics</p></li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>f303c391fc28bc74832712e0aa58319abe0ebcae4f6c07fdf9a9e542b735d2ec  pig-0.7.2-1.aarch64.rpm
</span></span><span style=display:flex><span>c096a61a4e3a49b1238659664bbe2cd7f29954c43fb6bb8e8e9fb271f95a612e  pig-0.7.2-1.x86_64.rpm
</span></span><span style=display:flex><span>5e037c891dff23b46856485108d6f64bede5216dfbd4f38a481f0d0672ee910b  pig-v0.7.2.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>736b4b47999c543c3c886781f4d8dddbf4276f363c35c7bf50094b6f18d14600  pig-v0.7.2.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>20b13f059efed29dd76f6927b3e8d7b597c0c8d734f9e22ba3d0a2af6dbcd3bf  pig-v0.7.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>9548b530c05f2ffdc8d73b8f890718d47b74a51eb62852a99c08b1b52e47f014  pig-v0.7.2.linux-arm64.tar.gz
</span></span><span style=display:flex><span>b6faad9f92b926546a10f590274f2cb2afff21b9cea878094cfc5caf09e67d2c  pig_0.7.2-1_amd64.deb
</span></span><span style=display:flex><span>452f73f1fa035e5417ab49fc51d797925550179ffcc023e8f03d80144309212a  pig_0.7.2-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.2</p><hr><h2 id=v071>v0.7.1</h2><ul><li>全新的网站： <a href=https://pgext.cloud>https://pgext.cloud</a></li><li>修复了不必要的 sudo 使用问题，现在可以方便的在容器中使用</li><li>允许 pig ext link 命令使用形如 pg17 pg18 的参数形式</li><li>新增环境变量 <code>PIG_NO_SUDO</code>，强制不使用 sudo 执行命令</li><li><a href=/docs/repo/pgsql/rpm#2025-11-10>RPM 变更日志</a>：为几乎所有扩展新增 PG 18 支持</li><li><a href=/docs/repo/pgsql/deb#2025-11-10>DEB 变更日志</a>：为几乎所有扩展新增 PG 18 支持</li><li><a href=/docs/repo/infra/log/>Infra 变更日志</a>：例行更新至最新版本</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>a696c9ec784e2fc248e5f3d87cc8aae4116e890f78c5997957d30593f2c85ca6  pig-0.7.1-1.aarch64.rpm
</span></span><span style=display:flex><span>f669538a99cd1dc592d3005b949628fcceb9e78114fc78862d7726b340ee194d  pig-0.7.1-1.x86_64.rpm
</span></span><span style=display:flex><span>e42bdaaf93b720c5b76b32b57362320e4b447109740c76089aefe030b7c8b836  pig-v0.7.1.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>b4c240aadad34e785666ee0a755d9b7455724f790c2d088a1dd7c37ad3b2a457  pig-v0.7.1.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>ffc687add0ca71ac90cba5749c8a7a6075cf7618cba85584072831cf3eb182f7  pig-v0.7.1.linux-amd64.tar.gz
</span></span><span style=display:flex><span>7b0d1f158150d0a40c525692f02b6bce9f5b4ac523a4e59278d702c334e222e1  pig-v0.7.1.linux-arm64.tar.gz
</span></span><span style=display:flex><span>43e91a3bea273d7cacb2d7a58c0a5745501dbd06348b5cb3af971171fae70268  pig_0.7.1-1_amd64.deb
</span></span><span style=display:flex><span>fc2a34aeb46e07cb0ae93611de47d6622c3bd46fe4c415ce4c9091840e0e08a2  pig_0.7.1-1_arm64.deb
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.1</p><hr><h2 id=v070>v0.7.0</h2><ul><li>提供针对 Debian 13 和 EL 10 发行版的支持</li><li>大批量扩展更新至最新版本，带有 PostgreSQL 18 支持。</li><li>几乎所有 Rust 扩展现已通过 pgrx 0.16.1 支持 PG 18</li><li><code>pig build</code> 命令彻底重做<ul><li><code>pig build pkg &lt;pkg></code> 现在会一条龙完成扩展的下载，依赖安装，构建</li><li><code>pig build pgrx</code> 命令现在从 <code>pig build rust</code> 中分离</li><li><code>pig build pgrx [-v pgrx_version]</code> 现在可以直接使用现有的 PG 安装</li><li><code>pig build dep</code> 现在会处理 EL 和 Debian 系统下的扩展依赖</li><li><code>pig build ext</code> 命令现在有了更为紧凑和美观的输出，可在 EL 下不依赖 build 脚本直接构建 RPM</li><li><code>pig build spec</code> 现在支持直接从Pigsty仓库下载 spec 文件包</li><li><code>pig build repo</code> / <code>pig repo add</code> / <code>pig repo set</code> 现在默认使用 <code>node,pgsql,infra</code> 仓库模块，取代原本的 <code>node,pgdg,pigsty</code></li></ul></li><li>大量优化了错误日志记录。</li><li>基于 hugo 与 hextra 全新目录网站</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ad60f9abcde954769e46eb23de61965e  pig_0.7.0-1_amd64.deb
</span></span><span style=display:flex><span>aa15d7088d561528e38b2778fe8f7cf9  pig_0.7.0-1_arm64.deb
</span></span><span style=display:flex><span>05549fe01008e04f8d5a59d4f2a5f0b8  pig-0.7.0-1.aarch64.rpm
</span></span><span style=display:flex><span>0cc9e46c7c72d43c127a6ad115873b67  pig-0.7.0-1.x86_64.rpm
</span></span><span style=display:flex><span>ddacfb052f3f3e5567a02e92fdb31cdd  pig-v0.7.0.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>17d25b565308d3d35513e4b0d824946b  pig-v0.7.0.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>ee7e055ceff638039956765fb747f80b  pig-v0.7.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>284e674807b87447d4b33691fd7a420d  pig-v0.7.0.linux-arm64.tar.gz
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.7.0</p><hr><h2 id=v062>v0.6.2</h2><ul><li>使用 PG 18 官方正式仓库取代原本的 Testing Beta 仓库 instead of testing repo</li><li>在接收 Pigsty 版本字符串的时候，自动添加 <code>v</code> 前缀</li><li>改进了网络检查与下载的逻辑</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>01f5b7dc20644226c762dbb229768347  pig_0.6.2-1_amd64.deb
</span></span><span style=display:flex><span>ce4f00256adc12cbea91467b7f2241cd  pig_0.6.2-1_arm64.deb
</span></span><span style=display:flex><span>cefc36ae8f348aede533b30836fba720  pig-0.6.2-1.aarch64.rpm
</span></span><span style=display:flex><span>d04a287c6eb92b11ecbf99542c2db602  pig-0.6.2-1.x86_64.rpm
</span></span><span style=display:flex><span>e637ca86a7f38866c67686b060223d9a  pig-v0.6.2.darwin-amd64.tar.gz
</span></span><span style=display:flex><span>79749bc69c683586bd8d761bdf6af98e  pig-v0.6.2.darwin-arm64.tar.gz
</span></span><span style=display:flex><span>ad4f02993c7d7d8eec142f0224551bb4  pig-v0.6.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>9793affa4a0cb60e9753e65b7cba3dca  pig-v0.6.2.linux-arm64.tar.gz
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.6.2</p><hr><h2 id=v061>v0.6.1</h2><ul><li>新增 el10 与 debian 13 trixie 的支持存根</li><li>专门的新文档网站： <a href=https://pgext.cloud/pig>https://pgext.cloud/pig</a></li><li>使用 go 1.25 重新构建，新增 CI/CD 管道</li><li>在中国大陆使用 PIGSTY PGDG 镜像</li><li>移除空的 <code>pgdg-el10fix</code> 仓库</li><li>使用 Pigsty WiltonDB 镜像</li><li>修复 EL 10 专用的 EPEL 仓库</li><li>pig version 输出构建环境信息</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.6.1</p><hr><h2 id=v060>v0.6.0</h2><ul><li>新扩展目录：<a href=https://ext.pgsty.com>https://ext.pgsty.com</a></li><li>新子命令：<code>pig install</code> 简化 <code>pig ext install</code></li><li>添加新内核支持：带 pg_tde 的 percona</li><li>添加新包：Google GenAI MCP 数据库工具箱</li><li>添加新仓库：percona 仓库和 clickhouse 仓库</li><li>将扩展摘要信息链接更改为 <a href=https://ext.pgsty.com>https://ext.pgsty.com</a></li><li>修复 orioledb 在 Debian/Ubuntu 系统上的问题</li><li>修复 EL 发行版上的 epel 仓库</li><li>将 golang 升级到 1.24.5</li><li>将 pigsty 升级到 v3.6.0</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>1804766d235b9267701a08f95903bc3b  pig_0.6.0-1_amd64.deb
</span></span><span style=display:flex><span>35f4efa35c1eaecdd12aa680d29eadcb  pig_0.6.0-1_arm64.deb
</span></span><span style=display:flex><span>b523b54d9f2d7dcc5999bcc6bd046b1d  pig-0.6.0-1.aarch64.rpm
</span></span><span style=display:flex><span>9434d9dca7fd9725ea574c5fae1a7f52  pig-0.6.0-1.x86_64.rpm
</span></span><span style=display:flex><span>f635c12d9ad46a779aa7174552977d11  pig-v0.6.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>165af4e63ec0031d303fe8b6c35c5732  pig-v0.6.0.linux-arm64.tar.gz
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.6.0</p><hr><h2 id=v050>v0.5.0</h2><ul><li>将扩展列表更新至 422 个</li><li>新扩展：来自 AWS 的 <a href=https://github.com/aws/pgactive>pgactive</a></li><li>将 timescaledb 升级到 2.20.3</li><li>将 citus 升级到 13.1.0</li><li>将 vchord 升级到 0.4.3</li><li>修复错误：pgvectorscale debian/ubuntu pg17 失败</li><li>将 kubernetes 仓库升级到 1.33</li><li>将默认 pigsty 版本升级到 3.5.0</li></ul><p><strong>校验和</strong></p><pre tabindex=0><code>9ec6f3caf3edbe867caab5de0e0ccb33  pig_0.5.0-1_amd64.deb
4fbb0a42cd8a88bce50b3c9d85745d77  pig_0.5.0-1_arm64.deb
9cf8208396b068cab438f72c90d39efe  pig-0.5.0-1.aarch64.rpm
d9a8d78c30f45e098b29c3d16471aa8d  pig-0.5.0-1.x86_64.rpm
761df804ff7b83965c41492700717674  pig-v0.5.0.linux-amd64.tar.gz
5d1830069d98030728f08835f883ea39  pig-v0.5.0.linux-arm64.tar.gz
</code></pre><p>发布：https://github.com/pgsty/pig/releases/tag/v0.5.0</p><hr><h2 id=v042>v0.4.2</h2><ul><li>将扩展列表更新至 421 个</li><li>为 Debian / Ubuntu 添加 openhalo/orioledb 支持</li><li>pgdd <a href=https://github.com/rustprooflabs/pgdd>0.6.0</a> (pgrx 0.14.1)</li><li>convert <a href=https://github.com/rustprooflabs/convert>0.0.4</a> (pgrx 0.14.1)</li><li>pg_idkit <a href=https://github.com/VADOSWARE/pg_idkit>0.3.0</a> (pgrx 0.14.1)</li><li>pg_tokenizer.rs <a href=https://github.com/tensorchord/pg_tokenizer.rs>0.1.0</a> (pgrx 0.13.1)</li><li>pg_render <a href=https://github.com/mkaski/pg_render>0.1.2</a> (pgrx 0.12.8)</li><li>pgx_ulid <a href=https://github.com/pksunkara/pgx_ulid>0.2.0</a> (pgrx 0.12.7)</li><li>pg_ivm <a href=https://github.com/sraoss/pg_ivm>1.11.0</a> 适用于 debian/ubuntu</li><li>orioledb <a href=https://github.com/orioledb/orioledb>1.4.0 beta11</a></li><li>重新添加 el7 仓库</li></ul><p><strong>校验和</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bbf83fa3e3ec9a4dca82eeed921ae90a  pig_0.4.2-1_amd64.deb
</span></span><span style=display:flex><span>e45753335faf80a70d4f2ef1d3100d72  pig_0.4.2-1_arm64.deb
</span></span><span style=display:flex><span>966d60bbc2025ba9cc53393011605f9f  pig-0.4.2-1.aarch64.rpm
</span></span><span style=display:flex><span>1f31f54da144f10039fa026b7b6e75ad  pig-0.4.2-1.x86_64.rpm
</span></span><span style=display:flex><span>1eec26c4e69b40921e209bcaa4fe257a  pig-v0.4.2.linux-amd64.tar.gz
</span></span><span style=display:flex><span>768d43441917a3625c462ce9f2b9d4ef  pig-v0.4.2.linux-arm64.tar.gz
</span></span></code></pre></div><p>发布：https://github.com/pgsty/pig/releases/tag/v0.4.2</p><hr><h2 id=v041>v0.4.1</h2><ul><li>将扩展列表更新至 414 个</li><li>在 <code>pig ext scan</code> 映射中添加 <code>citus_wal2json</code> 和 <code>citus_pgoutput</code></li><li>添加 PG 18 beta 仓库</li><li>添加 PG 18 包别名</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.4.1</p><hr><h2 id=v040>v0.4.0</h2><ul><li>更新扩展列表，可用扩展达到 <strong>407</strong> 个</li><li>添加 <code>pig do</code> 子命令用于执行 Pigsty playbook 任务</li><li>添加 <code>pig pt</code> 子命令用于包装 Patroni 命令行工具</li><li>添加扩展别名：<code>openhalo</code> 和 <code>orioledb</code></li><li>添加 <code>gitlab-ce</code> / <code>gitlab-ee</code> 仓库区分</li><li>使用最新 Go 1.24.2 构建并升级依赖项版本</li><li>修复特定条件下 <code>pig ext status</code> 的 panic 问题</li><li>修复 <code>pig ext scan</code> 无法匹配多个扩展的问题</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.4.0</p><hr><h2 id=v034>v0.3.4</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://repo.pigsty.io/pig <span style=color:#000;font-weight:700>|</span> bash -s 0.3.4
</span></span></code></pre></div><ul><li>常规扩展元数据更新</li><li>使用阿里云 epel 镜像代替损坏的清华大学 tuna 镜像</li><li>升级 pigsty 版本字符串</li><li>在仓库列表中添加 <code>gitlab</code> 仓库</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.3.4</p><hr><h2 id=v033>v0.3.3</h2><ul><li>添加 <code>pig build dep</code> 命令安装扩展构建依赖项</li><li>更新默认仓库列表</li><li>为 <code>mssql</code> 模块（wiltondb/babelfish）使用 pigsty.io 镜像</li><li>将 docker 模块合并到 <code>infra</code></li><li>从 el7 目标中移除 pg16/17</li><li>允许在 el7 中安装扩展</li><li>更新包别名</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.3.3</p><hr><h2 id=v032>v0.3.2</h2><p><strong>增强功能</strong></p><ul><li>新扩展</li><li>使用 <code>upx</code> 减少二进制大小</li><li>移除嵌入的 pigsty 以减少二进制大小</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.3.2</p><hr><h2 id=v031>v0.3.1</h2><p>常规错误修复</p><ul><li>修复仓库格式字符串</li><li>修复扩展信息链接</li><li>更新 pg_mooncake 元数据</li></ul><p>发布：https://github.com/pgsty/pig/releases/tag/v0.3.1</p><hr><h2 id=v030>v0.3.0</h2><p><a href=/docs/pig/><code>pig</code></a> 项目现在有了新的 <a href=https://pgext.cloud/pig>主页</a>，以及 PostgreSQL 扩展 <a href=https://pgext.cloud/list>目录</a>。</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.3.0</p><hr><h2 id=v022>v0.2.2</h2><p>Pig v0.2.2 中提供 <a href=/docs/pgsql/ext><strong>404</strong></a> 个扩展</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.2.2</p><hr><h2 id=v020>v0.2.0</h2><p>发布：https://github.com/pgsty/pig/releases/tag/v0.2.0</p><hr><h2 id=v014>v0.1.4</h2><p>发布：https://github.com/pgsty/pig/releases/tag/v0.1.4</p><hr><h2 id=v013>v0.1.3</h2><p>v0.1.3，常规更新，现在可用 390 个扩展！</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.1.3</p><hr><h2 id=v012>v0.1.2</h2><p><a href=https://pgext.cloud/list><strong>351</strong></a> 个 PostgreSQL 扩展，包括强大的 <a href=https://postgresql-anonymizer.readthedocs.io/en/stable/>postgresql-anonymizer 2.0</a></p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.1.2</p><hr><h2 id=v011>v0.1.1</h2><p>更新扩展列表。</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.1.1</p><hr><h2 id=v010>v0.1.0</h2><p>pig CLI v0.1 发布</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.1.0</p><hr><h2 id=v001>v0.0.1</h2><p>创世发布</p><p>发布：https://github.com/pgsty/pig/releases/tag/v0.0.1</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d37896a8eedd5fa7780c0840a941ee42>5 - 命令参考</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-4c25303eb196cdde39b80054ff3140e5>6 - pig</h1><div class=lead>pig CLI 命令参考概览</div><p><code>pig</code> CLI 提供了全面的工具集，用于管理 PostgreSQL 安装、扩展、软件仓库以及从源码构建扩展。使用 <code>pig help &lt;command></code> 查看命令文档。</p><ul><li><a href=/docs/pig/repo/><strong>pig repo</strong></a>：管理软件仓库</li><li><a href=/docs/pig/ext/><strong>pig ext</strong></a>：管理 PostgreSQL 扩展</li><li><a href=/docs/pig/build/><strong>pig build</strong></a>：从源码构建扩展</li><li><a href=/docs/pig/sty/><strong>pig sty</strong></a>：管理 Pigsty 安装</li><li><a href=/docs/pig/pg/><strong>pig pg</strong></a>：管理本地 PostgreSQL 服务器</li><li><a href=/docs/pig/pt/><strong>pig pt</strong></a>：管理 Patroni HA 集群</li><li><a href=/docs/pig/pb/><strong>pig pb</strong></a>：管理 pgBackRest 备份与恢复</li></ul><h2 id=概览>概览</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig - PostgreSQL 的 Linux 包管理器
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>  pig <span style=color:#ce5c00;font-weight:700>[</span>command<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  pig repo add -ru            <span style=color:#8f5902;font-style:italic># 覆盖现有仓库并更新缓存</span>
</span></span><span style=display:flex><span>  pig install pg17            <span style=color:#8f5902;font-style:italic># 安装 PostgreSQL 17 PGDG 软件包</span>
</span></span><span style=display:flex><span>  pig install pg_duckdb       <span style=color:#8f5902;font-style:italic># 安装指定的 PostgreSQL 扩展</span>
</span></span><span style=display:flex><span>  pig install pgactive -v <span style=color:#0000cf;font-weight:700>18</span>  <span style=color:#8f5902;font-style:italic># 为特定 PG 版本安装扩展</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  访问 https://pgext.cloud 获取详情
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PostgreSQL Extension Manager
</span></span><span style=display:flex><span>  build       构建 Postgres 扩展
</span></span><span style=display:flex><span>  ext         管理 PostgreSQL 扩展 <span style=color:#ce5c00;font-weight:700>(</span>pgext<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  repo        管理 Linux 软件仓库 <span style=color:#ce5c00;font-weight:700>(</span>apt/dnf<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Pigsty Management Commands
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>do</span>          运行管理任务
</span></span><span style=display:flex><span>  patroni     使用 patronictl 管理 Patroni 集群
</span></span><span style=display:flex><span>  pg_exporter 管理 pg_exporter 与监控指标
</span></span><span style=display:flex><span>  pgbackrest  管理 pgBackRest 备份与恢复
</span></span><span style=display:flex><span>  pitr        编排式时间点恢复
</span></span><span style=display:flex><span>  postgres    管理本地 PostgreSQL 服务器与数据库
</span></span><span style=display:flex><span>  sty         管理 Pigsty 安装
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Additional Commands:
</span></span><span style=display:flex><span>  completion  生成指定 shell 的自动补全脚本
</span></span><span style=display:flex><span>  <span style=color:#204a87>help</span>        获取任何命令的帮助信息
</span></span><span style=display:flex><span>  install     使用原生包管理器安装软件包
</span></span><span style=display:flex><span>  status      显示环境状态
</span></span><span style=display:flex><span>  update      升级 pig 自身
</span></span><span style=display:flex><span>  version     显示 pig 版本信息
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Flags:
</span></span><span style=display:flex><span>      --debug              启用调试模式
</span></span><span style=display:flex><span>  -h, --help               获取帮助信息
</span></span><span style=display:flex><span>  -H, --home string        Pigsty 主目录路径
</span></span><span style=display:flex><span>  -i, --inventory string   配置清单路径
</span></span><span style=display:flex><span>  -t, --toggle             帮助信息中的占位参数
</span></span><span style=display:flex><span>      --log-level string   日志级别: debug, info, warn, error, fatal, panic <span style=color:#ce5c00;font-weight:700>(</span>默认 <span style=color:#4e9a06>&#34;info&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>      --log-path string    日志文件路径，默认为终端输出
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>使用 <span style=color:#4e9a06>&#34;pig [command] --help&#34;</span> 获取命令的详细信息。
</span></span></code></pre></div><h2 id=pig-repo>pig repo</h2><p>管理 PostgreSQL 软件包的 APT/YUM 仓库，详情请参考 <a href=/docs/pig/repo/><code>pig repo</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo list                    <span style=color:#8f5902;font-style:italic># 列出可用仓库</span>
</span></span><span style=display:flex><span>pig repo info   pgdg             <span style=color:#8f5902;font-style:italic># 显示仓库详情</span>
</span></span><span style=display:flex><span>pig repo status                  <span style=color:#8f5902;font-style:italic># 检查当前仓库状态</span>
</span></span><span style=display:flex><span>pig repo add    pgdg pigsty -u   <span style=color:#8f5902;font-style:italic># 添加仓库</span>
</span></span><span style=display:flex><span>pig repo rm     old-repo         <span style=color:#8f5902;font-style:italic># 移除仓库</span>
</span></span><span style=display:flex><span>pig repo update                  <span style=color:#8f5902;font-style:italic># 更新软件包缓存</span>
</span></span><span style=display:flex><span>pig repo create /www/pigsty      <span style=color:#8f5902;font-style:italic># 创建本地仓库</span>
</span></span><span style=display:flex><span>pig repo cache                   <span style=color:#8f5902;font-style:italic># 创建离线包</span>
</span></span><span style=display:flex><span>pig repo boot                    <span style=color:#8f5902;font-style:italic># 从离线包引导</span>
</span></span></code></pre></div><h2 id=pig-ext>pig ext</h2><p>管理 PostgreSQL 扩展和内核包，详情请参考 <a href=/docs/pig/ext/><code>pig ext</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext list    duck             <span style=color:#8f5902;font-style:italic># 搜索扩展</span>
</span></span><span style=display:flex><span>pig ext info    pg_duckdb        <span style=color:#8f5902;font-style:italic># 扩展详情</span>
</span></span><span style=display:flex><span>pig ext status                   <span style=color:#8f5902;font-style:italic># 显示已安装的扩展</span>
</span></span><span style=display:flex><span>pig ext add     pg_duckdb -y     <span style=color:#8f5902;font-style:italic># 安装扩展</span>
</span></span><span style=display:flex><span>pig ext rm      old_extension    <span style=color:#8f5902;font-style:italic># 移除扩展</span>
</span></span><span style=display:flex><span>pig ext update                   <span style=color:#8f5902;font-style:italic># 更新扩展</span>
</span></span><span style=display:flex><span>pig ext scan                     <span style=color:#8f5902;font-style:italic># 扫描已安装的扩展</span>
</span></span><span style=display:flex><span>pig ext import  pg_duckdb        <span style=color:#8f5902;font-style:italic># 下载以供离线使用</span>
</span></span><span style=display:flex><span>pig ext link    <span style=color:#0000cf;font-weight:700>17</span>               <span style=color:#8f5902;font-style:italic># 链接 PG 版本到 PATH</span>
</span></span><span style=display:flex><span>pig ext reload                   <span style=color:#8f5902;font-style:italic># 刷新扩展目录</span>
</span></span></code></pre></div><h2 id=pig-build>pig build</h2><p>从源码构建 PostgreSQL 扩展，详情请参考 <a href=/docs/pig/build/><code>pig build</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 环境设置</span>
</span></span><span style=display:flex><span>pig build spec                   <span style=color:#8f5902;font-style:italic># 初始化构建规格</span>
</span></span><span style=display:flex><span>pig build repo                   <span style=color:#8f5902;font-style:italic># 设置仓库</span>
</span></span><span style=display:flex><span>pig build tool                   <span style=color:#8f5902;font-style:italic># 安装构建工具</span>
</span></span><span style=display:flex><span>pig build rust -y                <span style=color:#8f5902;font-style:italic># 强制重装 Rust（默认不重装）</span>
</span></span><span style=display:flex><span>pig build pgrx                   <span style=color:#8f5902;font-style:italic># 安装 PGRX 框架</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 构建扩展</span>
</span></span><span style=display:flex><span>pig build pkg citus              <span style=color:#8f5902;font-style:italic># 完整构建流程 = get + dep + ext</span>
</span></span><span style=display:flex><span>pig build get citus              <span style=color:#8f5902;font-style:italic># 下载源码</span>
</span></span><span style=display:flex><span>pig build dep citus              <span style=color:#8f5902;font-style:italic># 安装依赖</span>
</span></span><span style=display:flex><span>pig build ext citus              <span style=color:#8f5902;font-style:italic># 构建包</span>
</span></span></code></pre></div><h2 id=pig-sty>pig sty</h2><p>安装 Pigsty 发行版，详情请参考 <a href=/docs/pig/sty/><code>pig sty</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty init                     <span style=color:#8f5902;font-style:italic># 安装 Pigsty 到 ~/pigsty</span>
</span></span><span style=display:flex><span>pig sty boot                     <span style=color:#8f5902;font-style:italic># 安装 Ansible 依赖</span>
</span></span><span style=display:flex><span>pig sty conf                     <span style=color:#8f5902;font-style:italic># 生成配置</span>
</span></span><span style=display:flex><span>pig sty deploy                   <span style=color:#8f5902;font-style:italic># 运行部署 playbook</span>
</span></span></code></pre></div><h2 id=pig-pg>pig pg</h2><p>管理本地 PostgreSQL 服务器，详情请参考 <a href=/docs/pig/pg/><code>pig pg</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg init                      <span style=color:#8f5902;font-style:italic># 初始化数据目录</span>
</span></span><span style=display:flex><span>pig pg start                     <span style=color:#8f5902;font-style:italic># 启动 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pg stop                      <span style=color:#8f5902;font-style:italic># 停止 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pg status                    <span style=color:#8f5902;font-style:italic># 查看状态</span>
</span></span><span style=display:flex><span>pig pg psql mydb                 <span style=color:#8f5902;font-style:italic># 连接数据库</span>
</span></span><span style=display:flex><span>pig pg ps                        <span style=color:#8f5902;font-style:italic># 查看当前连接</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb               <span style=color:#8f5902;font-style:italic># 清理数据库</span>
</span></span><span style=display:flex><span>pig pg log tail                  <span style=color:#8f5902;font-style:italic># 实时查看日志</span>
</span></span></code></pre></div><h2 id=pig-pt>pig pt</h2><p>管理 Patroni HA 集群，详情请参考 <a href=/docs/pig/pt/><code>pig pt</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt list                      <span style=color:#8f5902;font-style:italic># 列出集群成员</span>
</span></span><span style=display:flex><span>pig pt config                    <span style=color:#8f5902;font-style:italic># 显示集群配置</span>
</span></span><span style=display:flex><span>pig pt config <span style=color:#000>ttl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span>             <span style=color:#8f5902;font-style:italic># 修改集群配置</span>
</span></span><span style=display:flex><span>pig pt status                    <span style=color:#8f5902;font-style:italic># 查看服务状态</span>
</span></span><span style=display:flex><span>pig pt log -f                    <span style=color:#8f5902;font-style:italic># 实时查看日志</span>
</span></span></code></pre></div><h2 id=pig-pb>pig pb</h2><p>管理 pgBackRest 备份与恢复，详情请参考 <a href=/docs/pig/pb/><code>pig pb</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb info                      <span style=color:#8f5902;font-style:italic># 显示备份信息</span>
</span></span><span style=display:flex><span>pig pb ls                        <span style=color:#8f5902;font-style:italic># 列出所有备份</span>
</span></span><span style=display:flex><span>pig pb backup                    <span style=color:#8f5902;font-style:italic># 创建备份</span>
</span></span><span style=display:flex><span>pig pb backup full               <span style=color:#8f5902;font-style:italic># 全量备份</span>
</span></span><span style=display:flex><span>pig pb restore -d                <span style=color:#8f5902;font-style:italic># 恢复到最新</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;2025-01-01&#34;</span>   <span style=color:#8f5902;font-style:italic># 恢复到指定时间</span>
</span></span><span style=display:flex><span>pig pb log tail                  <span style=color:#8f5902;font-style:italic># 实时查看日志</span>
</span></span></code></pre></div><h2 id=pig-pitr>pig pitr</h2><p>执行编排式时间点恢复（PITR），详情请参考 <a href=/docs/pig/pitr/><code>pig pitr</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pitr -d                      <span style=color:#8f5902;font-style:italic># 恢复到最新数据</span>
</span></span><span style=display:flex><span>pig pitr -t <span style=color:#4e9a06>&#34;2025-01-01 12:00&#34;</span>   <span style=color:#8f5902;font-style:italic># 恢复到指定时间</span>
</span></span><span style=display:flex><span>pig pitr -I                      <span style=color:#8f5902;font-style:italic># 恢复到备份一致性点</span>
</span></span><span style=display:flex><span>pig pitr -d --dry-run            <span style=color:#8f5902;font-style:italic># 显示执行计划（不实际执行）</span>
</span></span><span style=display:flex><span>pig pitr -d -y                   <span style=color:#8f5902;font-style:italic># 跳过确认（自动化）</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0b34463beffbb6b4de1918e740bdc496>7 - pig repo</h1><div class=lead>使用 pig repo 子命令管理软件仓库</div><p><code>pig repo</code> 命令是一个综合性的软件包仓库管理工具。它提供了添加、移除、创建和管理软件仓库的功能，支持 RPM 系统（RHEL/CentOS/Rocky/Alma）和 Debian 系统（Debian/Ubuntu）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo - Manage Linux APT/YUM Repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  pig repo list                    <span style=color:#8f5902;font-style:italic># available repo list             (info)</span>
</span></span><span style=display:flex><span>  pig repo info   <span style=color:#ce5c00;font-weight:700>[</span>repo<span style=color:#000;font-weight:700>|</span>module...<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic># show repo info                  (info)</span>
</span></span><span style=display:flex><span>  pig repo status                  <span style=color:#8f5902;font-style:italic># show current repo status        (info)</span>
</span></span><span style=display:flex><span>  pig repo add    <span style=color:#ce5c00;font-weight:700>[</span>repo<span style=color:#000;font-weight:700>|</span>module...<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic># add repo and modules            (root)</span>
</span></span><span style=display:flex><span>  pig repo rm     <span style=color:#ce5c00;font-weight:700>[</span>repo<span style=color:#000;font-weight:700>|</span>module...<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic># remove repo &amp; modules           (root)</span>
</span></span><span style=display:flex><span>  pig repo update                  <span style=color:#8f5902;font-style:italic># update repo pkg cache           (root)</span>
</span></span><span style=display:flex><span>  pig repo create                  <span style=color:#8f5902;font-style:italic># create repo on current system   (root)</span>
</span></span><span style=display:flex><span>  pig repo boot                    <span style=color:#8f5902;font-style:italic># boot repo from offline package  (root)</span>
</span></span><span style=display:flex><span>  pig repo cache                   <span style=color:#8f5902;font-style:italic># cache repo as offline package   (root)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>  pig repo add -ru                 <span style=color:#8f5902;font-style:italic># add all repo and update cache (brute but effective)</span>
</span></span><span style=display:flex><span>  pig repo add pigsty -u           <span style=color:#8f5902;font-style:italic># gentle version, only add pigsty repo and update cache</span>
</span></span><span style=display:flex><span>  pig repo add node pgdg pigsty    <span style=color:#8f5902;font-style:italic># essential repo to install postgres packages</span>
</span></span><span style=display:flex><span>  pig repo add all                 <span style=color:#8f5902;font-style:italic># all = node + pgdg + pigsty</span>
</span></span><span style=display:flex><span>  pig repo add all extra           <span style=color:#8f5902;font-style:italic># extra module has non-free and some 3rd repo for certain extensions</span>
</span></span><span style=display:flex><span>  pig repo update                  <span style=color:#8f5902;font-style:italic># update repo cache</span>
</span></span><span style=display:flex><span>  pig repo create                  <span style=color:#8f5902;font-style:italic># update local repo /www/pigsty meta</span>
</span></span><span style=display:flex><span>  pig repo boot                    <span style=color:#8f5902;font-style:italic># extract /tmp/pkg.tgz to /www/pigsty</span>
</span></span><span style=display:flex><span>  pig repo cache                   <span style=color:#8f5902;font-style:italic># cache /www/pigsty into /tmp/pkg.tgz</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>repo list</code></td><td style=text-align:left>打印可用仓库与模块列表</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>repo info</code></td><td style=text-align:left>获取仓库详细信息</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>repo status</code></td><td style=text-align:left>显示当前仓库状态</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>repo add</code></td><td style=text-align:left>添加新仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo set</code></td><td style=text-align:left>清空、覆盖并更新仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo rm</code></td><td style=text-align:left>移除仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo update</code></td><td style=text-align:left>更新仓库缓存</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo create</code></td><td style=text-align:left>创建本地 YUM/APT 仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo cache</code></td><td style=text-align:left>从本地仓库创建离线包</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo boot</code></td><td style=text-align:left>从离线包引导仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>repo reload</code></td><td style=text-align:left>刷新仓库目录</td><td style=text-align:left></td></tr></tbody></table><h2 id=快速入门>快速入门</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 方法 1：清理干净现有仓库，添加所有必要仓库并更新缓存（推荐）</span>
</span></span><span style=display:flex><span>pig repo add all --remove --update    <span style=color:#8f5902;font-style:italic># 移除旧仓库，添加所有必要仓库，更新缓存</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 方法 1 变体：一步到位</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>                          <span style=color:#8f5902;font-style:italic># = pig repo add all --remove --update</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 方法 2：温和方式 - 仅添加所需仓库，保留你目前的仓库配置</span>
</span></span><span style=display:flex><span>pig repo add pgsql                    <span style=color:#8f5902;font-style:italic># 添加 PGDG 和 Pigsty 仓库并更新缓存</span>
</span></span><span style=display:flex><span>pig repo add pigsty --region<span style=color:#ce5c00;font-weight:700>=</span>china    <span style=color:#8f5902;font-style:italic># 添加 Pigsty 仓库，指定使用中国区域</span>
</span></span><span style=display:flex><span>pig repo add pgdg   --region<span style=color:#ce5c00;font-weight:700>=</span>default  <span style=color:#8f5902;font-style:italic># 添加 PGDG ，指定使用默认区域</span>
</span></span><span style=display:flex><span>pig repo add infra  --region<span style=color:#ce5c00;font-weight:700>=</span>europe   <span style=color:#8f5902;font-style:italic># 添加 INFRA 仓库 ，指定使用欧洲区域</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如果上面没有-u|--update 选项一步到位，请额外执行此命令</span>
</span></span><span style=display:flex><span>pig repo update                       <span style=color:#8f5902;font-style:italic># 更新系统包缓存</span>
</span></span></code></pre></div><h2 id=模块>模块</h2><p>在 pig 中，APT/YUM 仓库被组织为 <strong>模块</strong> —— 服务于特定目的的一组仓库。</p><table class=full-width><thead><tr><th style=text-align:center>模块</th><th style=text-align:left>说明</th><th style=text-align:left>仓库列表</th></tr></thead><tbody><tr><td style=text-align:center><code>all</code></td><td style=text-align:left>安装 PG 所需的全部核心模块</td><td style=text-align:left><code>node</code> + <code>infra</code> + <code>pgsql</code></td></tr><tr><td style=text-align:center><code>pgsql</code></td><td style=text-align:left>PGDG + Pigsty PG 扩展</td><td style=text-align:left><code>pigsty-pgsql</code> + <code>pgdg</code></td></tr><tr><td style=text-align:center><code>pigsty</code></td><td style=text-align:left>Pigsty Infra + PGSQL 仓库</td><td style=text-align:left>pigsty-infra, pigsty-pgsql</td></tr><tr><td style=text-align:center><code>pgdg</code></td><td style=text-align:left>PGDG 官方仓库</td><td style=text-align:left>pgdg-common, pgdg13-18</td></tr><tr><td style=text-align:center><code>node</code></td><td style=text-align:left>Linux 系统仓库</td><td style=text-align:left>base, updates, extras, epel, baseos, appstream&mldr;</td></tr><tr><td style=text-align:center><code>infra</code></td><td style=text-align:left>基础设施组件仓库</td><td style=text-align:left>pigsty-infra, nginx, docker-ce</td></tr><tr><td style=text-align:center><code>beta</code></td><td style=text-align:left>PostgreSQL 19 Beta 版本</td><td style=text-align:left>pgdg19-beta, pgdg-beta</td></tr><tr><td style=text-align:center><code>extra</code></td><td style=text-align:left>PGDG Non-Free 与三方扩展</td><td style=text-align:left>pgdg-extras, timescaledb, citus</td></tr><tr><td style=text-align:center><code>groonga</code></td><td style=text-align:left>PGroonga 仓库</td><td style=text-align:left>groonga</td></tr><tr><td style=text-align:center><code>mssql</code></td><td style=text-align:left>WiltonDB 仓库</td><td style=text-align:left>wiltondb</td></tr><tr><td style=text-align:center><code>percona</code></td><td style=text-align:left>Percona PG + PG_TDE</td><td style=text-align:left>percona</td></tr><tr><td style=text-align:center><code>llvm</code></td><td style=text-align:left>LLVM 工具链仓库</td><td style=text-align:left>llvm</td></tr><tr><td style=text-align:center><code>kube</code></td><td style=text-align:left>Kubernetes 仓库</td><td style=text-align:left>kubernetes</td></tr><tr><td style=text-align:center><code>grafana</code></td><td style=text-align:left>Grafana 仓库</td><td style=text-align:left>grafana</td></tr><tr><td style=text-align:center><code>haproxy</code></td><td style=text-align:left>HAProxy 仓库</td><td style=text-align:left>haproxyd, haproxyu</td></tr><tr><td style=text-align:center><code>redis</code></td><td style=text-align:left>Redis 仓库</td><td style=text-align:left>redis</td></tr><tr><td style=text-align:center><code>mongo</code></td><td style=text-align:left>MongoDB 仓库</td><td style=text-align:left>mongo</td></tr><tr><td style=text-align:center><code>mysql</code></td><td style=text-align:left>MySQL 仓库</td><td style=text-align:left>mysql</td></tr><tr><td style=text-align:center><code>click</code></td><td style=text-align:left>ClickHouse 仓库</td><td style=text-align:left>clickhouse</td></tr><tr><td style=text-align:center><code>gitlab</code></td><td style=text-align:left>GitLab 仓库</td><td style=text-align:left>gitlab-ce, gitlab-ee</td></tr></tbody></table><p>除此之外，pig 还自带了一些其他数据库的 APT/DNF 仓库：<code>redis</code>, <code>kubernetes</code>, <code>grafana</code>, <code>clickhouse</code>, <code>gitlab</code>, <code>haproxy</code>, <code>mongodb</code>, <code>mysql</code>，在此不再展开。</p><p>通常来说，为了安装 PostgreSQL <code>node</code> （Linux 系统仓库） 和 <code>pgsql</code>（PGDG + Pigsty）是必选项，<code>infra</code> 仓库是可选项（包含了一些工具，IvorySQL Kernel 等）。
您可以使用特殊的 <code>all</code> 模块，一次性添加所有需要的仓库到系统中，对绝大多数用户来说，这是合适的起点。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add all      <span style=color:#8f5902;font-style:italic># 添加 node,pgsql,infra 三个仓库到系统中</span>
</span></span><span style=display:flex><span>pig repo add          <span style=color:#8f5902;font-style:italic># 不添加任何参数时，默认使用 all 模块</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>          <span style=color:#8f5902;font-style:italic># 使用 set 替代 add 时，将清理备份现有仓库定义并覆盖式更新</span>
</span></span></code></pre></div><h2 id=仓库定义>仓库定义</h2><p>Pigsty 中可用仓库的完整定义位于 <a href=https://github.com/pgsty/pig/blob/main/cli/repo/assets/repo.yml><code>cli/repo/assets/repo.yml</code></a>。</p><p>您可以创建 <code>~/.pig/repo.yml</code> 文件，显式修改并覆盖 pig 的仓库定义。在编辑仓库定义文件时，您可以在 <code>baseurl</code> 处添加额外的区域镜像，例如指定中国，欧洲地区的镜像仓库 URL。当 pig 使用 <code>--region</code> 参数指定特定的区域时，pig 会优先查找对应区域的仓库 URL，如果不存在，则会 Fallback 到 <code>default</code> 的仓库 URL。</p><h2 id=repo-list>repo list</h2><p><code>pig repo list</code> 将列出当前系统可用的所有仓库模块。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo list                <span style=color:#8f5902;font-style:italic># 列出当前系统可用仓库</span>
</span></span><span style=display:flex><span>pig repo list all            <span style=color:#8f5902;font-style:italic># 列出所有仓库（不过滤）</span>
</span></span></code></pre></div><h2 id=repo-info>repo info</h2><p>显示特定仓库或模块的详细信息，包括 URL、元数据和区域镜像，以及 <code>.repo</code> / <code>.list</code> 仓库文件内容。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo info pgdg               <span style=color:#8f5902;font-style:italic># 显示 pgdg 模块的信息</span>
</span></span><span style=display:flex><span>pig repo info pigsty pgdg        <span style=color:#8f5902;font-style:italic># 显示多个模块的信息</span>
</span></span><span style=display:flex><span>pig repo info all                <span style=color:#8f5902;font-style:italic># 显示所有模块的信息</span>
</span></span></code></pre></div><h2 id=repo-status>repo status</h2><p>显示系统上的当前仓库配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo status
</span></span></code></pre></div><h2 id=repo-add>repo add</h2><p>添加仓库配置文件到系统。需要 root/sudo 权限。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add pgdg                <span style=color:#8f5902;font-style:italic># 添加 PGDG 仓库</span>
</span></span><span style=display:flex><span>pig repo add pgdg pigsty         <span style=color:#8f5902;font-style:italic># 添加多个仓库</span>
</span></span><span style=display:flex><span>pig repo add all                 <span style=color:#8f5902;font-style:italic># 添加所有必要仓库 (pgdg + pigsty + node)</span>
</span></span><span style=display:flex><span>pig repo add pigsty -u           <span style=color:#8f5902;font-style:italic># 添加并更新缓存</span>
</span></span><span style=display:flex><span>pig repo add all -r              <span style=color:#8f5902;font-style:italic># 添加前移除现有仓库</span>
</span></span><span style=display:flex><span>pig repo add all -ru             <span style=color:#8f5902;font-style:italic># 移除、添加并更新（完全重置）</span>
</span></span><span style=display:flex><span>pig repo add pgdg --region<span style=color:#ce5c00;font-weight:700>=</span>china <span style=color:#8f5902;font-style:italic># 使用中国镜像</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-r|--remove</code>：添加新仓库前移除现有仓库</li><li><code>-u|--update</code>：添加仓库后运行包缓存更新</li><li><code>--region &lt;region></code>：使用区域镜像仓库（<code>default</code> / <code>china</code> / <code>europe</code>）</li></ul><table class=full-width><thead><tr><th style=text-align:center>平台</th><th style=text-align:left>模块位置</th></tr></thead><tbody><tr><td style=text-align:center>EL</td><td style=text-align:left><code>/etc/yum.repos.d/&lt;module>.repo</code></td></tr><tr><td style=text-align:center>Debian</td><td style=text-align:left><code>/etc/apt/sources.list.d/&lt;module>.list</code></td></tr></tbody></table><h2 id=repo-set>repo set</h2><p>等同于 <code>repo add --remove --update</code>。清空现有仓库并设置新仓库，然后更新缓存。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>                     <span style=color:#8f5902;font-style:italic># 替换为默认仓库</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span> pgdg pigsty         <span style=color:#8f5902;font-style:italic># 替换为特定仓库并更新</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span> all --region<span style=color:#ce5c00;font-weight:700>=</span>china  <span style=color:#8f5902;font-style:italic># 使用中国镜像</span>
</span></span></code></pre></div><h2 id=repo-rm>repo rm</h2><p>移除仓库配置文件并备份它们。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo rm                      <span style=color:#8f5902;font-style:italic># 移除所有仓库</span>
</span></span><span style=display:flex><span>pig repo rm pgdg                 <span style=color:#8f5902;font-style:italic># 移除特定仓库</span>
</span></span><span style=display:flex><span>pig repo rm pgdg pigsty -u       <span style=color:#8f5902;font-style:italic># 移除并更新缓存</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:center>平台</th><th style=text-align:left>备份位置</th></tr></thead><tbody><tr><td style=text-align:center>EL</td><td style=text-align:left><code>/etc/yum.repos.d/backup/</code></td></tr><tr><td style=text-align:center>Debian</td><td style=text-align:left><code>/etc/apt/sources.list.d/backup/</code></td></tr></tbody></table><h2 id=repo-update>repo update</h2><p>更新包管理器缓存以反映仓库更改。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo update                  <span style=color:#8f5902;font-style:italic># 更新包缓存</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:center>平台</th><th style=text-align:left>等效命令</th></tr></thead><tbody><tr><td style=text-align:center>EL</td><td style=text-align:left><code>dnf makecache</code></td></tr><tr><td style=text-align:center>Debian</td><td style=text-align:left><code>apt update</code></td></tr></tbody></table><h2 id=repo-create>repo create</h2><p>为离线安装创建本地包仓库。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo create                  <span style=color:#8f5902;font-style:italic># 在默认位置创建 (/www/pigsty)</span>
</span></span><span style=display:flex><span>pig repo create /srv/repo        <span style=color:#8f5902;font-style:italic># 在自定义位置创建</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:center>平台</th><th style=text-align:left>依赖软件</th></tr></thead><tbody><tr><td style=text-align:center>EL</td><td style=text-align:left><code>createrepo_c</code></td></tr><tr><td style=text-align:center>Debian</td><td style=text-align:left><code>dpkg-dev</code></td></tr></tbody></table><h2 id=repo-cache>repo cache</h2><p>创建仓库内容的压缩 tarball 用于离线分发。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo cache                   <span style=color:#8f5902;font-style:italic># 默认：/www 到 /tmp/pkg.tgz</span>
</span></span><span style=display:flex><span>pig repo cache -d /srv           <span style=color:#8f5902;font-style:italic># 自定义源目录</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-d, --dir</code>：源目录（默认：<code>/www/</code>）</li><li><code>-p, --path</code>：输出路径（默认：<code>/tmp/pkg.tgz</code>）</li></ul><h2 id=repo-boot>repo boot</h2><p>从离线包解压并设置本地仓库。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo boot                    <span style=color:#8f5902;font-style:italic># 默认：/tmp/pkg.tgz 到 /www</span>
</span></span><span style=display:flex><span>pig repo boot -p /mnt/pkg.tgz   <span style=color:#8f5902;font-style:italic># 自定义包路径</span>
</span></span><span style=display:flex><span>pig repo boot -d /srv           <span style=color:#8f5902;font-style:italic># 自定义目标目录</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-p, --path</code>：包路径（默认：<code>/tmp/pkg.tgz</code>）</li><li><code>-d, --dir</code>：目标目录（默认：<code>/www/</code>）</li></ul><h2 id=repo-reload>repo reload</h2><p>从 GitHub 刷新仓库元数据到最新版本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo reload                  <span style=color:#8f5902;font-style:italic># 刷新仓库目录</span>
</span></span></code></pre></div><p>更新后的文件会放置于 <code>~/.pig/repo.yml</code> 中。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-64e9fc41b68abc137743c08861cd712e>8 - pig ext</h1><div class=lead>使用 pig ext 子命令管理 PostgreSQL 扩展</div><p><code>pig ext</code> 命令是一个用于管理 PostgreSQL 扩展的全能工具。它允许用户搜索、安装、移除、更新和管理 PostgreSQL 扩展，甚至支持内核包的管理。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext - Manage PostgreSQL Extensions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  pig repo add -ru             <span style=color:#8f5902;font-style:italic># add all repo and update cache (brute but effective)</span>
</span></span><span style=display:flex><span>  pig ext add pg17             <span style=color:#8f5902;font-style:italic># install optional postgresql 17 package</span>
</span></span><span style=display:flex><span>  pig ext list duck            <span style=color:#8f5902;font-style:italic># search extension in catalog</span>
</span></span><span style=display:flex><span>  pig ext scan -v <span style=color:#0000cf;font-weight:700>17</span>           <span style=color:#8f5902;font-style:italic># scan installed extension for pg 17</span>
</span></span><span style=display:flex><span>  pig ext add pg_duckdb        <span style=color:#8f5902;font-style:italic># install certain postgresql extension</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>  pig ext list    <span style=color:#ce5c00;font-weight:700>[</span>query<span style=color:#ce5c00;font-weight:700>]</span>      <span style=color:#8f5902;font-style:italic># list &amp; search extension</span>
</span></span><span style=display:flex><span>  pig ext info    <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># get information of a specific extension</span>
</span></span><span style=display:flex><span>  pig ext status  <span style=color:#ce5c00;font-weight:700>[</span>-v<span style=color:#ce5c00;font-weight:700>]</span>         <span style=color:#8f5902;font-style:italic># show installed extension and pg status</span>
</span></span><span style=display:flex><span>  pig ext add     <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># install extension for current pg version</span>
</span></span><span style=display:flex><span>  pig ext rm      <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># remove extension for current pg version</span>
</span></span><span style=display:flex><span>  pig ext update  <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># update extension to the latest version</span>
</span></span><span style=display:flex><span>  pig ext import  <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># download extension to local repo</span>
</span></span><span style=display:flex><span>  pig ext link    <span style=color:#ce5c00;font-weight:700>[</span>ext...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># link postgres installation to path</span>
</span></span><span style=display:flex><span>  pig ext reload               <span style=color:#8f5902;font-style:italic># reload the latest extension catalog data</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>ext list</code></td><td style=text-align:left>搜索扩展</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ext info</code></td><td style=text-align:left>显示扩展详细信息</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ext avail</code></td><td style=text-align:left>显示扩展可用性矩阵</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ext status</code></td><td style=text-align:left>显示已安装的扩展</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ext scan</code></td><td style=text-align:left>扫描已安装的扩展</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ext add</code></td><td style=text-align:left>安装扩展</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>ext rm</code></td><td style=text-align:left>移除扩展</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>ext update</code></td><td style=text-align:left>更新扩展</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>ext import</code></td><td style=text-align:left>下载扩展以供离线使用</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>ext link</code></td><td style=text-align:left>链接 PG 版本到 PATH</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>ext reload</code></td><td style=text-align:left>刷新扩展目录</td><td style=text-align:left></td></tr></tbody></table><h2 id=快速入门>快速入门</h2><p>在安装 PostgreSQL 扩展前，你需要先添加 <a href=/docs/pig/repo/><code>pig repo add</code></a>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig repo add pgdg pigsty -u    <span style=color:#8f5902;font-style:italic># 温和方式添加 pgdg 和 pigsty 仓库</span>
</span></span><span style=display:flex><span>pig repo <span style=color:#204a87>set</span>                   <span style=color:#8f5902;font-style:italic># 粗暴方式移除并添加所有所需仓库</span>
</span></span></code></pre></div><p>然后你可以搜索并安装 PostgreSQL 扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext install pg_duckdb
</span></span><span style=display:flex><span>pig ext install pg_partman
</span></span><span style=display:flex><span>pig ext install pg_cron
</span></span><span style=display:flex><span>pig ext install pg_repack
</span></span><span style=display:flex><span>pig ext install pg_stat_statements
</span></span><span style=display:flex><span>pig ext install pg_stat_kcache
</span></span></code></pre></div><p>可用扩展及其名称请查阅 <a href=https://pgext.cloud/zh/list><strong>扩展列表</strong></a>。</p><p><strong>使用说明：</strong></p><ol><li>未指定 PostgreSQL 版本时，工具会尝试从 <code>PATH</code> 中的 <code>pg_config</code> 自动检测当前活动的 PostgreSQL 安装。</li><li>PostgreSQL 可通过主版本号（<code>-v</code>）或 pg_config 路径（<code>-p</code>）指定。<ul><li>若指定 <code>-v</code>，pig 会使用该版本 PGDG 内核包的默认路径。<ul><li>EL 发行版为 <code>/usr/pgsql-$v/bin/pg_config</code>，</li><li>DEB 发行版为 <code>/usr/lib/postgresql/$v/bin/pg_config</code> 等。</li></ul></li><li>若指定 <code>-p</code>，则直接用该路径定位 PostgreSQL。</li></ul></li><li>扩展管理器会根据操作系统自动适配不同的包格式：<ul><li>RHEL/CentOS/Rocky Linux/AlmaLinux 使用 RPM 包</li><li>Debian/Ubuntu 使用 DEB 包</li></ul></li><li>某些扩展可能有依赖项，安装时会自动解决。</li><li>谨慎使用 <code>-y</code> 参数，它会自动确认所有提示。</li></ol><p>Pigsty 假定你已安装官方 PGDG 内核包，如未安装，可用如下命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext install pg18          <span style=color:#8f5902;font-style:italic># 安装 PostgreSQL 18 内核（除 devel 包）</span>
</span></span></code></pre></div><h2 id=ext-list>ext list</h2><p>列出（或搜索）扩展目录中的可用扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext list                     <span style=color:#8f5902;font-style:italic># 列出所有扩展</span>
</span></span><span style=display:flex><span>pig ext list duck                <span style=color:#8f5902;font-style:italic># 搜索包含 &#34;duck&#34; 的扩展</span>
</span></span><span style=display:flex><span>pig ext list -v <span style=color:#0000cf;font-weight:700>17</span>               <span style=color:#8f5902;font-style:italic># 按 PG 版本筛选</span>
</span></span><span style=display:flex><span>pig ext ls olap                  <span style=color:#8f5902;font-style:italic># 列出 olap 类别扩展</span>
</span></span><span style=display:flex><span>pig ext ls gis -v <span style=color:#0000cf;font-weight:700>16</span>             <span style=color:#8f5902;font-style:italic># 列出 PG 16 的 GIS 类扩展</span>
</span></span><span style=display:flex><span>pig ext ls rag                   <span style=color:#8f5902;font-style:italic># 列出 RAG 类别扩展</span>
</span></span></code></pre></div><p>分类筛选通过查询参数直接指定分类名实现，支持的分类包括：<code>time</code>, <code>gis</code>, <code>rag</code>, <code>fts</code>, <code>olap</code>, <code>feat</code>, <code>lang</code>, <code>type</code>, <code>func</code>, <code>util</code>, <code>admin</code>, <code>stat</code>, <code>sec</code>, <code>fdw</code>, <code>sim</code>, <code>etl</code>。</p><p><strong>选项：</strong></p><ul><li><code>-v|--version</code>：按 PG 版本筛选</li><li><code>--pkg</code>：显示包名而非扩展名，仅列出主导扩展</li></ul><p><strong>Status 列说明：</strong></p><ul><li><code>installed</code>：扩展已安装（绿色）</li><li><code>available</code>：扩展可用但未安装（黄色）</li><li><code>not avail</code>：扩展在当前系统不可用（红色）</li></ul><p>默认扩展目录定义在 <a href=https://github.com/pgsty/pig/blob/main/cli/ext/assets/extension.csv><strong><code>cli/ext/assets/extension.csv</code></strong></a></p><p>可用 <code>pig ext reload</code> 命令更新到最新扩展目录，数据将下载到 <code>~/.pig/extension.csv</code>。</p><h2 id=ext-info>ext info</h2><p>显示指定扩展的详细信息。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext info postgis        <span style=color:#8f5902;font-style:italic># 显示 PostGIS 详细信息</span>
</span></span><span style=display:flex><span>pig ext info timescaledb    <span style=color:#8f5902;font-style:italic># 显示 TimescaleDB 信息</span>
</span></span><span style=display:flex><span>pig ext info vector postgis <span style=color:#8f5902;font-style:italic># 显示多个扩展信息</span>
</span></span></code></pre></div><h2 id=ext-avail>ext avail</h2><p>显示扩展的可用性矩阵，展示扩展在不同操作系统、架构和 PostgreSQL 版本上的可用情况。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext avail                     <span style=color:#8f5902;font-style:italic># 显示当前系统上所有包的可用性</span>
</span></span><span style=display:flex><span>pig ext avail timescaledb         <span style=color:#8f5902;font-style:italic># 显示 timescaledb 的可用性矩阵</span>
</span></span><span style=display:flex><span>pig ext avail postgis pg_duckdb   <span style=color:#8f5902;font-style:italic># 显示多个扩展的可用性</span>
</span></span><span style=display:flex><span>pig ext av pgvector               <span style=color:#8f5902;font-style:italic># 显示 pgvector 的可用性</span>
</span></span><span style=display:flex><span>pig ext matrix citus              <span style=color:#8f5902;font-style:italic># avail 命令的别名</span>
</span></span></code></pre></div><p>可用性矩阵会显示扩展在各个操作系统（EL8/9/10, Debian 12/13, Ubuntu 22/24）、架构（x86_64/aarch64）和 PostgreSQL 版本（13-18）上的可用情况。</p><h2 id=ext-status>ext status</h2><p>显示当前 PostgreSQL 实例已安装扩展的状态。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext status              <span style=color:#8f5902;font-style:italic># 显示已安装扩展</span>
</span></span><span style=display:flex><span>pig ext status -c           <span style=color:#8f5902;font-style:italic># 包含 contrib 扩展</span>
</span></span><span style=display:flex><span>pig ext status -v <span style=color:#0000cf;font-weight:700>16</span>        <span style=color:#8f5902;font-style:italic># 显示 PG 16 已安装扩展</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-c|--contrib</code>: 结果中包含 contrib 扩展</li></ul><h2 id=ext-scan>ext scan</h2><p>扫描当前 PostgreSQL 实例已安装的扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext scan <span style=color:#ce5c00;font-weight:700>[</span>-v version<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>该命令会扫描 postgres 扩展目录，查找所有实际已安装的扩展。</p><h2 id=ext-add>ext add</h2><p>安装一个或多个 PostgreSQL 扩展。也可以使用别名 <code>pig install</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext add pg_duckdb            <span style=color:#8f5902;font-style:italic># 安装 pg_duckdb</span>
</span></span><span style=display:flex><span>pig ext add pg_duckdb -v <span style=color:#0000cf;font-weight:700>17</span>      <span style=color:#8f5902;font-style:italic># 为 PG 17 安装</span>
</span></span><span style=display:flex><span>pig ext add pg_duckdb -y         <span style=color:#8f5902;font-style:italic># 自动确认安装</span>
</span></span><span style=display:flex><span>pig ext add vector postgis       <span style=color:#8f5902;font-style:italic># 安装多个扩展</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用别名</span>
</span></span><span style=display:flex><span>pig install pg_duckdb
</span></span><span style=display:flex><span>pig install pg_duckdb -v <span style=color:#0000cf;font-weight:700>17</span> -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装 PostgreSQL 内核</span>
</span></span><span style=display:flex><span>pig ext install pgsql            <span style=color:#8f5902;font-style:italic># 安装最新版 postgresql 内核</span>
</span></span><span style=display:flex><span>pig ext a pg17                   <span style=color:#8f5902;font-style:italic># 安装 postgresql 17 内核包</span>
</span></span><span style=display:flex><span>pig ext ins pg16                 <span style=color:#8f5902;font-style:italic># 安装 postgresql 16 内核包</span>
</span></span><span style=display:flex><span>pig ext install pg15-core        <span style=color:#8f5902;font-style:italic># 安装 postgresql 15 核心包</span>
</span></span><span style=display:flex><span>pig ext install pg14-main -y     <span style=color:#8f5902;font-style:italic># 安装 pg 14 + 常用扩展（vector, repack, wal2json）</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-v|--version</code>：指定 PG 大版本</li><li><code>-y|--yes</code>：自动确认安装</li></ul><h2 id=ext-rm>ext rm</h2><p>移除一个或多个 PostgreSQL 扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext rm pg_duckdb             <span style=color:#8f5902;font-style:italic># 移除 pg_duckdb</span>
</span></span><span style=display:flex><span>pig ext rm pg_duckdb -v <span style=color:#0000cf;font-weight:700>17</span>       <span style=color:#8f5902;font-style:italic># 移除 PG 17 版本</span>
</span></span><span style=display:flex><span>pig ext rm pgvector -y           <span style=color:#8f5902;font-style:italic># 自动确认移除</span>
</span></span></code></pre></div><h2 id=ext-update>ext update</h2><p>将已安装扩展更新到最新版。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext update                   <span style=color:#8f5902;font-style:italic># 更新所有已安装扩展</span>
</span></span><span style=display:flex><span>pig ext update pg_duckdb         <span style=color:#8f5902;font-style:italic># 更新特定扩展</span>
</span></span><span style=display:flex><span>pig ext update postgis timescaledb  <span style=color:#8f5902;font-style:italic># 更新多个扩展</span>
</span></span><span style=display:flex><span>pig ext update -y                <span style=color:#8f5902;font-style:italic># 自动确认更新</span>
</span></span></code></pre></div><h2 id=ext-import>ext import</h2><p>下载扩展包到本地仓库，便于离线安装。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext import postgis                <span style=color:#8f5902;font-style:italic># 导入 PostGIS 包</span>
</span></span><span style=display:flex><span>pig ext import timescaledb pg_cron    <span style=color:#8f5902;font-style:italic># 导入多个扩展包</span>
</span></span><span style=display:flex><span>pig ext import pg16                   <span style=color:#8f5902;font-style:italic># 导入 PostgreSQL 16 包</span>
</span></span><span style=display:flex><span>pig ext import pgsql-common           <span style=color:#8f5902;font-style:italic># 导入常用工具包</span>
</span></span><span style=display:flex><span>pig ext import -d /www/pigsty postgis <span style=color:#8f5902;font-style:italic># 指定路径导入</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-d|--repo</code>: 指定仓库目录（默认：<code>/www/pigsty</code>）</li></ul><h2 id=ext-link>ext link</h2><p>将指定 PG 版本链接到系统 PATH。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext link <span style=color:#0000cf;font-weight:700>18</span>                  <span style=color:#8f5902;font-style:italic># 链接 PG 18 到 PATH</span>
</span></span><span style=display:flex><span>pig ext link <span style=color:#0000cf;font-weight:700>17</span>                  <span style=color:#8f5902;font-style:italic># 链接 PG 17 到 /usr/pgsql</span>
</span></span><span style=display:flex><span>pig ext link /usr/pgsql-16       <span style=color:#8f5902;font-style:italic># 从指定路径链接到 /usr/pgsql</span>
</span></span><span style=display:flex><span>pig ext link null                <span style=color:#8f5902;font-style:italic># 取消当前 PostgreSQL 链接</span>
</span></span></code></pre></div><p>该命令会创建 <code>/usr/pgsql</code> 软链接，并写入 <code>/etc/profile.d/pgsql.sh</code>。</p><h2 id=ext-reload>ext reload</h2><p>从 GitHub 刷新扩展元数据。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig ext reload                   <span style=color:#8f5902;font-style:italic># 刷新扩展目录</span>
</span></span></code></pre></div><p>更新后的文件会放置于 <code>~/.pig/extension.csv</code> 中。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-afe295f820847945a33f6ba709a26753>9 - pig build</h1><div class=lead>使用 pig build 子命令从源码构建扩展</div><p><code>pig build</code> 命令是一个强大的工具，简化了从源码构建 PostgreSQL 扩展的整个工作流程。它提供了完整的构建基础设施设置、依赖管理，以及标准和自定义 PostgreSQL 扩展在不同操作系统上的编译环境。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build - Build Postgres Extension
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Environment Setup:
</span></span><span style=display:flex><span>  pig build spec                   <span style=color:#8f5902;font-style:italic># init build spec and directory (~ext)</span>
</span></span><span style=display:flex><span>  pig build repo                   <span style=color:#8f5902;font-style:italic># init build repo (=repo set, with remove+update)</span>
</span></span><span style=display:flex><span>  pig build tool  <span style=color:#ce5c00;font-weight:700>[</span>mini<span style=color:#000;font-weight:700>|</span>full<span style=color:#000;font-weight:700>|</span>...<span style=color:#ce5c00;font-weight:700>]</span>  <span style=color:#8f5902;font-style:italic># init build toolset</span>
</span></span><span style=display:flex><span>  pig build rust  <span style=color:#ce5c00;font-weight:700>[</span>-y<span style=color:#ce5c00;font-weight:700>]</span>             <span style=color:#8f5902;font-style:italic># install Rust toolchain</span>
</span></span><span style=display:flex><span>  pig build pgrx  <span style=color:#ce5c00;font-weight:700>[</span>-v &lt;ver&gt;<span style=color:#ce5c00;font-weight:700>]</span>       <span style=color:#8f5902;font-style:italic># install &amp; init pgrx (0.16.1)</span>
</span></span><span style=display:flex><span>  pig build proxy <span style=color:#ce5c00;font-weight:700>[</span>id@host:port <span style=color:#ce5c00;font-weight:700>]</span>  <span style=color:#8f5902;font-style:italic># init build proxy (optional)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Package Building:
</span></span><span style=display:flex><span>  pig build pkg   <span style=color:#ce5c00;font-weight:700>[</span>ext<span style=color:#000;font-weight:700>|</span>pkg...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># complete pipeline: get + dep + ext</span>
</span></span><span style=display:flex><span>  pig build get   <span style=color:#ce5c00;font-weight:700>[</span>ext<span style=color:#000;font-weight:700>|</span>pkg...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># download extension source tarball</span>
</span></span><span style=display:flex><span>  pig build dep   <span style=color:#ce5c00;font-weight:700>[</span>ext<span style=color:#000;font-weight:700>|</span>pkg...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># install extension build dependencies</span>
</span></span><span style=display:flex><span>  pig build ext   <span style=color:#ce5c00;font-weight:700>[</span>ext<span style=color:#000;font-weight:700>|</span>pkg...<span style=color:#ce5c00;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># build extension package</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Quick Start:
</span></span><span style=display:flex><span>  pig build spec                   <span style=color:#8f5902;font-style:italic># setup build spec and directory</span>
</span></span><span style=display:flex><span>  pig build pkg citus              <span style=color:#8f5902;font-style:italic># build citus extension</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>build spec</code></td><td style=text-align:left>初始化构建规范仓库</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>build repo</code></td><td style=text-align:left>初始化所需仓库</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build tool</code></td><td style=text-align:left>初始化构建工具</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build rust</code></td><td style=text-align:left>安装 Rust 工具链</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build pgrx</code></td><td style=text-align:left>安装并初始化 pgrx</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build proxy</code></td><td style=text-align:left>初始化构建代理</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>build get</code></td><td style=text-align:left>下载源代码 tarball</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>build dep</code></td><td style=text-align:left>安装扩展构建依赖</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build ext</code></td><td style=text-align:left>构建扩展包</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>build pkg</code></td><td style=text-align:left>完整构建流程：get、dep、ext</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr></tbody></table><h2 id=快速入门>快速入门</h2><p>设置构建环境并构建扩展的最快方式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 步骤 1：初始化构建规范</span>
</span></span><span style=display:flex><span>pig build spec
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 步骤 2：构建扩展（完整流程）</span>
</span></span><span style=display:flex><span>pig build pkg citus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 构建的包将位于：</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - EL: ~/rpmbuild/RPMS/</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Debian: ~/</span>
</span></span></code></pre></div><p>更精细的控制方式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 设置环境</span>
</span></span><span style=display:flex><span>pig build spec                   <span style=color:#8f5902;font-style:italic># 初始化构建规范</span>
</span></span><span style=display:flex><span>pig build repo                   <span style=color:#8f5902;font-style:italic># 设置仓库</span>
</span></span><span style=display:flex><span>pig build tool                   <span style=color:#8f5902;font-style:italic># 安装构建工具</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 构建过程</span>
</span></span><span style=display:flex><span>pig build get citus              <span style=color:#8f5902;font-style:italic># 下载源码</span>
</span></span><span style=display:flex><span>pig build dep citus              <span style=color:#8f5902;font-style:italic># 安装依赖</span>
</span></span><span style=display:flex><span>pig build ext citus              <span style=color:#8f5902;font-style:italic># 构建包</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或一次完成所有三个步骤</span>
</span></span><span style=display:flex><span>pig build pkg citus              <span style=color:#8f5902;font-style:italic># get + dep + ext</span>
</span></span></code></pre></div><h2 id=构建基础设施>构建基础设施</h2><h3 id=目录结构>目录结构</h3><pre tabindex=0><code>~/ext/                           # 默认构建规范目录
├── Makefile                     # 主构建 makefile
├── &lt;extension&gt;/                 # 每个扩展的目录
│   ├── Makefile                # 扩展特定的 makefile
│   ├── &lt;extension&gt;.spec        # RPM 规范文件（EL）
│   └── debian/                 # Debian 打包文件
│       ├── control
│       ├── rules
│       └── ...
</code></pre><p><strong>构建输出位置：</strong></p><ul><li><strong>EL 系统</strong>：<code>~/rpmbuild/RPMS/&lt;arch>/</code></li><li><strong>Debian 系统</strong>：<code>~/</code>（deb 文件）</li></ul><h2 id=build-spec>build spec</h2><p>设置构建规范仓库和目录结构。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build spec                   <span style=color:#8f5902;font-style:italic># 在默认位置初始化 ~/ext</span>
</span></span></code></pre></div><p><strong>功能：</strong></p><ol><li>克隆或更新扩展构建规范仓库</li><li>创建必要的目录结构</li><li>设置 makefile 和构建脚本</li><li>准备平台特定的打包文件</li></ol><p><strong>仓库位置：</strong> 默认 <code>~/ext/</code>，包含 100+ 扩展的构建规范。</p><h2 id=build-repo>build repo</h2><p>初始化构建扩展所需的包仓库。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build repo                   <span style=color:#8f5902;font-style:italic># 等同于：pig repo set（内部执行 remove+update）</span>
</span></span></code></pre></div><p><strong>功能：</strong> 移除现有仓库、添加所有必需仓库（pgdg、pigsty、node）、更新包缓存。</p><h2 id=build-tool>build tool</h2><p>安装必要的开发工具和编译器。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build tool                   <span style=color:#8f5902;font-style:italic># 安装默认工具集</span>
</span></span><span style=display:flex><span>pig build tool mini              <span style=color:#8f5902;font-style:italic># 最小工具集</span>
</span></span><span style=display:flex><span>pig build tool full              <span style=color:#8f5902;font-style:italic># 完整工具集</span>
</span></span><span style=display:flex><span>pig build tool rust              <span style=color:#8f5902;font-style:italic># 添加 Rust 开发工具</span>
</span></span></code></pre></div><p><strong>工具包：</strong></p><ul><li><strong>最小（<code>mini</code>）：</strong> GCC/Clang 编译器、Make 和构建必需品、PostgreSQL 开发头文件、基本库</li><li><strong>默认：</strong> 所有最小工具、额外编译器（g++、clang++）、开发库、打包工具（rpmbuild、dpkg-dev）</li><li><strong>完整（<code>full</code>）：</strong> 所有默认工具、语言特定工具（Python、Perl、Ruby 开发）、高级调试工具、性能分析工具</li></ul><h2 id=build-rust>build rust</h2><p>安装 Rust 编程语言工具链，基于 Rust 的扩展所需。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build rust                   <span style=color:#8f5902;font-style:italic># 带确认安装</span>
</span></span><span style=display:flex><span>pig build rust -y                <span style=color:#8f5902;font-style:italic># 强制重新安装 Rust 工具链</span>
</span></span></code></pre></div><p><strong>安装内容：</strong> Rust 编译器（rustc）、Cargo 包管理器、Rust 标准库、开发工具。</p><h2 id=build-pgrx>build pgrx</h2><p>安装并初始化 PGRX（Rust 的 PostgreSQL 扩展框架）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build pgrx                   <span style=color:#8f5902;font-style:italic># 安装最新稳定版 (0.16.1)</span>
</span></span><span style=display:flex><span>pig build pgrx -v 0.15.0         <span style=color:#8f5902;font-style:italic># 安装特定版本</span>
</span></span></code></pre></div><p><strong>前提条件：</strong> 必须先安装 Rust 工具链、PostgreSQL 开发头文件。</p><h2 id=build-proxy>build proxy</h2><p>为受限互联网访问的构建环境设置代理配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build proxy                  <span style=color:#8f5902;font-style:italic># 交互式设置</span>
</span></span><span style=display:flex><span>pig build proxy user@host:8080   <span style=color:#8f5902;font-style:italic># 直接配置</span>
</span></span><span style=display:flex><span>pig build proxy http://proxy.company.com:3128
</span></span></code></pre></div><h2 id=build-get>build get</h2><p>下载扩展源代码 tarball。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build get citus              <span style=color:#8f5902;font-style:italic># 单个扩展</span>
</span></span><span style=display:flex><span>pig build get citus pgvector     <span style=color:#8f5902;font-style:italic># 多个扩展</span>
</span></span><span style=display:flex><span>pig build get all                <span style=color:#8f5902;font-style:italic># 所有可用扩展</span>
</span></span><span style=display:flex><span>pig build get std                <span style=color:#8f5902;font-style:italic># 标准扩展</span>
</span></span></code></pre></div><h2 id=build-dep>build dep</h2><p>安装构建扩展所需的依赖。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build dep citus              <span style=color:#8f5902;font-style:italic># 单个扩展</span>
</span></span><span style=display:flex><span>pig build dep citus pgvector     <span style=color:#8f5902;font-style:italic># 多个扩展</span>
</span></span><span style=display:flex><span>pig build dep citus --pg 17,16   <span style=color:#8f5902;font-style:italic># 为特定 PG 版本</span>
</span></span></code></pre></div><h2 id=build-ext>build ext</h2><p>编译扩展并创建安装包。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build ext citus              <span style=color:#8f5902;font-style:italic># 构建单个扩展</span>
</span></span><span style=display:flex><span>pig build ext citus pgvector     <span style=color:#8f5902;font-style:italic># 构建多个</span>
</span></span><span style=display:flex><span>pig build ext citus --pg <span style=color:#0000cf;font-weight:700>17</span>      <span style=color:#8f5902;font-style:italic># 为特定 PG 版本</span>
</span></span><span style=display:flex><span>pig build ext citus -s           <span style=color:#8f5902;font-style:italic># 包含调试符号（仅 RPM）</span>
</span></span></code></pre></div><h2 id=build-pkg>build pkg</h2><p>执行完整的构建流程：下载、依赖和构建。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig build pkg citus              <span style=color:#8f5902;font-style:italic># 构建单个扩展</span>
</span></span><span style=display:flex><span>pig build pkg citus pgvector     <span style=color:#8f5902;font-style:italic># 构建多个</span>
</span></span><span style=display:flex><span>pig build pkg citus --pg 17,16   <span style=color:#8f5902;font-style:italic># 为多个 PG 版本</span>
</span></span><span style=display:flex><span>pig build pkg citus -s           <span style=color:#8f5902;font-style:italic># 包含调试符号</span>
</span></span></code></pre></div><h2 id=常见工作流>常见工作流</h2><h3 id=工作流-1构建标准扩展>工作流 1：构建标准扩展</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 设置构建环境（一次性）</span>
</span></span><span style=display:flex><span>pig build spec
</span></span><span style=display:flex><span>pig build repo
</span></span><span style=display:flex><span>pig build tool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 构建扩展</span>
</span></span><span style=display:flex><span>pig build pkg pg_partman
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 安装构建的包</span>
</span></span><span style=display:flex><span>sudo rpm -ivh ~/rpmbuild/RPMS/x86_64/pg_partman*.rpm  <span style=color:#8f5902;font-style:italic># EL</span>
</span></span><span style=display:flex><span>sudo dpkg -i ~/pg_partman*.deb                         <span style=color:#8f5902;font-style:italic># Debian</span>
</span></span></code></pre></div><h3 id=工作流-2构建-rust-扩展>工作流 2：构建 Rust 扩展</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 设置 Rust 环境</span>
</span></span><span style=display:flex><span>pig build spec
</span></span><span style=display:flex><span>pig build tool
</span></span><span style=display:flex><span>pig build rust                   <span style=color:#8f5902;font-style:italic># 如需强制重装可追加 -y</span>
</span></span><span style=display:flex><span>pig build pgrx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 构建 Rust 扩展</span>
</span></span><span style=display:flex><span>pig build pkg pgmq
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 安装</span>
</span></span><span style=display:flex><span>sudo pig ext add pgmq
</span></span></code></pre></div><h3 id=工作流-3构建多个版本>工作流 3：构建多个版本</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 为多个 PostgreSQL 版本构建扩展</span>
</span></span><span style=display:flex><span>pig build pkg citus --pg 15,16,17
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 结果为每个版本生成包：</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># citus_15-*.rpm</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># citus_16-*.rpm</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># citus_17-*.rpm</span>
</span></span></code></pre></div><h2 id=故障排除>故障排除</h2><h3 id=找不到构建工具>找不到构建工具</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装构建工具</span>
</span></span><span style=display:flex><span>pig build tool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 对于特定编译器</span>
</span></span><span style=display:flex><span>sudo dnf groupinstall <span style=color:#4e9a06>&#34;Development Tools&#34;</span>  <span style=color:#8f5902;font-style:italic># EL</span>
</span></span><span style=display:flex><span>sudo apt install build-essential          <span style=color:#8f5902;font-style:italic># Debian</span>
</span></span></code></pre></div><h3 id=缺少依赖>缺少依赖</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装扩展依赖</span>
</span></span><span style=display:flex><span>pig build dep &lt;extension&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查错误消息以了解特定包</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如需要，手动安装</span>
</span></span><span style=display:flex><span>sudo dnf install &lt;package&gt;  <span style=color:#8f5902;font-style:italic># EL</span>
</span></span><span style=display:flex><span>sudo apt install &lt;package&gt;  <span style=color:#8f5902;font-style:italic># Debian</span>
</span></span></code></pre></div><h3 id=找不到-postgresql-头文件>找不到 PostgreSQL 头文件</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装 PostgreSQL 开发包</span>
</span></span><span style=display:flex><span>sudo pig ext install pg18-devel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或指定 pg_config 路径</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PG_CONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/usr/pgsql-18/bin/pg_config
</span></span></code></pre></div><h3 id=rustpgrx-问题>Rust/PGRX 问题</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重新安装 Rust</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#4e9a06>&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs <span style=color:#000;font-weight:700>|</span> sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 更新 PGRX</span>
</span></span><span style=display:flex><span>cargo install cargo-pgrx --force
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重新初始化 PGRX</span>
</span></span><span style=display:flex><span>cargo pgrx init
</span></span></code></pre></div><h2 id=扩展构建矩阵>扩展构建矩阵</h2><h3 id=常见构建的扩展>常见构建的扩展</h3><table class=full-width><thead><tr><th style=text-align:left>扩展</th><th style=text-align:center>类型</th><th style=text-align:left>构建时间</th><th style=text-align:left>复杂度</th><th style=text-align:left>特殊要求</th></tr></thead><tbody><tr><td style=text-align:left>pg_repack</td><td style=text-align:center>C</td><td style=text-align:left>快速</td><td style=text-align:left>简单</td><td style=text-align:left>无</td></tr><tr><td style=text-align:left>pg_partman</td><td style=text-align:center>SQL/PLPGSQL</td><td style=text-align:left>快速</td><td style=text-align:left>简单</td><td style=text-align:left>无</td></tr><tr><td style=text-align:left>citus</td><td style=text-align:center>C</td><td style=text-align:left>中等</td><td style=text-align:left>中等</td><td style=text-align:left>无</td></tr><tr><td style=text-align:left>timescaledb</td><td style=text-align:center>C</td><td style=text-align:left>慢</td><td style=text-align:left>复杂</td><td style=text-align:left>CMake</td></tr><tr><td style=text-align:left>postgis</td><td style=text-align:center>C</td><td style=text-align:left>非常慢</td><td style=text-align:left>复杂</td><td style=text-align:left>GDAL、GEOS、Proj</td></tr><tr><td style=text-align:left>pg_duckdb</td><td style=text-align:center>C++</td><td style=text-align:left>中等</td><td style=text-align:left>中等</td><td style=text-align:left>C++17 编译器</td></tr><tr><td style=text-align:left>pgroonga</td><td style=text-align:center>C</td><td style=text-align:left>中等</td><td style=text-align:left>中等</td><td style=text-align:left>Groonga 库</td></tr><tr><td style=text-align:left>pgvector</td><td style=text-align:center>C</td><td style=text-align:left>快速</td><td style=text-align:left>简单</td><td style=text-align:left>无</td></tr><tr><td style=text-align:left>plpython3</td><td style=text-align:center>C</td><td style=text-align:left>中等</td><td style=text-align:left>中等</td><td style=text-align:left>Python 开发</td></tr><tr><td style=text-align:left>pgrx 扩展</td><td style=text-align:center>Rust</td><td style=text-align:left>慢</td><td style=text-align:left>复杂</td><td style=text-align:left>Rust、PGRX</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-4f56b148399117cd1ee1067d3e359a50>10 - pig sty</h1><div class=lead>使用 pig sty 子命令管理 Pigsty 安装</div><p><strong>pig</strong> 也可作为 Pigsty 的命令行工具使用 —— 这是一款开箱即用的免费 PostgreSQL RDS 解决方案。
它为你的 PostgreSQL 集群带来高可用（HA）、PITR、监控、基础设施即代码（IaC）以及丰富的扩展支持。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty - Init <span style=color:#ce5c00;font-weight:700>(</span>Download<span style=color:#ce5c00;font-weight:700>)</span>, Bootstrap, Configure, and Deploy Pigsty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  pig sty init    <span style=color:#ce5c00;font-weight:700>[</span>-pfvd<span style=color:#ce5c00;font-weight:700>]</span>         <span style=color:#8f5902;font-style:italic># install pigsty (~/pigsty by default)</span>
</span></span><span style=display:flex><span>  pig sty boot    <span style=color:#ce5c00;font-weight:700>[</span>-rpk<span style=color:#ce5c00;font-weight:700>]</span>          <span style=color:#8f5902;font-style:italic># install ansible and prepare offline pkg</span>
</span></span><span style=display:flex><span>  pig sty conf    <span style=color:#ce5c00;font-weight:700>[</span>-cvrsoxnpg<span style=color:#ce5c00;font-weight:700>]</span>    <span style=color:#8f5902;font-style:italic># configure pigsty and generate config</span>
</span></span><span style=display:flex><span>  pig sty deploy                  <span style=color:#8f5902;font-style:italic># use pigsty to deploy everything (CAUTION!)</span>
</span></span><span style=display:flex><span>  pig sty get                     <span style=color:#8f5902;font-style:italic># download pigsty source tarball</span>
</span></span><span style=display:flex><span>  pig sty list                    <span style=color:#8f5902;font-style:italic># list available pigsty versions</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>  pig sty init                 <span style=color:#8f5902;font-style:italic># extract and init ~/pigsty</span>
</span></span><span style=display:flex><span>  pig sty boot                 <span style=color:#8f5902;font-style:italic># install ansible &amp; other deps</span>
</span></span><span style=display:flex><span>  pig sty conf                 <span style=color:#8f5902;font-style:italic># generate pigsty.yml config file</span>
</span></span><span style=display:flex><span>  pig sty deploy               <span style=color:#8f5902;font-style:italic># run the deploy.yml playbook</span>
</span></span></code></pre></div><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>sty init</code></td><td style=text-align:left>安装 Pigsty</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>sty boot</code></td><td style=text-align:left>安装 Ansible 依赖</td><td style=text-align:left>需要 sudo 或 root 权限</td></tr><tr><td style=text-align:left><code>sty conf</code></td><td style=text-align:left>生成配置</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>sty deploy</code></td><td style=text-align:left>运行部署 playbook</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>sty list</code></td><td style=text-align:left>列出可用 Pigsty 版本</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>sty get</code></td><td style=text-align:left>下载 Pigsty 源码压缩包</td><td style=text-align:left></td></tr></tbody></table><h2 id=快速入门>快速入门</h2><p>你可以使用 <code>pig sty</code> 子命令在当前节点引导部署 Pigsty。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty init                     <span style=color:#8f5902;font-style:italic># 安装 Pigsty 到 ~/pigsty</span>
</span></span><span style=display:flex><span>pig sty boot                     <span style=color:#8f5902;font-style:italic># 安装 Ansible 依赖</span>
</span></span><span style=display:flex><span>pig sty conf                     <span style=color:#8f5902;font-style:italic># 生成配置</span>
</span></span><span style=display:flex><span>pig sty deploy                   <span style=color:#8f5902;font-style:italic># 运行部署 playbook</span>
</span></span></code></pre></div><p>详细入门指南请参阅：https://pigsty.io/docs/setup/install/</p><h2 id=sty-init>sty init</h2><p>下载并安装 Pigsty 发行版到 <code>~/pigsty</code> 目录。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty init                   <span style=color:#8f5902;font-style:italic># 使用最新版本安装到 ~/pigsty</span>
</span></span><span style=display:flex><span>pig sty init -f                <span style=color:#8f5902;font-style:italic># 安装并覆盖已有 pigsty 目录</span>
</span></span><span style=display:flex><span>pig sty init -p /tmp/pigsty    <span style=color:#8f5902;font-style:italic># 安装到指定目录 /tmp/pigsty</span>
</span></span><span style=display:flex><span>pig sty init -v 3.4            <span style=color:#8f5902;font-style:italic># 获取并安装指定版本 v3.4.1</span>
</span></span><span style=display:flex><span>pig sty init <span style=color:#0000cf;font-weight:700>3</span>                 <span style=color:#8f5902;font-style:italic># 获取并安装指定主版本 v3 最新</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-p|--path</code>：目标安装目录（默认 &ldquo;~/pigsty&rdquo;）</li><li><code>-f|--force</code>：强制覆盖已存在的 pigsty 目录</li><li><code>-v|--version</code>：pigsty 版本号</li><li><code>-d|--dir</code>：下载目录（默认 &ldquo;/tmp&rdquo;）</li></ul><h2 id=sty-boot>sty boot</h2><p>安装 Ansible 及其依赖。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty boot                     <span style=color:#8f5902;font-style:italic># 安装 Ansible</span>
</span></span><span style=display:flex><span>pig sty boot -r china            <span style=color:#8f5902;font-style:italic># 使用中国区域镜像</span>
</span></span><span style=display:flex><span>pig sty boot -k                  <span style=color:#8f5902;font-style:italic># 保留已有仓库</span>
</span></span><span style=display:flex><span>pig sty boot -p /path/to/pkg     <span style=color:#8f5902;font-style:italic># 指定离线包路径</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-r|--region</code>：区域（default, china, europe&mldr;）</li><li><code>-p|--path</code>：离线包路径</li><li><code>-k|--keep</code>：保留已有仓库</li></ul><p>详见：https://pigsty.io/zh/docs/setup/offline/#bootstrap</p><h2 id=sty-conf>sty conf</h2><p>使用 ./configure 配置 Pigsty，生成配置文件。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty conf                       <span style=color:#8f5902;font-style:italic># 使用默认 meta.yml 配置</span>
</span></span><span style=display:flex><span>pig sty conf -g                    <span style=color:#8f5902;font-style:italic># 生成随机密码（推荐！）</span>
</span></span><span style=display:flex><span>pig sty conf -c rich               <span style=color:#8f5902;font-style:italic># 使用 conf/rich.yml 模板（包含更多扩展）</span>
</span></span><span style=display:flex><span>pig sty conf -c ha/full            <span style=color:#8f5902;font-style:italic># 使用 conf/ha/full.yml 4 节点高可用模板</span>
</span></span><span style=display:flex><span>pig sty conf -c slim               <span style=color:#8f5902;font-style:italic># 使用 conf/slim.yml 模板（最小化安装）</span>
</span></span><span style=display:flex><span>pig sty conf -c supabase           <span style=color:#8f5902;font-style:italic># 使用 conf/supabase.yml 模板（自托管）</span>
</span></span><span style=display:flex><span>pig sty conf -v <span style=color:#0000cf;font-weight:700>17</span> -c rich         <span style=color:#8f5902;font-style:italic># 使用 conf/rich.yml 模板，PostgreSQL 17</span>
</span></span><span style=display:flex><span>pig sty conf -r china -s           <span style=color:#8f5902;font-style:italic># 使用中国区镜像源，跳过 IP 探测</span>
</span></span><span style=display:flex><span>pig sty conf -x                    <span style=color:#8f5902;font-style:italic># 从环境变量写入代理配置到配置文件</span>
</span></span><span style=display:flex><span>pig sty conf -c full -g -o ha.yml  <span style=color:#8f5902;font-style:italic># 完整 HA 模板，随机密码输出到 ha.yml</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><ul><li><code>-c|--conf</code>：配置模板名称（meta/rich/slim/full/supabase/&mldr;）</li><li><code>--ip</code>：主节点 IP 地址</li><li><code>-v|--version</code>：PostgreSQL 主版本（18/17/16/15/14/13）</li><li><code>-r|--region</code>：上游仓库区域（default/china/europe）</li><li><code>-o|--output</code>：输出配置文件路径（默认：pigsty.yml）</li><li><code>-s|--skip</code>：跳过 IP 探测</li><li><code>-p|--port</code>：SSH 端口</li><li><code>-x|--proxy</code>：从环境变量写入代理配置</li><li><code>-n|--non-interactive</code>：非交互模式</li><li><code>-g|--generate</code>：生成随机默认密码（推荐！）</li></ul><p>详见：https://pigsty.io/docs/setup/install/#configure</p><h2 id=sty-deploy>sty deploy</h2><p>使用 deploy.yml 剧本部署 Pigsty。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty deploy       <span style=color:#8f5902;font-style:italic># 执行 deploy.yml（如果找不到则使用 install.yml）</span>
</span></span><span style=display:flex><span>pig sty install      <span style=color:#8f5902;font-style:italic># 与 deploy 相同（向后兼容）</span>
</span></span><span style=display:flex><span>pig sty d            <span style=color:#8f5902;font-style:italic># 短别名</span>
</span></span><span style=display:flex><span>pig sty de           <span style=color:#8f5902;font-style:italic># 短别名</span>
</span></span><span style=display:flex><span>pig sty ins          <span style=color:#8f5902;font-style:italic># 短别名</span>
</span></span></code></pre></div><p>此命令从您的 Pigsty 安装目录执行 deploy.yml 剧本。为保持向后兼容性，如果 deploy.yml 不存在但 install.yml 存在，将使用 install.yml 代替。</p><blockquote><p><strong>警告</strong>：此操作会修改您的系统。请谨慎使用！</p></blockquote><h2 id=sty-list>sty list</h2><p>列出可用的 Pigsty 版本。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty list                     <span style=color:#8f5902;font-style:italic># 列出可用版本</span>
</span></span></code></pre></div><h2 id=sty-get>sty get</h2><p>下载 Pigsty 源码压缩包。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig sty get                      <span style=color:#8f5902;font-style:italic># 下载最新版本</span>
</span></span><span style=display:flex><span>pig sty get v3.4.0               <span style=color:#8f5902;font-style:italic># 下载指定版本</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c1564ad605ae16c3505e326f8fac8171>11 - pig postgres</h1><div class=lead>使用 pig postgres 子命令管理本地 PostgreSQL 服务器</div><p><code>pig pg</code> 命令（别名 <code>pig postgres</code>）用于管理本地 PostgreSQL 服务器和数据库。它封装了 <code>pg_ctl</code>、<code>psql</code>、<code>vacuumdb</code> 等原生工具，提供简化的服务器管理体验。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg - Manage <span style=color:#204a87>local</span> PostgreSQL server and databases.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Server Control <span style=color:#ce5c00;font-weight:700>(</span>via pg_ctl<span style=color:#ce5c00;font-weight:700>)</span>:
</span></span><span style=display:flex><span>  pig pg init     <span style=color:#ce5c00;font-weight:700>[</span>-v ver<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span>     initialize data directory
</span></span><span style=display:flex><span>  pig pg start    <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span>              start PostgreSQL server
</span></span><span style=display:flex><span>  pig pg stop     <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-m fast<span style=color:#ce5c00;font-weight:700>]</span>    stop PostgreSQL server
</span></span><span style=display:flex><span>  pig pg restart  <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-m fast<span style=color:#ce5c00;font-weight:700>]</span>    restart PostgreSQL server
</span></span><span style=display:flex><span>  pig pg reload   <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span>              reload configuration
</span></span><span style=display:flex><span>  pig pg status   <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span>              show server status
</span></span><span style=display:flex><span>  pig pg promote  <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span>              promote standby to primary
</span></span><span style=display:flex><span>  pig pg role     <span style=color:#ce5c00;font-weight:700>[</span>-D datadir<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-V<span style=color:#ce5c00;font-weight:700>]</span>         detect instance role <span style=color:#ce5c00;font-weight:700>(</span>primary/replica<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service Management <span style=color:#ce5c00;font-weight:700>(</span>via systemctl<span style=color:#ce5c00;font-weight:700>)</span>:
</span></span><span style=display:flex><span>  pig pg svc start                          start postgres systemd service
</span></span><span style=display:flex><span>  pig pg svc stop                           stop postgres systemd service
</span></span><span style=display:flex><span>  pig pg svc restart                        restart postgres systemd service
</span></span><span style=display:flex><span>  pig pg svc reload                         reload postgres systemd service
</span></span><span style=display:flex><span>  pig pg svc status                         show postgres service status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Connection <span style=color:#000;font-weight:700>&amp;</span> Query:
</span></span><span style=display:flex><span>  pig pg psql     <span style=color:#ce5c00;font-weight:700>[</span>db<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-c cmd<span style=color:#ce5c00;font-weight:700>]</span>             connect to database via psql
</span></span><span style=display:flex><span>  pig pg ps       <span style=color:#ce5c00;font-weight:700>[</span>-a<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-u user<span style=color:#ce5c00;font-weight:700>]</span>            show current connections
</span></span><span style=display:flex><span>  pig pg <span style=color:#204a87>kill</span>     <span style=color:#ce5c00;font-weight:700>[</span>-x<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-u user<span style=color:#ce5c00;font-weight:700>]</span>            terminate connections <span style=color:#ce5c00;font-weight:700>(</span>dry-run by default<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Database Maintenance:
</span></span><span style=display:flex><span>  pig pg vacuum   <span style=color:#ce5c00;font-weight:700>[</span>db<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-a<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-t table<span style=color:#ce5c00;font-weight:700>]</span>      vacuum tables
</span></span><span style=display:flex><span>  pig pg analyze  <span style=color:#ce5c00;font-weight:700>[</span>db<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-a<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-t table<span style=color:#ce5c00;font-weight:700>]</span>      analyze tables
</span></span><span style=display:flex><span>  pig pg freeze   <span style=color:#ce5c00;font-weight:700>[</span>db<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-a<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-t table<span style=color:#ce5c00;font-weight:700>]</span>      vacuum freeze tables
</span></span><span style=display:flex><span>  pig pg repack   <span style=color:#ce5c00;font-weight:700>[</span>db<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-a<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-t table<span style=color:#ce5c00;font-weight:700>]</span>      repack tables <span style=color:#ce5c00;font-weight:700>(</span>online rebuild<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Utilities:
</span></span><span style=display:flex><span>  pig pg log &lt;list<span style=color:#000;font-weight:700>|</span>tail<span style=color:#000;font-weight:700>|</span>cat<span style=color:#000;font-weight:700>|</span>less&gt;           view PostgreSQL logs
</span></span></code></pre></div><h2 id=命令概览>命令概览</h2><p><strong>服务控制</strong>（pg_ctl 封装）：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>pg init</code></td><td style=text-align:left><code>initdb, i</code></td><td style=text-align:left>初始化数据目录</td><td style=text-align:left>封装 initdb</td></tr><tr><td style=text-align:left><code>pg start</code></td><td style=text-align:left><code>boot, up</code></td><td style=text-align:left>启动 PostgreSQL</td><td style=text-align:left>封装 pg_ctl start</td></tr><tr><td style=text-align:left><code>pg stop</code></td><td style=text-align:left><code>halt, down</code></td><td style=text-align:left>停止 PostgreSQL</td><td style=text-align:left>封装 pg_ctl stop</td></tr><tr><td style=text-align:left><code>pg restart</code></td><td style=text-align:left><code>reboot</code></td><td style=text-align:left>重启 PostgreSQL</td><td style=text-align:left>封装 pg_ctl restart</td></tr><tr><td style=text-align:left><code>pg reload</code></td><td style=text-align:left><code>hup</code></td><td style=text-align:left>重载配置</td><td style=text-align:left>封装 pg_ctl reload</td></tr><tr><td style=text-align:left><code>pg status</code></td><td style=text-align:left><code>st, stat</code></td><td style=text-align:left>查看服务状态</td><td style=text-align:left>显示进程与相关服务状态</td></tr><tr><td style=text-align:left><code>pg promote</code></td><td style=text-align:left><code>pro</code></td><td style=text-align:left>提升备库为主库</td><td style=text-align:left>封装 pg_ctl promote</td></tr><tr><td style=text-align:left><code>pg role</code></td><td style=text-align:left><code>r</code></td><td style=text-align:left>检测实例角色</td><td style=text-align:left>输出 primary/replica</td></tr></tbody></table><p><strong>连接与查询</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>pg psql</code></td><td style=text-align:left><code>sql, connect</code></td><td style=text-align:left>连接到数据库</td><td style=text-align:left>封装 psql</td></tr><tr><td style=text-align:left><code>pg ps</code></td><td style=text-align:left><code>activity, act</code></td><td style=text-align:left>显示当前连接</td><td style=text-align:left>查询 pg_stat_activity</td></tr><tr><td style=text-align:left><code>pg kill</code></td><td style=text-align:left><code>k</code></td><td style=text-align:left>终止连接</td><td style=text-align:left>默认 dry-run 模式</td></tr></tbody></table><p><strong>数据库维护</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>pg vacuum</code></td><td style=text-align:left><code>vac, vc</code></td><td style=text-align:left>清理表</td><td style=text-align:left>封装 vacuumdb</td></tr><tr><td style=text-align:left><code>pg analyze</code></td><td style=text-align:left><code>ana, az</code></td><td style=text-align:left>分析表</td><td style=text-align:left>封装 vacuumdb &ndash;analyze-only</td></tr><tr><td style=text-align:left><code>pg freeze</code></td><td style=text-align:left><code>frz</code></td><td style=text-align:left>冻结清理表</td><td style=text-align:left>封装 vacuumdb &ndash;freeze</td></tr><tr><td style=text-align:left><code>pg repack</code></td><td style=text-align:left><code>rp</code></td><td style=text-align:left>在线重整表</td><td style=text-align:left>需要 pg_repack 扩展</td></tr></tbody></table><p><strong>日志工具</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>备注</th></tr></thead><tbody><tr><td style=text-align:left><code>pg log</code></td><td style=text-align:left><code>l</code></td><td style=text-align:left>日志管理</td><td style=text-align:left>父命令</td></tr><tr><td style=text-align:left><code>pg log list</code></td><td style=text-align:left><code>ls</code></td><td style=text-align:left>列出日志文件</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>pg log tail</code></td><td style=text-align:left><code>t, f</code></td><td style=text-align:left>实时查看日志</td><td style=text-align:left>tail -f</td></tr><tr><td style=text-align:left><code>pg log cat</code></td><td style=text-align:left><code>c</code></td><td style=text-align:left>输出日志内容</td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>pg log less</code></td><td style=text-align:left><code>vi, v</code></td><td style=text-align:left>用 less 查看</td><td style=text-align:left></td></tr></tbody></table><blockquote><p><code>v1.0.0</code> 已知问题：<code>pig pg log grep</code> 存在参数冲突导致不可用。可使用 <code>pig pg log cat | grep PATTERN</code> 作为替代。</p></blockquote><p><strong>服务子命令</strong>（<code>pg svc</code>）：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>pg svc start</code></td><td style=text-align:left><code>boot, up</code></td><td style=text-align:left>启动 postgres 服务</td></tr><tr><td style=text-align:left><code>pg svc stop</code></td><td style=text-align:left><code>halt, dn, down</code></td><td style=text-align:left>停止 postgres 服务</td></tr><tr><td style=text-align:left><code>pg svc restart</code></td><td style=text-align:left><code>reboot, rt</code></td><td style=text-align:left>重启 postgres 服务</td></tr><tr><td style=text-align:left><code>pg svc reload</code></td><td style=text-align:left><code>rl, hup</code></td><td style=text-align:left>重载 postgres 服务</td></tr><tr><td style=text-align:left><code>pg svc status</code></td><td style=text-align:left><code>st, stat</code></td><td style=text-align:left>显示服务状态</td></tr></tbody></table><h2 id=快速入门>快速入门</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 服务控制</span>
</span></span><span style=display:flex><span>pig pg init                       <span style=color:#8f5902;font-style:italic># 初始化数据目录</span>
</span></span><span style=display:flex><span>pig pg start                      <span style=color:#8f5902;font-style:italic># 启动 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pg status                     <span style=color:#8f5902;font-style:italic># 查看状态</span>
</span></span><span style=display:flex><span>pig pg stop                       <span style=color:#8f5902;font-style:italic># 停止 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pg restart                    <span style=color:#8f5902;font-style:italic># 重启 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pg reload                     <span style=color:#8f5902;font-style:italic># 重载配置</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 连接与查询</span>
</span></span><span style=display:flex><span>pig pg psql                       <span style=color:#8f5902;font-style:italic># 连接到 postgres 数据库</span>
</span></span><span style=display:flex><span>pig pg psql mydb                  <span style=color:#8f5902;font-style:italic># 连接到指定数据库</span>
</span></span><span style=display:flex><span>pig pg ps                         <span style=color:#8f5902;font-style:italic># 查看当前连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -x                    <span style=color:#8f5902;font-style:italic># 终止连接（需要 -x 确认执行）</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 数据库维护</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb                <span style=color:#8f5902;font-style:italic># 清理指定数据库</span>
</span></span><span style=display:flex><span>pig pg analyze mydb               <span style=color:#8f5902;font-style:italic># 分析指定数据库</span>
</span></span><span style=display:flex><span>pig pg repack mydb                <span style=color:#8f5902;font-style:italic># 在线重整数据库</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 日志查看</span>
</span></span><span style=display:flex><span>pig pg log tail                   <span style=color:#8f5902;font-style:italic># 实时查看最新日志</span>
</span></span><span style=display:flex><span>pig pg log list --log-dir /var/log/pg  <span style=color:#8f5902;font-style:italic># 使用自定义日志目录</span>
</span></span><span style=display:flex><span>pig pg log cat <span style=color:#000;font-weight:700>|</span> grep ERROR       <span style=color:#8f5902;font-style:italic># 在 shell 中过滤日志</span>
</span></span></code></pre></div><h2 id=全局参数>全局参数</h2><p>以下参数适用于所有 <code>pig pg</code> 子命令：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--version</code></td><td style=text-align:left><code>-v</code></td><td style=text-align:left>自动检测</td><td style=text-align:left>PostgreSQL 主版本号</td></tr><tr><td style=text-align:left><code>--data</code></td><td style=text-align:left><code>-D</code></td><td style=text-align:left><code>/pg/data</code></td><td style=text-align:left>数据目录路径</td></tr><tr><td style=text-align:left><code>--dbsu</code></td><td style=text-align:left><code>-U</code></td><td style=text-align:left><code>postgres</code></td><td style=text-align:left>数据库超级用户（或 <code>$PIG_DBSU</code> 环境变量）</td></tr></tbody></table><p><strong>版本检测逻辑：</strong></p><ol><li>如果指定了 <code>-v</code>，使用指定版本</li><li>否则从数据目录的 <code>PG_VERSION</code> 文件读取版本</li><li>如果都无法获取，使用 PATH 中的默认 PostgreSQL</li></ol><h2 id=服务控制命令>服务控制命令</h2><h3 id=pg-init>pg init</h3><p>初始化 PostgreSQL 数据目录。封装 <code>initdb</code> 命令。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg init                       <span style=color:#8f5902;font-style:italic># 使用默认设置初始化</span>
</span></span><span style=display:flex><span>pig pg init -v <span style=color:#0000cf;font-weight:700>17</span>                 <span style=color:#8f5902;font-style:italic># 指定 PostgreSQL 17</span>
</span></span><span style=display:flex><span>pig pg init -D /data/pg17         <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span><span style=display:flex><span>pig pg init -k                    <span style=color:#8f5902;font-style:italic># 启用数据校验和</span>
</span></span><span style=display:flex><span>pig pg init -f                    <span style=color:#8f5902;font-style:italic># 强制初始化（删除已有数据）</span>
</span></span><span style=display:flex><span>pig pg init -- --waldir<span style=color:#ce5c00;font-weight:700>=</span>/wal      <span style=color:#8f5902;font-style:italic># 传递额外参数给 initdb</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--encoding</code></td><td style=text-align:left><code>-E</code></td><td style=text-align:left>UTF8</td><td style=text-align:left>数据库编码</td></tr><tr><td style=text-align:left><code>--locale</code></td><td style=text-align:left></td><td style=text-align:left>C</td><td style=text-align:left>区域设置</td></tr><tr><td style=text-align:left><code>--data-checksum</code></td><td style=text-align:left><code>-k</code></td><td style=text-align:left>false</td><td style=text-align:left>启用数据校验和</td></tr><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>false</td><td style=text-align:left>强制初始化，删除已有数据（危险！）</td></tr></tbody></table><p><strong>安全机制：</strong> 即使使用 <code>--force</code>，如果 PostgreSQL 正在运行，命令也会拒绝执行，以防止数据丢失。</p><h3 id=pg-start>pg start</h3><p>启动 PostgreSQL 服务器。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg start                      <span style=color:#8f5902;font-style:italic># 使用默认设置启动</span>
</span></span><span style=display:flex><span>pig pg up                         <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg boot                       <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg start -D /data/pg17        <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span><span style=display:flex><span>pig pg start -l /pg/log/pg.log    <span style=color:#8f5902;font-style:italic># 重定向输出到日志文件</span>
</span></span><span style=display:flex><span>pig pg start -o <span style=color:#4e9a06>&#34;-p 5433&#34;</span>         <span style=color:#8f5902;font-style:italic># 传递参数给 postgres</span>
</span></span><span style=display:flex><span>pig pg start -y                   <span style=color:#8f5902;font-style:italic># 强制启动（跳过运行检查）</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--log</code></td><td style=text-align:left><code>-l</code></td><td style=text-align:left>重定向 stdout/stderr 到日志文件</td></tr><tr><td style=text-align:left><code>--timeout</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>等待超时（秒）</td></tr><tr><td style=text-align:left><code>--no-wait</code></td><td style=text-align:left><code>-W</code></td><td style=text-align:left>不等待启动完成</td></tr><tr><td style=text-align:left><code>--options</code></td><td style=text-align:left><code>-o</code></td><td style=text-align:left>传递给 postgres 的选项</td></tr><tr><td style=text-align:left><code>--yes</code></td><td style=text-align:left><code>-y</code></td><td style=text-align:left>强制启动（即使已运行）</td></tr></tbody></table><h3 id=pg-stop>pg stop</h3><p>停止 PostgreSQL 服务器。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg stop                       <span style=color:#8f5902;font-style:italic># 快速停止（默认）</span>
</span></span><span style=display:flex><span>pig pg down                       <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg halt                       <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg stop -m smart              <span style=color:#8f5902;font-style:italic># 等待客户端断开</span>
</span></span><span style=display:flex><span>pig pg stop -m immediate          <span style=color:#8f5902;font-style:italic># 立即关闭</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--mode</code></td><td style=text-align:left><code>-m</code></td><td style=text-align:left>fast</td><td style=text-align:left>关闭模式：smart/fast/immediate</td></tr><tr><td style=text-align:left><code>--timeout</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>60</td><td style=text-align:left>等待超时（秒）</td></tr><tr><td style=text-align:left><code>--no-wait</code></td><td style=text-align:left><code>-W</code></td><td style=text-align:left>false</td><td style=text-align:left>不等待关闭完成</td></tr></tbody></table><p><strong>关闭模式说明：</strong></p><table class=full-width><thead><tr><th style=text-align:left>模式</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>smart</code></td><td style=text-align:left>等待所有客户端断开后关闭</td></tr><tr><td style=text-align:left><code>fast</code></td><td style=text-align:left>回滚活动事务，断开客户端，正常关闭</td></tr><tr><td style=text-align:left><code>immediate</code></td><td style=text-align:left>立即终止所有进程，下次启动需要恢复</td></tr></tbody></table><h3 id=pg-restart>pg restart</h3><p>重启 PostgreSQL 服务器。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg restart                    <span style=color:#8f5902;font-style:italic># 快速重启</span>
</span></span><span style=display:flex><span>pig pg reboot                     <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg restart -m immediate       <span style=color:#8f5902;font-style:italic># 立即重启</span>
</span></span><span style=display:flex><span>pig pg restart -o <span style=color:#4e9a06>&#34;-p 5433&#34;</span>       <span style=color:#8f5902;font-style:italic># 使用新选项重启</span>
</span></span></code></pre></div><p><strong>选项：</strong> 与 <code>pg stop</code> 相同，另外支持 <code>--options</code>（<code>-o</code>）传递给 postgres。</p><h3 id=pg-reload>pg reload</h3><p>重载 PostgreSQL 配置。向服务器发送 SIGHUP 信号。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg reload                     <span style=color:#8f5902;font-style:italic># 重载配置</span>
</span></span><span style=display:flex><span>pig pg hup                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg reload -D /data/pg17       <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span></code></pre></div><h3 id=pg-status>pg status</h3><p>显示 PostgreSQL 服务器状态。此命令不仅显示 <code>pg_ctl status</code> 的结果，还会显示 postgres 相关进程和 Pigsty 相关服务的状态。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg status                     <span style=color:#8f5902;font-style:italic># 查看服务状态</span>
</span></span><span style=display:flex><span>pig pg st                         <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg status -D /data/pg17       <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span></code></pre></div><p><strong>输出内容：</strong></p><ol><li><code>pg_ctl status</code> 输出（进程是否运行、PID 等）</li><li>PostgreSQL 进程列表（<code>ps -u postgres</code>）</li><li>相关服务状态：<ul><li><code>postgres</code>：PostgreSQL systemd 服务</li><li><code>patroni</code>：Patroni HA 管理服务</li><li><code>pgbouncer</code>：连接池服务</li><li><code>pgbackrest</code>：备份服务</li><li><code>vip-manager</code>：VIP 管理服务</li><li><code>haproxy</code>：负载均衡服务</li></ul></li></ol><h3 id=pg-promote>pg promote</h3><p>将备库提升为主库。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg promote                    <span style=color:#8f5902;font-style:italic># 提升备库</span>
</span></span><span style=display:flex><span>pig pg pro                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg promote -D /data/pg17      <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--timeout</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>等待超时（秒）</td></tr><tr><td style=text-align:left><code>--no-wait</code></td><td style=text-align:left><code>-W</code></td><td style=text-align:left>不等待提升完成</td></tr></tbody></table><h3 id=pg-role>pg role</h3><p>检测 PostgreSQL 实例的角色（主库或备库）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg role                       <span style=color:#8f5902;font-style:italic># 输出：primary、replica 或 unknown</span>
</span></span><span style=display:flex><span>pig pg role -V                    <span style=color:#8f5902;font-style:italic># 详细输出，显示检测过程</span>
</span></span><span style=display:flex><span>pig pg role -D /data/pg17         <span style=color:#8f5902;font-style:italic># 指定数据目录</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--verbose</code></td><td style=text-align:left><code>-V</code></td><td style=text-align:left>显示详细检测过程</td></tr></tbody></table><p><strong>输出说明：</strong></p><ul><li><code>primary</code>：当前实例为主库</li><li><code>replica</code>：当前实例为备库</li><li><code>unknown</code>：无法确定实例角色</li></ul><p><strong>检测策略（按优先级）：</strong></p><ol><li><strong>进程检测</strong>：检查 <code>walreceiver</code>、<code>recovery</code> 等进程</li><li><strong>SQL 查询</strong>：执行 <code>pg_is_in_recovery()</code> 查询（需要 PostgreSQL 运行）</li><li><strong>数据目录检查</strong>：检查 <code>standby.signal</code>、<code>recovery.signal</code>、<code>recovery.conf</code> 文件</li></ol><h2 id=连接与查询命令>连接与查询命令</h2><h3 id=pg-psql>pg psql</h3><p>通过 psql 连接到 PostgreSQL 数据库。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg psql                       <span style=color:#8f5902;font-style:italic># 连接到 postgres 数据库</span>
</span></span><span style=display:flex><span>pig pg sql                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg connect                    <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg psql mydb                  <span style=color:#8f5902;font-style:italic># 连接到指定数据库</span>
</span></span><span style=display:flex><span>pig pg psql mydb -c <span style=color:#4e9a06>&#34;SELECT 1&#34;</span>    <span style=color:#8f5902;font-style:italic># 执行单条命令</span>
</span></span><span style=display:flex><span>pig pg psql -f script.sql         <span style=color:#8f5902;font-style:italic># 执行 SQL 脚本文件</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--command</code></td><td style=text-align:left><code>-c</code></td><td style=text-align:left>执行单条 SQL 命令</td></tr><tr><td style=text-align:left><code>--file</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>执行 SQL 脚本文件</td></tr></tbody></table><h3 id=pg-ps>pg ps</h3><p>显示 PostgreSQL 当前连接。查询 <code>pg_stat_activity</code> 视图。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg ps                         <span style=color:#8f5902;font-style:italic># 显示客户端连接</span>
</span></span><span style=display:flex><span>pig pg activity                   <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg act                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg ps -a                      <span style=color:#8f5902;font-style:italic># 显示所有连接（包括系统进程）</span>
</span></span><span style=display:flex><span>pig pg ps -u admin                <span style=color:#8f5902;font-style:italic># 按用户筛选</span>
</span></span><span style=display:flex><span>pig pg ps -d mydb                 <span style=color:#8f5902;font-style:italic># 按数据库筛选</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--all</code></td><td style=text-align:left><code>-a</code></td><td style=text-align:left>显示所有连接（包括系统进程）</td></tr><tr><td style=text-align:left><code>--user</code></td><td style=text-align:left><code>-u</code></td><td style=text-align:left>按用户筛选</td></tr><tr><td style=text-align:left><code>--database</code></td><td style=text-align:left><code>-d</code></td><td style=text-align:left>按数据库筛选</td></tr></tbody></table><h3 id=pg-kill>pg kill</h3><p>终止 PostgreSQL 连接。<strong>默认为 dry-run 模式</strong>，需要 <code>-x</code> 参数才会实际执行。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span>                       <span style=color:#8f5902;font-style:italic># 显示将被终止的连接（dry-run）</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -x                    <span style=color:#8f5902;font-style:italic># 实际终止连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> --pid <span style=color:#0000cf;font-weight:700>12345</span> -x        <span style=color:#8f5902;font-style:italic># 终止指定 PID</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -u admin -x           <span style=color:#8f5902;font-style:italic># 终止指定用户的连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -d mydb -x            <span style=color:#8f5902;font-style:italic># 终止指定数据库的连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -s idle -x            <span style=color:#8f5902;font-style:italic># 终止空闲连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> --cancel -x           <span style=color:#8f5902;font-style:italic># 取消查询而非终止连接</span>
</span></span><span style=display:flex><span>pig pg <span style=color:#204a87>kill</span> -w <span style=color:#0000cf;font-weight:700>5</span> -x               <span style=color:#8f5902;font-style:italic># 每 5 秒重复执行</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--execute</code></td><td style=text-align:left><code>-x</code></td><td style=text-align:left>实际执行（默认为 dry-run）</td></tr><tr><td style=text-align:left><code>--pid</code></td><td style=text-align:left></td><td style=text-align:left>终止指定 PID</td></tr><tr><td style=text-align:left><code>--user</code></td><td style=text-align:left><code>-u</code></td><td style=text-align:left>按用户筛选</td></tr><tr><td style=text-align:left><code>--database</code></td><td style=text-align:left><code>-d</code></td><td style=text-align:left>按数据库筛选</td></tr><tr><td style=text-align:left><code>--state</code></td><td style=text-align:left><code>-s</code></td><td style=text-align:left>按状态筛选（idle/active/idle in transaction）</td></tr><tr><td style=text-align:left><code>--query</code></td><td style=text-align:left><code>-q</code></td><td style=text-align:left>按查询模式筛选</td></tr><tr><td style=text-align:left><code>--all</code></td><td style=text-align:left><code>-a</code></td><td style=text-align:left>包括复制连接</td></tr><tr><td style=text-align:left><code>--cancel</code></td><td style=text-align:left><code>-c</code></td><td style=text-align:left>取消查询而非终止连接</td></tr><tr><td style=text-align:left><code>--watch</code></td><td style=text-align:left><code>-w</code></td><td style=text-align:left>每 N 秒重复执行</td></tr></tbody></table><p><strong>安全说明：</strong> <code>--state</code> 和 <code>--query</code> 参数会进行标识符验证，只接受简单的字母数字模式，以防止 SQL 注入。</p><h2 id=数据库维护命令>数据库维护命令</h2><h3 id=pg-vacuum>pg vacuum</h3><p>清理数据库表。封装 <code>vacuumdb</code> 命令。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg vacuum                     <span style=color:#8f5902;font-style:italic># 清理当前数据库</span>
</span></span><span style=display:flex><span>pig pg vac                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb                <span style=color:#8f5902;font-style:italic># 清理指定数据库</span>
</span></span><span style=display:flex><span>pig pg vacuum -a                  <span style=color:#8f5902;font-style:italic># 清理所有数据库</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb -t mytable     <span style=color:#8f5902;font-style:italic># 清理指定表</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb -n myschema    <span style=color:#8f5902;font-style:italic># 清理指定 schema 中的表</span>
</span></span><span style=display:flex><span>pig pg vacuum mydb --full         <span style=color:#8f5902;font-style:italic># VACUUM FULL（需要排他锁）</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--all</code></td><td style=text-align:left><code>-a</code></td><td style=text-align:left>处理所有数据库</td></tr><tr><td style=text-align:left><code>--schema</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>指定 schema</td></tr><tr><td style=text-align:left><code>--table</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>指定表名</td></tr><tr><td style=text-align:left><code>--verbose</code></td><td style=text-align:left><code>-V</code></td><td style=text-align:left>详细输出</td></tr><tr><td style=text-align:left><code>--full</code></td><td style=text-align:left><code>-F</code></td><td style=text-align:left>VACUUM FULL（需要排他锁）</td></tr></tbody></table><p><strong>安全说明：</strong> <code>--schema</code> 和 <code>--table</code> 参数会进行标识符验证，只接受有效的 PostgreSQL 标识符格式。</p><h3 id=pg-analyze>pg analyze</h3><p>分析数据库表以更新统计信息。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg analyze                    <span style=color:#8f5902;font-style:italic># 分析当前数据库</span>
</span></span><span style=display:flex><span>pig pg ana                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg analyze mydb               <span style=color:#8f5902;font-style:italic># 分析指定数据库</span>
</span></span><span style=display:flex><span>pig pg analyze -a                 <span style=color:#8f5902;font-style:italic># 分析所有数据库</span>
</span></span><span style=display:flex><span>pig pg analyze mydb -t mytable    <span style=color:#8f5902;font-style:italic># 分析指定表</span>
</span></span></code></pre></div><p><strong>选项：</strong> 与 <code>pg vacuum</code> 相同（不含 <code>--full</code>）。</p><h3 id=pg-freeze>pg freeze</h3><p>对数据库表执行冻结清理（vacuum freeze），防止事务 ID 回卷。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg freeze                     <span style=color:#8f5902;font-style:italic># 冻结清理当前数据库</span>
</span></span><span style=display:flex><span>pig pg freeze mydb                <span style=color:#8f5902;font-style:italic># 冻结清理指定数据库</span>
</span></span><span style=display:flex><span>pig pg freeze -a                  <span style=color:#8f5902;font-style:italic># 冻结清理所有数据库</span>
</span></span><span style=display:flex><span>pig pg freeze mydb -t mytable     <span style=color:#8f5902;font-style:italic># 冻结清理指定表</span>
</span></span></code></pre></div><p><strong>选项：</strong> 与 <code>pg vacuum</code> 相同（不含 <code>--full</code>）。</p><h3 id=pg-repack>pg repack</h3><p>在线重整数据库表。需要安装 <code>pg_repack</code> 扩展。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg repack mydb                <span style=color:#8f5902;font-style:italic># 重整数据库中所有表</span>
</span></span><span style=display:flex><span>pig pg rp mydb                    <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg repack -a                  <span style=color:#8f5902;font-style:italic># 重整所有数据库</span>
</span></span><span style=display:flex><span>pig pg repack mydb -t mytable     <span style=color:#8f5902;font-style:italic># 重整指定表</span>
</span></span><span style=display:flex><span>pig pg repack mydb -n myschema    <span style=color:#8f5902;font-style:italic># 重整指定 schema 中的表</span>
</span></span><span style=display:flex><span>pig pg repack mydb -j <span style=color:#0000cf;font-weight:700>4</span>           <span style=color:#8f5902;font-style:italic># 使用 4 个并行任务</span>
</span></span><span style=display:flex><span>pig pg repack mydb --dry-run      <span style=color:#8f5902;font-style:italic># 显示将被重整的表</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--all</code></td><td style=text-align:left><code>-a</code></td><td style=text-align:left>处理所有数据库</td></tr><tr><td style=text-align:left><code>--schema</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>指定 schema</td></tr><tr><td style=text-align:left><code>--table</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>指定表名</td></tr><tr><td style=text-align:left><code>--verbose</code></td><td style=text-align:left><code>-V</code></td><td style=text-align:left>详细输出</td></tr><tr><td style=text-align:left><code>--jobs</code></td><td style=text-align:left><code>-j</code></td><td style=text-align:left>并行任务数（默认 1）</td></tr><tr><td style=text-align:left><code>--dry-run</code></td><td style=text-align:left><code>-N</code></td><td style=text-align:left>显示将被重整的表</td></tr></tbody></table><h2 id=日志命令>日志命令</h2><p>日志命令用于查看 PostgreSQL 日志文件。默认日志目录为 <code>/pg/log/postgres</code>，可通过 <code>--log-dir</code> 参数指定其他目录。</p><p><strong>日志命令全局参数：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--log-dir</code></td><td style=text-align:left>日志目录路径（默认：<code>/pg/log/postgres</code>）</td></tr></tbody></table><p><strong>权限处理：</strong> 如果当前用户没有权限读取日志目录，命令会自动使用 <code>sudo</code> 重试。</p><h3 id=pg-log-list>pg log list</h3><p>列出日志目录中的日志文件。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg log list                              <span style=color:#8f5902;font-style:italic># 列出默认目录中的日志</span>
</span></span><span style=display:flex><span>pig pg log ls                                <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log list --log-dir /var/log/postgres  <span style=color:#8f5902;font-style:italic># 列出指定目录中的日志</span>
</span></span></code></pre></div><h3 id=pg-log-tail>pg log tail</h3><p>实时查看日志文件（类似 <code>tail -f</code>）。默认查看最新的 CSV 日志文件。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg log tail                   <span style=color:#8f5902;font-style:italic># 查看最新日志</span>
</span></span><span style=display:flex><span>pig pg log t                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log f                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log tail postgresql.csv    <span style=color:#8f5902;font-style:italic># 查看指定日志文件</span>
</span></span><span style=display:flex><span>pig pg log tail -n <span style=color:#0000cf;font-weight:700>100</span>            <span style=color:#8f5902;font-style:italic># 显示最后 100 行后开始跟踪</span>
</span></span><span style=display:flex><span>pig pg log tail --log-dir /var/log/postgres  <span style=color:#8f5902;font-style:italic># 使用自定义目录</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--lines</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>50</td><td style=text-align:left>显示的行数</td></tr></tbody></table><h3 id=pg-log-cat>pg log cat</h3><p>输出日志文件内容。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg log cat                    <span style=color:#8f5902;font-style:italic># 输出最新日志</span>
</span></span><span style=display:flex><span>pig pg log c                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log cat -n <span style=color:#0000cf;font-weight:700>100</span>             <span style=color:#8f5902;font-style:italic># 输出最后 100 行</span>
</span></span><span style=display:flex><span>pig pg log cat postgresql.csv     <span style=color:#8f5902;font-style:italic># 输出指定日志文件</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--lines</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>100</td><td style=text-align:left>显示的行数</td></tr></tbody></table><h3 id=pg-log-less>pg log less</h3><p>用 less 打开日志文件。默认定位到文件末尾（<code>+G</code>）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg log less                   <span style=color:#8f5902;font-style:italic># 用 less 打开最新日志</span>
</span></span><span style=display:flex><span>pig pg log vi                     <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log v                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pg log less postgresql.csv    <span style=color:#8f5902;font-style:italic># 打开指定日志文件</span>
</span></span></code></pre></div><h2 id=pg-svc-子命令>pg svc 子命令</h2><p><code>pg svc</code> 提供通过 systemctl 管理 PostgreSQL 服务的功能：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg svc start                 <span style=color:#8f5902;font-style:italic># 启动 postgres 服务</span>
</span></span><span style=display:flex><span>pig pg svc stop                  <span style=color:#8f5902;font-style:italic># 停止 postgres 服务</span>
</span></span><span style=display:flex><span>pig pg svc restart               <span style=color:#8f5902;font-style:italic># 重启 postgres 服务</span>
</span></span><span style=display:flex><span>pig pg svc reload                <span style=color:#8f5902;font-style:italic># 重载 postgres 服务</span>
</span></span><span style=display:flex><span>pig pg svc status                <span style=color:#8f5902;font-style:italic># 显示服务状态</span>
</span></span></code></pre></div><p><strong>别名对照：</strong></p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th></tr></thead><tbody><tr><td style=text-align:left><code>pg svc start</code></td><td style=text-align:left><code>boot, up</code></td></tr><tr><td style=text-align:left><code>pg svc stop</code></td><td style=text-align:left><code>halt, dn, down</code></td></tr><tr><td style=text-align:left><code>pg svc restart</code></td><td style=text-align:left><code>reboot, rt</code></td></tr><tr><td style=text-align:left><code>pg svc reload</code></td><td style=text-align:left><code>rl, hup</code></td></tr><tr><td style=text-align:left><code>pg svc status</code></td><td style=text-align:left><code>st, stat</code></td></tr></tbody></table><h2 id=设计说明>设计说明</h2><p><strong>与原生工具的关系：</strong></p><p><code>pig pg</code> 并非对 PostgreSQL 原生工具的简单封装，而是针对常用操作的上层抽象：</p><ul><li>服务控制命令（init/start/stop/restart/reload/promote）调用 <code>pg_ctl</code></li><li><code>status</code> 命令除了 <code>pg_ctl status</code> 外，还显示进程和相关服务状态</li><li>连接管理命令（psql/ps/kill）调用 <code>psql</code></li><li>维护命令（vacuum/analyze）调用 <code>vacuumdb</code></li><li>repack 命令调用 <code>pg_repack</code></li><li>日志命令调用 <code>tail</code>、<code>less</code>、<code>grep</code> 等系统工具</li><li><code>pg svc</code> 命令调用 <code>systemctl</code></li></ul><p>如需使用原生工具的完整功能，可直接调用相应命令。</p><p><strong>权限处理：</strong></p><ul><li>如果当前用户已是 DBSU：直接执行命令</li><li>如果当前用户是 root：使用 <code>su - postgres -c "..."</code> 执行</li><li>其他用户：使用 <code>sudo -inu postgres -- ...</code> 执行</li></ul><p><strong>安全性考虑：</strong></p><ul><li><code>--state</code>、<code>--query</code>、<code>--schema</code>、<code>--table</code> 等参数都经过标识符验证，防止 SQL 注入</li><li><code>pg kill</code> 默认为 dry-run 模式，避免误操作</li><li>日志命令在权限不足时自动使用 sudo</li></ul><p><strong>平台支持：</strong></p><p>此命令专为 Linux 系统设计，部分功能依赖 <code>systemctl</code>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8a4e12d310edfe7066367b6d57b2a3a6>12 - pig patroni</h1><div class=lead>使用 pig patroni 子命令管理 Patroni 服务与集群</div><hr><h2 id=categories-参考>title: &ldquo;pig patroni&rdquo;
description: &ldquo;使用 pig patroni 子命令管理 Patroni 服务与集群&rdquo;
weight: 170
icon: fas fa-infinity
module: [PIG]
categories: [参考]</h2><p><code>pig patroni</code> 命令（别名 <code>pig pt</code>）用于管理 Patroni 服务和 PostgreSQL HA 集群。它封装了常用的 <code>patronictl</code> 和 <code>systemctl</code> 操作，提供简化的集群管理体验。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt - Manage Patroni cluster using patronictl commands.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Cluster Operations <span style=color:#ce5c00;font-weight:700>(</span>via patronictl<span style=color:#ce5c00;font-weight:700>)</span>:
</span></span><span style=display:flex><span>  pig pt list                      list cluster members
</span></span><span style=display:flex><span>  pig pt restart <span style=color:#ce5c00;font-weight:700>[</span>member<span style=color:#ce5c00;font-weight:700>]</span>          restart PostgreSQL <span style=color:#ce5c00;font-weight:700>(</span>rolling restart<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pt reload                    reload PostgreSQL config
</span></span><span style=display:flex><span>  pig pt reinit &lt;member&gt;           reinitialize a member
</span></span><span style=display:flex><span>  pig pt pause                     pause automatic failover
</span></span><span style=display:flex><span>  pig pt resume                    resume automatic failover
</span></span><span style=display:flex><span>  pig pt switchover                perform planned switchover
</span></span><span style=display:flex><span>  pig pt failover                  perform manual failover
</span></span><span style=display:flex><span>  pig pt config &lt;action&gt;           manage cluster config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service Management <span style=color:#ce5c00;font-weight:700>(</span>via systemctl<span style=color:#ce5c00;font-weight:700>)</span>:
</span></span><span style=display:flex><span>  pig pt status                    show comprehensive patroni status
</span></span><span style=display:flex><span>  pig pt start                     start patroni service <span style=color:#ce5c00;font-weight:700>(</span>shortcut<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pt stop                      stop patroni service <span style=color:#ce5c00;font-weight:700>(</span>shortcut<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pt svc start                 start patroni service
</span></span><span style=display:flex><span>  pig pt svc stop                  stop patroni service
</span></span><span style=display:flex><span>  pig pt svc restart               restart patroni service
</span></span><span style=display:flex><span>  pig pt svc status                show patroni service status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Logs:
</span></span><span style=display:flex><span>  pig pt log <span style=color:#ce5c00;font-weight:700>[</span>-f<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-n 100<span style=color:#ce5c00;font-weight:700>]</span>         view patroni logs
</span></span></code></pre></div><h2 id=命令概览>命令概览</h2><p><strong>集群操作</strong>（patronictl 封装）：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pt list</code></td><td style=text-align:left><code>ls, l</code></td><td style=text-align:left>列出集群成员</td><td style=text-align:left><code>patronictl list -e -t</code></td></tr><tr><td style=text-align:left><code>pt restart</code></td><td style=text-align:left><code>reboot, rt</code></td><td style=text-align:left>重启 PostgreSQL 实例</td><td style=text-align:left><code>patronictl restart</code></td></tr><tr><td style=text-align:left><code>pt reload</code></td><td style=text-align:left><code>rl, hup</code></td><td style=text-align:left>重载 PostgreSQL 配置</td><td style=text-align:left><code>patronictl reload</code></td></tr><tr><td style=text-align:left><code>pt reinit</code></td><td style=text-align:left><code>ri</code></td><td style=text-align:left>重新初始化成员</td><td style=text-align:left><code>patronictl reinit</code></td></tr><tr><td style=text-align:left><code>pt switchover</code></td><td style=text-align:left><code>sw</code></td><td style=text-align:left>计划内主从切换</td><td style=text-align:left><code>patronictl switchover</code></td></tr><tr><td style=text-align:left><code>pt failover</code></td><td style=text-align:left><code>fo</code></td><td style=text-align:left>手动故障切换</td><td style=text-align:left><code>patronictl failover</code></td></tr><tr><td style=text-align:left><code>pt pause</code></td><td style=text-align:left><code>p</code></td><td style=text-align:left>暂停自动故障切换</td><td style=text-align:left><code>patronictl pause</code></td></tr><tr><td style=text-align:left><code>pt resume</code></td><td style=text-align:left><code>r</code></td><td style=text-align:left>恢复自动故障切换</td><td style=text-align:left><code>patronictl resume</code></td></tr><tr><td style=text-align:left><code>pt config</code></td><td style=text-align:left><code>cfg, c</code></td><td style=text-align:left>查看或修改集群配置</td><td style=text-align:left><code>patronictl show-config / edit-config</code></td></tr></tbody></table><p><strong>服务管理</strong>（systemctl 封装）：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pt start</code></td><td style=text-align:left><code>boot, up</code></td><td style=text-align:left>启动 Patroni 服务</td><td style=text-align:left><code>systemctl start patroni</code></td></tr><tr><td style=text-align:left><code>pt stop</code></td><td style=text-align:left><code>halt, dn, down</code></td><td style=text-align:left>停止 Patroni 服务</td><td style=text-align:left><code>systemctl stop patroni</code></td></tr><tr><td style=text-align:left><code>pt status</code></td><td style=text-align:left><code>st, stat</code></td><td style=text-align:left>显示服务状态</td><td style=text-align:left><code>systemctl status patroni</code></td></tr><tr><td style=text-align:left><code>pt log</code></td><td style=text-align:left><code>l, lg</code></td><td style=text-align:left>查看 Patroni 日志</td><td style=text-align:left><code>journalctl -u patroni</code></td></tr></tbody></table><p><strong>服务子命令</strong>（<code>pt svc</code>）：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>pt svc start</code></td><td style=text-align:left><code>boot, up</code></td><td style=text-align:left>启动 Patroni 服务</td></tr><tr><td style=text-align:left><code>pt svc stop</code></td><td style=text-align:left><code>halt, dn, down</code></td><td style=text-align:left>停止 Patroni 服务</td></tr><tr><td style=text-align:left><code>pt svc restart</code></td><td style=text-align:left><code>reboot, rt</code></td><td style=text-align:left>重启 Patroni 服务</td></tr><tr><td style=text-align:left><code>pt svc reload</code></td><td style=text-align:left><code>rl, hup</code></td><td style=text-align:left>重载 Patroni 服务</td></tr><tr><td style=text-align:left><code>pt svc status</code></td><td style=text-align:left><code>st, stat</code></td><td style=text-align:left>显示服务状态</td></tr></tbody></table><h2 id=快速入门>快速入门</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看集群成员状态</span>
</span></span><span style=display:flex><span>pig pt list                    <span style=color:#8f5902;font-style:italic># 列出默认集群成员</span>
</span></span><span style=display:flex><span>pig pt list pg-meta            <span style=color:#8f5902;font-style:italic># 列出指定集群成员</span>
</span></span><span style=display:flex><span>pig pt list -W                 <span style=color:#8f5902;font-style:italic># 持续监视模式</span>
</span></span><span style=display:flex><span>pig pt list -w <span style=color:#0000cf;font-weight:700>5</span>               <span style=color:#8f5902;font-style:italic># 每 5 秒刷新一次</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看和修改集群配置</span>
</span></span><span style=display:flex><span>pig pt config                  <span style=color:#8f5902;font-style:italic># 显示当前集群配置</span>
</span></span><span style=display:flex><span>pig pt config <span style=color:#000>ttl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span>           <span style=color:#8f5902;font-style:italic># 修改单个配置项（直接生效）</span>
</span></span><span style=display:flex><span>pig pt config <span style=color:#000>ttl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span> <span style=color:#000>loop_wait</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>15</span>  <span style=color:#8f5902;font-style:italic># 修改多个配置项</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 集群运维操作</span>
</span></span><span style=display:flex><span>pig pt restart                 <span style=color:#8f5902;font-style:italic># 重启所有成员的 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pt restart pg-test-1       <span style=color:#8f5902;font-style:italic># 重启指定成员</span>
</span></span><span style=display:flex><span>pig pt switchover              <span style=color:#8f5902;font-style:italic># 计划内主从切换</span>
</span></span><span style=display:flex><span>pig pt pause                   <span style=color:#8f5902;font-style:italic># 暂停自动故障切换</span>
</span></span><span style=display:flex><span>pig pt resume                  <span style=color:#8f5902;font-style:italic># 恢复自动故障切换</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 管理 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt status                  <span style=color:#8f5902;font-style:italic># 查看服务状态</span>
</span></span><span style=display:flex><span>pig pt start                   <span style=color:#8f5902;font-style:italic># 启动服务</span>
</span></span><span style=display:flex><span>pig pt stop                    <span style=color:#8f5902;font-style:italic># 停止服务</span>
</span></span><span style=display:flex><span>pig pt log -f                  <span style=color:#8f5902;font-style:italic># 实时查看日志</span>
</span></span></code></pre></div><h2 id=全局参数>全局参数</h2><p>以下参数适用于所有 <code>pig pt</code> 子命令：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--dbsu</code></td><td style=text-align:left><code>-U</code></td><td style=text-align:left>数据库超级用户（默认：<code>$PIG_DBSU</code> 或 <code>postgres</code>）</td></tr></tbody></table><h2 id=集群操作命令>集群操作命令</h2><h3 id=pt-list>pt list</h3><p>列出 Patroni 集群成员状态。该命令封装了 <code>patronictl list</code>，并默认添加 <code>-e</code>（扩展输出）和 <code>-t</code>（显示时间戳）参数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt list                    <span style=color:#8f5902;font-style:italic># 列出默认集群成员</span>
</span></span><span style=display:flex><span>pig pt list pg-meta            <span style=color:#8f5902;font-style:italic># 列出指定集群</span>
</span></span><span style=display:flex><span>pig pt list -W                 <span style=color:#8f5902;font-style:italic># 持续监视模式</span>
</span></span><span style=display:flex><span>pig pt list -w <span style=color:#0000cf;font-weight:700>5</span>               <span style=color:#8f5902;font-style:italic># 每 5 秒刷新一次</span>
</span></span><span style=display:flex><span>pig pt list pg-test -W -w <span style=color:#0000cf;font-weight:700>3</span>    <span style=color:#8f5902;font-style:italic># 监视 pg-test 集群，3 秒刷新</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--watch</code></td><td style=text-align:left><code>-W</code></td><td style=text-align:left>启用持续监视模式</td></tr><tr><td style=text-align:left><code>--interval</code></td><td style=text-align:left><code>-w</code></td><td style=text-align:left>监视刷新间隔（秒）</td></tr></tbody></table><h3 id=pt-restart>pt restart</h3><p>通过 Patroni 重启 PostgreSQL 实例。这会触发 PostgreSQL 的滚动重启，而非重启 Patroni 守护进程本身。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt restart                   <span style=color:#8f5902;font-style:italic># 重启所有成员（交互式）</span>
</span></span><span style=display:flex><span>pig pt restart pg-test-1         <span style=color:#8f5902;font-style:italic># 重启指定成员</span>
</span></span><span style=display:flex><span>pig pt restart -f                <span style=color:#8f5902;font-style:italic># 跳过确认直接重启</span>
</span></span><span style=display:flex><span>pig pt restart --role<span style=color:#ce5c00;font-weight:700>=</span>replica    <span style=color:#8f5902;font-style:italic># 仅重启从库</span>
</span></span><span style=display:flex><span>pig pt restart --pending         <span style=color:#8f5902;font-style:italic># 重启待重启的成员</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>跳过确认</td></tr><tr><td style=text-align:left><code>--role</code></td><td style=text-align:left></td><td style=text-align:left>按角色筛选（leader/replica/any）</td></tr><tr><td style=text-align:left><code>--pending</code></td><td style=text-align:left></td><td style=text-align:left>仅重启待重启的成员</td></tr></tbody></table><h3 id=pt-reload>pt reload</h3><p>通过 Patroni 重载 PostgreSQL 配置。这会触发所有成员执行配置重载。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt reload
</span></span></code></pre></div><h3 id=pt-reinit>pt reinit</h3><p>重新初始化集群成员。这会从主库重新同步数据。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt reinit pg-test-1          <span style=color:#8f5902;font-style:italic># 重新初始化指定成员</span>
</span></span><span style=display:flex><span>pig pt reinit pg-test-1 -f       <span style=color:#8f5902;font-style:italic># 跳过确认</span>
</span></span><span style=display:flex><span>pig pt reinit pg-test-1 --wait   <span style=color:#8f5902;font-style:italic># 等待完成</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>跳过确认</td></tr><tr><td style=text-align:left><code>--wait</code></td><td style=text-align:left><code>-w</code></td><td style=text-align:left>等待重新初始化完成</td></tr></tbody></table><p><strong>警告：</strong> 此操作会删除目标成员的所有数据并重新同步。</p><h3 id=pt-switchover>pt switchover</h3><p>执行计划内的主从切换。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt switchover                 <span style=color:#8f5902;font-style:italic># 交互式切换</span>
</span></span><span style=display:flex><span>pig pt switchover -f              <span style=color:#8f5902;font-style:italic># 跳过确认</span>
</span></span><span style=display:flex><span>pig pt switchover --leader pg-1   <span style=color:#8f5902;font-style:italic># 指定当前主库</span>
</span></span><span style=display:flex><span>pig pt switchover --candidate pg-2  <span style=color:#8f5902;font-style:italic># 指定新主库</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>跳过确认</td></tr><tr><td style=text-align:left><code>--leader</code></td><td style=text-align:left></td><td style=text-align:left>指定当前主库</td></tr><tr><td style=text-align:left><code>--candidate</code></td><td style=text-align:left></td><td style=text-align:left>指定候选新主库</td></tr></tbody></table><h3 id=pt-failover>pt failover</h3><p>执行手动故障切换。用于主库不可用时强制切换。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt failover                   <span style=color:#8f5902;font-style:italic># 交互式故障切换</span>
</span></span><span style=display:flex><span>pig pt failover -f                <span style=color:#8f5902;font-style:italic># 跳过确认</span>
</span></span><span style=display:flex><span>pig pt failover --candidate pg-2  <span style=color:#8f5902;font-style:italic># 指定新主库</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>跳过确认</td></tr><tr><td style=text-align:left><code>--candidate</code></td><td style=text-align:left></td><td style=text-align:left>指定候选新主库</td></tr></tbody></table><h3 id=pt-pause>pt pause</h3><p>暂停 Patroni 的自动故障切换。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt pause                      <span style=color:#8f5902;font-style:italic># 暂停自动故障切换</span>
</span></span><span style=display:flex><span>pig pt pause --wait               <span style=color:#8f5902;font-style:italic># 等待确认</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--wait</code></td><td style=text-align:left><code>-w</code></td><td style=text-align:left>等待操作完成</td></tr></tbody></table><p><strong>使用场景：</strong> 在执行维护操作（如大版本升级、存储迁移）时暂停自动故障切换，防止误触发。</p><h3 id=pt-resume>pt resume</h3><p>恢复 Patroni 的自动故障切换。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt resume                     <span style=color:#8f5902;font-style:italic># 恢复自动故障切换</span>
</span></span><span style=display:flex><span>pig pt resume --wait              <span style=color:#8f5902;font-style:italic># 等待确认</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--wait</code></td><td style=text-align:left><code>-w</code></td><td style=text-align:left>等待操作完成</td></tr></tbody></table><h3 id=pt-config>pt config</h3><p>显示或修改集群配置。不带参数时显示当前配置，带 <code>key=value</code> 参数时修改配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt config                           <span style=color:#8f5902;font-style:italic># 显示当前集群配置</span>
</span></span><span style=display:flex><span>pig pt config show                      <span style=color:#8f5902;font-style:italic># 显示配置（显式）</span>
</span></span><span style=display:flex><span>pig pt config edit                      <span style=color:#8f5902;font-style:italic># 交互式编辑配置</span>
</span></span><span style=display:flex><span>pig pt config <span style=color:#204a87>set</span> <span style=color:#000>ttl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span>                <span style=color:#8f5902;font-style:italic># 设置 TTL 为 60 秒</span>
</span></span><span style=display:flex><span>pig pt config <span style=color:#204a87>set</span> <span style=color:#000>ttl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span> <span style=color:#000>loop_wait</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>15</span>   <span style=color:#8f5902;font-style:italic># 同时修改多个配置项</span>
</span></span><span style=display:flex><span>pig pt config pg <span style=color:#000>max_connections</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>200</span>    <span style=color:#8f5902;font-style:italic># 修改 PostgreSQL 参数</span>
</span></span></code></pre></div><p><strong>子命令：</strong></p><table class=full-width><thead><tr><th style=text-align:left>子命令</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>show</code>（默认）</td><td style=text-align:left>显示当前配置</td></tr><tr><td style=text-align:left><code>edit</code></td><td style=text-align:left>交互式编辑配置</td></tr><tr><td style=text-align:left><code>set key=value</code></td><td style=text-align:left>直接设置配置项</td></tr><tr><td style=text-align:left><code>pg key=value</code></td><td style=text-align:left>设置 PostgreSQL 参数</td></tr></tbody></table><p><strong>常用配置项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>配置项</th><th style=text-align:left>说明</th><th style=text-align:left>默认值</th></tr></thead><tbody><tr><td style=text-align:left><code>ttl</code></td><td style=text-align:left>Leader 锁的生存时间（秒）</td><td style=text-align:left>30</td></tr><tr><td style=text-align:left><code>loop_wait</code></td><td style=text-align:left>主循环休眠时间（秒）</td><td style=text-align:left>10</td></tr><tr><td style=text-align:left><code>retry_timeout</code></td><td style=text-align:left>DCS 和 PostgreSQL 操作超时（秒）</td><td style=text-align:left>10</td></tr><tr><td style=text-align:left><code>maximum_lag_on_failover</code></td><td style=text-align:left>故障切换时允许的最大延迟（字节）</td><td style=text-align:left>1048576</td></tr></tbody></table><p><strong>注意：</strong> 此命令修改的是存储在 DCS（如 etcd）中的集群动态配置，而非本地配置文件 <code>/etc/patroni/patroni.yml</code>。</p><h2 id=服务管理命令>服务管理命令</h2><h3 id=pt-start>pt start</h3><p>启动 Patroni 服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt start                     <span style=color:#8f5902;font-style:italic># 启动 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt up                        <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pt boot                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span></code></pre></div><p>等效于执行 <code>sudo systemctl start patroni</code>。</p><h3 id=pt-stop>pt stop</h3><p>停止 Patroni 服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt stop                      <span style=color:#8f5902;font-style:italic># 停止 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt down                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span><span style=display:flex><span>pig pt halt                      <span style=color:#8f5902;font-style:italic># 别名</span>
</span></span></code></pre></div><p>等效于执行 <code>sudo systemctl stop patroni</code>。</p><p><strong>注意：</strong> 停止 Patroni 服务会导致该节点上的 PostgreSQL 实例也被停止（取决于 Patroni 配置）。</p><h3 id=pt-status>pt status</h3><p>显示 Patroni 服务的综合状态，包括：</p><ul><li>systemd 服务状态</li><li>Patroni 进程信息</li><li>集群成员状态</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt status
</span></span></code></pre></div><h3 id=pt-log>pt log</h3><p>查看 Patroni 服务日志。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt log                     <span style=color:#8f5902;font-style:italic># 显示最近 50 行日志</span>
</span></span><span style=display:flex><span>pig pt log -f                  <span style=color:#8f5902;font-style:italic># 实时跟踪日志输出</span>
</span></span><span style=display:flex><span>pig pt log -n <span style=color:#0000cf;font-weight:700>100</span>              <span style=color:#8f5902;font-style:italic># 显示最近 100 行日志</span>
</span></span><span style=display:flex><span>pig pt log -f -n <span style=color:#0000cf;font-weight:700>200</span>           <span style=color:#8f5902;font-style:italic># 显示最近 200 行并持续跟踪</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--follow</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>false</td><td style=text-align:left>实时跟踪日志输出</td></tr><tr><td style=text-align:left><code>--lines</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>50</td><td style=text-align:left>显示的日志行数</td></tr></tbody></table><p>等效于执行 <code>journalctl -u patroni [-f] [-n N]</code>。</p><h2 id=pt-svc-子命令>pt svc 子命令</h2><p><code>pt svc</code> 提供与顶层服务命令相同的功能，用于明确操作的是 Patroni 守护进程：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pt svc start                 <span style=color:#8f5902;font-style:italic># 启动 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt svc stop                  <span style=color:#8f5902;font-style:italic># 停止 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt svc restart               <span style=color:#8f5902;font-style:italic># 重启 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt svc reload                <span style=color:#8f5902;font-style:italic># 重载 Patroni 服务</span>
</span></span><span style=display:flex><span>pig pt svc status                <span style=color:#8f5902;font-style:italic># 显示服务状态</span>
</span></span></code></pre></div><p><strong>别名对照：</strong></p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th></tr></thead><tbody><tr><td style=text-align:left><code>pt svc start</code></td><td style=text-align:left><code>boot, up</code></td></tr><tr><td style=text-align:left><code>pt svc stop</code></td><td style=text-align:left><code>halt, dn, down</code></td></tr><tr><td style=text-align:left><code>pt svc restart</code></td><td style=text-align:left><code>reboot, rt</code></td></tr><tr><td style=text-align:left><code>pt svc reload</code></td><td style=text-align:left><code>rl, hup</code></td></tr><tr><td style=text-align:left><code>pt svc status</code></td><td style=text-align:left><code>st, stat</code></td></tr></tbody></table><h2 id=设计说明>设计说明</h2><p><strong>与 patronictl 的关系：</strong></p><p><code>pig pt</code> 封装了 <code>patronictl</code> 的常用操作：</p><ul><li>集群查询：<code>list</code>、<code>config show</code></li><li>集群管理：<code>restart</code>、<code>reload</code>、<code>reinit</code>、<code>switchover</code>、<code>failover</code>、<code>pause</code>、<code>resume</code></li><li>配置修改：<code>config set</code>、<code>config edit</code></li><li>服务管理命令（start/stop/restart/reload/status）调用 <code>systemctl</code></li><li><code>log</code> 命令调用 <code>journalctl</code></li></ul><p><strong>默认配置路径：</strong></p><table class=full-width><thead><tr><th style=text-align:left>配置项</th><th style=text-align:left>默认值</th></tr></thead><tbody><tr><td style=text-align:left>Patroni 配置文件</td><td style=text-align:left><code>/etc/patroni/patroni.yml</code></td></tr><tr><td style=text-align:left>服务名称</td><td style=text-align:left><code>patroni</code></td></tr></tbody></table><p><strong>权限处理：</strong></p><ul><li>如果当前用户已是 DBSU：直接执行命令</li><li>如果当前用户是 root：使用 <code>su - postgres -c "..."</code> 执行</li><li>其他用户：使用 <code>sudo -inu postgres -- ...</code> 执行</li></ul><p><strong>平台支持：</strong></p><p>此命令专为 Linux 系统设计，依赖 <code>systemctl</code> 和 <code>journalctl</code>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2b6374792422c32fdc25e41897f5070e>13 - pig pgbackrest</h1><div class=lead>使用 pig pgbackrest 子命令管理 pgBackRest 备份与时间点恢复</div><p><code>pig pgbackrest</code> 命令（别名 <code>pig pb</code>）用于管理 pgBackRest 备份和时间点恢复（PITR）。它封装了常用的 <code>pgbackrest</code> 操作，提供简化的备份管理体验。所有命令均以数据库超级用户身份（默认 <code>postgres</code>）执行。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb - Manage pgBackRest backup and point-in-time recovery.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Information:
</span></span><span style=display:flex><span>  pig pb info                      show backup info
</span></span><span style=display:flex><span>  pig pb ls                        list backups
</span></span><span style=display:flex><span>  pig pb ls repo                   list configured repositories
</span></span><span style=display:flex><span>  pig pb ls stanza                 list all stanzas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Backup <span style=color:#000;font-weight:700>&amp;</span> Restore:
</span></span><span style=display:flex><span>  pig pb backup                    create backup <span style=color:#ce5c00;font-weight:700>(</span>auto: full/incr<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pb backup full               create full backup
</span></span><span style=display:flex><span>  pig pb restore                   restore from backup <span style=color:#ce5c00;font-weight:700>(</span>PITR<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pb restore -t <span style=color:#4e9a06>&#34;...&#34;</span>          restore to specific <span style=color:#204a87>time</span>
</span></span><span style=display:flex><span>  pig pb expire                    cleanup expired backups
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Stanza Management:
</span></span><span style=display:flex><span>  pig pb create                    create stanza <span style=color:#ce5c00;font-weight:700>(</span>first-time setup<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pb upgrade                   upgrade stanza <span style=color:#ce5c00;font-weight:700>(</span>after PG upgrade<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  pig pb delete                    delete stanza <span style=color:#ce5c00;font-weight:700>(</span>DANGEROUS!<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Control:
</span></span><span style=display:flex><span>  pig pb check                     verify backup integrity
</span></span><span style=display:flex><span>  pig pb start                     <span style=color:#204a87>enable</span> pgBackRest operations
</span></span><span style=display:flex><span>  pig pb stop                      disable pgBackRest operations
</span></span><span style=display:flex><span>  pig pb log                       view pgBackRest logs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>  pig pb info                      <span style=color:#8f5902;font-style:italic># show all backup info</span>
</span></span><span style=display:flex><span>  pig pb backup                    <span style=color:#8f5902;font-style:italic># auto: full if none, else incr</span>
</span></span><span style=display:flex><span>  pig pb backup full               <span style=color:#8f5902;font-style:italic># full backup</span>
</span></span><span style=display:flex><span>  pig pb restore -d                <span style=color:#8f5902;font-style:italic># restore to latest (end of WAL)</span>
</span></span><span style=display:flex><span>  pig pb restore -t <span style=color:#4e9a06>&#34;2025-01-01 12:00:00+08&#34;</span>  <span style=color:#8f5902;font-style:italic># restore to time</span>
</span></span><span style=display:flex><span>  pig pb create                    <span style=color:#8f5902;font-style:italic># initialize stanza</span>
</span></span><span style=display:flex><span>  pig pb expire                    <span style=color:#8f5902;font-style:italic># cleanup per retention policy</span>
</span></span></code></pre></div><h2 id=命令概览>命令概览</h2><p><strong>信息查询</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pb info</code></td><td style=text-align:left>显示备份仓库信息</td><td style=text-align:left><code>pgbackrest info</code></td></tr><tr><td style=text-align:left><code>pb ls</code></td><td style=text-align:left>列出备份集</td><td style=text-align:left><code>pgbackrest info</code></td></tr><tr><td style=text-align:left><code>pb ls repo</code></td><td style=text-align:left>列出配置的仓库</td><td style=text-align:left>解析 pgbackrest.conf</td></tr><tr><td style=text-align:left><code>pb ls stanza</code></td><td style=text-align:left>列出所有 stanza</td><td style=text-align:left>解析 pgbackrest.conf</td></tr></tbody></table><p><strong>备份与恢复</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pb backup</code></td><td style=text-align:left>创建备份</td><td style=text-align:left><code>pgbackrest backup</code></td></tr><tr><td style=text-align:left><code>pb restore</code></td><td style=text-align:left>从备份恢复（PITR）</td><td style=text-align:left><code>pgbackrest restore</code></td></tr><tr><td style=text-align:left><code>pb expire</code></td><td style=text-align:left>清理过期备份</td><td style=text-align:left><code>pgbackrest expire</code></td></tr></tbody></table><p><strong>Stanza 管理</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pb create</code></td><td style=text-align:left>创建 stanza（首次设置）</td><td style=text-align:left><code>pgbackrest stanza-create</code></td></tr><tr><td style=text-align:left><code>pb upgrade</code></td><td style=text-align:left>升级 stanza（PG 大版本升级后）</td><td style=text-align:left><code>pgbackrest stanza-upgrade</code></td></tr><tr><td style=text-align:left><code>pb delete</code></td><td style=text-align:left>删除 stanza（危险操作！）</td><td style=text-align:left><code>pgbackrest stanza-delete</code></td></tr></tbody></table><p><strong>控制命令</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>命令</th><th style=text-align:left>别名</th><th style=text-align:left>描述</th><th style=text-align:left>实现方式</th></tr></thead><tbody><tr><td style=text-align:left><code>pb check</code></td><td style=text-align:left></td><td style=text-align:left>验证备份仓库完整性</td><td style=text-align:left><code>pgbackrest check</code></td></tr><tr><td style=text-align:left><code>pb start</code></td><td style=text-align:left></td><td style=text-align:left>启用 pgBackRest 操作</td><td style=text-align:left><code>pgbackrest start</code></td></tr><tr><td style=text-align:left><code>pb stop</code></td><td style=text-align:left></td><td style=text-align:left>禁用 pgBackRest 操作</td><td style=text-align:left><code>pgbackrest stop</code></td></tr><tr><td style=text-align:left><code>pb log</code></td><td style=text-align:left><code>l, lg</code></td><td style=text-align:left>查看日志</td><td style=text-align:left><code>tail/cat</code> 日志文件</td></tr></tbody></table><h2 id=快速入门>快速入门</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看备份信息</span>
</span></span><span style=display:flex><span>pig pb info                          <span style=color:#8f5902;font-style:italic># 显示所有备份信息</span>
</span></span><span style=display:flex><span>pig pb info --raw -o json            <span style=color:#8f5902;font-style:italic># 原始 JSON 输出</span>
</span></span><span style=display:flex><span>pig pb ls                            <span style=color:#8f5902;font-style:italic># 列出所有备份</span>
</span></span><span style=display:flex><span>pig pb ls repo                       <span style=color:#8f5902;font-style:italic># 列出配置的仓库</span>
</span></span><span style=display:flex><span>pig pb ls stanza                     <span style=color:#8f5902;font-style:italic># 列出所有 stanza</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 创建备份（必须在主库执行）</span>
</span></span><span style=display:flex><span>pig pb backup                        <span style=color:#8f5902;font-style:italic># 自动模式：无备份则全量，否则增量</span>
</span></span><span style=display:flex><span>pig pb backup full                   <span style=color:#8f5902;font-style:italic># 全量备份</span>
</span></span><span style=display:flex><span>pig pb backup diff                   <span style=color:#8f5902;font-style:italic># 差异备份</span>
</span></span><span style=display:flex><span>pig pb backup incr                   <span style=color:#8f5902;font-style:italic># 增量备份</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复（PITR，至少指定一个恢复目标）</span>
</span></span><span style=display:flex><span>pig pb restore -d                    <span style=color:#8f5902;font-style:italic># 恢复到最新（WAL 流末尾）</span>
</span></span><span style=display:flex><span>pig pb restore -I                    <span style=color:#8f5902;font-style:italic># 恢复到备份一致性点</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;2025-01-01 12:00:00+08&#34;</span>  <span style=color:#8f5902;font-style:italic># 恢复到指定时间</span>
</span></span><span style=display:flex><span>pig pb restore -n savepoint          <span style=color:#8f5902;font-style:italic># 恢复到命名还原点</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Stanza 管理</span>
</span></span><span style=display:flex><span>pig pb create                        <span style=color:#8f5902;font-style:italic># 初始化 stanza</span>
</span></span><span style=display:flex><span>pig pb upgrade                       <span style=color:#8f5902;font-style:italic># PG 大版本升级后升级 stanza</span>
</span></span><span style=display:flex><span>pig pb check                         <span style=color:#8f5902;font-style:italic># 验证仓库完整性</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 清理</span>
</span></span><span style=display:flex><span>pig pb expire                        <span style=color:#8f5902;font-style:italic># 按保留策略清理</span>
</span></span><span style=display:flex><span>pig pb expire --dry-run              <span style=color:#8f5902;font-style:italic># 干运行模式</span>
</span></span></code></pre></div><h2 id=全局参数>全局参数</h2><p>以下参数适用于所有 <code>pig pb</code> 子命令：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--stanza</code></td><td style=text-align:left><code>-s</code></td><td style=text-align:left>pgBackRest stanza 名称（自动检测）</td></tr><tr><td style=text-align:left><code>--config</code></td><td style=text-align:left><code>-c</code></td><td style=text-align:left>配置文件路径</td></tr><tr><td style=text-align:left><code>--repo</code></td><td style=text-align:left><code>-r</code></td><td style=text-align:left>仓库编号（多仓库场景）</td></tr><tr><td style=text-align:left><code>--dbsu</code></td><td style=text-align:left><code>-U</code></td><td style=text-align:left>数据库超级用户（默认：<code>$PIG_DBSU</code> 或 <code>postgres</code>）</td></tr></tbody></table><p><strong>Stanza 自动检测：</strong></p><p>如果未指定 <code>-s</code> 参数，pig 会从配置文件中自动检测 stanza 名称：</p><ol><li>读取配置文件（默认 <code>/etc/pgbackrest/pgbackrest.conf</code>）</li><li>查找非 <code>[global*]</code> 开头的 section</li><li>使用找到的第一个 stanza</li></ol><p>如果配置文件中有多个 stanza，会发出警告并使用第一个。此时应显式指定 <code>--stanza</code> 参数。</p><p><strong>多仓库支持：</strong></p><p>pgBackRest 支持配置多个仓库（repo1、repo2 等）。使用 <code>-r</code> 参数指定操作的目标仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb backup -r <span style=color:#0000cf;font-weight:700>1</span>                   <span style=color:#8f5902;font-style:italic># 备份到 repo1</span>
</span></span><span style=display:flex><span>pig pb backup -r <span style=color:#0000cf;font-weight:700>2</span>                   <span style=color:#8f5902;font-style:italic># 备份到 repo2</span>
</span></span><span style=display:flex><span>pig pb info -r <span style=color:#0000cf;font-weight:700>2</span>                     <span style=color:#8f5902;font-style:italic># 查看 repo2 的备份信息</span>
</span></span></code></pre></div><h2 id=信息查询命令>信息查询命令</h2><h3 id=pb-info>pb info</h3><p>显示备份仓库详细信息，包括所有备份集和 WAL 归档状态。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb info                          <span style=color:#8f5902;font-style:italic># 显示所有备份信息</span>
</span></span><span style=display:flex><span>pig pb info --raw -o json            <span style=color:#8f5902;font-style:italic># 原始 JSON 输出</span>
</span></span><span style=display:flex><span>pig pb info --set 20250101-120000F   <span style=color:#8f5902;font-style:italic># 显示特定备份集详情</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--raw</code></td><td style=text-align:left><code>-R</code></td><td style=text-align:left>原始输出模式（透传 pgBackRest 输出）</td></tr><tr><td style=text-align:left><code>--output</code></td><td style=text-align:left><code>-o</code></td><td style=text-align:left>输出格式：text、json（仅 <code>--raw</code> 模式）</td></tr><tr><td style=text-align:left><code>--set</code></td><td style=text-align:left></td><td style=text-align:left>显示特定备份集详情</td></tr></tbody></table><h3 id=pb-ls>pb ls</h3><p>列出备份仓库中的资源。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb ls                            <span style=color:#8f5902;font-style:italic># 列出所有备份（默认）</span>
</span></span><span style=display:flex><span>pig pb ls backup                     <span style=color:#8f5902;font-style:italic># 列出所有备份（显式）</span>
</span></span><span style=display:flex><span>pig pb ls repo                       <span style=color:#8f5902;font-style:italic># 列出配置的仓库</span>
</span></span><span style=display:flex><span>pig pb ls stanza                     <span style=color:#8f5902;font-style:italic># 列出所有 stanza</span>
</span></span><span style=display:flex><span>pig pb ls cluster                    <span style=color:#8f5902;font-style:italic># stanza 的别名</span>
</span></span></code></pre></div><p><strong>类型说明：</strong></p><table class=full-width><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>描述</th><th style=text-align:left>数据来源</th></tr></thead><tbody><tr><td style=text-align:left>backup</td><td style=text-align:left>列出所有备份集（默认）</td><td style=text-align:left>pgbackrest info</td></tr><tr><td style=text-align:left>repo</td><td style=text-align:left>列出配置的仓库</td><td style=text-align:left>解析 pgbackrest.conf</td></tr><tr><td style=text-align:left>stanza</td><td style=text-align:left>列出所有 stanza</td><td style=text-align:left>解析 pgbackrest.conf</td></tr></tbody></table><h2 id=备份命令>备份命令</h2><h3 id=pb-backup>pb backup</h3><p>创建物理备份。备份只能在主库实例上执行。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb backup                        <span style=color:#8f5902;font-style:italic># 自动模式</span>
</span></span><span style=display:flex><span>pig pb backup full                   <span style=color:#8f5902;font-style:italic># 全量备份</span>
</span></span><span style=display:flex><span>pig pb backup diff                   <span style=color:#8f5902;font-style:italic># 差异备份</span>
</span></span><span style=display:flex><span>pig pb backup incr                   <span style=color:#8f5902;font-style:italic># 增量备份</span>
</span></span><span style=display:flex><span>pig pb backup --force                <span style=color:#8f5902;font-style:italic># 跳过主库角色检查</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>跳过主库角色检查</td></tr></tbody></table><p><strong>备份类型：</strong></p><table class=full-width><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>(空)</td><td style=text-align:left>自动模式：无备份则全量，否则增量</td></tr><tr><td style=text-align:left>full</td><td style=text-align:left>全量备份：备份所有数据</td></tr><tr><td style=text-align:left>diff</td><td style=text-align:left>差异备份：自上次全量备份以来的变更</td></tr><tr><td style=text-align:left>incr</td><td style=text-align:left>增量备份：自上次任意备份以来的变更</td></tr></tbody></table><p><strong>主库检查：</strong></p><p>执行备份前，命令会自动检查当前实例是否为主库。如果是备库，命令会报错退出。使用 <code>--force</code> 可跳过此检查。</p><h3 id=pb-expire>pb expire</h3><p>按保留策略清理过期的备份和 WAL 归档。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb expire                        <span style=color:#8f5902;font-style:italic># 按策略清理</span>
</span></span><span style=display:flex><span>pig pb expire --set 20250101-*       <span style=color:#8f5902;font-style:italic># 删除特定备份集</span>
</span></span><span style=display:flex><span>pig pb expire --dry-run              <span style=color:#8f5902;font-style:italic># 干运行模式（仅显示）</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--set</code></td><td style=text-align:left>删除特定备份集</td></tr><tr><td style=text-align:left><code>--dry-run</code></td><td style=text-align:left>干运行模式：仅显示将删除的内容</td></tr></tbody></table><p><strong>保留策略配置：</strong></p><p>保留策略在 <code>pgbackrest.conf</code> 中配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[global]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>repo1-retention-full</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>2               # 保留的全量备份数</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>repo1-retention-diff</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>4               # 保留的差异备份数</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>repo1-retention-archive</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>2            # WAL 归档保留策略</span>
</span></span></code></pre></div><h2 id=恢复命令>恢复命令</h2><h3 id=pb-restore>pb restore</h3><p>从备份恢复，支持时间点恢复（PITR）。
必须显式指定一个恢复目标（<code>-d/-I/-t/-n/-l/-x</code>）；不带参数仅显示帮助信息。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复目标（互斥选项）</span>
</span></span><span style=display:flex><span>pig pb restore -d                    <span style=color:#8f5902;font-style:italic># 恢复到最新（显式）</span>
</span></span><span style=display:flex><span>pig pb restore -I                    <span style=color:#8f5902;font-style:italic># 恢复到备份一致性点</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;2025-01-01 12:00:00+08&#34;</span>  <span style=color:#8f5902;font-style:italic># 恢复到指定时间</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;2025-01-01&#34;</span>       <span style=color:#8f5902;font-style:italic># 恢复到日期（当天 00:00:00）</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;12:00:00&#34;</span>         <span style=color:#8f5902;font-style:italic># 恢复到时间（今天）</span>
</span></span><span style=display:flex><span>pig pb restore -n my-savepoint       <span style=color:#8f5902;font-style:italic># 恢复到命名还原点</span>
</span></span><span style=display:flex><span>pig pb restore -l <span style=color:#4e9a06>&#34;0/7C82CB8&#34;</span>        <span style=color:#8f5902;font-style:italic># 恢复到 LSN</span>
</span></span><span style=display:flex><span>pig pb restore -x <span style=color:#0000cf;font-weight:700>12345</span>              <span style=color:#8f5902;font-style:italic># 恢复到事务 ID</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 备份集选择（可与恢复目标组合）</span>
</span></span><span style=display:flex><span>pig pb restore -b 20251225-120000F   <span style=color:#8f5902;font-style:italic># 从特定备份集恢复</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 其他选项</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;...&#34;</span> -X           <span style=color:#8f5902;font-style:italic># 排他模式（在目标前停止）</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;...&#34;</span> -P           <span style=color:#8f5902;font-style:italic># 恢复后自动提升</span>
</span></span><span style=display:flex><span>pig pb restore -y                    <span style=color:#8f5902;font-style:italic># 跳过确认倒计时</span>
</span></span></code></pre></div><p><strong>恢复目标选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--default</code></td><td style=text-align:left><code>-d</code></td><td style=text-align:left>恢复到 WAL 流末尾（最新数据）</td></tr><tr><td style=text-align:left><code>--immediate</code></td><td style=text-align:left><code>-I</code></td><td style=text-align:left>恢复到备份一致性点</td></tr><tr><td style=text-align:left><code>--time</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>恢复到指定时间戳</td></tr><tr><td style=text-align:left><code>--name</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>恢复到命名还原点</td></tr><tr><td style=text-align:left><code>--lsn</code></td><td style=text-align:left><code>-l</code></td><td style=text-align:left>恢复到指定 LSN</td></tr><tr><td style=text-align:left><code>--xid</code></td><td style=text-align:left><code>-x</code></td><td style=text-align:left>恢复到指定事务 ID</td></tr></tbody></table><p><strong>备份集和其他选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--set</code></td><td style=text-align:left><code>-b</code></td><td style=text-align:left>从特定备份集恢复（可与目标组合）</td></tr><tr><td style=text-align:left><code>--data</code></td><td style=text-align:left><code>-D</code></td><td style=text-align:left>目标数据目录</td></tr><tr><td style=text-align:left><code>--exclusive</code></td><td style=text-align:left><code>-X</code></td><td style=text-align:left>排他模式：在目标前停止</td></tr><tr><td style=text-align:left><code>--promote</code></td><td style=text-align:left><code>-P</code></td><td style=text-align:left>恢复后自动提升为主库</td></tr><tr><td style=text-align:left><code>--yes</code></td><td style=text-align:left><code>-y</code></td><td style=text-align:left>跳过确认和倒计时</td></tr></tbody></table><p><strong>时间格式：</strong></p><p>支持多种时间格式输入，自动补全时区（支持非整小时时区如 +05:30）：</p><table class=full-width><thead><tr><th style=text-align:left>格式</th><th style=text-align:left>示例</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>完整格式</td><td style=text-align:left><code>2025-01-01 12:00:00+08</code></td><td style=text-align:left>包含时区的完整时间戳</td></tr><tr><td style=text-align:left>仅日期</td><td style=text-align:left><code>2025-01-01</code></td><td style=text-align:left>自动补全为当天 00:00:00（当前时区）</td></tr><tr><td style=text-align:left>仅时间</td><td style=text-align:left><code>12:00:00</code></td><td style=text-align:left>自动补全为今天（当前时区）</td></tr></tbody></table><p><strong>恢复流程：</strong></p><ol><li>验证参数和环境</li><li>检查 PostgreSQL 已停止</li><li>显示恢复计划，等待确认（5 秒倒计时）</li><li>执行 pgbackrest restore</li><li>提供恢复后的操作指引</li></ol><p><strong>重要提示：</strong> 恢复前必须先停止 PostgreSQL：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pg stop                          <span style=color:#8f5902;font-style:italic># 停止 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pb restore -t <span style=color:#4e9a06>&#34;...&#34;</span>              <span style=color:#8f5902;font-style:italic># 执行恢复</span>
</span></span><span style=display:flex><span>pig pg start                         <span style=color:#8f5902;font-style:italic># 启动 PostgreSQL</span>
</span></span></code></pre></div><h2 id=stanza-管理命令>Stanza 管理命令</h2><h3 id=pb-create>pb create</h3><p>初始化新的 stanza。必须在首次备份前执行。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb create                        <span style=color:#8f5902;font-style:italic># 创建 stanza</span>
</span></span><span style=display:flex><span>pig pb create --no-online            <span style=color:#8f5902;font-style:italic># PostgreSQL 未运行时创建</span>
</span></span><span style=display:flex><span>pig pb create --force                <span style=color:#8f5902;font-style:italic># 强制创建</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--no-online</code></td><td style=text-align:left></td><td style=text-align:left>PostgreSQL 未运行时创建</td></tr><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>强制创建</td></tr></tbody></table><h3 id=pb-upgrade>pb upgrade</h3><p>PostgreSQL 大版本升级后更新 stanza。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb upgrade                       <span style=color:#8f5902;font-style:italic># 升级 stanza</span>
</span></span><span style=display:flex><span>pig pb upgrade --no-online           <span style=color:#8f5902;font-style:italic># PostgreSQL 未运行时升级</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--no-online</code></td><td style=text-align:left>PostgreSQL 未运行时升级</td></tr></tbody></table><p><strong>使用场景：</strong></p><p>当 PostgreSQL 进行大版本升级（如 16 → 17）后，需要执行此命令更新 stanza 元数据。</p><h3 id=pb-delete>pb delete</h3><p>删除 stanza 及其所有备份。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb delete --force                <span style=color:#8f5902;font-style:italic># 删除 stanza（需要 --force）</span>
</span></span><span style=display:flex><span>pig pb delete --force --yes          <span style=color:#8f5902;font-style:italic># 跳过倒计时确认</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>确认删除（必需）</td></tr><tr><td style=text-align:left><code>--yes</code></td><td style=text-align:left><code>-y</code></td><td style=text-align:left>跳过倒计时确认</td></tr></tbody></table><p><strong>警告：</strong> 这是一个<strong>破坏性且不可逆</strong>的操作！所有备份将被永久删除。</p><p>命令包含多重安全机制：</p><ol><li>必须提供 <code>--force</code> 参数</li><li>5 秒倒计时确认（可按 Ctrl+C 取消）</li><li>使用 <code>--yes</code> 可跳过倒计时</li></ol><h2 id=控制命令>控制命令</h2><h3 id=pb-check>pb check</h3><p>验证备份仓库的完整性和配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb check                         <span style=color:#8f5902;font-style:italic># 验证仓库</span>
</span></span></code></pre></div><p>此命令检查：</p><ul><li>WAL 归档配置是否正确</li><li>仓库是否可访问</li><li>stanza 配置是否有效</li></ul><h3 id=pb-start>pb start</h3><p>启用 pgBackRest 操作。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb start                         <span style=color:#8f5902;font-style:italic># 启用操作</span>
</span></span></code></pre></div><p>在执行 <code>pb stop</code> 后使用此命令恢复正常操作。</p><h3 id=pb-stop>pb stop</h3><p>禁用 pgBackRest 操作（用于维护）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb stop                          <span style=color:#8f5902;font-style:italic># 禁用操作</span>
</span></span><span style=display:flex><span>pig pb stop --force                  <span style=color:#8f5902;font-style:italic># 终止正在运行的操作</span>
</span></span></code></pre></div><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--force</code></td><td style=text-align:left><code>-f</code></td><td style=text-align:left>终止正在运行的操作</td></tr></tbody></table><p><strong>使用场景：</strong></p><p>在进行系统维护时，使用此命令阻止新的备份操作启动。</p><h2 id=日志命令>日志命令</h2><h3 id=pb-log>pb log</h3><p>查看 pgBackRest 日志文件。日志目录为 <code>/pg/log/pgbackrest/</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pb log                           <span style=color:#8f5902;font-style:italic># 列出日志文件</span>
</span></span><span style=display:flex><span>pig pb log list                      <span style=color:#8f5902;font-style:italic># 列出日志文件</span>
</span></span><span style=display:flex><span>pig pb log tail                      <span style=color:#8f5902;font-style:italic># 实时查看最新日志</span>
</span></span><span style=display:flex><span>pig pb log tail -n <span style=color:#0000cf;font-weight:700>100</span>               <span style=color:#8f5902;font-style:italic># 显示最后 100 行并跟踪</span>
</span></span><span style=display:flex><span>pig pb log cat                       <span style=color:#8f5902;font-style:italic># 显示最新日志内容</span>
</span></span><span style=display:flex><span>pig pb log cat -n <span style=color:#0000cf;font-weight:700>50</span>                 <span style=color:#8f5902;font-style:italic># 显示最后 50 行</span>
</span></span><span style=display:flex><span>pig pb log cat pg-meta-backup.log    <span style=color:#8f5902;font-style:italic># 显示指定日志文件</span>
</span></span></code></pre></div><p><strong>子命令：</strong></p><table class=full-width><thead><tr><th style=text-align:left>子命令</th><th style=text-align:left>别名</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>list</td><td style=text-align:left>ls</td><td style=text-align:left>列出日志文件</td></tr><tr><td style=text-align:left>tail</td><td style=text-align:left>follow, f</td><td style=text-align:left>实时跟踪最新日志</td></tr><tr><td style=text-align:left>cat</td><td style=text-align:left>show</td><td style=text-align:left>显示日志内容</td></tr></tbody></table><p><strong>选项：</strong></p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--lines</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>50</td><td style=text-align:left>显示的行数</td></tr></tbody></table><p><strong>权限处理：</strong></p><p>如果当前用户没有权限读取日志目录，命令会自动使用 <code>sudo</code> 重试。</p><h2 id=设计说明>设计说明</h2><p><strong>命令执行方式：</strong></p><p>所有 <code>pig pb</code> 命令都以数据库超级用户（DBSU）身份执行。这是因为 pgBackRest 需要访问 PostgreSQL 数据文件和 WAL 归档。</p><p>执行逻辑：</p><ul><li>如果当前用户已是 DBSU：直接执行命令</li><li>如果当前用户是 root：使用 <code>su - postgres -c "..."</code> 执行</li><li>其他用户：使用 <code>sudo -inu postgres -- ...</code> 执行</li></ul><p><strong>与 pgbackrest 的关系：</strong></p><p><code>pig pb</code> 并非 <code>pgbackrest</code> 的完整封装，而是针对常用操作的上层抽象：</p><ul><li>自动检测 stanza 名称，无需每次指定</li><li>备份前自动检查主库角色</li><li>恢复时显示计划并要求确认</li><li>提供人性化的时间格式输入</li><li>恢复后提供操作指引</li></ul><p>如需使用 <code>pgbackrest</code> 的完整功能，请直接使用 <code>pgbackrest</code> 命令。</p><p><strong>默认配置路径：</strong></p><table class=full-width><thead><tr><th style=text-align:left>配置项</th><th style=text-align:left>默认值</th></tr></thead><tbody><tr><td style=text-align:left>配置文件</td><td style=text-align:left><code>/etc/pgbackrest/pgbackrest.conf</code></td></tr><tr><td style=text-align:left>日志目录</td><td style=text-align:left><code>/pg/log/pgbackrest</code></td></tr><tr><td style=text-align:left>数据目录</td><td style=text-align:left>配置文件中的 <code>pg1-path</code>，或 <code>$PGDATA</code> 环境变量，或 <code>/pg/data</code></td></tr></tbody></table><p><strong>安全考虑：</strong></p><ul><li><code>pb delete</code> 需要 <code>--force</code> 确认，并有 5 秒倒计时</li><li><code>pb restore</code> 显示恢复计划，有 5 秒倒计时确认</li><li><code>pb backup</code> 默认检查主库角色，防止在备库执行</li><li>日志命令的文件名参数会过滤路径，防止路径遍历攻击</li></ul><p><strong>平台支持：</strong></p><p>此命令专为 Linux 系统设计，依赖 Pigsty 的默认目录结构。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-90fc61ecd98b3b848f30917622966cb5>14 - pig pitr</h1><div class=lead>使用 pig pitr 命令执行编排式时间点恢复（PITR）</div><p><code>pig pitr</code> 命令用于执行<strong>编排式时间点恢复</strong>（Orchestrated Point-In-Time Recovery）。与 <code>pig pb restore</code> 不同，此命令会自动协调 Patroni、PostgreSQL 和 pgBackRest，完成完整的 PITR 工作流。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pig pitr - Perform PITR with automatic Patroni/PostgreSQL lifecycle management.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This <span style=color:#204a87>command</span> orchestrates a <span style=color:#204a87>complete</span> PITR workflow:
</span></span><span style=display:flex><span>  1. Stop Patroni service <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>if</span> running<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  2. Ensure PostgreSQL is stopped <span style=color:#ce5c00;font-weight:700>(</span>with retry and fallback<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  3. Execute pgbackrest restore
</span></span><span style=display:flex><span>  4. Start PostgreSQL
</span></span><span style=display:flex><span>  5. Provide post-restore guidance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Recovery Targets <span style=color:#ce5c00;font-weight:700>(</span>at least one required<span style=color:#ce5c00;font-weight:700>)</span>:
</span></span><span style=display:flex><span>  --default, -d      Recover to end of WAL stream <span style=color:#ce5c00;font-weight:700>(</span>latest<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  --immediate, -I    Recover to backup consistency point
</span></span><span style=display:flex><span>  --time, -t         Recover to specific timestamp
</span></span><span style=display:flex><span>  --name, -n         Recover to named restore point
</span></span><span style=display:flex><span>  --lsn, -l          Recover to specific LSN
</span></span><span style=display:flex><span>  --xid, -x          Recover to specific transaction ID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Time Format:
</span></span><span style=display:flex><span>  - Full: <span style=color:#4e9a06>&#34;2025-01-01 12:00:00+08&#34;</span>
</span></span><span style=display:flex><span>  - Date only: <span style=color:#4e9a06>&#34;2025-01-01&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>defaults to 00:00:00<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  - Time only: <span style=color:#4e9a06>&#34;12:00:00&#34;</span> <span style=color:#ce5c00;font-weight:700>(</span>defaults to today<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>  pig pitr -d                      <span style=color:#8f5902;font-style:italic># Recover to latest (most common)</span>
</span></span><span style=display:flex><span>  pig pitr -t <span style=color:#4e9a06>&#34;2025-01-01 12:00&#34;</span>   <span style=color:#8f5902;font-style:italic># Recover to specific time</span>
</span></span><span style=display:flex><span>  pig pitr -I                      <span style=color:#8f5902;font-style:italic># Recover to backup consistency point</span>
</span></span><span style=display:flex><span>  pig pitr -d --dry-run            <span style=color:#8f5902;font-style:italic># Show execution plan without running</span>
</span></span><span style=display:flex><span>  pig pitr -d -y                   <span style=color:#8f5902;font-style:italic># Skip confirmation (for automation)</span>
</span></span><span style=display:flex><span>  pig pitr -d --skip-patroni       <span style=color:#8f5902;font-style:italic># Skip Patroni management</span>
</span></span><span style=display:flex><span>  pig pitr -d --no-restart         <span style=color:#8f5902;font-style:italic># Don&#39;t auto-start PostgreSQL after restore</span>
</span></span></code></pre></div><h2 id=命令概览>命令概览</h2><p><code>pig pitr</code> 是一个高度自动化的恢复命令，它会：</p><ol><li>自动停止 Patroni 服务（如果正在运行）</li><li>确保 PostgreSQL 已停止（带重试和降级策略）</li><li>执行 pgBackRest 恢复</li><li>启动 PostgreSQL</li><li>提供恢复后的操作指引</li></ol><p><strong>与 <code>pig pb restore</code> 的区别：</strong></p><table class=full-width><thead><tr><th style=text-align:left>特性</th><th style=text-align:left><code>pig pitr</code></th><th style=text-align:left><code>pig pb restore</code></th></tr></thead><tbody><tr><td style=text-align:left>停止 Patroni</td><td style=text-align:left>自动</td><td style=text-align:left>手动</td></tr><tr><td style=text-align:left>停止 PostgreSQL</td><td style=text-align:left>自动（带重试）</td><td style=text-align:left>需要预先停止</td></tr><tr><td style=text-align:left>启动 PostgreSQL</td><td style=text-align:left>自动</td><td style=text-align:left>手动</td></tr><tr><td style=text-align:left>恢复后指引</td><td style=text-align:left>提供详细指引</td><td style=text-align:left>无</td></tr><tr><td style=text-align:left>适用场景</td><td style=text-align:left>生产环境完整恢复</td><td style=text-align:left>底层操作或脚本集成</td></tr></tbody></table><h2 id=快速入门>快速入门</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 最常用：恢复到最新数据</span>
</span></span><span style=display:flex><span>pig pitr -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复到指定时间点</span>
</span></span><span style=display:flex><span>pig pitr -t <span style=color:#4e9a06>&#34;2025-01-01 12:00:00+08&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复到备份一致性点（最快）</span>
</span></span><span style=display:flex><span>pig pitr -I
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看执行计划（不实际执行）</span>
</span></span><span style=display:flex><span>pig pitr -d --dry-run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 跳过确认（用于自动化）</span>
</span></span><span style=display:flex><span>pig pitr -d -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 从特定备份集恢复</span>
</span></span><span style=display:flex><span>pig pitr -d -b 20251225-120000F
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 独立 PostgreSQL（非 Patroni 管理）</span>
</span></span><span style=display:flex><span>pig pitr -d --skip-patroni
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复后不自动启动 PostgreSQL</span>
</span></span><span style=display:flex><span>pig pitr -d --no-restart
</span></span></code></pre></div><h2 id=参数说明>参数说明</h2><h3 id=恢复目标必选其一>恢复目标（必选其一）</h3><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--default</code></td><td style=text-align:left><code>-d</code></td><td style=text-align:left>恢复到 WAL 流末尾（最新数据）</td></tr><tr><td style=text-align:left><code>--immediate</code></td><td style=text-align:left><code>-I</code></td><td style=text-align:left>恢复到备份一致性点</td></tr><tr><td style=text-align:left><code>--time</code></td><td style=text-align:left><code>-t</code></td><td style=text-align:left>恢复到指定时间戳</td></tr><tr><td style=text-align:left><code>--name</code></td><td style=text-align:left><code>-n</code></td><td style=text-align:left>恢复到命名还原点</td></tr><tr><td style=text-align:left><code>--lsn</code></td><td style=text-align:left><code>-l</code></td><td style=text-align:left>恢复到指定 LSN</td></tr><tr><td style=text-align:left><code>--xid</code></td><td style=text-align:left><code>-x</code></td><td style=text-align:left>恢复到指定事务 ID</td></tr></tbody></table><h3 id=备份选择>备份选择</h3><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--set</code></td><td style=text-align:left><code>-b</code></td><td style=text-align:left>从特定备份集恢复</td></tr></tbody></table><h3 id=流程控制>流程控制</h3><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--skip-patroni</code></td><td style=text-align:left><code>-S</code></td><td style=text-align:left>跳过 Patroni 停止操作</td></tr><tr><td style=text-align:left><code>--no-restart</code></td><td style=text-align:left><code>-N</code></td><td style=text-align:left>恢复后不自动启动 PostgreSQL</td></tr><tr><td style=text-align:left><code>--dry-run</code></td><td style=text-align:left></td><td style=text-align:left>仅显示执行计划，不实际执行</td></tr><tr><td style=text-align:left><code>--yes</code></td><td style=text-align:left><code>-y</code></td><td style=text-align:left>跳过确认倒计时</td></tr></tbody></table><h3 id=恢复选项>恢复选项</h3><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--exclusive</code></td><td style=text-align:left><code>-X</code></td><td style=text-align:left>排他模式：在目标前停止</td></tr><tr><td style=text-align:left><code>--promote</code></td><td style=text-align:left><code>-P</code></td><td style=text-align:left>恢复后自动提升为主库</td></tr></tbody></table><h3 id=配置参数>配置参数</h3><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>简写</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>--stanza</code></td><td style=text-align:left><code>-s</code></td><td style=text-align:left>pgBackRest stanza 名称（自动检测）</td></tr><tr><td style=text-align:left><code>--config</code></td><td style=text-align:left><code>-c</code></td><td style=text-align:left>pgBackRest 配置文件路径</td></tr><tr><td style=text-align:left><code>--repo</code></td><td style=text-align:left><code>-r</code></td><td style=text-align:left>仓库编号（多仓库场景）</td></tr><tr><td style=text-align:left><code>--dbsu</code></td><td style=text-align:left><code>-U</code></td><td style=text-align:left>数据库超级用户（默认：<code>postgres</code>）</td></tr><tr><td style=text-align:left><code>--data</code></td><td style=text-align:left><code>-D</code></td><td style=text-align:left>目标数据目录</td></tr></tbody></table><h2 id=时间格式>时间格式</h2><p><code>--time</code> 参数支持多种时间格式，自动补全时区：</p><table class=full-width><thead><tr><th style=text-align:left>格式</th><th style=text-align:left>示例</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>完整格式</td><td style=text-align:left><code>2025-01-01 12:00:00+08</code></td><td style=text-align:left>包含时区的完整时间戳</td></tr><tr><td style=text-align:left>仅日期</td><td style=text-align:left><code>2025-01-01</code></td><td style=text-align:left>自动补全为当天 00:00:00（当前时区）</td></tr><tr><td style=text-align:left>仅时间</td><td style=text-align:left><code>12:00:00</code></td><td style=text-align:left>自动补全为今天（当前时区）</td></tr></tbody></table><h2 id=执行流程>执行流程</h2><h3 id=第一阶段预检查>第一阶段：预检查</h3><ul><li>验证恢复目标参数（必须且只能指定一个）</li><li>检查数据目录是否存在且已初始化</li><li>检测 Patroni 服务状态</li><li>检测 PostgreSQL 运行状态</li></ul><h3 id=第二阶段停止-patroni>第二阶段：停止 Patroni</h3><p>如果 Patroni 服务正在运行且未指定 <code>--skip-patroni</code>：</p><ul><li>执行 <code>systemctl stop patroni</code></li><li>等待 PostgreSQL 随 Patroni 自动停止</li></ul><h3 id=第三阶段确保-postgresql-停止>第三阶段：确保 PostgreSQL 停止</h3><p>采用渐进式策略确保 PostgreSQL 完全停止：</p><ol><li><strong>等待自动停止</strong>：Patroni 停止后等待 30 秒</li><li><strong>优雅停止</strong>：使用 <code>pg_ctl stop -m fast</code>（最多重试 3 次，指数退避）</li><li><strong>立即停止</strong>：使用 <code>pg_ctl stop -m immediate</code></li><li><strong>强制终止</strong>：使用 <code>kill -9</code>（最后手段）</li></ol><h3 id=第四阶段执行恢复>第四阶段：执行恢复</h3><p>调用 pgBackRest 执行实际的数据恢复：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pgbackrest restore --target-action<span style=color:#ce5c00;font-weight:700>=</span>promote ...
</span></span></code></pre></div><h3 id=第五阶段启动-postgresql>第五阶段：启动 PostgreSQL</h3><p>除非指定 <code>--no-restart</code>，否则自动启动 PostgreSQL：</p><ul><li>等待启动完成（超时 120 秒）</li><li>验证进程确实运行</li></ul><h3 id=第六阶段恢复后指引>第六阶段：恢复后指引</h3><p>显示详细的后续操作指引，包括：</p><ul><li>如何验证恢复的数据</li><li>如何提升为主库</li><li>如何恢复 Patroni 集群管理</li><li>如何重新创建 pgBackRest stanza</li></ul><h2 id=使用示例>使用示例</h2><h3 id=场景一误删数据恢复>场景一：误删数据恢复</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 查看可用的备份</span>
</span></span><span style=display:flex><span>pig pb info
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 恢复到误删前的时间点</span>
</span></span><span style=display:flex><span>pig pitr -t <span style=color:#4e9a06>&#34;2025-01-15 09:30:00+08&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 验证数据</span>
</span></span><span style=display:flex><span>pig pg psql
</span></span><span style=display:flex><span>SELECT * FROM important_table<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 确认无误后提升为主库</span>
</span></span><span style=display:flex><span>pig pg promote
</span></span></code></pre></div><h3 id=场景二恢复到最新状态>场景二：恢复到最新状态</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 服务器故障后恢复到最新数据</span>
</span></span><span style=display:flex><span>pig pitr -d
</span></span></code></pre></div><h3 id=场景三快速恢复到备份点>场景三：快速恢复到备份点</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复到备份一致性点（不需要回放 WAL）</span>
</span></span><span style=display:flex><span>pig pitr -I
</span></span></code></pre></div><h3 id=场景四自动化脚本>场景四：自动化脚本</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 跳过所有确认，适合自动化</span>
</span></span><span style=display:flex><span>pig pitr -d -y
</span></span></code></pre></div><h3 id=场景五独立-postgresql-实例>场景五：独立 PostgreSQL 实例</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 非 Patroni 管理的实例</span>
</span></span><span style=display:flex><span>pig pitr -d --skip-patroni
</span></span></code></pre></div><h3 id=场景六仅恢复不启动>场景六：仅恢复不启动</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 恢复后手动检查，再决定是否启动</span>
</span></span><span style=display:flex><span>pig pitr -d --no-restart
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查恢复的数据目录</span>
</span></span><span style=display:flex><span>ls -la /pg/data/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 手动启动</span>
</span></span><span style=display:flex><span>pig pg start
</span></span></code></pre></div><h2 id=执行计划示例>执行计划示例</h2><p>执行 <code>pig pitr -d --dry-run</code> 会显示类似以下的执行计划：</p><pre tabindex=0><code>══════════════════════════════════════════════════════════════════
 PITR Execution Plan
══════════════════════════════════════════════════════════════════

Current State:
  Data Directory:  /pg/data
  Database User:   postgres
  Patroni Service: active
  PostgreSQL:      running (PID: 12345)

Recovery Target:
  Latest (end of WAL stream)

Execution Steps:
  [1] Stop Patroni service
  [2] Ensure PostgreSQL is stopped
  [3] Execute pgBackRest restore
  [4] Start PostgreSQL
  [5] Print post-restore guidance

══════════════════════════════════════════════════════════════════

[Dry-run mode] No changes made.
</code></pre><h2 id=恢复后操作>恢复后操作</h2><p>成功恢复后，命令会显示详细的后续操作指引：</p><pre tabindex=0><code>══════════════════════════════════════════════════════════════════
 PITR Complete
══════════════════════════════════════════════════════════════════

[1] Verify recovered data:
   pig pg psql

[2] If satisfied, promote to primary:
   pig pg promote

[3] To resume Patroni cluster management:
   WARNING: Ensure data is correct before starting Patroni!
   systemctl start patroni

   Or if you want this node to be the leader:
   1. Promote PostgreSQL first: pig pg promote
   2. Then start Patroni: systemctl start patroni

[4] Re-create pgBackRest stanza if needed:
   pig pb create

══════════════════════════════════════════════════════════════════
</code></pre><h2 id=安全机制>安全机制</h2><h3 id=确认倒计时>确认倒计时</h3><p>除非使用 <code>--yes</code> 参数，命令执行前会显示 5 秒倒计时：</p><pre tabindex=0><code>WARNING: This will overwrite the current database!
Press Ctrl+C to cancel, or wait for countdown...
Starting PITR in 5 seconds...
</code></pre><h3 id=渐进式停止策略>渐进式停止策略</h3><p>为确保数据安全，停止 PostgreSQL 采用渐进式策略：</p><ol><li>先尝试优雅停止（保证数据一致性）</li><li>失败后尝试立即停止</li><li>最后才使用 kill -9（仅在极端情况）</li></ol><h3 id=恢复验证>恢复验证</h3><p>恢复后自动验证 PostgreSQL 是否成功启动，如果失败会提示检查日志。</p><h2 id=设计说明>设计说明</h2><p><strong>与其他命令的关系：</strong></p><ul><li><code>pig pitr</code> 内部调用 <code>pig pt stop</code>、<code>pig pg stop</code>、<code>pig pg start</code> 和 <code>pig pb restore</code></li><li>提供比单独命令更高级别的自动化协调</li><li>适合生产环境的完整 PITR 工作流</li></ul><p><strong>错误处理：</strong></p><ul><li>每个阶段都有详细的错误信息</li><li>失败时提示相关日志位置</li><li>支持中断后手动继续</li></ul><p><strong>权限执行：</strong></p><ul><li>如果当前用户已是 DBSU：直接执行命令</li><li>如果当前用户是 root：使用 <code>su - postgres -c "..."</code> 执行</li><li>其他用户：使用 <code>sudo -inu postgres -- ...</code> 执行</li></ul><p><strong>平台支持：</strong></p><p>此命令专为 Linux 系统设计，依赖 Pigsty 的默认目录结构。</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>