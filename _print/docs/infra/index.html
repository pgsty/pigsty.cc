<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/infra/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/infra/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>模块：INFRA | PIGSTY</title><meta name=description content="可独立使用且可选的基础设施，为 PostgreSQL 提供 NTP，DNS，可观测性等基础服务。"><meta property="og:url" content="https://pigsty.cc/docs/infra/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="模块：INFRA"><meta property="og:description" content="可独立使用且可选的基础设施，为 PostgreSQL 提供 NTP，DNS，可观测性等基础服务。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="模块：INFRA"><meta itemprop=description content="可独立使用且可选的基础设施，为 PostgreSQL 提供 NTP，DNS，可观测性等基础服务。"><meta itemprop=dateModified content="2026-02-13T23:30:49+08:00"><meta itemprop=wordCount content="969"><meta itemprop=keywords content="参考"><meta name=twitter:card content="summary"><meta name=twitter:title content="模块：INFRA"><meta name=twitter:description content="可独立使用且可选的基础设施，为 PostgreSQL 提供 NTP，DNS，可观测性等基础服务。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/infra/>返回本页常规视图</a>.</p></div><h1 class=title>模块：INFRA</h1><div class=lead>可独立使用且可选的基础设施，为 PostgreSQL 提供 NTP，DNS，可观测性等基础服务。</div><ul><li>1: <a href=#pg-b132f85e66823fcf873f2eae62277609>集群配置</a></li><li>2: <a href=#pg-878bc43f92081e59141a2773d0c07d86>参数列表</a></li><li>3: <a href=#pg-83a306c7aef5ddfdbad1dd3d6363e905>预置剧本</a></li><li>4: <a href=#pg-338892e63af76b4e44d46c71803f5af5>监控告警</a></li><li>5: <a href=#pg-f8c94ca1b2e6cfdd961016e7d77247d8>指标列表</a></li><li>6: <a href=#pg-00fcc0891b8e51b39a5b93b6e89a421f>常见问题</a></li><li>7: <a href=#pg-534bd7b2a1b7fa250e24342de3f0e5b1>管理预案</a></li><ul><li>7.1: <a href=#pg-52d708085244eb9d51e81dd9e7c10996>Nginx 管理</a></li><li>7.2: <a href=#pg-3e5c80de91c09afe274f784b52a45287>软件仓库</a></li><li>7.3: <a href=#pg-11e76a7fd5b13e8b9ed2ffe665bd1146>域名管理</a></li><li>7.4: <a href=#pg-99138bcc6d2f367b6fb7df8b7a59e131>模块管理</a></li><li>7.5: <a href=#pg-3903df191db5a10a2713083bc196961f>CA 与证书</a></li><li>7.6: <a href=#pg-c91827b2709e7c2e7f7afc8662f9e0bf>Grafana 高可用部署：使用 PostgreSQL 后端数据库</a></li></ul></ul><div class=content><p><a href=#%E9%85%8D%E7%BD%AE>配置</a> | <a href=#%E7%AE%A1%E7%90%86>管理</a> | <a href=#%E5%89%A7%E6%9C%AC>剧本</a> | <a href=#%E7%9B%91%E6%8E%A7>监控</a> | <a href=#%E5%8F%82%E6%95%B0>参数</a></p><hr><h2 id=概览>概览</h2><p>每一套 Pigsty 部署都会提供一套基础架构组件，为纳管的节点与数据库集群提供服务，组件包括：</p><table class=full-width><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>端口</th><th>描述</th></tr></thead><tbody><tr><td style=text-align:left><a href=#nginx>Nginx</a></td><td style=text-align:left><code>80/443</code></td><td>Web 服务门户、本地软件仓库与统一入口</td></tr><tr><td style=text-align:left><a href=#grafana>Grafana</a></td><td style=text-align:left><code>3000</code></td><td>可视化平台，提供监控大屏、巡检与数据应用</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>VictoriaMetrics</a></td><td style=text-align:left><code>8428</code></td><td>时序数据库与 VMUI，可兼容 Prometheus API</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>VictoriaLogs</a></td><td style=text-align:left><code>9428</code></td><td>集中式日志数据库，接收 Vector 推送的结构化日志</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>VictoriaTraces</a></td><td style=text-align:left><code>10428</code></td><td>链路追踪与事件存储，可用于慢 SQL / 请求追踪</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>VMAlert</a></td><td style=text-align:left><code>8880</code></td><td>告警规则评估器，基于 VictoriaMetrics 指标触发告警</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>AlertManager</a></td><td style=text-align:left><code>9059</code></td><td>告警聚合与分发，接收 VMAlert 发送的通知</td></tr><tr><td style=text-align:left><a href=#victoria-%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%A5%97%E4%BB%B6>BlackboxExporter</a></td><td style=text-align:left><code>9115</code></td><td>ICMP/TCP/HTTP 黑盒探测</td></tr><tr><td style=text-align:left><a href=#dnsmasq>DNSMASQ</a></td><td style=text-align:left><code>53</code></td><td>DNS 服务器，提供内部域名解析</td></tr><tr><td style=text-align:left><a href=#chronyd>Chronyd</a></td><td style=text-align:left><code>123</code></td><td>NTP 时间服务器</td></tr><tr><td style=text-align:left><a href=#postgresql>PostgreSQL</a></td><td style=text-align:left><code>5432</code></td><td>CMDB 与默认数据库</td></tr><tr><td style=text-align:left><a href=#ansible>Ansible</a></td><td style=text-align:left>-</td><td>运行剧本、编排所有基础设施</td></tr></tbody></table><p>在 Pigsty 中，<a href=/docs/pgsql>PGSQL</a> 模块会使用到 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上的一些服务，具体来说包括：</p><ul><li>数据库集群/主机节点的域名，依赖 INFRA 节点的 DNSMASQ <strong>解析</strong>。</li><li>在数据库节点软件上<strong>安装</strong>，需要用到 INFRA 节点上的 Nginx 托管的本地 yum/apt 软件源。</li><li>数据库集群/节点的监控<strong>指标</strong>，会被 INFRA 节点上的 VictoriaMetrics 拉取并存储，可通过 VMUI / PromQL 访问。</li><li>数据库与节点运行日志由 Vector 收集，统一推送到 INFRA 上的 VictoriaLogs，支持在 Grafana 中检索。</li><li>VMAlert 根据 VictoriaMetrics 中的指标<strong>评估</strong>告警规则，并将事件转发到 Alertmanager。</li><li>用户会从 Infra/Admin 节点上使用 Ansible 或其他工具发起对数据库节点的<strong>管理</strong>：<ul><li>执行集群创建，扩缩容，实例/集群回收</li><li>创建业务用户、业务数据库、修改服务、HBA修改；</li><li>执行日志采集、垃圾清理，备份，巡检等</li></ul></li><li>数据库节点默认会从 INFRA/ADMIN 节点上的 NTP 服务器同步时间</li><li>如果没有专用集群，高可用组件 Patroni 会使用 INFRA 节点上的 etcd 作为高可用DCS。</li><li>如果没有专用集群，备份组件 pgbackrest 会使用 INFRA 节点上的 minio 作为可选的集中备份仓库。</li></ul><hr><h3 id=nginx>Nginx</h3><p>Nginx是Pigsty所有WebUI类服务的访问入口，默认使用管理节点80端口。</p><p>有许多带有 WebUI 的基础设施组件通过 Nginx 对外暴露服务，例如 Grafana、VictoriaMetrics（VMUI）、AlertManager，以及 HAProxy 流量管理页等，此外 yum/apt 仓库等静态文件资源也通过 Nginx 对外提供服务。</p><p>Nginx会根据 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 的内容，通过<strong>域名</strong>进行区分，将访问请求转发至对应的上游组件处理。如果您使用了其他的域名，或者公网域名，可以在这里进行相应修改：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># domain names and upstream servers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># VMUI</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#logs         : { domain: logs.pigsty ,endpoint: &#34;${admin_ip}:9428&#34; }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#minio        : { domain: m.pigsty    ,endpoint: &#34;${admin_ip}:9001&#34; ,scheme: https ,websocket: true }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty强烈建议使用域名访问Pigsty UI系统，而不是直接通过IP+端口的方式访问，基于以下几个理由：</p><ul><li>使用域名便于启用 HTTPS 流量加密，可以将访问收拢至Nginx，审计一切请求，并方便地集成认证机制。</li><li>一些组件默认只监听 127.0.0.1 ，因此只能通过Nginx代理访问。</li><li>域名更容易记忆，并提供了额外的配置灵活性。</li></ul><p>如果您没有可用的互联网域名或本地DNS解析，您可以在 <code>/etc/hosts</code> （MacOS/Linux）或<code>C:\Windows\System32\drivers\etc\hosts</code> （Windows）中添加本地静态解析记录。</p><p>Nginx相关配置参数位于：<a href=/docs/infra/param#nginx>配置：INFRA - NGINX</a></p><hr><h3 id=本地软件仓库>本地软件仓库</h3><p>Pigsty会在安装时首先建立一个本地软件源，以加速后续软件安装。</p><p>该软件源由Nginx提供服务，默认位于为 <code>/www/pigsty</code>，可以访问 <code>http://i.pigsty/pigsty</code> 使用。</p><p>Pigsty的离线软件包即是将已经建立好的软件源目录（yum/apt）整个打成压缩包，当Pigsty尝试构建本地源时，如果发现本地源目录 <code>/www/pigsty</code> 已经存在，
且带有 <code>/www/pigsty/repo_complete</code> 标记文件，则会认为本地源已经构建完成，从而跳过从原始上游下载软件的步骤，消除了对互联网访问的依赖。</p><p>Repo定义文件位于 <code>/www/pigsty.repo</code>，默认可以通过 <code>http://${admin_ip}/pigsty.repo</code> 获取</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L http://i.pigsty/pigsty.repo -o /etc/yum.repos.d/pigsty.repo
</span></span></code></pre></div><p>您也可以在没有Nginx的情况下直接使用文件本地源：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[pigsty-local]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Pigsty local $releasever - $basearch</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>baseurl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>file:///www/pigsty/</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>0</span>
</span></span></code></pre></div><p>本地软件仓库相关配置参数位于：<a href=/docs/infra/param#repo>配置：INFRA - REPO</a></p><hr><h3 id=victoria-可观测性套件>Victoria 可观测性套件</h3><p>Pigsty v4.1 使用 VictoriaMetrics 家族提供统一的监控、日志与链路追踪能力：</p><ul><li><strong>VictoriaMetrics</strong> 默认监听 <code>8428</code> 端口，可通过 <code>http://p.pigsty</code> 或 <code>https://i.pigsty/vmetrics/</code> 访问 VMUI，兼容 Prometheus API。</li><li><strong>VMAlert</strong> 负责评估 <code>/infra/rules/*.yml</code> 中的告警规则，监听 <code>8880</code> 端口，并将告警事件发送到 Alertmanager。</li><li><strong>VictoriaLogs</strong> 监听 <code>9428</code> 端口，支持 <code>https://i.pigsty/vlogs/</code> 查询界面。所有节点默认运行 Vector，将系统日志、PostgreSQL 日志等结构化后推送至 VictoriaLogs。</li><li><strong>VictoriaTraces</strong> 监听 <code>10428</code> 端口，用于慢 SQL / Trace 采集，Grafana 以 Jaeger 数据源方式访问。</li><li><strong>Alertmanager</strong> 监听 <code>9059</code> 端口，可通过 <code>http://a.pigsty</code> 或 <code>https://i.pigsty/alertmgr/</code> 管理告警通知。完成 SMTP、Webhook 等配置后即可推送消息。</li><li><strong>Blackbox Exporter</strong> 默认监听 <code>9115</code> 端口，用于 Ping/TCP/HTTP 探测，可通过 <code>https://i.pigsty/blackbox/</code> 访问。</li></ul><p>更多信息请参阅：<a href=/docs/infra/param#victoria>配置：INFRA - VICTORIA</a> 与 <a href=/docs/infra/param#prometheus>配置：INFRA - PROMETHEUS</a>。</p><hr><h3 id=grafana>Grafana</h3><p>Grafana 是 Pigsty 的 WebUI 核心，默认监听 <code>3000</code> 端口，可以直接通过 <code>IP:3000</code> 或域名 <code>http://g.pigsty</code> 访问。</p><p>Pigsty 预置了针对 VictoriaMetrics / Logs / Traces 的数据源（<code>vmetrics-*</code>、<code>vlogs-*</code>、<code>vtraces-*</code>），以及大量 Dashboard，可通过 URL 进行联动跳转，快速定位问题。</p><p>Grafana 也可作为通用低代码可视化平台使用，因此 Pigsty 默认安装了 ECharts、victoriametrics-datasource 等插件，方便构建监控大屏或巡检报表。</p><p>Grafana 相关配置参数位于：<a href=/docs/infra/param#grafana>配置：INFRA - GRAFANA</a>。</p><hr><h3 id=ansible>Ansible</h3><p>Pigsty默认会在元节点上安装Ansible，Ansible是一个流行的运维工具，采用声明式的配置风格与幂等的剧本设计，可以极大降低系统维护的复杂度。</p><hr><h3 id=dnsmasq>DNSMASQ</h3><p>DNSMASQ 提供环境内的DNS<strong>解析</strong>服务，其他模块的域名将会注册到 INFRA节点上的 DNSMASQ 服务中。</p><p>DNS记录默认放置于所有INFRA节点的 <code>/etc/hosts.d/</code> 目录中。</p><p>DNSMASQ相关配置参数位于：<a href=/docs/infra/param#dns>配置：INFRA - DNS</a></p><hr><h3 id=chronyd>Chronyd</h3><p>NTP服务用于同步环境内所有节点的时间（可选）</p><p>NTP相关配置参数位于：<a href=/docs/node/param#node_time>配置：NODES - NTP</a></p><hr><h3 id=postgresql>PostgreSQL</h3><p>Pigsty 的元数据库（CMDB）通常使用 PostgreSQL，默认监听 <code>5432</code> 端口，用于存储 Pigsty 元数据并支撑部分内置应用。
更多信息请参阅：<a href=/docs/pgsql>PGSQL</a> 模块与 <a href=/docs/infra/param#meta>配置：INFRA - META</a>。</p><hr><h2 id=配置>配置</h2><p>要在节点上安装 INFRA 模块，首先需要在配置清单中的 <code>infra</code> 分组中将其加入，并分配实例号 <a href=/docs/infra/param#infra_seq><code>infra_seq</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 配置单个 INFRA 节点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 配置两个 INFRA 节点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后，使用 <a href=#infrayml><code>infra.yml</code></a> 剧本在节点上初始化 INFRA 模块即可。</p><hr><h2 id=管理>管理</h2><p>下面是与 INFRA 模块相关的一些管理任务：</p><hr><h3 id=安装卸载infra模块>安装卸载Infra模块</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     <span style=color:#8f5902;font-style:italic># 在 infra 分组上安装 INFRA 模块</span>
</span></span><span style=display:flex><span>./infra-rm.yml  <span style=color:#8f5902;font-style:italic># 从 infra 分组上卸载 INFRA 模块</span>
</span></span></code></pre></div><hr><h3 id=管理本地软件仓库>管理本地软件仓库</h3><p>您可以使用以下剧本子任务，管理 Infra节点 上的本地yun源：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo              <span style=color:#8f5902;font-style:italic>#从互联网或离线包中创建本地软件源</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># 创建本地软件源</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># 检查本地软件源是否已经存在？</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># 如果存在，直接使用已有的本地软件源</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># 如果不存在，从上游构建本地软件源</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_upstream     <span style=color:#8f5902;font-style:italic># 处理 /etc/yum.repos.d 中的上游仓库文件</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_remove       <span style=color:#8f5902;font-style:italic># 如果 repo_remove == true，则删除现有的仓库文件</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_add          <span style=color:#8f5902;font-style:italic># 将上游仓库文件添加到 /etc/yum.repos.d （或 /etc/apt/sources.list.d）</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># 从由 repo_url_packages 定义的互联网下载包</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_cache        <span style=color:#8f5902;font-style:italic># 使用 yum makecache / apt update 创建上游软件源元数据缓存</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># 安装如 createrepo_c、yum-utils 等的引导包...（或 dpkg-）</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_pkg          <span style=color:#8f5902;font-style:italic># 从上游仓库下载包 &amp; 依赖项</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_create       <span style=color:#8f5902;font-style:italic># 使用 createrepo_c &amp; modifyrepo_c 创建本地软件源</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_use          <span style=color:#8f5902;font-style:italic># 将新建的仓库添加到 /etc/yum.repos.d | /etc/apt/sources.list.d 用起来</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># 如果没有 nginx 在服务，启动一个 nginx 作为 Web Server</span>
</span></span></code></pre></div><p>其中最常用的命令为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     -t repo_upstream     <span style=color:#8f5902;font-style:italic># 向 INFRA 节点添加 repo_upstream 中定义的上游软件源</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_pkg          <span style=color:#8f5902;font-style:italic># 从上游仓库下载包及其依赖项。</span>
</span></span><span style=display:flex><span>./infra.yml     -t repo_create       <span style=color:#8f5902;font-style:italic># 使用 createrepo_c &amp; modifyrepo_c 创建/更新本地 yum 仓库</span>
</span></span></code></pre></div><hr><h3 id=管理基础设施组件>管理基础设施组件</h3><p>您可以使用以下剧本子任务，管理 Infra节点 上的各个基础设施组件</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t infra           <span style=color:#8f5902;font-style:italic># 配置基础设施</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_env       <span style=color:#8f5902;font-style:italic># 配置管理节点上的环境变量：env_patroni, env_pg, env_pgadmin, env_var</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_pkg       <span style=color:#8f5902;font-style:italic># 安装 INFRA 所需的软件包：infra_packages</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_user      <span style=color:#8f5902;font-style:italic># 设置 infra 操作系统用户组</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_cert      <span style=color:#8f5902;font-style:italic># 为 infra 组件颁发证书</span>
</span></span><span style=display:flex><span>./infra.yml -t dns             <span style=color:#8f5902;font-style:italic># 配置 DNSMasq：dns_config, dns_record, dns_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># 配置 Nginx：nginx_config, nginx_cert, nginx_static, nginx_launch, nginx_certbot, nginx_reload, nginx_exporter</span>
</span></span><span style=display:flex><span>./infra.yml -t victoria        <span style=color:#8f5902;font-style:italic># 配置 VictoriaMetrics/Logs/Traces：vmetrics|vlogs|vtraces|vmalert</span>
</span></span><span style=display:flex><span>./infra.yml -t alertmanager    <span style=color:#8f5902;font-style:italic># 配置 AlertManager：alertmanager_config, alertmanager_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t blackbox        <span style=color:#8f5902;font-style:italic># 配置 Blackbox Exporter：blackbox_config, blackbox_launch</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana         <span style=color:#8f5902;font-style:italic># 配置 Grafana：grafana_clean, grafana_config, grafana_launch, grafana_provision</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_register  <span style=color:#8f5902;font-style:italic># 将 infra 组件注册到 VictoriaMetrics / Grafana</span>
</span></span></code></pre></div><p>其他常用的任务包括：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_index                        <span style=color:#8f5902;font-style:italic># 重新渲染 Nginx 首页内容</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload          <span style=color:#8f5902;font-style:italic># 重新渲染 Nginx 网站门户配置，对外暴露新的上游服务。</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_config,vmetrics_launch    <span style=color:#8f5902;font-style:italic># 重新生成 VictoriaMetrics 主配置文件，并重启服务</span>
</span></span><span style=display:flex><span>./infra.yml -t vlogs_config,vlogs_launch          <span style=color:#8f5902;font-style:italic># 重新渲染 VictoriaLogs 配置</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_clean                     <span style=color:#8f5902;font-style:italic># 清理 VictoriaMetrics 存储数据目录</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana_provision                  <span style=color:#8f5902;font-style:italic># 重新加载 Grafana 仪表盘与数据源定义</span>
</span></span></code></pre></div><hr><h2 id=剧本>剧本</h2><p>Pigsty 提供了三个与 INFRA 模块相关的剧本：</p><ul><li><a href=#infrayml><code>infra.yml</code></a> ：在 infra 节点上初始化 pigsty 基础设施</li><li><a href=#infra-rmyml><code>infra-rm.yml</code></a>：从 infra 节点移除基础设施组件</li><li><a href=#deployyml><code>deploy.yml</code></a>：在当前节点上一次性完整安装 Pigsty</li></ul><hr><h3 id=infrayml><code>infra.yml</code></h3><p>INFRA模块剧本 <a href=https://github.com/pgsty/pigsty/blob/main/infra.yml><code>infra.yml</code></a> 用于在 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>Infra节点</strong></a> 上初始化 pigsty 基础设施</p><p><strong>执行该剧本将完成以下任务</strong></p><ul><li>配置元节点的目录与环境变量</li><li>下载并建立一个本地软件源，加速后续安装。（若使用离线软件包，则跳过下载阶段）</li><li>将当前元节点作为一个普通节点纳入 Pigsty 管理</li><li>部署<strong>基础设施</strong>组件，包括 VictoriaMetrics/Logs/Traces、VMAlert、Grafana、Alertmanager、Blackbox Exporter 等</li></ul><p><strong>该剧本默认在 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上执行</strong></p><ul><li>Pigsty默认将使用<strong>当前执行此剧本的节点</strong>作为Pigsty的 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>Infra节点</strong></a> 与 <a href=/docs/concept/arch/node#admin%E8%8A%82%E7%82%B9><strong>ADMIN节点</strong></a>。</li><li>Pigsty在 <a href=/docs/setup/install#%E9%85%8D%E7%BD%AE>配置过程</a> 中默认会将当前节点标记为Infra/Admin节点，并使用<strong>当前节点首要IP地址</strong>替换配置模板中的占位IP地址<code>10.10.10.10</code>。</li><li>该节点除了可以发起管理，部署有基础设施，与一个部署普通托管节点并无区别。</li><li>单机安装时，ETCD 也会安装在此节点上，提供 DCS 服务</li></ul><p><strong>本剧本的一些注意事项</strong></p><ul><li>本剧本为幂等剧本，重复执行默认不会清理历史数据与 Grafana 数据。</li><li>如需保留历史监控数据，请先将 <code>vmetrics_clean</code>、<code>vlogs_clean</code>、<code>vtraces_clean</code> 设置为 <code>false</code>。</li><li>如果将 <code>vmetrics_clean</code>、<code>vlogs_clean</code>、<code>vtraces_clean</code>、<code>grafana_clean</code> 设为 <code>true</code>，对应组件数据会在执行时被清理。</li><li>当离线软件源 <code>/www/pigsty/repo_complete</code> 存在时，本剧本会跳过从互联网下载软件的任务。完整执行该剧本耗时约5-8分钟，视机器配置而异。</li><li>不使用离线软件包而直接从互联网原始上游下载软件时，可能耗时10-20分钟，根据您的网络条件而异。</li></ul><p><a href=https://asciinema.org/a/566412><img src=https://asciinema.org/a/566412.svg alt=asciicast></a></p><hr><h3 id=infra-rmyml><code>infra-rm.yml</code></h3><p>INFRA模块剧本 <a href=https://github.com/pgsty/pigsty/blob/main/infra-rm.yml><code>infra-rm.yml</code></a> 用于从 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上移除 pigsty 基础设施</p><p>常用子任务包括：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml               <span style=color:#8f5902;font-style:italic># 移除 INFRA 模块</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t service    <span style=color:#8f5902;font-style:italic># 停止 INFRA 上的基础设施服务</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t data       <span style=color:#8f5902;font-style:italic># 移除 INFRA 上的存留数据</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t package    <span style=color:#8f5902;font-style:italic># 卸载 INFRA 上安装的软件包</span>
</span></span></code></pre></div><hr><h3 id=deployyml><code>deploy.yml</code></h3><p>INFRA模块剧本 <a href=https://github.com/pgsty/pigsty/blob/main/deploy.yml><code>deploy.yml</code></a> 用于在<strong>所有节点</strong>上一次性完整安装 Pigsty</p><p>该剧本在 <a href=/docs/setup/playbook#%E9%83%A8%E7%BD%B2%E5%89%A7%E6%9C%AC>剧本：一次性安装</a> 中有更详细的介绍。</p><hr><h2 id=监控>监控</h2><p><a href=https://demo.pigsty.cc/d/pigsty>Pigsty Home</a> : Pigsty 监控系统主页</p><details><summary>Pigsty Home Dashboard</summary><p><a href=https://demo.pigsty.cc/d/pigsty/><img src=/img/dashboard/pigsty.jpg alt=pigsty.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/infra-overview>INFRA Overview</a> : Pigsty 基础设施自监控概览</p><details><summary>INFRA Overview Dashboard</summary><p><a href=https://demo.pigsty.cc/d/infra-overview/><img src=/img/dashboard/infra-overview.jpg alt=infra-overview.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/nginx-instance>Nginx Instance</a> : Nginx 监控指标与日志</p><details><summary>Nginx Overview Dashboard</summary><p><a href=https://demo.pigsty.cc/d/nginx-overview><img src=/img/dashboard/nginx-overview.jpg alt=nginx-overview.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/grafana-instance>Grafana Instance</a>: Grafana 监控指标与日志</p><details><summary>Grafana Overview Dashboard</summary><p><a href=https://demo.pigsty.cc/d/grafana-overview><img src=/img/dashboard/grafana-overview.jpg alt=grafana-overview.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/vmetrics-instance>VictoriaMetrics Instance</a>: VictoriaMetrics 抓取、查询与存储指标</p><p><a href=https://demo.pigsty.cc/d/vmalert-instance>VMAlert Instance</a>: 告警规则评估与队列状态</p><p><a href=https://demo.pigsty.cc/d/alertmanager-instance>Alertmanager Instance</a>: 告警聚合、通知管道与 Silences</p><p><a href=https://demo.pigsty.cc/d/vlogs-instance>VictoriaLogs Instance</a>: 日志写入速率、查询负载与索引命中</p><p><a href=https://demo.pigsty.cc/d/vtraces-instance>VictoriaTraces Instance</a>: Trace/KV 存储与 Jaeger 接口</p><p><a href=https://demo.pigsty.cc/d/logs-instance>Logs Instance</a>: 基于 Vector + VictoriaLogs 的节点日志检索</p><details><summary>Logs Instance Dashboard</summary><p><a href=https://demo.pigsty.cc/d/logs-instance><img src=/img/dashboard/logs-instance.jpg alt=logs-instance.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/cmdb-overview>CMDB Overview</a>: CMDB 可视化</p><details><summary>CMDB Overview Dashboard</summary><p><a href=https://demo.pigsty.cc/d/cmdb-overview><img src=/img/dashboard/cmdb-overview.jpg alt=cmdb-overview.jpg></a></p></details><p><a href=https://demo.pigsty.cc/d/etcd-overview>ETCD Overview</a>: etcd 监控指标与日志</p><details><summary>ETCD Overview Dashboard</summary><p><a href=https://demo.pigsty.cc/d/etcd-overview><img src=/img/dashboard/etcd-overview.jpg alt=etcd-overview.jpg></a></p></details><hr><h2 id=参数>参数</h2><p><a href=/docs/infra/param><code>INFRA</code></a> 模块有下列10个参数组。</p><ul><li><a href=/docs/infra/param#meta><code>META</code></a>：Pigsty元数据</li><li><a href=/docs/infra/param#ca><code>CA</code></a>：自签名公私钥基础设施/CA</li><li><a href=/docs/infra/param#infra_id><code>INFRA_ID</code></a>：基础设施门户，Nginx域名</li><li><a href=/docs/infra/param#repo><code>REPO</code></a>：本地软件源</li><li><a href=/docs/infra/param#infra_package><code>INFRA_PACKAGE</code></a>：基础设施软件包</li><li><a href=/docs/infra/param#nginx><code>NGINX</code></a>：Nginx 网络服务器</li><li><a href=/docs/infra/param#dns><code>DNS</code></a>：DNSMASQ 域名服务器</li><li><a href=/docs/infra/param#victoria><code>VICTORIA</code></a>：VictoriaMetrics / Logs / Traces 套件</li><li><a href=/docs/infra/param#prometheus><code>PROMETHEUS</code></a>：Alertmanager 与 Blackbox Exporter</li><li><a href=/docs/infra/param#grafana><code>GRAFANA</code></a>：Grafana 可观测性全家桶</li></ul><details><summary>参数速览</summary><p>为保持与 Pigsty 版本一致，请参阅 <a href=/docs/infra/param/#%E5%8F%82%E6%95%B0%E6%A6%82%E8%A7%88>《参数列表》</a> 获取最新的默认值、类型与层级说明。</p></details></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b132f85e66823fcf873f2eae62277609>1 - 集群配置</h1><div class=lead>如何配置 Infra 节点？定制 Nginx 服务器的配置与本地软件仓库的内容？配置 DNS，NTP 与监控组件的方法。</div><h2 id=配置说明>配置说明</h2><p>INFRA 主要用于提供<strong>监控</strong>基础设施，对于 PostgreSQL 数据库是<strong>可选项</strong>。</p><p>除非手工配置了对 INFRA 节点上 DNS/NTP 服务的依赖，否则 INFRA 模块故障通常不影响 PostgreSQL 数据库集群运行。</p><p>单个 INFRA 节点足以应对绝大部分场景。生产环境建议使用 2～3 个 INFRA 节点实现高可用。</p><p>通常出于提高资源利用率的考虑，PostgreSQL 高可用依赖的 ETCD 模块可以与 INFRA 模块共用节点。</p><p>使用 3 个以上的 INFRA 节点意义不大，但可以使用更多 ETCD 节点（如 5 个）提高 DCS 服务可用性。</p><hr><h2 id=配置样例>配置样例</h2><p>在配置清单中的 <code>infra</code> 分组加入节点 IP，并分配 Infra 实例号 <code>infra_seq</code>。</p><p>默认单个 INFRA 节点配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认情况下，<code>10.10.10.10</code> 占位符在配置过程中被替换为当前节点首要 IP 地址。</p><p>使用 <code>infra.yml</code> 剧本在节点上初始化 INFRA 模块。</p><h3 id=更多节点>更多节点</h3><p>两个 INFRA 节点配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>三个 INFRA 节点配置（含参数）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 2, repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 3, repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>grafana_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vmetrics_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vlogs_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>vtraces_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=infra-高可用>Infra 高可用</h2><p>Infra 模块中的大部分组件都属于"无状态/相同状态"，对于这类组件，高可用只需要操心"负载均衡"问题。</p><p>高可用可通过 Keepalived L2 VIP 或 HAProxy 四层负载均衡实现。二层互通网络推荐使用 Keepalived L2 VIP。</p><p>配置示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.8</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.8:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>需要设置 VIP 相关参数并在 <code>infra_portal</code> 中修改各 Infra 服务端点。</p><hr><h2 id=nginx配置>Nginx配置</h2><p>请参阅 <a href=/docs/infra/param/#nginx>Nginx 参数配置</a> 与 <a href=/docs/infra/admin/portal>Nginx 管理</a>。</p><hr><h2 id=本地仓库配置>本地仓库配置</h2><p>请参阅 <a href=/docs/infra/param/#repo>Repo 参数配置</a>。</p><hr><h2 id=dns配置>DNS配置</h2><p>请参阅 <a href=/docs/infra/param/#dns>DNS 参数配置</a> 与 <a href=/docs/infra/admin/domain>教程：DNS</a>。</p><hr><h2 id=ntp配置>NTP配置</h2><p>请参阅 <a href=/docs/node/param/#node_time>NTP 参数配置</a>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878bc43f92081e59141a2773d0c07d86>2 - 参数列表</h1><div class=lead>INFRA 模块提供了 10 组共 70+ 个配置参数</div><p>INFRA 模块负责配置 Pigsty 的基础设施组件：本地软件源、Nginx、DNSMasq、VictoriaMetrics、VictoriaLogs、Grafana、Alertmanager、Blackbox Exporter 等监控告警基础设施。</p><blockquote><p>Pigsty v4.x 使用 VictoriaMetrics 替代 Prometheus，使用 VictoriaLogs 替代 Loki，实现了更优秀的可观测性方案。</p></blockquote><table class=full-width><thead><tr><th style=text-align:left>参数组</th><th style=text-align:left>功能说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#meta><code>META</code></a></td><td style=text-align:left>Pigsty 元信息：版本、管理IP、区域、语言、代理</td></tr><tr><td style=text-align:left><a href=#ca><code>CA</code></a></td><td style=text-align:left>自签名 CA 证书管理</td></tr><tr><td style=text-align:left><a href=#infra_id><code>INFRA_ID</code></a></td><td style=text-align:left>基础设施节点身份标识与服务门户</td></tr><tr><td style=text-align:left><a href=#repo><code>REPO</code></a></td><td style=text-align:left>本地软件仓库配置</td></tr><tr><td style=text-align:left><a href=#infra_package><code>INFRA_PACKAGE</code></a></td><td style=text-align:left>基础设施节点软件包安装</td></tr><tr><td style=text-align:left><a href=#nginx><code>NGINX</code></a></td><td style=text-align:left>Nginx Web服务器与反向代理配置</td></tr><tr><td style=text-align:left><a href=#dns><code>DNS</code></a></td><td style=text-align:left>DNSMasq 域名解析服务配置</td></tr><tr><td style=text-align:left><a href=#victoria><code>VICTORIA</code></a></td><td style=text-align:left>VictoriaMetrics/Logs/Traces 可观测性套件</td></tr><tr><td style=text-align:left><a href=#prometheus><code>PROMETHEUS</code></a></td><td style=text-align:left>Alertmanager 与 Blackbox Exporter</td></tr><tr><td style=text-align:left><a href=#grafana><code>GRAFANA</code></a></td><td style=text-align:left>Grafana 可视化平台配置</td></tr></tbody></table><hr><h2 id=参数概览>参数概览</h2><p><a href=#meta><code>META</code></a> 参数组用于定义 Pigsty 的元信息，包括版本号、管理节点 IP、软件源区域、默认语言以及代理设置。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#version><code>version</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>pigsty 版本字符串</td></tr><tr><td style=text-align:left><a href=#admin_ip><code>admin_ip</code></a></td><td style=text-align:center><code>ip</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>管理节点 IP 地址</td></tr><tr><td style=text-align:left><a href=#region><code>region</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>上游镜像区域：default,china,europe</td></tr><tr><td style=text-align:left><a href=#language><code>language</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>默认语言，en 或 zh</td></tr><tr><td style=text-align:left><a href=#proxy_env><code>proxy_env</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>下载包时使用的全局代理环境变量</td></tr></tbody></table><p><a href=#ca><code>CA</code></a> 参数组用于配置 Pigsty 自签名 CA 证书管理，包括是否创建 CA、CA 名称以及证书有效期。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#ca_create><code>ca_create</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>不存在时是否创建 CA？默认为 true</td></tr><tr><td style=text-align:left><a href=#ca_cn><code>ca_cn</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>CA CN名称，固定为 pigsty-ca</td></tr><tr><td style=text-align:left><a href=#cert_validity><code>cert_validity</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>证书有效期，默认为 20 年</td></tr></tbody></table><p><a href=#infra_id><code>INFRA_ID</code></a> 参数组用于定义基础设施节点的身份标识，包括节点序号、服务门户配置以及数据目录。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#infra_seq><code>infra_seq</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>基础设施节点序号，必选身份参数</td></tr><tr><td style=text-align:left><a href=#infra_portal><code>infra_portal</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>通过 Nginx 门户暴露的基础设施服务列表</td></tr><tr><td style=text-align:left><a href=#infra_data><code>infra_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>基础设施数据目录，默认为 /data/infra</td></tr></tbody></table><p><a href=#repo><code>REPO</code></a> 参数组用于配置本地软件仓库，包括仓库启用开关、目录路径、上游源定义以及要下载的软件包列表。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#repo_enabled><code>repo_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上创建软件仓库？</td></tr><tr><td style=text-align:left><a href=#repo_home><code>repo_home</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>软件仓库主目录，默认为<code>/www</code></td></tr><tr><td style=text-align:left><a href=#repo_name><code>repo_name</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>软件仓库名称，默认为 pigsty</td></tr><tr><td style=text-align:left><a href=#repo_endpoint><code>repo_endpoint</code></a></td><td style=text-align:center><code>url</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>仓库的访问点：域名或 <code>ip:port</code> 格式</td></tr><tr><td style=text-align:left><a href=#repo_remove><code>repo_remove</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>构建本地仓库时是否移除现有上游仓库源定义文件？</td></tr><tr><td style=text-align:left><a href=#repo_modules><code>repo_modules</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>启用的上游仓库模块列表，用逗号分隔</td></tr><tr><td style=text-align:left><a href=#repo_upstream><code>repo_upstream</code></a></td><td style=text-align:center><code>upstream[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>上游仓库源定义：从哪里下载上游包？</td></tr><tr><td style=text-align:left><a href=#repo_packages><code>repo_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>从上游仓库下载哪些软件包？</td></tr><tr><td style=text-align:left><a href=#repo_extra_packages><code>repo_extra_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G/C/I</code></td><td style=text-align:left>从上游仓库下载哪些额外的软件包？</td></tr><tr><td style=text-align:left><a href=#repo_url_packages><code>repo_url_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>使用URL下载的额外软件包列表</td></tr></tbody></table><p><a href=#infra_package><code>INFRA_PACKAGE</code></a> 参数组用于定义在基础设施节点上安装的软件包（RPM/DEB）。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#infra_packages><code>infra_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>在基础设施节点上要安装的软件包</td></tr></tbody></table><p><a href=#nginx><code>NGINX</code></a> 参数组用于配置 Nginx Web 服务器与反向代理，包括启用开关、端口、SSL 模式、证书以及基础认证。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#nginx_enabled><code>nginx_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 nginx？</td></tr><tr><td style=text-align:left><a href=#nginx_clean><code>nginx_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>初始化时清理现有 nginx 配置？</td></tr><tr><td style=text-align:left><a href=#nginx_exporter_enabled><code>nginx_exporter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 nginx_exporter？</td></tr><tr><td style=text-align:left><a href=#nginx_exporter_port><code>nginx_exporter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx_exporter 监听端口，默认为 9113</td></tr><tr><td style=text-align:left><a href=#nginx_sslmode><code>nginx_sslmode</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx SSL模式？disable,enable,enforce</td></tr><tr><td style=text-align:left><a href=#nginx_cert_validity><code>nginx_cert_validity</code></a></td><td style=text-align:center><code>duration</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx 自签名证书有效期，默认为 397d</td></tr><tr><td style=text-align:left><a href=#nginx_home><code>nginx_home</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx 内容目录，默认为 <code>/www</code>，软链接到 nginx_data</td></tr><tr><td style=text-align:left><a href=#nginx_data><code>nginx_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx 实际数据目录，默认为 /data/nginx</td></tr><tr><td style=text-align:left><a href=#nginx_users><code>nginx_users</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx 基础认证用户：用户名和密码字典</td></tr><tr><td style=text-align:left><a href=#nginx_port><code>nginx_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx 监听端口，默认为 80</td></tr><tr><td style=text-align:left><a href=#nginx_ssl_port><code>nginx_ssl_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>nginx SSL监听端口，默认为 443</td></tr><tr><td style=text-align:left><a href=#certbot_sign><code>certbot_sign</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>是否使用 certbot 签署证书？</td></tr><tr><td style=text-align:left><a href=#certbot_email><code>certbot_email</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>certbot 通知邮箱地址</td></tr><tr><td style=text-align:left><a href=#certbot_options><code>certbot_options</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>certbot 额外的命令行参数</td></tr></tbody></table><p><a href=#dns><code>DNS</code></a> 参数组用于配置 DNSMasq 域名解析服务，包括启用开关、监听端口以及动态 DNS 记录。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#dns_enabled><code>dns_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上设置dnsmasq？</td></tr><tr><td style=text-align:left><a href=#dns_port><code>dns_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>DNS 服务器监听端口，默认为 53</td></tr><tr><td style=text-align:left><a href=#dns_records><code>dns_records</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>由 dnsmasq 解析的动态 DNS 记录</td></tr></tbody></table><p><a href=#victoria><code>VICTORIA</code></a> 参数组用于配置 VictoriaMetrics/Logs/Traces 可观测性套件，包括启用开关、端口、数据保留策略等。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#vmetrics_enabled><code>vmetrics_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 VictoriaMetrics？</td></tr><tr><td style=text-align:left><a href=#vmetrics_clean><code>vmetrics_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>初始化时清理 VictoriaMetrics 数据？</td></tr><tr><td style=text-align:left><a href=#vmetrics_port><code>vmetrics_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaMetrics 监听端口，默认为 8428</td></tr><tr><td style=text-align:left><a href=#vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>全局抓取间隔，默认为 10s</td></tr><tr><td style=text-align:left><a href=#vmetrics_scrape_timeout><code>vmetrics_scrape_timeout</code></a></td><td style=text-align:center><code>interval</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>全局抓取超时，默认为 8s</td></tr><tr><td style=text-align:left><a href=#vmetrics_options><code>vmetrics_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaMetrics 额外命令行参数</td></tr><tr><td style=text-align:left><a href=#vlogs_enabled><code>vlogs_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 VictoriaLogs？</td></tr><tr><td style=text-align:left><a href=#vlogs_clean><code>vlogs_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>初始化时清理 VictoriaLogs 数据？</td></tr><tr><td style=text-align:left><a href=#vlogs_port><code>vlogs_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaLogs 监听端口，默认为 9428</td></tr><tr><td style=text-align:left><a href=#vlogs_options><code>vlogs_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaLogs 额外命令行参数</td></tr><tr><td style=text-align:left><a href=#vtraces_enabled><code>vtraces_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 VictoriaTraces？</td></tr><tr><td style=text-align:left><a href=#vtraces_clean><code>vtraces_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>初始化时清理 VictoriaTraces 数据？</td></tr><tr><td style=text-align:left><a href=#vtraces_port><code>vtraces_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaTraces 监听端口，默认为 10428</td></tr><tr><td style=text-align:left><a href=#vtraces_options><code>vtraces_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VictoriaTraces 额外命令行参数</td></tr><tr><td style=text-align:left><a href=#vmalert_enabled><code>vmalert_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 VMAlert？</td></tr><tr><td style=text-align:left><a href=#vmalert_port><code>vmalert_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VMAlert 监听端口，默认为 8880</td></tr><tr><td style=text-align:left><a href=#vmalert_options><code>vmalert_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>VMAlert 额外命令行参数</td></tr></tbody></table><p><a href=#prometheus><code>PROMETHEUS</code></a> 参数组用于配置 Alertmanager 与 Blackbox Exporter，提供告警管理和网络探测功能。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#blackbox_enabled><code>blackbox_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上设置 blackbox_exporter？</td></tr><tr><td style=text-align:left><a href=#blackbox_port><code>blackbox_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>blackbox_exporter 监听端口，默认为 9115</td></tr><tr><td style=text-align:left><a href=#blackbox_options><code>blackbox_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>blackbox_exporter 额外的命令行参数选项</td></tr><tr><td style=text-align:left><a href=#alertmanager_enabled><code>alertmanager_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上设置 alertmanager？</td></tr><tr><td style=text-align:left><a href=#alertmanager_port><code>alertmanager_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>AlertManager 监听端口，默认为 9059</td></tr><tr><td style=text-align:left><a href=#alertmanager_options><code>alertmanager_options</code></a></td><td style=text-align:center><code>arg</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>alertmanager 额外的命令行参数选项</td></tr><tr><td style=text-align:left><a href=#exporter_metrics_path><code>exporter_metrics_path</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>exporter 指标路径，默认为 /metrics</td></tr></tbody></table><p><a href=#grafana><code>GRAFANA</code></a> 参数组用于配置 Grafana 可视化平台，包括启用开关、端口、管理员凭据以及数据源配置。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#grafana_enabled><code>grafana_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/I</code></td><td style=text-align:left>在此基础设施节点上启用 Grafana？</td></tr><tr><td style=text-align:left><a href=#grafana_port><code>grafana_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana 监听端口，默认为 3000</td></tr><tr><td style=text-align:left><a href=#grafana_clean><code>grafana_clean</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/A</code></td><td style=text-align:left>初始化Grafana期间清除数据？</td></tr><tr><td style=text-align:left><a href=#grafana_admin_username><code>grafana_admin_username</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana 管理员用户名，默认为 <code>admin</code></td></tr><tr><td style=text-align:left><a href=#grafana_admin_password><code>grafana_admin_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana 管理员密码，默认为 <code>pigsty</code></td></tr><tr><td style=text-align:left><a href=#grafana_auth_proxy><code>grafana_auth_proxy</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>启用 Grafana 身份代理？</td></tr><tr><td style=text-align:left><a href=#grafana_pgurl><code>grafana_pgurl</code></a></td><td style=text-align:center><code>url</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>外部 PostgreSQL 数据库 URL（用于Grafana持久化）</td></tr><tr><td style=text-align:left><a href=#grafana_view_password><code>grafana_view_password</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>Grafana 元数据库 PG 数据源密码</td></tr></tbody></table><hr><h2 id=meta><code>META</code></h2><p>这一小节指定了一套 Pigsty 部署的元数据：包括版本号，管理员节点 IP 地址，软件源镜像上游 <a href=#region><code>区域</code></a>，默认语言，以及下载软件包时使用的 http(s) 代理。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.1.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty 版本号</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 管理节点IP地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 上游镜像区域：default,china,europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>language: en                      # 默认语言</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en 或 zh</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># 全局HTTPS代理，用于下载、安装软件包。</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># http_proxy:  # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># https_proxy: # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># all_proxy:   # set your proxy here: e.g http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=version><code>version</code></h3><p>参数名称： <code>version</code>， 类型： <code>string</code>， 层次：<code>G</code></p><p>Pigsty 版本号字符串，默认值为当前版本：<code>v4.1.0</code>。</p><p>Pigsty 内部会使用版本号进行功能控制与内容渲染，请勿随意修改此参数。</p><p>Pigsty 使用语义化版本号，版本号字符串通常以字符 <code>v</code> 开头，例如 <code>v4.1.0</code>。</p><h3 id=admin_ip><code>admin_ip</code></h3><p>参数名称： <code>admin_ip</code>， 类型： <code>ip</code>， 层次：<code>G</code></p><p>管理节点的 IP 地址，默认为占位符 IP 地址：<code>10.10.10.10</code></p><p>由该参数指定的节点将被视为管理节点，通常指向安装 Pigsty 时的第一个节点，即中控节点。</p><p>默认值 <code>10.10.10.10</code> 是一个占位符，会在 <a href=/docs/setup/install#%E9%85%8D%E7%BD%AE>configure</a> 过程中被替换为实际的管理节点 IP 地址。</p><p>许多参数都会引用此参数，例如：</p><ul><li><a href=#infra_portal><code>infra_portal</code></a></li><li><a href=#repo_endpoint><code>repo_endpoint</code></a></li><li><a href=#repo_upstream><code>repo_upstream</code></a></li><li><a href=#dns_records><code>dns_records</code></a></li><li><a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a></li><li><a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a></li></ul><p>在这些参数中，字符串 <code>${admin_ip}</code> 会被替换为 <code>admin_ip</code> 的真实取值。使用这种机制，您可以为不同的节点指定不同的中控管理节点。</p><h3 id=region><code>region</code></h3><p>参数名称： <code>region</code>， 类型： <code>enum</code>， 层次：<code>G</code></p><p>上游镜像的区域，默认可选值为：<code>default</code>、 <code>china</code>、 <code>europe</code>，默认为： <code>default</code></p><p>如果一个不同于 <code>default</code> 的区域被设置，且在 <a href=#repo_upstream><code>repo_upstream</code></a> 中有对应的条目，将会使用该条目对应 <code>baseurl</code> 代替 <code>default</code> 中的 <code>baseurl</code>。</p><p>例如，如果您的区域被设置为 <code>china</code>，那么 Pigsty 会尝试使用中国地区的上游软件镜像站点以加速下载，如果某个上游软件仓库没有对应的中国地区镜像，那么会使用默认的上游镜像站点替代。
同时，在 <a href=#repo_url_packages><code>repo_url_packages</code></a> 中定义的 URL 地址，也会进行从 <code>repo.pigsty.io</code> 到 <code>repo.pigsty.cc</code> 的替换，以使用国内的镜像源。</p><h3 id=language><code>language</code></h3><p>参数名称： <code>language</code>， 类型： <code>enum</code>， 层次：<code>G</code></p><p>默认语言设置，可选值为 <code>en</code>（英文） 或 <code>zh</code>（中文），默认为 <code>en</code>。</p><p>此参数会影响 Pigsty 生成的部分配置与内容的语言偏好，例如 Grafana 面板的初始语言设置等。</p><p>如果您是中国用户，建议将此参数设置为 <code>zh</code>，以获得更好的中文支持体验。</p><h3 id=proxy_env><code>proxy_env</code></h3><p>参数名称： <code>proxy_env</code>， 类型： <code>dict</code>， 层次：<code>G</code></p><p>下载包时使用的全局代理环境变量，默认值指定了 <code>no_proxy</code>，即不使用代理的地址列表：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.aliyuncs.com,mirrors.tuna.tsinghua.edu.cn,mirrors.zju.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#http_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#https_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic>#all_proxy: &#39;http://username:password@proxy.address.com&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>当您在中国大陆地区从互联网上游安装时，特定的软件包可能会被墙，您可以使用代理来解决这个问题。</p><p>请注意，如果使用了 Docker 模块，那么这里的代理服务器配置也会写入 Docker Daemon 配置文件中。</p><p>请注意，如果在 <code>./configure</code> 过程中指定了 <code>-x</code> 参数，那么当前环境中的代理配置信息将会被自动填入到生成的 <code>pigsty.yaml</code> 文件中。</p><hr><h2 id=ca><code>CA</code></h2><p>Pigsty 使用自签名 CA 证书，用于支持高级安全特性，例如 HTTPS 访问、PostgreSQL SSL 连接等。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>ca_create</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 如果 CA 不存在，是否创建？默认为 true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ca_cn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-ca                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># CA CN名称，固定为 pigsty-ca</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>cert_validity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>7300d             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 证书有效期，默认为 20 年</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=ca_create><code>ca_create</code></h3><p>参数名称： <code>ca_create</code>， 类型： <code>bool</code>， 层次：<code>G</code></p><p>如果 CA 不存在，是否创建？默认值为 <code>true</code>。</p><p>当设置为 <code>true</code> 时，如果 <code>files/pki/ca</code> 目录中不存在 CA 公私钥对，Pigsty 将会自动创建一个新的 CA。</p><p>如果您已经有了一对 CA 公私钥对，可以将其复制到 <code>files/pki/ca</code> 目录下：</p><ul><li><code>files/pki/ca/ca.crt</code>：CA 公钥证书</li><li><code>files/pki/ca/ca.key</code>：CA 私钥文件</li></ul><p>Pigsty 将会使用现有的 CA 公私钥对，而不是新建一个。如果 CA 不存在且此参数设置为 <code>false</code>，则会报错终止。</p><p><strong>请务必保留并备份好部署过程中新生成的 CA 私钥文件，这对于后续签发新证书至关重要。</strong></p><blockquote><p>注意：Pigsty v3.x 使用的是 <code>ca_method</code> 参数（取值为 <code>create</code>/<code>recreate</code>/<code>copy</code>），v4.x 简化为布尔类型的 <code>ca_create</code>。</p></blockquote><h3 id=ca_cn><code>ca_cn</code></h3><p>参数名称： <code>ca_cn</code>， 类型： <code>string</code>， 层次：<code>G</code></p><p>CA CN（Common Name）名称，固定为 <code>pigsty-ca</code>，不建议修改。</p><p>你可以使用以下命令来查看节点上的 Pigsty CA 证书详情：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -text -in /etc/pki/ca.crt
</span></span></code></pre></div><h3 id=cert_validity><code>cert_validity</code></h3><p>参数名称： <code>cert_validity</code>， 类型： <code>interval</code>， 层次：<code>G</code></p><p>签发证书的有效期，默认为 20 年，对绝大多数场景都足够了。默认值为： <code>7300d</code></p><p>此参数影响由 Pigsty CA 签发的所有证书的有效期，包括：</p><ul><li>PostgreSQL 服务器证书</li><li>Patroni API 证书</li><li>etcd 服务器/客户端证书</li><li>其他内部服务证书</li></ul><p>注意：Nginx 使用的 HTTPS 证书有效期由 <a href=#nginx_cert_validity><code>nginx_cert_validity</code></a> 单独控制，因为现代浏览器对网站证书有效期有更严格的要求（最长 397 天）。</p><hr><h2 id=infra_id><code>INFRA_ID</code></h2><p>基础设施身份标识与门户定义。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#infra_seq: 1                     # 基础设施节点序号，必选身份参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 通过 Nginx 门户暴露的基础设施服务</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 默认首页服务器定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/infra          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 基础设施默认数据目录</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=infra_seq><code>infra_seq</code></h3><p>参数名称： <code>infra_seq</code>， 类型： <code>int</code>， 层次：<code>I</code></p><p>基础设施节点序号，必选身份参数，必须在基础设施节点上显式指定，所以不提供默认值。</p><p>此参数用于在多个基础设施节点的部署中唯一标识每个节点，通常使用从 1 开始的正整数。</p><p>示例配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=infra_portal><code>infra_portal</code></h3><p>参数名称： <code>infra_portal</code>， 类型： <code>dict</code>， 层次：<code>G</code></p><p>通过 Nginx 门户暴露的基础设施服务列表。v4.x 的默认值非常简洁：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 默认首页服务器定义</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Pigsty 会根据实际启用的组件自动配置相应的反向代理，用户通常只需要定义首页域名即可。</p><p>每条记录由一个 Key 与一个 Value 字典组成，<code>name</code> 作为键，代表组件名称，value 是一个可以配置以下参数的对象：</p><ul><li><code>name</code>: <strong>必填</strong>，指定 Nginx 服务器的名称<ul><li>默认记录：home 是固定名称，请不要修改。</li><li>作为 Nginx 配置文件名称的一部分，对应配置文件：<code>/etc/nginx/conf.d/&lt;name>.conf</code></li><li>没有 domain 字段的 Nginx 服务器不会生成配置文件，但会被用作引用。</li></ul></li><li><code>domain</code>: <strong>可选</strong>，当服务需要通过 Nginx 对外暴露时为<strong>必填</strong>字段，指定使用的域名<ul><li>在 Pigsty 自签名 Nginx HTTPS 证书中，域名将被添加到 Nginx SSL 证书的 SAN 字段</li><li>Pigsty 网页交叉引用将使用这里的默认域名</li></ul></li><li><code>endpoint</code>: 通常作为 path 的替代，指定上游服务器地址。设置 endpoint 表示这是一个反向代理服务器<ul><li>配置中可以使用 <code>${admin_ip}</code> 作为占位符，在部署时会被动态替换为 <a href=#admin_ip><code>admin_ip</code></a></li><li>默认反向代理服务器使用 <a href=https://github.com/pgsty/pigsty/blob/main/roles/infra/templates/nginx/endpoint.conf>endpoint.conf</a> 作为配置模板</li><li>反向代理服务器还可以配置 websocket 和 scheme 参数</li></ul></li><li><code>path</code>: 通常作为 endpoint 的替代，指定本地文件服务器路径。设置 path 表示这是一个本地 Web 服务器<ul><li>本地 Web 服务器使用 <a href=https://github.com/pgsty/pigsty/blob/main/roles/infra/templates/nginx/path.conf>path.conf</a> 作为配置模板</li><li>本地 Web 服务器还可以配置 index 参数，是否启用文件索引页</li></ul></li><li><code>certbot</code>: Certbot 证书名称，如果配置，将使用 Certbot 申请证书<ul><li>如果多个服务器指定相同的 certbot，Pigsty 会合并证书申请，最终证书名称为此 certbot 的值</li></ul></li><li><code>cert</code>: 证书文件路径，如果配置，将覆盖默认证书路径</li><li><code>key</code>: 证书密钥文件路径，如果配置，将覆盖默认证书密钥路径</li><li><code>websocket</code>: 是否启用 WebSocket 支持<ul><li>只有反向代理服务器可以配置此参数，如果启用将允许上游使用 WebSocket 连接</li></ul></li><li><code>scheme</code>: 上游服务器使用的协议，如果配置，将覆盖默认协议<ul><li>默认为 http，如果配置为 https 将强制使用 HTTPS 连接到上游服务器</li></ul></li><li><code>index</code>: 是否启用文件索引页<ul><li>只有本地 Web 服务器可以配置此参数，如果启用将启用 autoindex 配置自动生成目录索引页</li></ul></li><li><code>log</code>: Nginx 日志文件路径<ul><li>如果指定，访问日志将写入此文件，否则根据服务器类型使用默认日志文件</li><li>反向代理服务器使用 <code>/var/log/nginx/&lt;name>.log</code> 作为默认日志文件路径</li><li>本地 Web 服务器使用默认 Access 日志</li></ul></li><li><code>conf</code>: Nginx 配置文件路径<ul><li>显式指定使用的配置模板文件，位于 <a href=https://github.com/pgsty/pigsty/tree/main/roles/infra/templates/nginx>roles/infra/templates/nginx</a> 或 <a href=https://github.com/pgsty/pigsty/tree/main/templates/nginx>templates/nginx</a> 目录</li><li>如果未指定此参数，将使用默认配置模板</li></ul></li><li><code>config</code>: Nginx 配置代码块<ul><li>直接注入到 Nginx Server 配置块中的配置文本</li></ul></li><li><code>enforce_https</code>: 将 HTTP 重定向到 HTTPS<ul><li>可以通过 nginx_sslmode: enforce 指定全局配置</li><li>此配置不影响默认的 home 服务器，它将始终同时监听 80 和 443 端口以确保兼容性</li></ul></li></ul><h3 id=infra_data><code>infra_data</code></h3><p>参数名称： <code>infra_data</code>， 类型： <code>path</code>， 层次：<code>G</code></p><p>基础设施数据目录，默认值为 <code>/data/infra</code>。</p><p>此目录用于存放基础设施组件的数据文件，包括：</p><ul><li>VictoriaMetrics 时序数据库数据</li><li>VictoriaLogs 日志数据</li><li>VictoriaTraces 追踪数据</li><li>其他基础设施组件的持久化数据</li></ul><p>建议将此目录放置在独立的数据盘上，以便于管理和扩展。</p><hr><h2 id=repo><code>REPO</code></h2><p>本节配置是关于本地软件仓库的。 Pigsty 默认会在基础设施节点上启用一个本地软件仓库（APT / YUM）。</p><p>在初始化过程中，Pigsty 会从互联网上游仓库（由 <a href=#repo_upstream><code>repo_upstream</code></a> 指定）下载所有软件包及其依赖项（由 <a href=#repo_packages><code>repo_packages</code></a> 指定）到 <a href=#nginx_home><code>{{ nginx_home }}</code></a> / <a href=#repo_name><code>{{ repo_name }}</code></a> （默认为 <code>/www/pigsty</code>），所有软件及其依赖的总大小约为 1GB 左右。</p><p>创建本地软件仓库时，如果仓库已存在（判断方式：仓库目录中有一个名为 <code>repo_complete</code> 的标记文件）Pigsty 将认为仓库已经创建完成，跳过软件下载阶段，直接使用构建好的仓库。</p><p>如果某些软件包的下载速度太慢，您可以通过使用 <a href=#proxy_env><code>proxy_env</code></a> 配置项来设置下载代理来完成首次下载，或直接下载预打包的 <a href=/docs/setup/offline>离线软件包</a>，离线软件包本质上就是在同样操作系统上构建好的本地软件源。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 在此 Infra 节点上创建本地软件仓库？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/www                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 软件仓库主目录，默认为 /www</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 软件仓库名称，默认为 pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>http://${admin_ip}:80</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 仓库访问端点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_remove</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 移除现有上游仓库定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra,node,pgsql   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 启用的上游仓库模块</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_upstream: []                # 上游仓库定义（从操作系统变量继承）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_packages: []                # 要下载的软件包（从操作系统变量继承）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#repo_extra_packages: []          # 额外要下载的软件包</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo_url_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[]</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 通过 URL 下载的额外软件包</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=repo_enabled><code>repo_enabled</code></h3><p>参数名称： <code>repo_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前的基础设施节点上启用本地软件源？默认为： <code>true</code>，即所有 Infra 节点都会设置一个本地软件仓库。</p><p>如果您有多个基础设施节点，可以只保留 1～2 个节点作为软件仓库，其他节点可以通过设置此参数为 <code>false</code> 来避免重复软件下载构建。</p><h3 id=repo_home><code>repo_home</code></h3><p>参数名称： <code>repo_home</code>， 类型： <code>path</code>， 层次：<code>G</code></p><p>本地软件仓库的家目录，默认为 Nginx 的根目录，也就是： <code>/www</code>。</p><p>这个目录实际上是指向 <a href=#nginx_data><code>nginx_data</code></a> 的软链接，不建议修改此目录。如果修改，需要和 <a href=#nginx_home><code>nginx_home</code></a> 保持一致。</p><h3 id=repo_name><code>repo_name</code></h3><p>参数名称： <code>repo_name</code>， 类型： <code>string</code>， 层次：<code>G</code></p><p>本地仓库名称，默认为 <code>pigsty</code>，更改此仓库的名称是不明智的行为。</p><p>最终的仓库路径为 <code>{{ repo_home }}/{{ repo_name }}</code>，默认为 <code>/www/pigsty</code>。</p><h3 id=repo_endpoint><code>repo_endpoint</code></h3><p>参数名称： <code>repo_endpoint</code>， 类型： <code>url</code>， 层次：<code>G</code></p><p>其他节点访问此仓库时使用的端点，默认值为：<code>http://${admin_ip}:80</code>。</p><p>Pigsty 默认会在基础设施节点 80/443 端口启动 Nginx，对外提供本地软件源（静态文件）服务。</p><p>如果您修改了 <a href=#nginx_port><code>nginx_port</code></a> 与 <a href=#nginx_ssl_port><code>nginx_ssl_port</code></a>，或者使用了不同于中控节点的基础设施节点，请相应调整此参数。</p><p>如果您使用了域名，可以在 <a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a>、<a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a>、或者 <a href=#dns_records><code>dns_records</code></a> 中添加解析。</p><h3 id=repo_remove><code>repo_remove</code></h3><p>参数名称： <code>repo_remove</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>在构建本地软件源时，是否移除现有的上游仓库定义？默认值： <code>true</code>。</p><p>当启用此参数时，<code>/etc/yum.repos.d</code> 中所有已有仓库文件会被移动备份至 <code>/etc/yum.repos.d/backup</code>，在 Debian 系上是移除 <code>/etc/apt/sources.list</code> 和 <code>/etc/apt/sources.list.d</code>，将文件备份至 <code>/etc/apt/backup</code> 中。</p><p>因为操作系统已有的源内容不可控，使用 Pigsty 验证过的上游软件源可以提高从互联网下载软件包的成功率与速度。</p><p>但在一些特定情况下（例如您的操作系统是某种 EL/Deb 兼容版，许多软件包使用了自己的私有源），您可能需要保留现有的上游仓库定义，此时可以将此参数设置为 <code>false</code>。</p><h3 id=repo_modules><code>repo_modules</code></h3><p>参数名称： <code>repo_modules</code>， 类型： <code>string</code>， 层次：<code>G/A</code></p><p>哪些上游仓库模块会被添加到本地软件源中，默认值： <code>infra,node,pgsql</code></p><p>当 Pigsty 尝试添加上游仓库时，会根据此参数的值来过滤 <a href=#repo_upstream><code>repo_upstream</code></a> 中的条目，只有 <code>module</code> 字段与此参数值匹配的条目才会被添加到本地软件源中。</p><p>模块以逗号分隔，可用的模块列表请参考 <code>repo_upstream</code> 中的定义，常见模块包括：</p><ul><li><code>local</code>: 本地 Pigsty 仓库</li><li><code>infra</code>: 基础设施软件包（Nginx、Docker 等）</li><li><code>node</code>: 操作系统基础软件包</li><li><code>pgsql</code>: PostgreSQL 相关软件包</li><li><code>extra</code>: 额外的 PostgreSQL 扩展</li><li><code>docker</code>: Docker 相关</li><li><code>redis</code>: Redis 相关</li><li><code>mongo</code>: MongoDB 相关</li><li><code>mysql</code>: MySQL 相关</li><li>等等&mldr;</li></ul><h3 id=repo_upstream><code>repo_upstream</code></h3><p>参数名称： <code>repo_upstream</code>， 类型： <code>upstream[]</code>， 层次：<code>G</code></p><p>构建本地软件源时，从哪里下载上游软件包？本参数没有默认值，如果用户不在配置文件中显式指定，则会从根据当前节点的操作系统族，从定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> 中的 <code>repo_upstream_default</code> 变量中加载获取。</p><p>Pigsty 为不同的操作系统版本（EL8/9/10, Debian 11/12/13, Ubuntu 22/24）预置了完整的上游仓库定义，包括：</p><ul><li>操作系统基础仓库（BaseOS、AppStream、EPEL 等）</li><li>PostgreSQL 官方 PGDG 仓库</li><li>Pigsty 扩展仓库</li><li>各种第三方软件仓库（Docker、Nginx、Grafana 等）</li></ul><p>每个上游仓库定义包含以下字段：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 仓库名称</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;Pigsty PGSQL&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># 仓库描述</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>module</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 所属模块</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>releases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 支持的操作系统版本</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>arch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>x86_64, aarch64]        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 支持的 CPU 架构</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>baseurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># 仓库 URL，按区域配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://repo.pigsty.io/yum/pgsql/el$releasever.$basearch&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>china</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://repo.pigsty.cc/yum/pgsql/el$releasever.$basearch&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>用户通常不需要修改此参数，除非有特殊的仓库需求。详细的仓库定义请参考 <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars/</code></a> 目录下对应操作系统的配置文件。</p><h3 id=repo_packages><code>repo_packages</code></h3><p>参数名称： <code>repo_packages</code>， 类型： <code>string[]</code>， 层次：<code>G</code></p><p>字符串数组类型，每一行都是 <strong>由空格分隔</strong> 的软件包列表字符串，指定将要使用 <code>repotrack</code> 或 <code>apt download</code> 下载到本地的软件包（及其依赖）。</p><p>本参数没有默认值，即默认值为未定义状态。如果该参数没有被显式定义，那么 Pigsty 会从 <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> 中定义的 <code>repo_packages_default</code> 变量中加载获取默认值，默认值为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, extra-modules ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>该参数中的每个元素，都会在上述文件中定义的 <code>package_map</code> 中，根据特定的操作系统发行版大版本进行翻译。例如在 EL 系统上会翻译为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node-bootstrap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>          </span><span style=color:#4e9a06>&#34;ansible python3 python3-pip python3-virtualenv python3-requests python3-jmespath python3-cryptography dnf-utils modulemd-tools createrepo_c sshpass&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra-package</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#4e9a06>&#34;nginx dnsmasq etcd haproxy vip-manager node_exporter keepalived_exporter pg_exporter pgbackrest_exporter redis_exporter redis minio mcli pig&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra-addons</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>            </span><span style=color:#4e9a06>&#34;grafana grafana-plugins grafana-victoriametrics-ds grafana-victorialogs-ds victoria-metrics victoria-logs victoria-traces vlogscli vmutils vector alertmanager&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>作为一个使用约定，<code>repo_packages</code> 中通常包括了那些与 PostgreSQL 大版本号无关的软件包（例如 Infra，Node 和 PGDG Common 等部分），而 PostgreSQL 大版本相关的软件包（内核，扩展），通常在 <code>repo_extra_packages</code> 中指定，方便用户切换 PG 大版本。</p><h3 id=repo_extra_packages><code>repo_extra_packages</code></h3><p>参数名称： <code>repo_extra_packages</code>， 类型： <code>string[]</code>， 层次：<code>G/C/I</code></p><p>用于在不修改 <a href=#repo_packages><code>repo_packages</code></a> 的基础上，指定额外需要下载的软件包（通常是 PG 大版本相关的软件包），默认值为空列表。</p><p>如果该参数没有被显式定义，那么 Pigsty 会从 <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> 中定义的 <code>repo_extra_packages_default</code> 变量中加载获取默认值，默认值为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql-main ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>该参数中的元素会进行包名翻译，其中 <code>$v</code> 会被替换为 <a href=/docs/pgsql/param#pg_version><code>pg_version</code></a>，即当前 PG 大版本号（默认为 <code>18</code>）。</p><p>这里的 <code>pgsql-main</code> 在 EL 系统上会翻译为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>postgresql$v postgresql$v-server postgresql$v-libs postgresql$v-contrib postgresql$v-plperl postgresql$v-plpython3 postgresql$v-pltcl postgresql$v-llvmjit pg_repack_$v* wal2json_$v* pgvector_$v*</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>通常用户可以在这里指定 PostgreSQL 大版本相关的软件包，而不影响 <code>repo_packages</code> 中定义的其他 PG 大版本无关的软件包。</p><h3 id=repo_url_packages><code>repo_url_packages</code></h3><p>参数名称： <code>repo_url_packages</code>， 类型： <code>object[] | string[]</code>， 层次：<code>G</code></p><p>直接使用 URL 从互联网上下载的软件包，默认为空数组： <code>[]</code></p><p>您可以直接在本参数中使用 URL 字符串作为数组元素，也可以使用对象结构，显式指定 URL 与文件名称。</p><p>请注意，本参数会受到 <a href=#region><code>region</code></a> 变量的影响，如果您在中国大陆地区，Pigsty 会自动将 URL 替换为国内镜像站点，即将 URL 里的 <code>repo.pigsty.io</code> 替换为 <code>repo.pigsty.cc</code>。</p><hr><h2 id=infra_package><code>INFRA_PACKAGE</code></h2><p>这些软件包只会在 INFRA 节点上安装。</p><h3 id=infra_packages><code>infra_packages</code></h3><p>参数名称： <code>infra_packages</code>， 类型： <code>string[]</code>， 层次：<code>G</code></p><p>字符串数组类型，每一行都是 <strong>由空格分隔</strong> 的软件包列表字符串，指定将要在 Infra 节点上安装的软件包列表。</p><p>本参数没有默认值，即默认值为未定义状态。如果用户不在配置文件中显式指定本参数，则 Pigsty 会从根据当前节点的操作系统族，从定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/node_id/vars/><code>roles/node_id/vars</code></a> 中的 <code>infra_packages_default</code> 变量中加载获取默认值。</p><p>v4.x 默认值（EL系操作系统）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_packages_default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>grafana,grafana-plugins,grafana-victorialogs-ds,grafana-victoriametrics-ds,victoria-metrics,victoria-logs,victoria-traces,vmutils,vlogscli,alertmanager</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node_exporter,blackbox_exporter,nginx_exporter,pg_exporter,pev2,nginx,dnsmasq,ansible,etcd,python3-requests,redis,mcli,restic,certbot,python3-certbot-nginx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认值（Debian/Ubuntu）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_packages_default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>grafana,grafana-plugins,grafana-victorialogs-ds,grafana-victoriametrics-ds,victoria-metrics,victoria-logs,victoria-traces,vmutils,vlogscli,alertmanager</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>node-exporter,blackbox-exporter,nginx-exporter,pg-exporter,pev2,nginx,dnsmasq,ansible,etcd,python3-requests,redis,mcli,restic,certbot,python3-certbot-nginx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>注意：v4.x 使用 VictoriaMetrics 套件替代了 Prometheus 和 Loki，因此软件包列表与 v3.x 有显著差异。</p></blockquote><hr><h2 id=nginx><code>NGINX</code></h2><p>Pigsty 会通过 Nginx 代理所有的 Web 服务访问：Home Page、Grafana、VictoriaMetrics 等等。
以及其他可选的工具，如 PGWeb、Jupyter Lab、Pgadmin、Bytebase 等等，还有一些静态资源和报告，如 <code>pev</code>、<code>schemaspy</code> 和 <code>pgbadger</code>。</p><p>最重要的是，Nginx 还作为本地软件仓库（Yum/Apt）的 Web 服务器，用于存储和分发 Pigsty 的软件包。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 在此 Infra 节点上启用 Nginx？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 初始化时清理现有 Nginx 配置？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_exporter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 启用 nginx_exporter？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_exporter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9113</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># nginx_exporter 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_sslmode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>enable            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># SSL 模式：disable,enable,enforce</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_cert_validity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>397d        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 自签名证书有效期</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/www                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Nginx 内容目录（软链接）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/nginx          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Nginx 实际数据目录</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># 基础认证用户字典</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># HTTP 端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_ssl_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>443</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># HTTPS 端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 使用 certbot 签署证书？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># certbot 邮箱</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># certbot 额外选项</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=nginx_enabled><code>nginx_enabled</code></h3><p>参数名称： <code>nginx_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前的 Infra 节点上启用 Nginx？默认值为： <code>true</code>。</p><p>Nginx 是 Pigsty 基础设施的核心组件，负责：</p><ul><li>提供本地软件仓库服务</li><li>反向代理 Grafana、VictoriaMetrics 等 Web 服务</li><li>托管静态文件和报告</li></ul><h3 id=nginx_clean><code>nginx_clean</code></h3><p>参数名称： <code>nginx_clean</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>初始化时是否清理现有的 Nginx 配置？默认值为： <code>false</code>。</p><p>当设置为 <code>true</code> 时，在 Nginx 初始化过程中会删除 <code>/etc/nginx/conf.d/</code> 下的所有现有配置文件，确保一个干净的起点。</p><p>如果您是首次部署或希望完全重建 Nginx 配置，可以将此参数设置为 <code>true</code>。</p><h3 id=nginx_exporter_enabled><code>nginx_exporter_enabled</code></h3><p>参数名称： <code>nginx_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>在此基础设施节点上启用 nginx_exporter ？默认值为： <code>true</code>。</p><p>如果禁用此选项，还会一并禁用 <code>/nginx</code> 健康检查 stub，当您安装使用的 Nginx 版本不支持此功能时可以考虑关闭此开关。</p><h3 id=nginx_exporter_port><code>nginx_exporter_port</code></h3><p>参数名称： <code>nginx_exporter_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>nginx_exporter 监听端口，默认值为 <code>9113</code>。</p><p>nginx_exporter 用于收集 Nginx 的运行指标，供 VictoriaMetrics 抓取监控。</p><h3 id=nginx_sslmode><code>nginx_sslmode</code></h3><p>参数名称： <code>nginx_sslmode</code>， 类型： <code>enum</code>， 层次：<code>G</code></p><p>Nginx 的 SSL 工作模式？有三种选择：<code>disable</code> , <code>enable</code> , <code>enforce</code>， 默认值为 <code>enable</code>，即启用 SSL，但不强制使用。</p><ul><li><code>disable</code>：只监听 <a href=#nginx_port><code>nginx_port</code></a> 指定的端口服务 HTTP 请求。</li><li><code>enable</code>：同时会监听 <a href=#nginx_ssl_port><code>nginx_ssl_port</code></a> 指定的端口服务 HTTPS 请求。</li><li><code>enforce</code>：所有链接都会被渲染为默认使用 <code>https://</code><ul><li>同时会将 <a href=#infra_portal><code>infra_portal</code></a> 中非默认服务器的 80 端口重定向到 443 端口</li></ul></li></ul><h3 id=nginx_cert_validity><code>nginx_cert_validity</code></h3><p>参数名称： <code>nginx_cert_validity</code>， 类型： <code>duration</code>， 层次：<code>G</code></p><p>Nginx 自签名证书的有效期，默认值为 <code>397d</code>（约13个月）。</p><p>现代浏览器要求网站证书的有效期最多为 397 天，因此这是默认值。不建议设置更长的有效期，否则浏览器可能会拒绝信任该证书。</p><h3 id=nginx_home><code>nginx_home</code></h3><p>参数名称： <code>nginx_home</code>， 类型： <code>path</code>， 层次：<code>G</code></p><p>Nginx 服务器静态文件目录，默认为： <code>/www</code></p><p>这是一个软链接，实际指向 <a href=#nginx_data><code>nginx_data</code></a> 目录。此目录包含静态资源和软件仓库文件。</p><p>最好不要随意修改此参数，修改时需要与 <a href=#repo_home><code>repo_home</code></a> 参数保持一致。</p><h3 id=nginx_data><code>nginx_data</code></h3><p>参数名称： <code>nginx_data</code>， 类型： <code>path</code>， 层次：<code>G</code></p><p>Nginx 实际数据目录，默认为 <code>/data/nginx</code>。</p><p>这是 Nginx 静态文件的实际存储位置，<a href=#nginx_home><code>nginx_home</code></a> 是指向此目录的软链接。</p><p>建议将此目录放置在数据盘上，以便于管理大量的软件包文件。</p><h3 id=nginx_users><code>nginx_users</code></h3><p>参数名称： <code>nginx_users</code>， 类型： <code>dict</code>， 层次：<code>G</code></p><p>Nginx 基础认证（Basic Auth）用户字典，默认为空字典 <code>{}</code>。</p><p>格式为 <code>{ username: password }</code> 的键值对，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nginx_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>admin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>viewer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readonly</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>这些用户可用于保护某些需要认证的 Nginx 端点。</p><h3 id=nginx_port><code>nginx_port</code></h3><p>参数名称： <code>nginx_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>Nginx 默认监听的端口（提供 HTTP 服务），默认为 <code>80</code> 端口，最好不要修改这个参数。</p><p>当您的服务器 80 端口被占用时，可以考虑修改此参数，但需要同时修改 <a href=#repo_endpoint><code>repo_endpoint</code></a> 并确保相关节点能够通过新的端口访问本地软件仓库。</p><h3 id=nginx_ssl_port><code>nginx_ssl_port</code></h3><p>参数名称： <code>nginx_ssl_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>Nginx SSL 默认监听的端口，默认为 <code>443</code>，最好不要修改这个参数。</p><h3 id=certbot_sign><code>certbot_sign</code></h3><p>参数名称： <code>certbot_sign</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>是否在安装过程中使用 certbot 签署 Nginx 证书？默认值为 <code>false</code>。</p><p>当设置为 <code>true</code> 时，Pigsty 会在执行 <code>infra.yml</code> 和 <code>deploy.yml</code> 剧本（<code>nginx</code> 角色）期间使用 certbot 自动从 Let&rsquo;s Encrypt 申请免费 SSL 证书。</p><p>在 <a href=#infra_portal><code>infra_portal</code></a> 定义的域名中，如果定义了 <code>certbot</code> 参数，Pigsty 将使用 certbot 为 <code>domain</code> 域名申请证书，证书名称将是 <code>certbot</code> 参数的值。如果多个服务器/域名指定了相同的 <code>certbot</code> 参数，Pigsty 会合并并为这些域名申请一个证书，使用 <code>certbot</code> 参数的值作为证书名称。</p><p>启用此选项需要：</p><ul><li>当前节点可以通过公共域名访问，并且 DNS 解析已正确指向当前节点的公网 IP</li><li>当前节点可以访问 Let&rsquo;s Encrypt API 接口</li></ul><p>此选项默认禁用，您可以在安装后手动执行 <code>make cert</code> 命令来手动执行，它实际上调用渲染好的 <code>/etc/nginx/sign-cert</code> 脚本，使用 certbot 更新或申请证书。</p><h3 id=certbot_email><code>certbot_email</code></h3><p>参数名称： <code>certbot_email</code>， 类型： <code>string</code>， 层次：<code>G/A</code></p><p>用于接收证书过期提醒邮件的电子邮件地址，默认值为 <code>your@email.com</code>。</p><p>当 <code>certbot_sign</code> 设置为 <code>true</code> 时，建议提供此参数。Let&rsquo;s Encrypt 会在证书即将过期时向此邮箱发送提醒邮件。</p><h3 id=certbot_options><code>certbot_options</code></h3><p>参数名称： <code>certbot_options</code>， 类型： <code>string</code>， 层次：<code>G/A</code></p><p>传递给 certbot 的额外配置参数，默认值为空字符串。</p><p>您可以通过此参数向 certbot 传递额外的命令行选项，例如 <code>--dry-run</code>，则 certbot 不会实际申请证书，而是进行预览和测试。</p><hr><h2 id=dns><code>DNS</code></h2><p>Pigsty 默认会在 Infra 节点上启用 DNSMASQ 服务，用于解析一些辅助域名，例如 <code>i.pigsty</code>、<code>m.pigsty</code>、<code>supa.pigsty</code>、<code>api.pigsty</code> 等。</p><p>解析记录会记录在 Infra 节点的 <code>/etc/hosts.d/default</code> 文件中。 要使用这个 DNS 服务器，您必须将 <code>nameserver &lt;ip></code> 添加到 <code>/etc/resolv.conf</code> 中，<a href=/docs/node/param#node_dns_servers><code>node_dns_servers</code></a> 参数可以解决这个问题。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 在此 Infra 节点上设置 dnsmasq？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>53</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># DNS 服务器监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 动态 DNS 记录</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=dns_enabled><code>dns_enabled</code></h3><p>参数名称： <code>dns_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在这个 Infra 节点上启用 DNSMASQ 服务？默认值为： <code>true</code>。</p><p>如果你不想使用默认的 DNS 服务器（比如你已经有了外部的 DNS 服务器，或者您的供应商不允许您使用 DNS 服务器）可以将此值设置为 <code>false</code> 来禁用它。
并使用 <a href=/docs/node/param#node_default_etc_hosts><code>node_default_etc_hosts</code></a> 和 <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a> 静态解析记录代替。</p><h3 id=dns_port><code>dns_port</code></h3><p>参数名称： <code>dns_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>DNSMASQ 的默认监听端口，默认是 <code>53</code>，不建议修改 DNS 服务默认端口。</p><h3 id=dns_records><code>dns_records</code></h3><p>参数名称： <code>dns_records</code>， 类型： <code>string[]</code>， 层次：<code>G</code></p><p>由 dnsmasq 负责解析的动态 DNS 记录，一般用于将一些辅助域名解析到管理节点。这些记录会被写入到基础设施节点的 <code>/etc/hosts.d/default</code> 文件中。</p><p>v4.x 默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>这里使用 <code>${admin_ip}</code> 占位符，在部署时会被替换为实际的 <a href=#admin_ip><code>admin_ip</code></a> 值。</p><p>常见的域名用途：</p><ul><li><code>i.pigsty</code>：Pigsty 首页</li><li><code>m.pigsty</code>：常用于 MinIO 控制台（可选）</li><li><code>p.pigsty</code>：常用于 VictoriaMetrics Web UI（当在 <code>infra_portal</code> 中显式配置时）</li><li><code>api.pigsty</code>：API 服务</li><li><code>adm.pigsty</code>：管理服务</li><li>其他根据实际部署需求自定义</li></ul><hr><h2 id=victoria><code>VICTORIA</code></h2><p>Pigsty v4.x 使用 VictoriaMetrics 套件替代 Prometheus 和 Loki，提供更优秀的可观测性解决方案：</p><ul><li><strong>VictoriaMetrics</strong>：替代 Prometheus，作为时序数据库存储监控指标</li><li><strong>VictoriaLogs</strong>：替代 Loki，作为日志聚合存储</li><li><strong>VictoriaTraces</strong>：分布式追踪存储</li><li><strong>VMAlert</strong>：替代 Prometheus Alerting，进行告警规则评估</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 启用 VictoriaMetrics？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 初始化时清理数据？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8428</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_scrape_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>10s    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 全局抓取间隔</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_scrape_timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>8s      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 全局抓取超时</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -promscrape.fileSDCheckInterval=5s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 启用 VictoriaLogs？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 初始化时清理数据？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9428</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -insert.maxLineSizeBytes=1MB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -search.maxQueryDuration=120s</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 启用 VictoriaTraces？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 初始化时清理数据？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10428</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 启用 VMAlert？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8880</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmalert_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 额外命令行参数</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=vmetrics_enabled><code>vmetrics_enabled</code></h3><p>参数名称： <code>vmetrics_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 VictoriaMetrics？默认值为 <code>true</code>。</p><p>VictoriaMetrics 是 Pigsty v4.x 的核心监控组件，替代 Prometheus 作为时序数据库，负责：</p><ul><li>从各个 Exporter 抓取监控指标</li><li>存储时序数据</li><li>提供 PromQL 兼容的查询接口</li><li>支持 Grafana 数据源</li></ul><h3 id=vmetrics_clean><code>vmetrics_clean</code></h3><p>参数名称： <code>vmetrics_clean</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>初始化 VictoriaMetrics 时是否清理现有数据？默认值为 <code>false</code>。</p><p>当设置为 <code>true</code> 时，在初始化过程中会删除已有的时序数据。谨慎使用此选项，除非您确定要重建监控数据。</p><h3 id=vmetrics_port><code>vmetrics_port</code></h3><p>参数名称： <code>vmetrics_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>VictoriaMetrics 监听端口，默认值为 <code>8428</code>。</p><p>此端口用于：</p><ul><li>HTTP API 访问</li><li>Web UI 访问</li><li>Prometheus 兼容的远程写入/读取</li><li>Grafana 数据源连接</li></ul><h3 id=vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></h3><p>参数名称： <code>vmetrics_scrape_interval</code>， 类型： <code>interval</code>， 层次：<code>G</code></p><p>VictoriaMetrics 全局指标抓取周期，默认值为 <code>10s</code>。</p><p>在生产环境，10秒 - 30秒是一个较为合适的抓取周期。如果您需要更精细的监控数据粒度，可以调整此参数，但会增加存储和 CPU 开销。</p><h3 id=vmetrics_scrape_timeout><code>vmetrics_scrape_timeout</code></h3><p>参数名称： <code>vmetrics_scrape_timeout</code>， 类型： <code>interval</code>， 层次：<code>G</code></p><p>VictoriaMetrics 全局抓取超时，默认为 <code>8s</code>。</p><p>设置抓取超时可以有效避免监控系统查询导致的雪崩，设置原则是本参数必须小于并接近 <a href=#vmetrics_scrape_interval><code>vmetrics_scrape_interval</code></a>，确保每次抓取时长不超过抓取周期。</p><h3 id=vmetrics_options><code>vmetrics_options</code></h3><p>参数名称： <code>vmetrics_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>VictoriaMetrics 的额外命令行参数，默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vmetrics_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -promscrape.fileSDCheckInterval=5s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>常用参数说明：</p><ul><li><code>-retentionPeriod=15d</code>：数据保留期限，默认 15 天</li><li><code>-promscrape.fileSDCheckInterval=5s</code>：文件服务发现刷新间隔</li></ul><p>您可以根据需要添加其他 VictoriaMetrics 支持的参数。</p><h3 id=vlogs_enabled><code>vlogs_enabled</code></h3><p>参数名称： <code>vlogs_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 VictoriaLogs？默认值为 <code>true</code>。</p><p>VictoriaLogs 替代 Loki 作为日志聚合存储，负责：</p><ul><li>接收来自 Vector 的日志数据</li><li>存储和索引日志</li><li>提供日志查询接口</li><li>支持 Grafana VictoriaLogs 数据源</li></ul><h3 id=vlogs_clean><code>vlogs_clean</code></h3><p>参数名称： <code>vlogs_clean</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>初始化 VictoriaLogs 时是否清理现有数据？默认值为 <code>false</code>。</p><h3 id=vlogs_port><code>vlogs_port</code></h3><p>参数名称： <code>vlogs_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>VictoriaLogs 监听端口，默认值为 <code>9428</code>。</p><h3 id=vlogs_options><code>vlogs_options</code></h3><p>参数名称： <code>vlogs_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>VictoriaLogs 的额外命令行参数，默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vlogs_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -insert.maxLineSizeBytes=1MB
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -search.maxQueryDuration=120s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>常用参数说明：</p><ul><li><code>-retentionPeriod=15d</code>：日志保留期限，默认 15 天</li><li><code>-retention.maxDiskSpaceUsageBytes=50GiB</code>：最大磁盘使用量</li><li><code>-insert.maxLineSizeBytes=1MB</code>：单行日志最大大小</li><li><code>-search.maxQueryDuration=120s</code>：查询最大执行时间</li></ul><h3 id=vtraces_enabled><code>vtraces_enabled</code></h3><p>参数名称： <code>vtraces_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 VictoriaTraces？默认值为 <code>true</code>。</p><p>VictoriaTraces 用于分布式追踪数据的存储和查询，支持 Jaeger、Zipkin 等追踪协议。</p><h3 id=vtraces_clean><code>vtraces_clean</code></h3><p>参数名称： <code>vtraces_clean</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>初始化 VictoriaTraces 时是否清理现有数据？默认值为 <code>false</code>。</p><h3 id=vtraces_port><code>vtraces_port</code></h3><p>参数名称： <code>vtraces_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>VictoriaTraces 监听端口，默认值为 <code>10428</code>。</p><h3 id=vtraces_options><code>vtraces_options</code></h3><p>参数名称： <code>vtraces_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>VictoriaTraces 的额外命令行参数，默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vtraces_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>&gt;-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retentionPeriod=15d
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  -retention.maxDiskSpaceUsageBytes=50GiB</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=vmalert_enabled><code>vmalert_enabled</code></h3><p>参数名称： <code>vmalert_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 VMAlert？默认值为 <code>true</code>。</p><p>VMAlert 负责告警规则评估，替代 Prometheus Alerting 功能，与 Alertmanager 配合使用。</p><h3 id=vmalert_port><code>vmalert_port</code></h3><p>参数名称： <code>vmalert_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>VMAlert 监听端口，默认值为 <code>8880</code>。</p><h3 id=vmalert_options><code>vmalert_options</code></h3><p>参数名称： <code>vmalert_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>VMAlert 的额外命令行参数，默认值为空字符串。</p><hr><h2 id=prometheus><code>PROMETHEUS</code></h2><p>此部分现在主要包含 Blackbox Exporter 和 Alertmanager 的配置。</p><blockquote><p>注意：Pigsty v4.x 使用 VictoriaMetrics 替代 Prometheus，原有的 <code>prometheus_*</code> 和 <code>pushgateway_*</code> 参数已移至 <a href=#victoria><code>VICTORIA</code></a> 部分。</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 启用 blackbox_exporter？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9115</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># blackbox_exporter 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>blackbox_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 额外命令行参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 启用 alertmanager？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9059</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># alertmanager 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>alertmanager_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># 额外命令行参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>exporter_metrics_path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/metrics  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># exporter 指标路径</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=blackbox_enabled><code>blackbox_enabled</code></h3><p>参数名称： <code>blackbox_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 BlackboxExporter？默认值为 <code>true</code>。</p><p>BlackboxExporter 会向节点 IP 地址、VIP 地址、PostgreSQL VIP 地址发送 ICMP 报文测试网络连通性，还可以进行 HTTP、TCP、DNS 等探测。</p><h3 id=blackbox_port><code>blackbox_port</code></h3><p>参数名称： <code>blackbox_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>Blackbox Exporter 监听端口，默认值为 <code>9115</code>。</p><h3 id=blackbox_options><code>blackbox_options</code></h3><p>参数名称： <code>blackbox_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>BlackboxExporter 的额外命令行参数，默认值：空字符串。</p><h3 id=alertmanager_enabled><code>alertmanager_enabled</code></h3><p>参数名称： <code>alertmanager_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在当前 Infra 节点上启用 AlertManager？默认值为 <code>true</code>。</p><p>AlertManager 负责接收来自 VMAlert 的告警通知，并进行告警分组、抑制、静默、路由等处理。</p><h3 id=alertmanager_port><code>alertmanager_port</code></h3><p>参数名称： <code>alertmanager_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>AlertManager 监听端口，默认值为 <code>9059</code>。</p><p>如果您修改了此端口，请确保相应更新 <a href=#infra_portal><code>infra_portal</code></a> 中 alertmanager 条目的 <code>endpoint</code> 配置（如果有定义的话）。</p><h3 id=alertmanager_options><code>alertmanager_options</code></h3><p>参数名称： <code>alertmanager_options</code>， 类型： <code>arg</code>， 层次：<code>G</code></p><p>AlertManager 的额外命令行参数，默认值：空字符串。</p><h3 id=exporter_metrics_path><code>exporter_metrics_path</code></h3><p>参数名称： <code>exporter_metrics_path</code>， 类型： <code>path</code>， 层次：<code>G</code></p><p>监控 exporter 暴露指标的 HTTP 端点路径，默认为： <code>/metrics</code>，不建议修改此参数。</p><p>此参数定义了所有 Exporter 暴露监控指标的标准路径。</p><hr><h2 id=grafana><code>GRAFANA</code></h2><p>Pigsty 使用 Grafana 作为监控系统前端。它也可以作为数据分析与可视化平台，或者用于低代码数据应用开发，制作数据应用原型等目的。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 启用 Grafana？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3000</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Grafana 监听端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_clean</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 初始化时清理数据？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_admin_username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 管理员用户名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 管理员密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_auth_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 启用身份代理？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 外部 PostgreSQL URL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_view_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Viewer </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># PG 数据源密码</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=grafana_enabled><code>grafana_enabled</code></h3><p>参数名称： <code>grafana_enabled</code>， 类型： <code>bool</code>， 层次：<code>G/I</code></p><p>是否在 Infra 节点上启用 Grafana？默认值为： <code>true</code>，即所有基础设施节点默认都会安装启用 Grafana。</p><h3 id=grafana_port><code>grafana_port</code></h3><p>参数名称： <code>grafana_port</code>， 类型： <code>port</code>， 层次：<code>G</code></p><p>Grafana 监听端口，默认值为 <code>3000</code>。</p><p>如果您需要直接访问 Grafana（不通过 Nginx 反向代理），可以使用此端口。</p><h3 id=grafana_clean><code>grafana_clean</code></h3><p>参数名称： <code>grafana_clean</code>， 类型： <code>bool</code>， 层次：<code>G/A</code></p><p>是否在初始化 Grafana 时一并清理其数据文件？默认为：<code>false</code>。</p><p>如果设置为 <code>true</code>，初始化 Grafana 时会移除 <code>/var/lib/grafana/grafana.db</code>，确保 Grafana 是一个全新安装。</p><p>如果您希望保留现有的 Grafana 配置（如仪表盘、用户、数据源等），请将此参数保留为 <code>false</code>。</p><h3 id=grafana_admin_username><code>grafana_admin_username</code></h3><p>参数名称： <code>grafana_admin_username</code>， 类型： <code>username</code>， 层次：<code>G</code></p><p>Grafana 管理员用户名，默认为 <code>admin</code>。</p><h3 id=grafana_admin_password><code>grafana_admin_password</code></h3><p>参数名称： <code>grafana_admin_password</code>， 类型： <code>password</code>， 层次：<code>G</code></p><p>Grafana 管理员密码，默认为 <code>pigsty</code>。</p><blockquote><p><strong>重要提示：请务必在生产部署中修改此密码参数！</strong></p></blockquote><h3 id=grafana_auth_proxy><code>grafana_auth_proxy</code></h3><p>参数名称： <code>grafana_auth_proxy</code>， 类型： <code>bool</code>， 层次：<code>G</code></p><p>是否启用 Grafana 身份代理？默认为 <code>false</code>。</p><p>当启用时，Grafana 会信任反向代理（Nginx）传递的用户身份信息，实现单点登录（SSO）功能。</p><p>这通常用于与外部身份认证系统集成的场景。</p><h3 id=grafana_pgurl><code>grafana_pgurl</code></h3><p>参数名称： <code>grafana_pgurl</code>， 类型： <code>url</code>， 层次：<code>G</code></p><p>外部 PostgreSQL 数据库 URL，用于 Grafana 持久化存储。默认为空字符串。</p><p>如果指定，Grafana 将使用此 PostgreSQL 数据库替代默认的 SQLite 数据库存储其配置数据。</p><p>格式示例：<code>postgres://grafana:password@pg-meta:5432/grafana?sslmode=disable</code></p><p>这对于需要 Grafana 高可用部署或数据持久化的场景非常有用。</p><h3 id=grafana_view_password><code>grafana_view_password</code></h3><p>参数名称： <code>grafana_view_password</code>， 类型： <code>password</code>， 层次：<code>G</code></p><p>Grafana 元数据库 PG 数据源使用的只读用户密码，默认为 <code>DBUser.Viewer</code>。</p><p>此密码用于 Grafana 连接 PostgreSQL CMDB 数据源，以只读方式查询元数据。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-83a306c7aef5ddfdbad1dd3d6363e905>3 - 预置剧本</h1><div class=lead>如何使用预置的 ansible 剧本来管理 INFRA 集群，常用管理命令速查。</div><p>Pigsty 提供了三个与 INFRA 模块相关的剧本：</p><ul><li><a href=#deployyml><code>deploy.yml</code></a>：在所有节点上一次性完整部署所有组件</li><li><a href=#infrayml><code>infra.yml</code></a>：在 infra 节点上初始化 pigsty 基础设施</li><li><a href=#infra-rmyml><code>infra-rm.yml</code></a>：从 infra 节点移除基础设施组件</li></ul><hr><h2 id=deployyml><code>deploy.yml</code></h2><p>在所有节点上一次性完整部署所有组件，解决 INFRA/NODE 循环依赖问题。</p><p>该剧本会交叉执行 <code>infra.yml</code> 与 <code>node.yml</code> 的子任务，按以下顺序完成所有组件的部署：</p><ol><li><strong>id</strong>：生成节点与 PostgreSQL 身份标识</li><li><strong>ca</strong>：在本地创建自签名 CA 证书</li><li><strong>repo</strong>：在 infra 节点上创建本地软件仓库</li><li><strong>node-init</strong>：初始化节点、HAProxy 与 Docker</li><li><strong>infra</strong>：初始化 Nginx、DNS、VictoriaMetrics、Grafana 等</li><li><strong>node-monitor</strong>：初始化 node-exporter、vector</li><li><strong>etcd</strong>：初始化 etcd（PostgreSQL 高可用必需）</li><li><strong>minio</strong>：初始化 MinIO（可选）</li><li><strong>pgsql</strong>：初始化 PostgreSQL 集群</li><li><strong>pgsql-monitor</strong>：初始化 PostgreSQL 监控</li></ol><p>该剧本等效于依次执行以下四个剧本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -l infra    <span style=color:#8f5902;font-style:italic># 在 infra 分组上部署基础设施</span>
</span></span><span style=display:flex><span>./node.yml              <span style=color:#8f5902;font-style:italic># 在所有节点上初始化节点</span>
</span></span><span style=display:flex><span>./etcd.yml              <span style=color:#8f5902;font-style:italic># 初始化 etcd 集群</span>
</span></span><span style=display:flex><span>./pgsql.yml             <span style=color:#8f5902;font-style:italic># 初始化 PostgreSQL 集群</span>
</span></span></code></pre></div><hr><h2 id=infrayml><code>infra.yml</code></h2><p>在配置文件的 <code>infra</code> 分组所定义的 Infra节点 上初始化基础设施模块。</p><p>执行该剧本将完成以下任务：</p><ul><li>配置 Infra节点 的目录与环境变量</li><li>下载并创建本地软件仓库，加速后续安装</li><li>将当前 Infra节点 作为普通节点纳入 Pigsty 管理</li><li>部署基础设施组件（VictoriaMetrics/Logs/Traces、VMAlert、Grafana、Alertmanager、Blackbox Exporter 等）</li></ul><p><strong>剧本注意事项</strong>：</p><ul><li>本剧本为幂等剧本，重复执行默认不会清理历史数据与 Grafana 数据</li><li>如需保留历史监控数据，请先将 <code>vmetrics_clean</code>、<code>vlogs_clean</code>、<code>vtraces_clean</code> 设置为 <code>false</code></li><li>如果设置 <code>grafana_clean</code> 为 <code>true</code>，Grafana 数据库会被清理，原有仪表盘与配置会丢失</li><li>当本地软件仓库 <code>/www/pigsty/repo_complete</code> 存在时，本剧本会跳过从互联网下载软件的任务</li><li>完整执行该剧本耗时约1～3分钟，视机器配置与网络条件而异</li></ul><h3 id=可用任务列表>可用任务列表</h3><pre tabindex=0><code># ca: create self-signed CA on localhost files/pki
#   - ca_dir        : create CA directory
#   - ca_private    : generate ca private key: files/pki/ca/ca.key
#   - ca_cert       : signing ca cert: files/pki/ca/ca.crt
#
# id: generate node identity
#
# repo: bootstrap a local yum repo from internet or offline packages
#   - repo_dir      : create repo directory
#   - repo_check    : check repo exists
#   - repo_prepare  : use existing repo if exists
#   - repo_build    : build repo from upstream if not exists
#     - repo_upstream    : handle upstream repo files in /etc/yum.repos.d
#       - repo_remove    : remove existing repo file if repo_remove == true
#       - repo_add       : add upstream repo files to /etc/yum.repos.d
#     - repo_url_pkg     : download packages from internet defined by repo_url_packages
#     - repo_cache       : make upstream yum cache with yum makecache
#     - repo_boot_pkg    : install bootstrap pkg such as createrepo_c,yum-utils,...
#     - repo_pkg         : download packages &amp; dependencies from upstream repo
#     - repo_create      : create a local yum repo with createrepo_c &amp; modifyrepo_c
#     - repo_use         : add newly built repo into /etc/yum.repos.d
#   - repo_nginx    : launch a nginx for repo if no nginx is serving
#
# node/haproxy/docker/monitor: setup infra node as a common node
#   - node_name, node_hosts, node_resolv, node_firewall, node_ca, node_repo, node_pkg
#   - node_feature, node_kernel, node_tune, node_sysctl, node_profile, node_ulimit
#   - node_data, node_admin, node_timezone, node_ntp, node_crontab, node_vip
#   - haproxy_install, haproxy_config, haproxy_launch, haproxy_reload
#   - docker_install, docker_admin, docker_config, docker_launch, docker_image
#   - haproxy_register, node_exporter, node_register, vector
#
# infra: setup infra components
#   - infra_env      : env_patroni, env_pg, env_pgadmin, env_var
#   - infra_pkg      : install infra packages
#   - infra_user     : setup infra os user group
#   - infra_cert     : issue cert for infra components
#   - dns            : dns_config, dns_record, dns_launch
#   - nginx          : nginx_config, nginx_cert, nginx_static, nginx_launch, nginx_certbot, nginx_reload, nginx_exporter
#   - victoria       : vmetrics_config, vmetrics_launch, vlogs_config, vlogs_launch, vtraces_config, vtraces_launch, vmalert_config, vmalert_launch
#   - alertmanager   : alertmanager_config, alertmanager_launch
#   - blackbox       : blackbox_config, blackbox_launch
#   - grafana        : grafana_clean, grafana_config, grafana_launch, grafana_provision
#   - infra_register : register infra components to victoria
</code></pre><hr><h2 id=infra-rmyml><code>infra-rm.yml</code></h2><p>从配置文件 <code>infra</code> 分组定义的 Infra节点 上移除 Pigsty 基础设施。</p><p>常用子任务包括：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml               <span style=color:#8f5902;font-style:italic># 移除 INFRA 模块</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t service    <span style=color:#8f5902;font-style:italic># 停止 INFRA 上的基础设施服务</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t data       <span style=color:#8f5902;font-style:italic># 移除 INFRA 上的存留数据</span>
</span></span><span style=display:flex><span>./infra-rm.yml -t package    <span style=color:#8f5902;font-style:italic># 卸载 INFRA 上安装的软件包</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-338892e63af76b4e44d46c71803f5af5>4 - 监控告警</h1><div class=lead>如何在 Pigsty 中对基础设施进行自监控？</div><p>本文介绍 Pigsty 中 INFRA 模块的监控面板与告警规则。</p><hr><h2 id=监控面板>监控面板</h2><p>Pigsty 针对 Infra 模块提供了以下监控面板：</p><table class=full-width><thead><tr><th style=text-align:left>面板</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/pigsty>Pigsty Home</a></td><td style=text-align:left>Pigsty 监控系统主页</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/infra-overview>INFRA Overview</a></td><td style=text-align:left>Pigsty 基础设施自监控概览</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/nginx-instance>Nginx Instance</a></td><td style=text-align:left>Nginx 监控指标与日志</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/grafana-instance>Grafana Instance</a></td><td style=text-align:left>Grafana 监控指标与日志</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/vmetrics-instance>VictoriaMetrics Instance</a></td><td style=text-align:left>VictoriaMetrics 抓取/查询状态</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/vmalert-instance>VMAlert Instance</a></td><td style=text-align:left>告警规则执行情况</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/alertmanager-instance>Alertmanager Instance</a></td><td style=text-align:left>告警聚合与通知</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/vlogs-instance>VictoriaLogs Instance</a></td><td style=text-align:left>日志写入、查询与索引</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/logs-instance>Logs Instance</a></td><td style=text-align:left>查阅单个节点上的日志信息</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/vtraces-instance>VictoriaTraces Instance</a></td><td style=text-align:left>Trace 存储与查询</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/inventory-cmdb>Inventory CMDB</a></td><td style=text-align:left>CMDB 可视化</td></tr><tr><td style=text-align:left><a href=https://demo.pigsty.cc/d/etcd-overview>ETCD Overview</a></td><td style=text-align:left>etcd 集群监控</td></tr></tbody></table><hr><h2 id=告警规则>告警规则</h2><p>Pigsty 针对 INFRA 模块提供了以下两条告警规则：</p><table class=full-width><thead><tr><th style=text-align:left>告警规则</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><code>InfraDown</code></td><td style=text-align:left>基础设施组件出现宕机</td></tr><tr><td style=text-align:left><code>AgentDown</code></td><td style=text-align:left>监控 Agent 代理出现宕机</td></tr></tbody></table><p>可在 <a href=https://github.com/pgsty/pigsty/blob/main/files/victoria/rules/infra.yml><code>files/victoria/rules/infra.yml</code></a> 中修改或添加新的基础设施告警规则。</p><h3 id=告警规则配置>告警规则配置</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################################</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                Infrastructure Alert Rules                    #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################################</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra-alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#                       Infra Aliveness                        #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># infra components (victoria,grafana) down for 1m triggers a P1 alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>InfraDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CRIT InfraDown {{ $labels.type }}@{{ $labels.instance }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          infra_up[type={{ $labels.type }}, instance={{ $labels.instance }}] = {{ $value  | printf &#34;%.2f&#34; }} &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#                       Agent Aliveness                        #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># agent aliveness are determined directly by exporter aliveness</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># including: node_exporter, pg_exporter, pgbouncer_exporter, haproxy_exporter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>AgentDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>agent_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>infra }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;CRIT AgentDown {{ $labels.ins }}@{{ $labels.instance }}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          agent_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value  | printf &#34;%.2f&#34; }} &lt; 1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f8c94ca1b2e6cfdd961016e7d77247d8>5 - 指标列表</h1><div class=lead>Pigsty INFRA 模块提供的完整监控指标列表与释义</div><hr><blockquote><p><strong>注意</strong>：Pigsty v4.0 已将 Prometheus/Loki 替换为 VictoriaMetrics/Logs/Traces。以下指标清单仍基于 v3.x 生成，仅供排查旧版本问题参考。若需获取最新指标，请在 <code>https://p.pigsty</code> (VMUI) 或 Grafana 中直接查询，后续版本会重新生成与 Victoria 套件一致的指标速查表。</p></blockquote><h2 id=infra-指标>INFRA 指标</h2><p><a href=/docs/infra><strong><code>INFRA</code></strong></a> 模块包含有 964 类可用监控指标。</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>alertmanager_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many alerts by state.</td></tr><tr><td>alertmanager_alerts_invalid_total</td><td>counter</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of received alerts that were invalid.</td></tr><tr><td>alertmanager_alerts_received_total</td><td>counter</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>The total number of received alerts.</td></tr><tr><td>alertmanager_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which alertmanager was built, and the goos and goarch for the build.</td></tr><tr><td>alertmanager_cluster_alive_messages_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>peer</code>, <code>job</code>, <code>cls</code></td><td>Total number of received alive messages.</td></tr><tr><td>alertmanager_cluster_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Indicates whether the clustering is enabled or not.</td></tr><tr><td>alertmanager_cluster_failed_peers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number indicating the current number of failed peers in the cluster.</td></tr><tr><td>alertmanager_cluster_health_score</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Health score of the cluster. Lower values are better and zero means &rsquo;totally healthy&rsquo;.</td></tr><tr><td>alertmanager_cluster_members</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number indicating current number of members in cluster.</td></tr><tr><td>alertmanager_cluster_messages_pruned_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages pruned.</td></tr><tr><td>alertmanager_cluster_messages_queued</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of cluster messages which are queued.</td></tr><tr><td>alertmanager_cluster_messages_received_size_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total size of cluster messages received.</td></tr><tr><td>alertmanager_cluster_messages_received_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages received.</td></tr><tr><td>alertmanager_cluster_messages_sent_size_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total size of cluster messages sent.</td></tr><tr><td>alertmanager_cluster_messages_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>msg_type</code>, <code>job</code>, <code>cls</code></td><td>Total number of cluster messages sent.</td></tr><tr><td>alertmanager_cluster_peer_info</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>peer</code>, <code>job</code>, <code>cls</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by peer name.</td></tr><tr><td>alertmanager_cluster_peers_joined_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have joined.</td></tr><tr><td>alertmanager_cluster_peers_left_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have left.</td></tr><tr><td>alertmanager_cluster_peers_update_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of peers that have updated metadata.</td></tr><tr><td>alertmanager_cluster_reconnections_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of failed cluster peer reconnection attempts.</td></tr><tr><td>alertmanager_cluster_reconnections_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of cluster peer reconnections.</td></tr><tr><td>alertmanager_cluster_refresh_join_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of failed cluster peer joined attempts via refresh.</td></tr><tr><td>alertmanager_cluster_refresh_join_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A counter of the number of cluster peer joined via refresh.</td></tr><tr><td>alertmanager_config_hash</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Hash of the currently loaded alertmanager configuration.</td></tr><tr><td>alertmanager_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>alertmanager_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the last configuration reload attempt was successful.</td></tr><tr><td>alertmanager_dispatcher_aggregation_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active aggregation groups</td></tr><tr><td>alertmanager_dispatcher_alert_processing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_dispatcher_alert_processing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_http_concurrency_limit_exceeded_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times an HTTP request failed because the concurrency limit was reached.</td></tr><tr><td>alertmanager_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_requests_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of HTTP requests being processed.</td></tr><tr><td>alertmanager_http_response_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_response_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_http_response_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>alertmanager_integrations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of configured integrations.</td></tr><tr><td>alertmanager_marked_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many alerts by state are currently marked in the Alertmanager regardless of their expiry.</td></tr><tr><td>alertmanager_nflog_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_gossip_messages_propagated_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of received gossip messages that have been further gossiped.</td></tr><tr><td>alertmanager_nflog_maintenance_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for the notification log that failed.</td></tr><tr><td>alertmanager_nflog_maintenance_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for the notification log.</td></tr><tr><td>alertmanager_nflog_queries_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of notification log queries were received.</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_query_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number notification log received queries that failed.</td></tr><tr><td>alertmanager_nflog_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_nflog_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last notification log snapshot in bytes.</td></tr><tr><td>alertmanager_notification_latency_seconds_bucket</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_latency_seconds_count</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_latency_seconds_sum</td><td>Unknown</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_notification_requests_failed_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of failed notification requests.</td></tr><tr><td>alertmanager_notification_requests_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of attempted notification requests.</td></tr><tr><td>alertmanager_notifications_failed_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>The total number of failed notifications.</td></tr><tr><td>alertmanager_notifications_total</td><td>counter</td><td><code>integration</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of attempted notifications.</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversize_gossip_message_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_oversized_gossip_message_dropped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip messages that were dropped due to a full message queue.</td></tr><tr><td>alertmanager_oversized_gossip_message_failure_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip message sends that failed.</td></tr><tr><td>alertmanager_oversized_gossip_message_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>key</code>, <code>job</code>, <code>cls</code></td><td>Number of oversized gossip message sent.</td></tr><tr><td>alertmanager_peer_position</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Position the Alertmanager instance believes it&rsquo;s in. The position determines a peer&rsquo;s behavior in the cluster.</td></tr><tr><td>alertmanager_receivers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of configured receivers.</td></tr><tr><td>alertmanager_silences</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>How many silences by state.</td></tr><tr><td>alertmanager_silences_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_gossip_messages_propagated_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of received gossip messages that have been further gossiped.</td></tr><tr><td>alertmanager_silences_maintenance_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for silences that failed.</td></tr><tr><td>alertmanager_silences_maintenance_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many maintenances were executed for silences.</td></tr><tr><td>alertmanager_silences_queries_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many silence queries were received.</td></tr><tr><td>alertmanager_silences_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_query_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many silence received queries did not succeed.</td></tr><tr><td>alertmanager_silences_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>alertmanager_silences_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last silence snapshot in bytes.</td></tr><tr><td>blackbox_exporter_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which blackbox_exporter was built, and the goos and goarch for the build.</td></tr><tr><td>blackbox_exporter_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>blackbox_exporter_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Blackbox exporter config loaded successfully.</td></tr><tr><td>blackbox_module_unknown_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Count of unknown modules requested by probes</td></tr><tr><td>cortex_distributor_ingester_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of ingester clients.</td></tr><tr><td>cortex_dns_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_dns_lookups_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_frontend_query_range_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_ingester_flush_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of series pending in the flush queue.</td></tr><tr><td>cortex_kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>cortex_member_consul_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_notifications_alertmanagers_discovered</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The number of alertmanagers discovered and active.</td></tr><tr><td>cortex_prometheus_notifications_dropped_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_notifications_queue_capacity</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The capacity of the alert notifications queue.</td></tr><tr><td>cortex_prometheus_notifications_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>The number of alert notifications in the queue.</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration for a rule to execute.</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_evaluation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of rule group evaluations.</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_prometheus_rule_group_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_connected_schedulers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of schedulers this frontend is connected to.</td></tr><tr><td>cortex_query_frontend_queries_in_progress</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of queries in progress handled by this frontend.</td></tr><tr><td>cortex_query_frontend_retries_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_retries_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_frontend_retries_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_connected_frontend_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of query-frontend worker clients currently connected to the query-scheduler.</td></tr><tr><td>cortex_query_scheduler_connected_querier_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of querier worker clients currently connected to the query-scheduler.</td></tr><tr><td>cortex_query_scheduler_inflight_requests</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Number of inflight requests (either queued or processing) sampled at a regular interval. Quantile buckets keep track of inflight requests over the last 60s.</td></tr><tr><td>cortex_query_scheduler_inflight_requests_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_inflight_requests_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_queue_length</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_query_scheduler_running</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Value will be 1 if the scheduler is in the ReplicationSet and actively receiving/processing requests</td></tr><tr><td>cortex_ring_member_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ring_member_tokens_owned</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens owned in the ring.</td></tr><tr><td>cortex_ring_member_tokens_to_own</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens to own in the ring.</td></tr><tr><td>cortex_ring_members</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>Number of members in the ring</td></tr><tr><td>cortex_ring_oldest_member_timestamp</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>Timestamp of the oldest member in the ring.</td></tr><tr><td>cortex_ring_tokens_total</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of tokens in the ring</td></tr><tr><td>cortex_ruler_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of ruler clients in the pool.</td></tr><tr><td>cortex_ruler_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>Boolean set to 1 whenever the last configuration reload attempt was successful.</td></tr><tr><td>cortex_ruler_config_last_reload_successful_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>cortex_ruler_config_updates_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ruler_managers_total</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of managers registered and running in the ruler</td></tr><tr><td>cortex_ruler_ring_check_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>cortex_ruler_sync_rules_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>deprecated_flags_inuse_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cgo_go_to_c_calls_calls_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_assist_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_dedicated_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_mark_idle_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_pause_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_gc_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_idle_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_assist_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_background_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_scavenge_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_total_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_cpu_classes_user_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_automatic_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_forced_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_cycles_total_gc_cycles_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_gogc_percent</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap size target percentage configured by the user, otherwise 100. This value is set by the GOGC environment variable, and the runtime/debug.SetGCPercent function.</td></tr><tr><td>go_gc_gomemlimit_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Go runtime memory limit configured by the user, otherwise math.MaxInt64. This value is set by the GOMEMLIMIT environment variable, and the runtime/debug.SetMemoryLimit function.</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_by_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_allocs_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_by_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_frees_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_heap_goal_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap size target for the end of the GC cycle.</td></tr><tr><td>go_gc_heap_live_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Heap memory occupied by live objects that were marked by the previous GC.</td></tr><tr><td>go_gc_heap_objects_objects</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of objects, live or unswept, occupying heap memory.</td></tr><tr><td>go_gc_heap_tiny_allocs_objects_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_limiter_last_enabled_gc_cycle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>GC cycle the last time the GC CPU limiter was enabled. This metric is useful for diagnosing the root cause of an out-of-memory error, because the limiter trades memory for CPU time when the GC&rsquo;s CPU time gets too high. This is most likely to occur with use of SetMemoryLimit. The first GC cycle is cycle 1, so a value of 0 indicates that it was never enabled.</td></tr><tr><td>go_gc_pauses_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_pauses_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_pauses_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_gc_scan_globals_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount of global variable space that is scannable.</td></tr><tr><td>go_gc_scan_heap_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount of heap space that is scannable.</td></tr><tr><td>go_gc_scan_stack_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes of stack that were scanned last GC cycle.</td></tr><tr><td>go_gc_scan_total_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total amount space that is scannable. Sum of all metrics in /gc/scan.</td></tr><tr><td>go_gc_stack_starting_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The stack size of new goroutines.</td></tr><tr><td>go_godebug_non_default_behavior_execerrdot_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocachehash_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocachetest_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_gocacheverify_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_http2client_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_http2server_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_installgoroot_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_jstmpllitinterp_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipartmaxheaders_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipartmaxparts_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_multipathtcp_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_panicnil_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_randautoseed_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_tarinsecurepath_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_tlsmaxrsasize_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_x509sha1_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_x509usefallbackroots_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_godebug_non_default_behavior_zipinsecurepath_events_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memory_classes_heap_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is completely free and eligible to be returned to the underlying system, but has not been. This metric is the runtime&rsquo;s estimate of free address space that is backed by physical memory.</td></tr><tr><td>go_memory_classes_heap_objects_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory occupied by live objects and dead objects that have not yet been marked free by the garbage collector.</td></tr><tr><td>go_memory_classes_heap_released_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is completely free and has been returned to the underlying system. This metric is the runtime&rsquo;s estimate of free address space that is still mapped into the process, but is not backed by physical memory.</td></tr><tr><td>go_memory_classes_heap_stacks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory allocated from the heap that is reserved for stack space, whether or not it is currently in-use. Currently, this represents all stack memory for goroutines. It also includes all OS thread stacks in non-cgo programs. Note that stacks may be allocated differently in the future, and this may change.</td></tr><tr><td>go_memory_classes_heap_unused_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for heap objects but is not currently used to hold heap objects.</td></tr><tr><td>go_memory_classes_metadata_mcache_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for runtime mcache structures, but not in-use.</td></tr><tr><td>go_memory_classes_metadata_mcache_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is occupied by runtime mcache structures that are currently being used.</td></tr><tr><td>go_memory_classes_metadata_mspan_free_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for runtime mspan structures, but not in-use.</td></tr><tr><td>go_memory_classes_metadata_mspan_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is occupied by runtime mspan structures that are currently being used.</td></tr><tr><td>go_memory_classes_metadata_other_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is reserved for or used to hold runtime metadata.</td></tr><tr><td>go_memory_classes_os_stacks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Stack memory allocated by the underlying operating system. In non-cgo programs this metric is currently zero. This may change in the future.In cgo programs this metric includes OS thread stacks allocated directly from the OS. Currently, this only accounts for one stack in c-shared and c-archive build modes, and other sources of stacks from the OS are not measured. This too may change in the future.</td></tr><tr><td>go_memory_classes_other_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory used by execution trace buffers, structures for debugging the runtime, finalizer and profiler specials, and more.</td></tr><tr><td>go_memory_classes_profiling_buckets_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Memory that is used by the stack trace hash map used for profiling.</td></tr><tr><td>go_memory_classes_total_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>All memory mapped by the Go runtime into the current process as read-write. Note that this does not include memory mapped by code called via cgo or via the syscall package. Sum of all metrics in /memory/classes.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_sched_gomaxprocs_threads</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current runtime.GOMAXPROCS setting, or the number of operating system threads that can execute user-level Go code simultaneously.</td></tr><tr><td>go_sched_goroutines_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Count of live goroutines.</td></tr><tr><td>go_sched_latencies_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sched_latencies_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sched_latencies_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_sql_stats_connections_blocked_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total time blocked waiting for a new connection.</td></tr><tr><td>go_sql_stats_connections_closed_max_idle</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetMaxIdleConns.</td></tr><tr><td>go_sql_stats_connections_closed_max_idle_time</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxIdleTime.</td></tr><tr><td>go_sql_stats_connections_closed_max_lifetime</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxLifetime.</td></tr><tr><td>go_sql_stats_connections_idle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of idle connections.</td></tr><tr><td>go_sql_stats_connections_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of connections currently in use.</td></tr><tr><td>go_sql_stats_connections_max_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open connections to the database.</td></tr><tr><td>go_sql_stats_connections_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of established connections both in use and idle.</td></tr><tr><td>go_sql_stats_connections_waited_for</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>db_name</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections waited for.</td></tr><tr><td>go_sync_mutex_wait_total_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of OS threads created.</td></tr><tr><td>grafana_access_evaluation_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>number of evaluation calls</td></tr><tr><td>grafana_access_evaluation_duration_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_evaluation_duration_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_evaluation_duration_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_access_permissions_duration_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aggregator_discovery_aggregation_count_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_active_alerts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>amount of active alerts</td></tr><tr><td>grafana_alerting_active_configurations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of active Alertmanager configurations.</td></tr><tr><td>grafana_alerting_alertmanager_config_match</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of match</td></tr><tr><td>grafana_alerting_alertmanager_config_match_re</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of matchRE</td></tr><tr><td>grafana_alerting_alertmanager_config_matchers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of matchers</td></tr><tr><td>grafana_alerting_alertmanager_config_object_matchers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of object_matchers</td></tr><tr><td>grafana_alerting_discovered_configurations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of organizations we&rsquo;ve discovered that require an Alertmanager configuration.</td></tr><tr><td>grafana_alerting_dispatcher_aggregation_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active aggregation groups</td></tr><tr><td>grafana_alerting_dispatcher_alert_processing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_dispatcher_alert_processing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_execution_time_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary of alert execution duration</td></tr><tr><td>grafana_alerting_execution_time_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_execution_time_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_gossip_messages_propagated_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_queries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_query_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_nflog_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last notification log snapshot in bytes.</td></tr><tr><td>grafana_alerting_notification_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_notification_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_notification_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_alert_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alert rules that could be considered for evaluation at the next tick.</td></tr><tr><td>grafana_alerting_schedule_alert_rules_hash</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A hash of the alert rules that could be considered for evaluation at the next tick.</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_periodic_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_schedule_query_alert_rules_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_scheduler_behind_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of seconds the scheduler is behind.</td></tr><tr><td>grafana_alerting_silences_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_gossip_messages_propagated_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_queries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_query_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_silences_snapshot_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the last silence snapshot in bytes.</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_calculation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_state_history_writes_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_alerting_ticker_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Interval at which the ticker is meant to tick.</td></tr><tr><td>grafana_alerting_ticker_last_consumed_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last consumed tick in seconds.</td></tr><tr><td>grafana_alerting_ticker_next_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the next tick in seconds before it is consumed.</td></tr><tr><td>grafana_api_admin_user_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_get_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard get duration</td></tr><tr><td>grafana_api_dashboard_get_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_get_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_save_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard save duration</td></tr><tr><td>grafana_api_dashboard_save_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_save_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_search_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dashboard search duration</td></tr><tr><td>grafana_api_dashboard_search_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_search_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_create_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_external_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dashboard_snapshot_get_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for dataproxy request duration</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_dataproxy_request_all_milliseconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_oauth_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_post_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_login_saml_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_models_dashboard_insert_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_org_create_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_completed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_invite_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_api_user_signup_started_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_audit_event_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_audit_requests_rejected_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_client_certificate_expiration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_envelope_encryption_dek_cache_fill_percent</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>[ALPHA] Percent of the cache slots currently occupied by cached DEKs.</td></tr><tr><td>grafana_apiserver_flowcontrol_seat_fair_frac</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>[ALPHA] Fair fraction of server&rsquo;s concurrency to allocate to each priority level that can use it</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_data_key_generation_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_storage_envelope_transformation_cache_misses_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_tls_handshake_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_webhooks_x509_insecure_sha1_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_apiserver_webhooks_x509_missing_san_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_failed_authentication_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_successful_authentication_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>client</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_authn_authn_successful_login_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>client</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_get_metric_data_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_get_metric_statistics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_aws_cloudwatch_list_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>edition</code>, <code>ip</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, and goversion from which Grafana was built</td></tr><tr><td>grafana_build_timestamp</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>edition</code>, <code>ip</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code></td><td>A metric exposing when the binary was built in epoch</td></tr><tr><td>grafana_cardinality_enforcement_unexpected_categorizations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_idle</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of idle connections</td></tr><tr><td>grafana_database_conn_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of connections currently in use</td></tr><tr><td>grafana_database_conn_max_idle_closed_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of connections closed due to SetConnMaxIdleTime</td></tr><tr><td>grafana_database_conn_max_idle_closed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_max_lifetime_closed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_max_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open connections to the database</td></tr><tr><td>grafana_database_conn_open</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of established connections both in use and idle</td></tr><tr><td>grafana_database_conn_wait_count_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_database_conn_wait_duration_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total time blocked waiting for a new connection</td></tr><tr><td>grafana_datasource_request_duration_seconds_bucket</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_duration_seconds_count</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_duration_seconds_sum</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_request_in_flight</td><td>gauge</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>A gauge of outgoing data source requests currently being sent by Grafana</td></tr><tr><td>grafana_datasource_request_total</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_bucket</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_count</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_datasource_response_size_bytes_sum</td><td>Unknown</td><td><code>datasource</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>datasource_type</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_db_datasource_query_by_id_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_disabled_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_emails_sent_failed</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of emails Grafana failed to send</td></tr><tr><td>grafana_emails_sent_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_encryption_cache_reads_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>hit</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_encryption_ops_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>success</code>, <code>operation</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_environment_info</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>commit</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by environment information about the running instance.</td></tr><tr><td>grafana_feature_toggles_info</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>info metric that exposes what feature toggles are enabled or not</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_css_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_contentful_paint_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_first_paint_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_js_done_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_boot_load_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_frontend_plugins_preload_ms_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_hidden_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>grafana_http_request_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>A gauge of requests currently being served by Grafana.</td></tr><tr><td>grafana_idforwarding_idforwarding_failed_token_signing_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_from_cache_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_idforwarding_idforwarding_token_signing_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_instance_start_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_ldap_users_sync_execution_time</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>summary for LDAP users sync execution duration</td></tr><tr><td>grafana_ldap_users_sync_execution_time_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_ldap_users_sync_execution_time_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_command_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Client command duration summary.</td></tr><tr><td>grafana_live_client_command_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_command_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_live_client_num_reply_errors</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Number of errors in replies sent to clients.</td></tr><tr><td>grafana_live_client_num_server_disconnects</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Number of server initiated disconnects.</td></tr><tr><td>grafana_live_client_recover</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>recovered</code>, <code>job</code>, <code>cls</code></td><td>Count of recover operations.</td></tr><tr><td>grafana_live_node_action_count</td><td>unknown</td><td><code>action</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of node actions called.</td></tr><tr><td>grafana_live_node_build</td><td>gauge</td><td><code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Node build info.</td></tr><tr><td>grafana_live_node_messages_received_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Number of messages received.</td></tr><tr><td>grafana_live_node_messages_sent_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Number of messages sent.</td></tr><tr><td>grafana_live_node_num_channels</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of channels with one or more subscribers.</td></tr><tr><td>grafana_live_node_num_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of clients connected.</td></tr><tr><td>grafana_live_node_num_nodes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of nodes in cluster.</td></tr><tr><td>grafana_live_node_num_subscriptions</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of subscriptions.</td></tr><tr><td>grafana_live_node_num_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of unique users connected.</td></tr><tr><td>grafana_live_transport_connect_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>transport</code>, <code>job</code>, <code>cls</code></td><td>Number of connections to specific transport.</td></tr><tr><td>grafana_live_transport_messages_sent</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>transport</code>, <code>job</code>, <code>cls</code></td><td>Number of messages sent over specific transport.</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_loki_plugin_parse_response_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_page_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_plugin_build_info</td><td>gauge</td><td><code>version</code>, <code>signature_status</code>, <code>ins</code>, <code>instance</code>, <code>plugin_type</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by pluginId, pluginType and version from which Grafana plugin was built</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_milliseconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_bucket</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>le</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_size_bytes_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>plugin_id</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_plugin_request_total</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>target</code>, <code>ip</code>, <code>status</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_process_cpu_seconds_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_process_max_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>grafana_process_open_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of open file descriptors.</td></tr><tr><td>grafana_process_resident_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Resident memory size in bytes.</td></tr><tr><td>grafana_process_start_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>grafana_process_virtual_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>grafana_process_virtual_memory_max_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>grafana_prometheus_plugin_backend_request_count</td><td>unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>errorSource</code>, <code>job</code>, <code>cls</code></td><td>The total amount of prometheus backend plugin requests</td></tr><tr><td>grafana_proxy_response_status_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>N/A</td></tr><tr><td>grafana_public_dashboard_request_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>counter for public dashboards requests</td></tr><tr><td>grafana_registered_metrics_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>stability_level</code>, <code>deprecated_version</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_rendering_queue_size</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>size of rendering queue</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_failures_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_search_dashboard_search_successes_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>grafana_stat_active_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>number of active users</td></tr><tr><td>grafana_stat_total_orgs</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of orgs</td></tr><tr><td>grafana_stat_total_playlists</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of playlists</td></tr><tr><td>grafana_stat_total_service_account_tokens</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service account tokens</td></tr><tr><td>grafana_stat_total_service_accounts</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service accounts</td></tr><tr><td>grafana_stat_total_service_accounts_role_none</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of service accounts with no role</td></tr><tr><td>grafana_stat_total_teams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of teams</td></tr><tr><td>grafana_stat_total_users</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of users</td></tr><tr><td>grafana_stat_totals_active_admins</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active admins</td></tr><tr><td>grafana_stat_totals_active_editors</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active editors</td></tr><tr><td>grafana_stat_totals_active_viewers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of active viewers</td></tr><tr><td>grafana_stat_totals_admins</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of admins</td></tr><tr><td>grafana_stat_totals_alert_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of alert rules in the database</td></tr><tr><td>grafana_stat_totals_annotations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of annotations in the database</td></tr><tr><td>grafana_stat_totals_correlations</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of correlations</td></tr><tr><td>grafana_stat_totals_dashboard</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of dashboards</td></tr><tr><td>grafana_stat_totals_dashboard_versions</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of dashboard versions in the database</td></tr><tr><td>grafana_stat_totals_data_keys</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>active</code></td><td>total amount of data keys in the database</td></tr><tr><td>grafana_stat_totals_datasource</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>plugin_id</code>, <code>job</code>, <code>cls</code></td><td>total number of defined datasources, labeled by pluginId</td></tr><tr><td>grafana_stat_totals_editors</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of editors</td></tr><tr><td>grafana_stat_totals_folder</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of folders</td></tr><tr><td>grafana_stat_totals_library_panels</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of library panels in the database</td></tr><tr><td>grafana_stat_totals_library_variables</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of library variables in the database</td></tr><tr><td>grafana_stat_totals_public_dashboard</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of public dashboards</td></tr><tr><td>grafana_stat_totals_rule_groups</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of alert rule groups in the database</td></tr><tr><td>grafana_stat_totals_viewers</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>total amount of viewers</td></tr><tr><td>infra_up</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_restrictions_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_truncations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_baggage_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_finished_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_reporter_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of spans in the reporter queue</td></tr><tr><td>jaeger_tracer_reporter_spans_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_sampler_queries_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_sampler_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_span_context_decoding_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_started_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_throttled_debug_spans_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_throttler_updates_total</td><td>Unknown</td><td><code>result</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>jaeger_tracer_traces_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>sampled</code>, <code>job</code>, <code>cls</code>, <code>state</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>legacy_grafana_alerting_ticker_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Interval at which the ticker is meant to tick.</td></tr><tr><td>legacy_grafana_alerting_ticker_last_consumed_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last consumed tick in seconds.</td></tr><tr><td>legacy_grafana_alerting_ticker_next_tick_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the next tick in seconds before it is consumed.</td></tr><tr><td>logql_query_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>logql_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>logql_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>query_type</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_azure_blob_egress_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_apply_retention_last_successful_run_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Unix timestamp of the last successful retention run</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time (in seconds) spent in compacting all the tables</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_last_successful_run_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Unix timestamp of the last successful compaction run</td></tr><tr><td>loki_boltdb_shipper_compact_tables_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_compactor_running</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Value will be 1 if compactor is currently running on this instance</td></tr><tr><td>loki_boltdb_shipper_open_existing_file_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_query_time_table_download_duration_seconds</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code>, <code>table</code></td><td>Time (in seconds) spent in downloading of files per table at query time</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_tables_download_operation_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>Time (in seconds) spent in downloading updated files for all the tables</td></tr><tr><td>loki_boltdb_shipper_tables_sync_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_boltdb_shipper_tables_upload_operation_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>component</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which loki was built, and the goos and goarch for the build.</td></tr><tr><td>loki_bytes_per_line_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_bytes_per_line_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_bytes_per_line_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_corrupt_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_fetched_keys</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total count of keys requested from cache.</td></tr><tr><td>loki_cache_hits</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total count of keys found in cache.</td></tr><tr><td>loki_cache_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_cache_value_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_dequeued_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_enqueued_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_cache_skipped_buffer_full_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_fetcher_fetched_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>source</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_chunks_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_deduped_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_deduped_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_fetched_chunk_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_fetched_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_entries_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_index_lookups_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_post_intersection_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_series_pre_intersection_per_query_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_stored_chunk_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_chunk_store_stored_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_consul_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>kv_name</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_delete_request_lookups_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_delete_request_lookups_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_discarded_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_discarded_samples_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_bytes_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>retention_hours</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_ingester_appends_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>ingester</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_distributor_lines_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_distributor_replication_factor</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The configured replication factor.</td></tr><tr><td>loki_distributor_structured_metadata_bytes_received_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>retention_hours</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_experimental_features_in_use_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_index_chunk_refs_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_index_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>component</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_inflight_requests</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>Current number of inflight requests.</td></tr><tr><td>loki_ingester_autoforget_unhealthy_ingesters_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_blocks_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_creations_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_creations_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_deletions_failed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_deletions_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Time taken to create a checkpoint.</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_checkpoint_logged_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_age_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_bounds_hours_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_compression_ratio_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_encode_time_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_entries_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_stored_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunk_utilization_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_flushed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_chunks_stored_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_client_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_ingester_limiter_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the ingester&rsquo;s limiter is enabled</td></tr><tr><td>loki_ingester_memory_chunks</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks in memory.</td></tr><tr><td>loki_ingester_memory_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>The total number of streams in memory per tenant.</td></tr><tr><td>loki_ingester_memory_streams_labels_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total bytes of labels of the streams in memory.</td></tr><tr><td>loki_ingester_received_chunks</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks received by this ingester whilst joining.</td></tr><tr><td>loki_ingester_samples_per_chunk_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_samples_per_chunk_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_samples_per_chunk_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_sent_chunks</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of chunks sent by this ingester whilst leaving.</td></tr><tr><td>loki_ingester_shutdown_marker</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>1 if prepare shutdown has been called, 0 otherwise</td></tr><tr><td>loki_ingester_streams_created_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_streams_removed_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>tenant</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_bytes_in_use</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of bytes in use by the WAL recovery process.</td></tr><tr><td>loki_ingester_wal_disk_full_failures_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_duplicate_entries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_logged_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_records_logged_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_chunks_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_entries_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_recovered_streams_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_ingester_wal_replay_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the WAL is replaying</td></tr><tr><td>loki_ingester_wal_replay_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time taken to replay the checkpoint and the WAL.</td></tr><tr><td>loki_ingester_wal_replay_flushing</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the wal replay is in a flushing phase due to backpressure</td></tr><tr><td>loki_internal_log_messages_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>le</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_kv_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>kv_name</code>, <code>type</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_flushes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_log_messages_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_bytes_processed_per_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>sharded</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code>, <code>latency_type</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_chunk_download_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_downloaded_chunk_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_duplicates_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_ingester_sent_lines_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>le</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_logql_querystats_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>range</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_panic_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_corruptions_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_encode_errors_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_hits_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_index_cache_puts_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_clients</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of clients connected to query-frontend.</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_query_frontend_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>operation</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_querier_tail_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active tailers</td></tr><tr><td>loki_querier_tail_active_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of active streams being tailed</td></tr><tr><td>loki_querier_tail_bytes_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_querier_worker_concurrency</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of concurrent querier workers</td></tr><tr><td>loki_querier_worker_inflight_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of queries being processed by the querier workers</td></tr><tr><td>loki_query_frontend_log_result_cache_hit_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_log_result_cache_miss_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_partitions_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_frontend_shard_factor_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>mapper</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_query_scheduler_enqueue_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>level</code>, <code>user</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_expired_streams_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_max_stream_rate_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The maximum stream rate for any stream reported by ingesters during a sync operation. Sharded Streams are combined.</td></tr><tr><td>loki_rate_store_max_stream_shards</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of shards for a single stream reported by ingesters during a sync operation.</td></tr><tr><td>loki_rate_store_max_unique_stream_rate_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The maximum stream rate for any stream reported by ingesters during a sync operation. Sharded Streams are considered separate.</td></tr><tr><td>loki_rate_store_stream_rate_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_rate_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_rate_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_stream_shards_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_rate_store_streams</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of unique streams reported by all ingesters. Sharded streams are combined</td></tr><tr><td>loki_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>ws</code>, <code>route</code>, <code>job</code>, <code>cls</code>, <code>status_code</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_request_message_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>le</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_response_message_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>route</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_results_cache_version_comparisons_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_downloaded_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_chunks_per_batch_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_store_series_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>status</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>loki_stream_sharding_count</td><td>unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times the distributor has sharded streams</td></tr><tr><td>loki_tcp_connections</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>protocol</code>, <code>job</code>, <code>cls</code></td><td>Current number of accepted TCP connections.</td></tr><tr><td>loki_tcp_connections_limit</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>protocol</code>, <code>job</code>, <code>cls</code></td><td>The max number of TCP connections that can be accepted (0 means no limit).</td></tr><tr><td>net_conntrack_dialer_conn_attempted_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections attempted by the given dialer a given name.</td></tr><tr><td>net_conntrack_dialer_conn_closed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections closed which originated from the dialer of a given name.</td></tr><tr><td>net_conntrack_dialer_conn_established_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections successfully established by the given dialer a given name.</td></tr><tr><td>net_conntrack_dialer_conn_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>dialer_name</code>, <code>reason</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections failed to dial by the dialer a given name.</td></tr><tr><td>net_conntrack_listener_conn_accepted_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>listener_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections opened to the listener of a given name.</td></tr><tr><td>net_conntrack_listener_conn_closed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>listener_name</code>, <code>job</code>, <code>cls</code></td><td>Total number of connections closed that were made to the listener of a given name.</td></tr><tr><td>nginx_connections_accepted</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Accepted client connections</td></tr><tr><td>nginx_connections_active</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Active client connections</td></tr><tr><td>nginx_connections_handled</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Handled client connections</td></tr><tr><td>nginx_connections_reading</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Connections where NGINX is reading the request header</td></tr><tr><td>nginx_connections_waiting</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Idle client connections</td></tr><tr><td>nginx_connections_writing</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Connections where NGINX is writing the response back to the client</td></tr><tr><td>nginx_exporter_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which nginx_exporter was built, and the goos and goarch for the build.</td></tr><tr><td>nginx_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total http requests</td></tr><tr><td>nginx_up</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Status of the last metric scrape</td></tr><tr><td>plugins_active_instances</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of active plugin instances</td></tr><tr><td>plugins_datasource_instances_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>prometheus_api_remote_read_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of remote read queries being executed or waiting.</td></tr><tr><td>prometheus_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which prometheus was built, and the goos and goarch for the build.</td></tr><tr><td>prometheus_config_last_reload_success_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Timestamp of the last successful configuration reload.</td></tr><tr><td>prometheus_config_last_reload_successful</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether the last configuration reload attempt was successful.</td></tr><tr><td>prometheus_engine_queries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of queries being executed or waiting.</td></tr><tr><td>prometheus_engine_queries_concurrent_max</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The max number of concurrent queries.</td></tr><tr><td>prometheus_engine_query_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code>, <code>slice</code></td><td>Query timings</td></tr><tr><td>prometheus_engine_query_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>slice</code></td><td>N/A</td></tr><tr><td>prometheus_engine_query_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>slice</code></td><td>N/A</td></tr><tr><td>prometheus_engine_query_log_enabled</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>State of the query log.</td></tr><tr><td>prometheus_engine_query_log_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of query log failures.</td></tr><tr><td>prometheus_engine_query_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of samples loaded by all queries.</td></tr><tr><td>prometheus_http_request_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_request_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_request_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code>, <code>handler</code></td><td>Counter of HTTP requests.</td></tr><tr><td>prometheus_http_response_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_response_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_http_response_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>handler</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_alertmanagers_discovered</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alertmanagers discovered and active.</td></tr><tr><td>prometheus_notifications_dropped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of alerts dropped due to errors when sending to Alertmanager.</td></tr><tr><td>prometheus_notifications_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>Total number of errors sending alert notifications.</td></tr><tr><td>prometheus_notifications_latency_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Latency quantiles for sending alert notifications.</td></tr><tr><td>prometheus_notifications_latency_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_latency_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_notifications_queue_capacity</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The capacity of the alert notifications queue.</td></tr><tr><td>prometheus_notifications_queue_length</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of alert notifications in the queue.</td></tr><tr><td>prometheus_notifications_sent_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>alertmanager</code>, <code>job</code>, <code>cls</code></td><td>Total number of alerts sent.</td></tr><tr><td>prometheus_ready</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Whether Prometheus startup was fully completed and the server is ready for normal operation.</td></tr><tr><td>prometheus_remote_storage_exemplars_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Exemplars in to remote storage, compare to exemplars out for queue managers.</td></tr><tr><td>prometheus_remote_storage_highest_timestamp_in_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Highest timestamp that has come into the remote storage via the Appender interface, in seconds since epoch.</td></tr><tr><td>prometheus_remote_storage_histograms_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>HistogramSamples in to remote storage, compare to histograms out for queue managers.</td></tr><tr><td>prometheus_remote_storage_samples_in_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Samples in to remote storage, compare to samples out for queue managers.</td></tr><tr><td>prometheus_remote_storage_string_interner_zero_reference_releases_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times release has been called for strings that are not interned.</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration for a rule to execute.</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_evaluation_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_evaluation_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule evaluation failures.</td></tr><tr><td>prometheus_rule_evaluations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule evaluations.</td></tr><tr><td>prometheus_rule_group_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of rule group evaluations.</td></tr><tr><td>prometheus_rule_group_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_group_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_rule_group_interval_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The interval of a rule group.</td></tr><tr><td>prometheus_rule_group_iterations_missed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of rule group evaluations missed due to slow rule group evaluation.</td></tr><tr><td>prometheus_rule_group_iterations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The total number of scheduled rule group evaluations, whether executed or missed.</td></tr><tr><td>prometheus_rule_group_last_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The duration of the last rule group evaluation.</td></tr><tr><td>prometheus_rule_group_last_evaluation_samples</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The number of samples returned during the last rule group evaluation.</td></tr><tr><td>prometheus_rule_group_last_evaluation_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The timestamp of the last rule group evaluation in seconds.</td></tr><tr><td>prometheus_rule_group_rules</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>rule_group</code></td><td>The number of rules.</td></tr><tr><td>prometheus_sd_azure_cache_hit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of cache hit during refresh.</td></tr><tr><td>prometheus_sd_azure_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of Azure service discovery refresh failures.</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds</td><td>summary</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code>, <code>quantile</code></td><td>The duration of a Consul RPC call in seconds.</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds_count</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code></td><td>N/A</td></tr><tr><td>prometheus_sd_consul_rpc_duration_seconds_sum</td><td>Unknown</td><td><code>endpoint</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>call</code></td><td>N/A</td></tr><tr><td>prometheus_sd_consul_rpc_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Consul RPC call failures.</td></tr><tr><td>prometheus_sd_discovered_targets</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>config</code>, <code>job</code>, <code>cls</code></td><td>Current number of discovered targets.</td></tr><tr><td>prometheus_sd_dns_lookup_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of DNS-SD lookup failures.</td></tr><tr><td>prometheus_sd_dns_lookups_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of DNS-SD lookups.</td></tr><tr><td>prometheus_sd_failed_configs</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of service discovery configurations that failed to load.</td></tr><tr><td>prometheus_sd_file_mtime_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>filename</code>, <code>job</code>, <code>cls</code></td><td>Timestamp (mtime) of files read by FileSD. Timestamp is set at read time.</td></tr><tr><td>prometheus_sd_file_read_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of File-SD read errors.</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of the File-SD scan in seconds.</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_file_scan_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_file_watcher_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of File-SD errors caused by filesystem watch failures.</td></tr><tr><td>prometheus_sd_http_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of HTTP service discovery refresh failures.</td></tr><tr><td>prometheus_sd_kubernetes_events_total</td><td>counter</td><td><code>event</code>, <code>ins</code>, <code>instance</code>, <code>role</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kubernetes events handled.</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>The duration of a Kuma MADS fetch call.</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_kuma_fetch_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_sd_kuma_fetch_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kuma MADS fetch call failures.</td></tr><tr><td>prometheus_sd_kuma_fetch_skipped_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of Kuma MADS fetch calls that result in no updates to the targets.</td></tr><tr><td>prometheus_sd_linode_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of Linode service discovery refresh failures.</td></tr><tr><td>prometheus_sd_nomad_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of nomad service discovery refresh failures.</td></tr><tr><td>prometheus_sd_received_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of update events received from the SD providers.</td></tr><tr><td>prometheus_sd_updates_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of update events sent to the SD consumers.</td></tr><tr><td>prometheus_target_interval_length_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Actual intervals between scrapes.</td></tr><tr><td>prometheus_target_interval_length_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_interval_length_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>interval</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_metadata_cache_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes that are currently used for storing metric metadata in the cache</td></tr><tr><td>prometheus_target_metadata_cache_entries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of metric metadata entries in the cache</td></tr><tr><td>prometheus_target_scrape_pool_exceeded_label_limits_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times scrape pools hit the label limits, during sync or config reload.</td></tr><tr><td>prometheus_target_scrape_pool_exceeded_target_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of times scrape pools hit the target limit, during sync or config reload.</td></tr><tr><td>prometheus_target_scrape_pool_reloads_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of failed scrape pool reloads.</td></tr><tr><td>prometheus_target_scrape_pool_reloads_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool reloads.</td></tr><tr><td>prometheus_target_scrape_pool_sync_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of syncs that were executed on a scrape pool.</td></tr><tr><td>prometheus_target_scrape_pool_target_limit</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Maximum number of targets allowed in this scrape pool.</td></tr><tr><td>prometheus_target_scrape_pool_targets</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Current number of targets in this scrape pool.</td></tr><tr><td>prometheus_target_scrape_pools_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool creations that failed.</td></tr><tr><td>prometheus_target_scrape_pools_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrape pool creation attempts.</td></tr><tr><td>prometheus_target_scrapes_cache_flush_forced_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How many times a scrape cache was flushed due to getting big while scrapes are failing.</td></tr><tr><td>prometheus_target_scrapes_exceeded_body_size_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the body size limit</td></tr><tr><td>prometheus_target_scrapes_exceeded_native_histogram_bucket_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the native histogram bucket limit and were rejected.</td></tr><tr><td>prometheus_target_scrapes_exceeded_sample_limit_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of scrapes that hit the sample limit and were rejected.</td></tr><tr><td>prometheus_target_scrapes_exemplar_out_of_order_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of exemplar rejected due to not being out of the expected order.</td></tr><tr><td>prometheus_target_scrapes_sample_duplicate_timestamp_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to duplicate timestamps but different values.</td></tr><tr><td>prometheus_target_scrapes_sample_out_of_bounds_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to timestamp falling outside of the time bounds.</td></tr><tr><td>prometheus_target_scrapes_sample_out_of_order_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of samples rejected due to not being out of the expected order.</td></tr><tr><td>prometheus_target_sync_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>Total number of target sync failures.</td></tr><tr><td>prometheus_target_sync_length_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Actual interval to sync the scrape pool.</td></tr><tr><td>prometheus_target_sync_length_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_target_sync_length_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>scrape_job</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_template_text_expansion_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of template text expansion failures.</td></tr><tr><td>prometheus_template_text_expansions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of template text expansions.</td></tr><tr><td>prometheus_treecache_watcher_goroutines</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The current number of watcher goroutines.</td></tr><tr><td>prometheus_treecache_zookeeper_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The total number of ZooKeeper failures.</td></tr><tr><td>prometheus_tsdb_blocks_loaded</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of currently loaded data blocks</td></tr><tr><td>prometheus_tsdb_checkpoint_creations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint creations that failed.</td></tr><tr><td>prometheus_tsdb_checkpoint_creations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint creations attempted.</td></tr><tr><td>prometheus_tsdb_checkpoint_deletions_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint deletions that failed.</td></tr><tr><td>prometheus_tsdb_checkpoint_deletions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of checkpoint deletions attempted.</td></tr><tr><td>prometheus_tsdb_clean_start</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>-1: lockfile is disabled. 0: a lockfile from a previous execution was replaced. 1: lockfile creation was clean</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_range_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_samples_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_chunk_size_bytes_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_compaction_populating_block</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Set to 1 when a block is currently being written to the disk.</td></tr><tr><td>prometheus_tsdb_compactions_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions that failed for the partition.</td></tr><tr><td>prometheus_tsdb_compactions_skipped_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of skipped compactions due to disabled auto compaction.</td></tr><tr><td>prometheus_tsdb_compactions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions that were executed for the partition.</td></tr><tr><td>prometheus_tsdb_compactions_triggered_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of triggered compactions for the partition.</td></tr><tr><td>prometheus_tsdb_data_replay_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Time taken to replay the data on disk.</td></tr><tr><td>prometheus_tsdb_exemplar_exemplars_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended exemplars.</td></tr><tr><td>prometheus_tsdb_exemplar_exemplars_in_storage</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of exemplars currently in circular storage.</td></tr><tr><td>prometheus_tsdb_exemplar_last_exemplars_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The timestamp of the oldest exemplar stored in circular storage. Useful to check for what timerange the current exemplar buffer limit allows. This usually means the last timestampfor all exemplars for a typical setup. This is not true though if one of the series timestamp is in future compared to rest series.</td></tr><tr><td>prometheus_tsdb_exemplar_max_exemplars</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of exemplars the exemplar storage can store, resizeable.</td></tr><tr><td>prometheus_tsdb_exemplar_out_of_order_exemplars_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order exemplar ingestion failed attempts.</td></tr><tr><td>prometheus_tsdb_exemplar_series_with_exemplars_in_storage</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of series with exemplars currently in circular storage.</td></tr><tr><td>prometheus_tsdb_head_active_appenders</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of currently active appender transactions</td></tr><tr><td>prometheus_tsdb_head_chunks</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks in the head block.</td></tr><tr><td>prometheus_tsdb_head_chunks_created_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks created in the head</td></tr><tr><td>prometheus_tsdb_head_chunks_removed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks removed in the head</td></tr><tr><td>prometheus_tsdb_head_chunks_storage_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the chunks_head directory.</td></tr><tr><td>prometheus_tsdb_head_gc_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_head_gc_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_head_max_time</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum timestamp of the head block. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_head_max_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Maximum timestamp of the head block.</td></tr><tr><td>prometheus_tsdb_head_min_time</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Minimum time bound of the head block. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_head_min_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Minimum time bound of the head block.</td></tr><tr><td>prometheus_tsdb_head_out_of_order_samples_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended out of order samples.</td></tr><tr><td>prometheus_tsdb_head_samples_appended_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of appended samples.</td></tr><tr><td>prometheus_tsdb_head_series</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series in the head block.</td></tr><tr><td>prometheus_tsdb_head_series_created_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series created in the head</td></tr><tr><td>prometheus_tsdb_head_series_not_found_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of requests for series that were not found.</td></tr><tr><td>prometheus_tsdb_head_series_removed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of series removed in the head</td></tr><tr><td>prometheus_tsdb_head_truncations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of head truncations that failed.</td></tr><tr><td>prometheus_tsdb_head_truncations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of head truncations attempted.</td></tr><tr><td>prometheus_tsdb_isolation_high_watermark</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The highest TSDB append ID that has been given out.</td></tr><tr><td>prometheus_tsdb_isolation_low_watermark</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The lowest TSDB append ID that is still referenced.</td></tr><tr><td>prometheus_tsdb_lowest_timestamp</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Lowest timestamp value stored in the database. The unit is decided by the library consumer.</td></tr><tr><td>prometheus_tsdb_lowest_timestamp_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Lowest timestamp value stored in the database.</td></tr><tr><td>prometheus_tsdb_mmap_chunk_corruptions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of memory-mapped chunk corruptions.</td></tr><tr><td>prometheus_tsdb_mmap_chunks_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of chunks that were memory-mapped.</td></tr><tr><td>prometheus_tsdb_out_of_bound_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of bound samples ingestion failed attempts with out of order support disabled.</td></tr><tr><td>prometheus_tsdb_out_of_order_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order samples ingestion failed attempts due to out of order being disabled.</td></tr><tr><td>prometheus_tsdb_reloads_failures_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of times the database failed to reloadBlocks block data from disk.</td></tr><tr><td>prometheus_tsdb_reloads_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Number of times the database reloaded block data from disk.</td></tr><tr><td>prometheus_tsdb_retention_limit_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Max number of bytes to be retained in the tsdb blocks, configured 0 means disabled</td></tr><tr><td>prometheus_tsdb_retention_limit_seconds</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>How long to retain samples in storage.</td></tr><tr><td>prometheus_tsdb_size_retentions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times that blocks were deleted because the maximum number of bytes was exceeded.</td></tr><tr><td>prometheus_tsdb_snapshot_replay_error_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number snapshot replays that failed.</td></tr><tr><td>prometheus_tsdb_storage_blocks_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of bytes that are currently used for local storage by all blocks.</td></tr><tr><td>prometheus_tsdb_symbol_table_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of symbol table in memory for loaded blocks</td></tr><tr><td>prometheus_tsdb_time_retentions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of times that blocks were deleted because the maximum time limit was exceeded.</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_bucket</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>le</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_tombstone_cleanup_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_too_old_samples_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>type</code>, <code>job</code>, <code>cls</code></td><td>Total number of out of order samples ingestion failed attempts with out of support enabled, but sample outside of time window.</td></tr><tr><td>prometheus_tsdb_vertical_compactions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of compactions done on overlapping blocks.</td></tr><tr><td>prometheus_tsdb_wal_completed_pages_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of completed pages.</td></tr><tr><td>prometheus_tsdb_wal_corruptions_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of WAL corruptions.</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds</td><td>summary</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>quantile</code></td><td>Duration of write log fsync.</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_fsync_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_page_flushes_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of page flushes.</td></tr><tr><td>prometheus_tsdb_wal_segment_current</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Write log segment index that TSDB is currently writing to.</td></tr><tr><td>prometheus_tsdb_wal_storage_size_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Size of the write log directory.</td></tr><tr><td>prometheus_tsdb_wal_truncate_duration_seconds_count</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_truncate_duration_seconds_sum</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>prometheus_tsdb_wal_truncations_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log truncations that failed.</td></tr><tr><td>prometheus_tsdb_wal_truncations_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log truncations attempted.</td></tr><tr><td>prometheus_tsdb_wal_writes_failed_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of write log writes that failed.</td></tr><tr><td>prometheus_web_federation_errors_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of errors that occurred while sending federation responses.</td></tr><tr><td>prometheus_web_federation_warnings_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Total number of warnings that occurred while sending federation responses.</td></tr><tr><td>promhttp_metric_handler_requests_in_flight</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>Current number of scrapes being served.</td></tr><tr><td>promhttp_metric_handler_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code></td><td>Total number of scrapes by HTTP status code.</td></tr><tr><td>pushgateway_build_info</td><td>gauge</td><td><code>revision</code>, <code>version</code>, <code>ins</code>, <code>instance</code>, <code>ip</code>, <code>tags</code>, <code>goarch</code>, <code>goversion</code>, <code>job</code>, <code>cls</code>, <code>branch</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which pushgateway was built, and the goos and goarch for the build.</td></tr><tr><td>pushgateway_http_requests_total</td><td>counter</td><td><code>ins</code>, <code>instance</code>, <code>method</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>code</code>, <code>handler</code></td><td>Total HTTP requests processed by the Pushgateway, excluding scrapes.</td></tr><tr><td>querier_cache_added_new_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_added_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_entries</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>The total number of entries</td></tr><tr><td>querier_cache_evicted_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>reason</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_memory_bytes</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>The current cache size in bytes</td></tr><tr><td>querier_cache_misses_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>querier_cache_stale_gets_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cache</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>ring_member_heartbeats_total</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>ring_member_tokens_owned</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens owned in the ring.</td></tr><tr><td>ring_member_tokens_to_own</td><td>gauge</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>The number of tokens to own in the ring.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ins</code>, <code>instance</code>, <code>ip</code>, <code>job</code>, <code>cls</code></td><td>N/A</td></tr></tbody></table><hr><h2 id=ping-指标>PING 指标</h2><p><strong><code>PING</code></strong> 任务包含有 54 类可用监控指标，由 <code>blackbox_epxorter</code> 提供。</p><table><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>agent_up</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>probe_dns_lookup_time_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Returns the time taken for probe dns lookup in seconds</td></tr><tr><td>probe_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Returns how long the probe took to complete in seconds</td></tr><tr><td>probe_icmp_duration_seconds</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>phase</code>, <code>instance</code>, <code>cls</code></td><td>Duration of icmp request by phase</td></tr><tr><td>probe_icmp_reply_hop_limit</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Replied packet hop limit (TTL for ipv4)</td></tr><tr><td>probe_ip_addr_hash</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Specifies the hash of IP address. It&rsquo;s useful to detect if the IP address changes.</td></tr><tr><td>probe_ip_protocol</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Specifies whether probe ip protocol is IP4 or IP6</td></tr><tr><td>probe_success</td><td>gauge</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>Displays whether or not the probe was a success</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ins</code>, <code>ip</code>, <code>job</code>, <code>instance</code>, <code>cls</code></td><td>N/A</td></tr></tbody></table><hr><h2 id=push-指标>PUSH 指标</h2><p>PushGateway 提供 44 类监控指标。</p><table class=full-width><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>agent_up</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds</td><td>summary</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>quantile</code>, <code>ip</code></td><td>A summary of the pause duration of garbage collection cycles.</td></tr><tr><td>go_gc_duration_seconds_count</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_gc_duration_seconds_sum</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>go_goroutines</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of goroutines that currently exist.</td></tr><tr><td>go_info</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code>, <code>version</code></td><td>Information about the Go environment.</td></tr><tr><td>go_memstats_alloc_bytes</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_alloc_bytes_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of bytes allocated, even if freed.</td></tr><tr><td>go_memstats_buck_hash_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used by the profiling bucket hash table.</td></tr><tr><td>go_memstats_frees_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of frees.</td></tr><tr><td>go_memstats_gc_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for garbage collection system metadata.</td></tr><tr><td>go_memstats_heap_alloc_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes allocated and still in use.</td></tr><tr><td>go_memstats_heap_idle_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes waiting to be used.</td></tr><tr><td>go_memstats_heap_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes that are in use.</td></tr><tr><td>go_memstats_heap_objects</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of allocated objects.</td></tr><tr><td>go_memstats_heap_released_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes released to OS.</td></tr><tr><td>go_memstats_heap_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes obtained from system.</td></tr><tr><td>go_memstats_last_gc_time_seconds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of seconds since 1970 of last garbage collection.</td></tr><tr><td>go_memstats_lookups_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of pointer lookups.</td></tr><tr><td>go_memstats_mallocs_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total number of mallocs.</td></tr><tr><td>go_memstats_mcache_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by mcache structures.</td></tr><tr><td>go_memstats_mcache_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for mcache structures obtained from system.</td></tr><tr><td>go_memstats_mspan_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by mspan structures.</td></tr><tr><td>go_memstats_mspan_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for mspan structures obtained from system.</td></tr><tr><td>go_memstats_next_gc_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of heap bytes when next garbage collection will take place.</td></tr><tr><td>go_memstats_other_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes used for other system allocations.</td></tr><tr><td>go_memstats_stack_inuse_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes in use by the stack allocator.</td></tr><tr><td>go_memstats_stack_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes obtained from system for stack allocator.</td></tr><tr><td>go_memstats_sys_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of bytes obtained from system.</td></tr><tr><td>go_threads</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of OS threads created.</td></tr><tr><td>process_cpu_seconds_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total user and system CPU time spent in seconds.</td></tr><tr><td>process_max_fds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Maximum number of open file descriptors.</td></tr><tr><td>process_open_fds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Number of open file descriptors.</td></tr><tr><td>process_resident_memory_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Resident memory size in bytes.</td></tr><tr><td>process_start_time_seconds</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Start time of the process since unix epoch in seconds.</td></tr><tr><td>process_virtual_memory_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Virtual memory size in bytes.</td></tr><tr><td>process_virtual_memory_max_bytes</td><td>gauge</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Maximum amount of virtual memory available in bytes.</td></tr><tr><td>pushgateway_build_info</td><td>gauge</td><td><code>job</code>, <code>goversion</code>, <code>cls</code>, <code>branch</code>, <code>instance</code>, <code>tags</code>, <code>revision</code>, <code>goarch</code>, <code>ins</code>, <code>ip</code>, <code>version</code>, <code>goos</code></td><td>A metric with a constant &lsquo;1&rsquo; value labeled by version, revision, branch, goversion from which pushgateway was built, and the goos and goarch for the build.</td></tr><tr><td>pushgateway_http_requests_total</td><td>counter</td><td><code>job</code>, <code>cls</code>, <code>method</code>, <code>code</code>, <code>handler</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>Total HTTP requests processed by the Pushgateway, excluding scrapes.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code>, <code>ip</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-00fcc0891b8e51b39a5b93b6e89a421f>6 - 常见问题</h1><div class=lead>Pigsty INFRA 基础设施模块常见问题答疑</div><hr><h2 id=infra-模块中包含了哪些组件>INFRA 模块中包含了哪些组件？</h2><ul><li><strong>Ansible</strong>：用于自动化配置、部署和日常运维。</li><li><strong>Nginx</strong>：对外暴露 Grafana、VictoriaMetrics（VMUI）、Alertmanager 等 WebUI，并托管本地 YUM/APT 仓库。</li><li><strong>自签名 CA</strong>：为 Nginx、Patroni、pgBackRest 等组件签发 SSL/TLS 证书。</li><li><strong>VictoriaMetrics 套件</strong>：替代 Prometheus/Loki，包含 VictoriaMetrics（TSDB）、VMAlert（告警评估）、VictoriaLogs（集中日志）、VictoriaTraces（链路追踪）。</li><li><strong>Vector</strong>：节点侧日志采集器，负责将系统/数据库日志推送至 VictoriaLogs。</li><li><strong>AlertManager</strong>：聚合并分发告警通知。</li><li><strong>Grafana</strong>：监控/可视化平台，预置大量仪表板和数据源。</li><li><strong>Chronyd</strong>：提供 NTP 时间同步。</li><li><strong>DNSMasq</strong>：提供 DNS 注册与解析。</li><li><strong>ETCD</strong>：作为 PostgreSQL 高可用 DCS（亦可在专用集群部署）。</li><li><strong>PostgreSQL</strong>：在管理节点上充当 CMDB（可选）。</li><li><strong>Docker</strong>：在节点上运行无状态工具或应用（可选）。</li></ul><hr><h2 id=如何重新向-victoriametrics-注册监控目标>如何重新向 VictoriaMetrics 注册监控目标？</h2><p>VictoriaMetrics 通过 <code>/infra/targets/&lt;job>/*.yml</code> 目录进行静态服务发现。如果目标文件被误删，可使用如下命令重新注册：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml  -t infra_register   <span style=color:#8f5902;font-style:italic># 重新渲染 infra 自监控目标</span>
</span></span><span style=display:flex><span>./node.yml   -t node_register    <span style=color:#8f5902;font-style:italic># 重新渲染节点 / HAProxy / Vector 目标</span>
</span></span><span style=display:flex><span>./etcd.yml   -t etcd_register    <span style=color:#8f5902;font-style:italic># 重新渲染 etcd 目标</span>
</span></span><span style=display:flex><span>./minio.yml  -t minio_register   <span style=color:#8f5902;font-style:italic># 重新渲染 MinIO 目标</span>
</span></span><span style=display:flex><span>./pgsql.yml  -t pg_register      <span style=color:#8f5902;font-style:italic># 重新渲染 PGSQL/Patroni 目标</span>
</span></span><span style=display:flex><span>./redis.yml  -t redis_register   <span style=color:#8f5902;font-style:italic># 重新渲染 Redis 目标</span>
</span></span></code></pre></div><p>其他模块（如 <code>pg_monitor.yml</code>、<code>mongo.yml</code>、<code>mysql.yml</code>）也提供了对应的 <code>*_register</code> 标签，可按需执行。</p><hr><h2 id=如何重新向-grafana-注册-postgresql-数据源>如何重新向 Grafana 注册 PostgreSQL 数据源？</h2><p>在 <a href=/docs/pgsql/param#pg_databases><code>pg_databases</code></a> 中定义的 PGSQL 数据库默认会被注册为 Grafana 数据源（以供 PGCAT 应用使用）。</p><p>如果你不小心删除了在 Grafana 中注册的 postgres 数据源，你可以使用以下命令再次注册它们：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 将所有（在 pg_databases 中定义的） pgsql 数据库注册为 grafana 数据源</span>
</span></span><span style=display:flex><span>./pgsql.yml -t add_ds
</span></span></code></pre></div><hr><h2 id=如何重新向-nginx-注册节点的-haproxy-管控界面>如何重新向 Nginx 注册节点的 Haproxy 管控界面？</h2><p>如果你不小心删除了 <code>/etc/nginx/conf.d/haproxy</code> 中的已注册 haproxy 代理设置，你可以使用以下命令再次恢复它们：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t register_nginx     <span style=color:#8f5902;font-style:italic># 在 infra 节点上向 nginx 注册所有 haproxy 管理页面的代理设置</span>
</span></span></code></pre></div><hr><h2 id=如何恢复-dnsmasq-中的域名注册记录>如何恢复 DNSMASQ 中的域名注册记录？</h2><p>PGSQL 集群/实例域名默认注册到 infra 节点的 <code>/etc/hosts.d/&lt;name></code>。你可以使用以下命令再次恢复它们：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t pg_dns    <span style=color:#8f5902;font-style:italic># 在 infra 节点上向 dnsmasq 注册 pg 的 DNS 名称</span>
</span></span></code></pre></div><hr><h2 id=如何使用nginx对外暴露新的上游服务>如何使用Nginx对外暴露新的上游服务？</h2><p>尽管您可以直接通过 IP:Port 的方式访问服务，但我们依然建议收敛访问入口，使用域名并统一从 Nginx 代理访问各类带有 Web 界面的服务。
这样有利于统一收口访问，减少暴露的端口，便于进行访问控制与审计。</p><p>如果你希望通过 Nginx 门户公开新的 WebUI 服务，你可以将服务定义添加到 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 参数中。
例如，下面是 Pigsty 官方 Demo 使用的 Infra 门户配置，对外暴露了几种额外的服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>home.pigsty.cc }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: demo.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmalert      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8880&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 新增的 Web 门户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>postgrest    </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: api.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8884&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgadmin      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgweb        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: cli.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8886&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bytebase     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: ddl.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8887&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>gitea        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: git.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8889&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wiki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: wiki.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9002&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>noco         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: noco.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9003&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>完成 Nginx 上游服务定义后，使用以下配置与命令，向 Nginx 注册新的服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_config           <span style=color:#8f5902;font-style:italic># 重新生成 Nginx 配置文件</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_launch           <span style=color:#8f5902;font-style:italic># 更新并应用 Nginx 配置。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 您也可以使用 Ansible 手工重载 Nginx 配置</span>
</span></span><span style=display:flex><span>ansible infra -b -a <span style=color:#4e9a06>&#39;nginx -s reload&#39;</span>  <span style=color:#8f5902;font-style:italic># 重载Nginx配置</span>
</span></span></code></pre></div><p>如果你希望通过 HTTPS 访问，你必须删除 <code>files/pki/csr/pigsty.csr</code> 和 <code>files/pki/nginx/pigsty.{key,crt}</code> 以强制重新生成 Nginx SSL/TLS 证书以包括新上游的域名。
如果您希望使用权威机构签发的 SSL 证书，而不是 Pigsty 自签名 CA 颁发的证书，可以将其放置于 <code>/etc/nginx/conf.d/cert/</code> 目录中并修改相应配置：<code>/etc/nginx/conf.d/&lt;name>.conf</code>。</p><hr><h2 id=如何手动向节点添加上游仓库的repo文件>如何手动向节点添加上游仓库的Repo文件？</h2><p>Pigsty 有一个内置的包装脚本 <code>bin/repo-add</code>，它将调用 ansible 剧本 <code>node.yml</code> 来将 repo 文件添加到相应的节点。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/repo-add &lt;selector&gt; <span style=color:#ce5c00;font-weight:700>[</span>modules<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>bin/repo-add 10.10.10.10           <span style=color:#8f5902;font-style:italic># 为节点 10.10.10.10 添加 node 源</span>
</span></span><span style=display:flex><span>bin/repo-add infra   node,infra    <span style=color:#8f5902;font-style:italic># 为 infra 分组添加 node 和 infra 源</span>
</span></span><span style=display:flex><span>bin/repo-add infra   node,local    <span style=color:#8f5902;font-style:italic># 为 infra 分组添加节点仓库和本地pigsty源</span>
</span></span><span style=display:flex><span>bin/repo-add pg-test node,pgsql    <span style=color:#8f5902;font-style:italic># 为 pg-test 分组添加 node 和 pgsql 源</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-534bd7b2a1b7fa250e24342de3f0e5b1>7 - 管理预案</h1><div class=lead>基础设施组件与 Infra 集群管理 SOP：创建，销毁，扩容，缩容，证书，仓库……</div><p>本章节介绍 Pigsty 部署的日常管理和运维操作。</p></div><div class=td-content><h1 id=pg-52d708085244eb9d51e81dd9e7c10996>7.1 - Nginx 管理</h1><div class=lead>Nginx 管理，Web 门户配置，Web Server，暴露上游服务</div><p>Pigsty 在 INFRA 节点上安装 Nginx 作为所有 Web 服务的入口，默认监听在 80/443 标准端口上。</p><p>在 Pigsty 中，你可以通过修改配置清单，让 nginx 对外提供多种服务：</p><ul><li>对外暴露 Grafana、VictoriaMetrics（VMUI）、Alertmanager、VictoriaLogs 等监控组件的 Web 界面</li><li>提供静态文件服务（如软件仓库、文档站，网站等）</li><li>代理自定义的应用服务（如内部应用、数据库管理界面，Docker 应用的界面等）</li><li>自动签发自签名的 HTTPS 证书，或者使用 certbot 申请免费的 Let&rsquo;s Encrypt 证书</li><li>通过不同的子域名，使用单一端口对外暴露服务</li></ul><hr><h2 id=基础配置>基础配置</h2><p>您可以通过 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 参数定制 Nginx 的行为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>infra_portal</code> 是一个字典，每个键定义一个服务，值为服务的配置选项。
只有定义了 <code>domain</code> 的服务才会生成对应的 Nginx 配置文件。</p><ul><li><strong><code>home</code></strong>：特殊的默认服务器，用于处理首页和内置监控组件的反向代理</li><li><strong>代理服务</strong>：通过 <code>endpoint</code> 指定上游服务地址，进行反向代理</li><li><strong>静态服务</strong>：通过 <code>path</code> 指定本地目录，提供静态文件服务</li></ul><hr><h2 id=服务器参数>服务器参数</h2><h3 id=基本参数>基本参数</h3><table class=full-width><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>domain</code></td><td>可选的代理域名</td></tr><tr><td><code>endpoint</code></td><td>上游服务地址（IP:PORT 或 socket）</td></tr><tr><td><code>path</code></td><td>静态内容的本地目录</td></tr><tr><td><code>scheme</code></td><td>协议类型（http/https），默认 http</td></tr><tr><td><code>domains</code></td><td>额外的域名列表（别名）</td></tr></tbody></table><h3 id=ssltls-选项>SSL/TLS 选项</h3><table class=full-width><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>certbot</code></td><td>启用 Let&rsquo;s Encrypt 证书管理，值为证书名称</td></tr><tr><td><code>cert</code></td><td>自定义证书文件路径</td></tr><tr><td><code>key</code></td><td>自定义私钥文件路径</td></tr><tr><td><code>enforce_https</code></td><td>强制跳转 HTTPS（301 重定向）</td></tr></tbody></table><h3 id=高级设置>高级设置</h3><table class=full-width><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>config</code></td><td>自定义 Nginx 配置片段</td></tr><tr><td><code>index</code></td><td>启用目录列表（用于静态服务）</td></tr><tr><td><code>log</code></td><td>自定义日志文件名称</td></tr><tr><td><code>websocket</code></td><td>启用 WebSocket 支持</td></tr><tr><td><code>auth</code></td><td>启用 Basic Auth 认证</td></tr><tr><td><code>realm</code></td><td>Basic Auth 认证提示语</td></tr></tbody></table><hr><h2 id=配置示例>配置示例</h2><h3 id=反向代理服务>反向代理服务</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgadmin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=静态文件与目录列表>静态文件与目录列表</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: repo.pigsty.cc, path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/repo&#34;</span><span style=color:#204a87;font-weight:700>, index</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=自定义-ssl-证书>自定义 SSL 证书</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>secure_app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>secure.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8443&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>cert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/etc/ssl/certs/custom.crt&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/etc/ssl/private/custom.key&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=使用-lets-encrypt-证书>使用 Let&rsquo;s Encrypt 证书</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>demo.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.demo   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 证书名称，多个域名可共用同一证书</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=强制-https-跳转>强制 HTTPS 跳转</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>web.io</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>en.pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/web.io&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.doc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>enforce_https</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=自定义配置片段>自定义配置片段</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>web.cc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.cc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/web.cc&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>domains</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>zh.pigsty.cc ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.doc</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # rewrite /zh/ to /
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        location /zh/ {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            rewrite ^/zh/(.*)$ /$1 permanent;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=管理命令>管理命令</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># 完整重新配置 Nginx</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config    <span style=color:#8f5902;font-style:italic># 重新生成配置文件</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_launch    <span style=color:#8f5902;font-style:italic># 重启 Nginx 服务</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_cert      <span style=color:#8f5902;font-style:italic># 重新生成 SSL 证书</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_certbot   <span style=color:#8f5902;font-style:italic># 使用 certbot 签发证书</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_reload    <span style=color:#8f5902;font-style:italic># 重新加载 Nginx 配置</span>
</span></span></code></pre></div><hr><h2 id=域名解析>域名解析</h2><p>有三种方式将域名解析到 Pigsty 服务器：</p><ol><li><strong>公网域名</strong>：通过 DNS 服务商配置</li><li><strong>内网 DNS 服务器</strong>：配置内部 DNS 解析</li><li><strong>本地 hosts 文件</strong>：修改 <code>/etc/hosts</code></li></ol><p>本地开发时，在 <code>/etc/hosts</code> 中添加：</p><pre tabindex=0><code>&lt;your_public_ip_address&gt; i.pigsty g.pigsty p.pigsty a.pigsty
</code></pre><p>Pigsty 内置了 dnsmasq 服务，可以通过 <a href=/docs/infra/param#dns_records><code>dns_records</code></a> 参数配置内部 DNS 解析。</p><hr><h2 id=https-配置>HTTPS 配置</h2><p>通过 <a href=/docs/infra/param#nginx_sslmode><code>nginx_sslmode</code></a> 参数配置 HTTPS：</p><table class=full-width><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td><code>disable</code></td><td>仅监听 HTTP（<code>nginx_port</code>）</td></tr><tr><td><code>enable</code></td><td>同时监听 HTTPS（<code>nginx_ssl_port</code>），默认签发自签名证书</td></tr><tr><td><code>enforce</code></td><td>强制跳转到 HTTPS，所有 80 端口请求都会 301 重定向</td></tr></tbody></table><p>对于自签名证书，有以下几种访问方式：</p><ul><li>在浏览器中信任自签名 CA（下载地址 <code>http://&lt;ip>/ca.crt</code>）</li><li>使用浏览器安全绕过（Chrome 中输入 &ldquo;thisisunsafe&rdquo;）</li><li>为生产环境配置正规 CA 签发的证书或使用 Let&rsquo;s Encrypt</li></ul><hr><h2 id=certbot-证书>Certbot 证书</h2><p>Pigsty 支持使用 Certbot 申请免费的 Let&rsquo;s Encrypt 证书。</p><h3 id=启用-certbot>启用 Certbot</h3><ol><li>在 <code>infra_portal</code> 中为服务添加 <code>certbot</code> 参数，指定证书名称</li><li>配置 <a href=/docs/infra/param#certbot_email><code>certbot_email</code></a> 为有效的邮箱地址</li><li>设置 <a href=/docs/infra/param#certbot_sign><code>certbot_sign</code></a> 为 <code>true</code> 在部署时自动签发</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>certbot_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=手动签发证书>手动签发证书</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_certbot   <span style=color:#8f5902;font-style:italic># 签发 Let&#39;s Encrypt 证书</span>
</span></span></code></pre></div><p>或直接运行服务器上的脚本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/nginx/sign-cert           <span style=color:#8f5902;font-style:italic># 签发证书</span>
</span></span><span style=display:flex><span>/etc/nginx/link-cert           <span style=color:#8f5902;font-style:italic># 链接证书到 Nginx 配置目录</span>
</span></span></code></pre></div><p>更多信息，请参阅 <a href=/docs/infra/admin/cert>Certbot：申请与更新 HTTPS 证书</a></p><hr><h2 id=默认首页>默认首页</h2><p>Pigsty 的默认首页 <code>home</code> 服务器提供以下内置路由：</p><table class=full-width><thead><tr><th>路径</th><th>说明</th></tr></thead><tbody><tr><td><code>/</code></td><td>首页导航</td></tr><tr><td><code>/zh</code></td><td>中文首页</td></tr><tr><td><code>/ui/</code></td><td>Grafana 监控面板</td></tr><tr><td><code>/vmetrics/</code></td><td>VictoriaMetrics VMUI</td></tr><tr><td><code>/vlogs/</code></td><td>VictoriaLogs 日志查询</td></tr><tr><td><code>/vtraces/</code></td><td>VictoriaTraces 链路追踪</td></tr><tr><td><code>/vmalert/</code></td><td>VMAlert 告警规则</td></tr><tr><td><code>/alertmgr/</code></td><td>AlertManager 告警管理</td></tr><tr><td><code>/blackbox/</code></td><td>Blackbox Exporter</td></tr><tr><td><code>/pev</code></td><td>PostgreSQL Explain 可视化工具</td></tr><tr><td><code>/haproxy/&lt;cluster>/</code></td><td>HAProxy 管理界面（如有）</td></tr></tbody></table><p>这些路由允许通过单一入口访问所有监控组件，无需配置多个域名。</p><hr><h2 id=最佳实践>最佳实践</h2><ul><li>使用域名而非 IP:PORT 访问服务</li><li>正确配置 DNS 解析或 hosts 文件</li><li>为实时应用启用 WebSocket（如 Grafana、Jupyter）</li><li>生产环境启用 HTTPS</li><li>使用有意义的子域名组织服务</li><li>监控 Let&rsquo;s Encrypt 证书过期时间</li><li>利用 <code>config</code> 参数添加自定义 Nginx 配置</li></ul><hr><h2 id=完整示例>完整示例</h2><p>以下是 Pigsty 公开演示站点 <a href=https://demo.pigsty.cc>demo.pigsty.cc</a> 使用的 Nginx 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>cc           </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: pigsty.cc      ,path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/www/pigsty.cc&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,cert: /etc/cert/pigsty.cc.crt ,key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/cert/pigsty.cc.key }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty.cc    ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>postgrest    </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: api.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8884&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgadmin      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgweb        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: cli.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8886&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bytebase     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: ddl.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8887&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>jupyter      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: lab.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>gitea        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: git.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8889&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wiki         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: wiki.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9002&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>noco         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: noco.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9003&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>supa         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: supa.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>dify         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: dify.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>odoo         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: odoo.pigsty.cc ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8069&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>mm           </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: mm.pigsty.cc   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8065&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3e5c80de91c09afe274f784b52a45287>7.2 - 软件仓库</h1><div class=lead>管理本地 APT/YUM 软件仓库</div><p>Pigsty 支持创建和管理本地 APT/YUM 软件仓库，用于在离线环境中部署或加速软件包安装。</p><hr><h2 id=快速开始>快速开始</h2><p>向本地仓库添加软件包：</p><ol><li>将软件包添加到 <a href=/docs/infra/param#repo_packages><code>repo_packages</code></a>（默认软件包）</li><li>将软件包添加到 <a href=/docs/infra/param#repo_extra_packages><code>repo_extra_packages</code></a>（额外软件包）</li><li>执行构建命令：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_build   <span style=color:#8f5902;font-style:italic># 从上游构建本地仓库</span>
</span></span><span style=display:flex><span>./node.yml -t node_repo     <span style=color:#8f5902;font-style:italic># 刷新节点仓库缓存</span>
</span></span></code></pre></div><hr><h2 id=软件包别名>软件包别名</h2><p>Pigsty 预定义了常用的软件包组合，方便批量安装：</p><h3 id=el-系统rhelcentosrocky>EL 系统（RHEL/CentOS/Rocky）</h3><table class=full-width><thead><tr><th>别名</th><th>说明</th></tr></thead><tbody><tr><td><code>node-bootstrap</code></td><td>Ansible、Python3 工具、SSH 相关</td></tr><tr><td><code>infra-package</code></td><td>Nginx、etcd、HAProxy、监控导出器、MinIO 等</td></tr><tr><td><code>pgsql-utility</code></td><td>Patroni、pgBouncer、pgBackRest、PG 工具</td></tr><tr><td><code>pgsql</code></td><td>完整 PostgreSQL（服务端、客户端、扩展）</td></tr><tr><td><code>pgsql-mini</code></td><td>最小化 PostgreSQL 安装</td></tr></tbody></table><h3 id=debianubuntu-系统>Debian/Ubuntu 系统</h3><table class=full-width><thead><tr><th>别名</th><th>说明</th></tr></thead><tbody><tr><td><code>node-bootstrap</code></td><td>Ansible、开发工具</td></tr><tr><td><code>infra-package</code></td><td>基础设施组件（使用 Debian 命名规范）</td></tr><tr><td><code>pgsql-client</code></td><td>PostgreSQL 客户端</td></tr><tr><td><code>pgsql-server</code></td><td>PostgreSQL 服务端及相关包</td></tr></tbody></table><hr><h2 id=剧本任务>剧本任务</h2><h3 id=主要任务>主要任务</h3><table class=full-width><thead><tr><th>任务</th><th>说明</th></tr></thead><tbody><tr><td><code>repo</code></td><td>从互联网或离线包创建本地仓库</td></tr><tr><td><code>repo_build</code></td><td>如不存在则从上游构建</td></tr><tr><td><code>repo_upstream</code></td><td>添加上游仓库文件</td></tr><tr><td><code>repo_pkg</code></td><td>下载软件包及依赖</td></tr><tr><td><code>repo_create</code></td><td>创建/更新 YUM 或 APT 仓库</td></tr><tr><td><code>repo_nginx</code></td><td>启动 Nginx 文件服务器</td></tr></tbody></table><h3 id=完整任务列表>完整任务列表</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># 创建本地软件仓库目录</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># 检查本地仓库是否存在</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># 直接使用已有仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># 从上游构建仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># 添加上游仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_remove       <span style=color:#8f5902;font-style:italic># 删除现有仓库文件</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_add          <span style=color:#8f5902;font-style:italic># 添加仓库到系统目录</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># 从互联网下载包</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_cache        <span style=color:#8f5902;font-style:italic># 创建元数据缓存</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># 安装引导包</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># 下载包及依赖</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># 创建本地仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_use          <span style=color:#8f5902;font-style:italic># 添加新建仓库到系统</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># 启动 Nginx 文件服务器</span>
</span></span></code></pre></div><hr><h2 id=常用操作>常用操作</h2><h3 id=添加新软件包>添加新软件包</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 配置上游仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 下载软件包及依赖</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 构建本地仓库元数据</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create
</span></span></code></pre></div><h3 id=刷新节点仓库>刷新节点仓库</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -t node_repo    <span style=color:#8f5902;font-style:italic># 刷新所有节点的仓库缓存</span>
</span></span></code></pre></div><h3 id=完整重建仓库>完整重建仓库</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo        <span style=color:#8f5902;font-style:italic># 从互联网或离线包创建仓库</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-11e76a7fd5b13e8b9ed2ffe665bd1146>7.3 - 域名管理</h1><div class=lead>配置本地或公网域名访问 Pigsty 服务</div><p>使用域名代替 IP 地址访问 Pigsty 的各项 Web 服务。</p><hr><h2 id=快速开始>快速开始</h2><p>将以下静态解析记录添加到 <code>/etc/hosts</code>：</p><pre tabindex=0><code>10.10.10.10 i.pigsty g.pigsty p.pigsty a.pigsty
</code></pre><p>将 IP 地址替换为实际 Pigsty 节点的 IP。</p><hr><h2 id=为什么使用域名>为什么使用域名</h2><ul><li>比 IP 地址更易于记忆</li><li>灵活指向不同 IP</li><li>通过 Nginx 统一管理服务</li><li>支持 HTTPS 加密</li><li>防止某些地区的 ISP 劫持</li><li>允许通过代理访问内部绑定的服务</li></ul><hr><h2 id=dns-机制>DNS 机制</h2><p><strong>DNS 协议</strong>：将域名解析为 IP 地址。多个域名可以指向同一个 IP。</p><p><strong>HTTP 协议</strong>：使用 Host 头将请求路由到同一端口（80/443）上的不同站点。</p><hr><h2 id=默认域名>默认域名</h2><p>Pigsty 预定义了以下默认域名：</p><table class=full-width><thead><tr><th>域名</th><th>服务</th><th>端口</th><th>用途</th></tr></thead><tbody><tr><td><code>i.pigsty</code></td><td>Nginx</td><td>80/443</td><td>默认首页、本地仓库与统一入口</td></tr><tr><td><code>g.pigsty</code></td><td>Grafana</td><td>3000</td><td>监控与可视化</td></tr><tr><td><code>p.pigsty</code></td><td>VictoriaMetrics</td><td>8428</td><td>VMUI/PromQL 入口</td></tr><tr><td><code>a.pigsty</code></td><td>AlertManager</td><td>9059</td><td>告警路由</td></tr><tr><td><code>m.pigsty</code></td><td>MinIO</td><td>9001</td><td>对象存储控制台</td></tr></tbody></table><hr><h2 id=解析方式>解析方式</h2><h3 id=本地静态解析>本地静态解析</h3><p>在客户端机器的 <code>/etc/hosts</code> 中添加条目：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Linux/macOS</span>
</span></span><span style=display:flex><span>sudo vim /etc/hosts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Windows</span>
</span></span><span style=display:flex><span>notepad C:<span style=color:#4e9a06>\W</span>indows<span style=color:#4e9a06>\S</span>ystem32<span style=color:#4e9a06>\d</span>rivers<span style=color:#4e9a06>\e</span>tc<span style=color:#4e9a06>\h</span>osts
</span></span></code></pre></div><p>添加内容：</p><pre tabindex=0><code>10.10.10.10 i.pigsty g.pigsty p.pigsty a.pigsty m.pigsty
</code></pre><h3 id=内网动态解析>内网动态解析</h3><p>Pigsty 内置了 dnsmasq 服务作为内网 DNS 服务器。配置被管理的节点使用 INFRA 节点作为 DNS 服务器：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;${admin_ip}&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 使用 INFRA 节点作为 DNS 服务器</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>add               </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 将其添加到现有 DNS 服务器列表</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>通过 <a href=/docs/infra/param#dns_records><code>dns_records</code></a> 参数配置 dnsmasq 解析的域名记录：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=公网域名>公网域名</h3><p>购买域名并添加 DNS A 记录指向公网 IP：</p><ol><li>在域名服务商处购买域名（如 <code>example.com</code>）</li><li>配置 A 记录指向服务器公网 IP</li><li>在 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 中使用真实域名</li></ol><hr><h2 id=内置-dns-服务>内置 DNS 服务</h2><p>Pigsty 在 INFRA 节点上运行 dnsmasq 作为 DNS 服务器。</p><h3 id=相关参数>相关参数</h3><table class=full-width><thead><tr><th>参数</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><a href=/docs/infra/param#dns_enabled><code>dns_enabled</code></a></td><td><code>true</code></td><td>是否启用 DNS 服务</td></tr><tr><td><a href=/docs/infra/param#dns_port><code>dns_port</code></a></td><td><code>53</code></td><td>DNS 监听端口</td></tr><tr><td><a href=/docs/infra/param#dns_records><code>dns_records</code></a></td><td>见下文</td><td>默认 DNS 记录列表</td></tr></tbody></table><p>默认的 DNS 记录：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>dns_records</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} m.pigsty supa.pigsty api.pigsty adm.pigsty cli.pigsty ddl.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=动态-dns-注册>动态 DNS 注册</h3><p>Pigsty 会自动为 PostgreSQL 集群和实例注册 DNS 记录：</p><ul><li><strong>实例级 DNS</strong>：<code>&lt;pg_instance></code> 指向实例 IP（如 <code>pg-meta-1</code>）</li><li><strong>集群级 DNS</strong>：<code>&lt;pg_cluster></code> 指向主库 IP 或 VIP（如 <code>pg-meta</code>）</li></ul><p>集群级 DNS 目标由 <a href=/docs/pgsql/param#pg_dns_target><code>pg_dns_target</code></a> 参数控制：</p><table class=full-width><thead><tr><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>auto</code></td><td>自动选择：有 VIP 用 VIP，否则用主库 IP</td></tr><tr><td><code>primary</code></td><td>始终指向主库 IP</td></tr><tr><td><code>vip</code></td><td>始终指向 VIP（需启用 VIP）</td></tr><tr><td><code>none</code></td><td>不注册集群 DNS</td></tr><tr><td><code>&lt;ip></code></td><td>指定固定 IP 地址</td></tr></tbody></table><p>通过 <a href=/docs/pgsql/param#pg_dns_suffix><code>pg_dns_suffix</code></a> 可为集群 DNS 添加后缀。</p><hr><h2 id=节点-dns-配置>节点 DNS 配置</h2><p>Pigsty 管理被纳管节点的 DNS 配置。</p><h3 id=静态-hosts-记录>静态 hosts 记录</h3><p>通过 <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a> 配置静态 <code>/etc/hosts</code> 记录：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} i.pigsty&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;${admin_ip} sss.pigsty&#34;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 可选：MinIO S3 接入域名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#34;10.10.10.20 db.example.com&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=dns-服务器配置>DNS 服务器配置</h3><table class=full-width><thead><tr><th>参数</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_dns_method><code>node_dns_method</code></a></td><td><code>add</code></td><td>DNS 配置方式</td></tr><tr><td><a href=/docs/node/param#node_dns_servers><code>node_dns_servers</code></a></td><td><code>['${admin_ip}']</code></td><td>DNS 服务器列表</td></tr><tr><td><a href=/docs/node/param#node_dns_options><code>node_dns_options</code></a></td><td>见下文</td><td>resolv.conf 选项</td></tr></tbody></table><p><code>node_dns_method</code> 可选值：</p><table class=full-width><thead><tr><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>add</code></td><td>添加到现有 DNS 服务器列表前面</td></tr><tr><td><code>overwrite</code></td><td>完全覆盖 DNS 服务器配置</td></tr><tr><td><code>none</code></td><td>不修改 DNS 配置</td></tr></tbody></table><p>默认的 DNS 选项：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_dns_options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>options single-request-reopen timeout:1</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=https-证书>HTTPS 证书</h2><p>Pigsty 默认使用自签名证书。可选方案包括：</p><ul><li>忽略警告，使用 HTTP</li><li>信任自签名 CA 证书（下载地址 <code>http://&lt;ip>/ca.crt</code>）</li><li>使用真实 CA 或通过 Certbot 获取免费公网域名证书</li></ul><p>详见 <a href=/docs/infra/admin/cert/>CA 与证书</a> 文档。</p><hr><h2 id=扩展域名>扩展域名</h2><p>Pigsty 扩展预留了以下域名用于各种应用服务：</p><table class=full-width><thead><tr><th>域名</th><th>用途</th></tr></thead><tbody><tr><td><code>adm.pigsty</code></td><td>PgAdmin 管理界面</td></tr><tr><td><code>ddl.pigsty</code></td><td>Bytebase DDL 管理</td></tr><tr><td><code>cli.pigsty</code></td><td>PgWeb 命令行界面</td></tr><tr><td><code>api.pigsty</code></td><td>PostgREST API 服务</td></tr><tr><td><code>lab.pigsty</code></td><td>Jupyter 实验环境</td></tr><tr><td><code>git.pigsty</code></td><td>Gitea Git 服务</td></tr><tr><td><code>wiki.pigsty</code></td><td>Wiki.js 文档</td></tr><tr><td><code>noco.pigsty</code></td><td>NocoDB</td></tr><tr><td><code>supa.pigsty</code></td><td>Supabase</td></tr><tr><td><code>dify.pigsty</code></td><td>Dify AI</td></tr><tr><td><code>odoo.pigsty</code></td><td>Odoo ERP</td></tr><tr><td><code>mm.pigsty</code></td><td>Mattermost</td></tr></tbody></table><p>使用这些域名需要在 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 中配置相应的服务。</p><hr><h2 id=管理命令>管理命令</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t dns            <span style=color:#8f5902;font-style:italic># 完整配置 DNS 服务</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_config     <span style=color:#8f5902;font-style:italic># 重新生成 dnsmasq 配置</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_record     <span style=color:#8f5902;font-style:italic># 更新默认 DNS 记录</span>
</span></span><span style=display:flex><span>./infra.yml -t dns_launch     <span style=color:#8f5902;font-style:italic># 重启 dnsmasq 服务</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./node.yml -t node_hosts      <span style=color:#8f5902;font-style:italic># 配置节点 /etc/hosts</span>
</span></span><span style=display:flex><span>./node.yml -t node_resolv     <span style=color:#8f5902;font-style:italic># 配置节点 DNS 解析器</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns         <span style=color:#8f5902;font-style:italic># 注册 PostgreSQL DNS 记录</span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns_ins     <span style=color:#8f5902;font-style:italic># 仅注册实例级 DNS</span>
</span></span><span style=display:flex><span>./pgsql.yml -t pg_dns_cls     <span style=color:#8f5902;font-style:italic># 仅注册集群级 DNS</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-99138bcc6d2f367b6fb7df8b7a59e131>7.4 - 模块管理</h1><div class=lead>Infra 模块本身的管理 SOP：定义，创建，销毁，扩容，缩容</div><p>本文介绍 INFRA 模块的日常管理操作，包括安装、卸载、扩容、以及各组件的管理维护。</p><hr><h2 id=安装-infra-模块>安装 Infra 模块</h2><p>使用 <a href=/docs/infra/playbook/#infrayml><code>infra.yml</code></a> 剧本在 <code>infra</code> 分组上安装 INFRA 模块：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml     <span style=color:#8f5902;font-style:italic># 在 infra 分组上安装 INFRA 模块</span>
</span></span></code></pre></div><hr><h2 id=卸载-infra-模块>卸载 Infra 模块</h2><p>使用 <a href=/docs/infra/playbook/#infra-rmyml><code>infra-rm.yml</code></a> 剧本从 <code>infra</code> 分组上卸载 INFRA 模块：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra-rm.yml  <span style=color:#8f5902;font-style:italic># 从 infra 分组上卸载 INFRA 模块</span>
</span></span></code></pre></div><hr><h2 id=扩容-infra-模块>扩容 Infra 模块</h2><p>在配置清单中为新节点分配 <a href=/docs/infra/param/#infra_seq><code>infra_seq</code></a> 并加入 <code>infra</code> 分组：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 原有节点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 新节点</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>使用限制选项 <code>-l</code> 仅在新节点上执行剧本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -l 10.10.10.11    <span style=color:#8f5902;font-style:italic># 在新节点上安装 INFRA 模块</span>
</span></span></code></pre></div><hr><h2 id=管理本地软件仓库>管理本地软件仓库</h2><p>本地软件仓库相关的管理任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo              <span style=color:#8f5902;font-style:italic># 从互联网或离线包创建仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># 添加上游仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># 下载包及依赖</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># 创建本地 yum/apt 仓库</span>
</span></span></code></pre></div><p>完整子任务列表：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_dir          <span style=color:#8f5902;font-style:italic># 创建本地软件仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_check        <span style=color:#8f5902;font-style:italic># 检查本地软件仓库是否存在</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_prepare      <span style=color:#8f5902;font-style:italic># 直接使用已有仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_build        <span style=color:#8f5902;font-style:italic># 从上游构建仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_upstream     <span style=color:#8f5902;font-style:italic># 添加上游仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_remove       <span style=color:#8f5902;font-style:italic># 删除现有仓库文件</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_add          <span style=color:#8f5902;font-style:italic># 添加仓库到系统目录</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_url_pkg      <span style=color:#8f5902;font-style:italic># 从互联网下载包</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_cache        <span style=color:#8f5902;font-style:italic># 创建元数据缓存</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_boot_pkg     <span style=color:#8f5902;font-style:italic># 安装引导包</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_pkg          <span style=color:#8f5902;font-style:italic># 下载包及依赖</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_create       <span style=color:#8f5902;font-style:italic># 创建本地仓库</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_use          <span style=color:#8f5902;font-style:italic># 添加新建仓库到系统</span>
</span></span><span style=display:flex><span>./infra.yml -t repo_nginx        <span style=color:#8f5902;font-style:italic># 启动 nginx 文件服务器</span>
</span></span></code></pre></div><hr><h2 id=管理-nginx>管理 Nginx</h2><p>Nginx 相关的管理任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx                       <span style=color:#8f5902;font-style:italic># 重置 Nginx 组件</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_index                 <span style=color:#8f5902;font-style:italic># 重新渲染首页</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload   <span style=color:#8f5902;font-style:italic># 重新渲染配置并重载</span>
</span></span></code></pre></div><p>申请 HTTPS 证书：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_certbot,nginx_reload -e <span style=color:#000>certbot_sign</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><hr><h2 id=管理基础设施组件>管理基础设施组件</h2><p>基础设施各组件的管理命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t infra           <span style=color:#8f5902;font-style:italic># 配置基础设施</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_env       <span style=color:#8f5902;font-style:italic># 配置环境变量</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_pkg       <span style=color:#8f5902;font-style:italic># 安装软件包</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_user      <span style=color:#8f5902;font-style:italic># 设置操作系统用户</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_cert      <span style=color:#8f5902;font-style:italic># 颁发证书</span>
</span></span><span style=display:flex><span>./infra.yml -t dns             <span style=color:#8f5902;font-style:italic># 配置 DNSMasq</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx           <span style=color:#8f5902;font-style:italic># 配置 Nginx</span>
</span></span><span style=display:flex><span>./infra.yml -t victoria        <span style=color:#8f5902;font-style:italic># 配置 VictoriaMetrics/Logs/Traces</span>
</span></span><span style=display:flex><span>./infra.yml -t alertmanager    <span style=color:#8f5902;font-style:italic># 配置 AlertManager</span>
</span></span><span style=display:flex><span>./infra.yml -t blackbox        <span style=color:#8f5902;font-style:italic># 配置 Blackbox Exporter</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana         <span style=color:#8f5902;font-style:italic># 配置 Grafana</span>
</span></span><span style=display:flex><span>./infra.yml -t infra_register  <span style=color:#8f5902;font-style:italic># 注册到 VictoriaMetrics/Grafana</span>
</span></span></code></pre></div><p>常用维护命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_index                        <span style=color:#8f5902;font-style:italic># 重新渲染首页</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_config,nginx_reload          <span style=color:#8f5902;font-style:italic># 重新配置并重载</span>
</span></span><span style=display:flex><span>./infra.yml -t vmetrics_config,vmetrics_launch    <span style=color:#8f5902;font-style:italic># 重新生成 VictoriaMetrics 配置并重启</span>
</span></span><span style=display:flex><span>./infra.yml -t vlogs_config,vlogs_launch          <span style=color:#8f5902;font-style:italic># 更新 VictoriaLogs 配置</span>
</span></span><span style=display:flex><span>./infra.yml -t grafana_provision                  <span style=color:#8f5902;font-style:italic># 重新加载 Grafana 仪表盘与数据源定义</span>
</span></span></code></pre></div><hr><h2 id=管理-grafana-密码>管理 Grafana 密码</h2><p>Grafana 有两个密码参数：<a href=/docs/infra/param#grafana_admin_password><strong><code>grafana_admin_password</code></strong></a>（默认 <code>pigsty</code>）和 <a href=/docs/infra/param#grafana_view_password><strong><code>grafana_view_password</code></strong></a>（默认 <code>DBUser.Viewer</code>）：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>渲染到的配置文件</th></tr></thead><tbody><tr><td style=text-align:left><code>grafana_admin_password</code></td><td style=text-align:left><code>/etc/grafana/grafana.ini</code>，<code>/infra/env/pigsty</code></td></tr><tr><td style=text-align:left><code>grafana_view_password</code></td><td style=text-align:left><code>/etc/grafana/provisioning/datasources/pigsty.yml</code></td></tr></tbody></table><p>这两个密码一旦初始化之后，就只能通过 grafana 界面进行修改。</p><p>Pigsty 会在初始化 Grafana 监控面板，注册 Grafana 数据源的时候，使用 <a href=/docs/infra/param#grafana_admin_password><strong><code>grafana_admin_password</code></strong></a> 。
所以如果你通过 Grafana GUI 修改了这个密码，请相应调整配置文件里面的配置。另外，您可以使用以下命令渲染新的密码到环境变量中。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t env_var            <span style=color:#8f5902;font-style:italic># 重新渲染环境变量</span>
</span></span></code></pre></div><p><a href=/docs/infra/param#grafana_view_password><strong><code>grafana_view_password</code></strong></a> 是 Grafana 中默认的 Meta PostgreSQL 数据源用户 <code>dbuser_view</code> 的密码。
如果你修改了这个密码，请在 Grafana 数据源管理界面中同步修改密码。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3903df191db5a10a2713083bc196961f>7.5 - CA 与证书</h1><div class=lead>使用自签名 CA 或真实 HTTPS 证书</div><p>Pigsty 默认使用<strong>自签名证书颁发机构 (CA)</strong> 进行内部 SSL/TLS 加密。本文档包含：</p><ul><li><a href=#%E8%87%AA%E7%AD%BE%E5%90%8D-ca>自签名 CA</a>：默认的 PKI 基础设施</li><li><a href=#%E7%AD%BE%E5%8F%91%E8%AF%81%E4%B9%A6>签发证书</a>：使用 <code>cert.yml</code> 签发额外证书</li><li><a href=#%E4%BF%A1%E4%BB%BB-ca-%E8%AF%81%E4%B9%A6>信任 CA 证书</a>：在客户端机器上安装 CA</li><li><a href=#lets-encrypt>Let&rsquo;s Encrypt</a>：为公网服务使用真实证书</li></ul><hr><h2 id=自签名-ca>自签名 CA</h2><p>Pigsty 在基础设施初始化 (<code>infra.yml</code>) 时自动创建自签名 CA。该 CA 用于签发以下证书：</p><ul><li>PostgreSQL 服务器/客户端 SSL</li><li>Patroni REST API</li><li>etcd 集群通信</li><li>MinIO 集群通信</li><li>Nginx HTTPS（备用）</li><li>基础设施服务</li></ul><h3 id=pki-目录结构>PKI 目录结构</h3><pre tabindex=0><code>files/pki/
├── ca/
│   ├── ca.key                # CA 私钥（务必保管好！）
│   └── ca.crt                # CA 证书
├── csr/                      # 证书签名请求
├── misc/                     # 杂项证书（cert.yml 输出）
├── etcd/                     # ETCD 证书
├── pgsql/                    # PostgreSQL 证书
├── minio/                    # MinIO 证书
├── infra/                    # 基础设施证书
├── nginx/                    # Nginx 证书
└── mongo/                    # FerretDB 证书
</code></pre><h3 id=ca-变量>CA 变量</h3><table class=full-width><thead><tr><th>变量</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>ca_create</code></td><td><code>true</code></td><td>如果不存在则创建 CA，否则中止</td></tr><tr><td><code>ca_cn</code></td><td><code>pigsty-ca</code></td><td>CA 证书通用名称</td></tr><tr><td><code>cert_validity</code></td><td><code>7300d</code></td><td>签发证书的默认有效期</td></tr></tbody></table><h3 id=证书有效期>证书有效期</h3><table class=full-width><thead><tr><th>证书类型</th><th>有效期</th><th>控制参数</th></tr></thead><tbody><tr><td>CA 证书</td><td>100 年</td><td>硬编码（36500 天）</td></tr><tr><td>服务器/客户端</td><td>20 年</td><td><code>cert_validity</code>（7300d）</td></tr><tr><td>Nginx HTTPS</td><td>~1 年</td><td><code>nginx_cert_validity</code>（397d）</td></tr></tbody></table><blockquote><p><strong>注意</strong>：浏览器厂商限制超过 398 天的证书信任。Nginx 使用较短有效期以保证浏览器兼容性。</p></blockquote><h3 id=使用外部-ca>使用外部 CA</h3><p>如需使用企业自有 CA 而非自动生成的 CA：</p><ol><li><p>在配置中设置 <code>ca_create: false</code></p></li><li><p>在运行 playbook 之前放置 CA 文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p files/pki/ca
</span></span><span style=display:flex><span>cp /path/to/your/ca.key files/pki/ca/ca.key
</span></span><span style=display:flex><span>cp /path/to/your/ca.crt files/pki/ca/ca.crt
</span></span><span style=display:flex><span>chmod <span style=color:#0000cf;font-weight:700>600</span> files/pki/ca/ca.key
</span></span><span style=display:flex><span>chmod <span style=color:#0000cf;font-weight:700>644</span> files/pki/ca/ca.crt
</span></span></code></pre></div></li><li><p>运行 <code>./infra.yml</code></p></li></ol><h3 id=备份-ca-文件>备份 CA 文件</h3><p>CA 私钥至关重要，请安全备份：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 带时间戳备份</span>
</span></span><span style=display:flex><span>tar -czvf pigsty-ca-<span style=color:#204a87;font-weight:700>$(</span>date +%Y%m%d<span style=color:#204a87;font-weight:700>)</span>.tar.gz files/pki/ca/
</span></span></code></pre></div><blockquote><p><strong>警告</strong>：如果丢失 CA 私钥，由其签发的所有证书都将无法验证。您需要重新生成所有内容。</p></blockquote><hr><h2 id=签发证书>签发证书</h2><p>使用 <code>cert.yml</code> 签发由 Pigsty CA 签名的额外证书。</p><h3 id=基本用法>基本用法</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 为数据库用户签发证书（客户端证书）</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_dba
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 为监控用户签发证书</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_monitor
</span></span></code></pre></div><p>默认情况下，证书生成在 <code>files/pki/misc/&lt;cn>.{key,crt}</code>。</p><h3 id=参数说明>参数说明</h3><table class=full-width><thead><tr><th>参数</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>cn</code></td><td><code>pigsty</code></td><td>通用名称（必填）</td></tr><tr><td><code>san</code></td><td><code>[DNS:localhost, IP:127.0.0.1]</code></td><td>主题备用名称</td></tr><tr><td><code>org</code></td><td><code>pigsty</code></td><td>组织名称</td></tr><tr><td><code>unit</code></td><td><code>pigsty</code></td><td>组织单位名称</td></tr><tr><td><code>expire</code></td><td><code>7300d</code></td><td>证书有效期（20 年）</td></tr><tr><td><code>key</code></td><td><code>files/pki/misc/&lt;cn>.key</code></td><td>私钥输出路径</td></tr><tr><td><code>crt</code></td><td><code>files/pki/misc/&lt;cn>.crt</code></td><td>证书输出路径</td></tr></tbody></table><h3 id=高级示例>高级示例</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 签发带自定义 SAN（DNS 和 IP）的证书</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>myservice <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#4e9a06>&#39;{&#34;san&#34;:[&#34;DNS:myservice.local&#34;,&#34;DNS:myservice&#34;,&#34;IP:10.10.10.10&#34;]}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 签发自定义有效期（10 年）的证书</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>shortlived -e <span style=color:#000>expire</span><span style=color:#ce5c00;font-weight:700>=</span>3650d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 签发到自定义路径</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>custom <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>key</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/custom.key <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>crt</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/custom.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 签发带自定义组织的证书</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>external <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;My Company&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -e <span style=color:#000>unit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;IT Department&#34;</span>
</span></span></code></pre></div><h3 id=使用场景>使用场景</h3><p><strong>PostgreSQL 客户端证书</strong></p><p>用于 SSL 客户端认证（<code>pg_hba.conf</code> 中的 <code>cert</code> 认证方式）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 为 DBA 用户签发证书</span>
</span></span><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_dba
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 复制到客户端机器</span>
</span></span><span style=display:flex><span>scp files/pki/misc/dbuser_dba.<span style=color:#ce5c00;font-weight:700>{</span>key,crt<span style=color:#ce5c00;font-weight:700>}</span> user@client:~/.postgresql/
</span></span><span style=display:flex><span>scp files/pki/ca/ca.crt user@client:~/.postgresql/root.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用客户端证书连接</span>
</span></span><span style=display:flex><span>psql <span style=color:#4e9a06>&#34;host=pg-test port=5432 dbname=postgres user=dbuser_dba sslmode=verify-full sslcert=~/.postgresql/dbuser_dba.crt sslkey=~/.postgresql/dbuser_dba.key sslrootcert=~/.postgresql/root.crt&#34;</span>
</span></span></code></pre></div><p><strong>服务间 TLS</strong></p><p>用于需要双向 TLS 的内部服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./cert.yml -e <span style=color:#000>cn</span><span style=color:#ce5c00;font-weight:700>=</span>myapp -e <span style=color:#4e9a06>&#39;{&#34;san&#34;:[&#34;DNS:myapp.service.local&#34;,&#34;IP:10.10.10.50&#34;]}&#39;</span>
</span></span></code></pre></div><hr><h2 id=信任-ca-证书>信任 CA 证书</h2><p>在客户端机器上信任自签名 CA：</p><h3 id=linux-debianubuntu>Linux (Debian/Ubuntu)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp files/pki/ca/ca.crt /usr/local/share/ca-certificates/pigsty-ca.crt
</span></span><span style=display:flex><span>sudo update-ca-certificates
</span></span></code></pre></div><h3 id=linux-rhelrockyalma>Linux (RHEL/Rocky/Alma)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp files/pki/ca/ca.crt /etc/pki/ca-trust/source/anchors/pigsty-ca.crt
</span></span><span style=display:flex><span>sudo update-ca-trust
</span></span></code></pre></div><h3 id=macos>macOS</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo security add-trusted-cert -d -r trustRoot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -k /Library/Keychains/System.keychain files/pki/ca/ca.crt
</span></span></code></pre></div><h3 id=windows>Windows</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#204a87>Import-Certificate</span> <span style=color:#000>-FilePath</span> <span style=color:#000>files</span><span style=color:#000;font-weight:700>\</span><span style=color:#000>pki</span><span style=color:#000;font-weight:700>\</span><span style=color:#000>ca</span><span style=color:#000;font-weight:700>\</span><span style=color:#000>ca</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>crt</span> <span style=color:#000>-CertStoreLocation</span> <span style=color:#000>Cert</span><span style=color:#a40000>:</span><span style=color:#000;font-weight:700>\</span><span style=color:#000>LocalMachine</span><span style=color:#000;font-weight:700>\</span><span style=color:#000>Root</span>
</span></span></code></pre></div><h3 id=从-nginx-下载>从 Nginx 下载</h3><p>CA 证书也可通过 Nginx 在 <code>http://&lt;infra_ip>/ca.crt</code> 获取：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -o ca.crt http://10.10.10.10/ca.crt
</span></span></code></pre></div><hr><h2 id=lets-encrypt>Let&rsquo;s Encrypt</h2><p>对于公网服务，您可以通过 Certbot 使用 Let&rsquo;s Encrypt 的真实证书。</p><h3 id=前置条件>前置条件</h3><ul><li>拥有公网域名</li><li>DNS 记录指向服务器的公网 IP</li><li>Nginx 已正确配置</li><li>80 和 443 端口可访问</li></ul><h3 id=第一步域名配置>第一步：域名配置</h3><p>在 <code>infra_portal</code> 中配置服务域名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty.cc }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty.cc, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmetrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: p.pigsty.cc, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty.cc, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=第二步dns-配置>第二步：DNS 配置</h3><p>通过 A 记录将所有域名指向服务器的公网 IP：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nslookup g.pigsty.cc
</span></span><span style=display:flex><span>dig +short g.pigsty.cc
</span></span></code></pre></div><h3 id=第三步申请证书>第三步：申请证书</h3><p><strong>交互式方式：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>certbot --nginx -d pigsty.cc -d g.pigsty.cc -d p.pigsty.cc -d a.pigsty.cc
</span></span></code></pre></div><p><strong>非交互式方式：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>certbot --nginx --agree-tos --email admin@pigsty.cc -n <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -d pigsty.cc -d g.pigsty.cc -d p.pigsty.cc -d a.pigsty.cc
</span></span></code></pre></div><h3 id=第四步nginx-配置>第四步：Nginx 配置</h3><p>在 portal 条目中添加 <code>certbot: &lt;证书名称></code> 参数（例如 <code>certbot: pigsty-prod</code>），然后重新生成配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_config,nginx_launch
</span></span></code></pre></div><h3 id=第五步自动续期>第五步：自动续期</h3><p>测试续期（预演模式）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>certbot renew --dry-run
</span></span></code></pre></div><p>设置 cron 定时任务（每月 1 日凌晨 2 点）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#0000cf;font-weight:700>1</span> * * certbot renew --quiet
</span></span></code></pre></div><p>或启用 systemd 定时器：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl <span style=color:#204a87>enable</span> certbot.timer
</span></span></code></pre></div><hr><h2 id=管理命令>管理命令</h2><h3 id=certbot-命令>Certbot 命令</h3><table class=full-width><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>certbot certificates</code></td><td>列出所有证书</td></tr><tr><td><code>certbot renew --cert-name domain.com</code></td><td>续期指定证书</td></tr><tr><td><code>certbot delete --cert-name domain.com</code></td><td>删除证书</td></tr><tr><td><code>certbot revoke --cert-path /path/to/cert.pem</code></td><td>吊销证书</td></tr></tbody></table><h3 id=openssl-命令>OpenSSL 命令</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看证书详情</span>
</span></span><span style=display:flex><span>openssl x509 -in files/pki/ca/ca.crt -text -noout
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看证书过期时间</span>
</span></span><span style=display:flex><span>openssl x509 -in files/pki/pgsql/pg-meta-1.crt -enddate -noout
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 验证证书是否由 CA 签发</span>
</span></span><span style=display:flex><span>openssl verify -CAfile files/pki/ca/ca.crt files/pki/pgsql/pg-meta-1.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 检查证书链</span>
</span></span><span style=display:flex><span>openssl s_client -connect 10.10.10.10:5432 -starttls postgres &lt;/dev/null
</span></span></code></pre></div><hr><h2 id=故障排查>故障排查</h2><table class=full-width><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>证书过期</td><td>重新运行 playbook 重新生成，或使用 <code>cert.yml</code></td></tr><tr><td>CA 不被信任</td><td>在客户端安装 CA 证书（参见信任 CA 章节）</td></tr><tr><td>域名无法访问</td><td>验证 DNS 传播是否完成</td></tr><tr><td>端口 80 被阻止</td><td>确保 Let&rsquo;s Encrypt 验证时端口 80 开放</td></tr><tr><td>请求频率限制</td><td>避免短时间内多次申请 Let&rsquo;s Encrypt 证书</td></tr><tr><td>权限被拒绝</td><td>检查文件权限（密钥：0600，证书：0644）</td></tr></tbody></table><hr><h2 id=最佳实践>最佳实践</h2><ul><li><strong>备份 CA 密钥</strong>：将 <code>files/pki/ca/ca.key</code> 安全地离线存储</li><li><strong>使用适当的有效期</strong>：nginx 用短期（浏览器兼容），内部服务用长期</li><li><strong>轮换证书</strong>：定期重新运行 playbook 刷新证书</li><li><strong>监控过期</strong>：设置证书过期告警</li><li><strong>公网用 Let&rsquo;s Encrypt</strong>：内部用自签名，公网服务用真实证书</li><li><strong>记录配置</strong>：跟踪哪些服务使用哪些证书</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c91827b2709e7c2e7f7afc8662f9e0bf>7.6 - Grafana 高可用部署：使用 PostgreSQL 后端数据库</h1><div class=lead>使用 PostgreSQL 而不是 SQLite 作为 Grafana 后端使用的远程存储数据库，获取更好的性能与可用性。</div><p>您可以使用 PostgreSQL 作为 Grafana 后端使用的数据库。</p><p>这是了解Pigsty部署系统使用方式的好机会，完成此教程，您会了解：</p><ul><li>如何 <a href=#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4>创建新数据库集群</a></li><li>如何在已有数据库集群中 <a href=#%E5%88%9B%E5%BB%BAgrafana%E4%B8%9A%E5%8A%A1%E7%94%A8%E6%88%B7>创建新业务用户</a></li><li>如何在已有数据库集群中 <a href=#%E5%88%9B%E5%BB%BAgrafana%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%BA%93>创建新业务数据库</a></li><li>如何 <a href=#%E4%BD%BF%E7%94%A8grafana%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%BA%93>访问Pigsty所创建的数据库</a></li><li>如何 <a href=#%E7%AE%A1%E7%90%86grafana%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF>管理Grafana中的监控面板</a></li><li>如何管理Grafana中的 <a href=#%E7%AE%A1%E7%90%86postgres%E6%95%B0%E6%8D%AE%E6%BA%90>PostgreSQL数据源</a></li><li>如何一步到位完成 <a href=#%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D%E6%9B%B4%E6%96%B0grafana>Grafana数据库升级</a></li></ul><hr><h2 id=太长不看>太长不看</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi pigsty.yml <span style=color:#8f5902;font-style:italic># 取消注释DB/User定义：dbuser_grafana  grafana </span>
</span></span><span style=display:flex><span>bin/pgsql-user  pg-meta  dbuser_grafana
</span></span><span style=display:flex><span>bin/pgsql-db    pg-meta  grafana
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>psql postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana -c <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;CREATE TABLE t(); DROP TABLE t;&#39;</span> <span style=color:#8f5902;font-style:italic># 检查连接串可用性</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>vi /etc/grafana/grafana.ini <span style=color:#8f5902;font-style:italic># 修改 [database] type url</span>
</span></span><span style=display:flex><span>systemctl restart grafana-server
</span></span></code></pre></div><hr><h2 id=创建数据库集群>创建数据库集群</h2><p>我们可以在<code>pg-meta</code>上定义一个新的数据库<code>grafana</code>，也可以在新的机器节点上创建一个专用于Grafana的数据库集群：<code>pg-grafana</code></p><h3 id=定义集群>定义集群</h3><p>如果需要创建新的专用数据库集群<code>pg-grafana</code>，部署在<code>10.10.10.11</code>，<code>10.10.10.12</code>两台机器上，可以使用以下配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-grafana</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>grafana primary database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dbrole_admin]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for grafana database</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=创建集群>创建集群</h3><p>使用以下命令完成数据库集群<code>pg-grafana</code>的创建：<a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -l pg-grafana    <span style=color:#8f5902;font-style:italic># 初始化pg-grafana集群</span>
</span></span></code></pre></div><p>该命令是 Ansible Playbook <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a>，用于创建数据库集群。</p><p>定义在 <a href=/docs/pgsql/param#pg_users><code>pg_users</code></a> 与 <a href=/docs/pgsql/param#pg_databases><code>pg_databases</code></a> 中的业务用户与业务数据库会在集群初始化时自动创建，因此使用该配置时，集群创建完毕后，（在没有DNS支持的情况下）您可以使用以下连接串 <a href=/docs/concept/sec/ac>访问</a> 数据库（任一即可）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5432/grafana <span style=color:#8f5902;font-style:italic># 主库直连</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5436/grafana <span style=color:#8f5902;font-style:italic># 直连default服务</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.11:5433/grafana <span style=color:#8f5902;font-style:italic># 连接串读写服务</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5432/grafana <span style=color:#8f5902;font-style:italic># 主库直连</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5436/grafana <span style=color:#8f5902;font-style:italic># 直连default服务</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@10.10.10.12:5433/grafana <span style=color:#8f5902;font-style:italic># 连接串读写服务</span>
</span></span></code></pre></div><p>因为默认情况下Pigsty安装在<strong>单个元节点</strong>上，接下来的步骤我们会在已有的<code>pg-meta</code>数据库集群上创建Grafana所需的用户与数据库，而并非使用这里创建的<code>pg-grafana</code>集群。</p><hr><h2 id=创建grafana业务用户>创建Grafana业务用户</h2><p>通常业务对象管理的惯例是：先创建用户，再创建数据库。
因为如果为数据库配置了<code>owner</code>，数据库对相应的用户存在依赖。</p><h3 id=定义用户>定义用户</h3><p>要在<code>pg-meta</code>集群上创建用户<code>dbuser_grafana</code>，首先将以下用户定义添加至<code>pg-meta</code>的 <a href=#%E5%AE%9A%E4%B9%89%E9%9B%86%E7%BE%A4>集群定义</a> 中：</p><p>添加位置：<code>all.children.pg-meta.vars.pg_users</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Grafana</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for grafana database</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>pgbouncer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><blockquote><p>如果您在这里定义了不同的密码，请在后续步骤中将相应参数替换为新密码</p></blockquote><h3 id=创建用户>创建用户</h3><p>使用以下命令完成<code>dbuser_grafana</code>用户的创建（任一均可）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-user pg-meta dbuser_grafana <span style=color:#8f5902;font-style:italic># 在pg-meta集群上创建`dbuser_grafana`用户</span>
</span></span></code></pre></div><p>实际上调用了 Ansible Playbook <a href=/docs/pgsql/playbook#pgsql-useryml><code>pgsql-user.yml</code></a> 创建用户</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-user.yml -l pg-meta -e <span style=color:#000>pg_user</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_grafana  <span style=color:#8f5902;font-style:italic># Ansible</span>
</span></span></code></pre></div><p><code>dbrole_admin</code> 角色具有在数据库中执行DDL变更的权限，这正是Grafana所需要的。</p><hr><h2 id=创建grafana业务数据库>创建Grafana业务数据库</h2><h3 id=定义数据库>定义数据库</h3><p>创建业务数据库的方式与业务用户一致，首先在<code>pg-meta</code>的集群定义中添加新数据库<code>grafana</code>的 <a href=#%E5%AE%9A%E4%B9%89%E9%9B%86%E7%BE%A4>定义</a>。</p><p>添加位置：<code>all.children.pg-meta.vars.pg_databases</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: grafana, owner: dbuser_grafana, revokeconn</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=创建数据库>创建数据库</h3><p>使用以下命令完成<code>grafana</code>数据库的创建（任一均可）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-db pg-meta grafana <span style=color:#8f5902;font-style:italic># 在`pg-meta`集群上创建`grafana`数据库</span>
</span></span></code></pre></div><p>实际上调用了 Ansible Playbook <a href=/docs/pgsql/playbook#pgsql-dbyml><code>pgsql-db.yml</code></a> 创建数据库</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql-db.yml -l pg-meta -e <span style=color:#000>pg_database</span><span style=color:#ce5c00;font-weight:700>=</span>grafana <span style=color:#8f5902;font-style:italic># 实际执行的Ansible剧本</span>
</span></span></code></pre></div><hr><h2 id=使用grafana业务数据库>使用Grafana业务数据库</h2><h3 id=检查连接串可达性>检查连接串可达性</h3><p>您可以使用不同的 <a href=/docs/concept/ha/svc>服务</a> 或 <a href=/docs/concept/sec/ac>接入</a> 方式访问数据库，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5432/grafana <span style=color:#8f5902;font-style:italic># 直连</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana <span style=color:#8f5902;font-style:italic># default服务</span>
</span></span><span style=display:flex><span>postgres://dbuser_grafana:DBUser.Grafana@meta:5433/grafana <span style=color:#8f5902;font-style:italic># primary服务</span>
</span></span></code></pre></div><p>这里，我们将使用通过负载均衡器直接访问主库的 <a href=/docs/pgsql/service#default%E6%9C%8D%E5%8A%A1>Default服务</a> 访问数据库。</p><p>首先检查连接串是否可达，以及是否有权限执行DDL命令。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana -c <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;CREATE TABLE t(); DROP TABLE t;&#39;</span>
</span></span></code></pre></div><h3 id=直接修改grafana配置>直接修改Grafana配置</h3><p>为了让Grafana使用 Postgres 数据源，您需要编辑 <code>/etc/grafana/grafana.ini</code>，并修改配置项：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[database]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;type = sqlite3</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;host = 127.0.0.1:3306</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;name = grafana</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;user = root</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># If the password contains # or ; you have to wrap it with triple quotes. Ex &#34;&#34;&#34;#password;&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;password =</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>;url =</span>
</span></span></code></pre></div><p>将默认的配置项修改为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[database]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>postgres</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>url</span> <span style=color:#ce5c00;font-weight:700>=</span>  <span style=color:#4e9a06>postgres://dbuser_grafana:DBUser.Grafana@meta/grafana</span>
</span></span></code></pre></div><p>随后重启Grafana即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart grafana-server
</span></span></code></pre></div><p>从监控系统中看到新增的 <a href="http://g.pigsty.cc/d/pgsql-database/pgsql-database?var-cls=pg-meta&amp;var-ins=pg-meta-1&amp;var-datname=grafana&amp;orgId=1"><code>grafana</code></a> 数据库已经开始有活动，则说明Grafana已经开始使用Postgres作为首要后端数据库了。
但一个新的问题是，Grafana中原有的Dashboards与Datasources都消失了！这里需要重新导入 <a href=#%E7%AE%A1%E7%90%86grafana%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF>监控面板</a> 与 <a href=#%E7%AE%A1%E7%90%86postgres%E6%95%B0%E6%8D%AE%E6%BA%90>Postgres数据源</a></p><hr><h2 id=管理grafana监控面板>管理Grafana监控面板</h2><p>您可以使用管理用户前往 Pigsty 目录下的 <code>files/grafana</code> 目录，执行 <code>grafana.py init</code> 重新加载 Pigsty 监控面板。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/files/grafana
</span></span><span style=display:flex><span>./grafana.py init    <span style=color:#8f5902;font-style:italic># 使用当前目录下的Dashboards初始化Grafana监控面板</span>
</span></span></code></pre></div><p>执行结果：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant@meta:~/pigsty/files/grafana
</span></span><span style=display:flex><span>$ ./grafana.py init
</span></span><span style=display:flex><span>Grafana API: admin:pigsty @ http://10.10.10.10:3000
</span></span><span style=display:flex><span>init dashboard : home.json
</span></span><span style=display:flex><span>init folder pgcat
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-table.json
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-bloat.json
</span></span><span style=display:flex><span>init dashboard: pgcat / pgcat-query.json
</span></span><span style=display:flex><span>init folder pgsql
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-replication.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-table.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-activity.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-cluster.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-node.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-database.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-xacts.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-overview.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-session.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-tables.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-instance.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-queries.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-alert.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-service.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-persist.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-proxy.json
</span></span><span style=display:flex><span>init dashboard: pgsql / pgsql-query.json
</span></span><span style=display:flex><span>init folder pglog
</span></span><span style=display:flex><span>init dashboard: pglog / pglog-instance.json
</span></span><span style=display:flex><span>init dashboard: pglog / pglog-analysis.json
</span></span><span style=display:flex><span>init dashboard: pglog / pglog-session.json
</span></span></code></pre></div><p>该脚本会通过 Grafana API 导入仪表盘。你可以使用环境变量显式指定 Grafana 访问参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_ENDPOINT</span><span style=color:#ce5c00;font-weight:700>=</span>http://10.10.10.10:3000
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_USERNAME</span><span style=color:#ce5c00;font-weight:700>=</span>admin
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GRAFANA_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>pigsty
</span></span></code></pre></div><p>题外话，使用<code>grafana.py clean</code>会清空目标监控面板，使用<code>grafana.py load</code>会加载当前目录下所有监控面板，当Pigsty的监控面板发生变更，可以使用这两个命令升级所有的监控面板。</p><h2 id=管理postgres数据源>管理Postgres数据源</h2><p>当使用 <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a> 创建新 PostgreSQL 集群，或使用 <a href=/docs/pgsql/playbook#pgsql-dbyml><code>pgsql-db.yml</code></a> 创建新业务数据库时，Pigsty会在Grafana中注册新的PostgreSQL数据源，您可以使用默认的监控用户通过Grafana直接访问目标数据库实例。应用<code>pgcat</code>的绝大部分功能有赖于此。</p><p>要注册 Postgres 数据库数据源，可以使用 <a href=/docs/pgsql/playbook#pgsqlyml><code>pgsql.yml</code></a> 中的 <code>add_ds</code> 任务（或使用更全面的 <code>pg_register</code>）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t add_ds             <span style=color:#8f5902;font-style:italic># 重新注册当前环境中所有 PostgreSQL 数据源</span>
</span></span><span style=display:flex><span>./pgsql.yml -t add_ds -l pg-test  <span style=color:#8f5902;font-style:italic># 仅重新注册 pg-test 集群的数据源</span>
</span></span></code></pre></div><hr><h2 id=一步到位更新grafana>一步到位更新Grafana</h2><p>您可以直接通过修改 Pigsty 配置文件，更改 Grafana 使用的后端数据源，一步到位的完成切换 Grafana 后端数据库的工作。编辑 <code>pigsty.yml</code> 中 <a href=/docs/infra/param#grafana_pgurl><code>grafana_pgurl</code></a> 参数，将其修改为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>grafana_pgurl</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres://dbuser_grafana:DBUser.Grafana@meta:5436/grafana</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后重新执行 <a href=/docs/infra/playbook#infrayml><code>infra.yml</code></a> 中的 <code>grafana</code> 任务，即可完成 Grafana 升级</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t grafana
</span></span></code></pre></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>