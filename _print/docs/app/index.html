<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/app/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/app/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>应用 | PIGSTY</title><meta name=description content="使用 Docker 拉起应用软件模板，使用 Pigsty Grafana & Echarts 工具箱进行数据分析与可视化"><meta property="og:url" content="https://pigsty.cc/docs/app/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="应用"><meta property="og:description" content="使用 Docker 拉起应用软件模板，使用 Pigsty Grafana & Echarts 工具箱进行数据分析与可视化"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="应用"><meta itemprop=description content="使用 Docker 拉起应用软件模板，使用 Pigsty Grafana & Echarts 工具箱进行数据分析与可视化"><meta itemprop=dateModified content="2026-01-08T18:37:06+08:00"><meta itemprop=wordCount content="34"><meta itemprop=keywords content="参考,APP"><meta name=twitter:card content="summary"><meta name=twitter:title content="应用"><meta name=twitter:description content="使用 Docker 拉起应用软件模板，使用 Pigsty Grafana & Echarts 工具箱进行数据分析与可视化"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/app/>返回本页常规视图</a>.</p></div><h1 class=title>应用</h1><div class=lead>使用 Docker 拉起应用软件模板，使用 Pigsty Grafana & Echarts 工具箱进行数据分析与可视化</div><ul><li>1: <a href=#pg-dfa04ac62d43a7cc96541f47a4cc9d99>Supabase 企业级自建</a></li><li>2: <a href=#pg-1e18b4f399056e4a9b1713040a804b17>Odoo：自建开源 ERP</a></li><li>3: <a href=#pg-cc85a499c2128f8ef2658df26b2566ad>Dify：AI 工作流平台</a></li><li>4: <a href=#pg-de0128bd4345697963d59e764c35c90b>业务软件</a></li><li>5: <a href=#pg-b94f778cc05c5fe2e52f126f032753e9>NocoDB：开源 Airtable</a></li><li>6: <a href=#pg-a24f4293fdd8dcc354ecc1a0fe74f7da>Teable：AI 无代码数据库</a></li><li>7: <a href=#pg-e4d7871bc5c532d89a4e76a28e49ee3b>Gitea：自建简易代码托管平台</a></li><li>8: <a href=#pg-ab8b5d6530871db26391dfb780764601>Wiki.js：维基百科站</a></li><li>9: <a href=#pg-b2e9576ebd029b6f66db394de58e3112>Mattermost：开源 IM</a></li><li>10: <a href=#pg-b3e8ff513ff4c90114324ee5b19b8015>Maybe：个人财务管理</a></li><li>11: <a href=#pg-170acad42811859443cc55f9cd346b6f>Metabase：BI 分析工具</a></li><li>12: <a href=#pg-2226656b7bf317b375be85683acc8130>Kong：API 网关</a></li><li>13: <a href=#pg-fc62b9aad0217ff4dadd76e1e15633b6>Registry：容器镜像仓库</a></li><li>14: <a href=#pg-fa3dc992b76e9f32c26faddd8dccdb15>数据库工具</a></li><li>15: <a href=#pg-9ab8e0a1cc0dd81586d666399930c331>ByteBase：模式迁移</a></li><li>16: <a href=#pg-8736e7e24609593e38bb4af51eacec86>PGAdmin：GUI 工具</a></li><li>17: <a href=#pg-fbdf33ca77e7696092991f27dcf86e32>PGWeb：网页客户端</a></li><li>18: <a href=#pg-0e8785a96f30f0e01c2bfd365fb63b5a>PostgREST：自动 API</a></li><li>19: <a href=#pg-fa5656811a158b156712d00725b47fea>Electric：PGLite 同步引擎</a></li><li>20: <a href=#pg-34724279579b562c276e6051f843c660>Jupyter：笔记本 AI IDE</a></li><li>21: <a href=#pg-b3405ffde24b58619b4d32980b9155a0>数据应用</a></li><li>22: <a href=#pg-af33a915aa5ea40ca1b93854fbd8da8e>PGLOG：PG自带日志分析应用</a></li><li>23: <a href=#pg-3bf0cdc122adbb3c6315d77456eb4a70>NOAA ISD 全球气象站历史数据查询</a></li><li>24: <a href=#pg-f2f527c6f73d059e66947f8c86fd4b49>COVID-19 数据大盘</a></li><li>25: <a href=#pg-41257227641757f696b35683a37345dd>StackOverflow 调研</a></li><li>26: <a href=#pg-71c4afe134c6d0768ee52d9ca11f5242>DB-Engine 热度分析</a></li><li>27: <a href=#pg-90bea0e09fc3821f240f24c4f991c6a8>云上算力价格计算器</a></li></ul><div class=content><h2 id=applet的结构>Applet的结构</h2><p>Applet，是一种自包含的，运行于Pigsty基础设施中的数据小应用。</p><p>一个Pigsty应用通常包括以下内容中的至少一样或全部：</p><ul><li>图形界面（Grafana Dashboard定义） 放置于<code>ui</code>目录</li><li>数据定义（PostgreSQL DDL File），放置于 <code>sql</code> 目录</li><li>数据文件（各类资源，需要下载的文件），放置于<code>data</code>目录</li><li>逻辑脚本（执行各类逻辑），放置于<code>bin</code>目录</li></ul><p>Pigsty默认提供了几个样例应用：</p><ul><li><a href=/docs/app/pglog><code>pglog</code></a>， 分析PostgreSQL CSV日志样本。</li><li><a href=/docs/app/covid><code>covid</code></a>， 可视化WHO COVID-19数据，查阅各国疫情数据。</li><li><a href=/docs/app/isd><code>isd</code></a>， NOAA ISD，可以查询全球30000个地表气象站从1901年来的气象观测记录。</li></ul><hr><h2 id=应用的结构>应用的结构</h2><p>一个Pigsty应用会在应用根目录提供一个安装脚本：<code>install</code>或相关快捷方式。您需要使用管理用户在 <a href=/docs/concept/arch/node#admin%E8%8A%82%E7%82%B9><strong>管理节点</strong></a> 执行安装。安装脚本会检测当前的环境（获取 <code>METADB_URL</code>， <code>PIGSTY_HOME</code>，<code>GRAFANA_ENDPOINT</code>等信息以执行安装）</p><p>通常，带有<code>APP</code>标签的面板会被列入Pigsty Grafana首页导航中App下拉菜单中，带有<code>APP</code>和<code>Overview</code>标签的面板则会列入首页面板导航中。</p><p>您可以从 <a href=https://github.com/Vonng/pigsty/releases/download/v1.5.1/app.tgz>https://github.com/Vonng/pigsty/releases/download/v1.5.1/app.tgz</a> 下载带有基础数据的应用进行安装。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-dfa04ac62d43a7cc96541f47a4cc9d99>1 - Supabase 企业级自建</h1><div class=lead>使用 Pigsty 自托管企业级 supabase，带有监控，高可用，PITR，IaC 以及 444 PG扩展。</div><p>Supabase 很好，拥有属于你自己的 supabase 则好上加好。
Pigsty 可以帮助您在自己的服务器上（物理机/虚拟机/云服务器），一键自建企业级 supabase
—— 更多扩展，更好性能，更深入的控制，更合算的成本。</p><blockquote><p>Pigsty 是 Supabase 官网文档上列举的三种自建部署之一：<a href=https://supabase.com/docs/guides/self-hosting#third-party-guides>Self-hosting: Third-Party Guides</a></p></blockquote><p>本教程需要您有 Linux 基础知识，否则建议直接使用 Supabase 云服务或 “Docker Compose” 自建。</p><hr><h2 id=简短版本>简短版本</h2><p><a href=/docs/deploy/prepare>准备</a> <a href=/docs/deploy/prepare><strong>Linux 系统</strong></a>，执行 Pigsty <a href=/docs/setup/install><strong>标准单机安装</strong></a> 流程，选择 <code>supabase</code> 配置模板，依次执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./configure -c supabase    <span style=color:#8f5902;font-style:italic># 使用 supabase 配置（请在 pigsty.yml 中更改凭据）</span>
</span></span><span style=display:flex><span>vi pigsty.yml              <span style=color:#8f5902;font-style:italic># 编辑域名、密码、密钥...</span>
</span></span><span style=display:flex><span>./deploy.yml               <span style=color:#8f5902;font-style:italic># 标准单机部署 pigsty</span>
</span></span><span style=display:flex><span>./docker.yml               <span style=color:#8f5902;font-style:italic># 安装 docker 模块</span>
</span></span><span style=display:flex><span>./app.yml                  <span style=color:#8f5902;font-style:italic># 使用 docker 启动 supabase 无状态部分（可能较慢）</span>
</span></span></code></pre></div><p>安装完毕后，使用浏览器访问 <code>8000</code> 端口造访 Supa Studio，用户名 <code>supabase</code>，密码 <code>pigsty</code>。</p><p><img src=/img/pigsty/supabase.webp alt></p><div id=asciinema-913fe6b5e34ef94a5d10a82176a4fd69 class="asciinema-container td-max-width-on-larger-screens" style="margin:1em 0"></div><script>(function(){var n,s="asciinema-913fe6b5e34ef94a5d10a82176a4fd69",o="/demo/supabase.cast",e="auto",i=null;function a(){var e=document.documentElement.getAttribute("data-bs-theme");return e==="dark"?"solarized-dark":e==="light"?"solarized-light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"solarized-dark":"solarized-light"}function r(){return e==="auto"?a():e}function t(){var e,t=document.getElementById(s);t.innerHTML="",e={theme:r(),speed:"1.3",startAt:0,fit:"width"},e.autoPlay=!0,e.loop=!0,e.markers=[[0,"检查环境"],[11,"安装"],[43,"配置"],[307,"Docker"],[321,"域名"],[340,"App"],[350,"检查"]],i=AsciinemaPlayer.create(o,t,e)}t(),e==="auto"&&(n=new MutationObserver(function(e){e.forEach(function(e){e.attributeName==="data-bs-theme"&&t()})}),n.observe(document.documentElement,{attributes:!0}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){var e=document.documentElement.getAttribute("data-bs-theme");(!e||e==="auto")&&t()}))})()</script><hr><h2 id=检查清单>检查清单</h2><ul><li><input disabled type=checkbox> 至少一台 1C2G 的服务器</li><li><input disabled type=checkbox> 带有静态内网 IPv4 地址</li><li><input disabled type=checkbox> 安装支持的 <a href=/docs/ref/linux><strong>Linux 发行版</strong></a></li><li><input disabled type=checkbox> <a href=/docs/setup/install><strong>标准安装</strong></a> Pigsty</li><li><input disabled type=checkbox> 修改配置文件，域名，密码，IP 地址</li><li><input disabled type=checkbox> <a href=/docs/docker><strong>安装 Docker 模块</strong></a>，确保代理/镜像站可用</li><li><input disabled type=checkbox> 使用 Pigsty 提供的 <a href=/docs/docker/playbook><code>app.yml</code></a> 拉起 Supabase</li></ul><hr><h2 id=目录>目录</h2><ul><li><a href=#supabase%E6%98%AF%E4%BB%80%E4%B9%88>Supabase是什么？</a></li><li><a href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%87%AA%E5%BB%BA>为什么要自建它？</a></li><li><a href=#%E5%8D%95%E8%8A%82%E7%82%B9%E8%87%AA%E5%BB%BA%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B>单机自建快速上手</a></li><li><a href=#%E8%BF%9B%E9%98%B6%E4%B8%BB%E9%A2%98%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA>进阶主题：安全加固</a></li><li><a href=#%E8%BF%9B%E9%98%B6%E4%B8%BB%E9%A2%98%E5%9F%9F%E5%90%8D%E6%8E%A5%E5%85%A5>进阶主题：域名接入</a></li><li><a href=#%E8%BF%9B%E9%98%B6%E4%B8%BB%E9%A2%98%E5%A4%96%E9%83%A8%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8>进阶主题：外部对象存储</a></li><li><a href=#%E8%BF%9B%E9%98%B6%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8smtp>进阶主题：使用SMTP</a></li><li><a href=#%E8%BF%9B%E9%98%B6%E4%B8%BB%E9%A2%98%E7%9C%9F%E9%AB%98%E5%8F%AF%E7%94%A8>进阶主题：真·高可用</a></li></ul><hr><h2 id=supabase是什么>Supabase是什么？</h2><p><a href=https://supabase.com/>Supabase</a> 是一个 BaaS （Backend as Service），开源的 Firebase，是 AI Agent 时代最火爆的数据库 + 后端解决方案。
Supabase 对 PostgreSQL 进行了封装，并提供了身份认证，消息传递，边缘函数，对象存储，并基于 PG 数据库模式自动生成 REST API 与 GraphQL API。</p><p>Supabase 旨在为开发者提供一条龙式的后端解决方案，减少开发和维护后端基础设施的复杂性。
它能让开发者告别绝大部分后端开发的工作，<strong>只需要懂数据库设计与前端即可快速出活！</strong>
开发者只要用 Vibe Coding 糊个前端与数据库模式设计，就可以快速完成一个完整的应用。</p><p>目前，Supabase 是 <a href=https://ossrank.com/cat/368-postgresql-ecosystem>PostgreSQL 开源生态</a> 中人气最高的开源项目，在 GitHub 上已有 <a href=https://github.com/supabase/supabase/>九万</a> Star。
Supabase 还为小微创业者提供了"慷慨"的免费云服务额度 —— 免费的 500 MB 空间，对于存个用户表，浏览数之类的东西绰绰有余。</p><hr><h2 id=为什么要自建>为什么要自建？</h2><p>既然 Supabase 云服务这么香，为什么要自建呢？</p><p>最直观的原因是我们在《<a href=https://vonng.com/cloud/rds/>云数据库是智商税吗？</a>》中提到过的：当你的数据/计算规模超出云计算适用光谱（Supabase：4C/8G/500MB免费存储），成本很容易出现爆炸式增长。
而且在当下，足够可靠的 <a href=https://vonng.com/cloud/bonus/>本地企业级 NVMe SSD</a> 在性价比上与 <a href=https://vonng.com/cloud/ebs/>云端存储</a> 有着三到四个数量级的优势，而自建能更好地利用这一点。</p><p>另一个重要的原因是 <strong>功能</strong>， Supabase 云服务的功能受限 —— 很多强力PG扩展因为多租户安全挑战与许可证的原因无法以云服务的形式。
故而尽管 <a href=https://vonng.com/pg/pg-eat-db-world>扩展是 PostgreSQL 的核心特色</a>，在 Supabase 云服务上也依然只有 <strong>64</strong> 个扩展可用。
而通过 Pigsty 自建的 Supabase 则提供了多达 <a href=https://pgext.cloud/list><strong>444</strong></a> 个开箱即用的 PG 扩展。</p><p>此外，自主可控与规避供应商锁定也是自建的重要原因 —— 尽管 Supabase 虽然旨在提供一个无供应商锁定的 Google Firebase 开源替代，但实际上自建高标准企业级的 Supabase 门槛并不低。
Supabase 内置了一系列由他们自己开发维护的 PG 扩展插件，并计划将原生的 PostgreSQL 内核替换为收购的 <a href=/docs/pgsql/kernel/orioledb><strong>OrioleDB</strong></a>，而这些内核与扩展在 PGDG 官方仓库中并没有提供。</p><p>这实际上是某种隐性的供应商锁定，阻止了用户使用除了 supabase/postgres Docker 镜像之外的方式自建，Pigsty 则提供开源，透明，通用的方案解决这个问题。
我们将所有 Supabase 自研与用到的 10 个缺失的扩展打成开箱即用的 RPM/DEB 包，确保它们在所有 <a href=/docs/ref/linux>主流Linux操作系统发行版</a> 上都可用：</p><table class=full-width><thead><tr><th>扩展</th><th>说明</th></tr></thead><tbody><tr><td><a href=https://pgext.cloud/e/pg_graphql/><code>pg_graphql</code></a></td><td>提供PG内的GraphQL支持 (RUST)，Rust扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/pg_jsonschema/><code>pg_jsonschema</code></a></td><td>提供JSON Schema校验能力，Rust扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/wrappers/><code>wrappers</code></a></td><td>Supabase提供的外部数据源包装器捆绑包，Rust扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/index_advisor/><code>index_advisor</code></a></td><td>查询索引建议器，SQL扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/pg_net/><code>pg_net</code></a></td><td>用 SQL 进行异步非阻塞HTTP/HTTPS 请求的扩展 (supabase)，C扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/supabase_vault/><code>vault</code></a></td><td>在 Vault 中存储加密凭证的扩展 (supabase)，C扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/pgjwt/><code>pgjwt</code></a></td><td>JSON Web Token API 的PG实现 (supabase)，SQL扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/pgsodium/><code>pgsodium</code></a></td><td>表数据加密存储 TDE，扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/supautils/><code>supautils</code></a></td><td>用于在云环境中确保数据库集群的安全，C扩展，由PIGSTY提供</td></tr><tr><td><a href=https://pgext.cloud/e/plan_filter/><code>pg_plan_filter</code></a></td><td>使用执行计划代价过滤阻止特定查询语句，C扩展，由PIGSTY提供</td></tr></tbody></table><p>同时，我们在 Supabase 自建部署中默认 <a href=/docs/pgsql/ext/install>安装</a> 绝大多数扩展，您可以参考可用扩展列表按需 <a href=/docs/pgsql/ext/create>启用</a>。</p><p>同时，Pigsty 还会负责好底层 <a href=/docs/concept/ha/>高可用</a> <a href=/docs/pgsql/>PostgreSQL</a> 数据库集群，高可用 <a href=/docs/minio/>MinIO</a> 对象存储集群的自动搭建，甚至是 <a href=/docs/docker/>Docker</a> 容器底座的部署与 <a href=/docs/infra/admin/portal>Nginx</a> 反向代
理，<a href=/docs/infra/admin/domain>域名配置</a> 与 <a href=/docs/infra/admin/cert>HTTPS证书签发</a>。 您可以使用 Docker Compose 拉起任意数量的无状态 Supabase 容器集群，并将状态存储在外部 Pigsty 自托管数据库服务中。</p><p>在这一自建部署架构中，您获得了使用不同内核的自由（PG 15-18，OrioleDB），加装 <a href=https://pgext.cloud/list/><strong>437</strong></a> 个扩展的自由，扩容与伸缩 Supabase / Postgres / MinIO 的自由，
免于数据库运维杂务的自由，以及免于供应商锁定，本地运行到地老天荒的自由。 而相比于使用云服务需要付出的代价，不过是准备服务器和多敲几行命令而已。</p><hr><h2 id=单节点自建快速上手>单节点自建快速上手</h2><p>让我们先从单节点 Supabase 部署开始，我们会在后面进一步介绍多节点高可用部署的方法。</p><p><a href=/docs/deploy/prepare>准备</a> 一台全新 <a href=/docs/deploy/prepare>Linux 服务器</a>，使用 Pigsty 提供的 <a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml><code>supabase</code></a> 配置模板执行 <a href=/docs/setup/install>标准安装</a>，
然后额外运行 <a href=/docs/docker/playbook#dockeryml><code>docker.yml</code></a> 与 <code>app.yml</code> 拉起无状态部分的 Supabase 容器即可（默认端口 <code>8000</code>/<code>8433</code>）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./configure -c supabase    <span style=color:#8f5902;font-style:italic># 使用 supabase 配置（请在 pigsty.yml 中更改凭据）</span>
</span></span><span style=display:flex><span>vi pigsty.yml              <span style=color:#8f5902;font-style:italic># 编辑域名、密码、密钥...</span>
</span></span><span style=display:flex><span>./deploy.yml               <span style=color:#8f5902;font-style:italic># 安装 pigsty</span>
</span></span><span style=display:flex><span>./docker.yml               <span style=color:#8f5902;font-style:italic># 安装 docker compose 组件</span>
</span></span><span style=display:flex><span>./app.yml                  <span style=color:#8f5902;font-style:italic># 使用 docker 启动 supabase 无状态部分</span>
</span></span></code></pre></div><p>在部署 Supabase 前请根据实际情况修改自动生成的 <code>pigsty.yml</code> 配置文件中的参数（域名与密码）
如果只是本地开发测试，可以先跳过，我们将在后面介绍如何通过修改配置文件来进一步定制。</p><p>如果配置无误，大约十分钟后，就可以在本地网络通过 <code>http://&lt;your_ip_address>:8000</code> 访问到 Supabase Studio 图形管理界面了。
默认的用户名与密码分别是： <code>supabase</code> 与 <code>pigsty</code>。</p><p><img src=/img/pigsty/supabase.webp alt></p><p><strong>注意事项：</strong></p><ul><li>在中国大陆地区，Pigsty 默认使用 1Panel 与 1ms 提供的 DockerHub 镜像站点下载 Supabase 相关镜像，可能会较慢。</li><li>你也可以自行配置 <a href=/docs/docker/usage#%E4%BB%A3%E7%90%86>代理</a> 与 <a href=/docs/docker/usage#%E9%95%9C%E5%83%8F%E7%AB%99>镜像站</a> ，<code>cd /opt/supabase; docker compose pull</code> 手动拉取镜像。我们亦提供包含完整离线安装方案的 Supabase 自建专家咨询服务。</li><li>如果你需要使用的对象存储功能，那么需要通过域名与 HTTPS 访问 Supabase，否则会出现报错。</li><li>对于严肃的生产部署，请 <strong>务必</strong> 修改所有默认密码！</li></ul><hr><h2 id=自建关键技术决策>自建关键技术决策</h2><p>以下是一些自建 Supabase 会涉及到的关键技术决策，供您参考：</p><p>使用默认的<strong>单节点部署</strong> Supabase 无法享受到 PostgreSQL / MinIO 的高可用能力。
尽管如此，单节点部署相比官方纯 Docker Compose 方案依然要有显著优势： 例如开箱即用的监控系统，自由安装扩展的能力，各个组件的扩缩容能力，以及提供兜底数据库时间点恢复能力等。</p><p>如果您只有一台服务器，或者选择在云服务器上自建，Pigsty 建议您使用外部的 S3 替代本地的 MinIO 作为对象存储，存放 PostgreSQL 的备份，并承载 Supabase Storage 服务。
这样的部署在故障时可以在单机部署条件下，提供一个兜底级别的 RTO （小时级恢复时长）/ RPO （MB级数据损失）容灾水平。</p><p>在严肃的生产部署中，Pigsty 建议使用至少3～4个节点的部署策略，确保 MinIO 与 PostgreSQL 都使用满足企业级高可用要求的多节点部署。
在这种情况下，您需要相应准备更多节点与磁盘，并相应调整 <code>pigsty.yml</code> 配置清单中的集群配置，以及 supabase 集群配置中的接入信息，使用高可用接入点访问服务。</p><p>Supabase 的部分功能需要发送邮件，所以要用到 SMTP 服务。除非单纯用于内网，否则对于严肃的生产部署，建议使用 SMTP 云服务。自建的邮件服务器发送的邮件容易被标记为垃圾邮件导致拒收。</p><p>如果您的服务直接向公网暴露，我们强烈建议您使用真正的域名与 HTTPS 证书，并通过 <a href=/docs/infra/admin/portal>Nginx 门户</a> 访问。</p><p>接下来，我们会依次讨论一些进阶主题。如何在单节点部署的基础上，进一步提升 Supabase 的安全性、可用性与性能。</p><hr><h2 id=进阶主题安全加固>进阶主题：安全加固</h2><p><strong>Pigsty基础组件</strong></p><p>对于严肃的生产部署，我们强烈建议您修改 Pigsty 基础组件的密码。因为这些默认值是公开且众所周知的，不改密码上生产无异于裸奔：</p><ul><li><a href=/docs/infra/param/#grafana_admin_password><code>grafana_admin_password</code></a>: <code>pigsty</code>，Grafana管理员密码</li><li><a href=/docs/pgsql/param/#pg_admin_password><code>pg_admin_password</code></a>: <code>DBUser.DBA</code>，PG超级用户密码</li><li><a href=/docs/pgsql/param/#pg_monitor_password><code>pg_monitor_password</code></a>: <code>DBUser.Monitor</code>，PG监控用户密码</li><li><a href=/docs/pgsql/param/#pg_replication_password><code>pg_replication_password</code></a>: <code>DBUser.Replicator</code>，PG复制用户密码</li><li><a href=/docs/pgsql/param/#patroni_password><code>patroni_password</code></a>: <code>Patroni.API</code>，Patroni 高可用组件密码</li><li><a href=/docs/node/param/#haproxy_admin_password><code>haproxy_admin_password</code></a>: <code>pigsty</code>，负载均衡器管控密码</li><li><a href=/docs/minio/param/#minio_secret_key><code>minio_secret_key</code></a>: <code>S3User.MinIO</code>，MinIO 根用户密钥</li><li><a href=/docs/etcd/param/#etcd_root_password><code>etcd_root_password</code></a>: <code>Etcd.Root</code>，MinIO 根用户密钥</li><li>此外，强烈建议您修改 Supabase 使用的 <a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L72>PostgreSQL 业务用户</a> 密码，默认为 <code>DBUser.Supa</code></li></ul><p>以上密码为 Pigsty 组件模块的密码，强烈建议在安装部署前就设置完毕。</p><p><strong>Supabase密钥</strong></p><p>除了 Pigsty 组件的密码，你还需要 <a href=https://supabase.com/docs/guides/self-hosting/docker#securing-your-services>修改 Supabase 的密钥</a>，包括</p><ul><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L135><code>JWT_SECRET</code></a>：JWT 签名密钥，长度至少 32 个字符</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L136><code>ANON_KEY</code></a>：匿名用户的 JWT 凭据</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L137><code>SERVICE_ROLE_KEY</code></a>：服务角色的 JWT 凭据</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L138><code>PG_META_CRYPTO_KEY</code></a>：PostgreSQL Meta 服务的加密密钥，长度至少 32 个字符</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L140><code>DASHBOARD_USERNAME</code></a>：Supabase Studio Web 界面的默认用户名，默认为 <code>supabase</code></li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L141><code>DASHBOARD_PASSWORD</code></a>：Supabase Studio Web 界面的默认密码，默认为 <code>pigsty</code></li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L144><code>LOGFLARE_PUBLIC_ACCESS_TOKEN</code></a>：Logflare 公开访问令牌，32-64 个随机字符</li><li><a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L145><code>LOGFLARE_PRIVATE_ACCESS_TOKEN</code></a>：Logflare 私有访问令牌，32-64 个随机字符</li></ul><p>这里请您务必参照 <a href=https://supabase.com/docs/guides/self-hosting/docker#generate-api-keys>Supabase教程：保护你的服务</a> 里的说明：</p><ul><li>生成一个长度超过 40 个字符的 <code>JWT_SECRET</code>，并使用教程中的工具签发 <code>ANON_KEY</code> 与 <code>SERVICE_ROLE_KEY</code> 两个 JWT。</li><li>使用教程中提供的工具，根据 <code>JWT_SECRET</code> 以及过期时间等属性，生成一个 <code>ANON_KEY</code> JWT，这是匿名用户的身份凭据。</li><li>使用教程中提供的工具，根据 <code>JWT_SECRET</code> 以及过期时间等属性，生成一个 <code>SERVICE_ROLE_KEY</code>，这是权限更高服务角色的身份凭据。</li><li>指定一个32个字符以上的随机字符串密钥 <code>PG_META_CRYPTO_KEY</code>，用于加密 Studio UI 与 meta 服务的交互</li><li>如果您使用的 PostgreSQL 业务用户使用了不同于默认值的密码，请相应修改 <a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L144>`POSTGRES_PASSWORD``</a> 的值</li><li>如果您的对象存储使用了不同于默认值的密码，请相应修改 <a href=https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L155><code>S3_ACCESS_KEY``](https://github.com/pgsty/pigsty/blob/main/conf/supabase.yml#L154) 与 [</code>S3_SECRET_KEY``</a> 的值</li></ul><p>Supabase 部分的凭据修改后，您可以重启 Docker Compose 容器以应用新的配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./app.yml -t app_config,app_launch   <span style=color:#8f5902;font-style:italic># 使用剧本</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> /opt/supabase<span style=color:#000;font-weight:700>;</span> make up            <span style=color:#8f5902;font-style:italic># 手工执行</span>
</span></span></code></pre></div><hr><h2 id=进阶主题域名接入>进阶主题：域名接入</h2><p>如果你在本机或局域网内使用 Supabase，那么可以选择 IP:Port 直连 Kong 对外暴露的 HTTP 8000 端口访问 Supabase。</p><p>你可以使用一个内网静态解析的域名，但对于严肃的生产部署，我们建议您使用真域名 + HTTPS 来访问 Supabase。
在这种情况下，您的服务器应当有一个公网 IP 地址，你应当拥有一个域名，使用云/DNS/CDN 供应商提供的 DNS 解析服务，将其指向安装节点的公网 IP（可选默认下位替代：本地 <code>/etc/hosts</code> 静态解析）。</p><p>比较简单的做法是，直接批量替换占位域名（<code>supa.pigsty</code>）为你的实际域名，假设为 <code>supa.pigsty.cc</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -ie <span style=color:#4e9a06>&#39;s/supa.pigsty/supa.pigsty.cc/g&#39;</span> ~/pigsty/pigsty.yml
</span></span></code></pre></div><p>如果你没有事先配置好，那么重载 Nginx 和 Supabase 的配置生效即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make cert       <span style=color:#8f5902;font-style:italic># 申请 certbot 免费 HTTPS 证书</span>
</span></span><span style=display:flex><span>./app.yml       <span style=color:#8f5902;font-style:italic># 重载 Supabase 配置</span>
</span></span></code></pre></div><p>修改后的配置应当类似下面的片段：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 使用 certbot 签发真实证书</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty.cc              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为你的域名！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>supa</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa.pigsty.cc       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为你的域名！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8000&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>supa.pigsty.cc      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 证书名称，通常与域名一致即可</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                                         </span><span style=color:#8f5902;font-style:italic># supabase 应用定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                                           </span><span style=color:#8f5902;font-style:italic># 覆盖 /opt/supabase/.env</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SITE_URL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://supa.pigsty.cc             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;------- 修改为您的外部域名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>API_EXTERNAL_URL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://supa.pigsty.cc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;------- 否则 storage API 可能无法正常工作！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SUPABASE_PUBLIC_URL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://supa.pigsty.cc  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;------- 别忘了在 infra_portal 中配置！</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>完整的域名/HTTPS 配置可以参考 <a href=/docs/infra/admin/cert>证书管理</a> 教程，您也可以使用 Pigsty 自带的本地静态解析与自签发 HTTPS 证书作为下位替代。</p><hr><h2 id=进阶主题外部对象存储>进阶主题：外部对象存储</h2><p>您可以使用 S3 或 S3 兼容的服务，来作为 PGSQL 备份与 Supabase 使用的对象存储。这里我们使用一个 阿里云 OSS 对象存储作为例子。</p><blockquote><p>Pigsty 提供了一个 <a href=https://github.com/pgsty/pigsty/blob/main/terraform/spec/aliyun-s3.tf><code>terraform/spec/aliyun-s3.tf</code></a> 模板，
可以用于在阿里云上拉起一台服务器，以及一个 OSS 存储桶。</p></blockquote><p>首先，我们修改 <code>all.children.supa.vars.apps.[supabase].conf</code> 中 S3 相关的配置，将其指向阿里云 OSS 存储桶：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># if using s3/minio as file storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_BUCKET</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>data                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_ENDPOINT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9000 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_ACCESS_KEY</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3user_data           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_SECRET_KEY</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Data           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_FORCE_PATH_STYLE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_REGION</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>stub                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>S3_PROTOCOL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为 S3 兼容服务的连接信息</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>同样使用以下命令重载 Supabase 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./app.yml -t app_config,app_launch
</span></span></code></pre></div><p>您同样可以使用 S3 作为 PostgreSQL 的备份仓库，在 <code>all.vars.pgbackrest_repo</code> 新增一个 <code>aliyun</code> 备份仓库的定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aliyun         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgbackrest 备份方法：local,minio,[其他用户定义的仓库...]，本例中将备份存储到 MinIO 上</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pgbackrest_repo:                   # pgbackrest 备份仓库</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>aliyun</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># 定义一个新的备份仓库 aliyun</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 阿里云 oss 是 s3-兼容的对象存储</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oss-cn-beijing-internal.aliyuncs.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oss-cn-beijing</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty-oss</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>xxxxxxxx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>host</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># bundle small files into a single file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>20MiB              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Limit for file bundles, 20MiB for object storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>bundle_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>128MiB              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Target size for file bundles, 128MiB for object storage</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enable AES encryption for remote backup repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest.MyPass   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 设置一个加密密码，pgBackRest 备份仓库的加密密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backup by time on minio repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># keep full backup for the last 14 days</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后在 <code>all.vars.pgbackrest_mehod</code> 中指定使用 <code>aliyun</code> 备份仓库，重置 pgBackrest 备份：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t pgbackrest
</span></span></code></pre></div><p>Pigsty 会将备份仓库切换到外部对象存储上，更多备份配置可以参考 <a href=/docs/pgsql/backup>PostgreSQL 备份</a> 文档。</p><hr><h2 id=进阶主题使用smtp>进阶主题：使用SMTP</h2><p>你可以使用 SMTP 来发送邮件，修改 supabase 应用配置，添加 SMTP 信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># supa group</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># supa group vars</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># supa group app list</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>supabase</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># the supabase app</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># the supabase app conf entries</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_HOST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>smtpdm.aliyun.com:80</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_USER</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>no_reply@mail.your.domain.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_PASS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your_email_user_password</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_SENDER_NAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MySupabase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SMTP_ADMIN_EMAIL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>adminxxx@mail.your.domain.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ENABLE_ANONYMOUS_USERS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>不要忘了使用 <code>app.yml</code> 来重载配置</p><hr><h2 id=进阶主题真高可用>进阶主题：真·高可用</h2><p>经过这些配置，您拥有了一个带公网域名，HTTPS 证书，SMTP，PITR 备份，监控，IaC，以及 400+ 扩展的企业级 Supabase （基础单机版）。
高可用的配置请参考 Pigsty 其他部份的文档，如果您懒得阅读学习，我们提供手把手扶上马的 Supabase 自建专家咨询服务 —— ¥2000 元免去折腾与下载的烦恼。</p><p>单节点的 RTO / RPO 依赖外部对象存储服务提供兜底，如果您的这个节点挂了，外部 S3 存储中保留了备份，您可以在新的节点上重新部署 Supabase，然后从备份中恢复。
这样的部署在故障时可以提供一个最低标准的 RTO （小时级恢复时长）/ RPO （MB级数据损失）<a href=/docs/pgsql/backup>兜底容灾水平</a> 兜底。</p><p>如果想要达到 RTO &lt; 30s ，切换零数据丢失，那么需要使用多节点进行高可用部署，这涉及到：</p><ul><li><a href=/docs/etcd/>ETCD</a>： DCS 需要使用三个节点或以上，才能容忍一个节点的故障。</li><li><a href=/docs/pgsql/>PGSQL</a>： PGSQL 同步提交不丢数据模式，建议使用至少三个节点。</li><li><a href=/docs/infra/>INFRA</a>：监控基础设施故障影响稍小，建议生产环境使用双副本</li><li>Supabase 无状态容器本身也可以是多节点的副本，可以实现高可用。</li></ul><p>在这种情况下，您还需要修改 PostgreSQL 与 MinIO 的接入点，使用 DNS / L2 VIP / HAProxy 等 <a href=/docs/pgsql/service#%E6%8E%A5%E5%85%A5%E6%9C%8D%E5%8A%A1>高可用接入点</a>
关于这些部分，您只需参考 Pigsty 中各个模块的文档进行配置部署即可。
建议您参考 <a href=https://github.com/pgsty/pigsty/blob/main/conf/ha/trio.yml><code>conf/ha/trio.yml</code></a> 与 <a href=https://github.com/pgsty/pigsty/blob/main/conf/ha/trio.yml><code>conf/ha/safe.yml</code></a> 中的配置，将集群规模升级到三节点或以上。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1e18b4f399056e4a9b1713040a804b17>2 - Odoo：自建开源 ERP</h1><div class=lead>如何拉起开箱即用的企业级应用全家桶 Odoo，并使用 Pigsty 管理其后端 PostgreSQL 数据库。</div><p><a href=https://www.odoo.com/>Odoo</a> 是一个开源企业资源规划 (ERP) 软件，提供一整套业务应用程序，包括 CRM、销售、采购、库存、生产、会计和其他管理功能。Odoo 是一个典型的 Web 应用程序，使用 PostgreSQL 作为底层数据库。</p><blockquote><p>您的所有业务，都在一个平台上，简单、高效且实惠</p></blockquote><p>公开演示（不一定开放）：http://odoo.pigsty.io, 用户名: <code>test@pigsty.io</code>, 密码: <code>pigsty</code></p><hr><h2 id=快速开始>快速开始</h2><p>在运行兼容操作系统的全新 Linux x86 / ARM 服务器上执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./bootstrap                <span style=color:#8f5902;font-style:italic># 安装 ansible</span>
</span></span><span style=display:flex><span>./configure -c app/odoo    <span style=color:#8f5902;font-style:italic># 使用 odoo 配置（请在 pigsty.yml 中更改凭据）</span>
</span></span><span style=display:flex><span>./deploy.yml               <span style=color:#8f5902;font-style:italic># 安装 pigsty</span>
</span></span><span style=display:flex><span>./docker.yml               <span style=color:#8f5902;font-style:italic># 安装 docker compose</span>
</span></span><span style=display:flex><span>./app.yml                  <span style=color:#8f5902;font-style:italic># 使用 docker 启动 odoo 无状态部分</span>
</span></span></code></pre></div><p>Odoo 默认监听在 8069 端口，您可以通过浏览器访问 <code>http://&lt;ip>:8069</code>。默认的用户名和密码都是 <code>admin</code>。</p><p>您可以在浏览器所在主机（<code>/etc/hosts</code>）添加一条解析记录 <code>odoo.pigsty</code> 指向您的服务器，这样您就可以通过 <code>http://odoo.pigsty</code> 访问 Odoo 网络界面了。</p><p>如果您想要通过 SSL/HTTPS 访问 Odoo，您需要使用真正的 SSL 证书，或者信任 Pigsty 自动生成的自签名 CA 证书。（当然，在 Chrome 浏览器中，您也可以使用敲击键入 <code>thisisunsafe</code> 来绕过证书验证）</p><hr><h2 id=配置模板>配置模板</h2><p><a href=https://github.com/pgsty/pigsty/blob/main/conf/app/odoo.yml><code>conf/app/odoo.yml</code></a> 定义了一个模板配置文件，包含单个 Odoo 实例所需的资源。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Odoo 应用程序（默认用户名和密码：admin/admin）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>odoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 指定要安装的应用程序名称（在 apps 中）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 定义所有应用程序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>odoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># 应用程序名称，应该有对应的 ~/pigsty/app/odoo 文件夹</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 要创建的可选目录</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>path: /data/odoo         ,state: directory, owner: 100, group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>101</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>path: /data/odoo/webdata ,state: directory, owner: 100, group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>101</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>path: /data/odoo/addons  ,state: directory, owner: 100, group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>101</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 覆盖 /opt/&lt;app&gt;/.env 配置文件</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PG_HOST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># postgres 主机</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PG_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5432</span><span style=color:#f8f8f8>                   </span><span style=color:#8f5902;font-style:italic># postgres 端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PG_USERNAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres 用户</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PG_PASSWORD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Odoo       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># postgres 密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ODOO_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8069</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># odoo 应用程序端口</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ODOO_DATA</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/odoo/webdata  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># odoo webdata</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ODOO_ADDONS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/odoo/addons </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># odoo 插件</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ODOO_DBNAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo              </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># odoo 数据库名称</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>ODOO_VERSION</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>19.0</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># odoo 镜像版本</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Odoo 数据库</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-odoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-odoo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: odoo    ,password: DBUser.Odoo ,pgbouncer: true ,roles: [ dbrole_admin ] ,createdb: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for odoo service }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: odoo_ro ,password: DBUser.Odoo ,pgbouncer: true ,roles: [ dbrole_readonly ]  ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read only user for odoo service  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: odoo_rw ,password: DBUser.Odoo ,pgbouncer: true ,roles: [ dbrole_readwrite ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read write user for odoo service }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: odoo ,owner: odoo ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo main database  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: all ,db: all ,addr: 172.17.0.0/16  ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow access from local docker network&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#minio: { hosts: { 10.10.10.10: { minio_seq: 1 } }, vars: { minio_cluster: minio } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                               </span><span style=color:#8f5902;font-style:italic># 全局变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.1.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty 版本字符串</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 管理节点 ip 地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 上游镜像区域：default|china|europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 节点调优规格：oltp,olap,tiny,crit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgsql 调优规格：{oltp,olap,tiny,crit}.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 在应用程序组上启用 docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#docker_registry_mirrors: [&#34;https://docker.1panel.live&#34;,&#34;https://docker.1ms.run&#34;,&#34;https://docker.xuanyuan.me&#34;,&#34;https://registry-1.docker.io&#34;]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># 下载包和拉取 docker 镜像时的全局代理环境</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#http_proxy:  127.0.0.1:12345   # 在此处添加代理环境以下载包或拉取镜像</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#https_proxy: 127.0.0.1:12345   # 通常代理格式为 http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#all_proxy:   127.0.0.1:12345</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 域名和上游服务器</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home  </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>minio </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>odoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># nginx server config for odoo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo.pigsty           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为您自己的域名！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:8069&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># odoo 服务端点：IP:PORT</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 添加 websocket 支持</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo.pigsty          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># certbot 证书名称，使用 `make cert` 申请</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>node,infra,pgsql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 凭据：务必更改这些密码！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_view_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Viewer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>patroni_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Patroni.API</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.MinIO</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd_root_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Etcd.Root</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=基础>基础</h2><p>检查 <code>.env</code> 文件中的可配置环境变量：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://hub.docker.com/_/odoo#</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_HOST</span><span style=color:#ce5c00;font-weight:700>=</span>10.10.10.10
</span></span><span style=display:flex><span><span style=color:#000>PG_PORT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5432</span>
</span></span><span style=display:flex><span><span style=color:#000>PG_USER</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_odoo
</span></span><span style=display:flex><span><span style=color:#000>PG_PASS</span><span style=color:#ce5c00;font-weight:700>=</span>DBUser.Odoo
</span></span><span style=display:flex><span><span style=color:#000>ODOO_PORT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>8069</span>
</span></span></code></pre></div><p>然后使用以下命令启动 odoo：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up  <span style=color:#8f5902;font-style:italic># docker compose up</span>
</span></span></code></pre></div><p>访问 <a href=http://ddl.pigsty/>http://ddl.pigsty</a> 或 http://10.10.10.10:8887</p><h2 id=makefile>Makefile</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># 在最小模式下使用 docker compose 启动 odoo</span>
</span></span><span style=display:flex><span>make run        <span style=color:#8f5902;font-style:italic># 使用 docker 启动 odoo，本地数据目录和外部 PostgreSQL</span>
</span></span><span style=display:flex><span>make view       <span style=color:#8f5902;font-style:italic># 打印 odoo 访问点</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f odoo 日志</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># 使用 jq 检查 odoo</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># 停止 odoo 容器</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># 移除 odoo 容器</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># 拉取最新的 odoo 镜像</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># 移除 odoo 镜像</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># 保存 odoo 镜像到 /tmp/docker/odoo.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># 从 /tmp/docker/odoo.tgz 加载 odoo 镜像</span>
</span></span></code></pre></div><hr><h2 id=使用外部-postgresql>使用外部 PostgreSQL</h2><p>您可以为 Odoo 使用外部 PostgreSQL。Odoo 将在设置期间创建自己的数据库，因此您不需要这样做</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_odoo ,password: DBUser.Odoo ,pgbouncer: true ,roles: [ dbrole_admin ]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>admin user for odoo database } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: odoo ,owner: dbuser_odoo ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>odoo primary database } ]</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>并使用以下命令创建业务用户和数据库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/pgsql-user  pg-meta  dbuser_odoo
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#bin/pgsql-db    pg-meta  odoo     # odoo 将在设置期间创建数据库</span>
</span></span></code></pre></div><p>检查连接性：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql postgres://dbuser_odoo:DBUser.Odoo@10.10.10.10:5432/odoo
</span></span></code></pre></div><hr><h2 id=暴露-odoo-服务>暴露 Odoo 服务</h2><p>通过 nginx 门户 <a href=/docs/infra/admin/portal/>暴露</a> odoo Web 服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># 域名和上游服务器</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty    ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: v.pigsty    ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty    ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vlogs        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>odoo         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: odoo.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8069&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># &lt;------ 添加这一行</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>./infra.yml -t nginx  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 设置 nginx 基础设施门户</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=odoo-插件>Odoo 插件</h2><p>社区中有很多 Odoo 模块可用，您可以通过下载并将它们放在 <code>addons</code> 文件夹中来安装它们。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>./addons:/mnt/extra-addons</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>您可以将 <code>./addons</code> 目录挂载到容器中的 <code>/mnt/extra-addons</code>，然后下载并解压到 <code>addons</code> 文件夹，</p><p>要启用插件模块，首先进入 <a href=https://www.odoo.com/documentation/19.0/applications/general/developer_mode.html>开发者模式</a></p><blockquote><p>设置 -> 通用设置 -> 开发者工具 -> 激活开发者模式</p></blockquote><p>然后转到 > 应用程序 -> 更新应用程序列表，然后您可以找到额外的插件并从面板安装。</p><p>常用的 <a href="https://apps.odoo.com/apps/modules/browse?order=Downloads">免费</a> 插件：<a href=https://apps.odoo.com/apps/modules/19.0/base_accounting_kit/>会计套件</a></p><hr><h2 id=演示>演示</h2><p>查看公共演示：<a href=http://odoo.pigsty.io/>http://odoo.pigsty.io</a>，用户名：<code>test@pigsty.io</code>，密码：<code>pigsty</code></p><p>如果您想通过 SSL 访问 odoo，您必须在浏览器中信任 <code>files/pki/ca/ca.crt</code>（或在 chrome 中使用肮脏的黑客 <code>thisisunsafe</code>）</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cc85a499c2128f8ef2658df26b2566ad>3 - Dify：AI 工作流平台</h1><div class=lead>如何使用 Pigsty 自建 AI Workflow LLMOps 平台 —— Dify，并使用外部 PostgreSQL，PGVector，Redis 作为存储？</div><p><a href=https://dify.ai/zh><strong>Dify</strong></a> 是一个生成式 AI 应用创新引擎和开源 LLM 应用开发平台。它提供从 Agent 构建到 AI 工作流编排、RAG 检索和模型管理的能力，帮助用户轻松构建和运营生成式 AI 原生应用程序。</p><p>Pigsty 提供对自托管 Dify 的支持，允许您使用单个命令部署 Dify，同时将关键状态存储在外部管理的 PostgreSQL 中。您可以在同一个 PostgreSQL 实例中使用 pgvector 作为向量数据库，进一步简化部署。</p><ul><li><a href=#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B>快速开始</a></li><li><a href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%87%AA%E6%89%98%E7%AE%A1>为什么要自托管</a></li><li><a href=#%E5%AE%89%E8%A3%85>安装</a></li><li><a href=#%E9%85%8D%E7%BD%AE>配置</a></li><li><a href=#%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95>检查清单</a></li><li><a href=#%E5%9F%9F%E5%90%8D%E5%92%8C-ssl>域名和 SSL</a></li><li><a href=#%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD>文件备份</a></li></ul><blockquote><p>当前 Pigsty v4.1 支持 Dify 版本：v1.8.1</p></blockquote><hr><h2 id=快速开始>快速开始</h2><p>在运行 <a href=/docs/deploy/prepare><strong>兼容操作系统</strong></a> 的全新 Linux x86 / ARM 服务器上执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./bootstrap                <span style=color:#8f5902;font-style:italic># 安装 Pigsty 依赖</span>
</span></span><span style=display:flex><span>./configure -c app/dify    <span style=color:#8f5902;font-style:italic># 使用 Dify 配置模板</span>
</span></span><span style=display:flex><span>vi pigsty.yml              <span style=color:#8f5902;font-style:italic># 编辑密码、域名、密钥等</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./deploy.yml               <span style=color:#8f5902;font-style:italic># 安装 Pigsty</span>
</span></span><span style=display:flex><span>./docker.yml               <span style=color:#8f5902;font-style:italic># 安装 Docker 和 Compose</span>
</span></span><span style=display:flex><span>./app.yml                  <span style=color:#8f5902;font-style:italic># 安装 Dify</span>
</span></span></code></pre></div><p>Dify 默认监听端口 <code>5001</code>。您可以通过浏览器访问 <code>http://&lt;ip>:5001</code> 并设置您的初始用户凭据来登录。</p><p>Dify 启动后，您可以安装各种扩展、配置系统模型并开始使用它！</p><hr><h2 id=为什么要自托管>为什么要自托管</h2><p>自托管 Dify 有很多原因，但主要动机是数据安全。Dify 提供的 DockerCompose 模板使用基本的默认数据库镜像，缺乏企业级功能，如高可用性、灾难恢复、监控、IaC 和 PITR 能力。</p><p>Pigsty 为 Dify 优雅地解决了这些问题，基于配置文件使用单个命令部署所有组件，并使用镜像解决中国地区访问挑战。这使得 Dify 部署和交付变得非常顺畅。它一次性处理 PostgreSQL 主数据库、PGVector 向量数据库、MinIO 对象存储、Redis、Prometheus 监控、Grafana 可视化、Nginx 反向代理和免费 HTTPS 证书。</p><p>Pigsty 确保所有 Dify 状态都存储在外部管理的服务中，包括 PostgreSQL 中的元数据和文件系统中的其他数据。通过 Docker Compose 启动的 Dify 实例成为可以随时销毁和重建的无状态应用程序，大大简化了运维。</p><hr><h2 id=安装>安装</h2><p>让我们从单节点 Dify 部署开始。我们稍后将介绍生产高可用部署方法。</p><p>首先，使用 Pigsty 的 <a href=/docs/setup/install>标准安装过程</a> 安装 Dify 所需的 PostgreSQL 实例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./bootstrap               <span style=color:#8f5902;font-style:italic># 准备 Pigsty 依赖</span>
</span></span><span style=display:flex><span>./configure -c app/dify   <span style=color:#8f5902;font-style:italic># 使用 Dify 应用程序模板</span>
</span></span><span style=display:flex><span>vi pigsty.yml             <span style=color:#8f5902;font-style:italic># 编辑配置文件，修改域名和密码</span>
</span></span><span style=display:flex><span>./deploy.yml              <span style=color:#8f5902;font-style:italic># 安装 Pigsty 和各种数据库</span>
</span></span></code></pre></div><p>当您使用 <code>./configure -c app/dify</code> 命令时，Pigsty 会根据 <a href=https://github.com/pgsty/pigsty/blob/main/conf/app/dify.yml><code>conf/app/dify.yml</code></a> 模板和您当前的环境自动生成配置文件。
您应该根据实际需要在生成的 <code>pigsty.yml</code> 配置文件中修改密码、域名和其他相关参数，然后使用 <code>./deploy.yml</code> 执行标准安装过程。</p><p>接下来，运行 <a href=https://github.com/pgsty/pigsty/blob/main/docker.yml><code>docker.yml</code></a> 安装 Docker 和 Docker Compose，然后使用 <a href=https://github.com/pgsty/pigsty/blob/main/app.yml><code>app.yml</code></a> 完成 Dify 部署：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./docker.yml              <span style=color:#8f5902;font-style:italic># 安装 Docker 和 Docker Compose</span>
</span></span><span style=display:flex><span>./app.yml                 <span style=color:#8f5902;font-style:italic># 使用 Docker 部署 Dify 无状态组件</span>
</span></span></code></pre></div><p>您可以在本地网络上通过 <code>http://&lt;your_ip_address>:5001</code> 访问 Dify Web 管理界面。</p><p>首次登录时会提示设置默认用户名、邮箱和密码。</p><p>您也可以使用本地解析的占位符域名 <code>dify.pigsty</code>，或按照下面的配置使用带有 HTTPS 证书的真实域名。</p><hr><h2 id=配置>配置</h2><p>当您使用 <code>./configure -c app/dify</code> 命令进行配置时，Pigsty 会根据 <a href=https://github.com/pgsty/pigsty/blob/main/conf/app/dify.yml><code>conf/app/dify.yml</code></a> 模板和您当前的环境自动生成配置文件。以下是默认配置的详细说明：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Dify 应用程序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 指定要安装的应用程序名称（在 apps 中）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># 定义所有应用程序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># 应用程序名称，应该有对应的 ~/pigsty/app/dify 文件夹</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 要创建的数据目录</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>path: /data/dify ,state: directory ,mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0755</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 覆盖 /opt/dify/.env 配置文件</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 更改域名、镜像、代理、密钥</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>NGINX_SERVER_NAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 用于签名和加密的密钥，使用 `openssl rand -base64 42` 生成（务必更改！）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>SECRET_KEY</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sk-somerandomkey</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 默认使用端口 5001 暴露 DIFY nginx 服务</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DIFY_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5001</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># dify 文件存储位置？默认是 ./volume，我们将使用上面创建的另一个卷</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DIFY_DATA</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/dify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 代理和镜像设置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>#PIP_MIRROR_URL: https://pypi.tuna.tsinghua.edu.cn/simple</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>#SANDBOX_HTTP_PROXY: http://10.10.10.10:12345</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>#SANDBOX_HTTPS_PROXY: http://10.10.10.10:12345</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 数据库凭据</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DB_USERNAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DB_PASSWORD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>difyai123456</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DB_HOST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DB_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5432</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>DB_DATABASE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>VECTOR_STORE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgvector</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_HOST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5432</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_USER</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_PASSWORD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>difyai123456</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_DATABASE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_MIN_CONNECTION</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGVECTOR_MAX_CONNECTION</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dify ,password: difyai123456 ,pgbouncer: true ,roles: [ dbrole_admin ] ,superuser: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dify        ,owner: dify ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify main database  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dify_plugin ,owner: dify ,revokeconn: true ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify plugin_daemon database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>pg_hba_rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>user: dify ,db: all ,addr: 172.17.0.0/16  ,auth: pwd ,title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;allow dify access from local docker network&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>node_crontab</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;00 01 * * * postgres /pg/bin/pg-backup full&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 每天凌晨 1 点进行完整备份</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#minio: { hosts: { 10.10.10.10: { minio_seq: 1 } }, vars: { minio_cluster: minio } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                               </span><span style=color:#8f5902;font-style:italic># 全局变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.1.0                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pigsty 版本字符串</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 管理节点 ip 地址</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 上游镜像区域：default|china|europe</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_tune</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp                  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 节点调优规格：oltp,olap,tiny,crit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>oltp.yml                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># pgsql 调优规格：{oltp,olap,tiny,crit}.yml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># 在应用程序组上启用 docker</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#docker_registry_mirrors: [&#34;https://docker.1panel.live&#34;,&#34;https://docker.1ms.run&#34;,&#34;https://docker.xuanyuan.me&#34;,&#34;https://registry-1.docker.io&#34;]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>proxy_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># 下载包和拉取 docker 镜像时的全局代理环境</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>no_proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.tsinghua.edu.cn&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#http_proxy:  127.0.0.1:12345   # 在此处添加代理环境以下载包或拉取镜像</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#https_proxy: 127.0.0.1:12345   # 通常代理格式为 http://user:pass@proxy.xxx.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#all_proxy:   127.0.0.1:12345</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 域名和上游服务器</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home  </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic>#minio : { domain: m.pigsty ,endpoint: &#34;${admin_ip}:9001&#34; ,scheme: https ,websocket: true }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># dify 的 nginx 服务器配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 替换为您自己的域名！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:5001&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># dify 服务端点：IP:PORT</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># 添加 websocket 支持</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># certbot 证书名称，使用 `make cert` 申请</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repo_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_repo_modules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>node,infra,pgsql</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 凭据：务必更改这些密码！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#----------------------------------#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>grafana_view_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Viewer</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.DBA</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_monitor_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Monitor</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_replication_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Replicator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>patroni_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Patroni.API</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_admin_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.MinIO</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd_root_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Etcd.Root</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=检查清单>检查清单</h2><p>以下是您需要关注的配置项检查清单：</p><ul><li>硬件/软件：<a href=/docs/deploy/prepare>准备所需的机器资源</a>：Linux <code>x86_64/arm64</code> 服务器，<a href=/docs/deploy/prepare>主流 Linux 操作系统</a> 的全新安装</li><li>网络/权限：<a href=/docs/deploy/admin#ssh>SSH</a> 免密登录访问权限，用户具有 <a href=/docs/deploy/admin#sudo>免密 sudo 权限</a></li><li>确保机器在内网中有静态 IPv4 网络地址且可访问互联网</li><li>如果通过公网访问，确保您有可用的域名指向当前节点的 <strong>公网 IP 地址</strong></li><li>确保使用 <code>app/dify</code> 配置模板并根据需要修改参数<ul><li><code>configure -c app/dify</code>，并输入节点的内网主 IP 地址，或通过 <code>-i &lt;primary_ip></code> 命令行参数指定</li></ul></li><li>您是否修改了所有密码相关的配置参数？【可选】<ul><li><a href=/docs/infra/param/#grafana_admin_password><code>grafana_admin_password</code></a>：<code>pigsty</code>，Grafana 管理员密码</li><li><a href=/docs/pgsql/param/#pg_admin_password><code>pg_admin_password</code></a>：<code>DBUser.DBA</code>，PG 超级用户密码</li><li><a href=/docs/pgsql/param/#pg_monitor_password><code>pg_monitor_password</code></a>：<code>DBUser.Monitor</code>，PG 监控用户密码</li><li><a href=/docs/pgsql/param/#pg_replication_password><code>pg_replication_password</code></a>：<code>DBUser.Replicator</code>，PG 复制用户密码</li><li><a href=/docs/pgsql/param/#patroni_password><code>patroni_password</code></a>：<code>Patroni.API</code>，Patroni HA 组件密码</li><li><a href=/docs/node/param/#haproxy_admin_password><code>haproxy_admin_password</code></a>：<code>pigsty</code>，负载均衡器管理密码</li></ul></li><li>您是否修改了 PostgreSQL 集群业务用户密码和使用这些密码的应用程序配置？<ul><li>默认用户名 <code>dify</code> 和密码 <code>difyai123456</code> 是 Pigsty 为 Dify 生成的，请根据实际情况修改</li><li>在 Dify 的配置块中，请相应修改 <code>DB_USERNAME</code>、<code>DB_PASSWORD</code>、<code>PGVECTOR_USER</code>、<code>PGVECTOR_PASSWORD</code> 等参数</li></ul></li><li>您是否修改了 Dify 的默认加密密钥？<ul><li>您可以使用 <code>openssl rand -base64 42</code> 随机生成密码字符串并填入 <code>SECRET_KEY</code> 参数</li></ul></li><li>您是否修改了 Dify 使用的域名？<ul><li>将占位符域名 <code>dify.pigsty</code> 替换为您的实际域名，例如 <code>dify.pigsty.cc</code></li><li>您可以使用 <code>sed -ie 's/dify.pigsty/dify.pigsty.cc/g' pigsty.yml</code> 修改 Dify 的域名</li></ul></li></ul><hr><h2 id=域名和-ssl>域名和 SSL</h2><p>如果您想使用带有 HTTPS 证书的真实域名，需要在 <code>pigsty.yml</code> 配置文件中修改：</p><ul><li><a href=/docs/infra/param/#infra_portal><code>infra_portal</code></a> 参数的 <code>dify</code> 域名</li><li>最好指定一个邮箱地址 <a href=/docs/infra/param/#certbot_email><code>certbot_email</code></a> 用于接收证书过期通知</li><li>配置 Dify 的 <code>NGINX_SERVER_NAME</code> 参数来指定您的实际域名</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># 集群定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                              </span><span style=color:#8f5902;font-style:italic># Dify 组</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># Dify 组变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># 应用程序配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                        </span><span style=color:#8f5902;font-style:italic># Dify 应用程序定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># Dify 应用程序配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>NGINX_SERVER_NAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                                </span><span style=color:#8f5902;font-style:italic># 全局参数</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>#certbot_sign: true                # 使用 Certbot 申请免费 HTTPS 证书</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>certbot_email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 证书申请邮箱，用于过期通知，可选</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 配置 Nginx 服务器</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>dify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># Dify 服务器定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 请在此处替换为您自己的域名！</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:5001&#34;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 请在此处指定 Dify 的 IP 和端口（默认自动配置）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                </span><span style=color:#8f5902;font-style:italic># Dify 需要启用 websocket</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dify.pigsty          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 指定 Certbot 证书名称</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>使用以下命令申请 Nginx 证书：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 申请证书，也可以手动执行 /etc/nginx/sign-cert 脚本</span>
</span></span><span style=display:flex><span>make cert
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 上述 Makefile 快捷命令实际执行以下剧本任务：</span>
</span></span><span style=display:flex><span>./infra.yml -t nginx_certbot,nginx_reload -e <span style=color:#000>certbot_sign</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p>执行 <code>app.yml</code> 剧本重新部署 Dify 服务以使 <code>NGINX_SERVER_NAME</code> 配置生效。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./app.yml
</span></span></code></pre></div><hr><h2 id=文件备份>文件备份</h2><p>您可以使用 <code>restic</code> 备份 Dify 的文件存储（默认位于 <code>/data/dify</code> 目录），使用以下命令进行备份：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>RESTIC_REPOSITORY</span><span style=color:#ce5c00;font-weight:700>=</span>/data/backups/dify   <span style=color:#8f5902;font-style:italic># 指定 dify 备份目录</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>RESTIC_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>some-strong-password   <span style=color:#8f5902;font-style:italic># 指定备份加密密码</span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#4e9a06>${</span><span style=color:#000>RESTIC_REPOSITORY</span><span style=color:#4e9a06>}</span>                 <span style=color:#8f5902;font-style:italic># 创建 dify 备份目录</span>
</span></span><span style=display:flex><span>restic init
</span></span></code></pre></div><p>创建 Restic 备份仓库后，您可以使用以下命令备份 Dify：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>RESTIC_REPOSITORY</span><span style=color:#ce5c00;font-weight:700>=</span>/data/backups/dify   <span style=color:#8f5902;font-style:italic># 指定 dify 备份目录</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>RESTIC_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>some-strong-password   <span style=color:#8f5902;font-style:italic># 指定备份加密密码</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>restic backup /data/dify                      <span style=color:#8f5902;font-style:italic># 将 /dify 数据目录备份到仓库</span>
</span></span><span style=display:flex><span>restic snapshots                              <span style=color:#8f5902;font-style:italic># 查看备份快照列表</span>
</span></span><span style=display:flex><span>restic restore -t /data/dify 0b11f778         <span style=color:#8f5902;font-style:italic># 将快照 xxxxxx 恢复到 /data/dify</span>
</span></span><span style=display:flex><span>restic check                                  <span style=color:#8f5902;font-style:italic># 定期检查仓库完整性</span>
</span></span></code></pre></div><p>另一种更可靠的方法是使用 JuiceFS 将 MinIO 对象存储挂载到 <code>/data/dify</code> 目录，这样您就可以使用 MinIO/S3 存储文件状态。</p><p>如果您想将所有数据存储在 PostgreSQL 中，请考虑"使用 JuiceFS 将文件系统数据存储在 PostgreSQL 中"</p><p>例如，您可以创建另一个 <code>dify_fs</code> 数据库并将其用作 JuiceFS 的元数据存储：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>METAURL</span><span style=color:#ce5c00;font-weight:700>=</span>postgres://dify:difyai123456@:5432/dify_fs
</span></span><span style=display:flex><span><span style=color:#000>OPTIONS</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>  --storage postgres
</span></span><span style=display:flex><span>  --bucket :5432/dify_fs
</span></span><span style=display:flex><span>  --access-key dify
</span></span><span style=display:flex><span>  --secret-key difyai123456
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>${</span><span style=color:#000>METAURL</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>  jfs
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>juicefs format <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>OPTIONS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>         <span style=color:#8f5902;font-style:italic># 创建 PG 文件系统</span>
</span></span><span style=display:flex><span>juicefs mount <span style=color:#4e9a06>${</span><span style=color:#000>METAURL</span><span style=color:#4e9a06>}</span> /data/dify -d <span style=color:#8f5902;font-style:italic># 后台挂载到 /data/dify 目录</span>
</span></span><span style=display:flex><span>juicefs bench /data/dify               <span style=color:#8f5902;font-style:italic># 测试性能</span>
</span></span><span style=display:flex><span>juicefs umount /data/dify              <span style=color:#8f5902;font-style:italic># 停止挂载</span>
</span></span></code></pre></div><hr><h2 id=参考>参考</h2><p><a href=https://docs.dify.ai/learn-more/faq/install-faq>Dify 自托管常见问题</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-de0128bd4345697963d59e764c35c90b>4 - 业务软件</h1><p>企业级开源软件模板</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b94f778cc05c5fe2e52f126f032753e9>5 - NocoDB：开源 Airtable</h1><div class=lead>使用 NocoDB 将 PostgreSQL 数据库转变为智能电子表格，无代码数据库应用平台。</div><p><a href=https://nocodb.com/><strong>NocoDB</strong></a> 是一个开源的 Airtable 替代方案，可以将任何数据库转变为智能电子表格。</p><p>它提供了丰富的用户界面，让您无需编写代码即可创建强大的数据库应用。NocoDB 支持 PostgreSQL、MySQL、SQL Server 等多种数据库，是构建内部工具和数据管理系统的理想选择。</p><h2 id=快速开始>快速开始</h2><p>在 Pigsty 软件模板目录中提供了 NocoDB 的 Docker Compose 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/nocodb
</span></span></code></pre></div><p>检查并修改 <code>.env</code> 配置文件（根据需要调整数据库连接等配置）。</p><p>启动服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 使用 Docker Compose 启动 NocoDB</span>
</span></span></code></pre></div><p>访问 NocoDB：</p><ul><li>默认地址： <a href=http://nocodb.pigsty>http://nocodb.pigsty</a></li><li>备用地址： http://10.10.10.10:8080</li><li>首次访问需要创建管理员账户</li></ul><h2 id=管理命令>管理命令</h2><p>Pigsty 提供了便捷的 Makefile 命令来管理 NocoDB 服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up      <span style=color:#8f5902;font-style:italic># 启动 NocoDB 服务</span>
</span></span><span style=display:flex><span>make run     <span style=color:#8f5902;font-style:italic># 使用 Docker 启动（连接外部 PostgreSQL）</span>
</span></span><span style=display:flex><span>make view    <span style=color:#8f5902;font-style:italic># 显示 NocoDB 访问地址</span>
</span></span><span style=display:flex><span>make log     <span style=color:#8f5902;font-style:italic># 查看容器日志</span>
</span></span><span style=display:flex><span>make info    <span style=color:#8f5902;font-style:italic># 查看服务详细信息</span>
</span></span><span style=display:flex><span>make stop    <span style=color:#8f5902;font-style:italic># 停止服务</span>
</span></span><span style=display:flex><span>make clean   <span style=color:#8f5902;font-style:italic># 停止并移除容器</span>
</span></span><span style=display:flex><span>make pull    <span style=color:#8f5902;font-style:italic># 拉取最新镜像</span>
</span></span><span style=display:flex><span>make rmi     <span style=color:#8f5902;font-style:italic># 移除 NocoDB 镜像</span>
</span></span><span style=display:flex><span>make save    <span style=color:#8f5902;font-style:italic># 保存镜像到 /tmp/nocodb.tgz</span>
</span></span><span style=display:flex><span>make load    <span style=color:#8f5902;font-style:italic># 从 /tmp/nocodb.tgz 加载镜像</span>
</span></span></code></pre></div><h2 id=连接-postgresql>连接 PostgreSQL</h2><p>NocoDB 可以连接到 Pigsty 管理的 PostgreSQL 数据库。</p><p>在 NocoDB 界面中添加新项目时，选择「External Database」，然后输入 PostgreSQL 连接信息：</p><pre tabindex=0><code>主机：10.10.10.10
端口：5432
数据库名：your_database
用户名：your_username
密码：your_password
SSL：禁用（或根据实际情况启用）
</code></pre><p>连接成功后，NocoDB 会自动读取数据库的表结构，您可以通过可视化界面进行数据管理。</p><h2 id=功能特性>功能特性</h2><ul><li><strong>智能电子表格界面</strong>：类似 Excel/Airtable 的用户体验</li><li><strong>多种视图</strong>：网格、表单、看板、日历、画廊视图</li><li><strong>协作功能</strong>：团队协作、权限管理、评论</li><li><strong>API 支持</strong>：自动生成 REST API</li><li><strong>集成能力</strong>：支持 Webhook、Zapier 等集成</li><li><strong>数据导入导出</strong>：支持 CSV、Excel 等格式</li><li><strong>公式和验证</strong>：支持复杂的数据计算和验证规则</li></ul><h2 id=配置说明>配置说明</h2><p>NocoDB 的配置在 <code>.env</code> 文件中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 数据库连接（NocoDB 元数据存储）</span>
</span></span><span style=display:flex><span><span style=color:#000>NC_DB</span><span style=color:#ce5c00;font-weight:700>=</span>pg://postgres:DBUser.Postgres@10.10.10.10:5432/nocodb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># JWT 密钥（建议修改）</span>
</span></span><span style=display:flex><span><span style=color:#000>NC_AUTH_JWT_SECRET</span><span style=color:#ce5c00;font-weight:700>=</span>your-secret-key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 其他配置</span>
</span></span><span style=display:flex><span><span style=color:#000>NC_PUBLIC_URL</span><span style=color:#ce5c00;font-weight:700>=</span>http://nocodb.pigsty
</span></span><span style=display:flex><span><span style=color:#000>NC_DISABLE_TELE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><h2 id=数据持久化>数据持久化</h2><p>NocoDB 的元数据默认存储在外部 PostgreSQL 数据库中，应用数据也可以存储在 PostgreSQL 中。</p><p>如果使用本地存储，数据会保存在 <code>/data/nocodb</code> 目录中。</p><h2 id=安全建议>安全建议</h2><ol><li><strong>修改默认密钥</strong>：在 <code>.env</code> 文件中修改 <code>NC_AUTH_JWT_SECRET</code></li><li><strong>使用强密码</strong>：为管理员账户设置强密码</li><li><strong>配置 HTTPS</strong>：生产环境建议启用 HTTPS</li><li><strong>限制访问</strong>：通过防火墙或 Nginx 限制访问权限</li><li><strong>定期备份</strong>：定期备份 NocoDB 元数据库</li></ol><h2 id=相关链接>相关链接</h2><ul><li>NocoDB 官网： <a href=https://nocodb.com/>https://nocodb.com/</a></li><li>官方文档： <a href=https://docs.nocodb.com/>https://docs.nocodb.com/</a></li><li>GitHub 仓库： <a href=https://github.com/nocodb/nocodb>https://github.com/nocodb/nocodb</a></li><li>Pigsty 软件模板： <a href=https://github.com/Vonng/pigsty/tree/main/app/nocodb>https://github.com/Vonng/pigsty/tree/main/app/nocodb</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a24f4293fdd8dcc354ecc1a0fe74f7da>6 - Teable：AI 无代码数据库</h1><div class=lead>使用 Teable 构建 AI 驱动的无代码数据库应用，提升团队生产力。</div><p><a href=https://teable.io/><strong>Teable</strong></a> 是一个 AI 驱动的无代码数据库平台，专为团队协作和自动化而设计。</p><p>Teable 将数据库的强大功能与电子表格的易用性完美结合，并集成 AI 能力，帮助团队高效地生成、自动化和协作处理数据。</p><h2 id=快速开始>快速开始</h2><p>Teable 需要完整的 Pigsty 环境支持（包括 PostgreSQL、Redis、MinIO）。</p><h3 id=准备环境>准备环境</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>./bootstrap                <span style=color:#8f5902;font-style:italic># 准备本地源与 Ansible</span>
</span></span><span style=display:flex><span>./configure -c app/teable  <span style=color:#8f5902;font-style:italic># 重要：修改默认凭据！</span>
</span></span><span style=display:flex><span>./deploy.yml               <span style=color:#8f5902;font-style:italic># 安装 Pigsty、PostgreSQL、MinIO</span>
</span></span><span style=display:flex><span>./redis.yml                <span style=color:#8f5902;font-style:italic># 安装 Redis 实例</span>
</span></span><span style=display:flex><span>./docker.yml               <span style=color:#8f5902;font-style:italic># 安装 Docker 与 Docker Compose</span>
</span></span><span style=display:flex><span>./app.yml                  <span style=color:#8f5902;font-style:italic># 使用 Docker Compose 安装 Teable</span>
</span></span></code></pre></div><h3 id=访问服务>访问服务</h3><ul><li>默认地址： <a href=http://teable.pigsty>http://teable.pigsty</a></li><li>备用地址： http://10.10.10.10:3000</li><li>首次访问需要注册管理员账户</li></ul><h2 id=管理命令>管理命令</h2><p>在 Pigsty 软件模板目录中管理 Teable：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/teable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make up      <span style=color:#8f5902;font-style:italic># 启动 Teable 服务</span>
</span></span><span style=display:flex><span>make down    <span style=color:#8f5902;font-style:italic># 停止 Teable 服务</span>
</span></span><span style=display:flex><span>make log     <span style=color:#8f5902;font-style:italic># 查看容器日志</span>
</span></span><span style=display:flex><span>make clean   <span style=color:#8f5902;font-style:italic># 清理容器和数据</span>
</span></span></code></pre></div><h2 id=架构说明>架构说明</h2><p>Teable 依赖以下组件：</p><ul><li><strong>PostgreSQL</strong>：存储应用数据和元数据</li><li><strong>Redis</strong>：缓存和会话管理</li><li><strong>MinIO</strong>：对象存储（文件、图片等）</li><li><strong>Docker</strong>：容器运行环境</li></ul><p>确保这些服务在部署 Teable 前已正确安装。</p><h2 id=功能特性>功能特性</h2><ul><li><strong>AI 集成</strong>：内置 AI 助手，自动生成数据、公式和工作流</li><li><strong>智能表格</strong>：强大的表格功能，支持多种字段类型</li><li><strong>自动化工作流</strong>：无代码自动化，提升团队效率</li><li><strong>多视图支持</strong>：网格、表单、看板、日历等多种视图</li><li><strong>团队协作</strong>：实时协作、权限管理、评论</li><li><strong>API 和集成</strong>：自动生成 API，支持 Webhook 集成</li><li><strong>模板库</strong>：丰富的应用模板，快速启动项目</li></ul><h2 id=配置说明>配置说明</h2><p>Teable 的配置通过环境变量管理，主要配置在 <code>docker-compose.yml</code> 中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># PostgreSQL 连接</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>POSTGRES_HOST=10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>POSTGRES_PORT=5432</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>POSTGRES_DB=teable</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>POSTGRES_USER=dbuser_teable</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>POSTGRES_PASSWORD=DBUser.Teable</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Redis 连接</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>REDIS_HOST=10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>REDIS_PORT=6379</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>REDIS_DB=0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MinIO 连接</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>MINIO_ENDPOINT=http://10.10.10.10:9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>MINIO_ACCESS_KEY=minioadmin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>MINIO_SECRET_KEY=minioadmin</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 应用配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>BACKEND_URL=http://teable.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>PUBLIC_ORIGIN=http://teable.pigsty</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>重要</strong>：在生产环境中，请修改所有默认密码和密钥！</p><h2 id=数据持久化>数据持久化</h2><p>Teable 的数据持久化依赖：</p><ul><li><strong>PostgreSQL</strong>：所有结构化数据存储在 PostgreSQL 中</li><li><strong>MinIO</strong>：文件、图片等非结构化数据存储在 MinIO 中</li><li><strong>Redis</strong>：缓存数据（可选持久化）</li></ul><p>定期备份 PostgreSQL 数据库和 MinIO 存储桶以确保数据安全。</p><h2 id=安全建议>安全建议</h2><ol><li><strong>修改默认凭据</strong>：在配置文件中修改所有默认用户名和密码</li><li><strong>启用 HTTPS</strong>：生产环境建议配置 SSL 证书</li><li><strong>配置防火墙</strong>：限制对服务的访问</li><li><strong>定期备份</strong>：定期备份 PostgreSQL 和 MinIO 数据</li><li><strong>更新组件</strong>：及时更新 Teable 和依赖组件的版本</li></ol><h2 id=相关链接>相关链接</h2><ul><li>Teable 官网： <a href=https://teable.io/>https://teable.io/</a></li><li>官方文档： <a href=https://help.teable.io/>https://help.teable.io/</a></li><li>GitHub 仓库： <a href=https://github.com/teableio/teable>https://github.com/teableio/teable</a></li><li>Pigsty 软件模板： <a href=https://github.com/Vonng/pigsty/tree/main/app/teable>https://github.com/Vonng/pigsty/tree/main/app/teable</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e4d7871bc5c532d89a4e76a28e49ee3b>7 - Gitea：自建简易代码托管平台</h1><div class=lead>使用Docker拉起Gitea，并使用Pigsty的PG作为外部的元数据库</div><p>公开Demo地址：<a href=http://git.pigsty.cc>http://git.pigsty.cc</a></p><p><img src=/img/docs/app/gitea.jpeg alt></p><h2 id=太长不看>太长；不看</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/gitea<span style=color:#000;font-weight:700>;</span> make up
</span></span></code></pre></div><p>在本例中，Gitea 默认使用 8889 端口，您可以访问以下位置：</p><p><a href=http://git.pigsty>http://git.pigsty</a> 或 http://10.10.10.10:8889</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up      <span style=color:#8f5902;font-style:italic># pull up gitea with docker-compose in minimal mode</span>
</span></span><span style=display:flex><span>make run     <span style=color:#8f5902;font-style:italic># launch gitea with docker , local data dir and external PostgreSQL</span>
</span></span><span style=display:flex><span>make view    <span style=color:#8f5902;font-style:italic># print gitea access point</span>
</span></span><span style=display:flex><span>make log     <span style=color:#8f5902;font-style:italic># tail -f gitea logs</span>
</span></span><span style=display:flex><span>make info    <span style=color:#8f5902;font-style:italic># introspect gitea with jq</span>
</span></span><span style=display:flex><span>make stop    <span style=color:#8f5902;font-style:italic># stop gitea container</span>
</span></span><span style=display:flex><span>make clean   <span style=color:#8f5902;font-style:italic># remove gitea container</span>
</span></span><span style=display:flex><span>make pull    <span style=color:#8f5902;font-style:italic># pull latest gitea image</span>
</span></span><span style=display:flex><span>make rmi     <span style=color:#8f5902;font-style:italic># remove gitea image</span>
</span></span><span style=display:flex><span>make save    <span style=color:#8f5902;font-style:italic># save gitea image to /tmp/gitea.tgz</span>
</span></span><span style=display:flex><span>make load    <span style=color:#8f5902;font-style:italic># load gitea image from /tmp</span>
</span></span></code></pre></div><h2 id=使用外部的postgresql>使用外部的PostgreSQL</h2><p>Pigsty默认使用容器内的 Sqlite 作为元数据存储，您可以让 Gitea 通过连接串环境变量使用外部的PostgreSQL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres://dbuser_gitea:DBUser.gitea@10.10.10.10:5432/gitea</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: gitea, owner: dbuser_gitea, comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>gitea primary database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_gitea , password: DBUser.gitea, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ab8b5d6530871db26391dfb780764601>8 - Wiki.js：维基百科站</h1><div class=lead>如何使用 Wiki.js 搭建你自己的开源维基百科，并使用 Pigsty 管理的PG作为持久数据存储</div><p>公开Demo地址：<a href=http://wiki.pigsty.cc>http://wiki.pigsty.cc</a></p><p><img src=/img/docs/app/wiki.jpg alt></p><h2 id=太长不看>太长;不看</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> app/wiki <span style=color:#000;font-weight:700>;</span> docker-compose up -d
</span></span></code></pre></div><h2 id=准备数据库>准备数据库</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres://dbuser_wiki:DBUser.Wiki@10.10.10.10:5432/wiki</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: wiki, owner: dbuser_wiki, revokeconn: true , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>wiki the api gateway database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_wiki, password: DBUser.Wiki , pgbouncer: true , roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/createuser pg-meta dbuser_wiki
</span></span><span style=display:flex><span>bin/createdb   pg-meta wiki
</span></span></code></pre></div><h2 id=容器配置>容器配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>wiki</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>container_name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>wiki</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>requarks/wiki:2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_TYPE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>postgres</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_HOST</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5432</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_USER</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>dbuser_wiki</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_PASS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>DBUser.Wiki</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>DB_NAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>wiki</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>unless-stopped</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#34;9002:3000&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=access>Access</h2><ul><li>Default Port for wiki: 9002</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add to nginx_upstream</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: wiki  , domain: wiki.pigsty.cc , endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:9002&#34;</span><span style=color:#f8f8f8>   </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t nginx_config
</span></span><span style=display:flex><span>ansible all -b -a <span style=color:#4e9a06>&#39;nginx -s reload&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b2e9576ebd029b6f66db394de58e3112>9 - Mattermost：开源 IM</h1><div class=lead>使用 Mattermost 构建私有化的团队协作平台，开源的 Slack 替代方案。</div><p><a href=https://mattermost.com/><strong>Mattermost</strong></a> 是一个开源的团队协作和消息平台。</p><p>Mattermost 提供即时消息、文件共享、音视频通话等功能，是 Slack 和 Microsoft Teams 的开源替代方案，特别适合需要私有化部署的企业。</p><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/mattermost
</span></span><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 使用 Docker Compose 启动 Mattermost</span>
</span></span></code></pre></div><p>访问地址： <a href=http://mattermost.pigsty>http://mattermost.pigsty</a> 或 http://10.10.10.10:8065</p><p>首次访问需要创建管理员账户。</p><h2 id=功能特性>功能特性</h2><ul><li><strong>即时消息</strong>：个人和群组聊天</li><li><strong>频道管理</strong>：公开和私有频道</li><li><strong>文件共享</strong>：安全的文件存储和共享</li><li><strong>音视频通话</strong>：内置通话功能</li><li><strong>集成能力</strong>：支持 Webhook、Bot、插件</li><li><strong>移动应用</strong>：iOS 和 Android 客户端</li><li><strong>企业级</strong>：SSO、LDAP、合规性功能</li></ul><h2 id=连接-postgresql>连接 PostgreSQL</h2><p>Mattermost 使用 PostgreSQL 存储数据，在配置中指定连接信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>MM_SQLSETTINGS_DRIVERNAME</span><span style=color:#ce5c00;font-weight:700>=</span>postgres
</span></span><span style=display:flex><span><span style=color:#000>MM_SQLSETTINGS_DATASOURCE</span><span style=color:#ce5c00;font-weight:700>=</span>postgres://dbuser_mm:DBUser.MM@10.10.10.10:5432/mattermost
</span></span></code></pre></div><h2 id=相关链接>相关链接</h2><ul><li>Mattermost 官网： <a href=https://mattermost.com/>https://mattermost.com/</a></li><li>官方文档： <a href=https://docs.mattermost.com/>https://docs.mattermost.com/</a></li><li>GitHub 仓库： <a href=https://github.com/mattermost/mattermost>https://github.com/mattermost/mattermost</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b3e8ff513ff4c90114324ee5b19b8015>10 - Maybe：个人财务管理</h1><div class=lead>使用 Maybe 管理个人财务，开源的 Mint/Personal Capital 替代方案。</div><p><a href=https://github.com/maybe-finance/maybe><strong>Maybe</strong></a> 是一个开源的个人财务管理应用。</p><p>Maybe 提供财务跟踪、预算管理、投资分析等功能，是 Mint 和 Personal Capital 的开源替代方案，让您完全掌控自己的财务数据。</p><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/maybe
</span></span><span style=display:flex><span>cp .env.example .env
</span></span><span style=display:flex><span>vim .env                    <span style=color:#8f5902;font-style:italic># 必须修改 SECRET_KEY_BASE</span>
</span></span><span style=display:flex><span>make up                      <span style=color:#8f5902;font-style:italic># 启动 Maybe 服务</span>
</span></span></code></pre></div><p>访问地址： <a href=http://maybe.pigsty>http://maybe.pigsty</a> 或 http://10.10.10.10:5002</p><h2 id=配置说明>配置说明</h2><p>在 <code>.env</code> 文件中配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SECRET_KEY_BASE</span><span style=color:#ce5c00;font-weight:700>=</span>your-secret-key-here    <span style=color:#8f5902;font-style:italic># 必须修改！</span>
</span></span><span style=display:flex><span><span style=color:#000>DATABASE_URL</span><span style=color:#ce5c00;font-weight:700>=</span>postgresql://...
</span></span></code></pre></div><p><strong>重要</strong>：首次部署前必须修改 <code>SECRET_KEY_BASE</code>！</p><h2 id=功能特性>功能特性</h2><ul><li><strong>账户管理</strong>：追踪多个银行账户和信用卡</li><li><strong>预算规划</strong>：设置和跟踪预算</li><li><strong>投资分析</strong>：监控投资组合表现</li><li><strong>账单提醒</strong>：自动提醒即将到期的账单</li><li><strong>隐私优先</strong>：数据完全在您的控制之下</li></ul><h2 id=相关链接>相关链接</h2><ul><li>GitHub 仓库： <a href=https://github.com/maybe-finance/maybe>https://github.com/maybe-finance/maybe</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-170acad42811859443cc55f9cd346b6f>11 - Metabase：BI 分析工具</h1><div class=lead>使用 Metabase 进行快速的商业智能分析，友好的用户界面让团队自主探索数据。</div><p><a href=https://metabase.com/><strong>Metabase</strong></a> 是一个快速、易用的开源商业智能工具，让您的团队无需 SQL 知识即可探索和可视化数据。</p><p>Metabase 提供友好的用户界面和丰富的图表类型，支持连接多种数据库，是企业数据分析的理想选择。</p><h2 id=快速开始>快速开始</h2><p>在 Pigsty 软件模板目录中提供了 Metabase 的 Docker Compose 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/metabase
</span></span></code></pre></div><p>检查并修改 <code>.env</code> 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim .env    <span style=color:#8f5902;font-style:italic># 检查配置，建议修改默认凭据</span>
</span></span></code></pre></div><p>启动服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 使用 Docker Compose 启动 Metabase</span>
</span></span></code></pre></div><p>访问 Metabase：</p><ul><li>默认地址： <a href=http://metabase.pigsty>http://metabase.pigsty</a></li><li>备用地址： http://10.10.10.10:3001</li><li>首次访问需要完成初始化设置</li></ul><h2 id=管理命令>管理命令</h2><p>Pigsty 提供了便捷的 Makefile 命令来管理 Metabase 服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up      <span style=color:#8f5902;font-style:italic># 启动 Metabase 服务</span>
</span></span><span style=display:flex><span>make run     <span style=color:#8f5902;font-style:italic># 使用 Docker 启动（连接外部 PostgreSQL）</span>
</span></span><span style=display:flex><span>make view    <span style=color:#8f5902;font-style:italic># 显示 Metabase 访问地址</span>
</span></span><span style=display:flex><span>make log     <span style=color:#8f5902;font-style:italic># 查看容器日志</span>
</span></span><span style=display:flex><span>make info    <span style=color:#8f5902;font-style:italic># 查看服务详细信息</span>
</span></span><span style=display:flex><span>make stop    <span style=color:#8f5902;font-style:italic># 停止服务</span>
</span></span><span style=display:flex><span>make clean   <span style=color:#8f5902;font-style:italic># 停止并移除容器</span>
</span></span><span style=display:flex><span>make pull    <span style=color:#8f5902;font-style:italic># 拉取最新镜像</span>
</span></span><span style=display:flex><span>make rmi     <span style=color:#8f5902;font-style:italic># 移除 Metabase 镜像</span>
</span></span><span style=display:flex><span>make save    <span style=color:#8f5902;font-style:italic># 保存镜像到文件</span>
</span></span><span style=display:flex><span>make load    <span style=color:#8f5902;font-style:italic># 从文件加载镜像</span>
</span></span></code></pre></div><h2 id=连接-postgresql>连接 PostgreSQL</h2><p>Metabase 可以连接到 Pigsty 管理的 PostgreSQL 数据库。</p><p>在 Metabase 初始化或添加数据库时，选择「PostgreSQL」，然后输入连接信息：</p><pre tabindex=0><code>数据库类型：PostgreSQL
名称：自定义名称（如 &#34;生产数据库&#34;）
主机：10.10.10.10
端口：5432
数据库名：your_database
用户名：dbuser_meta
密码：DBUser.Meta
</code></pre><p>连接成功后，Metabase 会自动扫描数据库结构，您可以开始创建问题和仪表板。</p><h2 id=功能特性>功能特性</h2><ul><li><strong>无需 SQL</strong>：通过可视化界面构建查询</li><li><strong>丰富的图表类型</strong>：折线图、柱状图、饼图、地图等</li><li><strong>交互式仪表板</strong>：创建美观的数据仪表板</li><li><strong>自动刷新</strong>：定时更新数据和仪表板</li><li><strong>权限管理</strong>：精细的用户和数据访问控制</li><li><strong>SQL 模式</strong>：高级用户可以直接编写 SQL</li><li><strong>嵌入功能</strong>：将图表嵌入到其他应用</li><li><strong>告警功能</strong>：数据变化自动通知</li></ul><h2 id=配置说明>配置说明</h2><p>Metabase 的配置在 <code>.env</code> 文件中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Metabase 元数据库（建议使用 PostgreSQL）</span>
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_TYPE</span><span style=color:#ce5c00;font-weight:700>=</span>postgres
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_DBNAME</span><span style=color:#ce5c00;font-weight:700>=</span>metabase
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_PORT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5432</span>
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_USER</span><span style=color:#ce5c00;font-weight:700>=</span>dbuser_metabase
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_PASS</span><span style=color:#ce5c00;font-weight:700>=</span>DBUser.Metabase
</span></span><span style=display:flex><span><span style=color:#000>MB_DB_HOST</span><span style=color:#ce5c00;font-weight:700>=</span>10.10.10.10
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 应用配置</span>
</span></span><span style=display:flex><span><span style=color:#000>JAVA_OPTS</span><span style=color:#ce5c00;font-weight:700>=</span>-Xmx2g
</span></span></code></pre></div><p><strong>建议</strong>：为 Metabase 使用独立的 PostgreSQL 数据库存储元数据。</p><h2 id=数据持久化>数据持久化</h2><p>Metabase 的元数据（用户、问题、仪表板等）存储在配置的数据库中。</p><p>如果使用 H2 数据库（默认），数据会保存在 <code>/data/metabase</code> 目录。强烈建议在生产环境中使用 PostgreSQL 作为元数据库。</p><h2 id=性能优化>性能优化</h2><ul><li><strong>使用 PostgreSQL</strong>：替代默认的 H2 数据库</li><li><strong>增加内存</strong>：通过 <code>JAVA_OPTS=-Xmx4g</code> 增加 JVM 内存</li><li><strong>数据库索引</strong>：为常查询的字段创建索引</li><li><strong>结果缓存</strong>：启用 Metabase 的查询结果缓存</li><li><strong>定时更新</strong>：合理设置仪表板的自动刷新频率</li></ul><h2 id=安全建议>安全建议</h2><ol><li><strong>修改默认凭据</strong>：修改元数据库的用户名和密码</li><li><strong>启用 HTTPS</strong>：生产环境配置 SSL 证书</li><li><strong>配置认证</strong>：启用 SSO 或 LDAP 认证</li><li><strong>限制访问</strong>：通过防火墙限制访问</li><li><strong>定期备份</strong>：备份 Metabase 元数据库</li></ol><h2 id=相关链接>相关链接</h2><ul><li>Metabase 官网： <a href=https://metabase.com/>https://metabase.com/</a></li><li>官方文档： <a href=https://www.metabase.com/docs/>https://www.metabase.com/docs/</a></li><li>GitHub 仓库： <a href=https://github.com/metabase/metabase>https://github.com/metabase/metabase</a></li><li>Pigsty 软件模板： <a href=https://github.com/Vonng/pigsty/tree/main/app/metabase>https://github.com/Vonng/pigsty/tree/main/app/metabase</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2226656b7bf317b375be85683acc8130>12 - Kong：API 网关</h1><div class=lead>拉起基于 Nginx 与 OpenResty 的强力开源 API 网关，并使用 PostgreSQL 与 Redis 作为其后端状态存储</div><p><img src=/img/docs/app/kong.jpeg alt></p><h2 id=tldr>TL;DR</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> app/kong <span style=color:#000;font-weight:700>;</span> docker-compose up -d
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># pull up kong with docker-compose</span>
</span></span><span style=display:flex><span>make ui         <span style=color:#8f5902;font-style:italic># run swagger ui container</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f kong logs</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># introspect kong with jq</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># stop kong container</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># remove kong container</span>
</span></span><span style=display:flex><span>make rmui       <span style=color:#8f5902;font-style:italic># remove swagger ui container</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># pull latest kong image</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># remove kong image</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># save kong image to /tmp/kong.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># load kong image from /tmp</span>
</span></span></code></pre></div><h2 id=scripts>Scripts</h2><ul><li>Default Port: 8000</li><li>Default SSL Port: 8443</li><li>Default Admin Port: 8001</li><li>Default Postgres Database: <code>postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: kong, owner: dbuser_kong, revokeconn: true , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>kong the api gateway database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_kong, password: DBUser.Kong , pgbouncer: true , roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-fc62b9aad0217ff4dadd76e1e15633b6>13 - Registry：容器镜像仓库</h1><div class=lead>部署 Docker Registry 镜像服务，加速 Docker 镜像拉取，特别适合中国用户。</div><p><a href=https://docs.docker.com/registry/><strong>Docker Registry</strong></a> 镜像服务用于缓存 Docker Hub 和其他镜像仓库的镜像。</p><p>特别适合中国用户或访问 Docker Hub 速度较慢的地区，显著减少镜像拉取时间。</p><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/registry
</span></span><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 启动 Registry 镜像服务</span>
</span></span></code></pre></div><p>访问地址： <a href=http://registry.pigsty>http://registry.pigsty</a> 或 http://10.10.10.10:5000</p><h2 id=功能特性>功能特性</h2><ul><li><strong>镜像缓存</strong>：缓存 Docker Hub 和其他仓库的镜像</li><li><strong>Web 界面</strong>：可选的镜像管理界面</li><li><strong>高性能</strong>：本地缓存大幅提升拉取速度</li><li><strong>存储管理</strong>：可配置的清理和管理策略</li><li><strong>健康检查</strong>：内置健康检查端点</li></ul><h2 id=配置-docker>配置 Docker</h2><p>配置 Docker 使用本地镜像：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 编辑 /etc/docker/daemon.json</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;registry-mirrors&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;http://10.10.10.10:5000&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 重启 Docker</span>
</span></span><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></div><h2 id=存储管理>存储管理</h2><p>镜像数据存储在 <code>/data/registry</code> 目录，建议预留至少 100GB 空间。</p><h2 id=相关链接>相关链接</h2><ul><li>Docker Registry 文档： <a href=https://docs.docker.com/registry/>https://docs.docker.com/registry/</a></li><li>GitHub 仓库： <a href=https://github.com/distribution/distribution>https://github.com/distribution/distribution</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fa3dc992b76e9f32c26faddd8dccdb15>14 - 数据库工具</h1><p>数据库管理与开发工具</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9ab8e0a1cc0dd81586d666399930c331>15 - ByteBase：模式迁移</h1><div class=lead>使用Docker拉起Bytebase，对PG的模式进行版本化管理</div><h2 id=bytebase>ByteBase</h2><p><a href=https://bytebase.com/>ByteBase</a> 是一个进行数据库模式变更的工具，以下命令将在元节点 8887 端口启动一个ByteBase。</p><pre tabindex=0><code>mkdir -p /data/bytebase/data;
docker run --init --name bytebase --restart always --detach --publish 8887:8887 --volume /data/bytebase/data:/var/opt/bytebase \
    bytebase/bytebase:1.0.4 --data /var/opt/bytebase --host http://ddl.pigsty --port 8887
</code></pre><p>访问 http://10.10.10.10:8887/ 或 <a href=http://ddl.pigsty/>http://ddl.pigsty</a> 即可使用 ByteBase，您需要依次创建项目、环境、实例、数据库，即可开始进行模式变更。 公开Demo地址： <a href=http://ddl.pigsty.cc>http://ddl.pigsty.cc</a></p><p>公开Demo地址：<a href=http://ddl.pigsty.cc>http://ddl.pigsty.cc</a></p><p>默认用户名与密码： <code>admin</code> / <code>pigsty</code></p><p><img src=/img/docs/app/bytebase.jpeg alt></p><h2 id=bytebase概览>Bytebase概览</h2><p>Schema Migrator for PostgreSQL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> app/bytebase<span style=color:#000;font-weight:700>;</span> make up
</span></span></code></pre></div><p>Visit <a href=http://ddl.pigsty>http://ddl.pigsty</a> or http://10.10.10.10:8887</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># pull up bytebase with docker-compose in minimal mode</span>
</span></span><span style=display:flex><span>make run        <span style=color:#8f5902;font-style:italic># launch bytebase with docker , local data dir and external PostgreSQL</span>
</span></span><span style=display:flex><span>make view       <span style=color:#8f5902;font-style:italic># print bytebase access point</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f bytebase logs</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># introspect bytebase with jq</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># stop bytebase container</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># remove bytebase container</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># pull latest bytebase image</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># remove bytebase image</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># save bytebase image to /tmp/bytebase.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># load bytebase image from /tmp</span>
</span></span></code></pre></div><h2 id=使用外部的postgresql>使用外部的PostgreSQL</h2><p>Bytebase use its internal PostgreSQL database by default, You can use external PostgreSQL for higher durability.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># postgres://dbuser_bytebase:DBUser.Bytebase@10.10.10.10:5432/bytebase</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: bytebase, owner: dbuser_bytebase, comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>bytebase primary database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_bytebase , password: DBUser.Bytebase, roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#000>dbrole_admin ] }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>if you wish to user an external PostgreSQL, drop monitor extensions and views & pg_repack</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DROP SCHEMA monitor CASCADE<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>DROP EXTENSION pg_repack<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>After bytebase initialized, you can create them back with <code>/pg/tmp/pg-init-template.sql</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>psql bytebase &lt; /pg/tmp/pg-init-template.sql
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8736e7e24609593e38bb4af51eacec86>16 - PGAdmin：GUI 工具</h1><div class=lead>使用Docker拉起PgAdmin4，并加载Pigsty服务器列表</div><p><a href=https://www.pgadmin.org/>pgAdmin</a> 是最受欢迎且功能丰富的 PostgreSQL 开源管理和开发平台，PostgreSQL 是世界上最先进的开源数据库。</p><hr><h2 id=快速开始>快速开始</h2><p>Pigsty 内置（但可选）支持 pgAdmin，它使用 <a href=/docs/docker>Docker</a> Compose 启动 pgadmin：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./docker.yml
</span></span><span style=display:flex><span>./app.yml -e <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>pgadmin
</span></span></code></pre></div><p>pgadmin 的默认端口是 <code>8885</code>，您可以通过 IP:端口访问它：<code>http://10.10.10.10:8885</code>。</p><p>默认凭据在 <a href=https://github.com/pgsty/pigsty/blob/main/app/pgadmin/.env><code>.env</code></a> 中定义，用户名：<code>admin@pigsty.cc</code>，密码：<code>pigsty</code>。</p><hr><h2 id=自定义>自定义</h2><p>在 <code>/opt/pgadmin/.env</code> 中自定义 pgadmin 配置并使用 <code>docker compose</code> 管理它。</p><p>您还可以自定义 <code>apps</code> 参数并使用以下方式覆盖默认 <code>.env</code> 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>docker_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgadmin </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 指定要安装的应用程序名称（pgadmin）（在 apps 中）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>apps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># 定义所有应用程序</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>pgadmin</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># pgadmin 应用程序的定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>            </span><span style=color:#204a87;font-weight:700>conf</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># 覆盖 /opt/pgadmin/.env</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_DEFAULT_EMAIL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your@email.com</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_DEFAULT_PASSWORD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>yourPassword</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_LISTEN_ADDRESS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>0.0.0.0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_PORT</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8885</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_SERVER_JSON_FILE</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgadmin4/servers.json</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>              </span><span style=color:#204a87;font-weight:700>PGADMIN_REPLACE_SERVERS_ON_STARTUP</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>要启动应用程序，运行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./app.yml -l infra
</span></span></code></pre></div><hr><h2 id=域名和证书>域名和证书</h2><p>要通过 nginx（而不是直接访问端口 8885）访问 pgadmin，请使用以下方式配置 <a href=/docs/infra/admin/portal>基础设施门户</a>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: v.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vlogs        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># 在此处添加 pgadmin 上游服务器定义</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pgadmin      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后运行 <code>make nginx</code> 更新 nginx 配置，并在 <code>/etc/hosts</code> 或 <a href=/docs/infra/admin/domain#%E5%86%85%E7%BD%91%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90>本地</a> / <a href=/docs/infra/admin/domain#%E5%85%AC%E7%BD%91%E5%9F%9F%E5%90%8D>公共</a> DNS 服务器中配置 <a href=/docs/infra/admin/domain#%E6%9C%AC%E5%9C%B0%E9%9D%99%E6%80%81%E8%A7%A3%E6%9E%90>本地静态 DNS</a> 记录 <code>&lt;your_ip_address> adm.pigsty</code>。</p><p>Pigsty 将自动为 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 中列出的域名签发自签名 SSL 证书。
如果您想使用真实域名，请定义 <code>certbot</code> 条目并运行 <code>make cert</code>，查看 <a href=/docs/infra/admin/cert>SSL 证书</a> 了解详情。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># 确保您的域名（adm.pigsty.cc）解析到您的公网 IP</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>certbot_sign</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 使用 certbot 签发真实 HTTPS 证书（需要互联网访问！）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>pgadmin </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: adm.pigsty.cc  ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8885&#34;</span><span style=color:#204a87;font-weight:700>, certbot</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>adm.pigsty.cc }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=使用方法>使用方法</h2><p>Pigsty 的 Pgadmin 应用模板默认使用 8885 端口，您可以通过以下地址访问：</p><p><a href=http://adm.pigsty>http://adm.pigsty</a> 或 http://10.10.10.10:8885</p><p>默认用户名与密码: <code>admin@pigsty.cc</code> / <code>pigsty</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># 使用 docker compose 启动 pgadmin</span>
</span></span><span style=display:flex><span>make run        <span style=color:#8f5902;font-style:italic># 使用 docker 启动 pgadmin</span>
</span></span><span style=display:flex><span>make view       <span style=color:#8f5902;font-style:italic># 打印 pgadmin 访问点</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f pgadmin 日志</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># 使用 jq 检查 pgadmin</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># 停止 pgadmin 容器</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># 移除 pgadmin 容器</span>
</span></span><span style=display:flex><span>make conf       <span style=color:#8f5902;font-style:italic># 使用 pigsty pg 服务器列表配置 pgadmin</span>
</span></span><span style=display:flex><span>make dump       <span style=color:#8f5902;font-style:italic># 从 pgadmin 容器导出 servers.json</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># 拉取最新的 pgadmin 镜像</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># 移除 pgadmin 镜像</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># 保存 pgadmin 镜像到 /tmp/pgadmin.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># 从 /tmp 加载 pgadmin 镜像</span>
</span></span></code></pre></div><hr><h2 id=demo>Demo</h2><p>公开 Demo 地址：<a href=http://adm.pigsty.cc>http://adm.pigsty.cc</a></p><p>默认用户名与密码: <code>admin@pigsty.cc</code> / <code>pigsty</code></p><p><img src=/img/docs/app/pgadmin.jpeg alt></p></div><div class=td-content style=page-break-before:always><h1 id=pg-fbdf33ca77e7696092991f27dcf86e32>17 - PGWeb：网页客户端</h1><div class=lead>使用Docker拉起PGWEB，以便从浏览器进行小批量在线数据查询</div><h2 id=pgweb客户端工具>PGWeb客户端工具</h2><p><a href=https://github.com/sosedoff/pgweb>PGWeb</a> 是一款基于浏览器的PG客户端工具，使用以下命令，在元节点上拉起PGWEB服务，默认为主机<code>8886</code>端口。可使用域名： <a href=http://cli.pigsty>http://cli.pigsty</a> 访问，公开Demo：http://cli.pigsty.cc。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># docker stop pgweb; docker rm pgweb</span>
</span></span><span style=display:flex><span>docker run --init --name pgweb --restart always --detach --publish 8886:8081 sosedoff/pgweb
</span></span></code></pre></div><p>用户需要自行填写数据库连接串，例如默认CMDB的连接串：</p><p><code>postgres://dbuser_dba:DBUser.DBA@10.10.10.10:5432/meta?sslmode=disable</code></p><p>公开Demo地址：<a href=http://cli.pigsty.cc>http://cli.pigsty.cc</a></p><p><img src=/img/docs/app/pgweb.jpeg alt></p><p>使用Docker Compose拉起PGWEB容器：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/pgweb <span style=color:#000;font-weight:700>;</span> docker-compose up -d
</span></span></code></pre></div><p>接下来，访问您本机的 8886 端口，即可看到 PGWEB 的UI界面： http://10.10.10.10:8886</p><p>您可以尝试使用下面的URL连接串，通过 PGWEB 连接至数据库实例并进行探索。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres://dbuser_meta:DBUser.Meta@10.10.10.10:5432/meta?sslmode<span style=color:#ce5c00;font-weight:700>=</span>disable
</span></span><span style=display:flex><span>postgres://test:test@10.10.10.11:5432/test?sslmode<span style=color:#ce5c00;font-weight:700>=</span>disable
</span></span></code></pre></div><h2 id=快捷方式>快捷方式</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># pull up pgweb with docker-compose</span>
</span></span><span style=display:flex><span>make run        <span style=color:#8f5902;font-style:italic># launch pgweb with docker</span>
</span></span><span style=display:flex><span>make view       <span style=color:#8f5902;font-style:italic># print pgweb access point</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f pgweb logs</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># introspect pgweb with jq</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># stop pgweb container</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># remove pgweb container</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># pull latest pgweb image</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># remove pgweb image</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># save pgweb image to /tmp/pgweb.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># load pgweb image from /tmp</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0e8785a96f30f0e01c2bfd365fb63b5a>18 - PostgREST：自动 API</h1><div class=lead>使用Docker拉起PostgREST，自动根据PostgreSQL模式生成后端REST API</div><h2 id=postgrest>PostgREST</h2><p><a href=https://postgrest.org/en/stable/index.html>PostgREST</a> 是一个自动根据 PostgreSQL 数据库模式生成 REST API的二进制组件。</p><p>例如，以下命令将使用docker拉起 postgrest （本地 8884 端口，使用默认管理员用户，暴露Pigsty CMDB模式）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --init --name postgrest --restart always --detach --publish 8884:8081 postgrest/postgrest
</span></span></code></pre></div><p>访问 <a href=http://10.10.10.10:8884/>http://10.10.10.10:8884</a> 会展示所有自动生成API的定义，并自动使用 <a href=http://home.pigsty.cc:8883>Swagger Editor</a> 暴露API文档。</p><p>如果您想要进行增删改查，设计更精细的权限控制，请参考 <a href=https://postgrest.org/en/stable/tutorials/tut1.html>Tutorial 1 - The Golden Key</a>，生成一个签名JWT。</p><p><img src=/img/docs/app/postgrest.jpeg alt></p><p>This is an example of creating pigsty cmdb API with PostgREST</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/postgrest <span style=color:#000;font-weight:700>;</span> docker-compose up -d
</span></span></code></pre></div><p>http://10.10.10.10:8884 is the default endpoint for PostgREST</p><p>http://10.10.10.10:8883 is the default api docs for PostgREST</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up         <span style=color:#8f5902;font-style:italic># pull up postgrest with docker-compose</span>
</span></span><span style=display:flex><span>make run        <span style=color:#8f5902;font-style:italic># launch postgrest with docker</span>
</span></span><span style=display:flex><span>make ui         <span style=color:#8f5902;font-style:italic># run swagger ui container</span>
</span></span><span style=display:flex><span>make view       <span style=color:#8f5902;font-style:italic># print postgrest access point</span>
</span></span><span style=display:flex><span>make log        <span style=color:#8f5902;font-style:italic># tail -f postgrest logs</span>
</span></span><span style=display:flex><span>make info       <span style=color:#8f5902;font-style:italic># introspect postgrest with jq</span>
</span></span><span style=display:flex><span>make stop       <span style=color:#8f5902;font-style:italic># stop postgrest container</span>
</span></span><span style=display:flex><span>make clean      <span style=color:#8f5902;font-style:italic># remove postgrest container</span>
</span></span><span style=display:flex><span>make rmui       <span style=color:#8f5902;font-style:italic># remove swagger ui container</span>
</span></span><span style=display:flex><span>make pull       <span style=color:#8f5902;font-style:italic># pull latest postgrest image</span>
</span></span><span style=display:flex><span>make rmi        <span style=color:#8f5902;font-style:italic># remove postgrest image</span>
</span></span><span style=display:flex><span>make save       <span style=color:#8f5902;font-style:italic># save postgrest image to /tmp/postgrest.tgz</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># load postgrest image from /tmp</span>
</span></span></code></pre></div><h2 id=swagger-ui>Swagger UI</h2><p>Launch a swagger OpenAPI UI and visualize PostgREST API on 8883 with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --init --name postgrest --name swagger -p 8883:8080 -e <span style=color:#000>API_URL</span><span style=color:#ce5c00;font-weight:700>=</span>http://10.10.10.10:8884 swaggerapi/swagger-ui
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># docker run -d -e API_URL=http://10.10.10.10:8884 -p 8883:8080 swaggerapi/swagger-editor # swagger editor</span>
</span></span></code></pre></div><p>Check <a href=http://10.10.10.10:8883/>http://10.10.10.10:8883/</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-fa5656811a158b156712d00725b47fea>19 - Electric：PGLite 同步引擎</h1><div class=lead>使用 Electric 解决 PostgreSQL 数据同步难题，支持部分复制和实时数据传输。</div><p><a href=https://electric-sql.com/><strong>Electric</strong></a> 是一个 PostgreSQL 同步引擎，解决了数据同步的复杂问题。</p><p>Electric 支持部分复制、扇出传输和高效的数据交付，是构建实时应用和离线优先应用的理想选择。</p><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/electric
</span></span><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 启动 Electric 服务</span>
</span></span></code></pre></div><p>访问地址： <a href=http://electric.pigsty>http://electric.pigsty</a> 或 http://10.10.10.10:3000</p><h2 id=功能特性>功能特性</h2><ul><li><strong>部分复制</strong>：只同步需要的数据</li><li><strong>实时同步</strong>：毫秒级数据更新</li><li><strong>离线优先</strong>：支持离线工作，自动同步</li><li><strong>冲突解决</strong>：自动处理数据冲突</li><li><strong>类型安全</strong>：TypeScript 支持</li></ul><h2 id=相关链接>相关链接</h2><ul><li>Electric 官网： <a href=https://electric-sql.com/>https://electric-sql.com/</a></li><li>官方文档： <a href=https://electric-sql.com/docs>https://electric-sql.com/docs</a></li><li>GitHub 仓库： <a href=https://github.com/electric-sql/electric>https://github.com/electric-sql/electric</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-34724279579b562c276e6051f843c660>20 - Jupyter：笔记本 AI IDE</h1><div class=lead>使用 Jupyter Lab 并访问 PostgreSQL 数据库，组合使用 SQL 与 Python 的能力进行数据分析。</div><p>Jupyter Lab 是基于 IPython Notebook 的完整数据科学研发环境，可用于数据分析与可视化。</p><p>Pigsty 提供了 Docker Compose 模板，可以一键在容器中启动 Jupyter Lab 服务，并方便地访问 PostgreSQL 数据库。</p><p><img src=/img/docs/app/jupyter.jpeg alt></p><h2 id=快速开始>快速开始</h2><p>在 Pigsty 软件模板目录中提供了 Jupyter 的 Docker Compose 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/app/jupyter
</span></span></code></pre></div><p>修改默认密码，编辑 <code>.env</code> 文件中的 <code>JUPYTER_TOKEN</code> 参数（默认值为 <code>pigsty</code>）。</p><p>创建数据目录并启动服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make dir    <span style=color:#8f5902;font-style:italic># 创建 /data/jupyter 目录并设置权限</span>
</span></span><span style=display:flex><span>make up     <span style=color:#8f5902;font-style:italic># 使用 Docker Compose 启动服务</span>
</span></span></code></pre></div><p>访问 Jupyter Lab：</p><ul><li>默认地址： <a href=http://lab.pigsty>http://lab.pigsty</a></li><li>备用地址： http://10.10.10.10:8888</li><li>默认 Token：<code>pigsty</code></li></ul><h2 id=管理命令>管理命令</h2><p>Pigsty 提供了便捷的 Makefile 命令来管理 Jupyter 服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make up      <span style=color:#8f5902;font-style:italic># 启动 Jupyter Lab 服务</span>
</span></span><span style=display:flex><span>make dir     <span style=color:#8f5902;font-style:italic># 创建 /data/jupyter 数据目录</span>
</span></span><span style=display:flex><span>make log     <span style=color:#8f5902;font-style:italic># 查看容器日志</span>
</span></span><span style=display:flex><span>make info    <span style=color:#8f5902;font-style:italic># 显示服务信息</span>
</span></span><span style=display:flex><span>make stop    <span style=color:#8f5902;font-style:italic># 停止服务</span>
</span></span><span style=display:flex><span>make clean   <span style=color:#8f5902;font-style:italic># 停止并移除容器</span>
</span></span><span style=display:flex><span>make pull    <span style=color:#8f5902;font-style:italic># 拉取最新镜像</span>
</span></span><span style=display:flex><span>make save    <span style=color:#8f5902;font-style:italic># 保存 Docker 镜像到文件</span>
</span></span><span style=display:flex><span>make load    <span style=color:#8f5902;font-style:italic># 从文件加载 Docker 镜像</span>
</span></span></code></pre></div><h2 id=访问-postgresql-数据库>访问 PostgreSQL 数据库</h2><p>在 Jupyter Lab 中访问 PostgreSQL 数据库需要先安装驱动。</p><p>在 Jupyter Lab 的 Terminal 中执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install psycopg2-binary psycopg2
</span></span></code></pre></div><p>然后在 Notebook 中使用 <code>psycopg2</code> 驱动访问 PostgreSQL：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>psycopg2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 连接到 PostgreSQL 数据库</span>
</span></span><span style=display:flex><span><span style=color:#000>conn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>psycopg2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>connect</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;postgres://dbuser_meta:DBUser.Meta@10.10.10.10:5432/meta&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 执行查询</span>
</span></span><span style=display:flex><span><span style=color:#000>cursor</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>conn</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cursor</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>cursor</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>execute</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT date, new_cases FROM covid.country_history WHERE country_code = &#39;CN&#39;;&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cursor</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fetchall</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 处理数据</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>row</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>row</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>你也可以使用其他 Python 数据分析库，如 Pandas、SQLAlchemy 等：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>pandas</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>pd</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sqlalchemy</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>create_engine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 SQLAlchemy 连接</span>
</span></span><span style=display:flex><span><span style=color:#000>engine</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>create_engine</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;postgresql://dbuser_meta:DBUser.Meta@10.10.10.10:5432/meta&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 Pandas 读取数据</span>
</span></span><span style=display:flex><span><span style=color:#000>df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_sql</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT * FROM covid.country_history WHERE country_code = &#39;CN&#39;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>engine</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>head</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></div><h2 id=配置说明>配置说明</h2><p>Jupyter 服务的配置在 <code>.env</code> 文件中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>JUPYTER_TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span>pigsty    <span style=color:#8f5902;font-style:italic># Jupyter Lab 访问 Token（密码）</span>
</span></span></code></pre></div><p>如果需要修改端口或其他配置，可以编辑 <code>docker-compose.yml</code> 文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>jupyter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>jupyter/scipy-notebook:latest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#34;8888:8888&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>/data/jupyter:/home/jovyan/work</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>JUPYTER_TOKEN=${JUPYTER_TOKEN}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=安装额外的-python-包>安装额外的 Python 包</h2><p>Jupyter 容器支持使用 <code>pip</code> 或 <code>conda</code> 安装 Python 包。</p><p>在 Jupyter Lab 的 Terminal 中执行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 pip 安装</span>
</span></span><span style=display:flex><span>pip install numpy pandas matplotlib seaborn scikit-learn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用 conda 安装</span>
</span></span><span style=display:flex><span>conda install -c conda-forge geopandas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用国内镜像加速（可选）</span>
</span></span><span style=display:flex><span>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple numpy
</span></span></code></pre></div><h2 id=数据持久化>数据持久化</h2><p>Jupyter 的数据存储在 <code>/data/jupyter</code> 目录中，该目录会被挂载到容器的 <code>/home/jovyan/work</code> 路径。</p><p>所有保存在 <code>work</code> 目录下的 Notebook 和数据文件都会持久化保存在宿主机上，即使容器重启或删除也不会丢失。</p><h2 id=安全建议>安全建议</h2><p><strong>强烈建议修改默认的 Token（密码）！</strong></p><ol><li>编辑 <code>.env</code> 文件，修改 <code>JUPYTER_TOKEN</code> 的值</li><li>重启服务：<code>make up</code></li></ol><p>如果在生产环境中使用 Jupyter Lab，还应该：</p><ul><li>使用强密码或禁用 Token 认证</li><li>配置 HTTPS 访问</li><li>限制网络访问权限</li><li>定期备份数据目录</li></ul><h2 id=相关链接>相关链接</h2><ul><li>Jupyter 官方文档： <a href=https://jupyter.org/documentation>https://jupyter.org/documentation</a></li><li>Docker Stacks 仓库： <a href=https://github.com/jupyter/docker-stacks>https://github.com/jupyter/docker-stacks</a></li><li>Pigsty 软件模板： <a href=https://github.com/Vonng/pigsty/tree/main/app>https://github.com/Vonng/pigsty/tree/main/app</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b3405ffde24b58619b4d32980b9155a0>21 - 数据应用</h1><p>基于 PostgreSQL 的数据可视化应用</p></div><div class=td-content style=page-break-before:always><h1 id=pg-af33a915aa5ea40ca1b93854fbd8da8e>22 - PGLOG：PG自带日志分析应用</h1><div class=lead>Pigsty自带的，用于分析PostgreSQL CSV日志样本的一个样例Applet</div><p>PGLOG是Pigsty自带的一个样例应用，固定使用MetaDB中<code>pglog.sample</code>表作为数据来源。您只需要将日志灌入该表，然后访问相关Dashboard即可。</p><p>Pigsty提供了一些趁手的命令，用于拉取csv日志，并灌入样本表中。在元节点上，默认提供下列快捷命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catlog  <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#ce5c00;font-weight:700>=</span>localhost<span style=color:#ce5c00;font-weight:700>]</span>  <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>date</span><span style=color:#ce5c00;font-weight:700>=</span>today<span style=color:#ce5c00;font-weight:700>]</span>   <span style=color:#8f5902;font-style:italic># 打印CSV日志到标准输出</span>
</span></span><span style=display:flex><span>pglog                                    <span style=color:#8f5902;font-style:italic># 从标准输入灌入CSVLOG</span>
</span></span><span style=display:flex><span>pglog12                                  <span style=color:#8f5902;font-style:italic># 灌入PG12格式的CSVLOG</span>
</span></span><span style=display:flex><span>pglog13                                  <span style=color:#8f5902;font-style:italic># 灌入PG13格式的CSVLOG</span>
</span></span><span style=display:flex><span>pglog14                                  <span style=color:#8f5902;font-style:italic># 灌入PG14格式的CSVLOG (=pglog)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>catlog <span style=color:#000;font-weight:700>|</span> pglog                       <span style=color:#8f5902;font-style:italic># 分析当前节点当日的日志</span>
</span></span><span style=display:flex><span>catlog node-1 <span style=color:#4e9a06>&#39;2021-07-15&#39;</span> <span style=color:#000;font-weight:700>|</span> pglog   <span style=color:#8f5902;font-style:italic># 分析node-1在2021-07-15的csvlog</span>
</span></span></code></pre></div><p>接下来，您可以访问以下的连接，查看样例日志分析界面。</p><ul><li><a href=https://demo.pigsty.cc/d/pglog-overview>PGLOG Overview</a>: 呈现整份CSV日志样本详情，按多种维度聚合。</li></ul><p><a href=https://demo.pigsty.cc/d/pglog-overview><img src=/img/dashboard/pglog-overview.jpg alt></a></p><ul><li><a href=https://demo.pigsty.cc/d/pglog-session>PGLOG Session</a>: 呈现日志样本中一条具体连接的详细信息。</li></ul><p><a href=https://demo.pigsty.cc/d/pglog-session><img src=/img/dashboard/pglog-session.jpg alt></a></p><p><code>catlog</code>命令从特定节点拉取特定日期的CSV数据库日志，写入<code>stdout</code></p><p>默认情况下，<code>catlog</code>会拉取当前节点当日的日志，您可以通过参数指定节点与日期。</p><p>组合使用<code>pglog</code>与<code>catlog</code>，即可快速拉取数据库CSV日志进行分析。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catlog <span style=color:#000;font-weight:700>|</span> pglog                       <span style=color:#8f5902;font-style:italic># 分析当前节点当日的日志</span>
</span></span><span style=display:flex><span>catlog node-1 <span style=color:#4e9a06>&#39;2021-07-15&#39;</span> <span style=color:#000;font-weight:700>|</span> pglog   <span style=color:#8f5902;font-style:italic># 分析node-1在2021-07-15的csvlog</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3bf0cdc122adbb3c6315d77456eb4a70>23 - NOAA ISD 全球气象站历史数据查询</h1><div class=lead>以ISD数据集为例，展现如何将数据导入数据库中</div><p>如果您拥有数据库后不知道干点什么，不妨参试试这个开源项目：<a href=https://github.com/Vonng/isd>Vonng/isd</a></p><p>您可以直接复用监控系统Grafana，以交互式的方式查阅近30000个地面气象站过去120年间的亚小时级气象数据。</p><p>这是一个功能完成的数据应用，可以查询全球30000个地表气象站从1901年来的气象观测记录。</p><p>项目地址：<a href=https://github.com/Vonng/isd>https://github.com/Vonng/isd</a></p><p>在线Demo地址：<a href=https://demo.pigsty.cc/d/isd-overview>https://demo.pigsty.cc/d/isd-overview</a></p><p><a href=https://demo.pigsty.cc/d/isd-overview><img src=/img/docs/app/isd-overview.jpg alt=isd-overview.jpg></a></p><h2 id=快速上手>快速上手</h2><p><strong>克隆本仓库</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/Vonng/isd.git<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> isd<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p><strong>准备一个 PostgreSQL 实例</strong></p><p>该 PostgreSQL 实例应当启用了 PostGIS 扩展。使用 <code>PGURL</code> 环境变量传递数据库连接信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Pigsty 默认使用的管理员账号是 dbuser_dba，密码是 DBUser.DBA</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PGURL</span><span style=color:#ce5c00;font-weight:700>=</span>postgres://dbuser_dba:DBUser.DBA@127.0.0.1:5432/meta?sslmode<span style=color:#ce5c00;font-weight:700>=</span>disable
</span></span><span style=display:flex><span>psql <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> -c <span style=color:#4e9a06>&#39;SELECT 1&#39;</span>  <span style=color:#8f5902;font-style:italic># 检查连接是否可用</span>
</span></span></code></pre></div><p><strong>获取并导入ISD气象站元数据</strong></p><p>这是一份每日更新的气象站元数据，包含了气象站的经纬度、海拔、名称、国家、省份等信息，使用以下命令下载并导入。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make reload-station   <span style=color:#8f5902;font-style:italic># 相当于先下载最新的Station数据再加载：get-station + load-station</span>
</span></span></code></pre></div><p><strong>获取并导入最新的 <code>isd.daily</code> 数据</strong></p><p><code>isd.daily</code> 是一个每日更新的数据集，包含了全球各气象站的日观测数据摘要，使用以下命令下载并导入。
请注意，直接从 NOAA 网站下载的原始数据需要经过<strong>解析</strong>方可入库，所以你需要下载或构建一个 ISD 数据 Parser。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make get-parser       <span style=color:#8f5902;font-style:italic># 从 Github 下载 Parser 二进制，当然你也可以用 make build 直接用 go 构建。</span>
</span></span><span style=display:flex><span>make reload-daily     <span style=color:#8f5902;font-style:italic># 下载本年度最新的 isd.daily 数据并导入数据库中</span>
</span></span></code></pre></div><p><strong>加载解析好的 CSV 数据集</strong></p><p>ISD Daily 数据集有一些脏数据与 <a href=https://github.com/Vonng/isd/blob/master/doc/isd-daily-caveat.md>重复数据</a>，如果你不想手工解析处理清洗，这里也提供了一份解析好的稳定CSV数据集。</p><p>该数据集包含了截止到 2023-06-24 的 <code>isd.daily</code> 数据，你可以直接下载并导入 PostgreSQL 中，不需要 Parser，</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make get-stable       <span style=color:#8f5902;font-style:italic># 从 Github 上获取稳定的 isd.daily 历史数据集。</span>
</span></span><span style=display:flex><span>make load-stable      <span style=color:#8f5902;font-style:italic># 将下载好的稳定历史数据集加载到 PostgreSQL 数据库中。</span>
</span></span></code></pre></div><h2 id=更多数据>更多数据</h2><p>ISD数据集有两个部分是每日更新的，气象站元数据，以及最新年份的 <code>isd.daily</code> （如 2023 年的 Tarball）。</p><p>你可以使用以下命令下载并刷新这两个部分。如果数据集没有更新，那么这些命令不会重新下载同样的数据包</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make reload           <span style=color:#8f5902;font-style:italic># 实际上是：reload-station + reload-daily</span>
</span></span></code></pre></div><p>你也可以使用以下命令下载并加载特定年份的 <code>isd.daily</code> 数据：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/get-daily  <span style=color:#0000cf;font-weight:700>2022</span>                   <span style=color:#8f5902;font-style:italic># 获取 2022 年的每日气象观测摘要 (1900-2023)</span>
</span></span><span style=display:flex><span>bin/load-daily <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#0000cf;font-weight:700>2022</span>        <span style=color:#8f5902;font-style:italic># 加载 2022 年的每日气象观测摘要 (1900-2023) </span>
</span></span></code></pre></div><p>除了每日摘要 <code>isd.daily</code>， ISD 还提供了一份更详细的亚小时级原始观测记录 <code>isd.hourly</code>，下载与加载的方式与前者类似：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/get-hourly  <span style=color:#0000cf;font-weight:700>2022</span>                  <span style=color:#8f5902;font-style:italic># 下载特定某一年的小时级观测记录（例如2022年，可选 1900-2023）</span>
</span></span><span style=display:flex><span>bin/load-hourly <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#0000cf;font-weight:700>2022</span>       <span style=color:#8f5902;font-style:italic># 加载特定某一年的小时级观测记录 </span>
</span></span></code></pre></div><h2 id=数据>数据</h2><h3 id=数据集概要>数据集概要</h3><p>ISD提供了四个数据集：亚小时级原始观测数据，每日统计摘要数据，月度统计摘要，年度统计摘要</p><table class=full-width><thead><tr><th>数据集</th><th>备注</th></tr></thead><tbody><tr><td>ISD Hourly</td><td>亚小时级观测记录</td></tr><tr><td>ISD Daily</td><td>每日统计摘要</td></tr><tr><td>ISD Monthly</td><td>没有用到，因为可以从 <code>isd.daily</code> 计算生成</td></tr><tr><td>ISD Yearly</td><td>没有用到，因为可以从 <code>isd.daily</code> 计算生成</td></tr></tbody></table><p><strong>每日摘要数据集</strong></p><ul><li>压缩包大小 2.8GB (截止至 2023-06-24)</li><li>表大小 24GB，索引大小 6GB，PostgreSQL 中总大小约为 30GB</li><li>如果启用了 timescaledb 压缩，总大小可以压缩到 4.5 GB。</li></ul><p><strong>亚小时级观测数据级</strong></p><ul><li>压缩包总大小 117GB</li><li>灌入数据库后表大小 1TB+ ，索引大小 600GB+，总大小 1.6TB</li></ul><h3 id=数据库模式>数据库模式</h3><p><strong>气象站元数据表</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>isd</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>station</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>station</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>PRIMARY</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>usaf</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>substring</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>station</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wban</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>substring</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>station</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>name</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>country</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>province</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>icao</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>location</span><span style=color:#f8f8f8>   </span><span style=color:#000>GEOMETRY</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>POINT</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>longitude</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ST_X</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>location</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>latitude</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ST_Y</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>location</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>elevation</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>period</span><span style=color:#f8f8f8>     </span><span style=color:#000>daterange</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>begin_date</span><span style=color:#f8f8f8> </span><span style=color:#204a87>DATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>lower</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>period</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>end_date</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>DATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>GENERATED</span><span style=color:#f8f8f8> </span><span style=color:#000>ALWAYS</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>upper</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>period</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8> </span><span style=color:#000>STORED</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>每日摘要表</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>isd</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>daily</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>station</span><span style=color:#f8f8f8>     </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- station number 6USAF+5WBAN
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>ts</span><span style=color:#f8f8f8>          </span><span style=color:#204a87>DATE</span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- observation date
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 气温 &amp; 露点
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_mean</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- mean temperature ℃
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_min</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- min temperature ℃
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_max</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- max temperature ℃
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>dewp_mean</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- mean dew point ℃
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 气压
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>slp_mean</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- sea level pressure (hPa)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>stp_mean</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- station pressure (hPa)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 可见距离
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>vis_mean</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- visible distance (m)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 风速
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wdsp_mean</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- average wind speed (m/s)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wdsp_max</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- max wind speed (m/s)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>gust</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- max wind gust (m/s) 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 降水 / 雪深
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp_mean</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- precipitation (mm)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- rectified precipitation (mm)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>sndp</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NuMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- snow depth (mm)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- FRSHTT (Fog/Rain/Snow/Hail/Thunder/Tornado) 雾/雨/雪/雹/雷/龙卷
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_foggy</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (F)og
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_rainy</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (R)ain or Drizzle
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_snowy</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (S)now or pellets
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_hail</span><span style=color:#f8f8f8>     </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (H)ail
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_thunder</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (T)hunder
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>is_tornado</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- (T)ornado or Funnel Cloud
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 统计聚合使用的记录数
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_count</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for temp
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>dewp_count</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for dew point
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>slp_count</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for sea level pressure
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>stp_count</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for station pressure
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wdsp_count</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for wind speed
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>visib_count</span><span style=color:#f8f8f8> </span><span style=color:#204a87>SMALLINT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic>-- record count for visible distance
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- 气温标记
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_min_f</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- aggregate min temperature
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp_max_f</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>BOOLEAN</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic>-- aggregate max temperature
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp_flag</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>CHAR</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic>-- precipitation flag: ABCDEFGHI
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>PRIMARY</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>station</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>ts</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- PARTITION BY RANGE (ts);
</span></span></span></code></pre></div><p><strong>亚小时级原始观测数据表</strong></p><details><summary>ISD Hourly</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>isd</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hourly</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>station</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- station id
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>ts</span><span style=color:#f8f8f8>         </span><span style=color:#204a87;font-weight:700>TIMESTAMP</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- timestamp
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- air
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>temp</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [-93.2,+61.8]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>dewp</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [-98.2,+36.8]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>slp</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [8600,10900]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>stp</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [4500,10900]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>vis</span><span style=color:#f8f8f8>        </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- [0,160000]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- wind
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wd_angle</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- [1,360]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wd_speed</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [0,90]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wd_gust</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- [0,110]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>wd_code</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- code that denotes the character of the WIND-OBSERVATION.
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- cloud
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>cld_height</span><span style=color:#f8f8f8> </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- [0,22000]
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>cld_code</span><span style=color:#f8f8f8>   </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- cloud code
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- water
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>sndp</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- mm snow
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp</span><span style=color:#f8f8f8>       </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic>-- mm precipitation
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp_hour</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- precipitation duration in hour
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>prcp_code</span><span style=color:#f8f8f8>  </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- precipitation type code
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- sky
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>mw_code</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- manual weather observation code
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>aw_code</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- auto weather observation code
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>pw_code</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>VARCHAR</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- weather code of past period of time
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000>pw_hour</span><span style=color:#f8f8f8>    </span><span style=color:#204a87>NUMERIC</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic>-- duration of pw_code period
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- misc
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- remark     TEXT,
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic>-- eqd        TEXT,
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>data</span><span style=color:#f8f8f8>       </span><span style=color:#000>JSONB</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic>-- extra data
</span></span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#000>PARTITION</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8> </span><span style=color:#000>RANGE</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ts</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></details><h2 id=解析器>解析器</h2><p>NOAA ISD 提供的原始数据是高度压缩的专有格式，需要通过解析器加工，才能转换为数据库表的格式。</p><p>针对 Daily 与 Hourly 两份数据集，这里提供了两个 Parser： <a href=https://github.com/Vonng/isd/blob/master/parser/isdd/isdd.go><code>isdd</code></a> and <a href=https://github.com/Vonng/isd/blob/master/parser/isdh/isdh.go><code>isdh</code></a>。
这两个解析器都以年度数据压缩包作为输入，产生 CSV 结果作为输出，以管道的方式工作，如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>        isd -- Intergrated Surface Dataset Parser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SYNOPSIS
</span></span><span style=display:flex><span>        isd daily   <span style=color:#ce5c00;font-weight:700>[</span>-i &lt;input<span style=color:#000;font-weight:700>|</span>stdin&gt;<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-o &lt;output<span style=color:#000;font-weight:700>|</span>stout&gt;<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-v<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>        isd hourly  <span style=color:#ce5c00;font-weight:700>[</span>-i &lt;input<span style=color:#000;font-weight:700>|</span>stdin&gt;<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-o &lt;output<span style=color:#000;font-weight:700>|</span>stout&gt;<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-v<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>-d raw<span style=color:#000;font-weight:700>|</span>ts-first<span style=color:#000;font-weight:700>|</span>hour-first<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DESCRIPTION
</span></span><span style=display:flex><span>        The isd program takes noaa isd daily/hourly raw tarball data as input.
</span></span><span style=display:flex><span>        and generate parsed data in csv format as output. Works in pipe mode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cat data/daily/2023.tar.gz <span style=color:#000;font-weight:700>|</span> bin/isd daily -v <span style=color:#000;font-weight:700>|</span> psql <span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span> -AXtwqc <span style=color:#4e9a06>&#34;COPY isd.daily FROM STDIN CSV;&#34;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        isd daily  -v -i data/daily/2023.tar.gz  <span style=color:#000;font-weight:700>|</span> psql <span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span> -AXtwqc <span style=color:#4e9a06>&#34;COPY isd.daily FROM STDIN CSV;&#34;</span>
</span></span><span style=display:flex><span>        isd hourly -v -i data/hourly/2023.tar.gz <span style=color:#000;font-weight:700>|</span> psql <span style=color:#4e9a06>${</span><span style=color:#000>PGURL</span><span style=color:#4e9a06>}</span> -AXtwqc <span style=color:#4e9a06>&#34;COPY isd.hourly FROM STDIN CSV;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OPTIONS
</span></span><span style=display:flex><span>        -i  &lt;input&gt;     input file, stdin by default
</span></span><span style=display:flex><span>        -o  &lt;output&gt;    output file, stdout by default
</span></span><span style=display:flex><span>        -p  &lt;profpath&gt;  pprof file path, <span style=color:#204a87>enable</span> <span style=color:#204a87;font-weight:700>if</span> specified
</span></span><span style=display:flex><span>        -d              de-duplicate rows <span style=color:#204a87;font-weight:700>for</span> hourly dataset <span style=color:#ce5c00;font-weight:700>(</span>raw, ts-first, hour-first<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        -v              verbose mode
</span></span><span style=display:flex><span>        -h              print <span style=color:#204a87>help</span>
</span></span></code></pre></div><hr><h2 id=用户界面>用户界面</h2><p>这里提供了几个使用 Grafana 制作的 Dashboard，可以用于探索 ISD 数据集，查询气象站与历史气象数据。</p><hr><p><strong>ISD Overview</strong></p><p>全局概览，总体指标与气象站导航。</p><p><img src=/img/docs/app/isd-overview.jpg alt=isd-overview.jpg></p><hr><p><strong>ISD Country</strong></p><p>展示单个国家/地区内所有的气象站。</p><p><img src=/img/docs/app/isd-country.jpg alt=isd-country.jpg></p><hr><p><strong>ISD Station</strong></p><p>展示单个气象站的详细信息，元数据，天/月/年度汇总指标。</p><details><summary>ISD Station Dashboard</summary><p><img src=/img/docs/app/isd-station.jpg alt=isd-station.jpg></p></details><hr><p><strong>ISD Detail</strong></p><p>展示一个气象站原始亚小时级观测指标数据，需要 <code>isd.hourly</code> 数据集。</p><details><summary>ISD Station Dashboard</summary><p><img src=/img/docs/app/isd-detail.jpg alt=isd-detail.jpg></p></details><br><br><br></div><div class=td-content style=page-break-before:always><h1 id=pg-f2f527c6f73d059e66947f8c86fd4b49>24 - COVID-19 数据大盘</h1><div class=lead>Pigsty 自带的，用于展示世界卫生组织官方 COVID 疫情数据的一个样例 Applet</div><p>Covid 是 Pigsty 自带的，用于展示世界卫生组织官方疫情数据大盘的一个样例 Applet。</p><p>您可以查阅每个国家与地区 COVID-19 的感染与死亡案例，以及全球的疫情趋势。</p><hr><h2 id=概览>概览</h2><p>GitHub 仓库地址：<a href=https://github.com/Vonng/pigsty-app/tree/master/covid>https://github.com/Vonng/pigsty-app/tree/master/covid</a></p><p>在线Demo地址：<a href=https://demo.pigsty.cc/d/covid>https://demo.pigsty.cc/d/covid</a></p><p><a href=https://demo.pigsty.cc/d/covid><img src=/img/docs/app/covid.jpg alt></a></p><hr><h2 id=安装>安装</h2><p>在管理节点上进入应用目录，执行<code>make</code>以完成安装。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make            <span style=color:#8f5902;font-style:italic># 完成所有配置 </span>
</span></span></code></pre></div><p>其他一些子任务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make reload     <span style=color:#8f5902;font-style:italic># download latest data and pour it again</span>
</span></span><span style=display:flex><span>make ui         <span style=color:#8f5902;font-style:italic># install grafana dashboards</span>
</span></span><span style=display:flex><span>make sql        <span style=color:#8f5902;font-style:italic># install database schemas</span>
</span></span><span style=display:flex><span>make download   <span style=color:#8f5902;font-style:italic># download latest data</span>
</span></span><span style=display:flex><span>make load       <span style=color:#8f5902;font-style:italic># load downloaded data into database</span>
</span></span><span style=display:flex><span>make reload     <span style=color:#8f5902;font-style:italic># download latest data and pour it into database</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-41257227641757f696b35683a37345dd>25 - StackOverflow 调研</h1><div class=lead>分析 StackOverflow 最近七年全球开发者调研数据中关于数据库的部分</div><hr><h2 id=概览>概览</h2><p>GitHub 仓库地址：<a href=https://github.com/Vonng/pigsty-app/tree/master/db>https://github.com/Vonng/pigsty-app/tree/master/db</a></p><p>在线Demo地址：<a href=https://demo.pigsty.cc/d/sf-survey>https://demo.pigsty.cc/d/sf-survey</a></p><p><a href=https://demo.pigsty.cc/d/sf-survey><img src=/img/docs/app/sf-survey.jpg alt></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-71c4afe134c6d0768ee52d9ca11f5242>26 - DB-Engine 热度分析</h1><div class=lead>分析 DB-Engine 上的数据库管理系统，查阅其流行度变迁。</div><hr><h2 id=概览>概览</h2><p>GitHub 仓库地址：<a href=https://github.com/Vonng/pigsty-app/tree/master/db>https://github.com/Vonng/pigsty-app/tree/master/db</a></p><p>在线Demo地址：<a href=https://demo.pigsty.cc/d/db-engine>https://demo.pigsty.cc/d/db-engine</a></p><p><a href=https://demo.pigsty.cc/d/db-engine><img src=/img/docs/app/db-engine.jpg alt></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-90bea0e09fc3821f240f24c4f991c6a8>27 - 云上算力价格计算器</h1><div class=lead>分析阿里云 / AWS 上算力与存储的价格 (ECS/ESSD)</div><hr><h2 id=概览>概览</h2><p>GitHub 仓库地址：<a href=https://github.com/Vonng/pigsty-app/tree/master/cloud>https://github.com/Vonng/pigsty-app/tree/master/cloud</a></p><p>在线Demo地址：<a href=https://demo.pigsty.cc/d/ecs>https://demo.pigsty.cc/d/ecs</a></p><p>文章地址：《<a href=/blog/cloud/ecs>剖析算力成本：阿里云真降价了吗？</a>》</p><h2 id=数据源>数据源</h2><p>Aliyun ECS 价格可以在 <a href=https://www.aliyun.com/price/product#/commodity/vm>价格计算器 - 定价详情 - 价格下载</a> 中获取 CSV 原始数据。</p><h2 id=模式>模式</h2><p>下载 阿里云 价格明细并导入分析</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>EXTENSION</span><span style=color:#f8f8f8> </span><span style=color:#000>file_fdw</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#000>SERVER</span><span style=color:#f8f8f8> </span><span style=color:#000>fs</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOREIGN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>DATA</span><span style=color:#f8f8f8> </span><span style=color:#000>WRAPPER</span><span style=color:#f8f8f8> </span><span style=color:#000>file_fdw</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOREIGN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>aliyun_ecs</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOREIGN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>aliyun_ecs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;region&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;system&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;network&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;isIO&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;instanceId&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;hourlyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;weeklyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;standard&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;monthlyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;yearlyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;2yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;3yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;4yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;5yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;instanceLabel&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;familyId&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;serverType&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;cpu&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;localStorage&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;NvmeSupport&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceFamilyLevel&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EniTrunkSupported&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstancePpsRx&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;GPUSpec&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;CpuTurboFrequency&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstancePpsTx&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceTypeId&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;GPUAmount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceTypeFamily&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;SecondaryEniQueueNumber&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EniQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EniPrivateIpAddressQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;DiskQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EniIpv6AddressQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceCategory&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;CpuArchitecture&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EriQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;MemorySize&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;EniTotalQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;PhysicalProcessorModel&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceBandwidthRx&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;Generation&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;CpuSpeedFrequency&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;PrimaryEniQueueNumber&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;LocalStorageCategory&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceBandwidthTx&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;TotalEniQueueQuantity&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>text</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#000>SERVER</span><span style=color:#f8f8f8> </span><span style=color:#000>fs</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>OPTIONS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8> </span><span style=color:#000>filename</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/tmp/aliyun-ecs.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>format</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>AWS EC2 同理，可以从 Vantage 下载价格清单：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOREIGN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>aws_ec2</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>CASCADE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>FOREIGN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8> </span><span style=color:#000>aws_ec2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;Memory&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;vCPUs&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;GPUs&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;ClockSpeed&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;InstanceStorage&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;NetworkPerformance&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;ondemand&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;reserve&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#4e9a06>&#34;spot&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87>TEXT</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#000>SERVER</span><span style=color:#f8f8f8> </span><span style=color:#000>fs</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>OPTIONS</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8> </span><span style=color:#000>filename</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/tmp/aws-ec2.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#000>format</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VIEW</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>ecs</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VIEW</span><span style=color:#f8f8f8> </span><span style=color:#000>ecs</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;region&#34;</span><span style=color:#f8f8f8>                                       </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>region</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#f8f8f8>                                           </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;instanceLabel&#34;</span><span style=color:#f8f8f8>                                </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;familyId&#34;</span><span style=color:#f8f8f8>                                     </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>family</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8>                                 </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>cpu</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;MemorySize&#34;</span><span style=color:#f8f8f8>                                   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>mem</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;5yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycm5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;4yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycm4</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;3yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>36</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycm3</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;2yearPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycm2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;yearlyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycm1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;standard&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycmm</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hourlyPrice&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CpuCoreCount&#34;</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>720</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ycmh</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic>-- ¥ / (core·month)
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;CpuSpeedFrequency&#34;</span><span style=color:#000;font-weight:700>::</span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8>                   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>freq</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;CpuTurboFrequency&#34;</span><span style=color:#000;font-weight:700>::</span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8>                   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>freq_turbo</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;Generation&#34;</span><span style=color:#f8f8f8>                                   </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>generation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>aliyun_ecs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;linux&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VIEW</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8> </span><span style=color:#000>ec2</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>VIEW</span><span style=color:#f8f8f8> </span><span style=color:#000>ec2</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>split_part</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>                                                               </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#000>family</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>split_part</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8>                                                               </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#000>spec</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>regexp_match</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>split_part</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;^[a-zA-Z]+(\d)[a-z0-9]*&#39;</span><span style=color:#000;font-weight:700>))[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>                 </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#000>gen</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>regexp_substr</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;vCPUs&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;^[0-9]+&#39;</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>int</span><span style=color:#f8f8f8>                                               </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#000>cpu</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#000>regexp_substr</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Memory&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;^[0-9]+&#39;</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>int</span><span style=color:#f8f8f8>                                              </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#000>mem</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#204a87;font-weight:700>CASE</span><span style=color:#f8f8f8> </span><span style=color:#000>spot</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>WHEN</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;unavailable&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>THEN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>ELSE</span><span style=color:#f8f8f8> </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>regexp_substr</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;spot&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;([0-9]+.[0-9]+)&#39;</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>END</span><span style=color:#f8f8f8>     </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>spot</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#204a87;font-weight:700>CASE</span><span style=color:#f8f8f8> </span><span style=color:#000>ondemand</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>WHEN</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;unavailable&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>THEN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>ELSE</span><span style=color:#f8f8f8> </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>regexp_substr</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;ondemand&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;([0-9]+.[0-9]+)&#39;</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>END</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>ondemand</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#204a87;font-weight:700>CASE</span><span style=color:#f8f8f8> </span><span style=color:#000>reserve</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>WHEN</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;unavailable&#39;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>THEN</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>           </span><span style=color:#204a87;font-weight:700>ELSE</span><span style=color:#f8f8f8> </span><span style=color:#000>round</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>regexp_substr</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;reserve&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;([0-9]+.[0-9]+)&#39;</span><span style=color:#000;font-weight:700>)::</span><span style=color:#204a87>NUMERIC</span><span style=color:#f8f8f8> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>END</span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>       </span><span style=color:#4e9a06>&#34;ClockSpeed&#34;</span><span style=color:#f8f8f8>                                                                         </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8> </span><span style=color:#000>freq</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#000>aws_ec2</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>