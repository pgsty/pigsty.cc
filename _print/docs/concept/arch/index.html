<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/concept/arch/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/concept/arch/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>积木式架构 | PIGSTY</title><meta name=description content="Pigsty 的模块化架构介绍 —— 声明式组合，按需定制，自由部署。"><meta property="og:url" content="https://pigsty.cc/docs/concept/arch/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="积木式架构"><meta property="og:description" content="Pigsty 的模块化架构介绍 —— 声明式组合，按需定制，自由部署。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="积木式架构"><meta itemprop=description content="Pigsty 的模块化架构介绍 —— 声明式组合，按需定制，自由部署。"><meta itemprop=dateModified content="2026-02-09T18:41:01+08:00"><meta itemprop=wordCount content="206"><meta itemprop=keywords content="概念,PIGSTY"><meta name=twitter:card content="summary"><meta name=twitter:title content="积木式架构"><meta name=twitter:description content="Pigsty 的模块化架构介绍 —— 声明式组合，按需定制，自由部署。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/concept/arch/>返回本页常规视图</a>.</p></div><h1 class=title>积木式架构</h1><div class=lead>Pigsty 的模块化架构介绍 —— 声明式组合，按需定制，自由部署。</div><ul><li>1: <a href=#pg-66767bf2f054756113e02343d62b9774>节点</a></li><li>2: <a href=#pg-d65561d0ed395a21fc6b7dd2654dc081>INFRA 架构</a></li><li>3: <a href=#pg-c777ff17702df77ebc33dadeb81e4174>PGSQL 架构</a></li></ul><div class=content><p>Pigsty 使用 <strong>模块化架构</strong> 与 <strong>声明式接口</strong>，您可以像 <a href=/docs/deploy/planning#%E5%B8%B8%E8%A7%81%E6%96%B9%E6%A1%88><strong>搭积木一样自由按需组合模块</strong></a>。</p><ul><li>Pigsty 采用 <a href=/docs/deploy/planning><strong>模块化设计</strong></a>，可自由组合，按需使用（Use one or all），以适应不同场景的需求。</li><li>Pigsty 使用 <a href=/docs/concept/iac/inventory><strong>配置清单</strong></a> 和 <a href=/docs/concept/iac/parameter><strong>配置参数</strong></a> 描述整套部署环境，并通过 <a href=/docs/setup/playbook><strong>Ansible 剧本</strong></a> 实现部署与调整。</li><li>Pigsty 在可以在任意 <a href=/docs/concept/arch/node><strong>节点</strong></a> 上运行，无论是物理裸机还是虚拟机，只要运行 <a href=/docs/ref/linux><strong>兼容的操作系统</strong></a> 即可。</li></ul><hr><h2 id=模块>模块</h2><p>Pigsty 采用模块化设计，有六个主要的默认模块：<a href=/docs/pgsql><code>PGSQL</code></a>、<a href=/docs/infra><code>INFRA</code></a>、<a href=/docs/node><code>NODE</code></a>、<a href=/docs/etcd><code>ETCD</code></a>、<a href=/docs/redis><code>REDIS</code></a> 和 <a href=/docs/minio><code>MINIO</code></a>。</p><ul><li><a href=/docs/pgsql><strong><code>PGSQL</code></strong></a>：由 Patroni、Pgbouncer、HAproxy、PgBackrest 等驱动的自治高可用 Postgres 集群。</li><li><a href=/docs/infra><strong><code>INFRA</code></strong></a>：本地软件仓库、Nginx、Grafana、Victoria、AlertManager、Blackbox Exporter 可观测性全家桶。</li><li><a href=/docs/node><strong><code>NODE</code></strong></a>：调整节点到所需状态、名称、时区、NTP、ssh、sudo、haproxy、docker、vector、keepalived</li><li><a href=/docs/etcd><strong><code>ETCD</code></strong></a>：分布式键值存储，用作高可用 Postgres 集群的 DCS：共识选主/配置管理/服务发现。</li><li><a href=/docs/redis><strong><code>REDIS</code></strong></a>：Redis 服务器，支持独立主从、哨兵、集群模式，并带有完整的监控支持。</li><li><a href=/docs/minio><strong><code>MINIO</code></strong></a>：与 S3 兼容的简单对象存储服务器，可作为 PG数据库备份的可选目的地。</li></ul><p>你可以声明式地自由组合它们。如果你想要主机监控，在基础设施节点上安装 <a href=/docs/infra><code>INFRA</code></a> 模块，并在纳管节点上安装 <a href=/docs/node><code>NODE</code></a> 模块就足够了。
<a href=/docs/etcd><code>ETCD</code></a> 和 <a href=/docs/pgsql><code>PGSQL</code></a> 模块用于搭建高可用 PG 集群，将模块安装在多个节点上，可以自动形成一个高可用的数据库集群。
您可以复用 Pigsty 基础架构并开发您自己的模块，<a href=/docs/redis><code>REDIS</code></a> 和 <a href=/docs/minio><code>MINIO</code></a> 可以作为一个样例。后续还会有更多的模块加入，例如对 Mongo 与 MySQL 的初步支持已经提上了日程。</p><p>请注意，所有模块都强依赖 <code>NODE</code> 模块：在 Pigsty 中节点必须先安装 <code>NODE</code> 模块，被 Pigsty 纳管后方可部署其他模块。
当节点（默认）使用本地软件源进行安装时，<code>NODE</code> 模块对 <code>INFRA</code> 模块有弱依赖。因此安装 <code>INFRA</code> 模块的管理节点/基础设施节点会在 <a href=/docs/setup/playbook><code>deploy.yml</code></a> 剧本中完成 Bootstrap 过程，解决循环依赖。</p><p><a href=/docs/deploy/sandbox><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></a></p><hr><h2 id=单机安装>单机安装</h2><p>默认情况下，Pigsty 将在单个 <strong>节点</strong> (物理机/虚拟机) 上安装。<a href=https://github.com/pgsty/pigsty/blob/main/deploy.yml><code>deploy.yml</code></a> 剧本将在<strong>当前</strong>节点上安装 <a href=/docs/infra><code>INFRA</code></a>、<a href=/docs/etcd><code>ETCD</code></a>、<a href=/docs/pgsql><code>PGSQL</code></a> 和可选的 <a href=/docs/minio><code>MINIO</code></a> 模块，
这将为你提供一个功能完备的可观测性技术栈全家桶 (Prometheus、Grafana、Loki、AlertManager、PushGateway、BlackboxExporter 等) ，以及一个内置的 PostgreSQL 单机实例作为 CMDB，也可以开箱即用。 (集群名 <code>pg-meta</code>，库名为 <code>meta</code>)。</p><p>这个节点现在会有完整的自我监控系统、可视化工具集，以及一个自动配置有 PITR 的 Postgres 数据库（HA不可用，因为你只有一个节点）。你可以使用此节点作为开发箱、测试、运行演示以及进行数据可视化和分析。或者，还可以把这个节点当作管理节点，部署纳管更多的节点！</p><p><a href=/docs/infra/><img src=/img/pigsty/arch.png alt=pigsty-arch></a></p><hr><h2 id=监控>监控</h2><p>安装的 <a href=#%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85>单机元节点</a> 可用作<strong>管理节点</strong>和<strong>监控中心</strong>，以将更多节点和数据库服务器置于其监视和控制之下。</p><p>Pigsty 的监控系统可以独立使用，如果你想安装 Prometheus / Grafana 可观测性全家桶，Pigsty 为你提供了最佳实践！
它为 <a href=https://demo.pigsty.cc/d/node-overview>主机节点</a> 和 <a href=https://demo.pigsty.cc/d/pgsql-overview>PostgreSQL数据库</a> 提供了丰富的仪表盘。
无论这些节点或 PostgreSQL 服务器是否由 Pigsty 管理，只需简单的配置，你就可以立即拥有生产级的监控和告警系统，并将现有的主机与PostgreSQL纳入监管。</p><p><a href=/docs/pgsql/dashboard/><img src=/img/pigsty/dashboard.jpg alt=pigsty-dashboard.jpg></a></p><hr><h2 id=高可用pg集群>高可用PG集群</h2><p>Pigsty 帮助您在任何地方 <strong>拥有</strong> 您自己的生产级高可用 PostgreSQL RDS 服务。</p><p>要创建这样一个高可用 PostgreSQL 集群/RDS服务，你只需用简短的配置来描述它，并运行剧本来创建即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bin/pgsql-add pg-test  <span style=color:#8f5902;font-style:italic># 初始化集群 &#39;pg-test&#39;</span>
</span></span></code></pre></div><p>不到10分钟，您将拥有一个服务接入，监控，备份PITR，高可用配置齐全的 PostgreSQL 数据库集群。</p><p><a href=/docs/concept/ha><img src=/img/pigsty/ha.png alt=pigsty-ha.png></a></p><p>硬件故障由 patroni、etcd 和 haproxy 提供的自愈高可用架构来兜底，在主库故障的情况下，默认会在 45 秒内执行自动故障转移（Failover）。
客户端无需修改配置重启应用：Haproxy 利用 patroni 健康检查进行流量分发，读写请求会自动分发到新的集群主库中，并避免脑裂的问题。
这一过程十分丝滑，例如在从库故障，或主动切换（switchover）的情况下，客户端只有一瞬间的当前查询闪断，</p><p>软件故障、人为错误和 数据中心级灾难由 pgbackrest 和可选的 <a href=/docs/minio>MinIO</a> 集群来兜底。这为您提供了本地/云端的 PITR 能力，并在数据中心失效的情况下提供了跨地理区域复制，与异地容灾功能。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-66767bf2f054756113e02343d62b9774>1 - 节点</h1><div class=lead>节点（node）是对硬件资源/操作系统的抽象，可以是物理机，裸金属、虚拟机、或者容器与 pods。</div><p><strong>节点（node）</strong> 是对硬件资源/操作系统的抽象，可以是物理机，裸金属、虚拟机、或者容器与 pods。</p><p>只要装着 <a href=/docs/ref/linux><strong>Linux 操作系统</strong></a>（以及 systemd 守护进程），能使用 CPU/内存/磁盘/网络 等标准资源，即可视作节点。</p><p>节点上可以安装 <a href=/docs/ref/module><strong>模块</strong></a>，Pigsty 中存在几种不同类型节点，主要区别就在于安装了不同的模块。</p><table class=full-width><thead><tr><th style=text-align:center>类型</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:center><a href=#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9><strong>普通节点</strong></a></td><td style=text-align:left>被 Pigsty 管理的节点</td></tr><tr><td style=text-align:center><a href=#admin%E8%8A%82%E7%82%B9><strong>ADMIN 节点</strong></a></td><td style=text-align:left>使用 Ansible 发出管理指令的节点</td></tr><tr><td style=text-align:center><a href=#infra%E8%8A%82%E7%82%B9><strong>INFRA 节点</strong></a></td><td style=text-align:left>安装 <a href=/docs/infra/><strong>INFRA</strong></a> 模块的基础设施节点</td></tr><tr><td style=text-align:center><a href=#etcd%E8%8A%82%E7%82%B9><strong>ETCD 节点</strong></a></td><td style=text-align:left>安装 <a href=/docs/etcd/><strong>ETCD</strong></a> 模块的分布式共识节点</td></tr><tr><td style=text-align:center><a href=#minio%E8%8A%82%E7%82%B9><strong>MINIO 节点</strong></a></td><td style=text-align:left>安装 <a href=/docs/minio/><strong>MINIO</strong></a> 模块的对象存储节点</td></tr><tr><td style=text-align:center><a href=#pgsql%E8%8A%82%E7%82%B9><strong>PGSQL 节点</strong></a></td><td style=text-align:left>安装 <a href=/docs/pgsql/><strong>PGSQL</strong></a> 模块的数据库节点</td></tr><tr><td style=text-align:center>……</td><td style=text-align:left>安装了其他各类模块的节点……</td></tr></tbody></table><p>在 <a href=/docs/setup/install><strong>单机部署</strong></a> Pigsty 时，多者合而为一，当前节点将同时作为普通节点，管理节点、基础设施节点、ETCD 节点，以及数据库节点。</p><hr><h2 id=普通节点>普通节点</h2><p>使用 Pigsty 管理节点，可在其上安装模块。<a href=/docs/node/playbook#nodeyml><strong><code>node.yml</code></strong></a> 剧本将调整节点至所需状态。
普通节点上可能会运行以下服务：</p><table class=full-width><thead><tr><th style=text-align:center>组件</th><th style=text-align:center>端口</th><th>描述</th><th>状态</th></tr></thead><tbody><tr><td style=text-align:center><strong><code>node_exporter</code></strong></td><td style=text-align:center><code>9100</code></td><td>节点监控指标导出器</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>haproxy</code></strong></td><td style=text-align:center><code>9101</code></td><td>HAProxy 负载均衡器（管理端口）</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>vector</code></strong></td><td style=text-align:center><code>9598</code></td><td>日志收集代理</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>docker</code></strong></td><td style=text-align:center><code>9323</code></td><td>启用容器支持</td><td>⚠️ 按需启用</td></tr><tr><td style=text-align:center><strong><code>keepalived</code></strong></td><td style=text-align:center><code>n/a</code></td><td>管理节点集群 L2 VIP</td><td>⚠️ 按需启用</td></tr><tr><td style=text-align:center><strong><code>keepalived_exporter</code></strong></td><td style=text-align:center><code>9650</code></td><td>监控 Keepalived 状态</td><td>⚠️ 按需启用</td></tr></tbody></table><p>这里，<code>node_exporter</code> 会向监控系统暴露主机上的各类监控指标，<code>vector</code> 会向日志收集系统发送日志，<code>haproxy</code> 则提供负载均衡功能，对外暴露服务。
这三项服务默认开启。而 <a href=/docs/docker><strong>Docker</strong></a>，<code>keepalived</code> 及 <code>keepalived_exporter</code> 这三项服务作为可选项，可按需启用。</p><hr><h2 id=admin节点>ADMIN节点</h2><p>一套 Pigsty 部署中有且只有一个 <strong>管理节点</strong>，管理节点是执行 Ansible 剧本，发起控制/部署命令的节点。</p><p>该节点拥有对所有其他节点的 <code>ssh/sudo</code> 访问权限。管理节点的安全至关重要，请确保它的访问受到严格控制。</p><p>在 <a href=/docs/setup/install><strong>单机安装</strong></a> 的 <a href=/docs/concept/iac/configure><strong>配置过程</strong></a> 中，当前安装节点就是管理节点。
但也有其他的可能，例如，如果你的笔记本可以 ssh 访问所有被管理节点，并且安装了 Ansible，那么在这种情况下，
您的笔记本电脑就可以作为一个管理节点 —— 尽管这对于生产环境来说不太合适。</p><p>例如，您使用自己的笔记本电脑，管理一台云端上部署了 Pigsty 的虚拟机，这时候，您的笔记本电脑就是管理节点。</p><p>在严肃的生产环境中，管理节点通常是 1-2 台 DBA 专用的 <strong>管控机</strong>。在资源受限的环境中，则通常会复用 <a href=#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 作为管理节点。
因为所有的 INFRA 节点上都默认安装了 Ansible，可以作为额外的备用的管理节点。</p><hr><h2 id=infra节点>INFRA节点</h2><p>一套 Pigsty 部署可能有 <strong>1</strong> 个或多个 INFRA 节点，大型生产环境可能有 <strong>2-3</strong> 个。</p><p>配置清单中的 <strong><code>infra</code></strong> 分组指定哪些节点是 INFRA节点，这些节点上会部署 <a href=/docs/infra/><strong>INFRA</strong></a> 模块，包含下列组件：</p><table class=full-width><thead><tr><th style=text-align:center>组件</th><th style=text-align:center>端口</th><th>描述</th></tr></thead><tbody><tr><td style=text-align:center><code>nginx</code></td><td style=text-align:center><code>80/443</code></td><td>Web 图形界面，本地软件仓库</td></tr><tr><td style=text-align:center><code>grafana</code></td><td style=text-align:center><code>3000</code></td><td>可视化平台</td></tr><tr><td style=text-align:center><code>victoriaMetrics</code></td><td style=text-align:center><code>8428</code></td><td>时序数据库（收存监控指标）</td></tr><tr><td style=text-align:center><code>victoriaLogs</code></td><td style=text-align:center><code>9428</code></td><td>日志收集服务器</td></tr><tr><td style=text-align:center><code>victoriaTraces</code></td><td style=text-align:center><code>10428</code></td><td>链路追踪收集服务器</td></tr><tr><td style=text-align:center><code>vmalert</code></td><td style=text-align:center><code>8880</code></td><td>告警与衍生指标计算规则</td></tr><tr><td style=text-align:center><code>alertmanager</code></td><td style=text-align:center><code>9059</code></td><td>告警聚合分发/屏蔽管理</td></tr><tr><td style=text-align:center><code>blackbox_exporter</code></td><td style=text-align:center><code>9115</code></td><td>黑盒探测，ping 节点 / vip</td></tr><tr><td style=text-align:center><code>dnsmasq</code></td><td style=text-align:center><code>53</code></td><td>内部 DNS 域名解析</td></tr><tr><td style=text-align:center><code>chronyd</code></td><td style=text-align:center><code>123</code></td><td>NTP 时间服务器</td></tr><tr><td style=text-align:center><code>ansible</code></td><td style=text-align:center><code>-</code></td><td>执行剧本，发起管理</td></tr></tbody></table><p>其中，Nginx 作为当前模块的入口，提供 Web 图形界面和本地软件仓库服务。
如果你部署多个 INFRA 节点，每个 Infra 节点上的服务是相互独立的。
但你确实可以从任意一个 Infra 节点上的 Grafana 访问所有的监控数据源。</p><p>Pigsty 使用 <a href=/docs/about/license><strong>Apache-2.0</strong></a> 许可证开源，但请注意其中的 Grafana 组件使用 AGPLv3 许可证。</p><hr><h2 id=etcd节点>ETCD节点</h2><p><a href=/docs/etcd><strong>ETCD</strong></a> 模块为 PostgreSQL 高可用提供分布式共识服务（DCS）。</p><p><a href=/docs/concept/iac/inventory><strong>配置清单</strong></a> 中的 <strong><code>etcd</code></strong> 分组指定哪些节点是 ETCD 节点，ETCD 节点上运行着 etcd 服务器，监听以下两个端口：</p><table class=full-width><thead><tr><th style=text-align:center>组件</th><th style=text-align:center>端口</th><th>描述</th></tr></thead><tbody><tr><td style=text-align:center><code>etcd</code></td><td style=text-align:center><code>2379</code></td><td>ETCD 分布式键值存储（客户端端口）</td></tr><tr><td style=text-align:center><code>etcd</code></td><td style=text-align:center><code>2380</code></td><td>ETCD 集群 Peer 通信端口</td></tr></tbody></table><hr><h2 id=minio节点>MINIO节点</h2><p><a href=/docs/minio><strong>MINIOn</strong></a> 模块为 PostgreSQL 提供了一个可选的 <a href=/docs/pgsql/backup/repository><strong>备份存储仓库</strong></a>。</p><p>配置清单中的 <strong><code>minio</code></strong> 分组指定哪些节点是 MinIO 节点，这些节点上会运行 MinIO 服务器，监听以下端口：</p><table class=full-width><thead><tr><th style=text-align:center>组件</th><th style=text-align:center>端口</th><th>描述</th></tr></thead><tbody><tr><td style=text-align:center><code>minio</code></td><td style=text-align:center><code>9000</code></td><td>MinIO S3 API 服务端口</td></tr><tr><td style=text-align:center><code>minio</code></td><td style=text-align:center><code>9001</code></td><td>MinIO 管理控制台端口</td></tr></tbody></table><hr><h2 id=pgsql节点>PGSQL节点</h2><p>安装了 <a href=/docs/pgsql/><strong>PGSQL</strong></a> 模块的节点被称为 PGSQL 节点。节点与 PostgreSQL 实例为 1:1 部署，也就是每个节点上只运行一个 PG 实例。</p><p>PGSQL 节点可从相应 PostgreSQL 实例借用 <strong>身份</strong> —— 由 <a href=/docs/node/param/#node_id_from_pg><code>node_id_from_pg</code></a> 控制，默认为 <code>true</code>，即节点名会被设置为 PG 实例名。</p><p>PGSQL节点在 <a href=#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9><strong>普通节点</strong></a> 的基础上，还会额外运行以下组件：</p><table class=full-width><thead><tr><th style=text-align:center>组件</th><th style=text-align:center>端口</th><th>描述</th><th>状态</th></tr></thead><tbody><tr><td style=text-align:center><strong><code>postgres</code></strong></td><td style=text-align:center><code>5432</code></td><td>PostgreSQL 数据库服务器</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>pgbouncer</code></strong></td><td style=text-align:center><code>6432</code></td><td>Pgbouncer 连接池</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>patroni</code></strong></td><td style=text-align:center><code>8008</code></td><td>Patroni 高可用管理组件</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>pg_exporter</code></strong></td><td style=text-align:center><code>9630</code></td><td>Postgres 监控指标导出器</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>pgbouncer_exporter</code></strong></td><td style=text-align:center><code>9631</code></td><td>PGBouncer 监控指标导出器</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>pgbackrest_exporter</code></strong></td><td style=text-align:center><code>9854</code></td><td>Pgbackrest 监控指标导出器</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>vip-manager</code></strong></td><td style=text-align:center><code>n/a</code></td><td>将 L2 VIP 绑定在集群主库节点上</td><td>⚠️ 按需启用</td></tr><tr><td style=text-align:center><strong><code>{{ pg_cluster }}-primary</code></strong></td><td style=text-align:center><code>5433</code></td><td>通过 <code>haproxy</code> 对外暴露数据库服务：主连接池：读/写服务</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>{{ pg_cluster }}-replica</code></strong></td><td style=text-align:center><code>5434</code></td><td>通过 <code>haproxy</code> 对外暴露数据库服务：副本连接池：只读服务</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>{{ pg_cluster }}-default</code></strong></td><td style=text-align:center><code>5436</code></td><td>通过 <code>haproxy</code> 对外暴露数据库服务：主直连服务</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>{{ pg_cluster }}-offline</code></strong></td><td style=text-align:center><code>5438</code></td><td>通过 <code>haproxy</code> 对外暴露数据库服务：离线直连：离线读服务</td><td>✅ 默认启用</td></tr><tr><td style=text-align:center><strong><code>{{ pg_cluster }}-&lt;service></code></strong></td><td style=text-align:center><code>543x</code></td><td>通过 <code>haproxy</code> 对外暴露数据库服务：PostgreSQL 定制服务</td><td>⚠️按需定制</td></tr></tbody></table><p>其中，<code>vip-manager</code> 只有当用户配置了 <strong>PG VIP</strong> 时才会启用。
在 <a href=/docs/pgsql/service><strong><code>pg_services</code></strong></a> 中可以定义更多的 <a href=/docs/pgsql/service#%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1><strong>自定义服务</strong></a>，这些服务会被 <code>haproxy</code> 对外暴露，并使用更多的服务端口。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d65561d0ed395a21fc6b7dd2654dc081>2 - INFRA 架构</h1><div class=lead>Pigsty 中基础设施模块的架构，组件与功能详解。</div><p>运行生产级别高可用 PostgreSQL 集群，通常需要一套完善的基础设施服务（底座）来支撑，例如监控告警、日志收集、时间同步、DNS 解析，本地软件仓库等。
Pigsty 提供了 <a href=/docs/infra><strong>INFRA 模块</strong></a> 来解决这个问题 —— 这是一个 <strong>可选模块</strong>，但我们强烈推荐启用它。</p><hr><h2 id=概览>概览</h2><p>下图是 <a href=/docs/setup/install><strong>单机部署</strong></a> 时的架构示意图，图中右半部分即为 <a href=/docs/infra><strong>INFRA 模块</strong></a> 所包含的组件，其中包括：</p><table><thead><tr><th style=text-align:left>组件</th><th>种类</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><a href=#nginx><strong>Nginx</strong></a></td><td>Web服务器</td><td style=text-align:left><a href=/docs/setup/webui><strong>Web 界面</strong></a> 的统一入口，<a href=#repo><strong>本地软件仓库</strong></a>，内部服务的反向代理</td></tr><tr><td style=text-align:left><a href=#repo><strong>Repo</strong></a></td><td>软件仓库</td><td style=text-align:left>APT / DNF 仓库，下载有所有部署需要的 RPM/DEB 包及其依赖</td></tr><tr><td style=text-align:left><a href=#grafana><strong>Grafana</strong></a></td><td>可视化平台</td><td style=text-align:left>呈现监控指标、日志与链路追踪，承载监控大屏、巡检报表以及自定义数据应用。</td></tr><tr><td style=text-align:left><a href=#victoriametrics><strong>VictoriaMetrics</strong></a></td><td>时序数据库</td><td style=text-align:left>拉取全部监控指标，兼容 Prometheus API，并通过 VMUI 提供查询界面。</td></tr><tr><td style=text-align:left><a href=#victorialogs><strong>VictoriaLogs</strong></a></td><td>日志平台</td><td style=text-align:left>集中收集存储日志，所有节点默认运行 Vector，将系统日志与数据库日志推送到此。</td></tr><tr><td style=text-align:left><a href=#victoriatraces><strong>VictoriaTraces</strong></a></td><td>链路追踪</td><td style=text-align:left>收集慢 SQL、服务链路等追踪数据。</td></tr><tr><td style=text-align:left><a href=#vmalert><strong>VMAlert</strong></a></td><td>告警计算</td><td style=text-align:left>评估告警规则，将事件推送至 Alertmanager。</td></tr><tr><td style=text-align:left><a href=#alertmanager><strong>AlertManager</strong></a></td><td>告警管理</td><td style=text-align:left>聚合告警事件，分发告警通知，支持邮件、Webhook 等渠道。</td></tr><tr><td style=text-align:left><a href=#blackboxexporter><strong>BlackboxExporter</strong></a></td><td>黑盒探测</td><td style=text-align:left>探测各个 IP/VIP/URL 的可达性。</td></tr><tr><td style=text-align:left><a href=#dnsmasq><strong>DNSMASQ</strong></a></td><td>DNS解析</td><td style=text-align:left>提供 DNS 解析服务，解析 Pigsty 内部使用到的域名。【可选】</td></tr><tr><td style=text-align:left><a href=#chronyd><strong>Chronyd</strong></a></td><td>时间同步</td><td style=text-align:left>提供 NTP 时间同步服务，确保所有节点时间一致。 【可选】</td></tr><tr><td style=text-align:left><a href=/docs/concept/sec/ca><strong>CA</strong></a></td><td>证书签发</td><td style=text-align:left>签发环境内的加密证书</td></tr><tr><td style=text-align:left><a href=/docs/setup/playbook><strong>Ansible</strong></a></td><td>发起管理</td><td style=text-align:left>批量，声明式，无 Agent 管理大量服务器的工具</td></tr></tbody></table><p><a href=/docs/infra/><img src=/img/pigsty/arch.png alt=pigsty-arch></a></p><hr><h2 id=nginx>Nginx</h2><p><strong>Nginx</strong> 是 Pigsty 所有 WebUI 类服务的访问入口，默认使用 <a href=/docs/infra/param#nginx_port><strong><code>80</code></strong></a> / <a href=/docs/infra/param#nginx_ssl_port><strong><code>443</code></strong></a> 端口对外提供 HTTP / HTTPS 服务。<a href=https://demo.pigsty.cc/><strong>在线演示</strong></a></p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10><strong><code>http://10.10.10.10</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/zh><strong><code>http://i.pigsty</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/zh><strong><code>https://i.pigsty</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/zh><strong><code>https://demo.pigsty.cc</code></strong></a></td><td></td></tr></tbody></table><p>带有 WebUI 的基础设施组件可以通过 <strong>Nginx</strong> 统一对外暴露服务，例如 <strong>Grafana</strong>、<strong>VictoriaMetrics</strong>（VMUI）、<strong>AlertManager</strong>，
以及 <strong>HAProxy</strong> 控制台，此外，<strong>本地软件仓库</strong> 等静态文件资源也通过 <strong>Nginx</strong> 对内外提供服务。</p><p><strong>Nginx</strong> 会根据 <a href=/docs/infra/param/#infra_portal><strong><code>infra_portal</code></strong></a> 中的定义，配置本地 Web 服务器或反向代理服务器。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>i.pigsty }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认情况下将对外暴露 Pigsty 的管理首页：<code>i.pigsty</code>，上面不同的端点挂载代理了不同的组件：</p><table class=full-width><thead><tr><th style=text-align:left>端点</th><th style=text-align:left>组件</th><th style=text-align:left>原生端口</th><th style=text-align:left>备注</th><th>公开演示</th></tr></thead><tbody><tr><td style=text-align:left><code>/</code></td><td style=text-align:left><a href=/docs/infra/><strong>Nginx</strong></a></td><td style=text-align:left><code>80/443</code></td><td style=text-align:left>首页、本地仓库、文件服务</td><td><a href=https://demo.pigsty.cc/zh/><code>demo.pigsty.cc/zh/</code></a></td></tr><tr><td style=text-align:left><code>/ui/</code></td><td style=text-align:left><a href=#grafana><strong>Grafana</strong></a></td><td style=text-align:left><code>3000</code></td><td style=text-align:left>Grafana 仪表盘入口</td><td><a href=https://demo.pigsty.cc/ui/><code>demo.pigsty.cc/ui/</code></a></td></tr><tr><td style=text-align:left><code>/vmetrics/</code></td><td style=text-align:left><a href=/docs/infra/><strong>VictoriaMetrics</strong></a></td><td style=text-align:left><code>8428</code></td><td style=text-align:left>时序数据库 Web UI</td><td><a href=https://demo.pigsty.cc/vmetrics/><code>demo.pigsty.cc/vmetrics/</code></a></td></tr><tr><td style=text-align:left><code>/vlogs/</code></td><td style=text-align:left><a href=/docs/infra/><strong>VictoriaLogs</strong></a></td><td style=text-align:left><code>9428</code></td><td style=text-align:left>日志数据库 Web UI</td><td><a href=https://demo.pigsty.cc/vlogs/><code>demo.pigsty.cc/vlogs/</code></a></td></tr><tr><td style=text-align:left><code>/vtraces/</code></td><td style=text-align:left><a href=/docs/infra/><strong>VictoriaTraces</strong></a></td><td style=text-align:left><code>10428</code></td><td style=text-align:left>链路追踪 Web UI</td><td><a href=https://demo.pigsty.cc/vtraces/><code>demo.pigsty.cc/vtraces/</code></a></td></tr><tr><td style=text-align:left><code>/vmalert/</code></td><td style=text-align:left><a href=/docs/infra/><strong>VMAlert</strong></a></td><td style=text-align:left><code>8880</code></td><td style=text-align:left>告警规则管理</td><td><a href=https://demo.pigsty.cc/vmalert/><code>demo.pigsty.cc/vmalert/</code></a></td></tr><tr><td style=text-align:left><code>/alertmgr/</code></td><td style=text-align:left><a href=/docs/infra/><strong>AlertManager</strong></a></td><td style=text-align:left><code>9059</code></td><td style=text-align:left>告警管理 Web UI</td><td><a href=https://demo.pigsty.cc/alertmgr/><code>demo.pigsty.cc/alertmgr/</code></a></td></tr><tr><td style=text-align:left><code>/blackbox/</code></td><td style=text-align:left><a href=/docs/infra/><strong>Blackbox</strong></a></td><td style=text-align:left><code>9115</code></td><td style=text-align:left>黑盒探测器</td><td></td></tr></tbody></table><p><a href=https://demo.pigsty.cc/zh><img src=/img/pigsty/home.png alt></a></p><p>Pigsty 允许对 <strong>Nginx</strong> 进行丰富的定制，将其作为本地文件服务器，或者反向代理服务器，配置自签名或者真正的 HTTPS 证书。</p><p>更多信息，请参阅：<a href=/docs/infra/admin/portal/><strong>教程：Nginx：向外代理暴露Web服务</strong></a> 与 <a href=/docs/infra/admin/cert><strong>教程：Certbot：申请与更新HTTPS证书</strong></a></p><hr><h2 id=repo>Repo</h2><p>Pigsty 会在安装时，默认在 Infra 节点上创建一个 <strong>本地软件仓库</strong>，以加速后续软件安装。<a href=https://demo.pigsty.cc/pigsty/><strong>在线演示</strong></a></p><p>该软件仓库默认位于 <a href=/docs/infra/param#repo_home><strong><code>/www/pigsty</code></strong></a> 目录，
由 <strong>Nginx</strong> 对外提供服务，挂载在 <code>/pigsty</code> 路径上：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/pigsty><strong><code>http://10.10.10.10/pigsty</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/pigsty><strong><code>http://i.pigsty/pigsty</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/pigsty><strong><code>https://i.pigsty/pigsty</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/pigsty><strong><code>https://demo.pigsty.cc/pigsty</code></strong></a></td><td></td></tr></tbody></table><p>Pigsty 支持 <a href=/docs/setup/offline><strong>离线安装</strong></a>，实质上是将做好的本地软件仓库提前复制到目标环境中。
当 Pigsty 执行生产部署，需要创建本地软件仓库时，如果发现本地已经存在 <strong><code>/www/pigsty/repo_complete</code></strong> 标记文件，则会跳过从上游下载软件包的步骤，直接使用已有的软件包，避免联网下载。</p><p><a href=https://demo.pigsty.cc/pigsty/><img src=/img/pigsty/repo.webp alt=repo></a></p><p>更多信息，请参阅：<a href=/docs/infra/param/#repo><strong>配置：INFRA - REPO</strong></a></p><hr><h2 id=grafana>Grafana</h2><p><strong>Grafana</strong> 是 Pigsty 监控系统的核心组件，用于可视化展示监控指标、日志与各种信息。<a href=https://demo.pigsty.cc/ui/><strong>在线演示</strong></a></p><p><strong>Grafana</strong> 默认监听 <code>3000</code> 端口，挂载于 <strong>Nginx</strong> <code>/ui</code> 路径点上代理访问：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/ui><strong><code>http://10.10.10.10/ui</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/ui><strong><code>http://i.pigsty/ui</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/ui><strong><code>https://i.pigsty/ui</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/ui><strong><code>https://demo.pigsty.cc/ui</code></strong></a></td><td></td></tr></tbody></table><p>Pigsty 预置了基于 <strong>VictoriaMetrics</strong> / <strong>Logs</strong> / <strong>Traces</strong> 的大量监控面板，并通过 URL 跳转实现一键下钻上卷，帮助快速定位故障。</p><p><strong>Grafana</strong> 亦可作为低代码可视化平台使用，因此默认安装 <strong>ECharts</strong>、victoriametrics-datasource、victorialogs-datasource 等插件，
同时将 <strong>Vector</strong> / <strong>Victoria</strong> 数据源统一注册为 <code>vmetrics-*</code>、<code>vlogs-*</code>、<code>vtraces-*</code>，方便扩展自定义仪表板。</p><p><img src=/img/dashboard/pigsty.jpg alt=dashboard></p><p>更多信息请参阅：<a href=/docs/infra/param/#grafana><strong>配置：INFRA - GRAFANA</strong></a>。</p><hr><h2 id=victoriametrics>VictoriaMetrics</h2><p><strong>VictoriaMetrics</strong> 是 Pigsty 的时序数据库，负责拉取并存储所有监控指标。<a href=https://demo.pigsty.cc/vmetrics/><strong>在线演示</strong></a></p><p>默认监听 <code>8428</code> 端口，挂载于 <strong>Nginx</strong> <code>/vmetrics</code> 路径上，亦可通过 <code>p.pigsty</code> 域名直接访问：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/vmetrics><strong><code>http://10.10.10.10/vmetrics</code></strong></a></td><td style=text-align:center><a href=http://p.pigsty><strong><code>http://p.pigsty</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/vmetrics><strong><code>https://i.pigsty/vmetrics</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/vmetrics><strong><code>https://demo.pigsty.cc/vmetrics</code></strong></a></td><td></td></tr></tbody></table><p><strong>VictoriaMetrics</strong> 完全兼容 <strong>Prometheus</strong> API，支持 PromQL 查询、远程读写协议以及 Alertmanager API。
内置的 <strong>VMUI</strong> 提供即席查询界面，可直接探索指标数据，也可作为 <strong>Grafana</strong> 的数据源使用。</p><p><a href=https://demo.pigsty.cc/vmetrics/vmui><img src=/img/pigsty/vmetrics.webp alt=vmetrics></a></p><p>更多信息请参阅：<a href=/docs/infra/param/#vmetrics_enabled><strong>配置：INFRA - VMETRICS</strong></a></p><hr><h2 id=victorialogs>VictoriaLogs</h2><p><strong>VictoriaLogs</strong> 是 Pigsty 的日志平台，集中存储来自所有节点的结构化日志。<a href=https://demo.pigsty.cc/vlogs/><strong>在线演示</strong></a></p><p>默认监听 <code>9428</code> 端口，挂载于 <strong>Nginx</strong> <code>/vlogs</code> 路径上：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/vlogs><strong><code>http://10.10.10.10/vlogs</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/vlogs><strong><code>http://i.pigsty/vlogs</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/vlogs><strong><code>https://i.pigsty/vlogs</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/vlogs><strong><code>https://demo.pigsty.cc/vlogs</code></strong></a></td><td></td></tr></tbody></table><p>所有纳管节点默认运行 <strong>Vector</strong> Agent，负责收集系统日志、PostgreSQL 日志、Patroni 日志、Pgbouncer 日志等，结构化处理后推送至 <strong>VictoriaLogs</strong>。
内置 Web UI 支持日志检索与过滤，也可配合 <strong>Grafana</strong> 的 victorialogs-datasource 插件进行可视化分析。</p><p><a href=https://demo.pigsty.cc/vlogs/select/vmui><img src=/img/pigsty/vmlogs.webp alt=vlogs></a></p><p>更多信息请参阅：<a href=/docs/infra/param/#vlogs_enabled><strong>配置：INFRA - VLOGS</strong></a></p><hr><h2 id=victoriatraces>VictoriaTraces</h2><p><strong>VictoriaTraces</strong> 用于收集链路追踪数据与慢 SQL 记录。<a href=https://demo.pigsty.cc/vtraces/><strong>在线演示</strong></a></p><p>默认监听 <code>10428</code> 端口，挂载于 <strong>Nginx</strong> <code>/vtraces</code> 路径上：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/vtraces><strong><code>http://10.10.10.10/vtraces</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/vtraces><strong><code>http://i.pigsty/vtraces</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/vtraces><strong><code>https://i.pigsty/vtraces</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/vtraces><strong><code>https://demo.pigsty.cc/vtraces</code></strong></a></td><td></td></tr></tbody></table><p><strong>VictoriaTraces</strong> 提供 <strong>Jaeger</strong> 兼容接口，可用于分析服务调用链路与数据库慢查询。
结合 <strong>Grafana</strong> 面板，能够快速定位性能瓶颈，追溯问题根因。</p><p>更多信息请参阅：<a href=/docs/infra/param/#vtraces_enabled><strong>配置：INFRA - VTRACES</strong></a></p><hr><h2 id=vmalert>VMAlert</h2><p><strong>VMAlert</strong> 是告警规则计算引擎，负责评估告警规则并将触发的事件推送至 <strong>Alertmanager</strong>。<a href=https://demo.pigsty.cc/vmalert/><strong>在线演示</strong></a></p><p>默认监听 <code>8880</code> 端口，挂载于 <strong>Nginx</strong> <code>/vmalert</code> 路径上：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/vmalert><strong><code>http://10.10.10.10/vmalert</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/vmalert><strong><code>http://i.pigsty/vmalert</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/vmalert><strong><code>https://i.pigsty/vmalert</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/vmalert><strong><code>https://demo.pigsty.cc/vmalert</code></strong></a></td><td></td></tr></tbody></table><p><strong>VMAlert</strong> 从 <strong>VictoriaMetrics</strong> 读取指标数据，周期性执行告警规则评估。
Pigsty 预置了 PGSQL、NODE、REDIS 等模块的告警规则，覆盖常见故障场景，开箱即用。</p><p><a href=https://demo.pigsty.cc/vmalert/vmalert/groups><img src=/img/pigsty/vmalert.webp alt=vmalert></a></p><p>更多信息请参阅：<a href=/docs/infra/param/#vmalert_enabled><strong>配置：INFRA - VMALERT</strong></a></p><hr><h2 id=alertmanager>AlertManager</h2><p><strong>AlertManager</strong> 负责告警事件的聚合、去重、分组与分发。<a href=https://demo.pigsty.cc/alertmgr/><strong>在线演示</strong></a></p><p>默认监听 <code>9059</code> 端口，挂载于 <strong>Nginx</strong> <code>/alertmgr</code> 路径上，亦可通过 <code>a.pigsty</code> 域名直接访问：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/alertmgr><strong><code>http://10.10.10.10/alertmgr</code></strong></a></td><td style=text-align:center><a href=http://a.pigsty><strong><code>http://a.pigsty</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/alertmgr><strong><code>https://i.pigsty/alertmgr</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/alertmgr><strong><code>https://demo.pigsty.cc/alertmgr</code></strong></a></td><td></td></tr></tbody></table><p><strong>AlertManager</strong> 支持多种通知渠道：邮件、Webhook、Slack、PagerDuty、企业微信等。
通过配置告警路由规则，可实现按严重程度、模块类型进行差异化分发，支持静默、抑制等高级功能。</p><p><a href=https://demo.pigsty.cc/alertmgr/><img src=/img/pigsty/alertmanager.webp alt=alertmanager></a></p><p>更多信息请参阅：<a href=/docs/infra/param/#alertmanager_enabled><strong>配置：INFRA - AlertManager</strong></a></p><hr><h2 id=blackboxexporter>BlackboxExporter</h2><p><strong>Blackbox Exporter</strong> 用于主动探测目标的可达性，实现黑盒监控。</p><p>默认监听 <code>9115</code> 端口，挂载于 <strong>Nginx</strong> <code>/blackbox</code> 路径上：</p><table class=full-width><thead><tr><th style=text-align:center>IP访问（替换）</th><th style=text-align:center>域名（HTTP）</th><th style=text-align:center>域名（HTTPS）</th><th style=text-align:center>公开演示</th><th></th></tr></thead><tbody><tr><td style=text-align:center><a href=http://10.10.10.10/blackbox><strong><code>http://10.10.10.10/blackbox</code></strong></a></td><td style=text-align:center><a href=http://i.pigsty/blackbox><strong><code>http://i.pigsty/blackbox</code></strong></a></td><td style=text-align:center><a href=https://i.pigsty/blackbox><strong><code>https://i.pigsty/blackbox</code></strong></a></td><td style=text-align:center><a href=https://demo.pigsty.cc/blackbox><strong><code>https://demo.pigsty.cc/blackbox</code></strong></a></td><td></td></tr></tbody></table><p>支持 ICMP Ping、TCP 端口、HTTP/HTTPS 端点等多种探测方式。
可用于监控 VIP 可达性、服务端口存活、外部依赖健康状态等场景，是判断故障影响范围的重要手段。</p><p><a href=https://demo.pigsty.cc/blackbox/><img src=/img/pigsty/blackbox.webp alt=blackbox></a></p><p>更多信息请参阅：<a href=/docs/infra/param#blackbox_enabled><strong>配置：INFRA - BLACKBOX</strong></a></p><hr><h2 id=ansible>Ansible</h2><p><strong>Ansible</strong> 是 Pigsty 的核心编排工具，所有部署、配置、管理操作均通过 Ansible Playbook 完成。</p><p>Pigsty 在安装时会自动在管理节点（Infra 节点）上安装 <strong>Ansible</strong>。
它采用声明式配置风格与幂等剧本设计：同一剧本可重复执行，系统会自动收敛至期望状态，无需担心副作用。</p><p><strong>Ansible</strong> 的核心优势：</p><ul><li><strong>无 Agent</strong>：通过 SSH 远程执行，无需在目标节点安装额外软件。</li><li><strong>声明式</strong>：描述期望状态，而非执行步骤，配置即文档。</li><li><strong>幂等性</strong>：多次执行结果一致，支持部分失败后重试。</li></ul><p>更多信息请参阅：<a href=/docs/setup/playbook><strong>剧本：Pigsty Playbook</strong></a></p><hr><h2 id=dnsmasq>DNSMASQ</h2><p><strong>DNSMASQ</strong> 在 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上提供环境内的 DNS 解析服务，将域名解析到对应 IP 地址。</p><p>DNSMASQ 默认监听 <code>53</code> 端口（UDP/TCP），为环境内所有节点提供 DNS 解析服务，解析记录位于 的 <code>/infra/hosts</code> 目录中。</p><p>其他模块在部署时会自动将域名注册到 INFRA 节点的 <strong>DNSMASQ</strong> 服务中，您可以按需使用。
DNS 是完全可选的模块，<strong>Pigsty 本身不依赖它即可正常运行</strong>。
客户端节点可将 INFRA 节点配置为 DNS 服务器，即可通过域名访问各服务，无需记忆 IP 地址。</p><ul><li><a href=/docs/infra/param/#dns_records><strong><code>dns_records</code></strong></a> : 写入 INFRA 节点的默认解析记录</li><li><a href=/docs/node/param/#node_dns_servers><strong><code>node_dns_servers</code></strong></a> ：为节点配置 DNS 服务器，默认通过 <a href=/docs/infra/param/#admin_ip><strong><code>admin_ip</code></strong></a> 指向 INFRA 节点。（也可以 <a href=/docs/node/param#node_dns_method><strong>不配置</strong></a>）</li></ul><p>更多信息请参阅：<a href=/docs/infra/param/#dns><strong>配置：INFRA - DNS</strong></a> 与 <a href=/docs/infra/admin/domain><strong>教程：DNS：配置域名解析</strong></a></p><hr><h2 id=chronyd>Chronyd</h2><p><strong>Chronyd</strong> 提供 NTP 时间同步服务，确保环境内所有节点时钟一致。默认监听 <code>123</code> 端口（UDP），作为环境内的时间源。</p><p>时间同步对分布式系统至关重要：日志排查需要时间戳对齐，证书校验依赖时钟准确，<strong>PostgreSQL</strong> 流复制也对时钟偏移敏感。
在隔离网络环境中，INFRA 节点可作为内部 NTP 服务器，其他节点同步至此。</p><p>在 Pigsty 中，默认所有节点都会启动 chonyd 服务用于时间同步。默认使用 <a href=/docs/node/param#node_ntp_servers><strong><code>pool.ntp.org</code></strong></a> 公共 NTP 服务器作为上游时间源。
Chronyd 本质上归属 <a href=/docs/node><strong>Node 模块</strong></a> 管理，但在网络隔离的环境中，你使用 <a href=/docs/infra/param/#admin_ip><strong><code>admin_ip</code></strong></a> 指向 INFRA 节点上的 Chronyd 服务作为内部时间源。
此时 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上的 Chronyd 服务将充当内部时间同步基础设施的角色。
更多信息请参阅：<a href=/docs/node/param/#node_time><strong>配置：NODE - TIME</strong></a></p><hr><h2 id=infra节点与普通节点>INFRA节点与普通节点</h2><p>在 Pigsty 中，节点与基础设施的关系是 <strong>弱循环依赖</strong>：node_monitor → infra → node</p><p><a href=/docs/node><strong>NODE模块</strong></a> 本身不依赖 <a href=/docs/infra><strong>INFRA模块</strong></a>，但节点模块中的监控功能（node_monitor）需要依赖基础设施模块提供的监控平台与服务。</p><p>因此，在 <a href=/docs/infra/playbook#infrayml><strong><code>infra.yml</code></strong></a> 和 <a href=/docs/setup/playbook><strong><code>deploy</code></strong></a> 剧本中，
采用了一种 “交织部署” 的技术：</p><ul><li>首先初始化所有 <a href=/docs/concept/arch/node#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9><strong>普通节点</strong></a> 上的 <a href=/docs/node><strong>NODE模块</strong></a>，但是不配置监控，因为基础设施服务尚未部署完成。</li><li>然后初始化 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 上的 <a href=/docs/infra><strong>INFRA模块</strong></a>，此时监控已经可用</li><li>然后回过头来，重新配置所有 <a href=/docs/concept/arch/node#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9><strong>普通节点</strong></a> 上的监控功能，连接到已经部署完成的监控平台</li></ul><p>如果您不追求 “一次性” 部署所有节点，也可以采用 <a href=/docs/setup/config#%E5%8A%A0%E5%85%A5%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD><strong>分阶段部署</strong></a> 的方式，先初始化 INFRA 节点，然后再初始化其他普通节点即可。</p><h3 id=节点与基础设施是如何耦合的>节点与基础设施是如何耦合的？</h3><p>普通节点会通过 <a href=/docs/infra/param/#admin_ip><strong><code>admin_ip</code></strong></a> 参数来引用某个 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a> 作为它们的基础设施提供者。</p><p>例如，当你配置了全局的 <code>admin_ip = 10.10.10.10</code>，那么通常意味着所有节点都会使用这个 IP 上的基础设施服务。</p><p>这样的设计允许你快速，批量的切换节点的基础设施提供者 —— 以下是 <strong>可能</strong> 引用 <code>${admin_ip}</code> 的配置参数列表：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>模块</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/infra/param/#repo_endpoint><strong><code>repo_endpoint</code></strong></a></td><td style=text-align:center><a href=/docs/infra><strong><code>INFRA</code></strong></a></td><td><code>http://${admin_ip}:80</code></td><td>软件仓库访问地址</td></tr><tr><td style=text-align:left><a href=/docs/infra/param/#repo_upstream><strong><code>repo_upstream</code></strong></a><code>.baseurl</code></td><td style=text-align:center><a href=/docs/infra><strong><code>INFRA</code></strong></a></td><td><code>http://${admin_ip}/pigsty</code></td><td>本地软件源 baseurl</td></tr><tr><td style=text-align:left><a href=/docs/infra/param/#infra_portal><strong><code>infra_portal</code></strong></a><code>.endpoint</code></td><td style=text-align:center><a href=/docs/infra><strong><code>INFRA</code></strong></a></td><td><code>${admin_ip}:&lt;port></code></td><td>Nginx 反向代理后端地址</td></tr><tr><td style=text-align:left><a href=/docs/infra/param/#dns_records><strong><code>dns_records</code></strong></a></td><td style=text-align:center><a href=/docs/infra><strong><code>INFRA</code></strong></a></td><td><code>["${admin_ip} i.pigsty", ...]</code></td><td>DNS 解析记录</td></tr><tr><td style=text-align:left><a href=/docs/node/param/#node_default_etc_hosts><strong><code>node_default_etc_hosts</code></strong></a></td><td style=text-align:center><a href=/docs/node><strong><code>NODE</code></strong></a></td><td><code>["${admin_ip} i.pigsty"]</code></td><td>默认静态 DNS 记录</td></tr><tr><td style=text-align:left><a href=/docs/node/param/#node_etc_hosts><strong><code>node_etc_hosts</code></strong></a></td><td style=text-align:center><a href=/docs/node><strong><code>NODE</code></strong></a></td><td><code>[]</code></td><td>自定义静态 DNS 记录</td></tr><tr><td style=text-align:left><a href=/docs/node/param/#node_dns_servers><strong><code>node_dns_servers</code></strong></a></td><td style=text-align:center><a href=/docs/node><strong><code>NODE</code></strong></a></td><td><code>["${admin_ip}"]</code></td><td>动态 DNS 服务器地址</td></tr><tr><td style=text-align:left><a href=/docs/node/param/#node_ntp_servers><strong><code>node_ntp_servers</code></strong></a></td><td style=text-align:center><a href=/docs/node><strong><code>NODE</code></strong></a></td><td><code>["pool pool.ntp.org iburst"]</code></td><td>NTP 时间服务器（可选）</td></tr></tbody></table><p>例如，当节点安装软件的时候，<code>local</code> 仓库指向的就是 <code>admin_ip:80/pigsty</code> 上的 Nginx 本地软件仓库。DNS 服务器指向的也是 <code>admin_ip:53</code> 上的 <a href=#dnsmasq><strong>DNSMASQ</strong></a>。
但这并不是强制要求的，例如，节点完全可以忽略并不使用 <code>local</code> 仓库，直接从互联网上游源安装（大部分单机配置模板）；DNS 服务器也完全可以不配置与不使用，Pigsty 本身并无对 DNS 服务器的依赖。</p><hr><h2 id=infra节点与admin节点>INFRA节点与ADMIN节点</h2><p>通常发起管理的 <a href=/docs/concept/arch/node#admin%E8%8A%82%E7%82%B9><strong>ADMIN节点</strong></a> 会与基础设施节点（<a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a>）重合。
在 <a href=/docs/setup/install><strong>单机部署</strong></a> 就是这样的。在多节点部署中，如果有多个 INFRA 节点，管理节点通常是 <code>infra</code> 分组中的第一个，其余作为备用。
不过，也有例外存在。您可能会出于各种原因，将两者分离开来：</p><p>例如在 <a href=/docs/deploy><strong>大规模生产环境部署</strong></a> 中，一种经典模式是使用 1-2 台归属于 DBA 组的专用管理主机（微型虚拟机即可），
作为整个环境的控制中枢，并使用 2-3 台高配置的物理机（或者更多！），作为整个环境的监控基础设施。这时候管理节点就与基础设施节点分离开来了。
这时候，你在配置文件中填入的 <a href=/docs/infra/param/#admin_ip><strong>admin_ip</strong></a> 应该指向某个 INFRA 节点的 IP 地址，而不是当前 ADMIN 节点的 IP 地址。
这是因为历史遗留原因：Pigsty 设计之初，ADMIN 节点 与 INFRA 节点 是强绑定的概念，后来才逐渐演化出分离的能力，因此参数名称未做修改。</p><p>另一种常见的情况是 <a href=/docs/setup><strong>本地管理云节点</strong></a>，例如，您可以在自己的笔记本上安装 Ansible，然后填入你的云节点作为 “被管理对象”。
在这种情况下，您的笔记本充当 ADMIN 节点，而云服务器充当 INFRA 节点。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>   </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq: 1 , ansible_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your_ssh_alias } } } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># &lt;--- 利用 ansible_host 指向云节点（填入 ssh 别名）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># ssh 连接会使用 ssh your_ssh_alias</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role: primary } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.1.0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=多个-infra-节点>多个 INFRA 节点</h2><p>默认情况下，Pigsty 只需要一个 INFRA 节点即可满足大部分需求。INFRA 模块挂了，也不会影响其他节点上的数据库服务。</p><p>但是，在一些对监控与告警要求极高的生产环境中，您可能希望部署多个 INFRA 节点，来提升基础设施的可用性。
一种常见的部署是使用两个 Infra 节点，提供一份冗余副本，并互相监控对方…
或者使用更多，部署分布式的 Victoria 集群实现无限水平扩展。</p><p>每个 Infra 节点都是 <strong>独立</strong> 的，Nginx 指向的都是本机上的服务。
VictoriaMetrics 也是独立抓取环境中所有服务的监控指标，
日志会默认推送到所有 VictoriaLogs 日志采集端点上。
唯一的例外是 Grafana，每一个 Grafana 中都会注册所有的 VictoriaMetrics / Logs / Traces / PostgreSQL 实例作为数据源。
因此每一个 Grafana 实例都能看到完整的监控数据。</p><p>如果您对 Grafana 进行修改，例如添加新的仪表板，或者修改数据源配置，这些变更只会影响当前节点上的 Grafana 实例。
如果您希望所有节点上的 Grafana 保持一致，可以使用一个 PostgreSQL 数据库作为共享存储，详情参考 <a href=/docs/infra/admin/grafana><strong>教程：配置 Grafana 高可用</strong></a>。</p><p><a href=https://demo.pigsty.cc/ui/d/infra-overview><img src=/img/dashboard/infra-overview.webp alt></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c777ff17702df77ebc33dadeb81e4174>3 - PGSQL 架构</h1><div class=lead>PostgreSQL 模块的组件交互与数据流。</div><p>PGSQL 模块在生产环境中以 <strong>集群</strong> 的形式组织，这些 <strong>集群</strong> 是由一组通过 <strong>主-备</strong> 关联的数据库 <strong>实例</strong> 组成的 <strong>逻辑实体</strong>。</p><hr><h2 id=概览>概览</h2><p><a href=/docs/pgsql><strong>PGSQL 模块</strong></a> 包含下列组件，协同提供生产级 PostgreSQL 高可用集群服务：</p><table class=full-width><thead><tr><th style=text-align:left>组件</th><th>简介</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><a href=#postgresql><strong><code>postgres</code></strong></a></td><td>数据库</td><td style=text-align:left>世界上最先进的开源关系型数据库，PGSQL 模块的核心。</td></tr><tr><td style=text-align:left><a href=#patroni><strong><code>patroni</code></strong></a></td><td>高可用</td><td style=text-align:left>托管 PostgreSQL 进程，协调故障转移、选主、配置变更。</td></tr><tr><td style=text-align:left><a href=#pgbouncer><strong><code>pgbouncer</code></strong></a></td><td>连接池</td><td style=text-align:left>轻量级连接池中间件，复用连接、降低开销、提供额外灵活性。</td></tr><tr><td style=text-align:left><a href=#pgbackrest><strong><code>pgbackrest</code></strong></a></td><td>备份恢复</td><td style=text-align:left>全量/增量备份与 WAL 归档，支持本地与对象存储。</td></tr><tr><td style=text-align:left><a href=#pg_exporter><strong><code>pg_exporter</code></strong></a></td><td>指标导出</td><td style=text-align:left>导出 PostgreSQL 监控指标供 Prometheus 抓取。</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter><strong><code>pgbouncer_exporter</code></strong></a></td><td>指标导出</td><td style=text-align:left>导出 <a href=#pgbouncer><strong>Pgbouncer</strong></a> 连接池指标。</td></tr><tr><td style=text-align:left><a href=#pgbackrest_exporter><strong><code>pgbackrest_exporter</code></strong></a></td><td>指标导出</td><td style=text-align:left>导出 <a href=#pgbackrest><strong>pgBackrest</strong></a> 备份状态指标。</td></tr><tr><td style=text-align:left><a href=#vip-manager><strong><code>vip-manager</code></strong></a></td><td>VIP管理</td><td style=text-align:left>将 L2 VIP 绑定到当前主库节点，实现透明漂移。【可选】</td></tr></tbody></table><p>其中 <a href=#vip-manager><strong><code>vip-manager</code></strong></a> 为按需启用的组件。此外，PGSQL 还会使用到其他模块中的组件：</p><table class=full-width><thead><tr><th>组件</th><th style=text-align:left>模块</th><th>简介</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td><a href=#haproxy><strong><code>haproxy</code></strong></a></td><td style=text-align:left><a href=/docs/node><strong>NODE</strong></a></td><td>负载均衡</td><td style=text-align:left>对外暴露服务端口，根据角色分发流量至主库或从库。</td></tr><tr><td><a href=#vector><strong><code>vector</code></strong></a></td><td style=text-align:left><a href=/docs/node><strong>NODE</strong></a></td><td>日志采集</td><td style=text-align:left>收集 PostgreSQL、<a href=#patroni>Patroni</a>、<a href=#pgbouncer>Pgbouncer</a> 等日志推送至中心。</td></tr><tr><td><a href=#etcd><strong><code>etcd</code></strong></a></td><td style=text-align:left><a href=/docs/etcd><strong>ETCD</strong></a></td><td>DCS</td><td style=text-align:left>分布式一致性存储，用于保存集群元数据与领导者信息。</td></tr></tbody></table><p>如果用类比来形容，<a href=#postgresql>PostgreSQL</a> 数据库内核就是 CPU，而整个 PGSQL 模块将其封装为一台完整的计算机。
<a href=#patroni>Patroni</a> 与 <a href=#etcd>Etcd</a> 组成 <a href=#%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%90%E7%B3%BB%E7%BB%9F>高可用子系统</a>，<a href=#pgbackrest>pgBackRest</a> 与 MinIO 组成 <a href=#%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%AD%90%E7%B3%BB%E7%BB%9F>备份恢复子系统</a>。
<a href=#haproxy>HAProxy</a> 与 <a href=#pgbouncer>Pgbouncer</a>、<a href=#vip-manager>vip-manager</a> 组成 <a href=#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%85%A5%E5%AD%90%E7%B3%BB%E7%BB%9F>接入子系统</a>。
各种 Exporter 与 <a href=#vector>Vector</a> 构成 <a href=#%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%AD%90%E7%B3%BB%E7%BB%9F>可观测性子系统</a>；
最后还可以替换不同的 <a href=/docs/pgsql/kernel><strong>内核 CPU</strong></a> 与 <a href=/docs/pgsql/ext><strong>扩展卡</strong></a>。</p><p><img src=/img/pigsty/motherboard.gif alt></p><table class=full-width><thead><tr><th style=text-align:left>子系统</th><th style=text-align:left>组件</th><th style=text-align:left>功能</th></tr></thead><tbody><tr><td style=text-align:left><a href=#%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%90%E7%B3%BB%E7%BB%9F><strong>高可用子系统</strong></a></td><td style=text-align:left><a href=#patroni>Patroni</a> + <a href=#etcd>etcd</a></td><td style=text-align:left>故障检测、自动切换、配置管理</td></tr><tr><td style=text-align:left><a href=#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%85%A5%E5%AD%90%E7%B3%BB%E7%BB%9F><strong>接入子系统</strong></a></td><td style=text-align:left><a href=#haproxy>HAProxy</a> + <a href=#pgbouncer>Pgbouncer</a> + <a href=#vip-manager>vip-manager</a></td><td style=text-align:left>服务暴露、负载均衡、连接池、VIP</td></tr><tr><td style=text-align:left><a href=#%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%AD%90%E7%B3%BB%E7%BB%9F><strong>备份恢复子系统</strong></a></td><td style=text-align:left><a href=#pgbackrest>pgBackRest</a>（+ MinIO）</td><td style=text-align:left>全量/增量备份、WAL归档、PITR</td></tr><tr><td style=text-align:left><a href=#%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%AD%90%E7%B3%BB%E7%BB%9F><strong>可观测性子系统</strong></a></td><td style=text-align:left><a href=#pg_exporter>pg_exporter</a> / <a href=#pgbouncer_exporter>pgbouncer_exporter</a> / <a href=#pgbackrest_exporter>pgbackrest_exporter</a> + <a href=#vector>Vector</a></td><td style=text-align:left>指标采集、日志收集</td></tr></tbody></table><hr><h2 id=组件交互>组件交互</h2><p><a href=/docs/infra/><img src=/img/pigsty/arch.png alt=pigsty-arch></a></p><ul><li>集群 DNS 由 infra 节点上的 <a href=/docs/concept/arch/infra#dnsmasq><strong>DNSMASQ</strong></a> 负责解析</li><li>集群 VIP 由 <a href=#vip-manager><strong>vip-manager</strong></a> 组件管理，它负责将 <a href=/docs/pgsql/param#pg_vip_address><code>pg_vip_address</code></a> 绑定到集群主库节点上。<ul><li><a href=#vip-manager>vip-manager</a> 从 <a href=#etcd>etcd</a> 集群获取由 <a href=#patroni>patroni</a> 写入的集群领导者信息</li></ul></li><li>集群服务由节点上的 <a href=#haproxy><strong>HAProxy</strong></a> 对外暴露，不同服务通过节点的不同端口（543x）区分。<ul><li>HAProxy 端口 9101：监控指标 & 统计 & 管理页面</li><li>HAProxy 端口 5433：默认路由至主 <a href=#pgbouncer>pgbouncer</a>：<a href=/docs/pgsql/service/#primary%E6%9C%8D%E5%8A%A1>读写服务</a></li><li>HAProxy 端口 5434：默认路由至从库 <a href=#pgbouncer>pgbouncer</a>：<a href=/docs/pgsql/service/#replica%E6%9C%8D%E5%8A%A1>只读服务</a></li><li>HAProxy 端口 5436：默认路由至主 <a href=#postgresql>postgres</a>：<a href=/docs/pgsql/service/#default%E6%9C%8D%E5%8A%A1>默认服务</a></li><li>HAProxy 端口 5438：默认路由至离线 <a href=#postgresql>postgres</a>：<a href=/docs/pgsql/service/#offline%E6%9C%8D%E5%8A%A1>离线服务</a></li><li><a href=#haproxy>HAProxy</a> 将根据 <a href=#patroni>patroni</a> 提供的健康检查信息路由流量。</li></ul></li><li><a href=#pgbouncer><strong>Pgbouncer</strong></a> 是连接池中间件，默认监听 6432 端口，可以缓冲连接、暴露额外的指标，并提供额外的灵活性。<ul><li><a href=#pgbouncer>Pgbouncer</a> 是无状态的，并通过本地 Unix 套接字以 1:1 的方式与 <a href=#postgresql>Postgres</a> 服务器部署。</li><li>生产流量（主/从）将默认通过 <a href=#pgbouncer>pgbouncer</a>（可以通过 <a href=/docs/pgsql/param#pg_default_service_dest><code>pg_default_service_dest</code></a> 指定跳过）</li><li>默认/离线服务将始终绕过 <a href=#pgbouncer>pgbouncer</a>，并直接连接到目标 <a href=#postgresql>Postgres</a>。</li></ul></li><li><a href=#postgresql><strong>PostgreSQL</strong></a> 监听 5432 端口，提供关系型数据库服务<ul><li>在多个节点上安装 PGSQL 模块，并使用同一集群名，将自动基于流式复制组成高可用集群</li><li><a href=#postgresql>PostgreSQL</a> 进程默认由 <a href=#patroni>patroni</a> 管理。</li></ul></li><li><a href=#patroni><strong>Patroni</strong></a> 默认监听端口 8008，监管着 <a href=#postgresql>PostgreSQL</a> 服务器进程<ul><li><a href=#patroni>Patroni</a> 将 <a href=#postgresql>Postgres</a> 服务器作为子进程启动</li><li><a href=#patroni>Patroni</a> 使用 <a href=#etcd>etcd</a> 作为 DCS：存储配置、故障检测和领导者选举。</li><li><a href=#patroni>Patroni</a> 通过健康检查提供 Postgres 信息（比如主/从），<a href=#haproxy>HAProxy</a> 通过健康检查使用该信息分发服务流量</li></ul></li><li><a href=#pg_exporter><strong>pg_exporter</strong></a> 在 9630 端口对外暴露 <a href=#postgresql>postgres</a> 监控指标</li><li><a href=#pgbouncer_exporter><strong>pgbouncer_exporter</strong></a> 在端口 9631 暴露 <a href=#pgbouncer>pgbouncer</a> 指标</li><li><a href=#pgbackrest><strong>pgBackRest</strong></a> 默认使用本地备份仓库 （<code>pgbackrest_method</code> = <code>local</code>）<ul><li>如果使用 <code>local</code>（默认）作为备份仓库，<a href=#pgbackrest>pgBackRest</a> 将在主库节点的 <a href=/docs/pgsql/param#pg_fs_backup><code>pg_fs_backup</code></a> 下创建本地仓库</li><li>如果使用 <code>minio</code> 作为备份仓库，<a href=#pgbackrest>pgBackRest</a> 将在专用的 MinIO 集群上创建备份仓库</li></ul></li><li><a href=#vector><strong>Vector</strong></a> 负责收集 Postgres 相关日志（postgres, pgbouncer, patroni, pgbackrest）<ul><li><a href=#vector>vector</a> 监听 9598 端口，也对 infra 节点上的 VictoriaMetrics 暴露自身的监控指标</li><li><a href=#vector>vector</a> 将日志发送至 infra 节点上的 VictoriaLogs</li></ul></li></ul><hr><h2 id=高可用子系统>高可用子系统</h2><p><a href=/docs/concept/ha><strong>高可用</strong></a> 子系统由 <a href=#patroni><strong>Patroni</strong></a> 与 <a href=#etcd><strong>etcd</strong></a> 组成，负责 PostgreSQL 集群的故障检测、自动切换与配置管理。</p><p><strong>工作原理</strong>：<a href=#patroni>Patroni</a> 在每个节点上运行，托管本地 <a href=#postgresql>PostgreSQL</a> 进程，并将集群状态（领导者、成员、配置）写入 <a href=#etcd>etcd</a>。
当主库故障时，<a href=#patroni>Patroni</a> 通过 <a href=#etcd>etcd</a> 协调选举，选出最健康的从库提升为新主库，整个过程自动完成，RTO 通常在 45 秒内。</p><p><strong>关键交互</strong>：</p><ul><li><strong><a href=#postgresql>PostgreSQL</a></strong>：作为父进程启动、停止、重载 PG，控制其生命周期</li><li><strong><a href=#etcd>etcd</a></strong>：外部依赖，写入/监视领导者键，实现分布式共识与故障检测</li><li><strong><a href=#haproxy>HAProxy</a></strong>：通过 REST API（<code>:8008</code>）提供健康检查，告知实例角色</li><li><strong><a href=#vip-manager>vip-manager</a></strong>：监视 <a href=#etcd>etcd</a> 中的领导者键，自动漂移 VIP</li></ul><p>更多信息请参阅：<a href=/docs/concept/ha/><strong>高可用</strong></a> 与 <a href=/docs/pgsql/param/#pg_bootstrap><strong>配置：PGSQL - PG_BOOTSTRAP</strong></a></p><hr><h2 id=服务接入子系统>服务接入子系统</h2><p>接入子系统由 <a href=#haproxy><strong>HAProxy</strong></a>、<a href=#pgbouncer><strong>Pgbouncer</strong></a> 与 <a href=#vip-manager><strong>vip-manager</strong></a> 组成，负责对外暴露服务、路由流量与连接池化。</p><p>有多种不同的接入方法，一种典型的流量路径是：<code>客户端 → DNS/VIP → HAProxy (543x) → Pgbouncer (6432) → PostgreSQL (5432)</code></p><table class=full-width><thead><tr><th style=text-align:left>层级</th><th style=text-align:left>组件</th><th style=text-align:left>端口</th><th style=text-align:left>职责</th></tr></thead><tbody><tr><td style=text-align:left>L2 VIP</td><td style=text-align:left><a href=#vip-manager>vip-manager</a></td><td style=text-align:left>-</td><td style=text-align:left>将 L2 VIP 绑定到主库节点（可选）</td></tr><tr><td style=text-align:left>L4 负载均衡</td><td style=text-align:left><a href=#haproxy>HAProxy</a></td><td style=text-align:left>543x</td><td style=text-align:left>服务暴露、负载均衡、健康检查</td></tr><tr><td style=text-align:left>L7 连接池</td><td style=text-align:left><a href=#pgbouncer>Pgbouncer</a></td><td style=text-align:left>6432</td><td style=text-align:left>连接复用、会话管理、事务池化</td></tr></tbody></table><p><strong>服务端口</strong>：</p><ul><li><code>5433</code> primary：读写服务，路由至主库 <a href=#pgbouncer>Pgbouncer</a></li><li><code>5434</code> replica：只读服务，路由至从库 <a href=#pgbouncer>Pgbouncer</a></li><li><code>5436</code> default：默认服务，直连主库（绕过连接池）</li><li><code>5438</code> offline：离线服务，直连离线从库（ETL/分析）</li></ul><p><strong>关键特性</strong>：</p><ul><li><a href=#haproxy>HAProxy</a> 通过 <a href=#patroni>Patroni</a> REST API 判断实例角色，自动路由流量</li><li><a href=#pgbouncer>Pgbouncer</a> 采用事务级池化，吸收连接峰值，降低 PG 连接开销</li><li><a href=#vip-manager>vip-manager</a> 监视 <a href=#etcd>etcd</a> 领导者键，故障切换时自动漂移 VIP</li></ul><p>更多信息请参阅：<a href=/docs/pgsql/service/><strong>服务接入</strong></a> 与 <a href=/docs/pgsql/param/#pg_access><strong>配置：PGSQL - PG_ACCESS</strong></a></p><hr><h2 id=备份恢复子系统>备份恢复子系统</h2><p>备份恢复子系统由 <a href=#pgbackrest><strong>pgBackRest</strong></a> 组成（可选配 <strong>MinIO</strong> 作为远程仓库），负责数据备份与时间点恢复（<a href=/docs/concept/pitr><strong>PITR</strong></a>）。</p><p><strong>备份类型</strong>：</p><ul><li><strong>全量备份</strong>：完整的数据库副本</li><li><strong>增量/差异备份</strong>：仅备份变更的数据块</li><li><strong>WAL 归档</strong>：持续归档事务日志，支持任意时间点恢复</li></ul><p><strong>存储后端</strong>：</p><ul><li><code>local</code>（默认）：本地磁盘，备份存储在 <a href=/docs/pgsql/param#pg_fs_backup><code>pg_fs_backup</code></a> 挂载点</li><li><code>minio</code>：S3 兼容对象存储，支持集中化备份管理与异地容灾</li></ul><p><strong>关键交互</strong>：</p><ul><li><strong><a href=#pgbackrest>pgBackRest</a> → <a href=#postgresql>PostgreSQL</a></strong>：执行备份命令，管理 WAL 归档</li><li><strong><a href=#pgbackrest>pgBackRest</a> → <a href=#patroni>Patroni</a></strong>：恢复时可将副本引导为新的主库或备库</li><li><strong><a href=#pgbackrest_exporter>pgbackrest_exporter</a> → Prometheus</strong>：导出备份状态指标，监控备份健康</li></ul><p>更多信息请参阅：<a href=/docs/concept/pitr/><strong>PITR</strong></a>、<a href=/docs/pgsql/backup/><strong>备份恢复</strong></a> 与 <a href=/docs/pgsql/param/#pg_backup><strong>配置：PGSQL - PG_BACKUP</strong></a></p><hr><h2 id=可观测性子系统>可观测性子系统</h2><p>可观测性子系统由三个 <strong>Exporter</strong> 与 <a href=#vector><strong>Vector</strong></a> 组成，负责指标采集与日志收集。</p><table><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>端口</th><th style=text-align:left>采集对象</th><th style=text-align:left>关键指标</th></tr></thead><tbody><tr><td style=text-align:left><a href=#pg_exporter>pg_exporter</a></td><td style=text-align:left><code>9630</code></td><td style=text-align:left><a href=#postgresql>PostgreSQL</a></td><td style=text-align:left>会话、事务、复制延迟、缓冲命中</td></tr><tr><td style=text-align:left><a href=#pgbouncer_exporter>pgbouncer_exporter</a></td><td style=text-align:left><code>9631</code></td><td style=text-align:left><a href=#pgbouncer>Pgbouncer</a></td><td style=text-align:left>连接池利用率、等待队列、命中率</td></tr><tr><td style=text-align:left><a href=#pgbackrest_exporter>pgbackrest_exporter</a></td><td style=text-align:left><code>9854</code></td><td style=text-align:left><a href=#pgbackrest>pgBackRest</a></td><td style=text-align:left>最近备份时间、大小、类型</td></tr><tr><td style=text-align:left><a href=#vector>vector</a></td><td style=text-align:left><code>9598</code></td><td style=text-align:left><a href=#postgresql>postgres</a>/<a href=#patroni>patroni</a>/<a href=#pgbouncer>pgbouncer</a> 日志</td><td style=text-align:left>结构化日志流</td></tr></tbody></table><p><strong>数据流向</strong>：</p><ul><li><strong>指标</strong>：Exporter → VictoriaMetrics（INFRA）→ Grafana 仪表盘</li><li><strong>日志</strong>：<a href=#vector>Vector</a> → VictoriaLogs（INFRA）→ Grafana 日志查询</li></ul><p><a href=#pg_exporter>pg_exporter</a> / <a href=#pgbouncer_exporter>pgbouncer_exporter</a> 通过本地 Unix Socket 连接目标服务，与 HA 拓扑解耦。在 <a href=/docs/setup/slim><strong>精简安装</strong></a> 模式下，可禁用这些组件。</p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_monitor><strong>配置：PGSQL - PG_MONITOR</strong></a></p><hr><h2 id=postgresql>PostgreSQL</h2><p><a href=https://www.postgresql.org/><strong>PostgreSQL</strong></a> 是 PGSQL 模块的核心，默认监听 <code>5432</code> 端口提供关系型数据库服务，采用与 <a href=/docs/node><strong>节点</strong></a> 1:1 对应的部署模型。</p><p>Pigsty 目前支持 PostgreSQL 14 - 18（生命周期内的大版本），使用 <a href=/docs/repo/pgdg/><strong>PGDG 官方仓库</strong></a> 提供的二进制包安装。
Pigsty 还允许您使用其他的 <a href=/docs/pgsql/kernel><strong>PG 内核分支</strong></a> 替换默认的 PostgreSQL 内核，
并在 PG 内核上加装多达 <a href=/docs/pgsql/ext><strong>444</strong></a> 个扩展插件。</p><p><strong>PostgreSQL</strong> 进程默认由 <a href=/docs/concept/ha><strong>高可用</strong></a> Agent —— <a href=#patroni><strong>Patroni</strong></a> 托管拉起。
当一个集群中只有一个节点时，该实例即为主库；当集群包含多个节点时，其余实例会自动作为从库加入：
通过物理复制，实时从主库同步数据变更。从库可以承载只读请求，并在主库故障时自动接管。</p><p><a href=/docs/concept/ha><img src=/img/pigsty/ha.png alt=pigsty-ha.png></a></p><p>您可以直接访问 PostgreSQL，或者通过 <a href=#haproxy>HAProxy</a> 与 <a href=#pgbouncer>Pgbouncer</a> 连接池来访问。</p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_bootstrap><strong>配置：PGSQL - PG_BOOTSTRAP</strong></a></p><hr><h2 id=patroni>Patroni</h2><p><a href=https://patroni.readthedocs.io/><strong>Patroni</strong></a> 是 PostgreSQL 高可用控制组件，默认监听 <code>8008</code> 端口。</p><p><strong>Patroni</strong> 接管 <a href=#postgresql><strong>PostgreSQL</strong></a> 的启动、停止、配置与健康状态，将领导者、成员信息写入 <a href=#etcd><strong>etcd</strong></a>。
它负责自动故障转移、保持复制因子、协调参数变更，并提供 REST API 供 <a href=#haproxy><strong>HAProxy</strong></a>、监控与管理员查询。</p><p><a href=#haproxy><strong>HAProxy</strong></a> 通过 <strong>Patroni</strong> 健康检查端点判断实例角色，将流量路由至正确的主库或从库。
<a href=#vip-manager><strong>vip-manager</strong></a> 监视 <a href=#etcd><strong>etcd</strong></a> 中的领导者键，在主库切换时自动漂移 VIP。</p><p><a href=/docs/concept/ha><img src=/img/dashboard/pgsql-patroni.webp alt=patroni></a></p><p>更多信息请参阅：<a href=/docs/pgsql/param/#patroni_mode><strong>配置：PGSQL - PG_BOOTSTRAP</strong></a></p><hr><h2 id=pgbouncer>Pgbouncer</h2><p><a href=https://www.pgbouncer.org/><strong>Pgbouncer</strong></a> 是轻量级连接池中间件，默认监听 <code>6432</code> 端口，与 <a href=#postgresql>PostgreSQL</a> 数据库与节点保持 1:1 部署。</p><p><strong>Pgbouncer</strong> 以无状态方式运行在每个实例上，通过本地 Unix Socket 连接 <a href=#postgresql><strong>PostgreSQL</strong></a>，默认通过 Transaction Pooling 的方式
对 PG 连接进行池化管理，能够吸收大量客户端的瞬时连接请求，稳定数据库会话，降低锁征用，显著提升高并发状态下的性能表现。</p><p>Pigsty 默认让生产流量（读写服务 <code>5433</code> / 只读服务 <code>5434</code>）经由 <strong>Pgbouncer</strong>，
仅默认服务（<code>5436</code>）与离线服务（<code>5438</code>）绕过连接池直连 <a href=#postgresql><strong>PostgreSQL</strong></a>。</p><p>连接池模式由 <a href=/docs/pgsql/param#pgbouncer_poolmode><code>pgbouncer_poolmode</code></a> 控制，默认为 <code>transaction</code>（事务级复用），可通过 <a href=/docs/pgsql/param#pgbouncer_enabled><code>pgbouncer_enabled</code></a> 关闭连接池。</p><p><a href=https://demo.pigsty.cc/ui/d/pgsql-pgbouncer><img src=/img/dashboard/pgsql-pgbouncer.webp alt=pgbouncer.png></a></p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_access><strong>配置：PGSQL - PG_ACCESS</strong></a></p><hr><h2 id=pgbackrest>pgBackRest</h2><p><a href=https://pgbackrest.org/><strong>pgBackRest</strong></a> 是专业的 PostgreSQL 备份恢复工具，也是 PG 生态的最强备份工具之一，支持全量/增量/差异备份与 WAL 归档。</p><p>Pigsty 使用 pgBackRest 实现 PostgreSQL 的 <a href=/docs/concept/pitr><strong>PITR</strong></a> 能力，
您可以在备份保留的时间窗口内，将集群回滚到任意时间点。</p><p><strong>pgBackRest</strong> 与 <a href=#postgresql><strong>PostgreSQL</strong></a> 配合，在主库上创建备份仓库，执行备份与归档任务。
默认使用本地备份仓库（<a href=/docs/pgsql/param#pgbackrest_method><strong><code>pgbackrest_method</code></strong></a> = <code>local</code>），也可配置为 MinIO 等对象存储，实现集中化备份管理。</p><p>初始化完成后可通过 <a href=/docs/pgsql/param#pgbackrest_init_backup><strong><code>pgbackrest_init_backup</code></strong></a> 自动发起首次全量备份。
恢复过程与 <a href=#patroni><strong>Patroni</strong></a> 集成，支持将副本引导为新的主库或备库。</p><p><a href=/docs/concept/pitr><img src=/img/dashboard/pgsql-pitr.webp alt=pgbackrest></a></p><p>更多信息请参阅：<a href=/docs/pgsql/backup/><strong>备份恢复</strong></a> 与 <a href=/docs/pgsql/param/#pg_backup><strong>配置：PGSQL - PG_BACKUP</strong></a></p><hr><h2 id=haproxy>HAProxy</h2><p><a href=http://www.haproxy.org/><strong>HAProxy</strong></a> 是服务入口与负载均衡器，对外暴露多个数据库服务端口。</p><table><thead><tr><th style=text-align:left>端口</th><th style=text-align:left>服务名</th><th style=text-align:left>目标</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>9101</code></td><td style=text-align:left>管理接口</td><td style=text-align:left>-</td><td style=text-align:left>HAProxy 统计与管理页面</td></tr><tr><td style=text-align:left><code>5433</code></td><td style=text-align:left>primary</td><td style=text-align:left>主库 <a href=#pgbouncer>Pgbouncer</a></td><td style=text-align:left>读写服务，路由至主库连接池</td></tr><tr><td style=text-align:left><code>5434</code></td><td style=text-align:left>replica</td><td style=text-align:left>从库 <a href=#pgbouncer>Pgbouncer</a></td><td style=text-align:left>只读服务，路由至从库连接池</td></tr><tr><td style=text-align:left><code>5436</code></td><td style=text-align:left>default</td><td style=text-align:left>主库 <a href=#postgresql>Postgres</a></td><td style=text-align:left>默认服务，直连主库（绕过连接池）</td></tr><tr><td style=text-align:left><code>5438</code></td><td style=text-align:left>offline</td><td style=text-align:left>离线库 <a href=#postgresql>Postgres</a></td><td style=text-align:left>离线服务，直连离线从库（ETL/分析）</td></tr></tbody></table><p><strong>HAProxy</strong> 通过 <a href=#patroni><strong>Patroni</strong></a> REST API 提供的健康检查信息判断实例角色，将流量路由至对应的主库或从库。
服务定义由 <a href=/docs/pgsql/param#pg_default_services><strong><code>pg_default_services</code></strong></a> 与 <a href=/docs/pgsql/param#pg_services><strong><code>pg_services</code></strong></a> 组合而成。</p><p>可通过 <a href=/docs/pgsql/param#pg_service_provider><strong><code>pg_service_provider</code></strong></a> 指定专用的 HAProxy 节点组承载更高流量，
默认使用本地节点上的 <strong>HAProxy</strong> 对外发布服务。</p><p><a href=/docs/concept/ha/svc><img src=/img/dashboard/node-haproxy.webp alt=haproxy></a></p><p>更多信息请参阅：<a href=/docs/pgsql/service/><strong>服务接入</strong></a> 与 <a href=/docs/pgsql/param/#pg_access><strong>配置：PGSQL - PG_ACCESS</strong></a></p><hr><h2 id=vip-manager>vip-manager</h2><p><a href=https://github.com/cybertec-postgresql/vip-manager><strong>vip-manager</strong></a> 负责将 L2 VIP 绑定到当前主库节点，这是一个可选的组件，如果您的网络支持 L2 VIP，可以考虑启用。</p><p><strong>vip-manager</strong> 在每个 PG 节点上运行，监视 <a href=#etcd><strong>etcd</strong></a> 中由 <a href=#patroni><strong>Patroni</strong></a> 写入的领导者键，
将 <a href=/docs/pgsql/param#pg_vip_address><strong><code>pg_vip_address</code></strong></a> 绑定到当前主库节点的网卡上。
当集群发生故障转移时，<strong>vip-manager</strong> 会立即释放旧主机上的 VIP，并在新主机上重新绑定，从而将流量切换到新的主库。</p><p>该组件可选，通过 <a href=/docs/pgsql/param#pg_vip_enabled><strong><code>pg_vip_enabled</code></strong></a> 启用。
启用后需确保所有节点处于同一 VLAN，否则 VIP 无法正确漂移。
通常公有云网络环境不支持 L2 VIP，建议仅在本地自建环境与私有云环境中启用。</p><p><a href=/docs/concept/ha/svc><img src=/img/dashboard/node-vip.webp alt=node-vip></a></p><p>更多信息请参阅：<a href=/docs/pgsql/tutorial/pg-vip/><strong>教程：VIP 配置</strong></a> 与 <a href=/docs/pgsql/param/#pg_access><strong>配置：PGSQL - PG_ACCESS</strong></a></p><hr><h2 id=pg_exporter>pg_exporter</h2><p><a href=https://github.com/Vonng/pg_exporter><strong>pg_exporter</strong></a> 导出 <a href=#postgresql>PostgreSQL</a> 监控指标，默认监听 <code>9630</code> 端口。</p><p><strong>pg_exporter</strong> 运行在每个 PG 节点上，通过本地 Unix Socket 连接 <a href=#postgresql><strong>PostgreSQL</strong></a>，
导出覆盖会话、缓冲命中、复制延迟、事务率等丰富指标，供 INFRA 节点上的 <strong>VictoriaMetrics</strong> 抓取。</p><p>采集配置由 <a href=/docs/pgsql/param#pg_exporter_config><strong><code>pg_exporter_config</code></strong></a> 指定，
支持自动数据库发现（<a href=/docs/pgsql/param#pg_exporter_auto_discovery><strong><code>pg_exporter_auto_discovery</code></strong></a>），
并可通过 <a href=/docs/pgsql/param#pg_exporter_cache_ttls><strong><code>pg_exporter_cache_ttls</code></strong></a> 配置阶梯式缓存策略。</p><p>您可以通过参数禁用这个组件，在 <a href=/docs/setup/slim><strong>精简安装</strong></a> 中，这个组件不会被启用。</p><p><a href=https://demo.pigsty.cc/ui/d/pgsql-exporter><img src=/img/dashboard/pgsql-exporter.webp alt=pg-exporter></a></p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_monitor><strong>配置：PGSQL - PG_MONITOR</strong></a></p><hr><h2 id=pgbouncer_exporter>pgbouncer_exporter</h2><p><strong>pgbouncer_exporter</strong> 导出 <a href=#pgbouncer>Pgbouncer</a> 连接池指标，默认监听 <code>9631</code> 端口。</p><p><code>pgbouncer_exporter</code> 使用的同样是 <a href=#pg_exporter><strong>pg_exporter</strong></a> 的二进制程序，但是使用专用的指标配置文件，支持 pgbouncer 1.8 - 1.25+ 。
<strong>pgbouncer_exporter</strong> 读取 <a href=#pgbouncer><strong>Pgbouncer</strong></a> 的统计视图，提供连接池利用率、等待队列与命中率指标。</p><p>若禁用 <a href=#pgbouncer><strong>Pgbouncer</strong></a>，本组件也同时关闭。在 <a href=/docs/setup/slim><strong>精简安装</strong></a> 中，这个组件也不会被启用。</p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_monitor><strong>配置：PGSQL - PG_MONITOR</strong></a></p><hr><h2 id=pgbackrest_exporter>pgbackrest_exporter</h2><p><strong>pgbackrest_exporter</strong> 导出备份状态指标，默认监听 <code>9854</code> 端口。</p><p><strong>pgbackrest_exporter</strong> 解析 <a href=#pgbackrest><strong>pgBackRest</strong></a> 状态，生成最近备份时间、大小、类型等指标。结合告警策略可快速发现备份过期或失败，保障数据安全。
请注意，当备份很多，或者使用大型网络存储库时，采集过程开销较大，因此 <strong>pgbackrest_exporter</strong> 默认设置了 2分钟的采集间隔。
最慢情况下，您可能要在一个备份完成后的 2 分钟后，才能在监控系统中看到最新的备份状态。</p><p>更多信息请参阅：<a href=/docs/pgsql/param/#pg_monitor><strong>配置：PGSQL - PG_MONITOR</strong></a></p><hr><h2 id=etcd>etcd</h2><p><a href=/docs/etcd><strong>etcd</strong></a> 是分布式一致性存储（DCS），为 <a href=#patroni><strong>Patroni</strong></a> 提供集群元数据存储与领导者选举能力。</p><p>etcd 由独立的 <a href=/docs/etcd><strong>ETCD 模块</strong></a> 部署管理，不属于 PGSQL 模块本身，但对 PostgreSQL 高可用至关重要。
<a href=#patroni>Patroni</a> 将集群状态、领导者信息、配置参数写入 etcd，所有节点通过 etcd 达成共识。
<a href=#vip-manager>vip-manager</a> 也从 etcd 读取领导者键，实现 VIP 的自动漂移。</p><p>更多信息请参阅：<a href=/docs/etcd/><strong>ETCD 模块</strong></a></p><hr><h2 id=vector>vector</h2><p><a href=https://vector.dev/><strong>Vector</strong></a> 是高性能日志采集组件，由 <a href=/docs/node><strong>NODE 模块</strong></a> 部署，负责收集 PostgreSQL 相关日志。</p><p>Vector 常驻在节点上，跟踪 <a href=#postgresql>PostgreSQL</a>、<a href=#pgbouncer>Pgbouncer</a>、<a href=#patroni>Patroni</a> 与 <a href=#pgbackrest>pgBackRest</a> 的日志目录，
将结构化日志发送至 INFRA 节点上的 VictoriaLogs 进行集中存储与查询。</p><p>更多信息请参阅：<a href=/docs/node/><strong>NODE 模块</strong></a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>