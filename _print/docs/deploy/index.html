<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/deploy/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/deploy/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>部署 | PIGSTY</title><meta name=description content="在严肃生产环境中进行多节点、高可用的 Pigsty 规划、准备与部署工作。"><meta property="og:url" content="https://pigsty.cc/docs/deploy/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="部署"><meta property="og:description" content="在严肃生产环境中进行多节点、高可用的 Pigsty 规划、准备与部署工作。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="部署"><meta itemprop=description content="在严肃生产环境中进行多节点、高可用的 Pigsty 规划、准备与部署工作。"><meta itemprop=dateModified content="2026-01-08T18:37:06+08:00"><meta itemprop=wordCount content="39"><meta itemprop=keywords content="教程,PIGSTY"><meta name=twitter:card content="summary"><meta name=twitter:title content="部署"><meta name=twitter:description content="在严肃生产环境中进行多节点、高可用的 Pigsty 规划、准备与部署工作。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/deploy/>返回本页常规视图</a>.</p></div><h1 class=title>部署</h1><div class=lead>在严肃生产环境中进行多节点、高可用的 Pigsty 规划、准备与部署工作。</div><ul><li>1: <a href=#pg-26f5f78dacbf3daf14a3ddd2c1d928dd>生产部署</a></li><li>2: <a href=#pg-374829cbbe6f2f715a9e6d868d9f9693>资源准备</a></li><li>3: <a href=#pg-9acb71881039d3570f14c9a9caf9563c>架构规划</a></li><li>4: <a href=#pg-7679452458507892fa3756a891f5287a>管理机制</a></li><li>5: <a href=#pg-aa44e6b5b4b5d27a4235af210a56fc6e>沙箱环境</a></li><li>6: <a href=#pg-6c08c58dc7691eda288baa9ba0766305>Vagrant</a></li><li>7: <a href=#pg-87e7f74da392ae65771e6fb357b13c6f>Terraform</a></li><li>8: <a href=#pg-8783a52d352cd41160ffaa5b596ca07f>安全考量</a></li></ul><div class=content><p>与 <a href=/docs/setup/><strong>快速上手</strong></a> 不同，严肃企业生产环境 Pigsty 部署需要更多 <a href=/docs/deploy/planning><strong>架构规划</strong></a> 与 <a href=/docs/deploy/prepare><strong>准备工作</strong></a>。</p><p>本章将帮助您理解 Pigsty 的完整部署流程，并提供生产环境部署的最佳实践建议。</p><hr><p>我们建议您在真实的生产环境部署之前，使用 Pigsty 提供的 <a href=/docs/deploy/sandbox><strong>沙箱环境</strong></a> 进行测试与演练，确保对部署流程有充分的了解。
您可以使用 <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> 在本地快速创建一个四节点的 Pigsty 沙箱环境用于测试，或者利用 <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> 在云端置备一个更大规模的仿真环境。</p><p><a href=/docs/concept/arch><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></a></p><p>对于生产环境部署，您通常需要准备至少三个 <a href=/docs/deploy/prepare><strong>节点</strong></a> 以实现高可用。您需要进一步了解 Pigsty 的 <a href=/docs/concept><strong>相关概念</strong></a> 以及常见操作的管理 SOP。
包括如何通过 <a href=/docs/setup/config><strong>参数配置</strong></a> 进行定制，如何执行 <a href=/docs/setup/playbook><strong>Ansible 剧本</strong></a> 进行部署。以及如何加固部署的 <a href=/docs/deploy/security><strong>安全性</strong></a> 以满足企业合规要求。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-26f5f78dacbf3daf14a3ddd2c1d928dd>1 - 生产部署</h1><div class=lead>如何在 Linux 主机上安装 Pigsty？</div><p>本文是 Pigsty 生产环境多节点部署指南，部署单机版本 Demo/Dev 环境可以参考 <a href=/docs/setup/><strong>快速上手</strong></a> 文档。</p><hr><h2 id=摘要>摘要</h2><p><a href=/docs/deploy/prepare><strong>准备</strong></a> <a href=/docs/deploy/planning><strong>几台</strong></a> 具有 <a href=/docs/deploy/admin#ssh><strong>SSH 权限</strong></a> 的 <a href=/docs/deploy/prepare#%E8%8A%82%E7%82%B9><strong>节点</strong></a>，
安装 <a href=/docs/ref/linux/><strong>兼容的 Linux 系统</strong></a>，使用具有免密 <a href=/docs/deploy/admin#ssh><strong><code>ssh</code></strong></a> 和 <a href=/docs/deploy/admin#sudo><strong><code>sudo</code></strong></a> 权限的 <a href=/docs/deploy/admin><strong>管理用户</strong></a> 执行：</p><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab data-td-tp-persist=pigsty.cc（中国） aria-controls=tabs-00-00 aria-selected=true>
pigsty.cc（中国）</button></li><li class=nav-item><button class=nav-link id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab data-td-tp-persist=pigsty.io（全球） aria-controls=tabs-00-01 aria-selected=false>
pigsty.io（全球）</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-body tab-pane fade show active" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div></div><p>该命令会执行 <a href=#%E5%AE%89%E8%A3%85><strong>安装</strong></a> 脚本，下载并提取 Pigsty 源码至家目录并安装依赖，接下来依次完成 <a href=#%E9%85%8D%E7%BD%AE><strong>配置</strong></a> 与 <a href=#%E9%83%A8%E7%BD%B2><strong>部署</strong></a> 即可完成交付。</p><p>在执行 <a href=/docs/setup/playbook><strong><code>deploy.yml</code></strong></a> 进行部署前，您可能需要进一步审视与编辑 <a href=/docs/concept/iac/inventory><strong>配置清单</strong></a>：<strong><code>pigsty.yml</code></strong> 文件，确认部署细节。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty      <span style=color:#8f5902;font-style:italic># 进入 Pigsty 目录</span>
</span></span><span style=display:flex><span>./configure -g   <span style=color:#8f5902;font-style:italic># 生成配置文件（可选，如果知道如何配置可以跳过）</span>
</span></span><span style=display:flex><span>./deploy.yml     <span style=color:#8f5902;font-style:italic># 执行部署剧本，根据生成的配置文件开始安装</span>
</span></span></code></pre></div><p>安装完成后，您可以通过 IP / 域名 + <code>80/443</code> 端口访问 <a href=/docs/setup/webui/><strong>Web 用户界面</strong></a>，
并通过 <code>5432</code> 端口访问 <a href=/docs/setup/pgsql/><strong>PostgreSQL 服务</strong></a>。</p><p>完整流程根据服务器规格/网络条件需 3~10 分钟，<a href=/docs/setup/offline/><strong>离线安装</strong></a> 时能够显著加速；无需监控时可使用 <a href=/docs/setup/slim/><strong>精简安装</strong></a> 进一步加速。</p><p><strong>视频样例：20 节点生产仿真环境（Ubuntu 24.04 x86_64）</strong></p><div id=asciinema-2d8762e5e8d05b72e98e654cb5544ae2 class="asciinema-container td-max-width-on-larger-screens" style="margin:1em 0"></div><script>(function(){var n,s="asciinema-2d8762e5e8d05b72e98e654cb5544ae2",o="/demo/install-simu.cast",e="auto",i=null;function a(){var e=document.documentElement.getAttribute("data-bs-theme");return e==="dark"?"solarized-dark":e==="light"?"solarized-light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"solarized-dark":"solarized-light"}function r(){return e==="auto"?a():e}function t(){var e,t=document.getElementById(s);t.innerHTML="",e={theme:r(),speed:"1.3",startAt:0,fit:"width"},e.autoPlay=!0,e.loop=!0,e.markers=[[0,"置备服务器"],[36,"部署"],[360,"完成"]],i=AsciinemaPlayer.create(o,t,e)}t(),e==="auto"&&(n=new MutationObserver(function(e){e.forEach(function(e){e.attributeName==="data-bs-theme"&&t()})}),n.observe(document.documentElement,{attributes:!0}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){var e=document.documentElement.getAttribute("data-bs-theme");(!e||e==="auto")&&t()}))})()</script><hr><h2 id=准备>准备</h2><p>在生产环境中部署安装 Pigsty 涉及一些 <a href=/docs/deploy/prepare><strong>准备工作</strong></a> ，以下为完整检查清单，供您参考。</p><table class=full-width><thead><tr><th style=text-align:center>项目</th><th style=text-align:left>要求</th><th style=text-align:center>项目</th><th style=text-align:left>要求</th></tr></thead><tbody><tr><td style=text-align:center><a href=/docs/deploy/prepare#%E8%8A%82%E7%82%B9><strong>节点</strong></a></td><td style=text-align:left>至少 <code>1C2G</code>，上不封顶</td><td style=text-align:center><a href=/docs/deploy/planning#%E5%B8%B8%E8%A7%81%E6%96%B9%E6%A1%88><strong>规格</strong></a></td><td style=text-align:left>多个同质节点，2 / 3 / 4 / 或更多</td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#%E7%A3%81%E7%9B%98><strong>磁盘</strong></a></td><td style=text-align:left><code>/data</code> 作为默认主挂载点</td><td style=text-align:center><a href=/docs/deploy/prepare#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F><strong>FS</strong></a></td><td style=text-align:left>推荐使用 <code>xfs</code>，按需使用 <code>ext4</code> / <code>zfs</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#vip><strong>VIP</strong></a></td><td style=text-align:left>L2 VIP，可选 （云环境不可用）</td><td style=text-align:center><a href=/docs/deploy/prepare#%E7%BD%91%E7%BB%9C><strong>网络</strong></a></td><td style=text-align:left>静态 IPv4 地址，单节点无固定 IP 可使用 <code>127.0.0.1</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#ca><strong>CA</strong></a></td><td style=text-align:left>可以使用自签名 CA 或指定已有证书</td><td style=text-align:center><a href=/docs/deploy/prepare#%E5%9F%9F%E5%90%8D><strong>域名</strong></a></td><td style=text-align:left>本地 / 公网域名，可选，默认 <code>i.pigsty</code> 自签名域名</td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#linux><strong>内核</strong></a></td><td style=text-align:left><code>Linux</code> <code>x86_64</code> / <code>aarch64</code></td><td style=text-align:center><a href=/docs/deploy/prepare#linux><strong>Linux</strong></a></td><td style=text-align:left><code>el8</code>, <code>el9</code>, <code>el10</code>, <code>d12</code>, <code>d13</code>, <code>u22</code>, <code>u24</code></td></tr><tr><td style=text-align:center><a href=/docs/deploy/prepare#locale><strong>Locale</strong></a></td><td style=text-align:left><code>C.UTF-8</code> 或 <code>C</code></td><td style=text-align:center><a href=/docs/deploy/admin#%E9%98%B2%E7%81%AB%E5%A2%99><strong>防火墙</strong></a></td><td style=text-align:left>端口：<code>80</code> / <code>443</code> / <code>22</code> / <code>5432</code> （可选）</td></tr><tr><td style=text-align:center><a href=/docs/deploy/admin#%E7%94%A8%E6%88%B7><strong>用户</strong></a></td><td style=text-align:left>避免使用 <code>root</code> 和 <code>postgres</code></td><td style=text-align:center><a href=/docs/deploy/admin#sudo><strong>Sudo</strong></a></td><td style=text-align:left>sudo 权限，最好带有 <code>nopass</code> 免密选项</td></tr><tr><td style=text-align:center><a href=/docs/deploy/admin#ssh><strong>SSH</strong></a></td><td style=text-align:left>通过公钥 <code>nopass</code> SSH 登陆纳管节点</td><td style=text-align:center><a href=/docs/deploy/admin#%E9%AA%8C%E8%AF%81%E5%8F%AF%E8%BE%BE%E6%80%A7><strong>可达性</strong></a></td><td style=text-align:left><code>ssh &lt;ip|alias> sudo ls</code> 无错误</td></tr></tbody></table><hr><h2 id=安装>安装</h2><p>您可以使用以下命令自动安装 <a href=/docs/deploy/prepare#pigsty><strong>Pigsty 源码包</strong></a> 至 <code>~/pigsty</code> 目录（推荐），部署所需依赖（Ansible）会自动安装。</p><ul class="nav nav-tabs" id=tabs-2 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-02-00-tab data-bs-toggle=tab data-bs-target=#tabs-02-00 role=tab data-td-tp-persist=pigsty.cc（中国） aria-controls=tabs-02-00 aria-selected=true>
pigsty.cc（中国）</button></li><li class=nav-item><button class=nav-link id=tabs-02-01-tab data-bs-toggle=tab data-bs-target=#tabs-02-01 role=tab data-td-tp-persist=pigsty.io（全球） aria-controls=tabs-02-01 aria-selected=false>
pigsty.io（全球）</button></li></ul><div class=tab-content id=tabs-2-content><div class="tab-body tab-pane fade show active" id=tabs-02-00 role=tabpanel aria-labelled-by=tabs-02-00-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash            <span style=color:#8f5902;font-style:italic># 安装最新稳定版本</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v4.1.0  <span style=color:#8f5902;font-style:italic># 安装特定版本</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-02-01 role=tabpanel aria-labelled-by=tabs-02-01-tab tabindex=2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash            <span style=color:#8f5902;font-style:italic># 安装最新稳定版本</span>
</span></span><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash -s v4.1.0  <span style=color:#8f5902;font-style:italic># 安装特定版本</span>
</span></span></code></pre></div></div></div><p>如果您不希望执行远程脚本，可以手动 <a href=https://github.com/pgsty/pigsty/releases><strong>下载</strong></a> 或克隆源码。使用 <code>git</code> 克隆安装时，请务必检出特定版本后再使用。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/pgsty/pigsty<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>cd</span> pigsty<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>git checkout v4.1.0<span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic># 使用 git 安装时，请务必检出特定版本</span>
</span></span></code></pre></div><p>手工下载克隆安装时，请额外执行 <a href=/docs/setup/offline#bootstrap><strong><code>bootstrap</code></strong></a> 脚本以手动安装 Ansible 等部署依赖，您也可以 <a href=/docs/setup/playbook#%E5%AE%89%E8%A3%85-ansible><strong>自行安装</strong></a>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./bootstrap           <span style=color:#8f5902;font-style:italic># 安装 ansible，用于执行后续部署</span>
</span></span></code></pre></div><hr><h2 id=配置>配置</h2><p>在 Pigsty 中，部署的蓝图细节由 <a href=/docs/setup/config/><strong>配置清单</strong></a> 所定义，也就是 <a href=https://github.com/pgsty/pigsty/blob/main/pigsty.yml><strong><code>pigsty.yml</code></strong></a> 配置文件，您可以通过声明式配置进行定制。</p><p>Pigsty 提供了 <a href=https://github.com/pgsty/pigsty/blob/main/configure><strong><code>configure</code></strong></a> 脚本作为可选的 <a href=/docs/concept/iac/configure><strong>配置向导</strong></a>，
它将根据您的环境和输入，生成具有良好默认值的 <a href=/docs/concept/iac/inventory/><strong>配置清单</strong></a>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -g                <span style=color:#8f5902;font-style:italic># 使用配置向导生成配置文件，并且生成随机密码</span>
</span></span></code></pre></div><p>配置过程生成的配置文件默认位于：<code>~/pigsty/pigsty.yml</code>，您可以在安装前进行检查，按需修改与定制。</p><p>有许多 <a href=/docs/concept/iac/template/><strong>配置模板</strong></a> 供您参考与使用，但您也完全可以跳过配置向导，直接编辑 <code>pigsty.yml</code> 配置文件进行定制。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -c ha/full -g       <span style=color:#8f5902;font-style:italic># 使用四节点沙箱环境模板</span>
</span></span><span style=display:flex><span>./configure -c ha/trio -g       <span style=color:#8f5902;font-style:italic># 使用三节点最小 HA 模板</span>
</span></span><span style=display:flex><span>./configure -c ha/dual -g -v <span style=color:#0000cf;font-weight:700>17</span> <span style=color:#8f5902;font-style:italic># 使用两节点半高可用模板，使用 PG 17</span>
</span></span><span style=display:flex><span>./configure -c ha/simu -s       <span style=color:#8f5902;font-style:italic># 使用二十节点生产仿真模板，不检查 IP，不生成随机强密码</span>
</span></span></code></pre></div><details><summary>配置 / configure 过程的样例输出</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vagrant@meta:~/pigsty$ ./configure
</span></span><span style=display:flex><span>configure pigsty v4.1.0 begin
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>region</span> <span style=color:#ce5c00;font-weight:700>=</span> china
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>kernel</span>  <span style=color:#ce5c00;font-weight:700>=</span> Linux
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>=</span> x86_64
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>package</span> <span style=color:#ce5c00;font-weight:700>=</span> deb,apt
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>vendor</span>  <span style=color:#ce5c00;font-weight:700>=</span> ubuntu <span style=color:#ce5c00;font-weight:700>(</span>Ubuntu<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>version</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>22</span> <span style=color:#ce5c00;font-weight:700>(</span>22.04<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>sudo</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>ssh</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant@127.0.0.1 ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>WARN<span style=color:#ce5c00;font-weight:700>]</span> Multiple IP address candidates found:
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>(</span>1<span style=color:#ce5c00;font-weight:700>)</span> 192.168.121.38	    inet 192.168.121.38/24 metric <span style=color:#0000cf;font-weight:700>100</span> brd 192.168.121.255 scope global dynamic eth0
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>(</span>2<span style=color:#ce5c00;font-weight:700>)</span> 10.10.10.10	    inet 10.10.10.10/24 brd 10.10.10.255 scope global eth1
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>primary_ip</span> <span style=color:#ce5c00;font-weight:700>=</span> 10.10.10.10 <span style=color:#ce5c00;font-weight:700>(</span>from demo<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>admin</span> <span style=color:#ce5c00;font-weight:700>=</span> vagrant@10.10.10.10 ok
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>mode</span> <span style=color:#ce5c00;font-weight:700>=</span> meta <span style=color:#ce5c00;font-weight:700>(</span>ubuntu22.04<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>locale</span>  <span style=color:#ce5c00;font-weight:700>=</span> C.UTF-8
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>ansible</span> <span style=color:#ce5c00;font-weight:700>=</span> ready
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span> OK <span style=color:#ce5c00;font-weight:700>]</span> pigsty configured
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>WARN<span style=color:#ce5c00;font-weight:700>]</span> don<span style=color:#a40000>&#39;</span>t forget to check it and change passwords!
</span></span><span style=display:flex><span>proceed with ./deploy.yml
</span></span></code></pre></div></details><br><p>配置向导只会为您替换 <strong>当前节点</strong> 的 IP（如果您不想要替换，使用 <code>-s</code> 参数），所以对于一个多节点的部署，您需要自己替换其他节点的 IP 地址。
同时，你还需要按需对配置文件进行进一步的定制，例如修改默认密码、添加更多节点等。</p><p><strong>配置脚本常用参数</strong>：</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><code>-c|--conf</code></td><td style=text-align:left>用于指定使用的 <a href=/docs/conf/><strong>配置模板</strong></a>，相对于 <code>conf/</code> 目录，不带 <code>.yml</code> 后缀的配置名称</td></tr><tr><td style=text-align:left><code>-v|--version</code></td><td style=text-align:left>用于指定要安装的 PostgreSQL 大版本，如 <code>13</code>、<code>14</code>、<code>15</code>、<code>16</code>、<code>17</code>、<code>18</code></td></tr><tr><td style=text-align:left><code>-r|--region</code></td><td style=text-align:left>用于指定上游软件源的区域，加速下载： (<code>default|china|europe</code>)</td></tr><tr><td style=text-align:left><code>-n|--non-interactive</code></td><td style=text-align:left>直接使用命令行参数提供首要 IP 地址，跳过交互式向导</td></tr><tr><td style=text-align:left><code>-x|--proxy</code></td><td style=text-align:left>使用当前环境变量配置 <a href=/docs/infra/param#proxy_env><code>proxy_env</code></a> 变量</td></tr></tbody></table><p>如果您的机器网卡绑定了多个 IP 地址，那么需要使用 <code>-i|--ip &lt;ipaddr></code> 显式指定一个当前节点的首要 IP 地址，或在交互式问询中提供。
该脚本将把 IP 占位符 <code>10.10.10.10</code> 替换为当前节点的主 IPv4 地址。选用的地址应为静态 IP 地址，请勿使用公网 IP 地址。</p><p>配置过程生成的配置文件默认位于：<code>~/pigsty/pigsty.yml</code>，您可以在安装前进行检查与修改定制。</p><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>修改默认密码！</div><p>我们强烈建议您在安装前，事先修改配置文件中使用的默认密码与凭据，详情参考 <a href=/docs/setup/security/#%E5%AF%86%E7%A0%81><strong>安全加固</strong></a>。</p></div><hr><h2 id=部署>部署</h2><p>Pigsty 的 <a href=/docs/setup/playbook/><strong><code>deploy.yml</code></strong></a> <a href=/docs/setup/playbook/><strong>剧本</strong></a> 会将 <a href=#%E9%85%8D%E7%BD%AE><strong>配置</strong></a> 中生成的蓝图应用至 <strong>所有的目标节点</strong>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./deploy.yml     <span style=color:#8f5902;font-style:italic># 一次性在所有节点上完成部署</span>
</span></span></code></pre></div><details><summary>部署过程的样例输出</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#ce5c00;font-weight:700>[</span>pgsql : pgsql init <span style=color:#204a87;font-weight:700>done</span><span style=color:#ce5c00;font-weight:700>]</span> *************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#ce5c00;font-weight:700>[</span>10.10.10.11<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;msg&#34;</span>: <span style=color:#4e9a06>&#34;postgres://10.10.10.11/postgres | meta  | dbuser_meta dbuser_view &#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#ce5c00;font-weight:700>[</span>pg_monitor : load grafana datasource meta<span style=color:#ce5c00;font-weight:700>]</span> *******************************
</span></span><span style=display:flex><span>changed: <span style=color:#ce5c00;font-weight:700>[</span>10.10.10.11<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY RECAP *********************************************************************
</span></span><span style=display:flex><span>10.10.10.11                : <span style=color:#000>ok</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>302</span>  <span style=color:#000>changed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>232</span>  <span style=color:#000>unreachable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>failed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>skipped</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>65</span>   <span style=color:#000>rescued</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>ignored</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>localhost                  : <span style=color:#000>ok</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>6</span>    <span style=color:#000>changed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span>    <span style=color:#000>unreachable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>failed</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>skipped</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>    <span style=color:#000>rescued</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>    <span style=color:#000>ignored</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>当您看到输出尾部如果带有 <code>pgsql init done</code>，<code>PLAY RECAP</code> 等字样，说明安装已经完成！</p></details><br><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>上游软件仓库变更可能导致在线安装失败！</div><p>Pigsty 使用的上游软件仓库（如 Linux / PGDG 仓库）可能会因为不恰当的更新，进入崩溃状态并导致部署失败（相当常见）！
对于严肃的生产环境部署，我们强烈建议使用经过验证的 <a href=/docs/setup/offline#%E7%A6%BB%E7%BA%BF%E8%BD%AF%E4%BB%B6%E5%8C%85><strong>离线软件包</strong></a> 进行 <a href=/docs/setup/offline><strong>离线安装</strong></a></p></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>避免重复执行部署剧本！</div><p>警告： 在已经完成部署的环境中再次完整运行 <a href=https://github.com/pgsty/pigsty/blob/main/deploy.yml><strong><code>deploy.yml</code></strong></a> 可能会重启相关服务并覆盖配置，请务必注意！</p></div><hr><h2 id=界面>界面</h2><p>假设您使用 <a href=/docs/conf/full><strong>四节点</strong></a> 部署模版，那么 Pigsty 部署完成后，您的环境应该具有类似下面的部署结构：</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.12</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.13</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr></tbody></table><p><a href=/docs/infra><strong><code>INFRA</code></strong></a> 模块通过浏览器提供了一个 <a href=/docs/setup/webui><strong>图形化管理界面</strong></a>，您可以直接通过这台节点上的 Nginx 的 <strong>80/443</strong> 端口访问。</p><p><a href=/docs/pgsql/><strong><code>PGSQL</code></strong></a> 模块提供了一个 <a href=/docs/setup/pgsql><strong>PostgreSQL 数据库服务器</strong></a>，监听 <strong>5432</strong> 端口，也可通过 Pgbouncer / HAProxy <a href=/docs/pgsql/service><strong>代理访问</strong></a>。</p><p>对于生产环境的多节点高可用 PostgreSQL 集群来说，您需要通过 <a href=/docs/pgsql/misc/svc><strong>服务接入</strong></a> 来使用数据库服务，实现流量自动路由。</p><p><a href=https://demo.pigsty.cc/zh><img src=/img/pigsty/home.png alt></a></p><hr><h2 id=更多>更多</h2><p>安装完成后，您可以探索 <a href=/docs/setup/webui/><strong>用户界面</strong></a>，并通过 5432 端口访问 <a href=/docs/setup/pgsql/><strong>PostgreSQL 服务</strong></a>。</p><p>您还可以使用 Pigsty 部署和监控 <a href=/docs/conf/full><strong>更多集群</strong></a>：向 <a href=/docs/setup/config/><strong>配置清单</strong></a> 添加定义并运行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/node-add   pg-test      <span style=color:#8f5902;font-style:italic># 将集群 pg-test 的 3 个节点纳入 Pigsty 管理</span>
</span></span><span style=display:flex><span>bin/pgsql-add  pg-test      <span style=color:#8f5902;font-style:italic># 初始化一个 3 节点的 pg-test 高可用 PG 集群</span>
</span></span><span style=display:flex><span>bin/redis-add  redis-ms     <span style=color:#8f5902;font-style:italic># 初始化 Redis 集群： redis-ms</span>
</span></span></code></pre></div><p>大多数模块都需要先安装 <a href=/docs/node/><strong><code>NODE</code></strong></a> 模块。查看可用的 <a href=/docs/ref/module/><strong>模块</strong></a> 了解详情：</p><p><a href=/docs/pgsql/><strong><code>PGSQL</code></strong></a>、<a href=/docs/infra/><strong><code>INFRA</code></strong></a>、<a href=/docs/node/><strong><code>NODE</code></strong></a>、<a href=/docs/etcd/><strong><code>ETCD</code></strong></a>、
<a href=/docs/minio/><strong><code>MINIO</code></strong></a>、<a href=/docs/redis/><strong><code>REDIS</code></strong></a>、<a href=/docs/ferret/><strong><code>FERRET</code></strong></a>、<a href=/docs/docker/><strong><code>DOCKER</code></strong></a>……</p></div><div class=td-content style=page-break-before:always><h1 id=pg-374829cbbe6f2f715a9e6d868d9f9693>2 - 资源准备</h1><div class=lead>生产部署的准备工作，包括硬件，节点、磁盘、网络、VIP、域名、软件、文件系统等……</div><p>Pigsty 运行在节点（物理机或虚拟机）之上，本文档介绍硬件相关的规划与准备。</p><hr><h2 id=节点>节点</h2><p>Pigsty 目前运行在 <code>Linux</code> 内核和 <code>x86_64</code> / <code>aarch64</code> 架构的节点上。
<a href=/docs/concept/arch/node>"<strong>节点</strong>"</a> 指的是 SSH <a href=/docs/deploy/admin#%E9%AA%8C%E8%AF%81%E5%8F%AF%E8%BE%BE%E6%80%A7><strong>可访问</strong></a> 且提供裸 Linux 操作系统环境的资源。
它可以是物理机、虚拟机或配备 <code>systemd</code>、<code>sudo</code> 和 <code>sshd</code> 的类似操作系统的容器。</p><p>部署 Pigsty 至少需要 <strong>1</strong> 个节点，您可以准备更多，并在 <a href=/docs/setup/playbook#%E9%83%A8%E7%BD%B2%E5%89%A7%E6%9C%AC><strong>执行部署剧本</strong></a> 中一次性部署所有节点，或稍后添加并单独部署。
最小节点规格要求是 <code>1C1G</code>，建议至少使用 <code>1C2G</code>。越高越好，没有上限。<strong>系统参数将根据可用资源自动调优</strong>。</p><p>所需节点的数量，取决于您的需求，更多详情请参考 <a href=/docs/deploy/planning><strong>架构规划</strong></a>。
尽管带有 <a href=/docs/pgsql/backup/repository><strong>外部备份</strong></a> 的 <a href=/docs/setup/install><strong>单机部署</strong></a> 也提供一定程度上的兜底，
但我们建议在生产部署中使用复数个节点，起作用的 <a href=/docs/deploy/planning#%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE><strong>高可用配置</strong></a> 至少需要 <strong>3</strong> 个节点才能工作，<strong>2</strong> 个节点则提供 <a href=/docs/deploy/planning#%E5%8F%8C%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE><strong>半高可用</strong></a>。</p><hr><h2 id=磁盘>磁盘</h2><p>Pigsty 将使用 <strong><code>/data</code></strong> 作为默认数据目录，如果您有专用的主数据磁盘，建议将其挂载到那里，并为额外的磁盘驱动器使用 <code>/data1</code>、<code>/data2</code>、<code>/dataN</code>。
如果你想使用其他的数据目录，可以通过以下参数进行配置：</p><table class=full-width><thead><tr><th>名称</th><th>描述</th><th style=text-align:left>默认值</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_data><strong><code>node_data</code></strong></a></td><td>节点主数据目录</td><td style=text-align:left><code>/data</code></td></tr><tr><td><a href=/docs/pgsql/param#pg_fs_main><strong><code>pg_fs_main</code></strong></a></td><td>PG 主数据目录</td><td style=text-align:left><code>/data/postgres</code></td></tr><tr><td><a href=/docs/pgsql/param#pg_fs_backup><strong><code>pg_fs_backup</code></strong></a></td><td>PG 备份数据目录</td><td style=text-align:left><code>/data/backups</code></td></tr><tr><td><a href=/docs/etcd/param#etcd_data><strong><code>etcd_data</code></strong></a></td><td>ETCD 数据目录</td><td style=text-align:left><code>/data/etcd</code></td></tr><tr><td><a href=/docs/infra/param#infra_data><strong><code>infra_data</code></strong></a></td><td>Infra 数据目录</td><td style=text-align:left><code>/data/infra</code></td></tr><tr><td><a href=/docs/infra/param#nginx_data><strong><code>nginx_data</code></strong></a></td><td>Nginx 数据目录</td><td style=text-align:left><code>/data/nginx</code></td></tr><tr><td><a href=/docs/minio/param#minio_data><strong><code>minio_data</code></strong></a></td><td>MinIO 数据目录</td><td style=text-align:left><code>/data/minio</code></td></tr><tr><td><a href=/docs/redis/param#redis_fs_main><strong><code>redis_fs_main</code></strong></a></td><td>Redis 数据目录</td><td style=text-align:left><code>/data/redis</code></td></tr></tbody></table><hr><h2 id=文件系统>文件系统</h2><p>您可以使用任何支持的 Linux 文件系统来格式化数据磁盘，但对于生产环境部署，我们建议使用 <strong><code>xfs</code></strong>。</p><p><code>xfs</code> 是 linux 的标配之一，提供了最佳的性能，便利的 CoW 机制，允许你瞬间克隆大型数据库集群。使用 MinIO 时，必须使用 <code>xfs</code> 文件系统。
<code>ext4</code> 是另一个可用的选择，但缺乏 CoW 功能，但有着更为丰富的数据恢复工具生态。<code>zfs</code> 可以提供 RAID，快照功能，但性能折损较大且需要单独安装。
我们推荐您在这三种文件系统中按需权衡，择一使用。</p><p>如果有特殊需求，您也可以使用其他文件系统，但我们强烈不建议使用 NFS 网络文件系统来运行数据库服务。</p><p>Pigsty 的工作假设是 <code>/data</code> 目录属于 <code>root:root</code>，权限为 <code>755</code>。
管理员可以分配一级目录的所有权和权限。每个应用在其子目录中运行时将使用专用用户。
Pigsty 使用的目录结构说明，请参考 <a href=/docs/ref/fhs><strong>FHS</strong></a> 文档说明。</p><hr><h2 id=网络>网络</h2><p>Pigsty 默认使用在线安装模式，需要出站互联网访问。
使用 <a href=/docs/setup/offline/><strong>离线安装</strong></a> 模式则不再需要互联网访问。</p><p>在内网中，Pigsty 需要 <strong>静态网络</strong> 才能工作，您应该为每个节点明确分配一个 <strong>固定的</strong> IPv4 地址。</p><p>IP 地址将用作节点的 <strong>唯一标识符</strong>，它应该是绑定到用于 <strong>内部</strong> 网络通信的主网络接口的主 IP 地址。</p><p>作为特例，<a href=/docs/setup/install><strong>单机部署</strong></a> 时如果没有固定 IP 地址，可以使用本地环回地址 <code>127.0.0.1</code> 作为变通。</p><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>永远不要使用公网 IP 作为标识符</div><p>使用公网 IP 地址作为节点标识符可能导致安全和连接问题，请务必使用内网 IP 地址作为标识。</p></div><hr><h2 id=vip>VIP</h2><p>Pigsty 支持 NODE 集群（<code>keepalived</code>）和 PGSQL 集群（<code>vip-manager</code>）的可选 L2 VIP。</p><p>要使用 L2 VIP 功能，您必须为节点集群/数据库集群明确分配指定一个 L2 VIP 地址。
在您自己的硬件上运行时这不是大问题，但在公有云环境中工作时可能成为问题。</p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>L2 VIP 需要 L2 网络</div><p>要使用可选的节点 VIP 和 PG VIP 功能，请确保所有节点位于同一 L2 网络内。</p></div><hr><h2 id=ca>CA</h2><p>Pigsty 默认为每一套部署生成一套自签名的 <a href=/docs/concept/sec/ca/><strong>CA 基础设施</strong></a>，用于签发环境中所有的加密证书。</p><p>如果您已经有了正规的企业 CA，或者已经有了自签名的 CA，您也可以选择使用已有的 CA 来签发 Pigsty 所需的证书。</p><hr><h2 id=域名>域名</h2><p>Pigsty 默认使用一个本地静态域名 <code>i.pigsty</code> 来访问 WebUI，这是可选的，你也可以直接使用 IP 地址访问。</p><p>对于生产环境部署来说，建议您使用域名来访问服务，只有使用域名，才能启用 HTTPS 支持，加密您的数据传输。
同时，域名访问允许您在同一个端口上运行多种不同的服务，并通过不同的域名进行区分。</p><p>如果您的部署提供 <strong>互联网访问</strong>，那么可以使用公共 DNS 供应商（如 Cloudflare、阿里云 DNS、AWS Route53 等）来管理您的域名解析。
将您的域名指向 Pigsty 节点的 <strong>公网 IP 地址</strong> 即可。
如果您的部署针对 <strong>局域网/办公网</strong> 开放，那么可以使用内部 DNS 服务器来管理域名解析。
将您的域名指向 Pigsty 节点的 <strong>办公网 IP 地址</strong> 即可。</p><p>如果您的访问仅限于本机，或特定的几台机器，那么可以使用本地静态解析来管理域名解析。
将以下记录添加到（用于访问 Pigsty WebUI 的机器） <code>/etc/hosts</code> 文件（本地静态解析）中，即可从浏览器中访问。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 i.pigsty    <span style=color:#8f5902;font-style:italic># 替换为您计划使用的域名，与 Pigsty 节点的 IP 地址</span>
</span></span></code></pre></div><hr><h2 id=linux>Linux</h2><p>Pigsty 运行在 <strong>Linux</strong> 操作系统上，它支持 <strong>14</strong> 种主流 Linux 发行版：<a href=/docs/ref/linux/><strong>兼容操作系统列表</strong></a></p><p>我们推荐使用 <strong>RockyLinux 10.1</strong>、<strong>Debian 13.3</strong> 或 <strong>Ubuntu 24.04.3</strong> 作为默认操作系统选项。</p><p>在 MacOS 和 Windows 上，您可以用各种虚拟机软件或者 Docker systemd 镜像来安装 Pigsty。</p><p>我们 <strong>强烈建议</strong> 使用全新安装的操作系统环境，如果您的服务器已经运行了 Nginx / PostgreSQL 等服务，请考虑使用新的节点进行部署。</p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>在所有节点上使用相同的操作系统版本</div><p>多节点部署时，请确保所有节点使用相同的 Linux 发行版，架构与版本。异构节点部署虽然可能可以工作，但不受支持且可能导致不可预见的问题。</p></div><hr><h2 id=locale>Locale</h2><p>我们建议您将 <code>en_US</code> 设置为操作系统的主要语言，<strong>至少确保该 Locale 可用</strong>，从而确保 PG 日志打印英文。</p><p>一些发行版可能默认没有提供 <code>en_US</code> 区域设置，例如 Debian。使用以下命令启用 <code>en_US</code> 区域设置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>localedef -i en_US -f UTF-8 en_US.UTF-8
</span></span><span style=display:flex><span>localectl set-locale <span style=color:#000>LANG</span><span style=color:#ce5c00;font-weight:700>=</span>en_US.UTF-8
</span></span></code></pre></div><p>对于 PostgreSQL 来说，我们强烈建议您默认使用 PG 17+ 内置的 <code>C.UTF-8</code> 作为默认排序规则。</p><p>在 <a href=/docs/concept/iac/configure><strong>配置向导</strong></a> 中如果检测到 PG 版本满足或者操作系统支持，就默认配置 <code>C.UTF-8</code> 作为排序规则。</p><hr><h2 id=ansible>Ansible</h2><p>Pigsty 使用 <a href=/docs/setup/playbook/><strong>Ansible</strong></a> 从管理节点发起对所有被管理节点的控制，
<a href=/docs/setup/playbook#%E5%AE%89%E8%A3%85-ansible><strong>安装 Ansible</strong></a> 会介绍更多细节。</p><p>Pigsty 默认会在 Infra 节点上安装 Ansible，所以 Infra 节点是可以作为管理节点（或备用管理节点）使用。
在 <a href=/docs/setup/install><strong>单机部署</strong></a> 的时候，您当前执行安装的节点，既是运行 ansible 管理命令的 <a href=/docs/concept/arch/node#admin%E8%8A%82%E7%82%B9><strong>管理节点</strong></a>，也是部署基础设施的 <a href=/docs/concept/arch/node#infra%E8%8A%82%E7%82%B9><strong>INFRA节点</strong></a>。</p><hr><h2 id=pigsty>Pigsty</h2><p>您可以使用以下方式 <a href=/docs/deploy/install#%E5%AE%89%E8%A3%85><strong>安装</strong></a> 最新稳定版本的 Pigsty 源代码：</p><ul class="nav nav-tabs" id=tabs-3 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-03-00-tab data-bs-toggle=tab data-bs-target=#tabs-03-00 role=tab data-td-tp-persist=pigsty.cc（中国） aria-controls=tabs-03-00 aria-selected=true>
pigsty.cc（中国）</button></li><li class=nav-item><button class=nav-link id=tabs-03-01-tab data-bs-toggle=tab data-bs-target=#tabs-03-01 role=tab data-td-tp-persist=pigsty.io（全球） aria-controls=tabs-03-01 aria-selected=false>
pigsty.io（全球）</button></li></ul><div class=tab-content id=tabs-3-content><div class="tab-body tab-pane fade show active" id=tabs-03-00 role=tabpanel aria-labelled-by=tabs-03-00-tab tabindex=3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-03-01 role=tabpanel aria-labelled-by=tabs-03-01-tab tabindex=3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div></div><p>要 <a href=/docs/deploy/install#%E5%AE%89%E8%A3%85><strong>安装</strong></a> 最新特定版本的 Pigsty，可以使用 <strong><code>-s &lt;version></code></strong> 参数：</p><ul class="nav nav-tabs" id=tabs-4 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-04-00-tab data-bs-toggle=tab data-bs-target=#tabs-04-00 role=tab data-td-tp-persist=pigsty.cc（中国） aria-controls=tabs-04-00 aria-selected=true>
pigsty.cc（中国）</button></li><li class=nav-item><button class=nav-link id=tabs-04-01-tab data-bs-toggle=tab data-bs-target=#tabs-04-01 role=tab data-td-tp-persist=pigsty.io（全球） aria-controls=tabs-04-01 aria-selected=false>
pigsty.io（全球）</button></li></ul><div class=tab-content id=tabs-4-content><div class="tab-body tab-pane fade show active" id=tabs-04-00 role=tabpanel aria-labelled-by=tabs-04-00-tab tabindex=4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/get <span style=color:#000;font-weight:700>|</span> bash -s v4.1.0
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-04-01 role=tabpanel aria-labelled-by=tabs-04-01-tab tabindex=4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/get <span style=color:#000;font-weight:700>|</span> bash -s v4.1.0
</span></span></code></pre></div></div></div><p>要 <a href=/docs/deploy/install#%E5%AE%89%E8%A3%85><strong>安装</strong></a> 最新 Beta 版本的 Pigsty 源代码，可以使用 <strong><code>beta</code></strong> 脚本：</p><ul class="nav nav-tabs" id=tabs-5 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-05-00-tab data-bs-toggle=tab data-bs-target=#tabs-05-00 role=tab data-td-tp-persist=pigsty.cc（中国） aria-controls=tabs-05-00 aria-selected=true>
pigsty.cc（中国）</button></li><li class=nav-item><button class=nav-link id=tabs-05-01-tab data-bs-toggle=tab data-bs-target=#tabs-05-01 role=tab data-td-tp-persist=pigsty.io（全球） aria-controls=tabs-05-01 aria-selected=false>
pigsty.io（全球）</button></li></ul><div class=tab-content id=tabs-5-content><div class="tab-body tab-pane fade show active" id=tabs-05-00 role=tabpanel aria-labelled-by=tabs-05-00-tab tabindex=5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.cc/beta <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-05-01 role=tabpanel aria-labelled-by=tabs-05-01-tab tabindex=5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://repo.pigsty.io/beta <span style=color:#000;font-weight:700>|</span> bash<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div></div><p>如果你是开发者，或者想要获取最新的开发版本，可以直接 git 克隆 Pigsty 代码仓库：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/pgsty/pigsty.git<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> pigsty<span style=color:#000;font-weight:700>;</span> git checkout v4.1.0
</span></span></code></pre></div><p>如果您的环境没有互联网访问，也可以直接从 <a href=https://github.com/pgsty/pigsty/releases/><strong>GitHub Release</strong></a> 页面，或者 Pigsty 仓库下载源码包：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://repo.pigsty.cc/src/pigsty-v4.1.0.tgz
</span></span><span style=display:flex><span>wget https://repo.pigsty.io/src/pigsty-v4.1.0.tgz
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9acb71881039d3570f14c9a9caf9563c>3 - 架构规划</h1><div class=lead>使用多少个节点？为哪些模块配置高可用？如何根据可用的资源与业务需求进行规划？</div><p>Pigsty 采用 <a href=/docs/concept/arch><strong>模块化架构</strong></a>，您可以像搭积木一样组合出自己想要的部署方案，并用简单的 <a href=/docs/concept/iac><strong>声明式配置</strong></a> 表达您的意图。</p><h2 id=常见方案>常见方案</h2><p>这里有一些常见的组合模式供您参考，您可以根据自己的需求进行进一步的定制与调整：</p><table class=full-width><thead><tr><th style=text-align:center>方案</th><th style=text-align:center><a href=/docs/infra/><strong>INFRA</strong></a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/pgsql/><strong>PGSQL</strong></a></th><th style=text-align:center><a href=/docs/minio><strong>MINIO</strong></a></th><th>说明</th></tr></thead><tbody><tr><td style=text-align:center>单机部署（<a href=/docs/conf/meta><strong><code>meta</code></strong></a>）</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center></td><td><a href=/docs/setup/install><strong>单机部署</strong></a> 默认配置，经典方案</td></tr><tr><td style=text-align:center>单机部署（<a href=/docs/conf/slim><strong><code>slim</code></strong></a>）</td><td style=text-align:center></td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center></td><td>不要监控设施，只要数据库</td></tr><tr><td style=text-align:center>基础设施（<a href=/docs/conf/infra><strong><code>infra</code></strong></a>）</td><td style=text-align:center>1</td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td>只要监控基础设施</td></tr><tr><td style=text-align:center>单机部署（<a href=/docs/conf/rich><strong><code>rich</code></strong></a>）</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td>单机 + 对象存储 + 本地仓库/扩展</td></tr></tbody></table><table class=full-width><thead><tr><th style=text-align:center>多节点方案</th><th style=text-align:center><a href=/docs/infra/><strong>INFRA</strong></a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/pgsql/><strong>PGSQL</strong></a></th><th style=text-align:center><a href=/docs/minio><strong>MINIO</strong></a></th><th>说明</th></tr></thead><tbody><tr><td style=text-align:center>双节点（<a href=/docs/conf/dual><strong><code>dual</code></strong></a>）</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>2</td><td style=text-align:center></td><td>2节点半HA，可容忍坏特定一个</td></tr><tr><td style=text-align:center>三节点（<a href=/docs/conf/trio><strong><code>trio</code></strong></a>）</td><td style=text-align:center>3</td><td style=text-align:center>3</td><td style=text-align:center>3</td><td style=text-align:center></td><td>标准3节点HA，可容忍坏一个</td></tr><tr><td style=text-align:center>四节点（<a href=/docs/conf/full><strong><code>full</code></strong></a>）</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>1+3</td><td style=text-align:center></td><td>演示专用，1 INFRA/ETCD</td></tr><tr><td style=text-align:center>生产部署（<a href=/docs/conf/simu><strong><code>simu</code></strong></a>）</td><td style=text-align:center>2</td><td style=text-align:center>3</td><td style=text-align:center>n</td><td style=text-align:center>n</td><td>2个INFRA，3个ETCD</td></tr><tr><td style=text-align:center>大规模生产（自定义）</td><td style=text-align:center>3</td><td style=text-align:center>5</td><td style=text-align:center>n</td><td style=text-align:center>n</td><td>3个INFRA，5个 ETCD</td></tr></tbody></table><p>使用什么样的架构规划方案，取决于您对数据库可靠性的要求，以及手头可用的资源。
通常来说，严肃的生产环境部署至少需要 <strong>3</strong> 个节点以实现 <a href=#%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE><strong>高可用配置</strong></a>。
如果您只有 <strong>2</strong> 个节点，则可以使用 <a href=#%E5%8F%8C%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE><strong>半高可用配置</strong></a>。</p><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>专家咨询服务：架构规划</div><p>我们提供 <a href=/price><strong>架构咨询服务</strong></a>（¥2,000）为您筹划合适的 Pigsty 配置方案。</p></div><hr><h2 id=利弊权衡>利弊权衡</h2><ul><li>若要使用 Pigsty 的监控系统，则至少需要 <strong>1</strong> 个 INFRA 节点，生产部署通常使用 <strong>2</strong> 个，大规模部署 <strong>3</strong> 个。</li><li>若要启用 PG 高可用，则至少需要 <strong>1</strong> 个 ETCD 节点，生产部署通常使用 <strong>3</strong> 个，大规模环境中 <strong>5</strong> 个，须奇数个。</li><li>若要启用对象存储（MinIO），则至少需要 <strong>1</strong> 个 <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98><strong>MINIO 节点</strong></a>，严肃使用时通常使用 4+ 节点部署 <a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>MNMD</strong></a> 集群。</li><li>PG 生产集群通常至少为两节点主从配置；严肃场景通常使用 3 节点；高只读负载可以有更多从库（几十个）</li><li>此外对于 PostgreSQL 来说，您还可以按需使用 离线实例，同步实例，备份集群，延迟集群等等高级配置。</li></ul><hr><h2 id=单节点配置>单节点配置</h2><p>最简单的配置，所有内容都在单个节点上运行，默认安装四个基本模块，通常用于 Demo，Devbox，或测试环境。</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr></tbody></table><p>如果为备份/PITR 配置了外部 S3 / MinIO <a href=/docs/pgsql/backup/><strong>备份仓库</strong></a> 提供兜底的 RTO/RPO，此配置亦可用于普通标准的生产环境。</p><p>单节点配置有多种变体：</p><ul><li><strong>充血版</strong>（<a href=/docs/conf/rich><strong><code>rich</code></strong></a>）：生产版本的单机部署模版，带有本地 MinIO 对象存储，使用本地软件仓库，下载所有 PG 扩展。</li><li><strong>瘦身版</strong>（<a href=/docs/conf/slim><strong><code>slim</code></strong></a>）：只安装 <a href=/docs/pgsql/><strong>PGSQL</strong></a> 和 <a href=/docs/etcd/><strong>ETCD</strong></a>，不安装监控设施 —— <a href=/docs/setup/slim><strong>精简安装</strong></a> 也可以扩充为 <a href=/docs/setup/slim#%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4><strong>多节点高可用部署</strong></a></li><li><strong>监控版</strong>（<a href=/docs/conf/infra><strong><code>infra</code></strong></a>）：与 <code>slim</code> 相反，只安装 <a href=/docs/infra/><strong>INFRA</strong></a> 监控基础设施，不安装数据库服务，只用来监控其他实例。</li><li><strong>内核替换</strong>：用衍生分支 <a href=/docs/conf/pgsql/><strong><code>pgsql</code></strong></a>，<a href=/docs/conf/citus/><strong><code>citus</code></strong></a>，<a href=/docs/conf/mssql/><strong><code>mssql</code></strong></a>，<a href=/docs/conf/polar/><strong><code>polar</code></strong></a>，<a href=/docs/conf/ivory/><strong><code>ivory</code></strong></a>，<a href=/docs/conf/mysql/><strong><code>mysql</code></strong></a>，<a href=/docs/conf/pgtde/><strong><code>pgtde</code></strong></a>，<a href=/docs/conf/oriole/><strong><code>oriole</code></strong></a>，<a href=/docs/conf/supabase/><strong><code>supabase</code></strong></a> 替换原生 PG。</li></ul><hr><h2 id=双节点配置>双节点配置</h2><p><a href=/docs/conf/dual><strong>双节点配置</strong></a> 将启用数据库复制和 <strong>半高可用</strong> 能力，提供更好的数据冗余，以及有限的故障转移支持：</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code> (<code>replica</code>)</td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-meta-2</code> (<code>primary</code>)</td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>双节点配置的高可用自动切换机制有限制，这种"半 HA"设置只能从特定节点故障中自动恢复：</p><ul><li>如果 <code>node-1</code> 故障，无自动故障转移：需要手动提升 <code>node-2</code></li><li>如果 <code>node-2</code> 故障，自动故障转移有效：<code>node-1</code> 自动提升</li></ul><hr><h2 id=三节点配置>三节点配置</h2><p><a href=/docs/conf/trio><strong>三节点模板</strong></a> 提供真正的基础高可用配置，可以容忍任意一个节点的故障，并从中自动恢复。</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-meta-2</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center><code>etcd-2</code></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-meta-3</code></td><td style=text-align:center><code>infra-3</code></td><td style=text-align:center><code>etcd-3</code></td></tr></tbody></table><hr><h2 id=四节点配置>四节点配置</h2><p>Pigsty <a href=/docs/deploy/sandbox/><strong>沙箱环境</strong></a> 使用的 <a href=/docs/conf/full><strong>标准四节点配置</strong></a>。</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>node-4</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>在这里我们出于演示目的，不配置 <a href=/docs/infra><strong>INFRA</strong></a> / <a href=/docs/etcd><strong>ETCD</strong></a> 模块的高可用，您也可以对其进行进一步的调整</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/minio/><strong>MINIO</strong></a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center><code>minio-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center><code>etcd-2</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-3</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>node-4</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><hr><h2 id=更多节点>更多节点</h2><p>如果您有着完善的虚拟化设施或充足的资源，完全可以 <a href=/docs/conf/simu><strong>使用更多的节点</strong></a>，让每个模块都采用 <strong>独占式部署</strong>，从而获得最佳的可靠性，可观测性与性能表现。</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center><a href=/docs/node/>NODE</a></th><th style=text-align:center><a href=/docs/infra/>INFRA</a></th><th style=text-align:center><a href=/docs/etcd/><strong>ETCD</strong></a></th><th style=text-align:center><a href=/docs/minio/><strong>MINIO</strong></a></th><th style=text-align:center><a href=/docs/pgsql/>PGSQL</a></th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-meta-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>infra-2</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-meta-2</code></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.21</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.22</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-2</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>5</td><td style=text-align:center><code>10.10.10.23</code></td><td style=text-align:center></td><td style=text-align:center><code>etcd-3</code></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>6</td><td style=text-align:center><code>10.10.10.31</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-1</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>7</td><td style=text-align:center><code>10.10.10.32</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-2</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>8</td><td style=text-align:center><code>10.10.10.33</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-3</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>9</td><td style=text-align:center><code>10.10.10.34</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>minio-4</code></td><td style=text-align:center></td></tr><tr><td style=text-align:center>10</td><td style=text-align:center><code>10.10.10.40</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-1</code></td></tr><tr><td style=text-align:center>11</td><td style=text-align:center><code>10.10.10.41</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-2</code></td></tr><tr><td style=text-align:center>12</td><td style=text-align:center><code>10.10.10.42</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-src-3</code></td></tr><tr><td style=text-align:center>13</td><td style=text-align:center><code>10.10.10.50</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-1</code></td></tr><tr><td style=text-align:center>14</td><td style=text-align:center><code>10.10.10.51</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-2</code></td></tr><tr><td style=text-align:center>15</td><td style=text-align:center><code>10.10.10.52</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center><code>pg-test-3</code></td></tr><tr><td style=text-align:center>16</td><td style=text-align:center>&mldr;&mldr;</td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-7679452458507892fa3756a891f5287a>4 - 管理机制</h1><div class=lead>关于管理用户、管理节点，Sudo、SSH、可达性验证，以及防火墙的配置与准备</div><p>Pigsty 需要一个在所有被管理节点上具有免密 <a href=#ssh><strong>SSH</strong></a> 和 <a href=#sudo><strong>Sudo</strong></a> 权限的操作系统 <strong>管理用户</strong>。</p><p>这个用户需要能够通过 ssh 访问到所有被管理节点，并且能够在这些节点上执行 sudo 命令。</p><p>要想将节点纳入 Pigsty 中管理，</p><hr><h2 id=用户>用户</h2><p>通常我们会选择 <code>dba</code> 或 <code>admin</code> 这样的用户名称，并避免使用 <code>root</code> 与 <code>postgres</code>：</p><ul><li>使用 <code>root</code> 进行部署是可行的，但不符合生产最佳实践。</li><li>使用 <code>postgres</code> （<a href=/docs/pgsql/param#pg_dbsu><strong><code>pg_dbsu</code></strong></a>）作为管理员用户是严格禁止的。</li></ul><hr><h2 id=免密码>免密码</h2><p>如果您可以接受为每个 <code>ssh</code> 和 <code>sudo</code> 命令输入密码，则免密码要求是可选的。</p><p>您可以在 <a href=/docs/setup/playbook/><strong>执行剧本</strong></a> 时使用 <code>-k|--ask-pass</code> 来提示输入 <strong>SSH</strong> 密码，
以及 <code>-K|--ask-become-pass</code> 来提示输入 <strong>sudo</strong> 密码。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./deploy.yml -k -K
</span></span></code></pre></div><p>一些企业的安全策略可能不允许免密 <code>ssh</code> 或 <code>sudo</code>，在这种情况下，您可以使用上述选项。</p><p>或者考虑配置一个 sudo 密码缓存时间较长的 sudoers 规则，以减少密码提示的频率。</p><hr><h2 id=创建管理员用户>创建管理员用户</h2><p>通常，您的服务器/虚拟机供应商会为您创建一个初始管理员用户。</p><p>如果你对这个用户不满意，Pigsty 的部署剧本可以为你创建一个 <a href=#%E5%88%9B%E5%BB%BA%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7><strong>新的管理员用户</strong></a>。</p><p>假设您在节点上有 root 权限，或有一个现有的管理员用户，您可以使用 Pigsty 本身创建管理员用户：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -k -K -t node_admin -e <span style=color:#000>ansible_user</span><span style=color:#ce5c00;font-weight:700>=[</span>你准备使用的管理员名称<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>它将利用现有的管理员创建新的管理员，创建由以下参数描述的专用 <code>dba</code>（uid=88）用户，并正确配置 sudo / ssh。</p><table class=full-width><thead><tr><th>名称</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><a href=/docs/node/param#node_admin_enabled><code>node_admin_enabled</code></a></td><td>启用节点管理员用户</td><td><code>true</code></td></tr><tr><td><a href=/docs/node/param#node_admin_uid><code>node_admin_uid</code></a></td><td>节点管理员用户的 UID</td><td><code>88</code></td></tr><tr><td><a href=/docs/node/param#node_admin_username><code>node_admin_username</code></a></td><td>节点管理员用户名</td><td><code>dba</code></td></tr></tbody></table><hr><h2 id=sudo>Sudo</h2><p>所有 <a href=#%E7%94%A8%E6%88%B7><strong>管理员用户</strong></a> 都应该在所有被管理节点上具有 <code>sudo</code> 权限【最好带有免密码执行权限】。</p><p>如果您想从头开始配置具有免密 <code>sudo</code> 权限的管理员用户，可以编辑/创建 suoder 文件（假设用户名为 <code>vagrant</code>）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;%vagrant ALL=(ALL) NOPASSWD: ALL&#39;</span> <span style=color:#000;font-weight:700>|</span> sudo tee /etc/sudoers.d/vagrant
</span></span></code></pre></div><p>假设您的管理员用户名选择是 <code>dba</code>，那么 <code>/etc/sudoers.d/dba</code> 内容应该是：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>%dba <span style=color:#000>ALL</span><span style=color:#ce5c00;font-weight:700>=(</span>ALL<span style=color:#ce5c00;font-weight:700>)</span> NOPASSWD: ALL
</span></span></code></pre></div><p>如果您的安全策略不允许免密码 <code>sudo</code>，请将 <code>NOPASSWD:</code> 部分删除：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>%dba <span style=color:#000>ALL</span><span style=color:#ce5c00;font-weight:700>=(</span>ALL<span style=color:#ce5c00;font-weight:700>)</span> ALL
</span></span></code></pre></div><p>Ansible 依赖 <code>sudo</code> 在被管理节点上以 root 权限执行命令。
在 <code>sudo</code> 不可用的环境中（比如 Docker 容器内）需要先安装 <code>sudo</code> 才能正确部署。</p><hr><h2 id=ssh>SSH</h2><p>您的当前用户应该能够以相应的管理员用户身份免密 SSH 访问所有被管理节点。</p><p>您的当前用户可以是管理员用户本身，但不是必需的，只要您能以管理员用户身份 SSH。</p><p>SSH 配置是 Linux 101，但我们会在此处介绍基础知识，以防您不熟悉：</p><h3 id=生成-ssh-密钥>生成 SSH 密钥</h3><p>如果您没有 SSH 密钥对，请生成一个：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#0000cf;font-weight:700>2048</span> -N <span style=color:#4e9a06>&#39;&#39;</span> -f ~/.ssh/id_rsa -q
</span></span></code></pre></div><p>如果您没有密钥对，Pigsty 会在 <a href=/docs/setup/offline#bootstrap><code>bootstrap</code></a> 阶段为您完成此操作。</p><h3 id=复制-ssh-密钥>复制 SSH 密钥</h3><p>您需要将生成的公钥分发到远程（和本地）服务器，并将其放入所有节点上管理员用户的 <code>~/.ssh/authorized_keys</code> 文件中。
可以使用 <code>ssh-copy-id</code> 工具。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-copy-id &lt;ip&gt;                        <span style=color:#8f5902;font-style:italic># 交互式密码输入</span>
</span></span><span style=display:flex><span>sshpass -p &lt;password&gt; ssh-copy-id &lt;ip&gt;  <span style=color:#8f5902;font-style:italic># 非交互式（谨慎使用）</span>
</span></span></code></pre></div><h3 id=使用别名>使用别名</h3><p>当无法直接 SSH 访问时（由于跳板机、其他端口、凭据等），考虑在 <code>~/.ssh/config</code> 中配置 SSH 别名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Host meta
</span></span><span style=display:flex><span>    HostName 10.10.10.10
</span></span><span style=display:flex><span>    User dba                      <span style=color:#8f5902;font-style:italic># 远程上不同的用户</span>
</span></span><span style=display:flex><span>    IdentityFile /etc/dba/id_rsa  <span style=color:#8f5902;font-style:italic># 不是普通密钥</span>
</span></span><span style=display:flex><span>    Port <span style=color:#0000cf;font-weight:700>24</span>                       <span style=color:#8f5902;font-style:italic># 不是众所周知的端口</span>
</span></span></code></pre></div><p>并在清单中引用别名，使用 <code>ansible_host</code> 指定真实的 SSH 别名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># 如果节点 `10.10.10.10` 需要 SSH 别名 `meta`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>ansible_host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta } </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 通过 `ssh meta` 访问</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>SSH 参数可以直接在 Ansible 中使用，详情请查看 <a href=https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters>Ansible Inventory Guide</a>。
通过这种技术，您可以使用跳板机访问私有网络中的节点，或者使用不同的端口和凭据访问节点。
或者是利用本地笔记本作为管理节点。</p><hr><h2 id=验证可达性>验证可达性</h2><p>您应该能够从管理节点通过当前用户免密 <code>ssh</code> 访问所有被管理节点。
远程用户（管理员用户）应该有权限运行免密 <code>sudo</code> 命令。
要验证免密 ssh sudo 是否工作，在管理节点上对所有被管理节点运行此命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh &lt;ip<span style=color:#000;font-weight:700>|</span>alias&gt; <span style=color:#4e9a06>&#39;sudo ls&#39;</span>
</span></span></code></pre></div><p>如果没有密码提示或错误，免密 ssh/sudo 按预期工作。</p><hr><h2 id=防火墙>防火墙</h2><p>在生产环境部署时，通常需要设置防火墙，以阻止未经授权的端口访问。</p><p>默认情况下，你可以阻断办公网/互联网对节点的入站访问，只开放下列端口：</p><ul><li>要通过 ssh 访问节点，您必须允许 SSH 端口 <code>22</code> 入站访问。</li><li>要访问 WebUI 服务，您必须允许 HTTP（<code>80</code>）/ HTTPS（<code>443</code>）入站访问。</li><li>要访问 PostgreSQL 数据库服务，您必须允许 PostgreSQL 的 <code>5432</code> 入站访问。</li></ul><p>如果您通过其他端口访问 PostgreSQL 服务，请相应地允许它们。
Pigsty 组件使用的端口列表，请参考：<a href=/docs/node/><strong>使用的端口</strong></a>。</p><ul><li><code>5432</code>: PostgreSQL 数据库</li><li><code>6432</code>: Pgbouncer 连接池</li><li><code>5433</code>: PG 主要服务</li><li><code>5434</code>: PG 副本服务</li><li><code>5436</code>: PG 默认服务</li><li><code>5438</code>: PG 离线服务</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-aa44e6b5b4b5d27a4235af210a56fc6e>5 - 沙箱环境</h1><div class=lead>用于学习、测试与演示的 Pigsty 标准四节点沙箱环境</div><p>Pigsty 提供了一个标准的四节点 <strong>沙箱环境</strong>，用于学习、测试与功能演示。</p><p>沙箱使用固定的 IP 地址和预定义的身份标识符，便于复现各种演示用例。</p><hr><h2 id=环境描述>环境描述</h2><p>默认的沙箱环境由 4 个节点组成，默认使用配置文件 <a href=https://github.com/pgsty/pigsty/blob/main/conf/ha/full.yml><code>ha/full.yml</code></a>。</p><table class=full-width><thead><tr><th style=text-align:center>ID</th><th style=text-align:center>IP 地址</th><th style=text-align:center>节点名</th><th style=text-align:center>PostgreSQL</th><th style=text-align:center>INFRA</th><th style=text-align:center>ETCD</th><th style=text-align:center>MINIO</th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center><code>10.10.10.10</code></td><td style=text-align:center><code>meta</code></td><td style=text-align:center><code>pg-meta-1</code></td><td style=text-align:center><code>infra-1</code></td><td style=text-align:center><code>etcd-1</code></td><td style=text-align:center><code>minio-1</code></td></tr><tr><td style=text-align:center>2</td><td style=text-align:center><code>10.10.10.11</code></td><td style=text-align:center><code>node-1</code></td><td style=text-align:center><code>pg-test-1</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>3</td><td style=text-align:center><code>10.10.10.12</code></td><td style=text-align:center><code>node-2</code></td><td style=text-align:center><code>pg-test-2</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr><tr><td style=text-align:center>4</td><td style=text-align:center><code>10.10.10.13</code></td><td style=text-align:center><code>node-3</code></td><td style=text-align:center><code>pg-test-3</code></td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center></td></tr></tbody></table><p>沙箱的配置可以概括表示为以下配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>infra_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>etcd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_seq:  1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>etcd_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>etcd } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-meta</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary } }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>  </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-meta }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 1, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>primary }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 2, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_seq: 3, pg_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>replica }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>pg_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pg-test }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>v4.1.0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>admin_ip</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>pg_version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><img src=/img/pigsty/sandbox.png alt=pigsty-sandbox></p><h3 id=postgresql-集群>PostgreSQL 集群</h3><p>沙箱带有一个位于 <code>meta</code> 节点上的单实例 PostgreSQL 集群 <code>pg-meta</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 meta pg-meta-1
</span></span><span style=display:flex><span>10.10.10.2  pg-meta          <span style=color:#8f5902;font-style:italic># 可选的 L2 VIP</span>
</span></span></code></pre></div><p>沙箱中还有一个由三个实例组成的 PostgreSQL 高可用集群 <code>pg-test</code>，部署在另外三个节点上：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.11 node-1 pg-test-1
</span></span><span style=display:flex><span>10.10.10.12 node-2 pg-test-2
</span></span><span style=display:flex><span>10.10.10.13 node-3 pg-test-3
</span></span><span style=display:flex><span>10.10.10.3  pg-test          <span style=color:#8f5902;font-style:italic># 可选的 L2 VIP</span>
</span></span></code></pre></div><p>两个可选的 L2 VIP 分别绑定在 <code>pg-meta</code> 和 <code>pg-test</code> 集群的主实例上。</p><h3 id=基础设施>基础设施</h3><p>在 <code>meta</code> 节点上还部署有：</p><ul><li><strong>ETCD 集群</strong>：单节点 <code>etcd</code> 集群，为 PostgreSQL HA 提供 DCS 服务</li><li><strong>MinIO 集群</strong>：单节点 <code>minio</code> 集群，提供 S3 兼容的对象存储服务</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.10.10 etcd-1
</span></span><span style=display:flex><span>10.10.10.10 minio-1
</span></span></code></pre></div><hr><h2 id=创建沙箱>创建沙箱</h2><p>Pigsty 提供了开箱即用的模板，您可以使用 <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> 在本地创建沙箱，或使用 <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> 在云上创建沙箱。</p><p>4节点的沙箱
当然，您也可以自己手工准备置备这些节点。</p><h3 id=本地沙箱vagrant>本地沙箱（Vagrant）</h3><p>本地沙箱使用 Virtualbox/libvirt 创建本地虚拟机，可以在您的 Mac / PC 上免费运行。</p><p>运行完整的 4 节点沙箱，您的机器应至少拥有 <strong>4 核 CPU</strong> 与 <strong>8GB 内存</strong>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>make full       <span style=color:#8f5902;font-style:italic># 使用默认 RockyLinux 9 镜像创建 4 节点沙箱</span>
</span></span><span style=display:flex><span>make full9      <span style=color:#8f5902;font-style:italic># 使用 RockyLinux 9 创建 4 节点沙箱</span>
</span></span><span style=display:flex><span>make full12     <span style=color:#8f5902;font-style:italic># 使用 Debian 12 创建 4 节点沙箱</span>
</span></span><span style=display:flex><span>make full24     <span style=color:#8f5902;font-style:italic># 使用 Ubuntu 24.04 创建 4 节点沙箱</span>
</span></span></code></pre></div><p>更多详情请参考 <a href=/docs/deploy/vagrant/><strong>Vagrant</strong></a> 文档。</p><h3 id=云沙箱terraform>云沙箱（Terraform）</h3><p>云沙箱使用公有云 API 创建虚拟机，可以轻松创建和销毁，按需付费，非常适合快速测试。</p><p>使用 <a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-full.tf><code>spec/aliyun-full.tf</code></a> 模板在阿里云上创建 4 节点沙箱：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-full.tf terraform.tf
</span></span><span style=display:flex><span>terraform init
</span></span><span style=display:flex><span>terraform apply
</span></span></code></pre></div><p>更多详情请参考 <a href=/docs/deploy/terraform/><strong>Terraform</strong></a> 文档。</p><hr><h2 id=其他规格>其他规格</h2><p>除了标准的 4 节点沙箱，Pigsty 还提供了其他规格的环境：</p><h3 id=单节点开发箱meta>单节点开发箱（meta）</h3><p>最简单的 1 节点环境，用于快速上手、开发和测试：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make meta       <span style=color:#8f5902;font-style:italic># 创建单节点开发箱</span>
</span></span></code></pre></div><h3 id=双节点环境dual>双节点环境（dual）</h3><p>2 节点环境，用于测试主从复制：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make dual       <span style=color:#8f5902;font-style:italic># 创建 2 节点环境</span>
</span></span></code></pre></div><h3 id=三节点环境trio>三节点环境（trio）</h3><p>3 节点环境，用于测试基本高可用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make trio       <span style=color:#8f5902;font-style:italic># 创建 3 节点环境</span>
</span></span></code></pre></div><h3 id=生产仿真环境simu>生产仿真环境（simu）</h3><p>20 节点的大型仿真环境，用于模拟生产环境进行完整测试：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make simu       <span style=color:#8f5902;font-style:italic># 创建 20 节点生产仿真环境</span>
</span></span></code></pre></div><p>该环境包含：</p><ul><li>3 个基础设施节点（<code>meta1</code>, <code>meta2</code>, <code>meta3</code>）</li><li>2 个 HAProxy 代理节点</li><li>4 个 MinIO 节点</li><li>5 个 ETCD 节点</li><li>6 个 PostgreSQL 节点（2 个集群，每个 3 节点）</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c08c58dc7691eda288baa9ba0766305>6 - Vagrant</h1><div class=lead>使用 Vagrant 在本地创建虚拟机环境</div><p><a href=https://www.vagrantup.com/><strong>Vagrant</strong></a> 是一个流行的本地虚拟化工具，可以按照声明式的方式创建本地虚拟机。</p><p>Pigsty 需要 Linux 环境运行，您可以使用 Vagrant 轻松在本地创建 Linux 虚拟机进行测试。</p><hr><h2 id=安装依赖>安装依赖</h2><p>首先，确保您的系统中已经安装了 <a href=https://www.vagrantup.com/><strong>Vagrant</strong></a> 和虚拟机软件（<a href=https://www.virtualbox.org/><strong>VirtualBox</strong></a>， <a href=https://libvirt.org/><strong>libvirt</strong></a>，Hyper-V，Parallel，……）。</p><p>在 MacOS 上，您可以使用 <a href=https://brew.sh/><strong>Homebrew</strong></a> 一键安装 vagrant 与 virtualbox；
在 Linux 上，您可以使用 VirtualBox 或 <a href=https://vagrant-libvirt.github.io/vagrant-libvirt/><strong>vagrant-libvirt</strong></a> 作为虚拟机管理软件；
在 Windows 专业版上，可以使用 Virtualbox 与 Hyper-V 作为提供商。</p><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab aria-controls=tabs-00-00 aria-selected=true>
macOS</button></li><li class=nav-item><button class=nav-link id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab aria-controls=tabs-00-01 aria-selected=false>
安装 Homebrew</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-pane fade show active" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>brew install vagrant virtualbox ansible
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装 VirtualBox 后需要重启系统，并在系统偏好设置中允许其内核扩展。</span></span></span></code></pre></div></div><div class="tab-pane fade" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>/bin/bash -c <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span></span></span></code></pre></div></div></div><h3 id=创建虚拟机>创建虚拟机</h3><p>使用 Pigsty 提供的 <code>make</code> 快捷方式创建虚拟机：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make meta       <span style=color:#8f5902;font-style:italic># 1 节点开发箱，用于快速上手、开发和测试</span>
</span></span><span style=display:flex><span>make full       <span style=color:#8f5902;font-style:italic># 4 节点沙箱，用于高可用测试和功能演示</span>
</span></span><span style=display:flex><span>make simu       <span style=color:#8f5902;font-style:italic># 20 节点仿真环境，用于生产环境模拟</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 其他不常用的规格</span>
</span></span><span style=display:flex><span>make dual       <span style=color:#8f5902;font-style:italic># 2 节点环境</span>
</span></span><span style=display:flex><span>make trio       <span style=color:#8f5902;font-style:italic># 3 节点环境</span>
</span></span><span style=display:flex><span>make deci       <span style=color:#8f5902;font-style:italic># 10 节点环境</span>
</span></span></code></pre></div><p>您可以使用变体别名指定不同的操作系统镜像：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make meta9      <span style=color:#8f5902;font-style:italic># 使用 RockyLinux 9.7 创建单节点</span>
</span></span><span style=display:flex><span>make full12     <span style=color:#8f5902;font-style:italic># 使用 Debian 12.13 创建 4 节点沙箱</span>
</span></span><span style=display:flex><span>make simu24     <span style=color:#8f5902;font-style:italic># 使用 Ubuntu 24.04 创建 20 节点仿真环境</span>
</span></span></code></pre></div><p>可用的操作系统后缀：<code>8</code>（EL8）、<code>9</code>（EL9）、<code>10</code>（EL10）、<code>12</code>（Debian 12）、<code>13</code>（Debian 13）、<code>22</code>（Ubuntu 22.04）、<code>24</code>（Ubuntu 24.04）</p><h3 id=构建环境>构建环境</h3><p>您还可以使用以下别名创建 Pigsty 构建环境，这些模板不会替换基础镜像：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make oss        <span style=color:#8f5902;font-style:italic># 3 节点 OSS 构建环境</span>
</span></span><span style=display:flex><span>make pro        <span style=color:#8f5902;font-style:italic># 5 节点 PRO 构建环境</span>
</span></span><span style=display:flex><span>make rpm        <span style=color:#8f5902;font-style:italic># 3 节点 EL8/9/10 构建环境</span>
</span></span><span style=display:flex><span>make deb        <span style=color:#8f5902;font-style:italic># 4 节点 Debian12/13 Ubuntu22/24 构建环境</span>
</span></span><span style=display:flex><span>make all        <span style=color:#8f5902;font-style:italic># 7 节点全量构建环境</span>
</span></span></code></pre></div><hr><h2 id=规格配置>规格配置</h2><p>Pigsty 在 <a href=https://github.com/pgsty/pigsty/tree/main/vagrant/spec><code>vagrant/spec/</code></a> 目录下提供了多种预定义的虚拟机规格：</p><table class=full-width><thead><tr><th style=text-align:center>模板</th><th style=text-align:center>节点数</th><th style=text-align:center>规格</th><th style=text-align:center>说明</th><th style=text-align:center>别名</th></tr></thead><tbody><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/meta.rb>meta.rb</a></td><td style=text-align:center>1 节点</td><td style=text-align:center>2c4g x 1</td><td style=text-align:center>单节点开发箱</td><td style=text-align:center>Devbox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/dual.rb>dual.rb</a></td><td style=text-align:center>2 节点</td><td style=text-align:center>1c2g x 2</td><td style=text-align:center>双节点环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/trio.rb>trio.rb</a></td><td style=text-align:center>3 节点</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>三节点环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/full.rb>full.rb</a></td><td style=text-align:center>4 节点</td><td style=text-align:center>2c4g + 1c2g x 3</td><td style=text-align:center>4 节点完整沙箱</td><td style=text-align:center>Sandbox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/deci.rb>deci.rb</a></td><td style=text-align:center>10 节点</td><td style=text-align:center>混合</td><td style=text-align:center>10 节点环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/simu.rb>simu.rb</a></td><td style=text-align:center>20 节点</td><td style=text-align:center>混合</td><td style=text-align:center>20 节点生产仿真环境</td><td style=text-align:center>Simubox</td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/minio.rb>minio.rb</a></td><td style=text-align:center>4 节点</td><td style=text-align:center>1c2g x 4 + 磁盘</td><td style=text-align:center>MinIO 测试环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/oss.rb>oss.rb</a></td><td style=text-align:center>3 节点</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>3 节点 OSS 构建环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/pro.rb>pro.rb</a></td><td style=text-align:center>5 节点</td><td style=text-align:center>1c2g x 5</td><td style=text-align:center>5 节点 PRO 构建环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/rpm.rb>rpm.rb</a></td><td style=text-align:center>3 节点</td><td style=text-align:center>1c2g x 3</td><td style=text-align:center>3 节点 EL 构建环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/deb.rb>deb.rb</a></td><td style=text-align:center>4 节点</td><td style=text-align:center>1c2g x 4</td><td style=text-align:center>4 节点 Deb 构建环境</td><td style=text-align:center></td></tr><tr><td style=text-align:center><a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/all.rb>all.rb</a></td><td style=text-align:center>7 节点</td><td style=text-align:center>1c2g x 7</td><td style=text-align:center>7 节点全量构建环境</td><td style=text-align:center></td></tr></tbody></table><p>每个规格文件包含一个描述虚拟机节点的 <code>Specs</code> 变量。例如，<code>full.rb</code> 包含 4 节点沙箱的定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#8f5902;font-style:italic># full: pigsty full-featured 4-node sandbox for HA-testing &amp; tutorial &amp; practices</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Specs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;meta&#34;</span>   <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.10&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;4096&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-1&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.11&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-2&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.12&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;node-3&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.13&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;2048&#34;</span> <span style=color:#000;font-weight:700>,</span>  <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h3 id=simu-规格详情>simu 规格详情</h3><p><code>simu.rb</code> 提供了一个 20 节点的生产环境仿真配置：</p><ul><li>3 x infra 节点（<code>meta1-3</code>）：4c16g</li><li>2 x haproxy 节点（<code>proxy1-2</code>）：1c2g</li><li>4 x minio 节点（<code>minio1-4</code>）：1c2g</li><li>5 x etcd 节点（<code>etcd1-5</code>）：1c2g</li><li>6 x pgsql 节点（<code>pg-src-1-3</code>，<code>pg-dst-1-3</code>）：2c4g</li></ul><hr><h2 id=配置脚本>配置脚本</h2><p>使用 <a href=https://github.com/pgsty/pigsty/blob/main/vagrant/config><code>vagrant/config</code></a> 脚本可以根据规格和选项生成最终的 <code>Vagrantfile</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty
</span></span><span style=display:flex><span>vagrant/config <span style=color:#ce5c00;font-weight:700>[</span>spec<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>image<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>scale<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>provider<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 示例</span>
</span></span><span style=display:flex><span>vagrant/config meta                <span style=color:#8f5902;font-style:italic># 使用 1 节点规格，默认 RockyLinux 9.7（EL9）镜像</span>
</span></span><span style=display:flex><span>vagrant/config dual el9            <span style=color:#8f5902;font-style:italic># 使用 2 节点规格，EL9 镜像</span>
</span></span><span style=display:flex><span>vagrant/config trio d12 <span style=color:#0000cf;font-weight:700>2</span>          <span style=color:#8f5902;font-style:italic># 使用 3 节点规格，Debian 12.13 镜像，双倍资源</span>
</span></span><span style=display:flex><span>vagrant/config full u22 <span style=color:#0000cf;font-weight:700>4</span>          <span style=color:#8f5902;font-style:italic># 使用 4 节点规格，Ubuntu 22 镜像，4 倍资源</span>
</span></span><span style=display:flex><span>vagrant/config simu u24 <span style=color:#0000cf;font-weight:700>1</span> libvirt  <span style=color:#8f5902;font-style:italic># 使用 20 节点规格，Ubuntu 24 镜像，libvirt 提供商</span>
</span></span></code></pre></div><h3 id=镜像别名>镜像别名</h3><p>config 脚本支持多种镜像别名：</p><table><thead><tr><th>发行版</th><th>别名</th><th>Vagrant Box</th></tr></thead><tbody><tr><td>AlmaLinux 8</td><td><code>el8</code>, <code>rocky8</code></td><td><code>cloud-image/almalinux-8</code></td></tr><tr><td>Rocky 9</td><td><code>el9</code>, <code>rocky9</code>, <code>el</code></td><td><code>bento/rockylinux-9</code></td></tr><tr><td>AlmaLinux 10</td><td><code>el10</code>, <code>rocky10</code></td><td><code>cloud-image/almalinux-10</code></td></tr><tr><td>Debian 12</td><td><code>d12</code>, <code>debian12</code></td><td><code>cloud-image/debian-12</code></td></tr><tr><td>Debian 13</td><td><code>d13</code>, <code>debian13</code></td><td><code>cloud-image/debian-13</code></td></tr><tr><td>Ubuntu 22.04</td><td><code>u22</code>, <code>ubuntu22</code>, <code>ubuntu</code></td><td><code>cloud-image/ubuntu-22.04</code></td></tr><tr><td>Ubuntu 24.04</td><td><code>u24</code>, <code>ubuntu24</code></td><td><code>bento/ubuntu-24.04</code></td></tr></tbody></table><h3 id=资源缩放>资源缩放</h3><p>您可以使用环境变量 <code>VM_SCALE</code> 来调整资源倍数，默认值为 <code>1</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>VM_SCALE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span> vagrant/config meta     <span style=color:#8f5902;font-style:italic># 将 meta 规格的 CPU/内存资源翻倍</span>
</span></span></code></pre></div><p>例如，使用 <code>VM_SCALE=4</code> 配置 meta 规格，会将默认的 2c4g 调整为 8c16g：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#000>Specs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;meta&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ip&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;10.10.10.10&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;cpu&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;8&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;mem&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;16384&#34;</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;image&#34;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#34;bento/rockylinux-9&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>simu 规格不支持缩放</div><p><code>simu</code> 规格不支持资源缩放，scale 参数会被自动忽略，因为其资源配置已经针对仿真场景优化。</p></div><hr><h2 id=虚拟机管理>虚拟机管理</h2><p>Pigsty 提供了一系列 Makefile 快捷方式来管理虚拟机：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make           <span style=color:#8f5902;font-style:italic># 等于 make start</span>
</span></span><span style=display:flex><span>make new       <span style=color:#8f5902;font-style:italic># 销毁现有虚拟机，创建新的虚拟机</span>
</span></span><span style=display:flex><span>make ssh       <span style=color:#8f5902;font-style:italic># 将虚拟机 SSH 配置写入 ~/.ssh/（创建后必须执行）</span>
</span></span><span style=display:flex><span>make dns       <span style=color:#8f5902;font-style:italic># 将虚拟机 DNS 记录写入 /etc/hosts（可选）</span>
</span></span><span style=display:flex><span>make start     <span style=color:#8f5902;font-style:italic># 启动虚拟机并配置 SSH（up + ssh）</span>
</span></span><span style=display:flex><span>make up        <span style=color:#8f5902;font-style:italic># 使用 vagrant up 启动虚拟机</span>
</span></span><span style=display:flex><span>make halt      <span style=color:#8f5902;font-style:italic># 关闭虚拟机（别名：down, dw）</span>
</span></span><span style=display:flex><span>make clean     <span style=color:#8f5902;font-style:italic># 销毁虚拟机（别名：del, destroy）</span>
</span></span><span style=display:flex><span>make status    <span style=color:#8f5902;font-style:italic># 显示虚拟机状态（别名：st）</span>
</span></span><span style=display:flex><span>make pause     <span style=color:#8f5902;font-style:italic># 暂停虚拟机（别名：suspend）</span>
</span></span><span style=display:flex><span>make resume    <span style=color:#8f5902;font-style:italic># 恢复虚拟机</span>
</span></span><span style=display:flex><span>make nuke      <span style=color:#8f5902;font-style:italic># 使用 virsh 销毁所有虚拟机和卷（仅 libvirt）</span>
</span></span><span style=display:flex><span>make info      <span style=color:#8f5902;font-style:italic># 显示 libvirt 信息（虚拟机、网络、存储卷）</span>
</span></span></code></pre></div><hr><h2 id=ssh-密钥>SSH 密钥</h2><p>Pigsty Vagrant 模板默认使用您的 <code>~/.ssh/id_rsa[.pub]</code> 作为虚拟机的 SSH 密钥。</p><p>在开始之前，请确保您有一个有效的 SSH 密钥对。如果没有，可以使用以下命令生成：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#0000cf;font-weight:700>2048</span> -N <span style=color:#4e9a06>&#39;&#39;</span> -f ~/.ssh/id_rsa -q
</span></span></code></pre></div><hr><h2 id=支持的镜像>支持的镜像</h2><p>Pigsty 目前使用以下 Vagrant Box 进行测试：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># x86_64 / amd64</span>
</span></span><span style=display:flex><span>el8 :  cloud-image/almalinux-8   <span style=color:#ce5c00;font-weight:700>(</span>EL 8.10<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>el9 :  bento/rockylinux-9        <span style=color:#ce5c00;font-weight:700>(</span>RockyLinux 9.7<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>el10:  cloud-image/almalinux-10  <span style=color:#ce5c00;font-weight:700>(</span>RockyLinux 10.1<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d12 :  cloud-image/debian-12     <span style=color:#ce5c00;font-weight:700>(</span>Debian 12.13<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>d13 :  cloud-image/debian-13     <span style=color:#ce5c00;font-weight:700>(</span>Debian 13.3<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>u22 :  cloud-image/ubuntu-22.04
</span></span><span style=display:flex><span>u24 :  bento/ubuntu-24.04
</span></span></code></pre></div><p>对于 Apple Silicon (aarch64) 架构：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># aarch64 / arm64</span>
</span></span><span style=display:flex><span>el8 :  cloud-image/almalinux-8
</span></span><span style=display:flex><span>el9 :  bento/rockylinux-9
</span></span><span style=display:flex><span>el10:  cloud-image/almalinux-10
</span></span><span style=display:flex><span>d12 :  cloud-image/debian-12
</span></span><span style=display:flex><span>d13 :  cloud-image/debian-13
</span></span><span style=display:flex><span>u22 :  cloud-image/ubuntu-22.04
</span></span><span style=display:flex><span>u24 :  bento/ubuntu-24.04
</span></span></code></pre></div><p>您可以在 <a href=https://app.vagrantup.com/boxes/search><strong>Vagrant Cloud</strong></a> 上查找对应 provider / 架构可用的 Box 镜像。</p><hr><h2 id=环境变量>环境变量</h2><p>您可以使用以下环境变量来控制 Vagrant 行为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_SPEC</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;meta&#39;</span>              <span style=color:#8f5902;font-style:italic># 规格名称</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_IMAGE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;bento/rockylinux-9&#39;</span>  <span style=color:#8f5902;font-style:italic># 镜像名称</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_SCALE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;1&#39;</span>                <span style=color:#8f5902;font-style:italic># 资源缩放倍数</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VM_PROVIDER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;virtualbox&#39;</span>    <span style=color:#8f5902;font-style:italic># 虚拟化提供商</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VAGRANT_EXPERIMENTAL</span><span style=color:#ce5c00;font-weight:700>=</span>disks  <span style=color:#8f5902;font-style:italic># 启用实验性磁盘功能</span>
</span></span></code></pre></div><hr><h2 id=注意事项>注意事项</h2><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>VirtualBox 网络配置</div><p>使用较旧版本的 VirtualBox 作为 Vagrant 提供商时，需要额外配置才能使用 <code>10.x.x.x</code> CIDR 作为 Host-Only 网络：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;* 10.0.0.0/8&#34;</span> <span style=color:#000;font-weight:700>|</span> sudo tee -a /etc/vbox/networks.conf
</span></span></code></pre></div></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>第一次下载镜像较慢</div><p>第一次使用 Vagrant 启动特定操作系统时，会下载相应的 Box 镜像文件（通常 1-2 GB）。下载完成后，镜像会被缓存，后续创建虚拟机时会直接复用。</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>libvirt 提供商</div><p>如果您使用 libvirt 作为提供商，可以使用 <code>make info</code> 查看虚拟机、网络和存储卷信息，使用 <code>make nuke</code> 强制销毁所有相关资源。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-87e7f74da392ae65771e6fb357b13c6f>7 - Terraform</h1><div class=lead>使用 Terraform 在公有云上创建虚拟机环境</div><p><a href=https://www.terraform.io/><strong>Terraform</strong></a> 是一个流行的"基础设施即代码"工具，您可以使用它在公有云上一键创建虚拟机。</p><p>Pigsty 提供了阿里云、AWS、腾讯云的 Terraform 模板作为示例。</p><hr><h2 id=快速开始>快速开始</h2><h3 id=安装-terraform>安装 Terraform</h3><p>在 macOS 上，您可以使用 <a href=https://brew.sh/><strong>Homebrew</strong></a> 安装 Terraform：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install terraform
</span></span></code></pre></div><p>其他平台请参考 <a href=https://developer.hashicorp.com/terraform/install><strong>Terraform 官方安装指南</strong></a>。</p><h3 id=初始化与应用>初始化与应用</h3><p>进入 Terraform 目录，选择模板，初始化提供商插件，然后应用配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-meta.tf terraform.tf   <span style=color:#8f5902;font-style:italic># 选择模板</span>
</span></span><span style=display:flex><span>terraform init                         <span style=color:#8f5902;font-style:italic># 安装云提供商插件（首次使用时）</span>
</span></span><span style=display:flex><span>terraform apply                        <span style=color:#8f5902;font-style:italic># 生成执行计划并创建资源</span>
</span></span></code></pre></div><p>运行 <code>apply</code> 命令后，按提示输入 <code>yes</code> 确认，Terraform 将为您创建虚拟机及相关云资源。</p><h3 id=获取-ip-地址>获取 IP 地址</h3><p>创建完成后，打印管理节点的公网 IP 地址：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform output <span style=color:#000;font-weight:700>|</span> grep -Eo <span style=color:#4e9a06>&#39;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&#39;</span>
</span></span></code></pre></div><h3 id=配置-ssh-访问>配置 SSH 访问</h3><p>使用 <code>ssh</code> 脚本自动配置 SSH 别名并分发密钥：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./ssh    <span style=color:#8f5902;font-style:italic># 写入 SSH 配置到 ~/.ssh/pigsty_config 并复制密钥</span>
</span></span></code></pre></div><p>此脚本会将 Terraform 输出的 IP 地址写入 <code>~/.ssh/pigsty_config</code>，并使用默认密码 <code>PigstyDemo4</code> 自动分发 SSH 密钥。</p><p>配置完成后，您可以直接使用主机名登录：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh meta    <span style=color:#8f5902;font-style:italic># 使用主机名而非 IP 登录</span>
</span></span></code></pre></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>使用 SSH 配置文件</div><p>如果您希望使用 <code>~/.ssh/pigsty_config</code> 中的配置，请确保在 <code>~/.ssh/config</code> 中包含以下内容：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Include ~/.ssh/pigsty_config
</span></span></code></pre></div></div><h3 id=销毁资源>销毁资源</h3><p>测试完成后，可以一键销毁所有创建的云资源：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform destroy
</span></span></code></pre></div><hr><h2 id=模板规格>模板规格</h2><p>Pigsty 在 <a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec><code>terraform/spec/</code></a> 目录下提供了多种预定义的云资源模板：</p><table class=full-width><thead><tr><th>模板文件</th><th>云厂商</th><th>说明</th></tr></thead><tbody><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-meta.tf><code>aliyun-meta.tf</code></a></td><td>阿里云</td><td>单节点元节点模板，支持所有发行版和 AMD/ARM（默认）</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-meta-s3.tf><code>aliyun-meta-s3.tf</code></a></td><td>阿里云</td><td>单节点模板 + OSS 存储桶，用于 PITR 备份</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-full.tf><code>aliyun-full.tf</code></a></td><td>阿里云</td><td>4 节点沙箱模板，支持所有发行版和 AMD/ARM</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-oss.tf><code>aliyun-oss.tf</code></a></td><td>阿里云</td><td>5 节点构建模板，支持所有发行版和 AMD/ARM</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aliyun-pro.tf><code>aliyun-pro.tf</code></a></td><td>阿里云</td><td>多发行版测试模板，用于跨操作系统测试</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/aws-cn.tf><code>aws-cn.tf</code></a></td><td>AWS</td><td>AWS 中国区 4 节点环境</td></tr><tr><td><a href=https://github.com/pgsty/pigsty/tree/main/terraform/spec/tencentcloud.tf><code>tencentcloud.tf</code></a></td><td>腾讯云</td><td>腾讯云 4 节点环境</td></tr></tbody></table><p>使用模板时，将模板文件复制为 <code>terraform.tf</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>cp spec/aliyun-full.tf terraform.tf   <span style=color:#8f5902;font-style:italic># 使用阿里云 4 节点沙箱模板</span>
</span></span><span style=display:flex><span>terraform init <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> terraform apply
</span></span></code></pre></div><hr><h2 id=变量配置>变量配置</h2><p>Pigsty 的 Terraform 模板使用变量来控制架构、操作系统发行版和资源配置：</p><h3 id=架构与发行版>架构与发行版</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>variable</span> <span style=color:#4e9a06>&#34;architecture&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  description</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;架构类型 (amd64 或 arm64)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  type</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000>  default</span>     <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;amd64&#34;</span><span style=color:#8f5902;font-style:italic>    # 注释此行以使用 arm64
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  #default     = &#34;arm64&#34;   # 取消注释以使用 arm64
</span></span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>variable</span> <span style=color:#4e9a06>&#34;distro&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  description</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;发行版代码 (el8,el9,el10,u22,u24,d12,d13)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  type</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000>  default</span>     <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;el9&#34;</span><span style=color:#8f5902;font-style:italic>       # 默认使用 Rocky Linux 9
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=资源配置>资源配置</h3><p>在 <code>locals</code> 块中可以配置以下资源参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>locals</span> {
</span></span><span style=display:flex><span><span style=color:#000>  bandwidth</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>100</span><span style=color:#8f5902;font-style:italic>                    # 公网带宽 (Mbps)
</span></span></span><span style=display:flex><span><span style=color:#000>  disk_size</span>        <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>40</span><span style=color:#8f5902;font-style:italic>                     # 系统盘大小 (GB)
</span></span></span><span style=display:flex><span><span style=color:#000>  spot_policy</span>      <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;SpotWithPriceLimit&#34;</span><span style=color:#8f5902;font-style:italic>   # 竞价策略：NoSpot, SpotWithPriceLimit, SpotAsPriceGo
</span></span></span><span style=display:flex><span><span style=color:#000>  spot_price_limit</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#8f5902;font-style:italic>                      # 最高竞价价格 (仅在 SpotWithPriceLimit 时有效)
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=阿里云配置>阿里云配置</h2><h3 id=凭证设置>凭证设置</h3><p>将您的阿里云凭证添加到环境变量中，例如在 <code>~/.bash_profile</code> 或 <code>~/.zshrc</code> 中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_ACCESS_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_access_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_SECRET_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ALICLOUD_REGION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;cn-shanghai&#34;</span>
</span></span></code></pre></div><h3 id=支持的镜像>支持的镜像</h3><p>以下是阿里云中常用的 <a href=https://help.aliyun.com/zh/ecs/user-guide/public-mirroring-overview><strong>ECS 公共操作系统镜像</strong></a> 前缀：</p><table class=full-width><thead><tr><th>发行版</th><th>代码</th><th>x86_64 镜像前缀</th><th>aarch64 镜像前缀</th></tr></thead><tbody><tr><td>CentOS 7.9</td><td><code>el7</code></td><td><code>centos_7_9_x64</code></td><td>-</td></tr><tr><td>Rocky 8.10</td><td><code>el8</code></td><td><code>rockylinux_8_10_x64</code></td><td><code>rockylinux_8_10_arm64</code></td></tr><tr><td>Rocky 9.7</td><td><code>el9</code></td><td><code>rockylinux_9_7_x64</code></td><td><code>rockylinux_9_7_arm64</code></td></tr><tr><td>Rocky 10.1</td><td><code>el10</code></td><td><code>rockylinux_10_1_x64</code></td><td><code>rockylinux_10_1_arm64</code></td></tr><tr><td>Debian 11.11</td><td><code>d11</code></td><td><code>debian_11_11_x64</code></td><td>-</td></tr><tr><td>Debian 12.13</td><td><code>d12</code></td><td><code>debian_12_13_x64</code></td><td><code>debian_12_13_arm64</code></td></tr><tr><td>Debian 13.3</td><td><code>d13</code></td><td><code>debian_13_3_x64</code></td><td><code>debian_13_3_arm64</code></td></tr><tr><td>Ubuntu 20.04</td><td><code>u20</code></td><td><code>ubuntu_20_04_x64</code></td><td>-</td></tr><tr><td>Ubuntu 22.04</td><td><code>u22</code></td><td><code>ubuntu_22_04_x64_20G</code></td><td><code>ubuntu_22_04_arm64_20G</code></td></tr><tr><td>Ubuntu 24.04</td><td><code>u24</code></td><td><code>ubuntu_24_04_x64_20G</code></td><td><code>ubuntu_24_04_arm64_20G</code></td></tr><tr><td>Anolis 8.9</td><td><code>an8</code></td><td><code>anolisos_8_9_x64</code></td><td>-</td></tr><tr><td>Alibaba Cloud Linux 3</td><td><code>al3</code></td><td><code>aliyun_3_0_x64</code></td><td>-</td></tr></tbody></table><h3 id=oss-存储配置>OSS 存储配置</h3><p><code>aliyun-meta-s3.tf</code> 模板会额外创建 OSS 存储桶及相关权限，用于 PostgreSQL 的 PITR 备份：</p><ul><li><strong>OSS Bucket</strong>：创建名为 <code>pigsty-oss</code> 的私有存储桶</li><li><strong>RAM 用户</strong>：创建专用的 <code>pigsty-oss-user</code> 用户</li><li><strong>访问密钥</strong>：生成 AccessKey 并保存到 <code>~/pigsty.sk</code></li><li><strong>IAM 策略</strong>：授予对存储桶的完全访问权限</li></ul><hr><h2 id=aws-配置>AWS 配置</h2><h3 id=凭证设置-1>凭证设置</h3><p>设置 AWS 配置和凭证文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ~/.aws/config</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>region</span> <span style=color:#ce5c00;font-weight:700>=</span> cn-northwest-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ~/.aws/credentials</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> &lt;YOUR_AWS_ACCESS_KEY&gt;
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> &lt;AWS_ACCESS_SECRET&gt;
</span></span></code></pre></div><p>如果需要使用 SSH 密钥，将密钥文件放置在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/.aws/pigsty-key
</span></span><span style=display:flex><span>~/.aws/pigsty-key.pub
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>AWS 模板需要调整</div><p>AWS 模板是社区贡献的示例，可能需要根据您的具体需求进行调整。</p></div><hr><h2 id=腾讯云配置>腾讯云配置</h2><h3 id=凭证设置-2>凭证设置</h3><p>将腾讯云凭证添加到环境变量中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_SECRET_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_id&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_SECRET_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;your_secret_key&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>TENCENTCLOUD_REGION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ap-beijing&#34;</span>
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>腾讯云模板需要调整</div><p>腾讯云模板是社区贡献的示例，可能需要根据您的具体需求进行调整。</p></div><hr><h2 id=快捷命令>快捷命令</h2><p>Pigsty 提供了一些 Makefile 快捷命令用于 Terraform 操作：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/pigsty/terraform
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make u          <span style=color:#8f5902;font-style:italic># terraform apply -auto-approve + 配置 SSH</span>
</span></span><span style=display:flex><span>make d          <span style=color:#8f5902;font-style:italic># terraform destroy -auto-approve</span>
</span></span><span style=display:flex><span>make apply      <span style=color:#8f5902;font-style:italic># terraform apply（交互式确认）</span>
</span></span><span style=display:flex><span>make destroy    <span style=color:#8f5902;font-style:italic># terraform destroy（交互式确认）</span>
</span></span><span style=display:flex><span>make out        <span style=color:#8f5902;font-style:italic># terraform output</span>
</span></span><span style=display:flex><span>make ssh        <span style=color:#8f5902;font-style:italic># 运行 ssh 脚本配置 SSH 访问</span>
</span></span><span style=display:flex><span>make r          <span style=color:#8f5902;font-style:italic># 重置 terraform.tf 到版本库状态</span>
</span></span></code></pre></div><hr><h2 id=注意事项>注意事项</h2><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>云资源费用</div><p>使用 Terraform 创建的云资源会产生费用。测试完成后，请及时使用 <code>terraform destroy</code> 销毁资源，避免不必要的开支。</p><p>建议使用按量付费的实例类型进行测试。模板默认使用竞价实例（Spot Instance）以降低成本。</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>默认密码</div><p>所有模板中虚拟机的默认 root 密码为 <code>PigstyDemo4</code>。在生产环境中，请务必修改此密码或使用 SSH 密钥认证。</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>安全组配置</div><p>Terraform 模板会自动创建安全组并开放必要的端口（默认开放所有 TCP 端口）。在生产环境中，请根据实际需求调整安全组规则，遵循最小权限原则。</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>SSH 访问</div><p>创建完成后，使用以下命令 SSH 登录到管理节点：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@&lt;public_ip&gt;
</span></span></code></pre></div><p>您也可以使用 <code>./ssh</code> 或 <code>make ssh</code> 将 SSH 别名写入配置文件，然后使用 <code>ssh pg-meta</code> 登录。</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8783a52d352cd41160ffaa5b596ca07f>8 - 安全考量</h1><div class=lead>Pigsty 部署中与安全有关的考量</div><p>Pigsty 的默认配置已经足以覆盖绝大多数场景对于安全的需求。</p><p>Pigsty 已经提供了开箱即用的 <a href=/docs/pgsql/config/hba>认证</a> 与 <a href=/docs/concept/sec/ac/>访问控制</a> 模型，对于绝大多数场景已经足够安全。</p><p><a href=/docs/concept/sec/ac/><img src=/img/pigsty/acl.jpg alt=pigsty-acl.jpg></a></p><p>如果您希望进一步加固系统的安全性，那么以下建议供您参考：</p><hr><h2 id=机密性>机密性</h2><h3 id=重要文件>重要文件</h3><p><strong>保护你的 pigsty.yml 配置文件或CMDB</strong></p><ul><li><code>pigsty.yml</code> 配置文件通常包含了高度敏感的机密信息，您应当确保它的安全。</li><li>严格控制管理节点的访问权限，仅限 DBA 或者 Infra 管理员访问。</li><li>严格控制 pigsty.yml 配置文件仓库的访问权限（如果您使用 git 进行管理）</li></ul><p><strong>保护你的 CA 私钥和其他证书，这些文件非常重要。</strong></p><ul><li>相关文件默认会在管理节点Pigsty源码目录的 <code>files/pki</code> 内生成。</li><li>你应该定期将它们备份到一个安全的地方存储。</li></ul><br><hr><h3 id=密码>密码</h3><p><strong>在生产环境部署时，必须更改这些密码，不要使用默认值！</strong></p><ul><li><a href=/docs/infra/param#grafana_admin_password><strong><code>grafana_admin_password</code></strong></a> : <code>pigsty</code></li><li><a href=/docs/pgsql/param#pg_admin_password><strong><code>pg_admin_password</code></strong></a> : <code>DBUser.DBA</code></li><li><a href=/docs/pgsql/param#pg_monitor_password><strong><code>pg_monitor_password</code></strong></a> : <code>DBUser.Monitor</code></li><li><a href=/docs/pgsql/param#pg_replication_password><strong><code>pg_replication_password</code></strong></a> : <code>DBUser.Replicator</code></li><li><a href=/docs/pgsql/param#patroni_password><strong><code>patroni_password</code></strong></a> : <code>Patroni.API</code></li><li><a href=/docs/node/param#haproxy_admin_password><strong><code>haproxy_admin_password</code></strong></a> : <code>pigsty</code></li><li><a href=/docs/minio/param#minio_access_key><strong><code>minio_access_key</code></strong></a> : <code>minioadmin</code></li><li><a href=/docs/minio/param#minio_secret_key><strong><code>minio_secret_key</code></strong></a> : <code>minioadmin</code></li></ul><p><strong>如果您使用MinIO，请修改MinIO的默认用户密码，与pgbackrest中的引用</strong></p><ul><li>请修改 MinIO 普通用户的密码：<a href=/docs/minio/param#minio_users><strong><code>minio_users</code></strong><code>.</code>[pgbacrest]<code>.</code>secret_key`</a></li><li>请修改 pgbackrest 中对 MinIO 使用的备份用户密码：<a href=/docs/pgsql/param#pgbackrest_repo><strong><code>pgbackrest_repo</code></strong><code>.</code>minio<code>.</code>s3_key_secret`</a></li></ul><p><strong>如果您使用远程备份仓库，请务必启用备份加密，并设置加解密密码</strong></p><ul><li>设置 [<strong><code>pgbackrest_repo</code></strong><code>.</code>*<code>.</code>cipher_type<code>](/docs/pgsql/param#pgbackrest_repo) 为 </code>aes-256-cbc`</li><li>设置密码时可以使用 <code>${pg_cluster}</code> 作为密码的一部分，避免所有集群使用同一个密码</li></ul><p><strong>为 PostgreSQL 使用安全可靠的密码加密算法</strong></p><ul><li>使用 <a href=/docs/pgsql/param#pg_pwd_enc><strong><code>pg_pwd_enc</code></strong></a> 默认值 <code>scram-sha-256</code> 替代传统的 <code>md5</code></li><li>这是默认行为，如果没有特殊理由（出于对历史遗留老旧客户端的支持），请不要将其修改回 <code>md5</code></li></ul><p><strong>使用 <code>passwordcheck</code> 扩展强制执行强密码</strong>。</p><ul><li>在 <a href=/docs/pgsql/param#pg_libs><strong><code>pg_libs</code></strong></a> 中添加 <code>$lib/passwordcheck</code> 来强制密码策略。</li></ul><p><strong>使用加密算法加密远程备份</strong></p><ul><li>在 <a href=/docs/pgsql/param#pgbackrest_repo><strong><code>pgbackrest_repo</code></strong></a> 的备份仓库定义中使用 <code>repo_cipher_type</code> 启用加密</li></ul><p><strong>为业务用户配置密码自动过期实践</strong></p><ul><li><p>你应当为每个 <a href=/docs/pgsql/config/user#%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7>业务用户</a> 设置一个密码自动过期时间，以满足合规要求。</p></li><li><p>配置自动过期后，请不要忘记在巡检时定期更新这些密码。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_meta , password: Pleas3-ChangeThisPwd ,expire_in: 7300 ,pgbouncer: true ,roles: [ dbrole_admin ]    ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pigsty admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_view , password: Make.3ure-Compl1ance  ,expire_in: 7300 ,pgbouncer: true ,roles: [ dbrole_readonly ] ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>read-only viewer for meta database }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: postgres     ,superuser: true  ,expire_in: 7300                        ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system superuser }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: replicator ,replication: true  ,expire_in: 7300 ,roles: [pg_monitor, dbrole_readonly]   ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>system replicator }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_dba   ,superuser: true  ,expire_in: 7300 ,roles: [dbrole_admin]  ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 , comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql admin user }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: dbuser_monitor ,roles: [pg_monitor] ,expire_in: 7300 ,pgbouncer: true ,parameters</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#204a87;font-weight:700>log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql monitor user }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li></ul><p><strong>不要将更改密码的语句记录到 postgres 日志或其他日志中</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SET log_statement TO <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>ALTER USER <span style=color:#4e9a06>&#34;{{ user.name }}&#34;</span> PASSWORD <span style=color:#4e9a06>&#39;{{ user.password }}&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>SET log_statement TO DEFAULT<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><br><hr><h3 id=ip地址>IP地址</h3><p><strong>为 postgres/pgbouncer/patroni 绑定指定的 IP 地址，而不是所有地址。</strong></p><ul><li>默认的 <a href=/docs/pgsql/param#pg_listen><strong><code>pg_listen</code></strong></a> 地址是 <code>0.0.0.0</code>，即所有 IPv4 地址。</li><li>考虑使用 <code>pg_listen: '${ip},${vip},${lo}'</code> 绑定到特定IP地址（列表）以增强安全性。</li></ul><p><strong>不要将任何端口直接暴露到公网IP上，除了基础设施出口Nginx使用的端口（默认80/443）</strong></p><ul><li>出于便利考虑，Prometheus/Grafana 等组件默认监听所有IP地址，可以直接从公网IP端口访问</li><li>您可以修改它们的配置文件，只监听内网IP地址，限制其只能通过 Nginx 门户通过域名访问，你也可以当使用安全组，防火墙规则来实现这些安全限制。</li><li>出于便利考虑，Redis服务器默认监听所有IP地址，您可以修改 <a href=/docs/redis/param#redis_bind_address><strong><code>redis_bind_address</code></strong></a> 只监听内网IP地址。</li></ul><p><strong>使用 <a href=/docs/pgsql/config/hba>HBA</a> 限制 postgres 客户端访问</strong></p><ul><li>有一个增强安全性的配置模板：<a href=https://github.com/pgsty/pigsty/blob/main/conf/demo/security.yml><code>security.yml</code></a></li></ul><p><strong>限制 patroni 管理访问权限：仅 infra/admin 节点可调用控制API</strong></p><ul><li>默认情况下，这是通过 <a href=https://github.com/pgsty/pigsty/blob/main/roles/pgsql/templates/oltp.yml#L109><code>restapi.allowlist</code></a> 限制的。</li></ul><br><hr><h3 id=网络流量>网络流量</h3><p><strong>使用 SSL 和域名，通过Nginx访问基础设施组件</strong></p><ul><li>Nginx SSL 由 <a href=/docs/infra/param#nginx_sslmode><strong><code>nginx_sslmode</code></strong></a> 控制，默认为 <code>enable</code>。</li><li>Nginx 域名由 <a href=/docs/infra/param#infra_portal><strong><code>infra_portal</code></strong><code>.</code><component><code>.</code>domain</a> 指定。</li></ul><p><strong>使用 SSL 保护 Patroni REST API</strong></p><ul><li><a href=/docs/pgsql/param#patroni_ssl_enabled><strong><code>patroni_ssl_enabled</code></strong></a> 默认为禁用。</li><li>由于它会影响健康检查和 API 调用。</li><li>注意这是一个全局选项，在部署前你必须做出决定。</li></ul><p><strong>使用 SSL 保护 Pgbouncer 客户端流量</strong></p><ul><li><a href=/docs/pgsql/param#pgbouncer_sslmode><strong><code>pgbouncer_sslmode</code></strong></a> 默认为 <code>disable</code></li><li>它会对 Pgbouncer 有显著的性能影响，所以这里是默认关闭的。</li></ul><hr><h2 id=完整性>完整性</h2><p><strong>为关键场景下的 PostgreSQL 数据库集群配置一致性优先模式（例如与钱相关的库）</strong></p><ul><li><a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> 数据库调优模板，使用 <code>crit.yml</code> 将以一些可用性为代价，换取最佳的数据一致性。</li></ul><p><strong>使用crit节点调优模板，以获得更好的一致性。</strong></p><ul><li><a href=/docs/node/param#node_tune><strong><code>node_tune</code></strong></a> 主机调优模板使用 <code>crit</code> ，可以以减少脏页比率，降低数据一致性风险。</li></ul><p><strong>启用数据校验和，以检测静默数据损坏。</strong></p><ul><li><a href=/docs/pgsql/param#pg_checksum><strong><code>pg_checksum</code></strong></a> 默认为 <code>off</code>，但建议开启。</li><li>当启用 <a href=/docs/pgsql/param#pg_conf><strong><code>pg_conf</code></strong></a> = <code>crit.yml</code> 数据库模板时，校验和是强制开启的。</li></ul><p><strong>记录建立/切断连接的日志</strong></p><ul><li>该配置默认关闭，但在 <code>crit.yml</code> 配置模板中是默认启用的。</li><li>可以手工 <a href=/docs/pgsql/admin/cluster#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4>配置集群</a>，启用 <code>log_connections</code> 和 <code>log_disconnections</code> 功能参数。</li></ul><p><strong>如果您希望彻底杜绝PG集群在故障转移时脑裂的可能性，请启用watchdog</strong></p><ul><li>如果你的流量走默认推荐的 HAProxy 分发，那么即使你不启用 watchdog，你也不会遇到脑裂的问题。</li><li>如果你的机器假死，Patroni 被 <code>kill -9</code> 杀死，那么 watchdog 可以用来兜底：超时自动关机。</li><li>最好不要在基础设施节点上启用 watchdog。</li></ul><hr><h2 id=可用性>可用性</h2><p><strong>对于关键场景的PostgreSQL数据库集群，请使用足够的节点/实例数量</strong></p><ul><li>你至少需要三个节点（能够容忍一个节点的故障）来实现生产级的高可用性。</li><li>如果你只有两个节点，你可以容忍特定备用节点的故障。</li><li>如果你只有一个节点，请使用外部的 S3/MinIO 进行冷备份和 WAL 归档存储。</li></ul><p><strong>对于 PostgreSQL，在可用性和一致性之间进行权衡</strong></p><ul><li><a href=/docs/pgsql/param#pg_rpo><strong><code>pg_rpo</code></strong></a> : <strong>可用性与一致性之间的权衡</strong></li><li><a href=/docs/pgsql/param#pg_rto><strong><code>pg_rto</code></strong></a> : <strong>故障概率与影响之间的权衡</strong></li></ul><p><strong>不要直接通过固定的 IP 地址访问数据库；请使用 VIP、DNS、HAProxy 或它们的排列组合</strong></p><ul><li>使用 HAProxy 进行服务 <a href=/docs/pgsql/service/#%E6%8E%A5%E5%85%A5%E6%9C%8D%E5%8A%A1>接入</a></li><li>在故障切换/主备切换的情况下，Haproxy 将处理客户端的流量切换。</li></ul><p><strong>在重要的生产部署中使用多个基础设施节点（例如，1~3）</strong></p><ul><li>小规模部署或要求宽松的场景，可以使用单一基础设施节点 / 管理节点。</li><li>大型生产部署建议设置至少两个基础设施节点互为备份。</li></ul><p><strong>使用足够数量的 etcd 服务器实例，并使用奇数个实例（1,3,5,7）</strong></p><ul><li>查看 <a href=/docs/etcd/admin>ETCD 管理</a> 了解详细信息。</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>