<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/vibe/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/vibe/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>模块：VIBE | PIGSTY</title><meta name=description content="使用 Pigsty 部署 AI 编程沙箱：Code-Server、JupyterLab、Node.js 与 Claude Code。"><meta property="og:url" content="https://pigsty.cc/docs/vibe/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="模块：VIBE"><meta property="og:description" content="使用 Pigsty 部署 AI 编程沙箱：Code-Server、JupyterLab、Node.js 与 Claude Code。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="模块：VIBE"><meta itemprop=description content="使用 Pigsty 部署 AI 编程沙箱：Code-Server、JupyterLab、Node.js 与 Claude Code。"><meta itemprop=dateModified content="2026-02-14T08:23:56+08:00"><meta itemprop=wordCount content="127"><meta itemprop=keywords content="参考,VIBE"><meta name=twitter:card content="summary"><meta name=twitter:title content="模块：VIBE"><meta name=twitter:description content="使用 Pigsty 部署 AI 编程沙箱：Code-Server、JupyterLab、Node.js 与 Claude Code。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/vibe/>返回本页常规视图</a>.</p></div><h1 class=title>模块：VIBE</h1><div class=lead>使用 Pigsty 部署 AI 编程沙箱：Code-Server、JupyterLab、Node.js 与 Claude Code。</div><ul><li>1: <a href=#pg-9772cdadc60dd7dd14996e513d75b339>功能配置</a></li><li>2: <a href=#pg-a5dab958a3571315aa55b2d678019dc1>参数列表</a></li><li>3: <a href=#pg-d043f12092a8799b8bcf196d58b9f5cc>预置剧本</a></li><li>4: <a href=#pg-282572ee13c89d763e4238802ddd4705>管理预案</a></li><li>5: <a href=#pg-b864c1860bfd1307001787cb291f673b>监控告警</a></li><li>6: <a href=#pg-129db311a07ef375ea35b82ce6714049>常见问题</a></li></ul><div class=content><p>VIBE 模块提供一套 <strong>浏览器化开发环境</strong>，包含 Code-Server、JupyterLab、Node.js 与 Claude Code 的协同配置，
并可与 <a href=/docs/juice><code>JUICE</code></a> 共享存储和 <a href=/docs/pgsql><code>PGSQL</code></a> 数据库能力配合使用。</p><p>VIBE 依赖 <a href=/docs/node><code>NODE</code></a> 与 <a href=/docs/infra><code>INFRA</code></a>：</p><ul><li><code>NODE</code> 负责基础软件与 Python <code>uv</code> 环境</li><li><code>INFRA</code> 提供 Nginx 反向代理、Grafana 等可视化入口</li></ul><hr><h2 id=组件一览>组件一览</h2><table class=full-width><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>说明</th><th style=text-align:center>本地端口</th><th style=text-align:left>访问路径</th></tr></thead><tbody><tr><td style=text-align:left>Code-Server</td><td style=text-align:left>VS Code 浏览器版</td><td style=text-align:center>8443</td><td style=text-align:left><code>/code/</code></td></tr><tr><td style=text-align:left>JupyterLab</td><td style=text-align:left>交互式 Notebook</td><td style=text-align:center>8888</td><td style=text-align:left><code>/jupyter/</code></td></tr><tr><td style=text-align:left>Node.js</td><td style=text-align:left>运行时与 npm</td><td style=text-align:center>-</td><td style=text-align:left>CLI</td></tr><tr><td style=text-align:left>Claude Code</td><td style=text-align:left>CLI + 可观测性配置</td><td style=text-align:center>-</td><td style=text-align:left>CLI / Grafana</td></tr></tbody></table><p>说明：</p><ul><li>Code-Server 仅监听 <code>127.0.0.1:8443</code>，通过 Nginx 暴露</li><li>JupyterLab 监听 <code>0.0.0.0:8888</code>，默认基路径为 <code>/jupyter/</code></li><li>模块默认 <code>jupyter_enabled: false</code>，而 <code>conf/vibe.yml</code> 模板会显式开启 Jupyter</li></ul><hr><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure -c vibe
</span></span><span style=display:flex><span>./deploy.yml        <span style=color:#8f5902;font-style:italic># 部署 NODE + INFRA + PGSQL</span>
</span></span><span style=display:flex><span>./juice.yml         <span style=color:#8f5902;font-style:italic># 可选，部署共享存储</span>
</span></span><span style=display:flex><span>./vibe.yml          <span style=color:#8f5902;font-style:italic># 部署 VIBE</span>
</span></span></code></pre></div><p>默认访问入口（通过 <code>infra_portal.home</code>）：</p><ul><li>Code-Server：<code>https://&lt;domain>/code/</code></li><li>JupyterLab：<code>https://&lt;domain>/jupyter/</code></li><li>Claude Dashboard：<code>https://&lt;domain>/ui/d/claude-code</code></li></ul><hr><h2 id=模块特点>模块特点</h2><ul><li><strong>统一工作区</strong>：<code>vibe_data</code> 作为 Code-Server 与 Jupyter 的根目录</li><li><strong>可选共享存储</strong>：配合 <code>JUICE</code> 实现多节点共享</li><li><strong>可观测性</strong>：Claude Code OpenTelemetry 默认对接 VictoriaMetrics/VictoriaLogs</li><li><strong>可组件化</strong>：Code/Jupyter/Node.js/Claude 可按需启用</li></ul><hr><h2 id=文档目录>文档目录</h2><ul><li><a href=/docs/vibe/config><strong>配置说明</strong></a>：组件配置与工作目录设置</li><li><a href=/docs/vibe/param><strong>参数详解</strong></a>：VIBE 参数列表与默认值</li><li><a href=/docs/vibe/playbook><strong>剧本说明</strong></a>：<code>vibe.yml</code> 使用与标签</li><li><a href=/docs/vibe/admin><strong>管理手册</strong></a>：运维、密码与扩展管理</li><li><a href=/docs/vibe/monitor><strong>监控集成</strong></a>：Claude Code 监控与日志</li><li><a href=/docs/vibe/faq><strong>常见问题</strong></a>：FAQ</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9772cdadc60dd7dd14996e513d75b339>1 - 功能配置</h1><div class=lead>VIBE 模块配置说明（Code-Server、JupyterLab、Node.js 与 Claude Code）。</div><p>VIBE 模块支持按需启用组件，并通过统一的工作目录和 Nginx 入口对外提供服务。</p><hr><h2 id=配置概览>配置概览</h2><table class=full-width><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>启用参数</th><th style=text-align:center>默认状态</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>Code-Server</td><td style=text-align:left><code>code_enabled</code></td><td style=text-align:center>启用</td><td style=text-align:left>浏览器 VS Code</td></tr><tr><td style=text-align:left>JupyterLab</td><td style=text-align:left><code>jupyter_enabled</code></td><td style=text-align:center>禁用</td><td style=text-align:left>Notebook/终端/编辑器</td></tr><tr><td style=text-align:left>Node.js</td><td style=text-align:left><code>nodejs_enabled</code></td><td style=text-align:center>启用</td><td style=text-align:left>Node.js 运行时与 npm</td></tr><tr><td style=text-align:left>Claude Code</td><td style=text-align:left><code>claude_enabled</code></td><td style=text-align:center>启用</td><td style=text-align:left>CLI 配置与可观测性</td></tr></tbody></table><p>说明：模块默认 <code>jupyter_enabled: false</code>，但 <code>conf/vibe.yml</code> 预置模板会显式设置为 <code>true</code>。</p><p>配置通常位于集群 <code>vars</code>，也可以在实例级别覆盖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>all</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>children</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>infra</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>vibe_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>code_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>jupyter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>claude_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=工作目录>工作目录</h2><p><code>vibe_data</code> 作为 VIBE 的统一工作区：</p><ul><li>Code-Server 默认打开目录</li><li>JupyterLab <code>root_dir</code></li><li>Claude Code 的工作目录</li><li><code>CLAUDE.md</code> / <code>AGENTS.md</code> 上下文文件</li></ul><p><code>vibe_dir</code> 任务会创建目录并写入上下文文件，文件属主为 <code>node_user</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vibe_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/fs</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=code-server-配置>Code-Server 配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8443</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/code</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Vibe.Coding</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_gallery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>openvsx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>说明：</p><ul><li>服务监听 <code>127.0.0.1:&lt;code_port></code>（默认 8443），通过 Nginx <code>/code/</code> 访问</li><li>配置文件：<code>code_data/code-server/config.yaml</code>（默认 <code>/data/code/code-server/config.yaml</code>）</li><li>环境文件：<code>/etc/default/code</code>，用于配置扩展市场</li></ul><p>扩展市场：</p><ul><li><code>code_gallery: microsoft</code> 使用微软官方市场</li><li><code>region=china</code> 时默认切换 Open VSX 清华镜像</li></ul><hr><h2 id=jupyterlab-配置>JupyterLab 配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8888</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/jupyter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Vibe.Coding</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_venv</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/venv</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>说明：</p><ul><li>服务监听 <code>0.0.0.0:&lt;jupyter_port></code>（默认 8888），基路径为 <code>/jupyter/</code></li><li>配置文件：<code>jupyter_data/jupyter_config.py</code>（默认 <code>/data/jupyter/jupyter_config.py</code>）</li><li>登录 Token：<code>c.IdentityProvider.token</code></li><li><strong>不会自动创建 venv</strong>，建议通过 <code>NODE</code> 模块的 <code>node_uv_env</code> 预先创建</li></ul><p>创建 venv 示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv venv /data/venv
</span></span></code></pre></div><hr><h2 id=nodejs-配置>Node.js 配置</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodejs_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodejs_registry</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>npm_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#4e9a06>&#39;@anthropic-ai/claude-code&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#000>happy-coder</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>说明：</p><ul><li><code>nodejs_registry</code> 为空时，<code>region=china</code> 会自动使用 <code>https://registry.npmmirror.com</code></li><li><code>npm_packages</code> 通过 <code>npm install -g</code> 安装，全局可用</li><li>默认会安装 <code>@anthropic-ai/claude-code</code>，因此通常无需手工安装 Claude CLI</li></ul><hr><h2 id=claude-code-配置>Claude Code 配置</h2><p><code>claude</code> 子任务仅进行<strong>配置写入</strong>（<code>claude_config</code>）。
Claude CLI 在默认情况下由 <code>nodejs</code> 子任务通过 <code>npm_packages</code> 安装（包含 <code>@anthropic-ai/claude-code</code>）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>claude_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>claude_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ANTHROPIC_API_KEY</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sk-ant-xxx</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>如果你禁用了 <code>nodejs_enabled</code> 或清空了 <code>npm_packages</code>，则需要手工安装 Claude CLI。</p><p>生成的文件：</p><ul><li><code>~/.claude.json</code></li><li><code>~/.claude/settings.json</code></li></ul><p><code>claude_env</code> 会与默认 OpenTelemetry 环境变量合并，默认上报到 VictoriaMetrics / VictoriaLogs。</p><hr><h2 id=nginx-入口>Nginx 入口</h2><p>VIBE 通过 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 暴露服务。
默认 <code>home</code> 域名自动包含 <code>/code/</code> 与 <code>/jupyter/</code> 子路径。</p><p>如需独立域名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>code</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: code.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8443&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>jupyter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: jupyter.pigsty, endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;127.0.0.1:8888&#34;</span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a5dab958a3571315aa55b2d678019dc1>2 - 参数列表</h1><div class=lead>VIBE 模块参数详解（共 16 项）。</div><p>VIBE 模块共有 <strong>16</strong> 个参数，分为：</p><ul><li>通用参数</li><li>Code-Server 参数</li><li>JupyterLab 参数</li><li>Node.js 参数</li><li>Claude Code 参数</li></ul><hr><h2 id=参数概览>参数概览</h2><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>默认值</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#vibe_data><code>vibe_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>/fs</code></td><td style=text-align:left>工作目录</td></tr><tr><td style=text-align:left><a href=#code_enabled><code>code_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>启用 Code-Server</td></tr><tr><td style=text-align:left><a href=#code_port><code>code_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>8443</code></td><td style=text-align:left>Code-Server 端口</td></tr><tr><td style=text-align:left><a href=#code_data><code>code_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>/data/code</code></td><td style=text-align:left>Code-Server 数据目录</td></tr><tr><td style=text-align:left><a href=#code_password><code>code_password</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>Vibe.Coding</code></td><td style=text-align:left>Code-Server 密码</td></tr><tr><td style=text-align:left><a href=#code_gallery><code>code_gallery</code></a></td><td style=text-align:center><code>enum</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>openvsx</code></td><td style=text-align:left>扩展市场</td></tr><tr><td style=text-align:left><a href=#jupyter_enabled><code>jupyter_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>启用 JupyterLab</td></tr><tr><td style=text-align:left><a href=#jupyter_port><code>jupyter_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>8888</code></td><td style=text-align:left>JupyterLab 端口</td></tr><tr><td style=text-align:left><a href=#jupyter_data><code>jupyter_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>/data/jupyter</code></td><td style=text-align:left>JupyterLab 数据目录</td></tr><tr><td style=text-align:left><a href=#jupyter_password><code>jupyter_password</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>Vibe.Coding</code></td><td style=text-align:left>JupyterLab Token</td></tr><tr><td style=text-align:left><a href=#jupyter_venv><code>jupyter_venv</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>/data/venv</code></td><td style=text-align:left>Python venv 路径</td></tr><tr><td style=text-align:left><a href=#nodejs_enabled><code>nodejs_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>启用 Node.js</td></tr><tr><td style=text-align:left><a href=#nodejs_registry><code>nodejs_registry</code></a></td><td style=text-align:center><code>url</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>''</code></td><td style=text-align:left>npm 镜像地址</td></tr><tr><td style=text-align:left><a href=#npm_packages><code>npm_packages</code></a></td><td style=text-align:center><code>string[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>['@anthropic-ai/claude-code','happy-coder']</code></td><td style=text-align:left>全局 npm 包</td></tr><tr><td style=text-align:left><a href=#claude_enabled><code>claude_enabled</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>启用 Claude 配置</td></tr><tr><td style=text-align:left><a href=#claude_env><code>claude_env</code></a></td><td style=text-align:center><code>dict</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left><code>{}</code></td><td style=text-align:left>Claude 环境变量</td></tr></tbody></table><hr><h2 id=默认参数>默认参数</h2><p>定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/vibe/defaults/main.yml><code>roles/vibe/defaults/main.yml</code></a>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>vibe_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8443</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/code</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Vibe.Coding</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_gallery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;openvsx&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8888</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/jupyter</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Vibe.Coding</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jupyter_venv</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/data/venv</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodejs_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>nodejs_registry</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>npm_packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;@anthropic-ai/claude-code&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;happy-coder&#39;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>claude_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>claude_env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=通用参数>通用参数</h2><h3 id=vibe_data><code>vibe_data</code></h3><p>工作目录，Code-Server 与 JupyterLab 的默认根目录，<code>CLAUDE.md</code> 与 <code>AGENTS.md</code> 也会写入此处。</p><hr><h2 id=code-server>Code-Server</h2><h3 id=code_enabled><code>code_enabled</code></h3><p>是否启用 Code-Server。</p><h3 id=code_port><code>code_port</code></h3><p>监听端口，绑定 <code>127.0.0.1</code>，由 Nginx <code>/code/</code> 转发。</p><h3 id=code_data><code>code_data</code></h3><p>用户数据目录，配置文件位于 <code>code_data/code-server/config.yaml</code>（默认 <code>/data/code/code-server/config.yaml</code>）。</p><h3 id=code_password><code>code_password</code></h3><p>登录密码，生产环境必须修改。</p><h3 id=code_gallery><code>code_gallery</code></h3><p>扩展市场：<code>openvsx</code> / <code>microsoft</code>。
当 <code>region=china</code> 且选择 <code>openvsx</code> 时会自动使用清华镜像。</p><hr><h2 id=jupyterlab>JupyterLab</h2><h3 id=jupyter_enabled><code>jupyter_enabled</code></h3><p>是否启用 JupyterLab。
模块默认值为 <code>false</code>，<code>conf/vibe.yml</code> 中会显式改为 <code>true</code> 以启用完整沙箱。</p><h3 id=jupyter_port><code>jupyter_port</code></h3><p>监听端口，默认 <code>0.0.0.0:8888</code>。</p><h3 id=jupyter_data><code>jupyter_data</code></h3><p>数据目录，配置文件位于 <code>jupyter_data/jupyter_config.py</code>（默认 <code>/data/jupyter/jupyter_config.py</code>）。</p><h3 id=jupyter_password><code>jupyter_password</code></h3><p>访问 Token，写入 <code>c.IdentityProvider.token</code>。</p><h3 id=jupyter_venv><code>jupyter_venv</code></h3><p>JupyterLab 使用的 Python venv 路径，需要预先创建（通常由 <code>NODE</code> 模块完成）。</p><hr><h2 id=nodejs>Node.js</h2><h3 id=nodejs_enabled><code>nodejs_enabled</code></h3><p>是否启用 Node.js。</p><h3 id=nodejs_registry><code>nodejs_registry</code></h3><p>npm 镜像地址，<code>region=china</code> 且为空时自动使用 <code>https://registry.npmmirror.com</code>。</p><h3 id=npm_packages><code>npm_packages</code></h3><p>全局安装的 npm 包列表，对应标签 <code>nodejs_pkg</code>。
默认包含 <code>@anthropic-ai/claude-code</code> 与 <code>happy-coder</code>。</p><hr><h2 id=claude-code>Claude Code</h2><h3 id=claude_enabled><code>claude_enabled</code></h3><p>启用 Claude Code 配置任务（<code>claude_config</code>）。
Claude CLI 默认由 <code>nodejs_pkg</code> 根据 <code>npm_packages</code> 安装。</p><h3 id=claude_env><code>claude_env</code></h3><p>额外环境变量，合并至默认 OpenTelemetry 配置。</p><p>默认环境变量包括：</p><ul><li><code>CLAUDE_CODE_ENABLE_TELEMETRY=1</code></li><li><code>CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1</code></li><li><code>OTEL_METRICS_EXPORTER=otlp</code></li><li><code>OTEL_LOGS_EXPORTER=otlp</code></li><li><code>OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://127.0.0.1:8428/opentelemetry/v1/metrics</code></li><li><code>OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://127.0.0.1:9428/insert/opentelemetry/v1/logs</code></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d043f12092a8799b8bcf196d58b9f5cc>3 - 预置剧本</h1><div class=lead>VIBE 模块的 Ansible 剧本使用说明。</div><p>VIBE 模块提供 <code>vibe.yml</code> 剧本，用于部署 Code-Server、JupyterLab、Node.js 与 Claude Code 配置。</p><blockquote><p><code>vibe.yml</code> 只包含 <code>node_id</code> 与 <code>vibe</code> 角色，不包含 <code>node/infra</code>。
建议先执行 <a href=/docs/deploy/><code>deploy.yml</code></a> 或显式运行 <a href=/docs/node/playbook><code>node.yml</code></a> 与 <a href=/docs/infra/playbook><code>infra.yml</code></a>。</p></blockquote><hr><h2 id=vibeyml><code>vibe.yml</code></h2><p><a href=https://github.com/pgsty/pigsty/blob/main/vibe.yml><code>vibe.yml</code></a> 内容：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>VIBE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>all</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>become</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>gather_facts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>roles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>role: node_id, tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>id }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>role: vibe,    tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>vibe }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=任务结构>任务结构</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vibe
</span></span><span style=display:flex><span>├── vibe_dir          <span style=color:#8f5902;font-style:italic># 创建工作目录与上下文文件</span>
</span></span><span style=display:flex><span>├── code              <span style=color:#8f5902;font-style:italic># Code-Server</span>
</span></span><span style=display:flex><span>│   ├── code_install
</span></span><span style=display:flex><span>│   ├── code_dir
</span></span><span style=display:flex><span>│   ├── code_config
</span></span><span style=display:flex><span>│   └── code_launch
</span></span><span style=display:flex><span>├── jupyter           <span style=color:#8f5902;font-style:italic># JupyterLab</span>
</span></span><span style=display:flex><span>│   ├── jupyter_install
</span></span><span style=display:flex><span>│   ├── jupyter_dir
</span></span><span style=display:flex><span>│   ├── jupyter_config
</span></span><span style=display:flex><span>│   └── jupyter_launch
</span></span><span style=display:flex><span>├── nodejs            <span style=color:#8f5902;font-style:italic># Node.js Runtime</span>
</span></span><span style=display:flex><span>│   ├── nodejs_install
</span></span><span style=display:flex><span>│   ├── nodejs_config
</span></span><span style=display:flex><span>│   └── nodejs_pkg
</span></span><span style=display:flex><span>└── claude            <span style=color:#8f5902;font-style:italic># Claude Code 配置</span>
</span></span><span style=display:flex><span>    └── claude_config
</span></span></code></pre></div><p>说明：</p><ul><li><code>jupyter_install</code> 使用 <code>uv pip</code>，不会创建 venv</li><li><code>claude_config</code> 仅写入 <code>~/.claude</code> 配置</li><li>Claude CLI 默认由 <code>nodejs_pkg</code> 按 <code>npm_packages</code> 安装（默认包含 <code>@anthropic-ai/claude-code</code>）</li></ul><hr><h2 id=常用命令>常用命令</h2><p>完整部署：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt;
</span></span></code></pre></div><p>组件级部署：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t code
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t jupyter
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t nodejs
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t claude
</span></span></code></pre></div><p>配置更新：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t code_config,code_launch
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t jupyter_config,jupyter_launch
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t claude_config
</span></span></code></pre></div><p>禁用组件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>code_enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>jupyter_enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>nodejs_enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>claude_enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span></code></pre></div><hr><h2 id=部署顺序>部署顺序</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./deploy.yml      <span style=color:#8f5902;font-style:italic># NODE + INFRA + PGSQL</span>
</span></span><span style=display:flex><span>./juice.yml       <span style=color:#8f5902;font-style:italic># 可选共享存储</span>
</span></span><span style=display:flex><span>./vibe.yml        <span style=color:#8f5902;font-style:italic># VIBE</span>
</span></span></code></pre></div><hr><h2 id=幂等性>幂等性</h2><p><code>vibe.yml</code> 支持重复执行，配置变更后可直接重跑。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-282572ee13c89d763e4238802ddd4705>4 - 管理预案</h1><div class=lead>VIBE 模块运维操作与常见管理任务。</div><hr><h2 id=服务管理>服务管理</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl status code-server
</span></span><span style=display:flex><span>systemctl restart code-server
</span></span><span style=display:flex><span>systemctl status jupyter
</span></span><span style=display:flex><span>systemctl restart jupyter
</span></span></code></pre></div><p>查看日志：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>journalctl -u code-server -f
</span></span><span style=display:flex><span>journalctl -u jupyter -f
</span></span></code></pre></div><hr><h2 id=工作目录与上下文>工作目录与上下文</h2><p><code>vibe_dir</code> 会在 <code>vibe_data</code> 下创建：</p><ul><li><code>CLAUDE.md</code></li><li><code>AGENTS.md</code>（指向 <code>CLAUDE.md</code> 的符号链接）</li></ul><p>默认位置（可由 <code>vibe_data</code> 调整）：</p><pre tabindex=0><code>/fs/CLAUDE.md
/fs/AGENTS.md
</code></pre><hr><h2 id=密码与认证>密码与认证</h2><h3 id=code-server>Code-Server</h3><p>修改配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi /data/code/code-server/config.yaml
</span></span><span style=display:flex><span>systemctl restart code-server
</span></span></code></pre></div><p>或通过 Ansible：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>code_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;NewPassword&#39;</span> -t code_config,code_launch
</span></span></code></pre></div><h3 id=jupyterlab>JupyterLab</h3><p>配置文件位置：<code>/data/jupyter/jupyter_config.py</code></p><p>字段：<code>c.IdentityProvider.token</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi /data/jupyter/jupyter_config.py
</span></span><span style=display:flex><span>systemctl restart jupyter
</span></span></code></pre></div><hr><h2 id=code-server-扩展>Code-Server 扩展</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>code-server --install-extension ms-python.python
</span></span><span style=display:flex><span>code-server --list-extensions
</span></span><span style=display:flex><span>code-server --uninstall-extension ms-python.python
</span></span></code></pre></div><p>切换扩展市场：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>code_gallery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>microsoft</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>重新部署：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t code_config,code_launch
</span></span></code></pre></div><hr><h2 id=jupyterlab-环境管理>JupyterLab 环境管理</h2><p>VIBE 不会自动创建 venv，请确保 <code>jupyter_venv</code> 存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv venv /data/venv
</span></span></code></pre></div><p>安装/更新 JupyterLab：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv pip install --python /data/venv/bin/python jupyterlab ipykernel
</span></span><span style=display:flex><span>systemctl restart jupyter
</span></span></code></pre></div><p>安装扩展（以 venv 为准）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> /data/venv/bin/activate
</span></span><span style=display:flex><span>pip install jupyterlab-git
</span></span><span style=display:flex><span>systemctl restart jupyter
</span></span></code></pre></div><hr><h2 id=claude-code>Claude Code</h2><p><code>claude_config</code> 子任务仅写入配置文件。
Claude CLI 默认由 <code>nodejs_pkg</code> 根据 <code>npm_packages</code> 全局安装（默认包含 <code>@anthropic-ai/claude-code</code>）。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>which claude
</span></span><span style=display:flex><span>claude --version
</span></span></code></pre></div><p>配置文件：</p><ul><li><code>~/.claude.json</code></li><li><code>~/.claude/settings.json</code></li></ul><p>更新配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t claude_config
</span></span></code></pre></div><p>重装/补装 Claude CLI：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t nodejs_pkg
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或手工安装</span>
</span></span><span style=display:flex><span>npm install -g @anthropic-ai/claude-code
</span></span></code></pre></div><p>如果需要配置到其他用户，请使用对应的远程登录用户执行或手动拷贝配置文件。</p><hr><h2 id=文件位置速查>文件位置速查</h2><table class=full-width><thead><tr><th style=text-align:left>组件</th><th style=text-align:left>关键文件</th></tr></thead><tbody><tr><td style=text-align:left>Code-Server</td><td style=text-align:left><code>/data/code/code-server/config.yaml</code></td></tr><tr><td style=text-align:left>Code-Server</td><td style=text-align:left><code>/etc/default/code</code></td></tr><tr><td style=text-align:left>Code-Server</td><td style=text-align:left><code>/etc/systemd/system/code-server.service</code></td></tr><tr><td style=text-align:left>JupyterLab</td><td style=text-align:left><code>/data/jupyter/jupyter_config.py</code></td></tr><tr><td style=text-align:left>JupyterLab</td><td style=text-align:left><code>/etc/default/jupyter</code></td></tr><tr><td style=text-align:left>JupyterLab</td><td style=text-align:left><code>/etc/systemd/system/jupyter.service</code></td></tr><tr><td style=text-align:left>Claude Code</td><td style=text-align:left><code>~/.claude.json</code> / <code>~/.claude/settings.json</code></td></tr></tbody></table><hr><h2 id=故障排查>故障排查</h2><p>端口检查：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8443</span>
</span></span><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8888</span>
</span></span></code></pre></div><p>Nginx 入口：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nginx -t
</span></span><span style=display:flex><span>systemctl status nginx
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b864c1860bfd1307001787cb291f673b>5 - 监控告警</h1><div class=lead>VIBE 模块监控说明，重点为 Claude Code 可观测性。</div><p>VIBE 的监控主要集中在 Claude Code 的 OpenTelemetry 数据。
Code-Server 与 JupyterLab 本身不暴露 Prometheus 指标，可通过 systemd 与日志进行健康检查。</p><hr><h2 id=claude-code-可观测性>Claude Code 可观测性</h2><p>VIBE 在 <code>~/.claude/settings.json</code> 中写入默认 OpenTelemetry 环境变量：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;env&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;CLAUDE_CODE_ENABLE_TELEMETRY&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_LOG_USER_PROMPTS&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_METRICS_EXPORTER&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;otlp&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_LOGS_EXPORTER&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;otlp&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_EXPORTER_OTLP_PROTOCOL&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http/protobuf&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_EXPORTER_OTLP_METRICS_ENDPOINT&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://127.0.0.1:8428/opentelemetry/v1/metrics&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_EXPORTER_OTLP_LOGS_ENDPOINT&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://127.0.0.1:9428/insert/opentelemetry/v1/logs&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;OTEL_RESOURCE_ATTRIBUTES&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ip=&lt;host&gt;,job=claude&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>claude_env</code> 会与上述默认配置合并，可用于配置 API Key 或替换模型端点。</p><hr><h2 id=grafana-dashboard>Grafana Dashboard</h2><p>Grafana 默认包含 <code>claude-code</code> Dashboard：</p><ul><li>Portal 入口：<code>https://&lt;domain>/ui/d/claude-code</code></li><li>直接访问：<code>http://&lt;ip>:3000/d/claude-code</code></li></ul><hr><h2 id=运行状态检查>运行状态检查</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl status code-server
</span></span><span style=display:flex><span>systemctl status jupyter
</span></span><span style=display:flex><span>journalctl -u code-server -f
</span></span><span style=display:flex><span>journalctl -u jupyter -f
</span></span></code></pre></div><p>端口检查：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8443</span>
</span></span><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8888</span>
</span></span></code></pre></div><hr><h2 id=claude-日志查询>Claude 日志查询</h2><p>通过 VictoriaLogs：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -G <span style=color:#4e9a06>&#39;http://127.0.0.1:9428/select/logsql/query&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --data-urlencode <span style=color:#4e9a06>&#39;query=job:claude&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-129db311a07ef375ea35b82ce6714049>6 - 常见问题</h1><div class=lead>VIBE 模块常见问题解答。</div><hr><h2 id=部署问题>部署问题</h2><h3 id=code-server-软件包找不到>code-server 软件包找不到</h3><p>确认已部署 <a href=/docs/node><code>NODE</code></a> 与仓库配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum repolist    <span style=color:#8f5902;font-style:italic># EL</span>
</span></span><span style=display:flex><span>apt update      <span style=color:#8f5902;font-style:italic># Debian/Ubuntu</span>
</span></span><span style=display:flex><span>./infra.yml -t repo
</span></span></code></pre></div><h3 id=jupyterlab-安装失败>JupyterLab 安装失败</h3><p><code>jupyter_venv</code> 必须存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv venv /data/venv
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t jupyter
</span></span></code></pre></div><hr><h2 id=访问问题>访问问题</h2><h3 id=无法访问-code-或-jupyter>无法访问 <code>/code/</code> 或 <code>/jupyter/</code></h3><ol><li>检查服务状态</li><li>检查端口监听</li><li>检查 Nginx 配置</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl status code-server
</span></span><span style=display:flex><span>systemctl status jupyter
</span></span><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8443</span>
</span></span><span style=display:flex><span>ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8888</span>
</span></span><span style=display:flex><span>nginx -t
</span></span></code></pre></div><h3 id=websocket-连接失败>WebSocket 连接失败</h3><p>确保 Nginx 配置启用 WebSocket（默认已配置）。
若使用自定义 <code>infra_portal</code>，需配置 <code>websocket: true</code>。</p><hr><h2 id=密码与-token>密码与 Token</h2><h3 id=修改-code-server-密码>修改 Code-Server 密码</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>code_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;NewPass&#39;</span> -t code_config,code_launch
</span></span></code></pre></div><h3 id=修改-jupyterlab-token>修改 JupyterLab Token</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -e <span style=color:#000>jupyter_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;NewToken&#39;</span> -t jupyter_config,jupyter_launch
</span></span></code></pre></div><hr><h2 id=claude-code>Claude Code</h2><h3 id=cli-找不到命令>CLI 找不到命令</h3><p>先检查 <code>nodejs_pkg</code> 是否完成（默认会安装 <code>@anthropic-ai/claude-code</code>）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>which claude
</span></span><span style=display:flex><span>npm list -g --depth<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>|</span> grep <span style=color:#4e9a06>&#39;@anthropic-ai/claude-code&#39;</span>
</span></span><span style=display:flex><span>./vibe.yml -l &lt;host&gt; -t nodejs_pkg
</span></span></code></pre></div><p>如果你禁用了 <code>nodejs_enabled</code> 或覆盖了 <code>npm_packages</code>，可手工安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g @anthropic-ai/claude-code
</span></span></code></pre></div><h3 id=api-key-未配置>API Key 未配置</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ANTHROPIC_API_KEY</span><span style=color:#ce5c00;font-weight:700>=</span>sk-ant-xxx
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 或配置到 claude_env</span>
</span></span></code></pre></div><h3 id=监控数据不显示>监控数据不显示</h3><p>检查本地 VictoriaMetrics/VictoriaLogs：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://127.0.0.1:8428/api/v1/status/buildinfo
</span></span><span style=display:flex><span>curl http://127.0.0.1:9428/select/logsql/stats_query
</span></span></code></pre></div><p>确保 <code>~/.claude/settings.json</code> 中 OTEL 端点正确。</p><hr><h2 id=扩展与插件>扩展与插件</h2><h3 id=code-server-扩展安装失败>Code-Server 扩展安装失败</h3><ul><li>检查网络</li><li>尝试切换 <code>code_gallery</code></li><li>或手动安装 VSIX</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>code-server --install-extension /path/to/extension.vsix
</span></span></code></pre></div><h3 id=jupyterlab-扩展安装失败>JupyterLab 扩展安装失败</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> /data/venv/bin/activate
</span></span><span style=display:flex><span>pip install jupyterlab-git
</span></span><span style=display:flex><span>systemctl restart jupyter
</span></span></code></pre></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>