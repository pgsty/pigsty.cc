<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://pigsty.cc/docs/minio/><link rel=alternate type=application/rss+xml href=https://pigsty.cc/docs/minio/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>模块：MINIO | PIGSTY</title><meta name=description content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"><meta property="og:url" content="https://pigsty.cc/docs/minio/"><meta property="og:site_name" content="PIGSTY"><meta property="og:title" content="模块：MINIO"><meta property="og:description" content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta itemprop=name content="模块：MINIO"><meta itemprop=description content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"><meta itemprop=dateModified content="2026-02-08T16:14:56+08:00"><meta itemprop=wordCount content="124"><meta itemprop=keywords content="参考,MINIO"><meta name=twitter:card content="summary"><meta name=twitter:title content="模块：MINIO"><meta name=twitter:description content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"><link rel=preload href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css as=style integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><link href=/scss/main.min.3858138289ee11ec3386acfac6cdb648f958d81bdf477441fa83b86e29a55a1b.css rel=stylesheet integrity="sha256-OFgTgonuEewzhqz6xs22SPlY2BvfR3RB+oO4bimlWhs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LG1V9WTKGE")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class=navbar-brand__name>PIGSTY</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class="fas fa-blog"></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block td-navbar__version-menu"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>版本</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://pigsty.io>Pigsty English Site</a></li><li><a class=dropdown-item href=https://doc.pgsty.com/zh>Pigsty v3.7 文档</a></li><li><a class=dropdown-item href=https://v34.pigsty.cc/zh>Pigsty v3.4 文档</a></li><li><a class=dropdown-item href=https://v27.pigsty.cc>Pigsty v2.7 文档</a></li><li><a class=dropdown-item href=https://v15.pigsty.cc/docs>Pigsty v1.5 文档</a></li></ul></div></li><li class=nav-item><a class=nav-link href=https://pgext.cloud target=_blank rel=noopener><i class='fa-solid fa-puzzle-piece'></i><span>扩展</span></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li><li class=nav-item><a class=nav-link href=# onclick="return switchLang(),!1" title="Switch to English / 切换语言"><i class="fas fa-language"></i></a></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=站内搜索…… aria-label=站内搜索…… autocomplete=off data-offline-search-index-json-src=/offline-search-index.83c025000675b1802d158b8a9cff5b2a.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav><script>function switchLang(){var t=window.location.host,e=window.location.pathname+window.location.search+window.location.hash;t.indexOf("pigsty.cc")!==-1?window.location.href="https://pigsty.io"+e:t.indexOf("pigsty.io")!==-1?window.location.href="https://pigsty.cc"+e:window.location.href="https://pigsty.io"+e}</script></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/minio/>返回本页常规视图</a>.</p></div><h1 class=title>模块：MINIO</h1><div class=lead>Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。</div><ul><li>1: <a href=#pg-45b8da1dfca6b0e91aef873f7b72b337>使用方法</a></li><li>2: <a href=#pg-08605fa7a960e0149e3c22312586b71e>集群配置</a></li><li>3: <a href=#pg-280b7e56b08e272d7b26411d506d6c5d>参数列表</a></li><li>4: <a href=#pg-ccc1805ae841df3ebaeb7bb6b8008203>预置剧本</a></li><li>5: <a href=#pg-172708bf70f3c5729ee49aac66787c09>管理预案</a></li><li>6: <a href=#pg-81383092950ff4115e1c3850be65d36f>监控告警</a></li><li>7: <a href=#pg-61857417600e2adc512dcba599edd776>指标列表</a></li><li>8: <a href=#pg-571982477397f0d78a3a5034a4ef3e1d>常见问题</a></li></ul><div class=content><p><a href=https://min.io/>MinIO</a> 是一个兼容 AWS S3 的多云对象存储软件。</p><p>MinIO 可以用来存储文档、图片、视频和备份。Pigsty 原生支持部署各种 MinIO 集群，具备原生多节点多磁盘高可用支持，易于扩展、安全且开箱即用，
并且有过 10PB+ 级别的大规模生产环境部署用例。</p><p>MinIO 是 Pigsty 中的一个 <a href=/docs/ref/module><strong>可选模块</strong></a>。您可以将 MinIO 用作 PostgreSQL <a href=/docs/pgsql/backup/repository/><strong>备份</strong></a> 的可选存储仓库，作为默认本地 POSIX 文件系统仓库的补充。
如果使用 MinIO 备份仓库，<code>MINIO</code> 模块应在任何 <a href=/docs/pgsql><code>PGSQL</code></a> 模块之前安装。MinIO 需要受信任的 CA 证书才能工作，因此它依赖 <a href=/docs/node><code>NODE</code></a> 模块。</p><hr><h2 id=快速开始>快速开始</h2><p>以下是一个最简单的 MinIO 单机单盘部署示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 在配置清单中定义 MinIO 集群</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio    <span style=color:#8f5902;font-style:italic># 在 minio 分组上部署 MinIO 模块</span>
</span></span></code></pre></div><p>部署完成后，您可以通过以下方式访问 MinIO：</p><ul><li><strong>S3 API</strong>：<code>https://sss.pigsty:9000</code>（使用域名需要配置 DNS 解析）</li><li><strong>Web 控制台</strong>：<code>https://&lt;minio-ip>:9001</code>（默认用户名/密码：<code>minioadmin</code> / <code>S3User.MinIO</code>）</li><li><strong>命令行</strong>：<code>mcli ls sss/</code>（管理节点上已预配置别名）</li></ul><hr><h2 id=部署模式>部署模式</h2><p>MinIO 支持三种主要部署模式：</p><table class=full-width><thead><tr><th style=text-align:left>模式</th><th style=text-align:left>说明</th><th style=text-align:left>适用场景</th></tr></thead><tbody><tr><td style=text-align:left><a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98><strong>单机单盘</strong></a> (SNSD)</td><td style=text-align:left>单节点，单个数据目录</td><td style=text-align:left>开发、测试、演示</td></tr><tr><td style=text-align:left><a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>单机多盘</strong></a> (SNMD)</td><td style=text-align:left>单节点，多块磁盘</td><td style=text-align:left>资源受限的小规模部署</td></tr><tr><td style=text-align:left><a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>多机多盘</strong></a> (MNMD)</td><td style=text-align:left>多节点，每节点多块磁盘</td><td style=text-align:left><strong>生产环境推荐</strong></td></tr></tbody></table><p>此外，您还可以使用 <a href=/docs/minio/config#%E5%A4%9A%E6%B1%A0%E9%83%A8%E7%BD%B2>多池部署</a> 来扩容现有集群，或部署 <a href=/docs/minio/config#%E5%A4%9A%E5%A5%97%E9%9B%86%E7%BE%A4>多套集群</a>。</p><hr><h2 id=核心特性>核心特性</h2><ul><li><strong>S3 兼容</strong>：完全兼容 AWS S3 API，可与各种 S3 客户端和工具无缝集成</li><li><strong>高可用</strong>：原生支持多节点多磁盘部署，容忍节点和磁盘故障</li><li><strong>安全</strong>：默认启用 HTTPS 加密传输，支持服务端加密</li><li><strong>监控</strong>：开箱即用的 Grafana 监控面板和 Prometheus 告警规则</li><li><strong>易用</strong>：预配置的 <code>mcli</code> 客户端别名，一键部署和管理</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-45b8da1dfca6b0e91aef873f7b72b337>1 - 使用方法</h1><div class=lead>快速上手，如何上手使用 MinIO ？如何可靠地接入 MinIO？如何使用 mc / rclone 客户端工具？</div><p>当您 <a href=/docs/minio/config/>配置</a> 并执行 <a href=/docs/minio/playbook/>剧本</a> 部署 MinIO 集群后，可以参考这里的说明开始使用与接入 MinIO 集群。</p><hr><h2 id=部署集群>部署集群</h2><p>在 Pigsty 中部署一个开箱即用的 单机单盘 MinIO 实例非常简单：首先在 <a href=/docs/setup/config/>配置清单</a> 中定义一套 MinIO 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后，针对定义的分组（这里为 <code>minio</code> ）执行 Pigsty 提供的 <a href=/docs/minio/playbook/><code>minio.yml</code></a> 剧本即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio
</span></span></code></pre></div><p>请注意在 <a href=/docs/setup/playbook#%E9%83%A8%E7%BD%B2%E5%89%A7%E6%9C%AC><code>deploy.yml</code></a> 中，事先定义好的 MinIO 集群将自动创建，无需手动再次执行 <code>minio.yml</code> 剧本。</p><p>如果您计划部署一个生产等级的大规模多节点 MinIO 集群，我们强烈建议您通读 Pigsty MinIO <a href=/docs/minio/config/>配置文档</a> 与 MinIO <a href=https://min.io/docs/minio/linux/operations/concepts.html>官方文档</a> 后再进行。</p><hr><h2 id=接入集群>接入集群</h2><p>请注意：生产环境建议通过域名与 HTTPS 访问 MinIO（默认配置也是 HTTPS）。
如果您显式设置 <a href=/docs/minio/param#minio_https><code>minio_https</code></a> 为 <code>false</code>，也可以使用 HTTP 访问。
无论哪种方式，都请确保 MinIO 服务域名（默认为 <code>sss.pigsty</code>）正确指向 MinIO 服务器节点。</p><ol><li>您可以在 <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a> 中添加静态解析记录，或者手工修改 <code>/etc/hosts</code> 文件</li><li>您可以在内网的 DNS 服务器上添加一条记录，如果已经有了现成的 DNS 服务</li><li>如果您启用了 Infra 节点上的 DNS 服务器，可以在 <a href=/docs/infra/param#dns_records><code>dns_records</code></a> 中添加记录</li></ol><p>对于生产环境访问 MinIO，通常我们建议使用第一种方式：静态 DNS 解析记录，避免 MinIO 对于 DNS 的额外依赖。</p><p>您应当将 MinIO 服务域名指向 MinIO 服务器节点的 IP 地址与服务端口，或者负载均衡器的 IP 地址与服务端口。
Pigsty 默认使用的 MinIO 服务域名是 <code>sss.pigsty</code>，在单机部署时默认指向本机，在 <code>9000</code> 端口提供服务。</p><p>在一些例子中，MinIO 集群上还部署了 HAProxy 实例对外暴露服务，在这种情况下，<code>9002</code> 是模板中使用的服务端口。</p><hr><h2 id=添加别名>添加别名</h2><p>要使用 <code>mcli</code> 客户端访问 <code>minio</code> 服务器集群，首先要配置服务器的别名（<code>alias</code>）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli <span style=color:#204a87>alias</span> ls  <span style=color:#8f5902;font-style:italic># 列出 minio 别名（默认使用sss）</span>
</span></span><span style=display:flex><span>mcli <span style=color:#204a87>alias</span> <span style=color:#204a87>set</span> sss https://sss.pigsty:9000 minioadmin S3User.MinIO            <span style=color:#8f5902;font-style:italic># root 用户</span>
</span></span><span style=display:flex><span>mcli <span style=color:#204a87>alias</span> <span style=color:#204a87>set</span> sss https://sss.pigsty:9002 minioadmin S3User.MinIO            <span style=color:#8f5902;font-style:italic># root 用户，使用负载均衡器 9002 端口</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mcli <span style=color:#204a87>alias</span> <span style=color:#204a87>set</span> pgbackrest https://sss.pigsty:9000 pgbackrest S3User.Backup    <span style=color:#8f5902;font-style:italic># 使用备份用户</span>
</span></span></code></pre></div><p>在管理节点的管理用户上，已经默认配置了名为 <code>sss</code> 的 MinIO 别名，可以直接使用。</p><p>MinIO 客户端工具 <code>mcli</code> 的完整功能参考，请查阅文档： <a href=https://min.io/docs/minio/linux/reference/minio-mc.html>MinIO 客户端</a>。</p><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>注意：请使用您实际配置的密码</div><p>上述示例中的密码 <code>S3User.MinIO</code> 是 Pigsty 的默认值。如果您在部署时修改了 <a href=/docs/minio/param#minio_secret_key><code>minio_secret_key</code></a>，请使用您实际配置的密码。</p></div><hr><h2 id=用户管理>用户管理</h2><p>使用 <code>mcli</code> 可以管理 MinIO 中的业务用户，例如这里我们可以使用命令行创建两个业务用户：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli admin user list sss     <span style=color:#8f5902;font-style:italic># 列出 sss 上的所有用户</span>
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> +o <span style=color:#204a87>history</span> <span style=color:#8f5902;font-style:italic># 在历史记录中隐藏密码并创建 minio 用户</span>
</span></span><span style=display:flex><span>mcli admin user add sss dba S3User.DBA
</span></span><span style=display:flex><span>mcli admin user add sss pgbackrest S3User.Backup
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> -o <span style=color:#204a87>history</span> 
</span></span></code></pre></div><hr><h2 id=存储桶管理>存储桶管理</h2><p><strong>您可以对MinIO中的存储桶进行增删改查</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli ls sss/                         <span style=color:#8f5902;font-style:italic># 列出别名 &#39;sss&#39; 的所有桶</span>
</span></span><span style=display:flex><span>mcli mb --ignore-existing sss/hello  <span style=color:#8f5902;font-style:italic># 创建名为 &#39;hello&#39; 的桶</span>
</span></span><span style=display:flex><span>mcli rb --force sss/hello            <span style=color:#8f5902;font-style:italic># 强制删除 &#39;hello&#39; 桶</span>
</span></span></code></pre></div><hr><h2 id=对象管理>对象管理</h2><p><strong>您也可以对存储桶内的对象进行增删改查</strong>，详情请参考官方文档：<a href=https://min.io/docs/minio/linux/administration/object-management.html>对象管理</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli cp /www/pigsty/* sss/infra/     <span style=color:#8f5902;font-style:italic># 将本地软件源的内容上传到 MinIO 的 infra 桶中 </span>
</span></span><span style=display:flex><span>mcli cp sss/infra/plugins.tgz /tmp/  <span style=color:#8f5902;font-style:italic># 从 minio 下载文件到本地</span>
</span></span><span style=display:flex><span>mcli ls sss/infra                    <span style=color:#8f5902;font-style:italic># 列出 infra 桶中的所有文件</span>
</span></span><span style=display:flex><span>mcli rm sss/infra/plugins.tgz        <span style=color:#8f5902;font-style:italic># 删除 infra 桶中的特定文件  </span>
</span></span><span style=display:flex><span>mcli cat sss/infra/repo_complete     <span style=color:#8f5902;font-style:italic># 查看 infra 桶中的文件内容</span>
</span></span></code></pre></div><hr><h2 id=使用rclone>使用rclone</h2><p>Pigsty 仓库中提供了 <a href=https://rclone.org/>rclone</a>， 一个方便的多云对象存储客户端，您可以使用它来访问 MinIO 服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install rclone<span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic># EL 系列系统</span>
</span></span><span style=display:flex><span>apt install rclone<span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic># Debian/Ubuntu 系统</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p ~/.config/rclone/<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>tee ~/.config/rclone/rclone.conf &gt; /dev/null <span style=color:#4e9a06>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[sss]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>type = s3
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>access_key_id = minioadmin
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>secret_access_key = S3User.MinIO
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>endpoint = https://sss.pigsty:9000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rclone ls sss:/
</span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>注意：HTTPS 与证书信任</div><p>如果 MinIO 使用 HTTPS（默认配置），您需要确保客户端信任 Pigsty 的 CA 证书（<code>/etc/pki/ca.crt</code>），或者在 rclone 配置中添加 <code>no_check_certificate = true</code> 来跳过证书验证（不建议在生产环境使用）。</p></div><hr><h2 id=配置备份仓库>配置备份仓库</h2><p>在 Pigsty 中，MinIO 默认的用例是作为 pgBackRest 的备份存储仓库。
当您修改 <a href=/docs/pgsql/param#pgbackrest_method><code>pgbackrest_method</code></a> 为 <code>minio</code> 时，PGSQL 模块会自动将备份存储仓库切换到 MinIO 上。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_method: local          # pgbackrest repo method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>local,minio,[user-defined...]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>pgbackrest_repo:                  # pgbackrest repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://pgbackrest.org/configuration.html#section-repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>local</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># default pgbackrest repo with local posix fs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pg/backup             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># local backup directory, `/pg/backup` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>count   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backups by count</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># keep 2, at most 3 full backup when using local fs repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                          </span><span style=color:#8f5902;font-style:italic># optional minio repo for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3                     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio is s3-compatible, so s3 is used</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio endpoint domain name, `sss.pigsty` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio region, us-east-1 by default, useless for minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio bucket name, `pgsql` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user access key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.Backup </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio user secret key for pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># use path style uri for minio rather than host style</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio backup path, default is `/pgbackrest`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio port, 9000 by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/pki/ca.crt </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio ca file path, `/etc/pki/ca.crt` by default</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># bundle small files into a single file</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># enable AES encryption for remote backup repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest      </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># AES encryption password, default is &#39;pgBackRest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time    </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># retention full backup by time on minio repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># keep full backup for last 14 days</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>请注意，如果您使用了多节点部署的 MinIO 集群，并通过负载均衡器对外提供服务，您需要相应地修改这里的 <code>s3_endpoint</code> 与 <code>storage_port</code> 参数。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-08605fa7a960e0149e3c22312586b71e>2 - 集群配置</h1><div class=lead>根据需求场景选择合适的 MinIO 部署类型，并对外提供可靠的接入。</div><p>在部署 MinIO 之前，你需要在 <a href=/docs/setup/config>配置清单</a> 中定义一个 MinIO 集群，MinIO 有三种经典部署模式：</p><ul><li><a href=#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98>单机单盘：SNSD</a>：单机单盘模式，可以使用任意目录作为数据盘，仅作为开发、测试、演示使用。</li><li><a href=#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98>单机多盘：SNMD</a>：折中模式，在单台服务器上使用多块磁盘 (>=2)，仅当资源极为有限时使用。</li><li><a href=#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>多机多盘：MNMD</a>：多机多盘模式，标准生产环境部署，具有最好的可靠性，但需要多台服务器。</li></ul><p>通常我们建议使用 SNSD 与 MNMD 这两种模式，前者用于开发测试，后者用于生产部署，SNMD 仅在资源有限（只有一台服务器）的情况下使用。</p><p>此外，还可以使用 <a href=#%E5%A4%9A%E6%B1%A0%E9%83%A8%E7%BD%B2>多池部署</a> 来实现现有 MinIO 集群的扩容，或者直接部署 <a href=#%E5%A4%9A%E5%A5%97%E9%9B%86%E7%BE%A4>多套集群</a>。</p><p>使用多节点 MinIO 集群时，访问任意节点都可以获取服务，因此最佳实践是在 MinIO 集群前使用负载均衡与 <a href=#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%85%A5>高可用服务接入机制</a>。</p><hr><h2 id=核心参数>核心参数</h2><p>MinIO 部署中，<a href=https://min.io/docs/minio/linux/reference/minio-server/settings/core.html#envvar.MINIO_VOLUMES><code>MINIO_VOLUMES</code></a> 是一个核心配置参数，用于指定 MinIO 的部署模式。
Pigsty 提供了一些便捷的参数用于自动根据配置清单，生成 <code>MINIO_VOLUMES</code> 与其他配置参数的值，但您也可以直接指定它们。</p><ul><li>单机单盘： <code>MINIO_VOLUMES</code> 指向本机上的一个普通目录，默认由 <a href=/docs/minio/param#minio_data><code>minio_data</code></a> 指定，默认位置为 <code>/data/minio</code>。</li><li>单机多盘： <code>MINIO_VOLUMES</code> 指向本机上的序列挂载点，同样是由 <a href=/docs/minio/param#minio_data><code>minio_data</code></a> 指定，但需要用特殊语法显式覆盖指定真实挂载点，例如 <code>/data{1...4}</code>。</li><li>多机多盘： <code>MINIO_VOLUMES</code> 指向多台服务器上的序列挂载点，由以下两部分自动组合生成：<ul><li>首先要使用 <a href=/docs/minio/param#minio_data><code>minio_data</code></a> 指定集群每个成员的磁盘挂载点序列 <code>/data{1...4}</code>，</li><li>还需要使用 <a href=/docs/minio/param#minio_node><code>minio_node</code></a> 指定节点的命名模式 <code>${minio_cluster}-${minio_seq}.pigsty</code></li></ul></li><li>多池部署： 您需要显式指定 <a href=/docs/minio/param#minio_volumes><code>minio_volumes</code></a> 参数来分配每个存储池的节点，从而实现集群扩容</li></ul><hr><h2 id=单机单盘>单机单盘</h2><p>SNSD 模式，部署参考教程：<a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html>MinIO 单机单盘部署</a></p><p>在 Pigsty 中，定义一个单例 MinIO 实例非常简单：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1 节点 1 驱动器（默认）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>单机模式下，唯一必要的参数是 <a href=/docs/minio/param#minio_seq><code>minio_seq</code></a> 和 <a href=/docs/minio/param#minio_cluster><code>minio_cluster</code></a>，它们会唯一标识每一个 MinIO 实例。</p><p>单节点单磁盘模式仅用于开发目的，因此您可以使用一个普通的目录作为数据目录，该目录由参数 <a href=/docs/minio/param#minio_data><code>minio_data</code></a> 默认为 <code>/data/minio</code>。</p><p>在您使用 MinIO 时，强烈建议您通过静态解析的域名记录访问 MinIO，例如，假设 <a href=/docs/minio/param#minio_domain><code>minio_domain</code></a> 设置的内部服务域名使用了默认的 <code>sss.pigsty</code>，
那么您可以在所有节点上添加一个静态解析，便于其他节点访问此服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.10.10.10 sss.pigsty&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># domain name to access minio from all nodes (required)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>SNSD 仅适用于开发测试</div><p>单节点单盘模式应当仅用于开发、测试、演示目的，因为它无法容忍任何硬件故障，也无法带来多磁盘的性能改善。生产环境请使用 <a href=#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>多机多盘</a> 模式。</p></div><hr><h2 id=单机多盘>单机多盘</h2><p>SNMD 模式，部署参考教程：<a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-multi-drive.html>MinIO 单机多盘部署</a></p><p>要在单节点上使用多块磁盘，所需的操作与 <a href=#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98>单机单盘</a> 基本一致，但用户需要以 <code>{{ prefix }}{x...y}</code> 的特定格式指定 <a href=/docs/minio/param#minio_data><code>minio_data</code></a>，该格式定义了序列磁盘挂载点。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 集群名称，默认为 minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># minio 数据目录，使用 {x...y} 记号来指定多块磁盘</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><div class="alert alert-warning" role=alert><div class="h4 alert-heading" role=heading>请使用真实磁盘挂载点</div><p>请注意，SNMD 模式不支持使用普通目录作为数据目录。如果您使用 SNMD 模式拉起 MinIO，但数据目录不是有效的磁盘挂载点，MinIO 将拒绝启动。请确保使用 XFS 格式化的真实磁盘。</p></div><p>例如 Vagrant MinIO <a href=https://github.com/pgsty/pigsty/blob/main/vagrant/spec/minio.rb>沙箱</a> 定义了一个带有4块磁盘的单节点 MinIO 集群：<code>/data1</code>、<code>/data2</code>、<code>/data3</code> 和 <code>/data4</code>。启动 MinIO 之前，你需要正确地挂载它们（请务必使用 <code>xfs</code> 格式化磁盘）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkfs.xfs /dev/vdb<span style=color:#000;font-weight:700>;</span> mkdir /data1<span style=color:#000;font-weight:700>;</span> mount -t xfs /dev/vdb /data1<span style=color:#000;font-weight:700>;</span>   <span style=color:#8f5902;font-style:italic># 挂载第1块盘……</span>
</span></span><span style=display:flex><span>mkfs.xfs /dev/vdc<span style=color:#000;font-weight:700>;</span> mkdir /data2<span style=color:#000;font-weight:700>;</span> mount -t xfs /dev/vdc /data2<span style=color:#000;font-weight:700>;</span>   <span style=color:#8f5902;font-style:italic># 挂载第2块盘……</span>
</span></span><span style=display:flex><span>mkfs.xfs /dev/vdd<span style=color:#000;font-weight:700>;</span> mkdir /data3<span style=color:#000;font-weight:700>;</span> mount -t xfs /dev/vdd /data3<span style=color:#000;font-weight:700>;</span>   <span style=color:#8f5902;font-style:italic># 挂载第3块盘……</span>
</span></span><span style=display:flex><span>mkfs.xfs /dev/vde<span style=color:#000;font-weight:700>;</span> mkdir /data4<span style=color:#000;font-weight:700>;</span> mount -t xfs /dev/vde /data4<span style=color:#000;font-weight:700>;</span>   <span style=color:#8f5902;font-style:italic># 挂载第4块盘……</span>
</span></span></code></pre></div><p>挂载磁盘属于服务器置备的部分，超出 Pigsty 的处理范畴。挂载的磁盘应该同时写入 <code>/etc/fstab</code> 以便在服务器重启后可以自动挂载。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/dev/vdb /data1 xfs defaults,noatime,nodiratime <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>/dev/vdc /data2 xfs defaults,noatime,nodiratime <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>/dev/vdd /data3 xfs defaults,noatime,nodiratime <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>/dev/vde /data4 xfs defaults,noatime,nodiratime <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>SNMD 模式可以利用单机上的多块磁盘，提供更高的性能和容量，并且容忍部分磁盘故障。
但单节点模式无法容忍整个节点的故障，而且您无法在运行时添加新的节点，因此如果没有特殊原因，我们不建议在生产环境中使用 SNMD 模式。</p><hr><h2 id=多机多盘>多机多盘</h2><p>MNMD 模式，部署参考教程：<a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-multi-node-multi-drive.html>MinIO 多机多盘部署</a></p><p>除了需要 <a href=#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98>单机多盘</a> 模式中的 <a href=/docs/minio/param#minio_data><code>minio_data</code></a> 指定磁盘驱动器，使用MinIO 多节点部署需要使用一个额外的 <a href=/docs/minio/param#minio_node><code>minio_node</code></a> 参数。</p><p>例如，以下配置定义了一个 MinIO 集群，其中有四个节点，每个节点有四块磁盘：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 实际节点名： minio-1.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 实际节点名： minio-2.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 实际节点名： minio-3.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 实际节点名： minio-4.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>                         </span><span style=color:#8f5902;font-style:italic># 每个节点使用四块磁盘</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 节点名称规则</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><a href=/docs/minio/param#minio_node><code>minio_node</code></a> 参数指定了 MinIO 节点名称的模式，用于生成每个节点的唯一名称。
默认情况下，节点名称是 <code>${minio_cluster}-${minio_seq}.pigsty</code>，其中 <code>${minio_cluster}</code> 是集群名称，<code>${minio_seq}</code> 是节点序号。
MinIO 实例的名称非常重要，会自动写入到 MinIO 节点的 <code>/etc/hosts</code> 中进行静态解析。MinIO 依靠这些名称来识别并访问集群中的其他节点。</p><p>在这种情况下，<code>MINIO_VOLUMES</code> 将被设置为 <code>https://minio-{1...4}.pigsty:9000/data{1...4}</code> ，以标识四个节点上的四块盘。
您可以直接在 MinIO 集群中指定 <a href=/docs/minio/param#minio_volumes><code>minio_volumes</code></a> 参数，来覆盖自动根据规则生成的值。
但通常不需要这样做，因为 Pigsty 会自动根据配置清单生成它。</p><hr><h2 id=多池部署>多池部署</h2><p>MinIO 的架构允许通过添加新的存储池来扩容。在 Pigsty 中，您可以通过显式指定 <a href=/docs/minio/param#minio_volumes><code>minio_volumes</code></a> 参数来分配每个存储池的节点，从而实现集群扩容。</p><p>例如，假设您已经创建了 <a href=#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>多机多盘</a> 样例中定义的 MinIO 集群，现在您想要添加一个新的存储池，同样由四个节点构成。</p><p>那么，你需要直接覆盖指定 <a href=/docs/minio/param#minio_volumes><code>minio_volumes</code></a> 参数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.14</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.15</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.16</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.17</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/data{1...4}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 节点名称规则</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>在这里，空格分割的两个参数分别代表两个存储池，每个存储池有四个节点，每个节点有四块磁盘。更多关于存储池的信息请参考 <a href=/docs/minio/admin/>管理预案：MinIO集群扩容</a></p><hr><h2 id=多套集群>多套集群</h2><p>您可以将新的 MinIO 节点部署为一个全新的 MinIO 集群，使用不同的集群名称定义一个新的分组即可，以下配置声明了两个独立的 MinIO 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/data{1...4}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>    
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.14</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.15</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.16</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.17</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;/data{1...4}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_alias</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss2.pigsty</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss2.pigsty:9000</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>请注意，Pigsty 默认一套部署中只有一个 MinIO 集群，如果您需要部署多个 MinIO 集群，那么一些带有默认值的参数需要显式设置，无法省略，否则会出现命名冲突，如上所示。</p><hr><h2 id=服务接入>服务接入</h2><p>MinIO 默认使用 <code>9000</code> 端口提供服务。多节点 MinIO 集群可以通过访问 <strong>任意一个节点</strong> 来访问其服务。</p><p>服务接入属于 <a href=/docs/node>NODE</a> 模块的功能范畴，这里仅做基本介绍。</p><p>多节点 MinIO 集群的高可用接入可以使用 L2 VIP 或 HAProxy 实现。例如，您可以选择使用 keepalived 在 MinIO 集群上绑定一个 L2 <a href=/docs/node/param#node_vip>VIP</a>，
或者使用由 <a href=/docs/node><code>NODE</code></a> 模块的提供的 <a href=/docs/node/param#haproxy><code>haproxy</code></a> 组件，通过负载均衡器对外暴露 MinIO 服务。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># minio cluster with 4 nodes and 4 drivers per node</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 2 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 3 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-3 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 4 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-4 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }, { name: infra }, { name: redis } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba , secret_key: S3User.DBA, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.9</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># expose minio service with haproxy on all nodes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service name, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service port, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>leastconn            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] load balancer algorithm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] minio health check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>option httpchk</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>option http-keep-alive</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>http-check send meth OPTIONS uri /minio/health/live</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>http-check expect status 200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>例如，上面的配置块为 MinIO 集群的所有节点上启用了 HAProxy ，在 9002 端口上暴露 MinIO 服务，同时为集群绑定了一个二层 VIP。
当使用时，用户应当将 <code>sss.pigsty</code> 域名解析指向 VIP 地址 <code>10.10.10.9</code>，并使用 <code>9002</code> 端口访问 MinIO 服务。这样当任意一个节点发生故障时，VIP 会自动切换到另一个节点，保证服务的高可用性。</p><p>在这种情况下，您通常还需要在全局修改域名解析的目的地，以及 <a href=/docs/minio/param#minio_endpoint><code>minio_endpoint</code></a> 参数，修改写入管理节点 MinIO Alias 对应的端点地址：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9002  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 覆盖默认值： https://sss.pigsty:9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.10.10.9 sss.pigsty&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 其他节点将使用 sss.pigsty 域名来访问 MinIO</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=专用负载均衡>专用负载均衡</h2><p>Pigsty 允许用户使用专用的负载均衡服务器组，而不是集群本身来运行 VIP 与 HAProxy。例如 <a href=/docs/conf/pro><code>prod</code></a> 模板中就使用了这种方式。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>proxy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.18 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>nodename: proxy1 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>master }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.19 </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>nodename: proxy2 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>backup }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.20</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_services:      # expose minio service </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty:9002</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio       </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service name, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service port, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>leastconn</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Use leastconn algorithm and minio health check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;option httpchk&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;option http-keep-alive&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;http-check send meth OPTIONS uri /minio/health/live&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;http-check expect status 200&#34;</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>           </span><span style=color:#8f5902;font-style:italic># reload service with ./node.yml -t haproxy_config,haproxy_reload</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-1 ,ip: 10.10.10.21 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-2 ,ip: 10.10.10.22 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-3 ,ip: 10.10.10.23 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-4 ,ip: 10.10.10.24 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-5 ,ip: 10.10.10.25 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>在这种情况下，您通常还需要在全局修改 MinIO 域名的解析，将 <code>sss.pigsty</code> 指向负载均衡器的地址，并修改 <a href=/docs/minio/param#minio_endpoint><code>minio_endpoint</code></a> 参数，修改写入管理节点 MinIO Alias 对应的端点地址：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_endpoint: https://sss.pigsty:9002    # overwrite the defaults</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://sss.pigsty:9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>node_etc_hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.10.10.20 sss.pigsty&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># domain name to access minio from all nodes (required)</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=访问服务>访问服务</h2><p>如果您想要访问上面通过 HAProxy 暴露的 MinIO，以 PGSQL 备份配置为例，可以修改 <a href=/docs/pgsql/param#pgbackrest_repo><code>pgbackrest_repo</code></a> 中的配置，添加新的备份仓库定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 这是新添加的 HA MinIO Repo 定义，使用此配置代替之前的单机 MinIO 配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_ha</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>s3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-1.pigsty  </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># s3_endpoint 可以是任何一个负载均衡器：10.10.10.1{0,1,2}，或指向任意 3 个节点的域名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_region</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>us-east-1         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 你可以使用外部域名：sss.pigsty，该域名指向任一成员（`minio_domain`）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_bucket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 你可使用实例名和节点名：minio-1.pigsty minio-1.pigsty minio-1.pigsty minio-1 minio-2 minio-3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgbackrest           </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 最好为 MinIO 的 pgbackrest 用户使用专门的密码</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_key_secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.SomeNewPassWord</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>s3_uri_style</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>path</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/pgbackrest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>storage_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 使用负载均衡器的端口 9002 代替默认的 9000（直接访问）</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>storage_ca_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/pki/ca.crt</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>bundle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>y</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>cipher_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>aes-256-cbc     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 在您的生产环境中最好使用新的加密密码，这里可以使用集群名作为密码的一部分。</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>cipher_pass</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgBackRest.With.Some.Extra.PassWord.And.Salt.${pg_cluster}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>retention_full_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>time</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>retention_full</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=暴露管控>暴露管控</h2><p>MinIO 默认通过 <code>9001</code> 端口（由 <a href=/docs/minio/param#minio_admin_port><code>minio_admin_port</code></a> 参数指定）提供Web管控界面。</p><p>将后台管理界面暴露给外部可能存在安全隐患。如果你希望这样做，请将 MinIO 添加到 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 并刷新 Nginx 配置。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ./infra.yml -t nginx</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>infra_portal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home         </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>h.pigsty }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>grafana      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: g.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:3000&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>, websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vmetrics     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: v.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:8428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>alertmanager </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: a.pigsty ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9059&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>blackbox     </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9115&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vlogs        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;${admin_ip}:9428&#34;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># MinIO 管理页面需要 HTTPS / Websocket 才能工作</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio        </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m.pigsty     ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio10      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m10.pigsty   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.10:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio11      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m11.pigsty   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.11:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio12      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m12.pigsty   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.12:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>minio13      </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>domain: m13.pigsty   ,endpoint</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;10.10.10.13:9001&#34;</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>,scheme: https ,websocket</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>请注意，MinIO 管控页面需要使用 HTTPS，请 <strong>不要</strong> 在生产环境中暴露未加密的 MinIO 管控页面。</p><p>这意味着，您通常需要在您的 DNS 服务器，或者本机 <code>/etc/hosts</code> 中添加 <code>m.pigsty</code> 的解析记录，以便访问 MinIO 管控页面。</p><p>与此同时，如果您使用的是 Pigsty 自签名的 CA 而不是一个正规的公共 CA ，通常您还需要手工信任该 CA 或证书，才能跳过浏览器中的 “不安全” 提示信息。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-280b7e56b08e272d7b26411d506d6c5d>3 - 参数列表</h1><div class=lead>MinIO 模块提供了 21 个相关配置参数，用于定制所需的 MinIO 集群。</div><p>MinIO 模块的参数列表，共有 <strong>21</strong> 个参数，分为两个部分：</p><ul><li><a href=#minio><strong><code>MINIO</code></strong></a>：18 个参数，用于 MinIO 集群的部署与配置</li><li><a href=#minio_remove><strong><code>MINIO_REMOVE</code></strong></a>：3 个参数，控制 MinIO 集群的移除</li></ul><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>架构变化：Pigsty v3.6+</div><p>自 Pigsty v3.6 起，<code>minio.yml</code> 剧本不再包含移除功能，移除相关参数已迁移至独立的 <code>minio_remove</code> 角色和 <code>minio-rm.yml</code> 剧本。</p></div><hr><h2 id=参数概览>参数概览</h2><p><a href=#minio><code>MINIO</code></a> 参数组用于 MinIO 集群的部署与配置，包括身份标识、存储路径、端口、认证凭据以及存储桶和用户的置备。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#minio_seq><code>minio_seq</code></a></td><td style=text-align:center><code>int</code></td><td style=text-align:center><code>I</code></td><td style=text-align:left>minio 实例标识符，必填</td></tr><tr><td style=text-align:left><a href=#minio_cluster><code>minio_cluster</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 集群名称，默认为 minio</td></tr><tr><td style=text-align:left><a href=#minio_user><code>minio_user</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 操作系统用户，默认为 <code>minio</code></td></tr><tr><td style=text-align:left><a href=#minio_https><code>minio_https</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>是否为 MinIO 启用 HTTPS？默认为 true</td></tr><tr><td style=text-align:left><a href=#minio_node><code>minio_node</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 节点名模式</td></tr><tr><td style=text-align:left><a href=#minio_data><code>minio_data</code></a></td><td style=text-align:center><code>path</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 数据目录，使用 <code>{x...y}</code> 指定多个磁盘</td></tr><tr><td style=text-align:left><a href=#minio_volumes><code>minio_volumes</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 核心参数，指定成员节点与磁盘，默认不指定</td></tr><tr><td style=text-align:left><a href=#minio_domain><code>minio_domain</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>minio 外部域名，默认为 <code>sss.pigsty</code></td></tr><tr><td style=text-align:left><a href=#minio_port><code>minio_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 服务端口，默认为 9000</td></tr><tr><td style=text-align:left><a href=#minio_admin_port><code>minio_admin_port</code></a></td><td style=text-align:center><code>port</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 控制台端口，默认为 9001</td></tr><tr><td style=text-align:left><a href=#minio_access_key><code>minio_access_key</code></a></td><td style=text-align:center><code>username</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>根访问密钥，默认为 <code>minioadmin</code></td></tr><tr><td style=text-align:left><a href=#minio_secret_key><code>minio_secret_key</code></a></td><td style=text-align:center><code>password</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>根密钥，默认为 <code>S3User.MinIO</code></td></tr><tr><td style=text-align:left><a href=#minio_extra_vars><code>minio_extra_vars</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 服务器的额外环境变量</td></tr><tr><td style=text-align:left><a href=#minio_provision><code>minio_provision</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C</code></td><td style=text-align:left>是否执行 minio 资源置备任务？默认为 true</td></tr><tr><td style=text-align:left><a href=#minio_alias><code>minio_alias</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>G</code></td><td style=text-align:left>minio 部署的客户端别名</td></tr><tr><td style=text-align:left><a href=#minio_endpoint><code>minio_endpoint</code></a></td><td style=text-align:center><code>string</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>minio 部署的客户端别名对应的端点</td></tr><tr><td style=text-align:left><a href=#minio_buckets><code>minio_buckets</code></a></td><td style=text-align:center><code>bucket[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>待创建的 minio 存储桶列表</td></tr><tr><td style=text-align:left><a href=#minio_users><code>minio_users</code></a></td><td style=text-align:center><code>user[]</code></td><td style=text-align:center><code>C</code></td><td style=text-align:left>待创建的 minio 用户列表</td></tr></tbody></table><p><a href=#minio_remove><code>MINIO_REMOVE</code></a> 参数组控制 MinIO 集群的移除行为，包括防误删保险、数据清理以及软件包卸载。</p><table class=full-width><thead><tr><th style=text-align:left>参数</th><th style=text-align:center>类型</th><th style=text-align:center>级别</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><a href=#minio_safeguard><code>minio_safeguard</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>防止意外删除？默认为 false</td></tr><tr><td style=text-align:left><a href=#minio_rm_data><code>minio_rm_data</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>移除时是否删除 minio 数据？默认为 true</td></tr><tr><td style=text-align:left><a href=#minio_rm_pkg><code>minio_rm_pkg</code></a></td><td style=text-align:center><code>bool</code></td><td style=text-align:center><code>G/C/A</code></td><td style=text-align:left>移除时是否卸载 minio 软件包？默认为 false</td></tr></tbody></table><p>其中，<code>minio_volumes</code> 与 <code>minio_endpoint</code> 为自动生成的参数，但您可以显式覆盖指定这两个参数。</p><hr><h2 id=默认参数>默认参数</h2><p><code>MINIO</code>：18 个参数，定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/minio/defaults/main.yml><code>roles/minio/defaults/main.yml</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MINIO</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#minio_seq: 1                     # minio 实例标识符，必填</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio             </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 集群名称，默认为 minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio                </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 操作系统用户，默认为 `minio`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_https</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>                 </span><span style=color:#8f5902;font-style:italic># 是否为 MinIO 启用 HTTPS？默认为 true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_node</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 节点名模式</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data/minio&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># minio 数据目录，使用 `{x...y}` 指定多个磁盘</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#minio_volumes:                   # minio 核心参数，如果未指定，则使用拼接生成的默认值</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_domain</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss.pigsty         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 外部域名，默认为 `sss.pigsty`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8>                  </span><span style=color:#8f5902;font-style:italic># minio 服务端口，默认为 9000</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_admin_port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9001</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># minio 控制台端口，默认为 9001</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_access_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minioadmin     </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 根访问密钥，默认为 `minioadmin`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_secret_key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>S3User.MinIO   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># 根密钥，默认为 `S3User.MinIO`</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_extra_vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;&#39;</span><span style=color:#f8f8f8>              </span><span style=color:#8f5902;font-style:italic># minio 服务器的额外环境变量</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_provision</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>             </span><span style=color:#8f5902;font-style:italic># 是否执行 minio 资源置备任务？</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_alias</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>sss                 </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># minio 部署的客户端别名</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#minio_endpoint: https://sss.pigsty:9000 # minio 别名对应的接入点，如果未指定，则使用拼接生成的默认值</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                    </span><span style=color:#8f5902;font-style:italic># 待创建的 minio 存储桶列表</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,versioning</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>data }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                      </span><span style=color:#8f5902;font-style:italic># 待创建的 minio 用户列表</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest  ,secret_key: S3User.Backup ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: s3user_meta ,secret_key: S3User.Meta   ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: s3user_data ,secret_key: S3User.Data   ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>data  }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><code>MINIO_REMOVE</code>：3 个参数，定义于 <a href=https://github.com/pgsty/pigsty/blob/main/roles/minio_remove/defaults/main.yml><code>roles/minio_remove/defaults/main.yml</code></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MINIO_REMOVE</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#-----------------------------------------------------------------</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>            </span><span style=color:#8f5902;font-style:italic># 防止意外删除？默认为 false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_rm_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 移除时是否删除 minio 数据？默认为 true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_rm_pkg</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>               </span><span style=color:#8f5902;font-style:italic># 移除时是否卸载 minio 软件包？默认为 false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h2 id=minio><code>MINIO</code></h2><p>本节包含 <a href=https://github.com/pgsty/pigsty/blob/main/roles/minio/defaults/main.yml><code>minio</code></a> 角色的参数，
这些是 <a href=/docs/minio/playbook#minioyml><code>minio.yml</code></a> 剧本使用的操作标志参数。</p><h3 id=minio_seq><code>minio_seq</code></h3><p>参数名称： <code>minio_seq</code>， 类型： <code>int</code>， 层次：<code>I</code></p><p>MinIO 实例标识符，必需的身份参数。没有默认值，您必须手动分配这些序列号。</p><p>通常的最佳实践是，从 1 开始分配，依次加 1，并永远不使用已经分配的序列号。
序列号与集群名称 <a href=#minio_cluster><code>minio_cluster</code></a> 一起，唯一标识每一个 MinIO 实例（例如：<code>minio-1</code>）。</p><p>在多节点部署中，序列号还会用于生成节点名称，写入 <code>/etc/hosts</code> 文件中进行静态解析。</p><hr><h3 id=minio_cluster><code>minio_cluster</code></h3><p>参数名称： <code>minio_cluster</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>MinIO 集群名称，默认为 <code>minio</code>。当部署多个 MinIO 集群时，可以使用此参数进行区分。</p><p>集群名称与序列号 <a href=#minio_seq><code>minio_seq</code></a> 一起，唯一标识每一个 MinIO 实例。
例如，当集群名为 <code>minio</code>，序列号为 <code>1</code> 时，实例名称为 <code>minio-1</code>。</p><p>请注意，Pigsty 默认一套部署中只有一个 MinIO 集群。如果您需要部署多个 MinIO 集群，
需要显式设置 <a href=#minio_alias><code>minio_alias</code></a>、<a href=#minio_domain><code>minio_domain</code></a>、<a href=#minio_endpoint><code>minio_endpoint</code></a> 等参数以避免命名冲突。</p><hr><h3 id=minio_user><code>minio_user</code></h3><p>参数名称： <code>minio_user</code>， 类型： <code>username</code>， 层次：<code>C</code></p><p>MinIO 操作系统用户名，默认为 <code>minio</code>。</p><p>MinIO 服务将以此用户身份运行，该用户的家目录（默认为 <code>/home/minio</code>）中将存储 MinIO 使用的 SSL 证书（位于 <code>~/.minio/certs/</code> 目录下）。</p><hr><h3 id=minio_https><code>minio_https</code></h3><p>参数名称： <code>minio_https</code>， 类型： <code>bool</code>， 层次：<code>G/C</code></p><p>是否为 MinIO 服务启用 HTTPS？默认为 <code>true</code>，即使用 HTTPS。</p><p>请注意，pgBackREST 需要 MinIO 启用 HTTPS 才能正常工作。但如果您不使用 MinIO 进行 PostgreSQL 备份，且不需要使用 HTTPS，可以将此参数设置为 <code>false</code>。</p><p>启用 HTTPS 后，Pigsty 会自动为 MinIO 服务器签发 SSL 证书，证书包含 <a href=#minio_domain><code>minio_domain</code></a> 指定的域名以及各个节点的 IP 地址。</p><hr><h3 id=minio_node><code>minio_node</code></h3><p>参数名称： <code>minio_node</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>MinIO 节点名称模式，用于 <a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>多节点</a> 部署。</p><p>默认值为：<code>${minio_cluster}-${minio_seq}.pigsty</code>，即以实例名 + <code>.pigsty</code> 后缀作为默认的节点名。</p><p>在这里指定的域名模式将用于生成节点名，节点名将写入所有 MinIO 节点的 <code>/etc/hosts</code> 文件中。</p><hr><h3 id=minio_data><code>minio_data</code></h3><p>参数名称： <code>minio_data</code>， 类型： <code>path</code>， 层次：<code>C</code></p><p>MinIO 数据目录（们），默认值：<code>/data/minio</code>，这是 <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98>单节点</a> 部署的常见目录。</p><p>对于 <a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>多机多盘</a> 与 <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>单机多盘</strong></a> 部署，您可以使用 <code>{x...y}</code> 的记法来指定多个磁盘。</p><hr><h3 id=minio_volumes><code>minio_volumes</code></h3><p>参数名称： <code>minio_volumes</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>MinIO 核心参数，默认不指定留空，留空情况下，该参数会自动使用以下规则拼接生成：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;{% if minio_cluster_size|int &gt; 1 %}{% if minio_https|bool %}https{% else %}http{% endif %}://{{ minio_node|replace(&#39;${minio_cluster}&#39;, minio_cluster)|replace(&#39;${minio_seq}&#39;,minio_seq_range) }}:{{ minio_port|default(9000) }}{% endif %}{{ minio_data }}&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><ul><li>在单机部署（无论是单盘还是多盘）模式下，<code>minio_volumes</code> 直接使用 <a href=#minio_data><code>minio_data</code></a> 的值，进行单机部署。</li><li>在多机部署模式下，<code>minio_volumes</code> 会使用 <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code> 参数的值生成多节点的地址，用于多机部署。</li><li>在多池部署模式下，通常需要您直接指定并覆盖 <code>minio_volumes</code> 的值，以指定多个节点池的地址。</li></ul><p>指定本参数时，您需要确保使用的参数与 <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code> 三者匹配。</p><hr><h3 id=minio_domain><code>minio_domain</code></h3><p>参数名称： <code>minio_domain</code>， 类型： <code>string</code>， 层次：<code>G</code></p><p>MinIO 服务域名，默认为 <code>sss.pigsty</code>。</p><p>客户端可以通过此域名访问 MinIO S3 服务。此名称将注册到本地 DNSMASQ，并包含在 SSL 证书的 SAN（Subject Alternative Name）字段中。</p><p>建议在 <a href=/docs/node/param#node_etc_hosts><code>node_etc_hosts</code></a> 中添加静态解析记录，将此域名指向 MinIO 服务器节点的 IP 地址（单机部署），或负载均衡器的 VIP 地址（多节点部署）。</p><hr><h3 id=minio_port><code>minio_port</code></h3><p>参数名称： <code>minio_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>MinIO 服务端口，默认为 <code>9000</code>。</p><p>这是 MinIO S3 API 的监听端口，客户端通过此端口访问对象存储服务。在多节点部署中，此端口也用于节点间通信。</p><hr><h3 id=minio_admin_port><code>minio_admin_port</code></h3><p>参数名称： <code>minio_admin_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p><p>MinIO 控制台端口，默认为 <code>9001</code>。</p><p>这是 MinIO 内置 Web 管理控制台的监听端口。您可以通过 <code>https://&lt;minio-ip>:9001</code> 访问 MinIO 的图形化管理界面。</p><p>如果希望通过 Nginx 对外暴露 MinIO 控制台，可以将其添加到 <a href=/docs/infra/param#infra_portal><code>infra_portal</code></a> 中。请注意，MinIO 控制台需要使用 HTTPS 和 WebSocket。</p><hr><h3 id=minio_access_key><code>minio_access_key</code></h3><p>参数名称： <code>minio_access_key</code>， 类型： <code>username</code>， 层次：<code>C</code></p><p>根访问用户名（access key），默认为 <code>minioadmin</code>。</p><p>这是 MinIO 的超级管理员用户名，拥有对所有存储桶和对象的完全访问权限。建议在生产环境中修改此默认值。</p><hr><h3 id=minio_secret_key><code>minio_secret_key</code></h3><p>参数名称： <code>minio_secret_key</code>， 类型： <code>password</code>， 层次：<code>C</code></p><p>根访问密钥（secret key），默认为 <code>S3User.MinIO</code>。</p><p>这是 MinIO 超级管理员的密码，与 <a href=#minio_access_key><code>minio_access_key</code></a> 配合使用。</p><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>安全警告：请务必修改默认密码！</div><p>使用默认密码是高危行为！请务必在您的生产环境部署中修改此密码。</p><p>提示：执行 <code>./configure</code> 或 <code>./configure -g</code> 时，会自动修改配置文件模板中的这些默认密码。</p></div><hr><h3 id=minio_extra_vars><code>minio_extra_vars</code></h3><p>参数名称： <code>minio_extra_vars</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>MinIO 服务器的额外环境变量。查看 <a href=https://min.io/docs/minio/linux/reference/minio-server/minio-server.html>MinIO Server</a> 文档以获取完整列表。</p><p>默认值为空字符串，您可以使用多行字符串来传递多个环境变量。例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_extra_vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  MINIO_BROWSER_REDIRECT_URL=https://minio.example.com
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  MINIO_SERVER_URL=https://s3.example.com</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h3 id=minio_provision><code>minio_provision</code></h3><p>参数名称： <code>minio_provision</code>， 类型： <code>bool</code>， 层次：<code>G/C</code></p><p>是否执行 MinIO 资源置备任务？默认为 <code>true</code>。</p><p>当启用时，Pigsty 将自动创建 <a href=#minio_buckets><code>minio_buckets</code></a> 和 <a href=#minio_users><code>minio_users</code></a> 中定义的存储桶和用户。
如果您不需要自动置备这些资源，可以将此参数设置为 <code>false</code>。</p><hr><h3 id=minio_alias><code>minio_alias</code></h3><p>参数名称： <code>minio_alias</code>， 类型： <code>string</code>， 层次：<code>G</code></p><p>本地 MinIO 集群的 MinIO 客户端别名，默认值：<code>sss</code>。</p><p>此别名将被写入管理节点上管理员用户的 MinIO 客户端配置文件中（<code>~/.mcli/config.json</code>），
使您可以直接使用 <code>mcli &lt;alias></code> 命令访问 MinIO 集群，例如 <code>mcli ls sss/</code>。</p><p>如果部署多个 MinIO 集群，需要为每个集群指定不同的别名以避免冲突。</p><hr><h3 id=minio_endpoint><code>minio_endpoint</code></h3><p>参数名称：<code>minio_endpoint</code>， 类型： <code>string</code>， 层次：<code>C</code></p><p>部署的客户端别名对应的端点，如果指定，这里的 <code>minio_endpoint</code> （例如： <code>https://sss.pigsty:9002</code>）将会替代默认值，作为写入管理节点 MinIO Alias 的目标端点。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli <span style=color:#204a87>alias</span> <span style=color:#204a87>set</span> <span style=color:#ce5c00;font-weight:700>{{</span> minio_alias <span style=color:#ce5c00;font-weight:700>}}</span> <span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>if</span> minio_endpoint is defined and minio_endpoint !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span> %<span style=color:#ce5c00;font-weight:700>}{{</span> minio_endpoint <span style=color:#ce5c00;font-weight:700>}}{</span>% <span style=color:#204a87;font-weight:700>else</span> %<span style=color:#ce5c00;font-weight:700>}{</span>% <span style=color:#204a87;font-weight:700>if</span> minio_https<span style=color:#000;font-weight:700>|</span>bool %<span style=color:#ce5c00;font-weight:700>}</span>https<span style=color:#ce5c00;font-weight:700>{</span>% <span style=color:#204a87;font-weight:700>else</span> %<span style=color:#ce5c00;font-weight:700>}</span>http<span style=color:#ce5c00;font-weight:700>{</span>% endif %<span style=color:#ce5c00;font-weight:700>}</span>://<span style=color:#ce5c00;font-weight:700>{{</span> minio_domain <span style=color:#ce5c00;font-weight:700>}}</span>:<span style=color:#ce5c00;font-weight:700>{{</span> minio_port <span style=color:#ce5c00;font-weight:700>}}{</span>% endif %<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>{{</span> minio_access_key <span style=color:#ce5c00;font-weight:700>}}</span> <span style=color:#ce5c00;font-weight:700>{{</span> minio_secret_key <span style=color:#ce5c00;font-weight:700>}}</span>
</span></span></code></pre></div><p>以上 MinIO Alias 会在管理节点上以默认管理用户执行。</p><hr><h3 id=minio_buckets><code>minio_buckets</code></h3><p>参数名称： <code>minio_buckets</code>， 类型： <code>bucket[]</code>， 层次：<code>C</code></p><p>默认创建的 MinIO 存储桶列表：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: meta ,versioning</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>data }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认创建三个存储桶，各有不同的用途和策略：</p><ul><li><code>pgsql</code> 存储桶：默认用于 PostgreSQL 的 pgBackREST 备份存储。</li><li><code>meta</code> 存储桶：开放式存储桶，启用了版本控制（versioning），适合存储需要版本管理的重要元数据。</li><li><code>data</code> 存储桶：开放式存储桶，用于其他用途，例如 Supabase 模板可能使用此存储桶存储业务数据。</li></ul><p>每个存储桶都会创建一个同名的访问策略，例如 <code>pgsql</code> 策略拥有对 <code>pgsql</code> 存储桶的所有权限，以此类推。</p><p>您还可以在存储桶定义中添加 <code>lock</code> 标志，启用对象锁定功能，防止存储桶中的对象被意外删除。</p><hr><h3 id=minio_users><code>minio_users</code></h3><p>参数名称： <code>minio_users</code>， 类型： <code>user[]</code>， 层次：<code>C</code></p><p>要创建的 MinIO 用户列表，默认值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest  ,secret_key: S3User.Backup ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: s3user_meta ,secret_key: S3User.Meta   ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>meta  }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: s3user_data ,secret_key: S3User.Data   ,policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>data  }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>默认配置会创建三个用户，分别对应三个默认存储桶：</p><ul><li><code>pgbackrest</code>：用于 PostgreSQL pgBackREST 备份，拥有 <code>pgsql</code> 存储桶的访问权限。</li><li><code>s3user_meta</code>：用于访问 <code>meta</code> 存储桶。</li><li><code>s3user_data</code>：用于访问 <code>data</code> 存储桶。</li></ul><div class="alert alert-danger" role=alert><div class="h4 alert-heading" role=heading>使用默认密码是高危行为！请务必在您的部署中调整这些凭证！</div><p>提示：<code>./configure -g</code> 会默认修改配置文件模板中的这些密码，如果这些默认密码出现在模版文件中。</p></div><hr><h2 id=minio_remove><code>MINIO_REMOVE</code></h2><p>本节包含 <a href=https://github.com/pgsty/pigsty/blob/main/roles/minio_remove/defaults/main.yml><code>minio_remove</code></a> 角色的参数，
这些是 <a href=/docs/minio/playbook#minio-rmyml><code>minio-rm.yml</code></a> 剧本使用的操作标志参数。</p><h3 id=minio_safeguard><code>minio_safeguard</code></h3><p>参数名称： <code>minio_safeguard</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>防止意外删除的保险开关，默认值为 <code>false</code>。</p><p>如果启用此参数，<a href=/docs/minio/playbook/#minio-rmyml><code>minio-rm.yml</code></a> 剧本将中止并拒绝移除 MinIO 集群，从而提供防止意外删除的保护。</p><p>建议在生产环境中启用此保险开关，防止误操作导致数据丢失：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 启用后，minio-rm.yml 将拒绝执行</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><hr><h3 id=minio_rm_data><code>minio_rm_data</code></h3><p>参数名称： <code>minio_rm_data</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>移除时是否删除 MinIO 数据？默认值为 <code>true</code>。</p><p>当启用时，<a href=/docs/minio/playbook/#minio-rmyml><code>minio-rm.yml</code></a> 剧本将在集群移除过程中删除 MinIO 数据目录和配置文件。</p><hr><h3 id=minio_rm_pkg><code>minio_rm_pkg</code></h3><p>参数名称： <code>minio_rm_pkg</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p><p>移除时是否卸载 MinIO 软件包？默认值为 <code>false</code>。</p><p>当启用时，<a href=/docs/minio/playbook/#minio-rmyml><code>minio-rm.yml</code></a> 剧本将在集群移除过程中卸载 MinIO 软件包。默认禁用此选项，以便保留 MinIO 安装供将来可能的使用。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ccc1805ae841df3ebaeb7bb6b8008203>4 - 预置剧本</h1><div class=lead>如何使用预置的 ansible 剧本来管理 MinIO 集群，常用管理命令速查。</div><p>MinIO 模块提供了两个内置剧本用于集群管理：</p><ul><li><a href=#minioyml><code>minio.yml</code></a>：用于安装 MinIO 集群</li><li><a href=#minio-rmyml><code>minio-rm.yml</code></a>：用于移除 MinIO 集群</li></ul><hr><h2 id=minioyml><code>minio.yml</code></h2><p>剧本 <a href=https://github.com/pgsty/pigsty/blob/main/minio.yml><code>minio.yml</code></a> 用于在节点上安装 MinIO 模块。</p><ul><li><code>minio-id</code> : 生成/校验 minio 身份参数</li><li><code>minio_install</code> : 安装 minio<ul><li><code>minio_os_user</code> : 创建操作系统用户 minio</li><li><code>minio_pkg</code> : 安装 minio/mcli 软件包</li><li><code>minio_dir</code> : 创建 minio 目录</li></ul></li><li><code>minio_config</code> : 生成 minio 配置<ul><li><code>minio_conf</code> : minio 主配置文件</li><li><code>minio_cert</code> : minio SSL 证书签发</li><li><code>minio_dns</code> : minio DNS 记录插入</li></ul></li><li><code>minio_launch</code> : minio 服务启动</li><li><code>minio_register</code> : minio 纳入监控</li><li><code>minio_provision</code> : 创建 minio 别名/存储桶/业务用户<ul><li><code>minio_alias</code> : 创建 minio 客户端别名（管理节点上）</li><li><code>minio_bucket</code> : 创建 minio 存储桶</li><li><code>minio_user</code> : 创建 minio 业务用户</li></ul></li></ul><p>在执行剧本前，请先在 <a href=/docs/setup/config>配置清单</a> 中，完成 MinIO 集群的 <a href=/docs/minio/config/>配置</a>。</p><div class="alert alert-primary" role=alert><div class="h4 alert-heading" role=heading>执行条件</div><p>剧本会自动跳过未定义 <a href=/docs/minio/param#minio_seq><code>minio_seq</code></a> 的主机。这意味着您可以安全地在混合主机组上执行剧本，只有真正的 MinIO 节点才会被处理。</p></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>架构变更：Pigsty v3.6+</div><p>从 Pigsty v3.6 开始，<strong>minio.yml</strong> 剧本专注于集群安装。所有移除操作已迁移至专用的 <strong>minio-rm.yml</strong> 剧本，使用 <strong>minio_remove</strong> 角色执行。</p></div><hr><h2 id=minio-rmyml><code>minio-rm.yml</code></h2><p>剧本 <a href=https://github.com/pgsty/pigsty/blob/main/minio-rm.yml><code>minio-rm.yml</code></a> 用于移除 MinIO 集群。</p><ul><li><code>minio-id</code> : 生成 minio 身份参数用于移除操作（启用 <code>any_errors_fatal</code>，身份验证失败时立即停止）</li><li><code>minio_safeguard</code> : 安全检查，防止意外删除（默认：<code>false</code>）</li><li><code>minio_pause</code> : 暂停 3 秒，允许用户中止操作（Ctrl+C 可取消）</li><li><code>minio_deregister</code> : 从 Victoria/Prometheus 监控中移除目标，清理 DNS 记录</li><li><code>minio_svc</code> : 停止并禁用 minio systemd 服务</li><li><code>minio_data</code> : 移除 minio 数据目录（可通过 <code>minio_rm_data=false</code> 禁用）</li><li><code>minio_pkg</code> : 卸载 minio 软件包（可通过 <code>minio_rm_pkg=true</code> 启用）</li></ul><div class="alert alert-primary" role=alert><div class="h4 alert-heading" role=heading>执行条件与安全机制</div><ul><li>剧本会自动跳过未定义 <a href=/docs/minio/param#minio_seq><code>minio_seq</code></a> 的主机，防止误操作非 MinIO 节点</li><li>身份验证阶段启用了 <code>any_errors_fatal</code>，一旦检测到无效的 MinIO 身份，剧本会立即停止</li><li>移除前会暂停 3 秒，给用户提供中止操作的机会</li></ul></div><p>移除剧本使用 <strong>minio_remove</strong> 角色，支持以下 <a href=/docs/minio/param>可配置参数</a>：</p><ul><li><a href=/docs/minio/param#minio_safeguard><code>minio_safeguard</code></a>：设置为 <code>true</code> 时阻止意外删除</li><li><a href=/docs/minio/param#minio_rm_data><code>minio_rm_data</code></a>：控制是否删除 MinIO 数据（默认 <code>true</code>）</li><li><a href=/docs/minio/param#minio_rm_pkg><code>minio_rm_pkg</code></a>：控制是否卸载 MinIO 软件包（默认 <code>false</code>）</li></ul><hr><h2 id=命令速查>命令速查</h2><p>MINIO 剧本常用命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l &lt;cls&gt;                      <span style=color:#8f5902;font-style:italic># 在 &lt;cls&gt; 分组上安装 MINIO 模块</span>
</span></span><span style=display:flex><span>./minio.yml -l minio -t minio_install     <span style=color:#8f5902;font-style:italic># 在节点上安装 MinIO 服务，准备数据目录，但不配置启动</span>
</span></span><span style=display:flex><span>./minio.yml -l minio -t minio_config      <span style=color:#8f5902;font-style:italic># 重新配置 MinIO 集群</span>
</span></span><span style=display:flex><span>./minio.yml -l minio -t minio_launch      <span style=color:#8f5902;font-style:italic># 重启 MinIO 集群</span>
</span></span><span style=display:flex><span>./minio.yml -l minio -t minio_provision   <span style=color:#8f5902;font-style:italic># 重新执行资源置备（创建存储桶和用户）</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio                   <span style=color:#8f5902;font-style:italic># 移除 MinIO 集群（使用专用移除剧本）</span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>  <span style=color:#8f5902;font-style:italic># 移除集群但保留数据</span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>    <span style=color:#8f5902;font-style:italic># 移除集群并卸载软件包</span>
</span></span></code></pre></div><hr><h2 id=保护机制>保护机制</h2><p>出于防止误删的目的，Pigsty 的 MINIO 模块提供了防误删保险，由参数 <a href=/docs/minio/param#minio_safeguard><code>minio_safeguard</code></a> 控制。</p><p>默认情况下，<code>minio_safeguard</code> 为 <code>false</code>，允许执行移除操作。如果您希望保护 MinIO 集群不被意外删除，可以在配置清单中启用此保险：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio_safeguard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>   </span><span style=color:#8f5902;font-style:italic># 启用后，minio-rm.yml 将拒绝执行</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>如果您确实需要移除受保护的集群，可以在执行时使用命令行参数覆盖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_safeguard</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span></code></pre></div><hr><h2 id=执行演示>执行演示</h2><p><a href=https://asciinema.org/a/566415><img src=https://asciinema.org/a/566415.svg alt=asciicast></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-172708bf70f3c5729ee49aac66787c09>5 - 管理预案</h1><div class=lead>MinIO 集群管理 SOP：创建，销毁，扩容，缩容，节点故障与磁盘故障的处理。</div><hr><h2 id=创建集群>创建集群</h2><p>要创建一个集群，在配置清单中定义好后，执行 <a href=/docs/minio/playbook#minioyml><code>minio.yml</code></a> 剧本即可。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 } }, vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio } }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>例如，上面的配置定义了一个 SNSD <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98>单机单盘</a> MinIO 集群，使用以下命令即可创建该 MinIO 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio  <span style=color:#8f5902;font-style:italic># 在 minio 分组上安装 MinIO 模块 </span>
</span></span></code></pre></div><hr><h2 id=销毁集群>销毁集群</h2><p>要销毁一个集群，执行专用的 <a href=/docs/minio/playbook#minio-rmyml><code>minio-rm.yml</code></a> 剧本即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio-rm.yml -l minio                   <span style=color:#8f5902;font-style:italic># 移除 MinIO 集群</span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>  <span style=color:#8f5902;font-style:italic># 移除集群但保留数据</span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_rm_pkg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>    <span style=color:#8f5902;font-style:italic># 移除集群并卸载软件包</span>
</span></span></code></pre></div><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>架构变更：Pigsty v3.6+</div><p>从 Pigsty v3.6 开始，集群移除操作已从 <code>minio.yml</code> 剧本迁移至专用的 <code>minio-rm.yml</code> 剧本。旧的 <code>minio_clean</code> 任务已被弃用。</p></div><p>移除剧本会自动完成以下操作：</p><ul><li>从 Victoria/Prometheus 监控系统中注销 MinIO 目标</li><li>从 INFRA 节点的 DNS 服务中移除记录</li><li>停止并禁用 MinIO systemd 服务</li><li>删除 MinIO 数据目录和配置文件（可选）</li><li>卸载 MinIO 软件包（可选）</li></ul><hr><h2 id=集群扩容>集群扩容</h2><ul><li><a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html>集群扩容教程</a></li></ul><p>MinIO 无法在节点/磁盘级别上扩容，但可以在存储池（多个节点）层次上进行扩容。</p><p>现在假设您有 <a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98>这样一个</a> 四节点的 MinIO 集群，希望扩容一倍，新增一个四节点的存储池。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 2 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 3 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-3 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 4 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-4 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_buckets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pgsql }, { name: infra }, { name: redis } ]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: dba , secret_key: S3User.DBA, policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>consoleAdmin }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>readwrite }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>node_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_vrid</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10.10.10.9</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>vip_interface</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>eth1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># expose minio service with haproxy on all nodes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>haproxy_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service name, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service port, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>leastconn            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] load balancer algorithm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] minio health check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>option httpchk</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>option http-keep-alive</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>http-check send meth OPTIONS uri /minio/health/live</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- <span style=color:#000>http-check expect status 200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>首先，修改 MinIO 集群定义，新增四台节点，按顺序分配序列号 5 到 8。
这里的关键一步是修改 <a href=/docs/minio/param#minio_volumes><code>minio_volumes</code></a> 参数，将新的四个节点指定为一个新的 <strong>存储池</strong>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>minio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.10</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 1 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-1 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 2 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-2 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 3 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-3 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.13</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 4 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-4 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># 新增的四个节点</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.14</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 5 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-5 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.15</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 6 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-6 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.16</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 7 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-7 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>10.10.10.17</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>minio_seq: 8 , nodename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio-8 }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>vars</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_cluster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;/data{1...4}&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>minio_volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># 新增的集群配置</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># …… 省略其他配置</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>第二步，将这些节点交由 Pigsty 纳管：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17
</span></span></code></pre></div><p>第三步，在新节点上，使用 Ansible <a href=/docs/minio/playbook/>剧本</a> 安装并准备 MinIO 软件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17 -t minio_install
</span></span></code></pre></div><p>第四步，在 <strong>整个集群</strong> 上，使用 Ansible <a href=/docs/minio/playbook/>剧本</a> 重新配置 MinIO 集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio -t minio_config
</span></span></code></pre></div><blockquote><p>这一步会更新现有四个节点的 <code>MINIO_VOLUMES</code> 配置</p></blockquote><p>第五步，一次性重启整个 MinIO 集群（请注意，不要滚动重启！）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio -t minio_launch -f <span style=color:#0000cf;font-weight:700>10</span>   <span style=color:#8f5902;font-style:italic># 8并发数，确保同时重启</span>
</span></span></code></pre></div><p>第六步（可选）：如果您使用了负载均衡，那么请确保负载均衡器的配置也已经更新。例如，将新的四个节点加入到负载均衡器的配置中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># expose minio service with haproxy on all nodes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>haproxy_services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio                   </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service name, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>9002</span><span style=color:#f8f8f8>                     </span><span style=color:#8f5902;font-style:italic># [REQUIRED] service port, unique</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>balance</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>leastconn            </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] load balancer algorithm</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># [OPTIONAL] minio health check</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>option httpchk</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>option http-keep-alive</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>http-check send meth OPTIONS uri /minio/health/live</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>http-check expect status 200</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>servers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-5 ,ip: 10.10.10.14 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-6 ,ip: 10.10.10.15 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-7 ,ip: 10.10.10.16 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- {<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>name: minio-8 ,ip: 10.10.10.17 ,port: 9000 ,options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style=color:#f8f8f8> </span>}<span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>然后，执行 <code>node.yml</code> 剧本的 <code>haproxy</code> 子任务，更新负载均衡器配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -l minio -t haproxy_config,haproxy_reload   <span style=color:#8f5902;font-style:italic># 更新负载均衡器配置并在线加载</span>
</span></span></code></pre></div><p>如果您使用 L2 VIP 来确保可靠的负载均衡器接入，那么还需要将新的节点（如果有）加入到现有 NODE VIP 分组中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./node.yml -l minio -t node_vip  <span style=color:#8f5902;font-style:italic># 刷新集群 L2 VIP 配置 </span>
</span></span></code></pre></div><hr><h2 id=集群缩容>集群缩容</h2><p>MinIO 无法在节点/磁盘级别上缩容，但可以在存储池（多个节点）层次上进行退役 —— 新增一个新存储池，将旧存储池排干迁移到新存储池，然后将旧存储池退役。</p><ul><li><a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/decommission-server-pool.html>集群缩容教程</a></li></ul><hr><h2 id=集群升级>集群升级</h2><ul><li><a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/upgrade-minio-deployment.html>集群升级教程</a></li></ul><p>首先，将新版本的 MinIO 软件包下载至 INFRA 节点的本地软件仓库，然后重建软件仓库索引：</p><p>从 Pigsty v4.1 开始，建议优先使用 Pigsty Infra 软件源中的 <code>minio</code> / <code>mcli</code> 包（由 Pigsty 维护构建），
同步到本地仓库后重建索引：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./infra.yml -t repo_create
</span></span></code></pre></div><p>其次，使用 Ansible 批量升级 MinIO 软件包版本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible minio -m package -b -a <span style=color:#4e9a06>&#39;name=minio state=latest&#39;</span>  <span style=color:#8f5902;font-style:italic># 升级 MinIO 服务器软件版本</span>
</span></span><span style=display:flex><span>ansible minio -m package -b -a <span style=color:#4e9a06>&#39;name=mcli state=latest&#39;</span>   <span style=color:#8f5902;font-style:italic># 升级 MinIO 客户端软件版本</span>
</span></span></code></pre></div><p>最后，使用 mcli 命令行工具通知 MinIO 集群重启：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcli admin service restart sss
</span></span></code></pre></div><hr><h2 id=替换故障节点>替换故障节点</h2><ul><li><a href=https://min.io/docs/minio/linux/operations/data-recovery/recover-after-node-failure.html#minio-restore-hardware-failure-node>节点故障教程</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 从集群中下线故障节点</span>
</span></span><span style=display:flex><span>bin/node-rm &lt;your_old_node_ip&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 替换故障节点，使用原来的节点名称（如果IP变化，您需要修改 MinIO 集群定义）</span>
</span></span><span style=display:flex><span>bin/node-add &lt;your_new_node_ip&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 在新节点上安装配置 MinIO</span>
</span></span><span style=display:flex><span>./minio.yml -l &lt;your_new_node_ip&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 指示 MinIO 执行恢复动作</span>
</span></span><span style=display:flex><span>mcli admin heal
</span></span></code></pre></div><hr><h2 id=替换故障磁盘>替换故障磁盘</h2><ul><li><a href=https://min.io/docs/minio/linux/operations/data-recovery/recover-after-drive-failure.html#minio-restore-hardware-failure-drive>磁盘故障教程</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. 从集群中删除故障磁盘</span>
</span></span><span style=display:flex><span>umount /dev/&lt;your_disk_device&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. 替换故障磁盘，使用xfs格盘</span>
</span></span><span style=display:flex><span>mkfs.xfs /dev/sdb -L DRIVE1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 3. 不要忘记设置开机自动挂载</span>
</span></span><span style=display:flex><span>vi /etc/fstab
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># LABEL=DRIVE1     /mnt/drive1    xfs     defaults,noatime  0       2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 4. 重新挂载</span>
</span></span><span style=display:flex><span>mount -a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 5. 指示 MinIO 执行恢复动作</span>
</span></span><span style=display:flex><span>mcli admin heal
</span></span></code></pre></div><hr><h2 id=管理-minio-密码>管理 MinIO 密码</h2><p><a href=/docs/minio/param#minio_secret_key><strong><code>minio_secret_key</code></strong></a>（默认 <code>S3User.MinIO</code>）是 MinIO root 用户密码，渲染到 <code>/etc/default/minio</code> 中。</p><p>修改密码后，使用以下命令刷新配置并重启服务（需同时重启整个集群）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio.yml -l minio -t minio_config,minio_launch,minio_alias -f <span style=color:#0000cf;font-weight:700>30</span>  <span style=color:#8f5902;font-style:italic># 重新渲染配置文件，写入 Alias</span>
</span></span></code></pre></div><p>如果要修改 MinIO 普通用户的密码，例如 <code>pgbackrest</code> 用户的密码，请在可以访问 MinIO 的节点上（比如管理节点的管理用户）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>set</span> +o <span style=color:#204a87>history</span>
</span></span><span style=display:flex><span>mcli admin user passwd sss pgbackrest &lt;YOUR_NEW_PASSWORD&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> -o <span style=color:#204a87>history</span>
</span></span></code></pre></div><p>然后，你还需要修改引用该用户密码的所有配置，例如，当你的 pgBackRest 使用 MinIO 作为备份仓库时（<a href=/docs/pgsql/param#pgbackrest_method><strong><code>pgbackrest_method</code></strong></a> 设置为 <code>minio</code>），需要更新 pgBackRest 的 MinIO 访问密钥密码：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./pgsql.yml -t pgbackrest_config
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-81383092950ff4115e1c3850be65d36f>6 - 监控告警</h1><div class=lead>如何在 Pigsty 中监控 MinIO？如何使用 MinIO 本身的管控面板？有哪些告警规则值得关注？</div><hr><h2 id=内置控制台>内置控制台</h2><p>MinIO 内置了一个相当不错的管控界面，默认您可以通过任意 MinIO 实例的管控端口 （<a href=/docs/minio/param#minio_admin_port><code>minio_admin_port</code></a> ，默认为 <code>9001</code>），使用 HTTPS 访问此界面。</p><p>在大多数提供 MinIO 服务的配置模板中，MinIO 都会以 <code>m.pigsty</code> 的自定义服务对外暴露。在配置域名解析后，您可以通过 <code>https://m.pigsty</code> 访问 MinIO 管控界面。</p><p>使用 <a href=/docs/minio/param#minio_access_key><code>minio_access_key</code></a> 和 <a href=/docs/minio/param#minio_secret_key><code>minio_secret_key</code></a> 配置的管理员凭证登录（默认为 <code>minioadmin</code> / <code>S3User.MinIO</code>）。</p><div class="alert alert-info" role=alert><div class="h4 alert-heading" role=heading>注意：HTTPS 与证书信任</div><p>MinIO 控制台需要 HTTPS 访问。如果您使用 Pigsty 自签名 CA，需要在浏览器中信任该 CA 证书，或者手动接受安全警告。</p></div><hr><h2 id=pigsty监控>Pigsty监控</h2><p>Pigsty 提供了两个与 <a href=/docs/minio><code>MINIO</code></a> 模块有关的监控面板：</p><ul><li><a href=https://demo.pigsty.cc/d/minio-overview>MinIO Overview</a>：展示 MinIO 集群的整体监控指标，包括集群状态、存储使用量、请求速率等。</li><li><a href=https://demo.pigsty.cc/d/minio-instance>MinIO Instance</a>：展示单个 MinIO 实例的监控指标详情，包括 CPU、内存、网络、磁盘等。</li></ul><p><a href=https://demo.pigsty.cc/d/minio-overview><img src=/img/dashboard/minio-overview.jpg alt=minio-overview.jpg></a></p><p>MinIO 监控指标通过 MinIO 原生的 Prometheus 端点（<code>/minio/v2/metrics/cluster</code>）采集，默认由 Victoria Metrics 抓取并存储。</p><hr><h2 id=pigsty告警>Pigsty告警</h2><p>Pigsty 针对 MinIO 提供了以下三条告警规则，分别是：</p><ul><li>MinIO 宕机</li><li>MinIO 节点离线</li><li>MinIO 磁盘离线</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                         Aliveness                            #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MinIO server instance down</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MinioServerDown</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio_up &lt; 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>1m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 0, severity: CRIT, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;CRIT MinioServerDown {{ $labels.ins }}@{{ $labels.instance }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      minio_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value }} &lt; 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/minio-overview</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#                         Error                                #</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#==============================================================#</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MinIO node offline triggers a p1 alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MinioNodeOffline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>avg_over_time(minio_cluster_nodes_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>3m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 1, severity: WARN, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WARN MinioNodeOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      minio_cluster_nodes_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># MinIO disk offline triggers a p1 alert</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>MinioDiskOffline</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>avg_over_time(minio_cluster_disk_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>3m</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span>{<span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>level: 1, severity: WARN, category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>minio }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;WARN MinioDiskOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      minio_cluster_disk_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /ui/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-61857417600e2adc512dcba599edd776>7 - 指标列表</h1><div class=lead>Pigsty MINIO 模块提供的完整监控指标列表与释义</div><p><a href=/docs/minio><strong><code>MINIO</code></strong></a> 模块包含有 79 类可用监控指标。</p><table class=full-width><thead><tr><th>Metric Name</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td>minio_audit_failed_messages</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of messages that failed to send since start</td></tr><tr><td>minio_audit_target_queue_length</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of unsent messages in queue for target</td></tr><tr><td>minio_audit_total_messages</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of messages sent since start</td></tr><tr><td>minio_cluster_bucket_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of buckets in the cluster</td></tr><tr><td>minio_cluster_capacity_raw_free_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total free capacity online in the cluster</td></tr><tr><td>minio_cluster_capacity_raw_total_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total capacity online in the cluster</td></tr><tr><td>minio_cluster_capacity_usable_free_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total free usable capacity online in the cluster</td></tr><tr><td>minio_cluster_capacity_usable_total_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total usable capacity online in the cluster</td></tr><tr><td>minio_cluster_drive_offline_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total drives offline in this cluster</td></tr><tr><td>minio_cluster_drive_online_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total drives online in this cluster</td></tr><tr><td>minio_cluster_drive_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total drives in this cluster</td></tr><tr><td>minio_cluster_health_erasure_set_healing_drives</td><td>gauge</td><td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get the count of healing drives of this erasure set</td></tr><tr><td>minio_cluster_health_erasure_set_online_drives</td><td>gauge</td><td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get the count of the online drives in this erasure set</td></tr><tr><td>minio_cluster_health_erasure_set_read_quorum</td><td>gauge</td><td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get the read quorum for this erasure set</td></tr><tr><td>minio_cluster_health_erasure_set_status</td><td>gauge</td><td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get current health status for this erasure set</td></tr><tr><td>minio_cluster_health_erasure_set_write_quorum</td><td>gauge</td><td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get the write quorum for this erasure set</td></tr><tr><td>minio_cluster_health_status</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Get current cluster health status</td></tr><tr><td>minio_cluster_nodes_offline_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of MinIO nodes offline</td></tr><tr><td>minio_cluster_nodes_online_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of MinIO nodes online</td></tr><tr><td>minio_cluster_objects_size_distribution</td><td>gauge</td><td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Distribution of object sizes across a cluster</td></tr><tr><td>minio_cluster_objects_version_distribution</td><td>gauge</td><td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Distribution of object versions across a cluster</td></tr><tr><td>minio_cluster_usage_deletemarker_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of delete markers in a cluster</td></tr><tr><td>minio_cluster_usage_object_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of objects in a cluster</td></tr><tr><td>minio_cluster_usage_total_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total cluster usage in bytes</td></tr><tr><td>minio_cluster_usage_version_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of versions (includes delete marker) in a cluster</td></tr><tr><td>minio_cluster_webhook_failed_messages</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of messages that failed to send</td></tr><tr><td>minio_cluster_webhook_online</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Is the webhook online?</td></tr><tr><td>minio_cluster_webhook_queue_length</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Webhook queue length</td></tr><tr><td>minio_cluster_webhook_total_messages</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of messages sent to this target</td></tr><tr><td>minio_cluster_write_quorum</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Maximum write quorum across all pools and sets</td></tr><tr><td>minio_node_file_descriptor_limit_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Limit on total number of open file descriptors for the MinIO Server process</td></tr><tr><td>minio_node_file_descriptor_open_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of open file descriptors by the MinIO Server process</td></tr><tr><td>minio_node_go_routine_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of go routines running</td></tr><tr><td>minio_node_ilm_expiry_pending_tasks</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of pending ILM expiry tasks in the queue</td></tr><tr><td>minio_node_ilm_transition_active_tasks</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of active ILM transition tasks</td></tr><tr><td>minio_node_ilm_transition_missed_immediate_tasks</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of missed immediate ILM transition tasks</td></tr><tr><td>minio_node_ilm_transition_pending_tasks</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of pending ILM transition tasks in the queue</td></tr><tr><td>minio_node_ilm_versions_scanned</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of object versions checked for ilm actions since server start</td></tr><tr><td>minio_node_io_rchar_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total bytes read by the process from the underlying storage system including cache, /proc/[pid]/io rchar</td></tr><tr><td>minio_node_io_read_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total bytes read by the process from the underlying storage system, /proc/[pid]/io read_bytes</td></tr><tr><td>minio_node_io_wchar_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total bytes written by the process to the underlying storage system including page cache, /proc/[pid]/io wchar</td></tr><tr><td>minio_node_io_write_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total bytes written by the process to the underlying storage system, /proc/[pid]/io write_bytes</td></tr><tr><td>minio_node_process_cpu_total_seconds</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total user and system CPU time spent in seconds</td></tr><tr><td>minio_node_process_resident_memory_bytes</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Resident memory size in bytes</td></tr><tr><td>minio_node_process_starttime_seconds</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Start time for MinIO process per node, time in seconds since Unix epoc</td></tr><tr><td>minio_node_process_uptime_seconds</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Uptime for MinIO process per node in seconds</td></tr><tr><td>minio_node_scanner_bucket_scans_finished</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of bucket scans finished since server start</td></tr><tr><td>minio_node_scanner_bucket_scans_started</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of bucket scans started since server start</td></tr><tr><td>minio_node_scanner_directories_scanned</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of directories scanned since server start</td></tr><tr><td>minio_node_scanner_objects_scanned</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of unique objects scanned since server start</td></tr><tr><td>minio_node_scanner_versions_scanned</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of object versions scanned since server start</td></tr><tr><td>minio_node_syscall_read_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total read SysCalls to the kernel. /proc/[pid]/io syscr</td></tr><tr><td>minio_node_syscall_write_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total write SysCalls to the kernel. /proc/[pid]/io syscw</td></tr><tr><td>minio_notify_current_send_in_progress</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Number of concurrent async Send calls active to all targets (deprecated, please use &lsquo;minio_notify_target_current_send_in_progress&rsquo; instead)</td></tr><tr><td>minio_notify_events_errors_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Events that were failed to be sent to the targets (deprecated, please use &lsquo;minio_notify_target_failed_events&rsquo; instead)</td></tr><tr><td>minio_notify_events_sent_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of events sent to the targets (deprecated, please use &lsquo;minio_notify_target_total_events&rsquo; instead)</td></tr><tr><td>minio_notify_events_skipped_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Events that were skipped to be sent to the targets due to the in-memory queue being full</td></tr><tr><td>minio_s3_requests_4xx_errors_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td><td>Total number of S3 requests with (4xx) errors</td></tr><tr><td>minio_s3_requests_errors_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td><td>Total number of S3 requests with (4xx and 5xx) errors</td></tr><tr><td>minio_s3_requests_incoming_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of incoming S3 requests</td></tr><tr><td>minio_s3_requests_inflight_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td><td>Total number of S3 requests currently in flight</td></tr><tr><td>minio_s3_requests_rejected_auth_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of S3 requests rejected for auth failure</td></tr><tr><td>minio_s3_requests_rejected_header_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of S3 requests rejected for invalid header</td></tr><tr><td>minio_s3_requests_rejected_invalid_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of invalid S3 requests</td></tr><tr><td>minio_s3_requests_rejected_timestamp_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of S3 requests rejected for invalid timestamp</td></tr><tr><td>minio_s3_requests_total</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td><td>Total number of S3 requests</td></tr><tr><td>minio_s3_requests_ttfb_seconds_distribution</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>le</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td><td>Distribution of time to first byte across API calls</td></tr><tr><td>minio_s3_requests_waiting_total</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of S3 requests in the waiting queue</td></tr><tr><td>minio_s3_traffic_received_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of s3 bytes received</td></tr><tr><td>minio_s3_traffic_sent_bytes</td><td>counter</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Total number of s3 bytes sent</td></tr><tr><td>minio_software_commit_info</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>commit</code>, <code>server</code>, <code>ins</code></td><td>Git commit hash for the MinIO release</td></tr><tr><td>minio_software_version_info</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>version</code>, <code>server</code>, <code>ins</code></td><td>MinIO Release tag for the server</td></tr><tr><td>minio_up</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr><tr><td>minio_usage_last_activity_nano_seconds</td><td>gauge</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td><td>Time elapsed (in nano seconds) since last scan activity.</td></tr><tr><td>scrape_duration_seconds</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr><tr><td>scrape_samples_post_metric_relabeling</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr><tr><td>scrape_samples_scraped</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr><tr><td>scrape_series_added</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr><tr><td>up</td><td>Unknown</td><td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td><td>N/A</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-571982477397f0d78a3a5034a4ef3e1d>8 - 常见问题</h1><div class=lead>Pigsty MINIO 对象存储模块常见问题答疑</div><hr><h2 id=pigsty-使用的-minio-是什么版本>Pigsty 使用的 MinIO 是什么版本？</h2><p>MinIO 于 2025-12-03 宣布进入 <strong>维护模式</strong>，不再发布新的功能版本，只会发布安全补丁与维护版本，并且在 2025-10-15 停止发布二进制 RPM/DEB。
所以 Pigsty fork 了自己的 <a href=https://github.com/pgsty/minio>MinIO</a>，并使用 <a href=https://github.com/minio/pkger><code>minio/pkger</code></a> 制作了最新的 2025-12-03 版本。</p><p>这一版本修复了 MinIO <a href=https://nvd.nist.gov/vuln/detail/CVE-2025-62506><strong>CVE-2025-62506</strong></a> 安全漏洞，确保 Pigsty 用户的 MinIO 部署安全可靠。
您可以在 Pigsty Infra 仓库中找到 RPM/DEB 包以及构建使用的脚本。</p><hr><h2 id=为什么-minio-强制要求-https>为什么 MinIO 强制要求 HTTPS？</h2><p>当 pgbackrest 使用对象存储作为备份仓库时，强制要求使用 HTTPS，以确保数据传输的安全性。
如果您的 MinIO 并非用于 pgbackrest 备份，您仍然可以选择使用 HTTP 协议。
可以通过修改参数 <a href=/docs/minio/param#minio_https><code>minio_https</code></a> 来关闭 HTTPS。</p><hr><h2 id=从容器中访问-minio-提示证书无效>从容器中访问 MinIO 提示证书无效？</h2><p>除非您使用真正的企业 CA 颁发的证书，否则 MinIO 默认使用自签名证书，这会导致容器内的客户端工具（如 mc / rclone / awscli 等）无法验证 MinIO 服务器的身份，从而提示证书无效。</p><p>例如，对于 Node.js 应用程序，可以 MinIO 服务器的 CA 证书挂载到容器内，并通过环境变量 <code>NODE_EXTRA_CA_CERTS</code> 指定 CA 证书路径：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>NODE_EXTRA_CA_CERTS</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/etc/pki/ca.crt</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>/etc/pki/ca.crt:/etc/pki/ca.crt:ro</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>当然，如果您的 MinIO 没有用作 pgbackrest 备份仓库的话，您也可以选择关闭 MinIO 的 HTTPS 支持，改用 HTTP 协议访问。</p><hr><h2 id=启动多节点多盘-minio-集群失败怎么办>启动多节点/多盘 MinIO 集群失败怎么办？</h2><p>在 <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>单机多盘</strong></a> 或 <a href=/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98><strong>多机多盘</strong></a> 模式下，如果数据目录不是有效的磁盘挂载点，MinIO 会拒绝启动。
请使用已挂载的磁盘作为 MinIO 的数据目录，而不是普通目录。您只能在 <a href=/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98><strong>单机单盘</strong></a> 模式下使用普通目录作为 MinIO 的数据目录，仅可用于开发测试或非关键场合。</p><hr><h2 id=如何向已有的-minio-集群中添加新的成员>如何向已有的 MinIO 集群中添加新的成员？</h2><blockquote><p>在部署之前，您最好规划 MinIO 集群容量，因为新增成员需要全局重启。</p></blockquote><p>您可以通过向现有集群中添加新的服务器节点，打造一个新的存储池的方式，实现 MinIO 扩容。</p><p>请注意，MinIO 一旦部署，你无法修改现有集群的节点数量与磁盘数量！只能通过添加新的存储池来扩容。</p><p>详细步骤请参考 Pigsty 文档：<a href=/docs/minio/admin#%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9><strong>集群扩容</strong></a>，以及 MinIO 官方文档：<a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html><strong>扩展 MinIO 部署</strong></a></p><hr><h2 id=如何移除-minio-集群>如何移除 MinIO 集群？</h2><p>从 Pigsty v3.6 开始，移除 MinIO 集群需要使用专用的 <code>minio-rm.yml</code> 剧本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio-rm.yml -l minio                   <span style=color:#8f5902;font-style:italic># 移除 MinIO 集群</span>
</span></span><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_rm_data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>  <span style=color:#8f5902;font-style:italic># 移除集群但保留数据</span>
</span></span></code></pre></div><p>如果您启用了 <a href=/docs/minio/param#minio_safeguard><code>minio_safeguard</code></a> 保护，需要显式覆盖才能执行移除：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./minio-rm.yml -l minio -e <span style=color:#000>minio_safeguard</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</span></span></code></pre></div><hr><h2 id=mcli-命令与-mc-命令有什么区别>mcli 命令与 mc 命令有什么区别？</h2><p><code>mcli</code> 是 MinIO 官方客户端 <code>mc</code> 的重命名版本。在 Pigsty 中，我们使用 <code>mcli</code> 而不是 <code>mc</code>，以避免与 Midnight Commander（一个常见的文件管理器，也使用 <code>mc</code> 命令）产生冲突。</p><p>两者功能完全相同，只是命令名称不同。您可以在 <a href=https://min.io/docs/minio/linux/reference/minio-mc.html>MinIO 客户端文档</a> 中找到完整的命令参考。</p><hr><h2 id=如何监控-minio-集群状态>如何监控 MinIO 集群状态？</h2><p>Pigsty 为 MinIO 提供了开箱即用的监控能力：</p><ul><li><strong>Grafana 面板</strong>：<a href=https://demo.pigsty.cc/d/minio-overview>MinIO Overview</a> 和 <a href=https://demo.pigsty.cc/d/minio-instance>MinIO Instance</a></li><li><strong>告警规则</strong>：包括 MinIO 宕机、节点离线、磁盘离线等告警</li><li><strong>MinIO 内置控制台</strong>：通过 <code>https://&lt;minio-ip>:9001</code> 访问</li></ul><p>详情请参阅 <a href=/docs/minio/monitor>监控告警</a> 文档</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件 aria-label=邮件><a target=_blank rel=noopener href=mailto:rh@vonng.com aria-label=邮件><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub - Vonng" aria-label="GitHub - Vonng"><a target=_blank rel=noopener href=https://github.com/Vonng aria-label="GitHub - Vonng"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Vonng" aria-label="X - Vonng"><a target=_blank rel=noopener href=https://x.com/RonVonng aria-label="X - Vonng"><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="X - Pigsty" aria-label="X - Pigsty"><a target=_blank rel=noopener href=https://x.com/PlGSTY aria-label="X - Pigsty"><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="LinkedIn - Vonng" aria-label="LinkedIn - Vonng"><a target=_blank rel=noopener href=https://www.linkedin.com/in/vonng/ aria-label="LinkedIn - Vonng"><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/wDzt5VyWEz aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/joinchat/gV9zfZraNPM3YjFh aria-label=Telegram><i class="fab fa-telegram"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=微信 aria-label=微信><a target=_blank rel=noopener href=/img/pigsty/pigsty-cc.jpg aria-label=微信><i class="fab fa-weixin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=论坛 aria-label=论坛><a target=_blank rel=noopener href=https://github.com/orgs/pgsty/discussions aria-label=论坛><i class="fab fa-discourse"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/pgsty/pigsty aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2026
<span class=td-footer__authors>Ruohang Feng</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span><span class=ms-2><a href=/docs/about/privacy target=_blank rel=noopener>隐私政策</a></span></div></div></div></footer></div><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>