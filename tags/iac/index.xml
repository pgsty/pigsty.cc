<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>IaC on PIGSTY</title><link>https://pigsty.cc/tags/iac/</link><description>Recent content in IaC on PIGSTY</description><generator>Hugo</generator><language>zh-CN</language><atom:link href="https://pigsty.cc/tags/iac/index.xml" rel="self" type="application/rss+xml"/><item><title>元数据库</title><link>https://pigsty.cc/docs/concept/iac/cmdb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/cmdb/</guid><description>&lt;p&gt;Pigsty 允许您使用 PostgreSQL &lt;strong&gt;元数据库&lt;/strong&gt; 作为动态配置源，取代静态的 YAML 配置文件，实现更强大的配置管理能力。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;CMDB&lt;/strong&gt;（Configuration Management Database，配置管理数据库）是一种将配置信息存储在数据库中进行管理的方式。&lt;/p&gt;
&lt;p&gt;在 Pigsty 中，默认的配置源是一个静态 YAML 文件 &lt;code&gt;pigsty.yml&lt;/code&gt;，
它作为 Ansible 的 &lt;a href="https://pigsty.cc/docs/concept/iac/inventory/"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; 使用。&lt;/p&gt;
&lt;p&gt;这种方式简单直接，但当基础设施规模扩大、需要复杂精细的管理与外部集成时，单一的静态文件难以满足需求。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;特性&lt;/th&gt;
 &lt;th style="text-align: left"&gt;静态 YAML 文件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;CMDB 元数据库&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;查询能力&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;手工搜索/grep&lt;/td&gt;
 &lt;td style="text-align: left"&gt;SQL 任意条件查询，聚合分析&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;版本控制&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;依赖 Git 或手工备份&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据库事务，审计日志，时间旅行快照&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;权限控制&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;文件系统权限，粗粒度&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 数据库精细访问控制&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;并发编辑&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要锁文件或合并冲突&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据库事务天然支持并发&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;外部集成&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要解析 YAML&lt;/td&gt;
 &lt;td style="text-align: left"&gt;标准 SQL 接口，任意语言轻松对接&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;规模扩展&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;文件过大时难以维护&lt;/td&gt;
 &lt;td style="text-align: left"&gt;管理规模伸缩至物理极限&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;动态生成&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;静态文件，修改后需手动应用&lt;/td&gt;
 &lt;td style="text-align: left"&gt;即时生效，实时反映配置变更&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Pigsty 在样板数据库 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/meta.yml#L52"&gt;&lt;strong&gt;&lt;code&gt;pg-meta.meta&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 的模式基线定义中，提供了 Pigsty CMDB 的数据库模式。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="工作原理"&gt;工作原理&lt;/h2&gt;
&lt;p&gt;CMDB 的核心思想是用一个 &lt;strong&gt;动态脚本&lt;/strong&gt; 替换静态配置文件。
Ansible 支持使用可执行脚本作为配置清单，只要脚本输出符合 JSON 格式的清单数据即可。
当您启用 CMDB 后，Pigsty 会创建一个名为 &lt;code&gt;inventory.sh&lt;/code&gt; 的动态清单脚本：&lt;/p&gt;</description></item></channel></rss>