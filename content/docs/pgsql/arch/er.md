---
title: 实体关系图
weight: 1101
description: 介绍 Pigsty 中 PostgreSQL 集群的实体-关系模型，E-R 关系图，实体释义与命名规范。
icon: fa-solid fa-share-nodes
module: [PGSQL]
categories: [概念]
---

> 先弄清楚“有哪些对象、它们如何互相引用”，再去讨论部署和运维。Pigsty 的 PGSQL 模块围绕几个核心实体构成一张稳定的 E-R 图，理解这张图能帮助你设计清晰的配置和自动化流程。

PGSQL模块在生产环境中以**集群**的形式组织，这些**集群**是由一组由**主-备**关联的数据库**实例**组成的**逻辑实体**。

每个集群都是一个**自治**的业务单元，由至少一个 **主库实例** 组成，并通过服务向外暴露能力。

在 Pigsty 的PGSQL模块中有四种核心实体：

- **集群**（Cluster）：自治的 PostgreSQL 业务单元，用作其他实体的顶级命名空间。
- **服务**（Service）：对外暴露能力的命名抽象，路由流量，并使用节点端口暴露服务。
- **实例**（Instance）：由在单个节点上的运行进程和数据库文件组成的单一 PostgreSQL 服务器。
- **节点**（Node）：运行 Linux + Systemd 环境的硬件资源抽象，可以是裸机、VM、容器或 Pod。

辅以“数据库”“角色”两个业务实体，共同组成完整的逻辑视图。如下图所示：

![pigsty-er.jpg](/img/pigsty/er.jpg)

**命名约定（沿用 Pigsty 早期约束）**

- 集群名应为有效的 DNS 域名，不包含任何点号，正则表达式为：`[a-zA-Z0-9-]+`
- 服务名应以集群名为前缀，并以特定单词作为后缀：`primary`、`replica`、`offline`、`delayed`，中间用`-`连接。
- 实例名以集群名为前缀，以正整数实例号为后缀，用`-`连接，例如`${cluster}-${seq}`。
- 节点由其首要内网IP地址标识，因为PGSQL模块中数据库与主机1:1部署，所以主机名通常与实例名相同。
