<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>概念 on PIGSTY</title><link>https://pigsty.cc/categories/%E6%A6%82%E5%BF%B5/</link><description>Recent content in 概念 on PIGSTY</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Sat, 14 Feb 2026 08:23:51 +0800</lastBuildDate><atom:link href="https://pigsty.cc/categories/%E6%A6%82%E5%BF%B5/index.xml" rel="self" type="application/rss+xml"/><item><title>被动故障切换</title><link>https://pigsty.cc/docs/concept/ha/failure/passive/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/failure/passive/</guid><description>&lt;div id="infographic-537dd2226714fc6c5830057e9f044ea1" class="infographic-container td-max-width-on-larger-screens"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var containerId = 'infographic-537dd2226714fc6c5830057e9f044ea1';
 var syntax = "````\ninfographic list-row-simple-horizontal-arrow\ndata\n title 租约过期故障切换流程\n desc 当整个节点宕机，Patroni 无法主动释放租约，只能等待 TTL 过期\n items\n - label 租约过期\n desc Patroni 失联，被动等待主库租约 TTL 过期\n icon mingcute/close-circle-fill\n - label 从库检测\n desc 从库从循环中醒来后发现租约过期，开始竞选\n icon mingcute/key-2-fill\n - label 抢锁提拔\n desc 从库相互比较并抢锁，胜利者提升自己的PG\n icon mingcute/radar-fill\n - label 健康检查\n desc HAPROXY 健康检查发现新主上线，分配流量\n icon mingcute/arrow-up-circle-fill\ntheme light\n palette antv\n````";

 function renderInfographic() {
 var dom = document.getElementById(containerId);
 if (!dom) { console.error('Infographic: container not found:', containerId); return; }
 try {
 var ig = new AntVInfographic.Infographic({
 container: '#' + containerId,
 width: dom.offsetWidth || '100%',
 height: 'auto',
 });
 ig.render(syntax);
 } catch (e) {
 console.error('Infographic render error:', e);
 dom.innerHTML = '&lt;pre style="color: red;"&gt;Infographic Error: ' + e.message + '&lt;/pre&gt;';
 }
 }

 
 if (typeof AntVInfographic !== 'undefined') {
 renderInfographic();
 } else if (!window._infographicLoading) {
 window._infographicLoading = true;
 window._infographicCallbacks = [renderInfographic];
 var script = document.createElement('script');
 script.src = '/js/infographic.min.js';
 script.onload = function() {
 window._infographicCallbacks.forEach(function(cb) { cb(); });
 };
 document.head.appendChild(script);
 } else {
 window._infographicCallbacks.push(renderInfographic);
 }
})();
&lt;/script&gt;

&lt;hr&gt;
&lt;h2 id="rto-时序图"&gt;RTO 时序图&lt;/h2&gt;
&lt;div id="echarts-44d24210b099c2088232bbd8c2371226" class="echarts-container td-max-width-on-larger-screens" style="height: 520px;"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var dom = document.getElementById('echarts-44d24210b099c2088232bbd8c2371226');
 if (!dom) return;

 
 window._echartsFns = window._echartsFns || {};

var fmt = function(params) { if (!params || !params.length || params[0].name === '') return ''; return '&lt;b&gt;' + params[0].name + '&lt;/b&gt;&lt;br/&gt;' + params.filter(p =&gt; p.value !== '-' &amp;&amp; p.value != null).map(p =&gt; p.marker + ' ' + p.seriesName + ': ' + p.value + 's').join('&lt;br/&gt;'); };

 window._echartsFns['fmt'] = fmt;
 var theme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'dark' : null;

 var chart = echarts.init(dom, theme);
 var optionsJson = {"grid":{"bottom":32,"left":64,"right":24,"top":40},"legend":{"data":["租约过期","从库检测","抢锁提拔","健康检查"],"itemGap":12,"top":0},"series":[{"barWidth":20,"data":[120,110,100,"-",60,55,50,"-",30,27,25,"-",20,17,15],"emphasis":{"focus":"series"},"itemStyle":{"color":"#e15759"},"name":"租约过期","stack":"main","type":"bar","z":2},{"data":[20,10,0,"-",10,5,0,"-",5,3,0,"-",5,3,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#edc949"},"name":"从库检测","stack":"main","type":"bar","z":2},{"data":[2,1,0,"-",2,1,0,"-",2,1,0,"-",2,1,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#59a14f"},"name":"抢锁提拔","stack":"main","type":"bar","z":2},{"data":[8,6,4,"-",6,5,3,"-",4,3,2,"-",2,2,1],"emphasis":{"focus":"series"},"itemStyle":{"color":"#4e79a7"},"name":"健康检查","stack":"main","type":"bar","z":2},{"barGap":"-100%","barWidth":20,"data":[150,127,104,"-",78,66,53,"-",41,34,27,"-",29,23,16],"emphasis":{"itemStyle":{"opacity":0}},"itemStyle":{"color":"#888","opacity":0},"name":"RTO总计","type":"bar","z":1},{"barGap":"-100%","barWidth":20,"data":[150,150,150,"-",90,90,90,"-",45,45,45,"-",30,30,30],"emphasis":{"itemStyle":{"color":"rgba(0,0,0,0.12)"}},"itemStyle":{"color":"rgba(0,0,0,0.08)"},"name":"RTO预算","type":"bar","z":0}],"tooltip":{"axisPointer":{"type":"shadow"},"formatter":"$fn:fmt","trigger":"axis"},"xAxis":{"axisLine":{"show":true},"axisTick":{"show":true},"max":160,"minorSplitLine":{"lineStyle":{"opacity":0.2,"type":"dotted"},"show":true},"minorTick":{"show":true,"splitNumber":5},"name":"秒","nameLocation":"end","splitLine":{"lineStyle":{"opacity":0.5,"type":"dashed"},"show":true},"type":"value"},"yAxis":{"axisLabel":{"fontFamily":"monospace","fontSize":10},"axisLine":{"show":true},"axisTick":{"show":true},"data":["wide-max","wide-avg","wide-min","","safe-max","safe-avg","safe-min","","norm-max","norm-avg","norm-min","","fast-max","fast-avg","fast-min"],"splitLine":{"show":false},"type":"category"}};

 
 function replaceFnRefs(obj) {
 if (typeof obj === 'string' &amp;&amp; obj.startsWith('$fn:')) {
 var fnName = obj.substring(4);
 return window._echartsFns[fnName];
 }
 if (Array.isArray(obj)) {
 return obj.map(replaceFnRefs);
 }
 if (obj &amp;&amp; typeof obj === 'object') {
 var result = {};
 for (var key in obj) {
 result[key] = replaceFnRefs(obj[key]);
 }
 return result;
 }
 return obj;
 }

 var options = replaceFnRefs(optionsJson);
 chart.setOption(options);

 
 window.addEventListener('resize', function() {
 chart.resize();
 });
 var observer = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.attributeName === 'data-bs-theme') {
 var newTheme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'dark' : null;
 chart.dispose();
 chart = echarts.init(dom, newTheme);
 chart.setOption(options);
 }
 });
 });
 observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-bs-theme'] });
})();
&lt;/script&gt;

&lt;hr&gt;
&lt;h2 id="故障模型"&gt;故障模型&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;项目&lt;/th&gt;
 &lt;th style="text-align: center"&gt;最好&lt;/th&gt;
 &lt;th style="text-align: center"&gt;最坏&lt;/th&gt;
 &lt;th style="text-align: center"&gt;平均&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;租约过期&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;ttl - loop&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;ttl&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;ttl - loop/2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：即将刷新时宕机&lt;br/&gt;最坏：刚刷新完就宕机&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;从库检测&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop / 2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：恰好在检测点&lt;br/&gt;最坏：刚错过检测点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;抢锁提拔&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：直接抢锁提升&lt;br/&gt;最坏：API超时+Promote&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;健康检查&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter + inter&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter + inter/2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：检查前状态变化&lt;br/&gt;最坏：检查后瞬间状态变化&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;被动故障与主动故障的核心区别&lt;/strong&gt;：&lt;/p&gt;</description></item><item><title>简介</title><link>https://pigsty.cc/docs/pig/intro/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pig/intro/</guid><description>&lt;p&gt;你是否曾因安装或升级 PostgreSQL 扩展而头疼？翻查过时的文档、晦涩难懂的配置脚本，或是在 GitHub 上苦寻分支与补丁？
Postgres 丰富的扩展生态同时意味着复杂的部署流程 —— 在多发行版、多架构环境下尤为棘手。而 PIG 可以为您解决这些烦恼。&lt;/p&gt;
&lt;p&gt;这正是 &lt;strong&gt;Pig&lt;/strong&gt; 诞生的初衷。Pig 由 Go 语言开发，致力于一站式管理 Postgres 及其 &lt;a href="https://pgext.cloud/zh/list"&gt;450+&lt;/a&gt; 扩展。
无论是 TimescaleDB、Citus、PGVector，还是 30+ Rust 扩展，亦或 自建 Supabase 所需的全部组件 —— Pig 统一的 CLI 让一切触手可及。
它彻底告别源码编译与杂乱仓库，直接提供版本对齐的 RPM/DEB 包，完美兼容 Debian、Ubuntu、RedHat 等主流发行版，支持 x86 与 Arm 架构，无需猜测，无需折腾。&lt;/p&gt;
&lt;p&gt;Pig 并非重复造轮子，而是充分利用系统原生包管理器（APT、YUM、DNF），严格遵循 &lt;a href="https://pigsty.cc/docs/repo/pgdg/"&gt;PGDG 官方&lt;/a&gt; 打包规范，确保无缝集成。
你无需在&amp;quot;标准做法&amp;quot;与&amp;quot;快捷方式&amp;quot;之间权衡；Pig 尊重现有仓库，遵循操作系统最佳实践，与现有仓库和软件包和谐共存。
如果你的 Linux 系统和 PostgreSQL 大版本不在 &lt;a href="#linux-%E5%85%BC%E5%AE%B9%E6%80%A7"&gt;支持的列表&lt;/a&gt; 中，你还可以使用 &lt;a href="https://pigsty.cc/docs/pig/build/"&gt;&lt;code&gt;pig build&lt;/code&gt;&lt;/a&gt; 直接针对特定组合编译扩展。&lt;/p&gt;
&lt;p&gt;想让你的 Postgres 如虎添翼、远离繁琐？欢迎访问 &lt;a href="https://pigsty.cc/docs/pig"&gt;PIG 官方文档&lt;/a&gt; 获取文档、指南，并查阅庞大的 &lt;a href="https://pgext.cloud/zh/list"&gt;扩展列表&lt;/a&gt;，
让你的本地 Postgres 数据库一键进化为全能的多模态数据中台。
如果说 &lt;a href="https://medium.com/@fengruohang/postgres-is-eating-the-database-world-157c204dcfc4"&gt;Postgres 的未来是无可匹敌的可扩展性&lt;/a&gt;，那么 Pig 就是帮你解锁它的神灯。毕竟，从没有人抱怨 &amp;ldquo;扩展太多&amp;rdquo;。&lt;/p&gt;
&lt;h2 id="自动化友好"&gt;自动化友好&lt;/h2&gt;
&lt;p&gt;PIG 的命令体系可直接用于自动化脚本：参数风格统一、输出稳定，并在高风险操作中提供 &lt;code&gt;--dry-run&lt;/code&gt; 或确认步骤，减少误操作风险。&lt;/p&gt;</description></item><item><title>主动故障检测</title><link>https://pigsty.cc/docs/concept/ha/failure/active/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/failure/active/</guid><description>&lt;div id="infographic-5a27087cd19651a30e413fd22489ae1b" class="infographic-container td-max-width-on-larger-screens"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var containerId = 'infographic-5a27087cd19651a30e413fd22489ae1b';
 var syntax = "````\ninfographic list-row-simple-horizontal-arrow\ndata\n title 崩溃故障切换流程\n desc 当 Patroni 健康，但 PostgreSQL 因故崩溃时的故障切换流程\n items\n - label 故障检测\n desc Patroni 在循环中检测到 PG 崩溃\n icon mingcute/close-circle-fill\n - label 重启超时\n desc Patroni 尝试重启 PG，超时后释放租约\n icon mingcute/refresh-2-fill\n - label 从库检测\n desc 从库从循环中醒来发现租约释放，开始竞选\n icon mingcute/key-2-fill\n - label 抢锁提拔\n desc 从库相互比较并抢锁，胜利者提升自己的 PG\n icon mingcute/radar-fill\n - label 健康检查\n desc HAProxy 健康检查发现新主上线，分配流量\n icon mingcute/arrow-up-circle-fill\ntheme light\n palette antv\n````";

 function renderInfographic() {
 var dom = document.getElementById(containerId);
 if (!dom) { console.error('Infographic: container not found:', containerId); return; }
 try {
 var ig = new AntVInfographic.Infographic({
 container: '#' + containerId,
 width: dom.offsetWidth || '100%',
 height: 'auto',
 });
 ig.render(syntax);
 } catch (e) {
 console.error('Infographic render error:', e);
 dom.innerHTML = '&lt;pre style="color: red;"&gt;Infographic Error: ' + e.message + '&lt;/pre&gt;';
 }
 }

 
 if (typeof AntVInfographic !== 'undefined') {
 renderInfographic();
 } else if (!window._infographicLoading) {
 window._infographicLoading = true;
 window._infographicCallbacks = [renderInfographic];
 var script = document.createElement('script');
 script.src = '/js/infographic.min.js';
 script.onload = function() {
 window._infographicCallbacks.forEach(function(cb) { cb(); });
 };
 document.head.appendChild(script);
 } else {
 window._infographicCallbacks.push(renderInfographic);
 }
})();
&lt;/script&gt;

&lt;hr&gt;
&lt;h2 id="rto-时序图"&gt;RTO 时序图&lt;/h2&gt;
&lt;div id="echarts-7566178edd3ee3c0901186f67235867f" class="echarts-container td-max-width-on-larger-screens" style="height: 520px;"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var dom = document.getElementById('echarts-7566178edd3ee3c0901186f67235867f');
 if (!dom) return;

 
 window._echartsFns = window._echartsFns || {};

var fmt = function(params) { if (!params || !params.length || params[0].name === '') return ''; return '&lt;b&gt;' + params[0].name + '&lt;/b&gt;&lt;br/&gt;' + params.filter(p =&gt; p.value !== '-' &amp;&amp; p.value != null).map(p =&gt; p.marker + ' ' + p.seriesName + ': ' + p.value + 's').join('&lt;br/&gt;'); };

 window._echartsFns['fmt'] = fmt;
 var theme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'dark' : null;

 var chart = echarts.init(dom, theme);
 var optionsJson = {"grid":{"bottom":32,"left":64,"right":24,"top":40},"legend":{"data":["故障检测","重启超时","从库检测","抢锁提拔","健康检查"],"itemGap":12,"top":0},"series":[{"barWidth":20,"data":[20,10,0,"-",10,5,0,"-",5,3,0,"-",5,3,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#b07aa1"},"name":"故障检测","stack":"main","type":"bar","z":2},{"data":[95,95,0,"-",45,45,0,"-",25,25,0,"-",15,15,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#f28e2c"},"name":"重启超时","stack":"main","type":"bar","z":2},{"data":[20,10,0,"-",10,5,0,"-",5,3,0,"-",5,3,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#edc949"},"name":"从库检测","stack":"main","type":"bar","z":2},{"data":[2,1,0,"-",2,1,0,"-",2,1,0,"-",2,1,0],"emphasis":{"focus":"series"},"itemStyle":{"color":"#59a14f"},"name":"抢锁提拔","stack":"main","type":"bar","z":2},{"data":[8,6,4,"-",6,5,3,"-",4,3,2,"-",2,2,1],"emphasis":{"focus":"series"},"itemStyle":{"color":"#4e79a7"},"name":"健康检查","stack":"main","type":"bar","z":2},{"barGap":"-100%","barWidth":20,"data":[145,122,4,"-",73,61,3,"-",41,35,2,"-",29,24,1],"emphasis":{"itemStyle":{"opacity":0}},"itemStyle":{"color":"#888","opacity":0},"name":"RTO总计","type":"bar","z":1},{"barGap":"-100%","barWidth":20,"data":[150,150,150,"-",90,90,90,"-",45,45,45,"-",30,30,30],"emphasis":{"itemStyle":{"color":"rgba(0,0,0,0.12)"}},"itemStyle":{"color":"rgba(0,0,0,0.08)"},"name":"RTO预算","type":"bar","z":0}],"tooltip":{"axisPointer":{"type":"shadow"},"formatter":"$fn:fmt","trigger":"axis"},"xAxis":{"axisLine":{"show":true},"axisTick":{"show":true},"max":160,"minorSplitLine":{"lineStyle":{"opacity":0.2,"type":"dotted"},"show":true},"minorTick":{"show":true,"splitNumber":5},"name":"秒","nameLocation":"end","splitLine":{"lineStyle":{"opacity":0.5,"type":"dashed"},"show":true},"type":"value"},"yAxis":{"axisLabel":{"fontFamily":"monospace","fontSize":10},"axisLine":{"show":true},"axisTick":{"show":true},"data":["wide-max","wide-avg","wide-min","","safe-max","safe-avg","safe-min","","norm-max","norm-avg","norm-min","","fast-max","fast-avg","fast-min"],"splitLine":{"show":false},"type":"category"}};

 
 function replaceFnRefs(obj) {
 if (typeof obj === 'string' &amp;&amp; obj.startsWith('$fn:')) {
 var fnName = obj.substring(4);
 return window._echartsFns[fnName];
 }
 if (Array.isArray(obj)) {
 return obj.map(replaceFnRefs);
 }
 if (obj &amp;&amp; typeof obj === 'object') {
 var result = {};
 for (var key in obj) {
 result[key] = replaceFnRefs(obj[key]);
 }
 return result;
 }
 return obj;
 }

 var options = replaceFnRefs(optionsJson);
 chart.setOption(options);

 
 window.addEventListener('resize', function() {
 chart.resize();
 });
 var observer = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.attributeName === 'data-bs-theme') {
 var newTheme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'dark' : null;
 chart.dispose();
 chart = echarts.init(dom, newTheme);
 chart.setOption(options);
 }
 });
 });
 observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-bs-theme'] });
})();
&lt;/script&gt;

&lt;hr&gt;
&lt;h2 id="故障模型"&gt;故障模型&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;项目&lt;/th&gt;
 &lt;th style="text-align: center"&gt;最好&lt;/th&gt;
 &lt;th style="text-align: center"&gt;最坏&lt;/th&gt;
 &lt;th style="text-align: center"&gt;平均&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;故障检测&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop/2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：PG 恰好在检测前崩溃&lt;br/&gt;最坏：PG 刚检测完就崩溃&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;重启超时&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;start&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;start&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：PG 瞬间自愈&lt;br/&gt;最坏：等满 start 超时才释放租约&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;从库检测&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;loop/2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：恰好在检测点&lt;br/&gt;最坏：刚错过检测点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;抢锁提拔&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：直接抢锁提升&lt;br/&gt;最坏：API 超时 + Promote&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;健康检查&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter + inter&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;(rise-1) × fastinter + inter/2&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;最好：检查前状态变化&lt;br/&gt;最坏：检查后瞬间状态变化&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;主动故障与被动故障的核心区别&lt;/strong&gt;：&lt;/p&gt;</description></item><item><title>概念</title><link>https://pigsty.cc/docs/concept/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/</guid><description>&lt;p&gt;Pigsty 是一个可移植、可扩展的开源 PostgreSQL 发行版，用于在本地环境中构建生产级数据库服务，方便进行声明式配置和自动化。它拥有庞大的生态系统，提供了一整套工具、脚本和最佳实践，让 PostgreSQL 真正达到企业级 RDS 的服务水准。&lt;/p&gt;
&lt;p&gt;Pigsty 名字源自 &lt;strong&gt;P&lt;/strong&gt;ostgreSQL &lt;strong&gt;I&lt;/strong&gt;n &lt;strong&gt;G&lt;/strong&gt;reat &lt;strong&gt;STY&lt;/strong&gt;le，也可理解为 &lt;strong&gt;P&lt;/strong&gt;ostgres， &lt;strong&gt;I&lt;/strong&gt;nfras， &lt;strong&gt;G&lt;/strong&gt;raphics， &lt;strong&gt;S&lt;/strong&gt;ervice， &lt;strong&gt;T&lt;/strong&gt;oolbox， it&amp;rsquo;s all &lt;strong&gt;Y&lt;/strong&gt;ours —— 属于您的 PostgreSQL 图形化自建工具箱。您可以在 &lt;a href="https://github.com/Vonng/pigsty"&gt;&lt;strong&gt;GitHub&lt;/strong&gt;&lt;/a&gt; 上找到源代码，访问 &lt;a href="https://pigsty.io"&gt;&lt;strong&gt;官方文档&lt;/strong&gt;&lt;/a&gt; 了解更多信息，或在 &lt;a href="https://demo.pigsty.cc"&gt;&lt;strong&gt;在线演示&lt;/strong&gt;&lt;/a&gt; 中体验 &lt;a href="https://pigsty.cc/docs/setup/webui"&gt;&lt;strong&gt;Web 界面&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://pigsty.cc"&gt;&lt;img src="https://pigsty.cc/img/pigsty/banner.png" alt="pigsty-banner"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="为什么需要-pigsty它能做什么"&gt;为什么需要 Pigsty，它能做什么？&lt;/h2&gt;
&lt;p&gt;PostgreSQL 是一个足够完美的数据库内核，但它需要更多工具与系统的配合才能成为一个足够好的数据库服务。在生产环境中，您需要管理数据库的方方面面：高可用、备份恢复、监控告警、访问控制、参数调优、扩展安装、连接池化、负载均衡……&lt;/p&gt;
&lt;p&gt;如果这些复杂的运维工作都能自动化处理，是不是会更容易一些？这正是 Pigsty 诞生的原因。&lt;/p&gt;
&lt;p&gt;Pigsty 为您提供：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;开箱即用的 PostgreSQL 发行版&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Pigsty 深度整合了 PostgreSQL 生态中的 &lt;a href="https://pgext.cloud/zh/list"&gt;&lt;strong&gt;444 扩展插件&lt;/strong&gt;&lt;/a&gt;，为您提供开箱即用的分布式、时序、地理、空间、图、向量、搜索等多模态数据库能力。从内核到 RDS 发行版，在 EL/Debian/Ubuntu 下提供 13-18 版本的生产级数据库服务。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;故障自愈的高可用架构&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;基于 Patroni、Etcd 和 HAProxy 打造的 &lt;a href="https://pigsty.cc/docs/concept/ha"&gt;&lt;strong&gt;高可用架构&lt;/strong&gt;&lt;/a&gt;，让硬件故障自动切换，流量无缝衔接。主库故障恢复时间 RTO &amp;lt; 45s，数据恢复点 RPO ≈ 0。您可以在无需应用配合的情况下滚动维护升级整个集群。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;完整的时间点恢复能力&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;基于 pgBackRest 与可选的 MinIO 集群，提供开箱即用的 &lt;a href="https://pigsty.cc/docs/concept/pitr"&gt;&lt;strong&gt;PITR 时间点恢复&lt;/strong&gt;&lt;/a&gt; 能力。让您拥有快速回到过去任意时间点的能力，为软件缺陷与人为删库兜底。&lt;/p&gt;</description></item><item><title>积木式架构</title><link>https://pigsty.cc/docs/concept/arch/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/arch/</guid><description>&lt;p&gt;Pigsty 使用 &lt;strong&gt;模块化架构&lt;/strong&gt; 与 &lt;strong&gt;声明式接口&lt;/strong&gt;，您可以像 &lt;a href="https://pigsty.cc/docs/deploy/planning#%E5%B8%B8%E8%A7%81%E6%96%B9%E6%A1%88"&gt;&lt;strong&gt;搭积木一样自由按需组合模块&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pigsty 采用 &lt;a href="https://pigsty.cc/docs/deploy/planning"&gt;&lt;strong&gt;模块化设计&lt;/strong&gt;&lt;/a&gt;，可自由组合，按需使用（Use one or all），以适应不同场景的需求。&lt;/li&gt;
&lt;li&gt;Pigsty 使用 &lt;a href="https://pigsty.cc/docs/concept/iac/inventory"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; 和 &lt;a href="https://pigsty.cc/docs/concept/iac/parameter"&gt;&lt;strong&gt;配置参数&lt;/strong&gt;&lt;/a&gt; 描述整套部署环境，并通过 &lt;a href="https://pigsty.cc/docs/setup/playbook"&gt;&lt;strong&gt;Ansible 剧本&lt;/strong&gt;&lt;/a&gt; 实现部署与调整。&lt;/li&gt;
&lt;li&gt;Pigsty 在可以在任意 &lt;a href="https://pigsty.cc/docs/concept/arch/node"&gt;&lt;strong&gt;节点&lt;/strong&gt;&lt;/a&gt; 上运行，无论是物理裸机还是虚拟机，只要运行 &lt;a href="https://pigsty.cc/docs/ref/linux"&gt;&lt;strong&gt;兼容的操作系统&lt;/strong&gt;&lt;/a&gt; 即可。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="模块"&gt;模块&lt;/h2&gt;
&lt;p&gt;Pigsty 采用模块化设计，有六个主要的默认模块：&lt;a href="https://pigsty.cc/docs/pgsql"&gt;&lt;code&gt;PGSQL&lt;/code&gt;&lt;/a&gt;、&lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;code&gt;INFRA&lt;/code&gt;&lt;/a&gt;、&lt;a href="https://pigsty.cc/docs/node"&gt;&lt;code&gt;NODE&lt;/code&gt;&lt;/a&gt;、&lt;a href="https://pigsty.cc/docs/etcd"&gt;&lt;code&gt;ETCD&lt;/code&gt;&lt;/a&gt;、&lt;a href="https://pigsty.cc/docs/redis"&gt;&lt;code&gt;REDIS&lt;/code&gt;&lt;/a&gt; 和 &lt;a href="https://pigsty.cc/docs/minio"&gt;&lt;code&gt;MINIO&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/pgsql"&gt;&lt;strong&gt;&lt;code&gt;PGSQL&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：由 Patroni、Pgbouncer、HAproxy、PgBackrest 等驱动的自治高可用 Postgres 集群。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;strong&gt;&lt;code&gt;INFRA&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：本地软件仓库、Nginx、Grafana、Victoria、AlertManager、Blackbox Exporter 可观测性全家桶。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/node"&gt;&lt;strong&gt;&lt;code&gt;NODE&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：调整节点到所需状态、名称、时区、NTP、ssh、sudo、haproxy、docker、vector、keepalived&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/etcd"&gt;&lt;strong&gt;&lt;code&gt;ETCD&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：分布式键值存储，用作高可用 Postgres 集群的 DCS：共识选主/配置管理/服务发现。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/redis"&gt;&lt;strong&gt;&lt;code&gt;REDIS&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：Redis 服务器，支持独立主从、哨兵、集群模式，并带有完整的监控支持。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/minio"&gt;&lt;strong&gt;&lt;code&gt;MINIO&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;：与 S3 兼容的简单对象存储服务器，可作为 PG数据库备份的可选目的地。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你可以声明式地自由组合它们。如果你想要主机监控，在基础设施节点上安装 &lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;code&gt;INFRA&lt;/code&gt;&lt;/a&gt; 模块，并在纳管节点上安装 &lt;a href="https://pigsty.cc/docs/node"&gt;&lt;code&gt;NODE&lt;/code&gt;&lt;/a&gt; 模块就足够了。
&lt;a href="https://pigsty.cc/docs/etcd"&gt;&lt;code&gt;ETCD&lt;/code&gt;&lt;/a&gt; 和 &lt;a href="https://pigsty.cc/docs/pgsql"&gt;&lt;code&gt;PGSQL&lt;/code&gt;&lt;/a&gt; 模块用于搭建高可用 PG 集群，将模块安装在多个节点上，可以自动形成一个高可用的数据库集群。
您可以复用 Pigsty 基础架构并开发您自己的模块，&lt;a href="https://pigsty.cc/docs/redis"&gt;&lt;code&gt;REDIS&lt;/code&gt;&lt;/a&gt; 和 &lt;a href="https://pigsty.cc/docs/minio"&gt;&lt;code&gt;MINIO&lt;/code&gt;&lt;/a&gt; 可以作为一个样例。后续还会有更多的模块加入，例如对 Mongo 与 MySQL 的初步支持已经提上了日程。&lt;/p&gt;
&lt;p&gt;请注意，所有模块都强依赖 &lt;code&gt;NODE&lt;/code&gt; 模块：在 Pigsty 中节点必须先安装 &lt;code&gt;NODE&lt;/code&gt; 模块，被 Pigsty 纳管后方可部署其他模块。
当节点（默认）使用本地软件源进行安装时，&lt;code&gt;NODE&lt;/code&gt; 模块对 &lt;code&gt;INFRA&lt;/code&gt; 模块有弱依赖。因此安装 &lt;code&gt;INFRA&lt;/code&gt; 模块的管理节点/基础设施节点会在 &lt;a href="https://pigsty.cc/docs/setup/playbook"&gt;&lt;code&gt;deploy.yml&lt;/code&gt;&lt;/a&gt; 剧本中完成 Bootstrap 过程，解决循环依赖。&lt;/p&gt;</description></item><item><title>节点</title><link>https://pigsty.cc/docs/concept/arch/node/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/arch/node/</guid><description>&lt;p&gt;&lt;strong&gt;节点（node）&lt;/strong&gt; 是对硬件资源/操作系统的抽象，可以是物理机，裸金属、虚拟机、或者容器与 pods。&lt;/p&gt;
&lt;p&gt;只要装着 &lt;a href="https://pigsty.cc/docs/ref/linux"&gt;&lt;strong&gt;Linux 操作系统&lt;/strong&gt;&lt;/a&gt;（以及 systemd 守护进程），能使用 CPU/内存/磁盘/网络 等标准资源，即可视作节点。&lt;/p&gt;
&lt;p&gt;节点上可以安装 &lt;a href="https://pigsty.cc/docs/ref/module"&gt;&lt;strong&gt;模块&lt;/strong&gt;&lt;/a&gt;，Pigsty 中存在几种不同类型节点，主要区别就在于安装了不同的模块。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;类型&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;普通节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;被 Pigsty 管理的节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#admin%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;ADMIN 节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;使用 Ansible 发出管理指令的节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#infra%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;INFRA 节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安装 &lt;a href="https://pigsty.cc/docs/infra/"&gt;&lt;strong&gt;INFRA&lt;/strong&gt;&lt;/a&gt; 模块的基础设施节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#etcd%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;ETCD 节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安装 &lt;a href="https://pigsty.cc/docs/etcd/"&gt;&lt;strong&gt;ETCD&lt;/strong&gt;&lt;/a&gt; 模块的分布式共识节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#minio%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;MINIO 节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安装 &lt;a href="https://pigsty.cc/docs/minio/"&gt;&lt;strong&gt;MINIO&lt;/strong&gt;&lt;/a&gt; 模块的对象存储节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#pgsql%E8%8A%82%E7%82%B9"&gt;&lt;strong&gt;PGSQL 节点&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安装 &lt;a href="https://pigsty.cc/docs/pgsql/"&gt;&lt;strong&gt;PGSQL&lt;/strong&gt;&lt;/a&gt; 模块的数据库节点&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;……&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安装了其他各类模块的节点……&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;在 &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;单机部署&lt;/strong&gt;&lt;/a&gt; Pigsty 时，多者合而为一，当前节点将同时作为普通节点，管理节点、基础设施节点、ETCD 节点，以及数据库节点。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="普通节点"&gt;普通节点&lt;/h2&gt;
&lt;p&gt;使用 Pigsty 管理节点，可在其上安装模块。&lt;a href="https://pigsty.cc/docs/node/playbook#nodeyml"&gt;&lt;strong&gt;&lt;code&gt;node.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 剧本将调整节点至所需状态。
普通节点上可能会运行以下服务：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;组件&lt;/th&gt;
 &lt;th style="text-align: center"&gt;端口&lt;/th&gt;
 &lt;th&gt;描述&lt;/th&gt;
 &lt;th&gt;状态&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;node_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;9100&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;节点监控指标导出器&lt;/td&gt;
 &lt;td&gt;✅ 默认启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;haproxy&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;9101&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;HAProxy 负载均衡器（管理端口）&lt;/td&gt;
 &lt;td&gt;✅ 默认启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;vector&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;9598&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;日志收集代理&lt;/td&gt;
 &lt;td&gt;✅ 默认启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;docker&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;9323&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;启用容器支持&lt;/td&gt;
 &lt;td&gt;⚠️ 按需启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;keepalived&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;n/a&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;管理节点集群 L2 VIP&lt;/td&gt;
 &lt;td&gt;⚠️ 按需启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;keepalived_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;9650&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;监控 Keepalived 状态&lt;/td&gt;
 &lt;td&gt;⚠️ 按需启用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这里，&lt;code&gt;node_exporter&lt;/code&gt; 会向监控系统暴露主机上的各类监控指标，&lt;code&gt;vector&lt;/code&gt; 会向日志收集系统发送日志，&lt;code&gt;haproxy&lt;/code&gt; 则提供负载均衡功能，对外暴露服务。
这三项服务默认开启。而 &lt;a href="https://pigsty.cc/docs/docker"&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;/a&gt;，&lt;code&gt;keepalived&lt;/code&gt; 及 &lt;code&gt;keepalived_exporter&lt;/code&gt; 这三项服务作为可选项，可按需启用。&lt;/p&gt;</description></item><item><title>集群模型图</title><link>https://pigsty.cc/docs/concept/model/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/</guid><description>&lt;p&gt;在 Pigsty 中最大的实体概念叫做 &lt;strong&gt;部署（Deployment）&lt;/strong&gt;，一套部署中的主要实体与关系（E-R 图）如下所示：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/er-full.svg" alt=""&gt;&lt;/p&gt;
&lt;p&gt;一套部署也可以理解为一个 &lt;strong&gt;环境（Environment）&lt;/strong&gt;。例如，生产环境（Prod），用户测试环境（UTA），预发环境（Staging），测试环境（Testing），开发环境（Devbox），等等。
每个环境中，都对应着一份 Pigsty &lt;a href="https://pigsty.cc/docs/concept/iac/inventory"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt;，描述了环境中的所有实体与属性。&lt;/p&gt;
&lt;p&gt;通常来说，一套环境中也会带有一套共用的基础设施（&lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;strong&gt;&lt;code&gt;INFRA&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;），广义的基础设施还包括 &lt;a href="https://pigsty.cc/docs/etcd"&gt;&lt;strong&gt;&lt;code&gt;ETCD&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;（高可用 DCS）以及 &lt;a href="https://pigsty.cc/docs/minio"&gt;&lt;strong&gt;&lt;code&gt;MINIO&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;（集中式备份仓库），
同时供环境中的多套 PostgreSQL 数据库集群（以及其他数据库模块组件）使用。（例外：也有 &lt;a href="https://pigsty.cc/docs/setup/slim"&gt;&lt;strong&gt;不带基础设施的部署&lt;/strong&gt;&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;在 Pigsty 中，几乎所有数据库模块都是以 &amp;ldquo;&lt;strong&gt;集群&lt;/strong&gt;&amp;quot;（Cluster）的方式组织起来的。每一个集群都是一个 Ansible 分组，包含有若干节点资源。
例如 PostgreSQL 高可用数据库集群，Redis，Etcd / MinIO 这些数据库都是以集群的形式存在。一套环境中可以包含多个集群。&lt;/p&gt;</description></item><item><title>声明式配置 —— 基础设施即代码（IaC）</title><link>https://pigsty.cc/docs/concept/iac/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/</guid><description>&lt;p&gt;Pigsty 遵循 IaC 与 GitOPS 的理念：使用声明式的 &lt;a href="https://pigsty.cc/docs/concept/iac/inventory"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; 描述整个环境，并通过 &lt;a href="https://pigsty.cc/docs/setup/playbook"&gt;&lt;strong&gt;幂等剧本&lt;/strong&gt;&lt;/a&gt; 来实现。&lt;/p&gt;
&lt;p&gt;用户用声明的方式通过 &lt;a href="https://pigsty.cc/docs/ref/param"&gt;&lt;strong&gt;参数&lt;/strong&gt;&lt;/a&gt; 来描述自己期望的状态，而剧本则以幂等的方式调整目标节点以达到这个状态。
这类似于 Kubernetes 的 CRD &amp;amp; Operator，然而 Pigsty 在裸机和虚拟机上，通过 Ansible 实现了这样的功能。&lt;/p&gt;
&lt;p&gt;Pigsty 诞生之初是为了解决超大规模 PostgreSQL 集群的运维管理问题，背后的想法很简单 —— 我们需要有在十分钟内在就绪的服务器上复刻整套基础设施（100+数据库集群 + PG/Redis + 可观测性）的能力。
任何 GUI + ClickOps 都无法在如此短的时间内完成如此复杂的任务，这让 CLI + IaC 成为唯一的选择 —— 它提供了精确，高效的控制能力。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://pigsty.cc/docs/concept/iac/inventory"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; &lt;strong&gt;&lt;code&gt;pigsty.yml&lt;/code&gt;&lt;/strong&gt; 文件描述了整个部署的状态，无论是 生产环境（prod），预发环境（staging）， 测试环境（test），还是 开发环境（devbox），
基础设施的区别仅在于配置清单的不同，而部署交付的逻辑则是完全相同的。&lt;/p&gt;
&lt;p&gt;您可以使用 git 对这份部署的 “种子/基因” 进行版本控制与审计，而且，Pigsty 甚至支持将配置清单以数据库表的形式存储在 PostgreSQL &lt;a href="https://pigsty.cc/docs/concept/iac/cmdb"&gt;&lt;strong&gt;CMDB&lt;/strong&gt;&lt;/a&gt; 中，
更进一步从 Infra as Code 升级为 Infra as Data，无缝与您现有的工作流程集成与对接。&lt;/p&gt;
&lt;p&gt;IaC 面向专业用户与企业场景而设计，但也针对个人开发者，SMB 进行了深度优化。
即使您并非专业 DBA，也无需了解这几百个调节开关与旋钮，所有参数都带有表现良好的默认值，
您完全可以在 &lt;strong&gt;零配置&lt;/strong&gt; 的情况下，获得一个开箱即用的单机数据库节点；
简单地再添加两行 IP 地址，就能获得一套企业级的高可用的 PostgreSQL 集群。&lt;/p&gt;</description></item><item><title>PG 高可用</title><link>https://pigsty.cc/docs/concept/ha/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/</guid><description>&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;Pigsty 的 PostgreSQL 集群带有开箱即用的高可用方案，由 &lt;a href="https://patroni.readthedocs.io/en/latest/"&gt;&lt;strong&gt;Patroni&lt;/strong&gt;&lt;/a&gt;、&lt;a href="https://etcd.io/"&gt;&lt;strong&gt;Etcd&lt;/strong&gt;&lt;/a&gt; 和 &lt;a href="http://www.haproxy.org/"&gt;&lt;strong&gt;HAProxy&lt;/strong&gt;&lt;/a&gt; 强力驱动。&lt;/p&gt;
&lt;p&gt;当您的 PostgreSQL 集群含有两个或更多实例时，您无需任何配置即拥有了硬件故障自愈的数据库高可用能力 —— 只要集群中有任意实例存活，集群就可以对外提供完整的服务，而客户端只要连接至集群中的任意节点，即可获得完整的服务，而无需关心主从拓扑变化。&lt;/p&gt;
&lt;p&gt;在默认配置下，主库故障恢复时间目标 RTO ≈ 45s，数据恢复点目标 RPO &amp;lt; 1MB；从库故障 RPO = 0，RTO ≈ 0 (闪断)；在一致性优先模式下，可确保故障切换数据零损失：
RPO = 0。以上指标均可通过参数，根据您的实际硬件条件与可靠性要求 &lt;a href="https://pigsty.cc/docs/concept/ha/rto"&gt;&lt;strong&gt;按需配置&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Pigsty 内置了 HAProxy 负载均衡器用于自动流量切换，提供 DNS/VIP/LVS 等多种接入方式供客户端选用。故障切换与主动切换对业务侧除零星闪断外几乎无感知，应用不需要修改连接串重启。
极小的维护窗口需求带来了极大的灵活便利：您完全可以在无需应用配合的情况下滚动维护升级整个集群。硬件故障可以等到第二天再抽空善后处置的特性，让研发，运维与 DBA 都能在故障时安心睡个好觉。&lt;/p&gt;
&lt;p&gt;&lt;del&gt;&lt;img src="https://pigsty.cc/img/pigsty/ha.png" alt="pigsty-ha"&gt;&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;许多大型组织与核心机构已经在生产环境中长时间使用 Pigsty ，最大的部署有 25K CPU 核心与 220+ PostgreSQL 超大规格实例（64c / 512g / 3TB NVMe SSD）；在这一部署案例中，五年内经历了数十次硬件故障与各类事故，但依然可以保持高于 &lt;strong&gt;99.999%&lt;/strong&gt; 的总体可用性战绩。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;高可用（High-Availability）解决什么问题？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;将数据安全C/IA中的可用性提高到一个新高度：RPO ≈ 0, RTO &amp;lt; 45s。&lt;/li&gt;
&lt;li&gt;获得无缝滚动维护的能力，最小化维护窗口需求，带来极大便利。&lt;/li&gt;
&lt;li&gt;硬件故障可以立即自愈，无需人工介入，运维DBA可以睡个好觉。&lt;/li&gt;
&lt;li&gt;从库可以用于承载只读请求，分担主库负载，让资源得以充分利用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;高可用有什么代价？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基础设施依赖：高可用需要依赖 DCS (etcd/zk/consul) 提供共识。&lt;/li&gt;
&lt;li&gt;起步门槛增加：一个有意义的高可用部署环境至少需要 &lt;strong&gt;三个节点&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;额外的资源消耗：一个新从库就要消耗一份额外资源，不算大问题。&lt;/li&gt;
&lt;li&gt;复杂度代价显著升高：备份成本显著加大，需要使用工具压制复杂度。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;高可用的局限性&lt;/strong&gt;&lt;/p&gt;</description></item><item><title>RPO 利弊权衡</title><link>https://pigsty.cc/docs/concept/ha/rpo/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/rpo/</guid><description>&lt;p&gt;&lt;strong&gt;RPO&lt;/strong&gt;（Recovery Point Objective，恢复点目标）定义了在主库发生故障时，&lt;strong&gt;允许丢失的最大数据量&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;对于金融交易这类数据完整性至关重要的场景，通常要求 RPO = 0，即不允许任何数据丢失；&lt;/p&gt;
&lt;p&gt;然而更为严格的 RPO 指标是有代价的，它会引入更高的写入延迟，降低系统吞吐量，并且存在从库故障导致主库不可用的风险。
因此对于常规场景，通常可以接受一定量的数据丢失（例如允许丢失不超过 1MB 的数据），以换取更高的可用性与性能。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="利弊权衡"&gt;利弊权衡&lt;/h2&gt;
&lt;p&gt;通常在异步复制场景下，从库和主库之间会存在一定的复制延迟（取决于网络和吞吐量，正常在 10KB-100KB / 100µs-10ms 的数量级），
这意味着当主库发生故障时，从库可能还没有完全同步主库的最新数据。这时候如果出现故障切换，新的主库可能会丢失一些尚未复制的数据。&lt;/p&gt;
&lt;p&gt;潜在数据丢失量的上限由 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_rpo"&gt;&lt;strong&gt;&lt;code&gt;pg_rpo&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 参数控制，默认为 &lt;code&gt;1048576&lt;/code&gt; （&lt;code&gt;1MB&lt;/code&gt;），这意味着在故障转移期间最多可以容忍 1MiB 的数据丢失。&lt;/p&gt;
&lt;p&gt;当集群主库宕机时，如果有任何一个从库的复制延迟在这个值以内，Pigsty 将自动提升该从库为新的主库。
然而当所有从库副本的复制延迟都超出这个阈值时，Pigsty 将拒绝进行 [&lt;strong&gt;自动故障切换&lt;/strong&gt;] 以避免数据丢失。
此时需要人工介入进行决策 —— 等待主库恢复（可能永远也不会恢复），还是接受数据损失并强制提升一个从库为新的主库。&lt;/p&gt;
&lt;p&gt;您需要根据业务的需求偏好配置这个值，在 &lt;strong&gt;可用性&lt;/strong&gt; 和 &lt;strong&gt;一致性&lt;/strong&gt; 之间进行 &lt;strong&gt;利弊权衡&lt;/strong&gt;。
增大这个值可以提高自动故障切换的成功率，但也会增加潜在的数据丢失量上限。&lt;/p&gt;
&lt;p&gt;当您指定 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_rpo"&gt;&lt;strong&gt;&lt;code&gt;pg_rpo&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; = 0 时，Pigsty 将启用 &lt;strong&gt;同步复制&lt;/strong&gt;，确保主库在确认至少一个从库持久化数据后才返回写入成功。
这种配置能确保没有复制延迟，但会带来显著的写入延迟，并降低整体的吞吐量。&lt;/p&gt;
&lt;pre class="mermaid"&gt;flowchart LR
 A([主库故障]) --&amp;gt; B{同步复制?}

 B --&amp;gt;|否| C{延迟 &amp;lt; RPO?}
 B --&amp;gt;|是| D{同步从库&amp;lt;br/&amp;gt;可用?}

 C --&amp;gt;|是| E[有损自动故障切换&amp;lt;br/&amp;gt;RPO &amp;lt; 1MB]
 C --&amp;gt;|否| F[拒绝自动切换&amp;lt;br/&amp;gt;等待主库恢复&amp;lt;br/&amp;gt;或人工介入决策]

 D --&amp;gt;|是| G[无损自动故障切换&amp;lt;br/&amp;gt;RPO = 0]
 D --&amp;gt;|否| H{严格模式?}

 H --&amp;gt;|否| C
 H --&amp;gt;|是| F

 style A fill:#dc3545,stroke:#b02a37,color:#fff
 style E fill:#F0AD4E,stroke:#146c43,color:#fff
 style G fill:#198754,stroke:#146c43,color:#fff
 style F fill:#BE002F,stroke:#565e64,color:#fff&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="保护模式"&gt;保护模式&lt;/h2&gt;
&lt;p&gt;Pigsty 提供三种保护模式，以帮助用户在不同的 RPO 要求下进行利弊权衡，类似于 &lt;a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sbydb/oracle-data-guard-protection-modes.html"&gt;&lt;strong&gt;Oracle Data Guard&lt;/strong&gt;&lt;/a&gt; 的数据保护模式。&lt;/p&gt;</description></item><item><title>INFRA 架构</title><link>https://pigsty.cc/docs/concept/arch/infra/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/arch/infra/</guid><description>&lt;p&gt;运行生产级别高可用 PostgreSQL 集群，通常需要一套完善的基础设施服务（底座）来支撑，例如监控告警、日志收集、时间同步、DNS 解析，本地软件仓库等。
Pigsty 提供了 &lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;strong&gt;INFRA 模块&lt;/strong&gt;&lt;/a&gt; 来解决这个问题 —— 这是一个 &lt;strong&gt;可选模块&lt;/strong&gt;，但我们强烈推荐启用它。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;下图是 &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;单机部署&lt;/strong&gt;&lt;/a&gt; 时的架构示意图，图中右半部分即为 &lt;a href="https://pigsty.cc/docs/infra"&gt;&lt;strong&gt;INFRA 模块&lt;/strong&gt;&lt;/a&gt; 所包含的组件，其中包括：&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th&gt;种类&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#nginx"&gt;&lt;strong&gt;Nginx&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;Web服务器&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/setup/webui"&gt;&lt;strong&gt;Web 界面&lt;/strong&gt;&lt;/a&gt; 的统一入口，&lt;a href="#repo"&gt;&lt;strong&gt;本地软件仓库&lt;/strong&gt;&lt;/a&gt;，内部服务的反向代理&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#repo"&gt;&lt;strong&gt;Repo&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;软件仓库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;APT / DNF 仓库，下载有所有部署需要的 RPM/DEB 包及其依赖&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#grafana"&gt;&lt;strong&gt;Grafana&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;可视化平台&lt;/td&gt;
 &lt;td style="text-align: left"&gt;呈现监控指标、日志与链路追踪，承载监控大屏、巡检报表以及自定义数据应用。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#victoriametrics"&gt;&lt;strong&gt;VictoriaMetrics&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;时序数据库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;拉取全部监控指标，兼容 Prometheus API，并通过 VMUI 提供查询界面。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#victorialogs"&gt;&lt;strong&gt;VictoriaLogs&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;日志平台&lt;/td&gt;
 &lt;td style="text-align: left"&gt;集中收集存储日志，所有节点默认运行 Vector，将系统日志与数据库日志推送到此。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#victoriatraces"&gt;&lt;strong&gt;VictoriaTraces&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;链路追踪&lt;/td&gt;
 &lt;td style="text-align: left"&gt;收集慢 SQL、服务链路等追踪数据。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#vmalert"&gt;&lt;strong&gt;VMAlert&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;告警计算&lt;/td&gt;
 &lt;td style="text-align: left"&gt;评估告警规则，将事件推送至 Alertmanager。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#alertmanager"&gt;&lt;strong&gt;AlertManager&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;告警管理&lt;/td&gt;
 &lt;td style="text-align: left"&gt;聚合告警事件，分发告警通知，支持邮件、Webhook 等渠道。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#blackboxexporter"&gt;&lt;strong&gt;BlackboxExporter&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;黑盒探测&lt;/td&gt;
 &lt;td style="text-align: left"&gt;探测各个 IP/VIP/URL 的可达性。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#dnsmasq"&gt;&lt;strong&gt;DNSMASQ&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;DNS解析&lt;/td&gt;
 &lt;td style="text-align: left"&gt;提供 DNS 解析服务，解析 Pigsty 内部使用到的域名。【可选】&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#chronyd"&gt;&lt;strong&gt;Chronyd&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;时间同步&lt;/td&gt;
 &lt;td style="text-align: left"&gt;提供 NTP 时间同步服务，确保所有节点时间一致。 【可选】&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/ca"&gt;&lt;strong&gt;CA&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;证书签发&lt;/td&gt;
 &lt;td style="text-align: left"&gt;签发环境内的加密证书&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/setup/playbook"&gt;&lt;strong&gt;Ansible&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;发起管理&lt;/td&gt;
 &lt;td style="text-align: left"&gt;批量，声明式，无 Agent 管理大量服务器的工具&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href="https://pigsty.cc/docs/infra/"&gt;&lt;img src="https://pigsty.cc/img/pigsty/arch.png" alt="pigsty-arch"&gt;&lt;/a&gt;&lt;/p&gt;</description></item><item><title>PGSQL 架构</title><link>https://pigsty.cc/docs/concept/arch/pgsql/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/arch/pgsql/</guid><description>&lt;p&gt;PGSQL 模块在生产环境中以 &lt;strong&gt;集群&lt;/strong&gt; 的形式组织，这些 &lt;strong&gt;集群&lt;/strong&gt; 是由一组通过 &lt;strong&gt;主-备&lt;/strong&gt; 关联的数据库 &lt;strong&gt;实例&lt;/strong&gt; 组成的 &lt;strong&gt;逻辑实体&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://pigsty.cc/docs/pgsql"&gt;&lt;strong&gt;PGSQL 模块&lt;/strong&gt;&lt;/a&gt; 包含下列组件，协同提供生产级 PostgreSQL 高可用集群服务：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th&gt;简介&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#postgresql"&gt;&lt;strong&gt;&lt;code&gt;postgres&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;数据库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;世界上最先进的开源关系型数据库，PGSQL 模块的核心。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#patroni"&gt;&lt;strong&gt;&lt;code&gt;patroni&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;高可用&lt;/td&gt;
 &lt;td style="text-align: left"&gt;托管 PostgreSQL 进程，协调故障转移、选主、配置变更。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgbouncer"&gt;&lt;strong&gt;&lt;code&gt;pgbouncer&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;连接池&lt;/td&gt;
 &lt;td style="text-align: left"&gt;轻量级连接池中间件，复用连接、降低开销、提供额外灵活性。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgbackrest"&gt;&lt;strong&gt;&lt;code&gt;pgbackrest&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;备份恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;全量/增量备份与 WAL 归档，支持本地与对象存储。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pg_exporter"&gt;&lt;strong&gt;&lt;code&gt;pg_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;指标导出&lt;/td&gt;
 &lt;td style="text-align: left"&gt;导出 PostgreSQL 监控指标供 Prometheus 抓取。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgbouncer_exporter"&gt;&lt;strong&gt;&lt;code&gt;pgbouncer_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;指标导出&lt;/td&gt;
 &lt;td style="text-align: left"&gt;导出 &lt;a href="#pgbouncer"&gt;&lt;strong&gt;Pgbouncer&lt;/strong&gt;&lt;/a&gt; 连接池指标。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#pgbackrest_exporter"&gt;&lt;strong&gt;&lt;code&gt;pgbackrest_exporter&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;指标导出&lt;/td&gt;
 &lt;td style="text-align: left"&gt;导出 &lt;a href="#pgbackrest"&gt;&lt;strong&gt;pgBackrest&lt;/strong&gt;&lt;/a&gt; 备份状态指标。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="#vip-manager"&gt;&lt;strong&gt;&lt;code&gt;vip-manager&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;VIP管理&lt;/td&gt;
 &lt;td style="text-align: left"&gt;将 L2 VIP 绑定到当前主库节点，实现透明漂移。【可选】&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;其中 &lt;a href="#vip-manager"&gt;&lt;strong&gt;&lt;code&gt;vip-manager&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 为按需启用的组件。此外，PGSQL 还会使用到其他模块中的组件：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;组件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;模块&lt;/th&gt;
 &lt;th&gt;简介&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#haproxy"&gt;&lt;strong&gt;&lt;code&gt;haproxy&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/node"&gt;&lt;strong&gt;NODE&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;负载均衡&lt;/td&gt;
 &lt;td style="text-align: left"&gt;对外暴露服务端口，根据角色分发流量至主库或从库。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#vector"&gt;&lt;strong&gt;&lt;code&gt;vector&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/node"&gt;&lt;strong&gt;NODE&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;日志采集&lt;/td&gt;
 &lt;td style="text-align: left"&gt;收集 PostgreSQL、&lt;a href="#patroni"&gt;Patroni&lt;/a&gt;、&lt;a href="#pgbouncer"&gt;Pgbouncer&lt;/a&gt; 等日志推送至中心。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;a href="#etcd"&gt;&lt;strong&gt;&lt;code&gt;etcd&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/etcd"&gt;&lt;strong&gt;ETCD&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;DCS&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分布式一致性存储，用于保存集群元数据与领导者信息。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;如果用类比来形容，&lt;a href="#postgresql"&gt;PostgreSQL&lt;/a&gt; 数据库内核就是 CPU，而整个 PGSQL 模块将其封装为一台完整的计算机。
&lt;a href="#patroni"&gt;Patroni&lt;/a&gt; 与 &lt;a href="#etcd"&gt;Etcd&lt;/a&gt; 组成 &lt;a href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%90%E7%B3%BB%E7%BB%9F"&gt;高可用子系统&lt;/a&gt;，&lt;a href="#pgbackrest"&gt;pgBackRest&lt;/a&gt; 与 MinIO 组成 &lt;a href="#%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%AD%90%E7%B3%BB%E7%BB%9F"&gt;备份恢复子系统&lt;/a&gt;。
&lt;a href="#haproxy"&gt;HAProxy&lt;/a&gt; 与 &lt;a href="#pgbouncer"&gt;Pgbouncer&lt;/a&gt;、&lt;a href="#vip-manager"&gt;vip-manager&lt;/a&gt; 组成 &lt;a href="#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%85%A5%E5%AD%90%E7%B3%BB%E7%BB%9F"&gt;接入子系统&lt;/a&gt;。
各种 Exporter 与 &lt;a href="#vector"&gt;Vector&lt;/a&gt; 构成 &lt;a href="#%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E5%AD%90%E7%B3%BB%E7%BB%9F"&gt;可观测性子系统&lt;/a&gt;；
最后还可以替换不同的 &lt;a href="https://pigsty.cc/docs/pgsql/kernel"&gt;&lt;strong&gt;内核 CPU&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="https://pigsty.cc/docs/pgsql/ext"&gt;&lt;strong&gt;扩展卡&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;</description></item><item><title>RTO 利弊权衡</title><link>https://pigsty.cc/docs/concept/ha/rto/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/rto/</guid><description>&lt;p&gt;&lt;strong&gt;RTO&lt;/strong&gt;（Recovery Time Objective，恢复时间目标）定义了在主库发生故障时，&lt;strong&gt;系统恢复写入能力所需的最长时间&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;对于核心交易系统这类可用性至关重要的场景，通常要求 RTO 尽可能短，例如一分钟内。&lt;/p&gt;
&lt;p&gt;然而更短的 RTO 指标是有代价的，它会增加误切风险：网络抖动可能被误判为故障，导致不必要的故障切换。
因此对于跨机房/跨地域部署的场景，通常需要放宽 RTO 要求（例如 1-2 分钟），以降低误切风险。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="利弊权衡"&gt;利弊权衡&lt;/h2&gt;
&lt;p&gt;故障切换时的不可用时长上限由 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_rto"&gt;&lt;strong&gt;&lt;code&gt;pg_rto&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 参数控制。Pigsty 提供了四种预设的 RTO 模式：
&lt;code&gt;fast&lt;/code&gt;、&lt;code&gt;norm&lt;/code&gt;、&lt;code&gt;safe&lt;/code&gt;、&lt;code&gt;wide&lt;/code&gt;，分别针对不同的网络条件与部署场景进行了优化，默认使用 &lt;code&gt;norm&lt;/code&gt; 模式（约 45 秒）。
您也可以使用秒数直接指定 RTO 上限，系统会自动映射到最接近的模式。&lt;/p&gt;
&lt;p&gt;当主库发生故障时，整个恢复流程涉及多个阶段：Patroni 检测故障、DCS 锁过期、新主选举、执行 promote、HAProxy 感知新主。
减小 RTO 意味着缩短各阶段的超时时间，这会使集群对网络抖动更加敏感，从而增加误切风险。&lt;/p&gt;
&lt;p&gt;您需要根据实际网络条件选择合适的模式，在 &lt;strong&gt;恢复速度&lt;/strong&gt; 与 &lt;strong&gt;误切风险&lt;/strong&gt; 之间取得平衡。
网络质量越差，越应该选择保守的模式；网络质量越好，越可以选择激进的模式。&lt;/p&gt;
&lt;pre class="mermaid"&gt;flowchart LR
 A([主库故障]) --&amp;gt; B{Patroni&amp;lt;br/&amp;gt;检测到?}

 B --&amp;gt;|PG崩溃| C[尝试本地重启]
 B --&amp;gt;|节点宕机| D[等待 TTL 过期]

 C --&amp;gt;|成功| E([本地恢复])
 C --&amp;gt;|失败/超时| F[释放 Leader 锁]

 D --&amp;gt; F
 F --&amp;gt; G[从库竞选]
 G --&amp;gt; H[执行 Promote]
 H --&amp;gt; I[HAProxy 感知]
 I --&amp;gt; J([服务恢复])

 style A fill:#dc3545,stroke:#b02a37,color:#fff
 style E fill:#198754,stroke:#146c43,color:#fff
 style J fill:#198754,stroke:#146c43,color:#fff&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="四种模式"&gt;四种模式&lt;/h2&gt;
&lt;p&gt;Pigsty 提供四种 RTO 模式，以帮助用户在不同的网络条件下进行利弊权衡。&lt;/p&gt;</description></item><item><title>故障切换模型</title><link>https://pigsty.cc/docs/concept/ha/failure/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/failure/</guid><description>&lt;p&gt;Patroni 故障按故障对象分类可以分为以下 10 类，按照检测路径不同，可以进一步归纳为五类，在本节内详细展开。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;#&lt;/th&gt;
 &lt;th&gt;故障场景&lt;/th&gt;
 &lt;th&gt;描述&lt;/th&gt;
 &lt;th&gt;最终走哪条路径&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;1&lt;/td&gt;
 &lt;td&gt;PG 进程崩溃&lt;/td&gt;
 &lt;td&gt;crash、OOM killed&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;主动检测&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;2&lt;/td&gt;
 &lt;td&gt;PG 拒绝连接&lt;/td&gt;
 &lt;td&gt;max_connections&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;主动检测&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;3&lt;/td&gt;
 &lt;td&gt;PG 假活&lt;/td&gt;
 &lt;td&gt;进程在但无响应&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;主动检测&lt;/strong&gt; (检测超时)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;4&lt;/td&gt;
 &lt;td&gt;Patroni 进程崩溃&lt;/td&gt;
 &lt;td&gt;kill -9、OOM&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;被动检测&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;5&lt;/td&gt;
 &lt;td&gt;Patroni 假活&lt;/td&gt;
 &lt;td&gt;进程在但卡住&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;Watchdog&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;6&lt;/td&gt;
 &lt;td&gt;节点宕机&lt;/td&gt;
 &lt;td&gt;断电、硬件故障&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;被动检测&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;7&lt;/td&gt;
 &lt;td&gt;节点假活&lt;/td&gt;
 &lt;td&gt;IO hang、CPU 饥饿&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;Watchdog&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;8&lt;/td&gt;
 &lt;td&gt;主库 ↔ DCS 网络中断&lt;/td&gt;
 &lt;td&gt;防火墙、交换机故障&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;网络分区&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;9&lt;/td&gt;
 &lt;td&gt;存储故障&lt;/td&gt;
 &lt;td&gt;磁盘坏、磁盘满、挂载失败&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;主动检测&lt;/strong&gt; 或 &lt;strong&gt;Watchdog&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;10&lt;/td&gt;
 &lt;td&gt;手动切换&lt;/td&gt;
 &lt;td&gt;Switchover/Failover&lt;/td&gt;
 &lt;td&gt;&lt;strong&gt;手动触发&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;但是在 RTO 计算上，最终所有故障都会收敛到两条路径上，本节深入探讨了这两种情况下的 RTO 上下限与均值。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/concept/ha/failure/passive"&gt;&lt;strong&gt;Patroni 失联后被动触发选举&lt;/strong&gt;&lt;/a&gt;：&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/concept/ha/failure/active"&gt;&lt;strong&gt;Patroni 主动检测故障并切换&lt;/strong&gt;&lt;/a&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="mermaid"&gt;flowchart LR
 A([主库故障]) --&amp;gt; B{Patroni&amp;lt;br/&amp;gt;检测到?}

 B --&amp;gt;|PG崩溃| C[尝试本地重启]
 B --&amp;gt;|节点宕机| D[等待 TTL 过期]

 C --&amp;gt;|成功| E([本地恢复])
 C --&amp;gt;|失败/超时| F[释放 Leader 锁]

 D --&amp;gt; F
 F --&amp;gt; G[从库竞选]
 G --&amp;gt; H[执行 Promote]
 H --&amp;gt; I[HAProxy 感知]
 I --&amp;gt; J([服务恢复])

 style A fill:#dc3545,stroke:#b02a37,color:#fff
 style E fill:#198754,stroke:#146c43,color:#fff
 style J fill:#198754,stroke:#146c43,color:#fff&lt;/pre&gt;</description></item><item><title>时间点恢复</title><link>https://pigsty.cc/docs/concept/pitr/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/</guid><description>&lt;blockquote&gt;
&lt;p&gt;当您不小心删除了数据、表、甚至整个数据库时，PITR 能力让您回到过去任意时刻，避免软件缺陷与人为失误导致的数据损失。&lt;/p&gt;
&lt;p&gt;—— 这个曾经只有资深 DBA 才能施展的『魔法』，现在对所有用户都可以轻松做到零配置开箱即用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;Pigsty 的 PostgreSQL 集群带有自动配置的时间点恢复（PITR）方案，基于 &lt;a href="https://pgbackrest.org/"&gt;&lt;strong&gt;pgBackRest&lt;/strong&gt;&lt;/a&gt; 与可选的对象存储仓库 &lt;a href="https://min.io/"&gt;&lt;strong&gt;MinIO&lt;/strong&gt;&lt;/a&gt; 提供。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://pigsty.cc/docs/concept/ha"&gt;&lt;strong&gt;高可用方案&lt;/strong&gt;&lt;/a&gt; 可以解决硬件故障，但却对软件缺陷与人为失误导致的数据删除/覆盖写入/删库等问题却无能为力。
对于这种情况，Pigsty 提供了开箱即用的 &lt;strong&gt;时间点恢复&lt;/strong&gt;（Point in Time Recovery, PITR）能力，无需额外配置即默认启用。&lt;/p&gt;
&lt;p&gt;Pigsty 为您提供了基础备份与 WAL 归档的默认配置，您可以使用本地目录与磁盘，亦或专用的 MinIO 集群或 S3 对象存储服务来存储备份并实现异地容灾。
当您使用本地磁盘时，默认保留恢复至过去一天内的任意时间点的能力。当您使用 MinIO 或 S3 时，默认保留恢复至过去一周内的任意时间点的能力。
只要存储空间管够，您尽可保留任意长地可恢复时间段，丰俭由人。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="时间点恢复解决什么问题"&gt;时间点恢复解决什么问题？&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;容灾能⼒增强：&lt;strong&gt;RPO&lt;/strong&gt; 从 ∞ 降⾄ ⼗⼏MB， &lt;strong&gt;RTO&lt;/strong&gt; 从 ∞ 降⾄ ⼏⼩时/⼏刻钟。&lt;/li&gt;
&lt;li&gt;确保数据安全：C/I/A 中的 &lt;strong&gt;数据完整性&lt;/strong&gt;：避免误删导致的数据⼀致性问题。&lt;/li&gt;
&lt;li&gt;确保数据安全：C/I/A 中的 &lt;strong&gt;数据可⽤性&lt;/strong&gt;：提供对“永久不可⽤”这种灾难情况的兜底&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;单实例配置策略&lt;/th&gt;
 &lt;th style="text-align: center"&gt;事件&lt;/th&gt;
 &lt;th&gt;RTO&lt;/th&gt;
 &lt;th style="text-align: left"&gt;RPO&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;i class="fa-solid fa-music text-danger"&gt;&lt;/i&gt; 什么也不做&lt;/td&gt;
 &lt;td style="text-align: center"&gt;宕机&lt;/td&gt;
 &lt;td&gt;&lt;i class="fas fa-circle-xmark text-danger"&gt;&lt;/i&gt; &lt;strong&gt;永久丢失&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;i class="fas fa-circle-xmark text-danger"&gt;&lt;/i&gt; &lt;strong&gt;全部丢失&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;i class="fa-solid fa-copy text-secondary"&gt;&lt;/i&gt; 基础备份&lt;/td&gt;
 &lt;td style="text-align: center"&gt;宕机&lt;/td&gt;
 &lt;td&gt;&lt;i class="fa-solid fa-triangle-exclamation text-secondary"&gt;&lt;/i&gt; 取决于备份大小与带宽（几小时）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;i class="fa-solid fa-triangle-exclamation text-secondary"&gt;&lt;/i&gt; 丢失上一次备份后的数据（几个小时到几天）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;i class="fa-solid fa-copy text-primary"&gt;&lt;/i&gt; 基础备份 + &lt;i class="fa-solid fa-clock-rotate-left text-primary"&gt;&lt;/i&gt; WAL归档&lt;/td&gt;
 &lt;td style="text-align: center"&gt;宕机&lt;/td&gt;
 &lt;td&gt;&lt;i class="fa-solid fa-triangle-exclamation text-primary"&gt;&lt;/i&gt; 取决于备份大小与带宽（几小时）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;i class="fa-solid fa-triangle-exclamation text-primary"&gt;&lt;/i&gt; 丢失最后尚未归档的数据（几十MB）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="时间点恢复有什么代价"&gt;时间点恢复有什么代价？&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;降低数据安全中的 C：&lt;strong&gt;机密性&lt;/strong&gt;，产生额外泄漏点，需要额外对备份进⾏保护。&lt;/li&gt;
&lt;li&gt;额外的资源消耗：本地存储或⽹络流量 / 带宽开销，通常并不是⼀个问题。&lt;/li&gt;
&lt;li&gt;复杂度代价升⾼：⽤户需要付出备份管理成本。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="时间点恢复的局限性"&gt;时间点恢复的局限性&lt;/h3&gt;
&lt;p&gt;如果只有 PITR 用于故障恢复，则 RTO 与 RPO 指标相比 &lt;a href="https://pigsty.cc/docs/concept/ha/"&gt;&lt;strong&gt;高可用方案&lt;/strong&gt;&lt;/a&gt; 更为逊色，通常应两者组合使用。&lt;/p&gt;</description></item><item><title>时间点恢复的工作原理</title><link>https://pigsty.cc/docs/concept/pitr/mechanism/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/mechanism/</guid><description>&lt;p&gt;时间点恢复（PITR）的核心原理是：&lt;strong&gt;基础备份 + WAL 归档 = 任意时间点恢复能力&lt;/strong&gt;。
在 Pigsty 中，这一能力由 &lt;strong&gt;pgBackRest&lt;/strong&gt; 实现，并通过 &lt;strong&gt;定时备份 + WAL 归档&lt;/strong&gt; 自动运行。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="三要素"&gt;三要素&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;要素&lt;/th&gt;
 &lt;th style="text-align: left"&gt;作用&lt;/th&gt;
 &lt;th style="text-align: left"&gt;Pigsty 实现&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;基础备份&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;提供一致的物理快照，决定恢复起点&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg-backup&lt;/code&gt; + &lt;code&gt;pgbackrest&lt;/code&gt; + &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_crontab"&gt;&lt;code&gt;pg_crontab&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;WAL 归档&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;记录备份后的所有变更，决定恢复路径&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;archive_mode=on&lt;/code&gt; + &lt;code&gt;archive_command=pgbackrest ... archive-push&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;恢复目标&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;指定恢复停止位置&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_pitr&lt;/code&gt; 参数 / &lt;code&gt;pg-pitr&lt;/code&gt; 脚本 / &lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="基础备份"&gt;基础备份&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;基础备份&lt;/strong&gt;是数据库在某一时刻的物理快照，是 PITR 的恢复起点。Pigsty 通过 &lt;code&gt;pgBackRest&lt;/code&gt; 生成基础备份，并提供 &lt;code&gt;pg-backup&lt;/code&gt; 脚本封装常用操作。&lt;/p&gt;
&lt;h3 id="备份类型"&gt;备份类型&lt;/h3&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;类型&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;th style="text-align: left"&gt;恢复开销&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;全量备份&lt;/strong&gt;（Full）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;复制全部数据文件&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复最快，空间占用最大&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;差异备份&lt;/strong&gt;（Differential）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;相对最近一次全量备份的变化&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复需要全量 + 差异&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;增量备份&lt;/strong&gt;（Incremental）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;相对最近一次任意备份的变化&lt;/td&gt;
 &lt;td style="text-align: left"&gt;空间最省，恢复需要完整链路&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="pigsty-的默认行为"&gt;Pigsty 的默认行为&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pg-backup&lt;/code&gt; &lt;strong&gt;默认执行增量备份&lt;/strong&gt;，若不存在全量备份会自动补一次全量。&lt;/li&gt;
&lt;li&gt;备份任务通过 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_crontab"&gt;&lt;code&gt;pg_crontab&lt;/code&gt;&lt;/a&gt; 配置，写入 &lt;code&gt;postgres&lt;/code&gt; 用户的 crontab。&lt;/li&gt;
&lt;li&gt;脚本会自动识别节点角色，&lt;strong&gt;只有主库实际执行&lt;/strong&gt;，从库会直接退出。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;备份频率越高，需要重放的 WAL 越少，恢复速度越快。
更多细节请参阅 &lt;a href="https://pigsty.cc/docs/pgsql/backup/mechanism/"&gt;&lt;strong&gt;备份机制&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="https://pigsty.cc/docs/pgsql/backup/policy/"&gt;&lt;strong&gt;备份策略&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;</description></item><item><title>时间点恢复的实现架构</title><link>https://pigsty.cc/docs/concept/pitr/arch/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/arch/</guid><description>&lt;p&gt;Pigsty 使用 &lt;a href="https://pgbackrest.org/"&gt;&lt;strong&gt;pgBackRest&lt;/strong&gt;&lt;/a&gt; 作为 PostgreSQL 备份与恢复引擎，提供开箱即用的时间点恢复（PITR）能力。&lt;/p&gt;
&lt;p&gt;本文从架构层面说明：&lt;strong&gt;备份由谁执行、数据流向哪里、仓库如何组织、故障切换后如何保持连续性&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;PITR 架构由三条主线构成：&lt;strong&gt;备份执行链路&lt;/strong&gt;、&lt;strong&gt;WAL 归档链路&lt;/strong&gt;、&lt;strong&gt;恢复执行链路&lt;/strong&gt;。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;链路&lt;/th&gt;
 &lt;th style="text-align: left"&gt;入口&lt;/th&gt;
 &lt;th style="text-align: left"&gt;引擎&lt;/th&gt;
 &lt;th style="text-align: left"&gt;终点&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;备份&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg-backup&lt;/code&gt; + &lt;code&gt;pg_crontab&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest backup&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份仓库 &lt;code&gt;backup/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;WAL 归档&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL &lt;code&gt;archive_command&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest archive-push&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份仓库 &lt;code&gt;archive/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_pitr&lt;/code&gt; / &lt;code&gt;pg-pitr&lt;/code&gt; / &lt;code&gt;pgsql-pitr.yml&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;目标数据目录&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;更多执行细节见 &lt;a href="https://pigsty.cc/docs/pgsql/backup/mechanism/"&gt;&lt;strong&gt;备份机制&lt;/strong&gt;&lt;/a&gt; 与 &lt;a href="https://pigsty.cc/docs/pgsql/backup/restore/"&gt;&lt;strong&gt;恢复操作&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="组件与职责"&gt;组件与职责&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;角色&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据源&lt;/td&gt;
 &lt;td style="text-align: left"&gt;产生数据文件与 WAL 归档流&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pgBackRest&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份引擎&lt;/td&gt;
 &lt;td style="text-align: left"&gt;执行备份、接收/拉取 WAL、执行恢复&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pg-backup&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;备份入口&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pigsty 封装脚本，执行 &lt;code&gt;pgbackrest backup&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pg_pitr / pg-pitr&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;恢复入口&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Pigsty 封装参数/脚本，执行 &lt;code&gt;pgbackrest restore&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;备份仓库&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;存储后端&lt;/td&gt;
 &lt;td style="text-align: left"&gt;保存 &lt;code&gt;backup/&lt;/code&gt; 与 &lt;code&gt;archive/&lt;/code&gt;，支持 &lt;code&gt;local&lt;/code&gt; / &lt;code&gt;minio&lt;/code&gt; / &lt;code&gt;s3&lt;/code&gt; 等仓库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;pgbackrest_exporter&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;监控输出&lt;/td&gt;
 &lt;td style="text-align: left"&gt;导出备份状态指标，默认监听 &lt;code&gt;9854&lt;/code&gt; 端口&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="数据流"&gt;数据流&lt;/h2&gt;
&lt;pre class="mermaid"&gt;flowchart TB
 subgraph cluster[&amp;#34;PostgreSQL 集群&amp;#34;]
 direction TB
 primary[&amp;#34;Primary&amp;lt;br/&amp;gt;PostgreSQL&amp;#34;]
 pb[&amp;#34;pgBackRest&amp;#34;]
 cron[&amp;#34;pg-backup / pg_crontab&amp;#34;]
 end
 repo[&amp;#34;备份仓库&amp;lt;br/&amp;gt;local / minio / s3&amp;#34;]
 restore[&amp;#34;恢复目标数据目录&amp;#34;]

 cron --&amp;gt; pb
 primary --&amp;gt;|base backup| pb
 primary --&amp;gt;|WAL archive| pb
 pb --&amp;gt;|backup/archive| repo
 repo --&amp;gt;|restore/archive-get| pb
 pb --&amp;gt;|restore| restore&lt;/pre&gt;
&lt;p&gt;要点：&lt;/p&gt;</description></item><item><title>配置向导</title><link>https://pigsty.cc/docs/concept/iac/configure/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/configure/</guid><description>&lt;p&gt;Pigsty 提供了一个 &lt;strong&gt;&lt;code&gt;configure&lt;/code&gt;&lt;/strong&gt; 脚本作为 &lt;strong&gt;配置向导&lt;/strong&gt;，它能根据当前环境，自动生成合适的 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件。&lt;/p&gt;
&lt;p&gt;这是一个 &lt;strong&gt;可选&lt;/strong&gt; 的脚本：如果您已经了解了如何配置 Pigsty，大可以直接编辑 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件，跳过向导。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="快速开始"&gt;快速开始&lt;/h2&gt;
&lt;p&gt;进入 pigsty 源码家目录中，执行 &lt;code&gt;./configure&lt;/code&gt; 即可自动运行配置向导。不带任何参数时，默认使用 &lt;a href="https://pigsty.cc/docs/conf/meta"&gt;&lt;strong&gt;&lt;code&gt;meta&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 单节点配置模板：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87"&gt;cd&lt;/span&gt; ~/pigsty
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure &lt;span style="color:#8f5902;font-style:italic"&gt;# 交互式配置向导，自动检测环境并生成配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;该命令会以选定的模板为基础，检测当前节点的 IP 地址与区域，并生成适合当前环境的 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件。&lt;/p&gt;
&lt;div id="asciinema-faf4cf8e717f5b9f582b3cede024d31c" class="asciinema-container td-max-width-on-larger-screens" style="margin: 1em 0;"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var containerId = "asciinema-faf4cf8e717f5b9f582b3cede024d31c";
 var castURL = "\/demo\/configure.cast";
 var configuredTheme = "auto";
 var player = null;

 
 function detectTheme() {
 var htmlTheme = document.documentElement.getAttribute("data-bs-theme");
 if (htmlTheme === "dark") return "solarized-dark";
 if (htmlTheme === "light") return "solarized-light";
 
 if (window.matchMedia &amp;&amp; window.matchMedia("(prefers-color-scheme: dark)").matches) {
 return "solarized-dark";
 }
 return "solarized-light";
 }

 function getTheme() {
 if (configuredTheme === "auto") {
 return detectTheme();
 }
 return configuredTheme;
 }

 function createPlayer() {
 var container = document.getElementById(containerId);
 
 container.innerHTML = "";

 var opts = {
 theme: getTheme(),
 speed: "1.3",
 startAt: 0 ,
 fit: "width"
 };
 opts.autoPlay = true;
 opts.loop = true;
 opts.markers = [[ 3 , "默认配置"],[ 7 , "指定IP"],[ 14 , "随机密码"],[ 17 , "rich模板"],[ 20 , "app\/odoo模板"],[ 26 , "china区域"],[ 33 , "ha\/full模板"]];

 player = AsciinemaPlayer.create(castURL, container, opts);
 }

 
 createPlayer();

 
 if (configuredTheme === "auto") {
 
 var observer = new MutationObserver(function(mutations) {
 mutations.forEach(function(mutation) {
 if (mutation.attributeName === "data-bs-theme") {
 createPlayer();
 }
 });
 });
 observer.observe(document.documentElement, { attributes: true });

 
 if (window.matchMedia) {
 window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", function() {
 
 var htmlTheme = document.documentElement.getAttribute("data-bs-theme");
 if (!htmlTheme || htmlTheme === "auto") {
 createPlayer();
 }
 });
 }
 }
})();
&lt;/script&gt;

&lt;h2 id="功能说明"&gt;功能说明&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;configure&lt;/code&gt;&lt;/strong&gt; 脚本会根据环境与输入执行以下调整，并在当前目录下生成 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件。&lt;/p&gt;</description></item><item><title>配置参数</title><link>https://pigsty.cc/docs/concept/iac/parameter/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/parameter/</guid><description>&lt;p&gt;在 &lt;strong&gt;配置清单&lt;/strong&gt; 中，您可以使用各种参数对 Pigsty 进行精细化定制。这些参数涵盖了从基础设施设置到数据库配置的各个方面。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="参数列表"&gt;参数列表&lt;/h2&gt;
&lt;p&gt;Pigsty 提供了约 &lt;strong&gt;380+&lt;/strong&gt; 个配置参数，分布在 8 个默认模块中，用于精细控制系统的各个方面，完整列表见 &lt;a href="https://pigsty.cc/docs/ref/param"&gt;&lt;strong&gt;参考-参数列表&lt;/strong&gt;&lt;/a&gt; 。&lt;/p&gt;
&lt;table class="stretch-last"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;模块&lt;/th&gt;
 &lt;th style="text-align: center"&gt;参数组&lt;/th&gt;
 &lt;th style="text-align: center"&gt;参数数&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/param"&gt;&lt;strong&gt;PGSQL&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;9&lt;/td&gt;
 &lt;td style="text-align: center"&gt;123&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 数据库集群的核心配置&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/infra/param"&gt;&lt;strong&gt;INFRA&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;10&lt;/td&gt;
 &lt;td style="text-align: center"&gt;82&lt;/td&gt;
 &lt;td style="text-align: left"&gt;基础设施组件：软件源、Nginx、DNS、监控、Grafana 等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/node/param"&gt;&lt;strong&gt;NODE&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;11&lt;/td&gt;
 &lt;td style="text-align: center"&gt;83&lt;/td&gt;
 &lt;td style="text-align: left"&gt;主机节点调优：身份、DNS、包、调优、安全、管理员、时间、VIP等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/etcd/param"&gt;&lt;strong&gt;ETCD&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;2&lt;/td&gt;
 &lt;td style="text-align: center"&gt;13&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分布式配置存储与服务发现&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/redis/param"&gt;&lt;strong&gt;REDIS&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;1&lt;/td&gt;
 &lt;td style="text-align: center"&gt;21&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Redis 缓存与数据结构服务器&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/minio/param"&gt;&lt;strong&gt;MINIO&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;2&lt;/td&gt;
 &lt;td style="text-align: center"&gt;21&lt;/td&gt;
 &lt;td style="text-align: left"&gt;S3 兼容对象存储服务&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/ferret/param"&gt;&lt;strong&gt;FERRET&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;1&lt;/td&gt;
 &lt;td style="text-align: center"&gt;9&lt;/td&gt;
 &lt;td style="text-align: left"&gt;MongoDB 兼容数据库 FerretDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/docker/param"&gt;&lt;strong&gt;DOCKER&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;1&lt;/td&gt;
 &lt;td style="text-align: center"&gt;8&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Docker 容器引擎&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="参数形式"&gt;参数形式&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;参数&lt;/strong&gt; 是用于描述实体的 &lt;strong&gt;键值对&lt;/strong&gt;。&lt;strong&gt;键&lt;/strong&gt;（Key）是字符串，&lt;strong&gt;值&lt;/strong&gt;（Value）可以是五种类型之一：布尔值、字符串、数字、数组或对象。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;all&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- 顶级对象：all&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;admin_ip&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- 全局配置参数&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;children&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- pg-meta 分组&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- 集群级别参数&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- 主机节点 IP&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;------- 实例级别参数&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="参数优先级"&gt;参数优先级&lt;/h2&gt;
&lt;p&gt;参数可以在不同级别设置，具有以下优先级：&lt;/p&gt;</description></item><item><title>时间点恢复的策略权衡</title><link>https://pigsty.cc/docs/concept/pitr/tradeoff/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/tradeoff/</guid><description>&lt;p&gt;设计 PITR 策略时，最核心的权衡来自三个维度：
&lt;strong&gt;备份仓库位置&lt;/strong&gt;、&lt;strong&gt;恢复窗口长度&lt;/strong&gt;、&lt;strong&gt;恢复速度与空间成本&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;本文帮助您在这些维度之间做出可操作的选择。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="本地-vs-远程"&gt;本地 vs 远程&lt;/h2&gt;
&lt;p&gt;备份仓库的位置是 PITR 策略设计的第一步。&lt;/p&gt;
&lt;h3 id="本地仓库"&gt;本地仓库&lt;/h3&gt;
&lt;p&gt;将备份存储在主库本地磁盘（&lt;code&gt;pgbackrest_method = local&lt;/code&gt;）：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;配置简单，开箱即用&lt;/li&gt;
&lt;li&gt;恢复速度快（本地 I/O）&lt;/li&gt;
&lt;li&gt;无外部依赖&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;劣势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无异地容灾能力，主机故障时备份可能一同丢失&lt;/li&gt;
&lt;li&gt;受限于本地磁盘容量&lt;/li&gt;
&lt;li&gt;备份与生产数据位于同一故障域&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="远程仓库"&gt;远程仓库&lt;/h3&gt;
&lt;p&gt;将备份存储到 MinIO / S3 等对象存储（&lt;code&gt;pgbackrest_method = minio|s3&lt;/code&gt;）：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;异地容灾，备份独立于数据库主机&lt;/li&gt;
&lt;li&gt;容量几乎无限，多集群可共享&lt;/li&gt;
&lt;li&gt;可配合加密、版本控制等安全策略&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;劣势&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;恢复速度受网络带宽影响&lt;/li&gt;
&lt;li&gt;依赖对象存储的可用性&lt;/li&gt;
&lt;li&gt;部署与运维成本更高&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="如何选择"&gt;如何选择&lt;/h3&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;场景&lt;/th&gt;
 &lt;th style="text-align: left"&gt;推荐仓库&lt;/th&gt;
 &lt;th style="text-align: left"&gt;理由&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;开发测试&lt;/td&gt;
 &lt;td style="text-align: left"&gt;local&lt;/td&gt;
 &lt;td style="text-align: left"&gt;简单够用，容灾要求低&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;单机生产&lt;/td&gt;
 &lt;td style="text-align: left"&gt;minio / s3&lt;/td&gt;
 &lt;td style="text-align: left"&gt;主机故障仍可恢复&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;集群生产&lt;/td&gt;
 &lt;td style="text-align: left"&gt;local + minio&lt;/td&gt;
 &lt;td style="text-align: left"&gt;兼顾恢复速度与异地容灾&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;关键业务&lt;/td&gt;
 &lt;td style="text-align: left"&gt;多远程仓库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;多地容灾，最高保护&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;仓库配置细节请参阅 &lt;a href="https://pigsty.cc/docs/pgsql/backup/repository/"&gt;&lt;strong&gt;备份仓库&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="空间-vs-窗口"&gt;空间 vs 窗口&lt;/h2&gt;
&lt;p&gt;恢复窗口越长，所需存储空间越大。窗口长度由 &lt;strong&gt;备份保留策略 + WAL 归档保留&lt;/strong&gt; 决定。&lt;/p&gt;</description></item><item><title>时间点恢复的典型场景</title><link>https://pigsty.cc/docs/concept/pitr/scenarios/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/pitr/scenarios/</guid><description>&lt;p&gt;PITR 的价值不在于“回滚数据库”本身，而在于&lt;strong&gt;把不可逆的人为/软件错误变回可恢复的问题&lt;/strong&gt;。
它覆盖的场景从“误删一张表”到“整个机房不可用”，本质上解决的是&lt;strong&gt;逻辑错误与灾难恢复&lt;/strong&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="整体认知overview"&gt;整体认知（Overview）&lt;/h2&gt;
&lt;p&gt;PITR 解决以下问题：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;场景类型&lt;/th&gt;
 &lt;th style="text-align: left"&gt;典型问题&lt;/th&gt;
 &lt;th style="text-align: left"&gt;推荐策略&lt;/th&gt;
 &lt;th style="text-align: left"&gt;恢复目标&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;误删/误更新数据（DML）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;DELETE/UPDATE&lt;/code&gt; 无条件执行，脚本误操作&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复优先&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;xid&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;误删表/库/Schema（DDL）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;DROP TABLE/DATABASE&lt;/code&gt;、错误迁移&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;name&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;批量错误/发布事故&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Bug 批量污染数据，修复脚本失败&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复 + 验证&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;xid&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;数据审计/问题复盘&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要查看历史状态，核对差异&lt;/td&gt;
 &lt;td style="text-align: left"&gt;分支恢复（只读）&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;time&lt;/code&gt; / &lt;code&gt;lsn&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;机房级灾难/全量丢失&lt;/td&gt;
 &lt;td style="text-align: left"&gt;硬件故障、勒索、机房断电&lt;/td&gt;
 &lt;td style="text-align: left"&gt;原地恢复或重建集群&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;latest&lt;/code&gt; / &lt;code&gt;time&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="一个简单的判断原则"&gt;一个简单的判断原则&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;只要写入已经造成业务错误，就应该考虑 PITR&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;需要在线验证或只恢复部分数据 → 分支恢复&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;必须尽快恢复服务 → 原地恢复&lt;/strong&gt;（可接受停机）。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="mermaid"&gt;flowchart TD
 A[&amp;#34;发现问题&amp;#34;] --&amp;gt; B{&amp;#34;能否停机？&amp;#34;}
 B --&amp;gt;|能| C[&amp;#34;原地恢复&amp;lt;br/&amp;gt;最短恢复路径&amp;#34;]
 B --&amp;gt;|不能| D[&amp;#34;分支恢复&amp;lt;br/&amp;gt;先验证后切换&amp;#34;]
 C --&amp;gt; E[&amp;#34;恢复成功后重建备份&amp;#34;]
 D --&amp;gt; F[&amp;#34;验证/导出/切流量&amp;#34;]&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="场景详情"&gt;场景详情&lt;/h2&gt;
&lt;h3 id="误删误更新数据dml"&gt;误删/误更新数据（DML）&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;典型问题&lt;/strong&gt;：&lt;/p&gt;</description></item><item><title>配置模板</title><link>https://pigsty.cc/docs/concept/iac/template/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/template/</guid><description>&lt;p&gt;在 Pigsty 中，部署的蓝图细节由 &lt;a href="https://pigsty.cc/docs/setup/config/"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; 所定义，也就是 &lt;a href="https://github.com/pgsty/pigsty/blob/main/pigsty.yml"&gt;&lt;strong&gt;&lt;code&gt;pigsty.yml&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 配置文件，您可以通过声明式配置进行定制。&lt;/p&gt;
&lt;p&gt;然而，直接编写配置文件可能会让新用户望而生畏。为此，我们提供了一些开箱即用的配置模板，涵盖了常见的使用场景。&lt;/p&gt;
&lt;p&gt;每一个模板都是一个预定义的 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件，包含了适用于特定场景的合理默认值。&lt;/p&gt;
&lt;p&gt;您可以根据自己的需要，选择一个模板作为定制起点，然后根据需要进行修改，以满足您的具体需求。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="使用模板"&gt;使用模板&lt;/h2&gt;
&lt;p&gt;Pigsty 提供了 &lt;a href="https://github.com/pgsty/pigsty/blob/main/configure"&gt;&lt;strong&gt;&lt;code&gt;configure&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 脚本作为可选的配置向导，它将根据您的环境和输入，生成具有良好默认值的 &lt;a href="https://pigsty.cc/docs/setup/config/"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;使用 &lt;code&gt;./configure -c &amp;lt;conf&amp;gt;&lt;/code&gt; 指定配置模板，其中 &lt;code&gt;&amp;lt;conf&amp;gt;&lt;/code&gt; 是相对于 &lt;code&gt;conf&lt;/code&gt; 目录的路径（可省略 &lt;code&gt;.yml&lt;/code&gt; 后缀）。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure &lt;span style="color:#8f5902;font-style:italic"&gt;# 默认使用 meta.yml 配置模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c meta &lt;span style="color:#8f5902;font-style:italic"&gt;# 显式指定使用 meta.yml 单节点模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c rich &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用包含全部扩展与 MinIO 的富功能模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c slim &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用最小化的单节点模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 使用不同的数据库内核&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c pgsql &lt;span style="color:#8f5902;font-style:italic"&gt;# 原生 PostgreSQL 内核，基础功能 (13~18)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c citus &lt;span style="color:#8f5902;font-style:italic"&gt;# Citus 分布式高可用 PostgreSQL (14~17)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c mssql &lt;span style="color:#8f5902;font-style:italic"&gt;# Babelfish 内核，兼容 SQL Server 协议 (15)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c polar &lt;span style="color:#8f5902;font-style:italic"&gt;# PolarDB PG 内核，Aurora/RAC 风格 (15)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c ivory &lt;span style="color:#8f5902;font-style:italic"&gt;# IvorySQL 内核，兼容 Oracle 语法 (18)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c mysql &lt;span style="color:#8f5902;font-style:italic"&gt;# OpenHalo 内核，兼容 MySQL (14)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c pgtde &lt;span style="color:#8f5902;font-style:italic"&gt;# Percona PostgreSQL Server 透明加密 (18)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c oriole &lt;span style="color:#8f5902;font-style:italic"&gt;# OrioleDB 内核，OLTP 增强 (17)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c supabase &lt;span style="color:#8f5902;font-style:italic"&gt;# Supabase 自托管配置 (15~18)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 使用多节点高可用模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c ha/dual &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 2 节点高可用模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c ha/trio &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 3 节点高可用模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c ha/full &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 4 节点高可用模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果不指定模板，Pigsty 默认使用 &lt;code&gt;meta.yml&lt;/code&gt; 单节点配置模板。&lt;/p&gt;</description></item><item><title>元数据库</title><link>https://pigsty.cc/docs/concept/iac/cmdb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/iac/cmdb/</guid><description>&lt;p&gt;Pigsty 允许您使用 PostgreSQL &lt;strong&gt;元数据库&lt;/strong&gt; 作为动态配置源，取代静态的 YAML 配置文件，实现更强大的配置管理能力。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;CMDB&lt;/strong&gt;（Configuration Management Database，配置管理数据库）是一种将配置信息存储在数据库中进行管理的方式。&lt;/p&gt;
&lt;p&gt;在 Pigsty 中，默认的配置源是一个静态 YAML 文件 &lt;code&gt;pigsty.yml&lt;/code&gt;，
它作为 Ansible 的 &lt;a href="https://pigsty.cc/docs/concept/iac/inventory/"&gt;&lt;strong&gt;配置清单&lt;/strong&gt;&lt;/a&gt; 使用。&lt;/p&gt;
&lt;p&gt;这种方式简单直接，但当基础设施规模扩大、需要复杂精细的管理与外部集成时，单一的静态文件难以满足需求。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;特性&lt;/th&gt;
 &lt;th style="text-align: left"&gt;静态 YAML 文件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;CMDB 元数据库&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;查询能力&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;手工搜索/grep&lt;/td&gt;
 &lt;td style="text-align: left"&gt;SQL 任意条件查询，聚合分析&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;版本控制&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;依赖 Git 或手工备份&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据库事务，审计日志，时间旅行快照&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;权限控制&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;文件系统权限，粗粒度&lt;/td&gt;
 &lt;td style="text-align: left"&gt;PostgreSQL 数据库精细访问控制&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;并发编辑&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要锁文件或合并冲突&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据库事务天然支持并发&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;外部集成&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需要解析 YAML&lt;/td&gt;
 &lt;td style="text-align: left"&gt;标准 SQL 接口，任意语言轻松对接&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;规模扩展&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;文件过大时难以维护&lt;/td&gt;
 &lt;td style="text-align: left"&gt;管理规模伸缩至物理极限&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;动态生成&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;静态文件，修改后需手动应用&lt;/td&gt;
 &lt;td style="text-align: left"&gt;即时生效，实时反映配置变更&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Pigsty 在样板数据库 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/meta.yml#L52"&gt;&lt;strong&gt;&lt;code&gt;pg-meta.meta&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 的模式基线定义中，提供了 Pigsty CMDB 的数据库模式。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="工作原理"&gt;工作原理&lt;/h2&gt;
&lt;p&gt;CMDB 的核心思想是用一个 &lt;strong&gt;动态脚本&lt;/strong&gt; 替换静态配置文件。
Ansible 支持使用可执行脚本作为配置清单，只要脚本输出符合 JSON 格式的清单数据即可。
当您启用 CMDB 后，Pigsty 会创建一个名为 &lt;code&gt;inventory.sh&lt;/code&gt; 的动态清单脚本：&lt;/p&gt;</description></item><item><title>监控系统</title><link>https://pigsty.cc/docs/concept/monitor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/monitor/</guid><description>&lt;p&gt;Pigsty 监控系统由指标、日志与告警三部分组成，默认随部署开箱可用。
它既可以监控由 Pigsty 托管的数据库集群，也可以监控已有 PostgreSQL 集群与外部 RDS 服务。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="监控目标"&gt;监控目标&lt;/h2&gt;
&lt;p&gt;Pigsty 监控覆盖的核心对象包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PostgreSQL 集群与实例（SQL 性能、连接、复制、事务、检查点、WAL）&lt;/li&gt;
&lt;li&gt;基础设施组件（Grafana、VictoriaMetrics、Alertmanager、Nginx 等）&lt;/li&gt;
&lt;li&gt;宿主机节点（CPU、内存、磁盘、网络、内核）&lt;/li&gt;
&lt;li&gt;关键中间件（ETCD、MINIO、REDIS、FERRET、JUICE、VIBE 等）&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="技术栈"&gt;技术栈&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;作用&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/infra/admin/grafana/"&gt;&lt;strong&gt;Grafana&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;可视化监控面板、统一入口、告警视图&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/infra/"&gt;&lt;strong&gt;VictoriaMetrics&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;时序指标采集、存储与查询&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/infra/"&gt;&lt;strong&gt;VictoriaLogs&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;结构化日志采集、索引与检索&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/infra/monitor/"&gt;&lt;strong&gt;VMAlert + Alertmanager&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;告警规则执行与消息通知&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/monitor/"&gt;&lt;strong&gt;Exporter / Agent&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;业务与系统指标暴露、日志转发&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="纳管方式"&gt;纳管方式&lt;/h2&gt;
&lt;p&gt;Pigsty 支持三种监控纳管方式：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;模式&lt;/th&gt;
 &lt;th style="text-align: left"&gt;适用场景&lt;/th&gt;
 &lt;th style="text-align: left"&gt;入口&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;FULL&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据库由 Pigsty 直接部署与托管&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/monitor/"&gt;PGSQL 监控系统&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;MANAGED&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;现有 PostgreSQL 集群，节点可 SSH 管理&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/monitor/#%E7%9B%91%E6%8E%A7%E7%8E%B0%E6%9C%89%E9%9B%86%E7%BE%A4"&gt;监控现有集群&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;RDS&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;仅能通过连接串访问的云数据库&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/monitor/#%E7%9B%91%E6%8E%A7rds"&gt;监控 RDS&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="继续阅读"&gt;继续阅读&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/pgsql/monitor/"&gt;&lt;strong&gt;PGSQL 监控系统&lt;/strong&gt;&lt;/a&gt;：数据库指标、日志、告警与面板&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/infra/monitor/"&gt;&lt;strong&gt;INFRA 监控告警&lt;/strong&gt;&lt;/a&gt;：监控系统自身可用性&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/node/monitor/"&gt;&lt;strong&gt;NODE 监控告警&lt;/strong&gt;&lt;/a&gt;：主机资源与系统健康状态&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/etcd/monitor/"&gt;&lt;strong&gt;ETCD 监控告警&lt;/strong&gt;&lt;/a&gt;：一致性与可用性监控&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/minio/monitor/"&gt;&lt;strong&gt;MINIO 监控告警&lt;/strong&gt;&lt;/a&gt;：对象存储集群监控&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/redis/monitor/"&gt;&lt;strong&gt;REDIS 监控告警&lt;/strong&gt;&lt;/a&gt;：缓存集群运行状态监控&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>安全合规</title><link>https://pigsty.cc/docs/concept/sec/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/</guid><description>&lt;p&gt;Pigsty 的安全目标是 &lt;strong&gt;CIA 三元组&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;机密性&lt;/strong&gt;：防止未授权访问与泄露&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;完整性&lt;/strong&gt;：防止数据被篡改或静默损坏&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可用性&lt;/strong&gt;：防止故障导致业务中断&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pigsty 的安全理念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;默认安全&lt;/strong&gt;：开箱即用的安全基线，配置少、覆盖广。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;纵深防御&lt;/strong&gt;：多层保护叠加，单点失守不致系统失守。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;最小权限&lt;/strong&gt;：角色与权限模型贯彻最小授权原则。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可合规&lt;/strong&gt;：安全能力与流程结合即可通过合规检查。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="默认安全基线解决什么问题"&gt;默认安全基线（解决什么问题）&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;安全选项&lt;/th&gt;
 &lt;th style="text-align: left"&gt;默认值&lt;/th&gt;
 &lt;th style="text-align: left"&gt;解决的问题&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;密码加密&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_pwd_enc: scram-sha-256&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;防止弱哈希与明文泄露&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;数据校验&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pg_checksum: true&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;检测静默数据损坏&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;HBA 分层&lt;/td&gt;
 &lt;td style="text-align: left"&gt;管理员外网必须 &lt;code&gt;ssl&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;防止外网明文访问&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;本地 CA&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;ca_create: true&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;统一证书信任链&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;备份恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;pgbackrest_enabled: true&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;防止误删误改不可恢复&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;Nginx HTTPS&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;nginx_sslmode: enable&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;防止 Web 入口明文泄露&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;MinIO HTTPS&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;minio_https: true&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;防止备份链路窃听&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;OS 基线&lt;/td&gt;
 &lt;td style="text-align: left"&gt;SELinux &lt;code&gt;permissive&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;为强制模式预留基础&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;默认配置以“可用、可扩展”为先，生产环境应根据合规要求加固。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="加固路线图"&gt;加固路线图&lt;/h2&gt;
&lt;p&gt;Pigsty 提供安全增强模板 &lt;code&gt;conf/ha/safe.yml&lt;/code&gt;，可快速将默认基线升级到更高安全级别：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;强制 SSL 与证书认证&lt;/li&gt;
&lt;li&gt;密码强度与过期策略&lt;/li&gt;
&lt;li&gt;连接与断开日志&lt;/li&gt;
&lt;li&gt;防火墙与 SELinux 加固&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="本章内容"&gt;本章内容&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;章节&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;th style="text-align: left"&gt;核心问题&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/level"&gt;&lt;strong&gt;纵深防御&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;七层安全模型与基线&lt;/td&gt;
 &lt;td style="text-align: left"&gt;安全体系整体如何落地？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/auth"&gt;&lt;strong&gt;身份认证&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;HBA 规则、密码策略、证书认证&lt;/td&gt;
 &lt;td style="text-align: left"&gt;如何验证用户身份？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/ac"&gt;&lt;strong&gt;访问控制&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;角色系统、权限模型、数据库隔离&lt;/td&gt;
 &lt;td style="text-align: left"&gt;如何控制用户权限？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/ca"&gt;&lt;strong&gt;加密通信&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;TLS、本地 CA、证书管理&lt;/td&gt;
 &lt;td style="text-align: left"&gt;如何保护传输与证书？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/data"&gt;&lt;strong&gt;数据安全&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;校验和、备份、加密与恢复&lt;/td&gt;
 &lt;td style="text-align: left"&gt;数据如何完整可恢复？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/sec/compliance"&gt;&lt;strong&gt;合规清单&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;等保三级与 SOC2 对照&lt;/td&gt;
 &lt;td style="text-align: left"&gt;如何满足合规要求？&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="相关话题"&gt;相关话题&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;♾️ &lt;a href="https://pigsty.cc/docs/concept/ha/"&gt;&lt;strong&gt;高可用&lt;/strong&gt;&lt;/a&gt;：业务连续性保障&lt;/li&gt;
&lt;li&gt;⏰ &lt;a href="https://pigsty.cc/docs/concept/pitr/"&gt;&lt;strong&gt;备份恢复&lt;/strong&gt;&lt;/a&gt;：PITR 与灾难恢复&lt;/li&gt;
&lt;li&gt;📊 &lt;a href="https://pigsty.cc/docs/concept/monitor/"&gt;&lt;strong&gt;可观测性&lt;/strong&gt;&lt;/a&gt;：安全事件监控&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>七层安全模型</title><link>https://pigsty.cc/docs/concept/sec/level/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/level/</guid><description>&lt;p&gt;安全不是一道墙，而是一座城。Pigsty 采用&lt;strong&gt;纵深防御&lt;/strong&gt;策略，在七个层次上构建多重保护，即使某一层被突破，仍有其他层提供保护。&lt;/p&gt;
&lt;p&gt;这种分层思路解决三类核心风险：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;边界被突破&lt;/strong&gt;：降低“单点失守导致全盘失守”的概率。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;内部滥用&lt;/strong&gt;：即使内部账号被盗，也能通过最小权限限制破坏范围。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;不可预期故障&lt;/strong&gt;：硬件、软件、人为错误都能被“多层兜底”。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;div id="infographic-296a28376e55bf0bd7d2bce937b065d7" class="infographic-container td-max-width-on-larger-screens"&gt;&lt;/div&gt;

&lt;script&gt;
(function() {
 var containerId = 'infographic-296a28376e55bf0bd7d2bce937b065d7';
 var syntax = "````\ninfographic sequence-pyramid-simple\ndata\n title 七层安全模型\n desc Pigsty 纵深防御体系：从物理到用户的多层保护\n items\n - label 物理与介质\n value 100\n desc 数据校验和 · 介质盗取防护\n time L1\n icon mingcute/building-4-fill\n illus server-cluster\n - label 网络安全\n value 95\n desc 防火墙 · 监听收敛 · TLS\n time L2\n icon mingcute/earth-2-fill\n illus secure-server\n - label 边界安全\n value 90\n desc HAProxy · Nginx · 统一入口\n time L3\n icon mingcute/shield-fill\n illus firewall-protection\n - label 主机安全\n value 85\n desc SELinux · 最小权限 · 系统加固\n time L4\n icon mingcute/computer-fill\n illus server-status\n - label 应用安全\n value 80\n desc HBA · SCRAM · 密码策略\n time L5\n icon mingcute/safe-box-fill\n illus database-security\n - label 数据安全\n value 75\n desc 备份加密 · PITR · 审计\n time L6\n icon mingcute/lock-fill\n illus data-encryption\n - label 用户安全\n value 70\n desc RBAC · 默认权限 · 隔离\n time L7\n icon mingcute/user-security-fill\n illus user-flow\ntheme light\n palette pigsty\n````";

 function renderInfographic() {
 var dom = document.getElementById(containerId);
 if (!dom) { console.error('Infographic: container not found:', containerId); return; }
 try {
 var ig = new AntVInfographic.Infographic({
 container: '#' + containerId,
 width: dom.offsetWidth || '100%',
 height: 'auto',
 });
 ig.render(syntax);
 } catch (e) {
 console.error('Infographic render error:', e);
 dom.innerHTML = '&lt;pre style="color: red;"&gt;Infographic Error: ' + e.message + '&lt;/pre&gt;';
 }
 }

 
 if (typeof AntVInfographic !== 'undefined') {
 renderInfographic();
 } else if (!window._infographicLoading) {
 window._infographicLoading = true;
 window._infographicCallbacks = [renderInfographic];
 var script = document.createElement('script');
 script.src = '/js/infographic.min.js';
 script.onload = function() {
 window._infographicCallbacks.forEach(function(cb) { cb(); });
 };
 document.head.appendChild(script);
 } else {
 window._infographicCallbacks.push(renderInfographic);
 }
})();
&lt;/script&gt;

&lt;hr&gt;
&lt;h2 id="l1-物理与介质安全"&gt;L1 物理与介质安全&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;物理层失守时，唯一的对抗手段是数据本身的自我保护。&lt;/p&gt;</description></item><item><title>身份认证</title><link>https://pigsty.cc/docs/concept/sec/auth/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/auth/</guid><description>&lt;p&gt;身份认证解决三个核心问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;你是谁&lt;/strong&gt;：身份是否唯一可识别？&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;你怎么证明&lt;/strong&gt;：密码/证书是否足够安全？&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;你从哪里来&lt;/strong&gt;：来源是否受控？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pigsty 使用 &lt;strong&gt;HBA 规则 + 密码/证书&lt;/strong&gt; 完成身份认证，并以 SCRAM 为默认密码哈希方案。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="认证链路"&gt;认证链路&lt;/h2&gt;
&lt;pre class="mermaid"&gt;flowchart LR
 C[客户端] --&amp;gt; HBA[HBA 规则]
 HBA --&amp;gt; A1[密码 SCRAM]
 HBA --&amp;gt; A2[证书认证]
 HBA --&amp;gt; A3[本地 ident/peer]
 A1 --&amp;gt; RBAC[角色与权限]
 A2 --&amp;gt; RBAC
 A3 --&amp;gt; RBAC&lt;/pre&gt;
&lt;p&gt;HBA 决定“&lt;strong&gt;谁能从哪里来&lt;/strong&gt;”，认证方式决定“&lt;strong&gt;如何证明身份&lt;/strong&gt;”。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="hba-分层模型"&gt;HBA 分层模型&lt;/h2&gt;
&lt;p&gt;Pigsty 默认 HBA 规则已经分层：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;本地&lt;/strong&gt;使用 &lt;code&gt;ident/peer&lt;/code&gt;，最安全。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;内网&lt;/strong&gt;使用 &lt;code&gt;scram&lt;/code&gt; 密码认证。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;外网管理员&lt;/strong&gt;必须走 &lt;code&gt;ssl&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这解决了“&lt;strong&gt;同一个用户在不同来源使用不同认证强度&lt;/strong&gt;”的问题。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HBA 规则的关键能力&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;顺序优先&lt;/strong&gt;：支持 &lt;code&gt;order&lt;/code&gt; 排序，数值越小优先级越高。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;地址别名&lt;/strong&gt;：&lt;code&gt;local&lt;/code&gt; / &lt;code&gt;localhost&lt;/code&gt; / &lt;code&gt;intra&lt;/code&gt; / &lt;code&gt;world&lt;/code&gt; 等。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;角色条件&lt;/strong&gt;：&lt;code&gt;primary/replica/offline&lt;/code&gt; 可精细化控制。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="密码认证"&gt;密码认证&lt;/h2&gt;
&lt;p&gt;默认密码哈希算法：&lt;/p&gt;</description></item><item><title>访问控制</title><link>https://pigsty.cc/docs/concept/sec/ac/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/ac/</guid><description>&lt;p&gt;访问控制解决两个核心问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;你能做什么&lt;/strong&gt;：读/写/DDL 的权限边界&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;你能访问哪些数据&lt;/strong&gt;：跨库、跨模式的隔离边界&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pigsty 通过 &lt;strong&gt;RBAC 角色体系 + 默认权限策略&lt;/strong&gt; 将“最小权限”落实为默认行为。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="四层角色模型"&gt;四层角色模型&lt;/h2&gt;
&lt;pre class="mermaid"&gt;flowchart TB
 subgraph Admin[&amp;#34;dbrole_admin（管理员）&amp;#34;]
 A1[&amp;#34;可执行 DDL / CREATE / ALTER&amp;#34;]
 A2[&amp;#34;继承 dbrole_readwrite&amp;#34;]
 end
 subgraph RW[&amp;#34;dbrole_readwrite（读写）&amp;#34;]
 RW1[&amp;#34;可 INSERT/UPDATE/DELETE&amp;#34;]
 RW2[&amp;#34;继承 dbrole_readonly&amp;#34;]
 end
 subgraph RO[&amp;#34;dbrole_readonly（只读）&amp;#34;]
 RO1[&amp;#34;可 SELECT 所有表&amp;#34;]
 end
 subgraph Offline[&amp;#34;dbrole_offline（离线）&amp;#34;]
 OFF1[&amp;#34;仅离线实例可用&amp;#34;]
 end

 Admin --&amp;gt; RW --&amp;gt; RO&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;生产账号天然拥有过高权限&lt;/li&gt;
&lt;li&gt;DDL 与 DML 不分离导致误操作风险&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="默认角色与系统用户"&gt;默认角色与系统用户&lt;/h2&gt;
&lt;p&gt;Pigsty 默认提供四个角色与四个系统用户（来自源码默认值）：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;角色/用户&lt;/th&gt;
 &lt;th&gt;属性&lt;/th&gt;
 &lt;th&gt;继承/角色&lt;/th&gt;
 &lt;th&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_readonly&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td&gt;全局只读访问&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_offline&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td&gt;受限只读（离线实例）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_readwrite&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dbrole_readonly&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;全局读写访问&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbrole_admin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;NOLOGIN&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_monitor, dbrole_readwrite&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;管理员 / 对象创建&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;postgres&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;SUPERUSER&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td&gt;系统超级用户&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;replicator&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;REPLICATION&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_monitor, dbrole_readonly&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;复制用户&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbuser_dba&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;SUPERUSER&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dbrole_admin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;管理员用户&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dbuser_monitor&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_monitor, dbrole_readonly&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;监控用户&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这套默认角色可以覆盖绝大多数业务场景。&lt;/p&gt;</description></item><item><title>加密通信与本地 CA</title><link>https://pigsty.cc/docs/concept/sec/ca/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/ca/</guid><description>&lt;p&gt;加密通信解决三个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;窃听&lt;/strong&gt;：防止明文流量被监听&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;篡改&lt;/strong&gt;：防止中间人修改数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;冒充&lt;/strong&gt;：防止服务端/客户端被伪造&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pigsty 通过 &lt;strong&gt;本地 CA + TLS&lt;/strong&gt; 为数据库与基础设施组件提供统一的信任根。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="本地-ca-的作用"&gt;本地 CA 的作用&lt;/h2&gt;
&lt;p&gt;Pigsty 默认会在管理节点生成自签 CA：&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;files/pki/ca/ca.key # CA 私钥（必须严格保护）
files/pki/ca/ca.crt # CA 根证书（可分发）
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;源码默认值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ca_create: true&lt;/code&gt;：找不到 CA 时自动生成。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ca_cn: pigsty-ca&lt;/code&gt;：CA 证书 CN 固定为 &lt;code&gt;pigsty-ca&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;根证书有效期约 100 年（自签）。&lt;/li&gt;
&lt;li&gt;由 CA 签发的服务器/客户端证书有效期 &lt;code&gt;cert_validity: 7300d&lt;/code&gt;（20 年）。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="证书覆盖范围"&gt;证书覆盖范围&lt;/h2&gt;
&lt;p&gt;本地 CA 会签发多种组件证书，统一信任链：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;组件&lt;/th&gt;
 &lt;th&gt;目的&lt;/th&gt;
 &lt;th&gt;典型路径&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;PostgreSQL / PgBouncer&lt;/td&gt;
 &lt;td&gt;连接加密&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;/pg/cert/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;Patroni&lt;/td&gt;
 &lt;td&gt;API 通信&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;/pg/cert/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;etcd&lt;/td&gt;
 &lt;td&gt;DCS 加密&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;/etc/etcd/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;MinIO&lt;/td&gt;
 &lt;td&gt;对象存储 HTTPS&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;~minio/.minio/certs/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;Nginx&lt;/td&gt;
 &lt;td&gt;Web 入口 HTTPS&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;/etc/nginx/conf.d/cert/&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;：不同组件自建证书会产生信任碎片，统一 CA 可以一次分发，多处复用。&lt;/p&gt;</description></item><item><title>数据安全</title><link>https://pigsty.cc/docs/concept/sec/data/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/data/</guid><description>&lt;p&gt;数据安全关注三件事：&lt;strong&gt;完整性、可恢复性、保密性&lt;/strong&gt;。Pigsty 在默认配置中已启用关键能力，并支持按需加固。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="数据完整性"&gt;数据完整性&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;磁盘坏块、内存错误导致的静默损坏&lt;/li&gt;
&lt;li&gt;意外写入导致的数据污染&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Pigsty 支持&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;数据校验和&lt;/strong&gt;：默认 &lt;code&gt;pg_checksum: true&lt;/code&gt;，初始化时启用 &lt;code&gt;data-checksums&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;副本兜底&lt;/strong&gt;：主库坏块可从从库恢复（与 HA 配合使用）。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="可恢复性备份与-pitr"&gt;可恢复性（备份与 PITR）&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;误删误改&lt;/li&gt;
&lt;li&gt;灾难性故障导致数据丢失&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Pigsty 支持&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pgBackRest 默认启用&lt;/strong&gt;：&lt;code&gt;pgbackrest_enabled: true&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;本地仓库&lt;/strong&gt;：默认保留 2 份完整备份。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;远程仓库&lt;/strong&gt;：可接入 MinIO，支持对象存储与多副本。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PITR&lt;/strong&gt;：结合 WAL 归档进行任意时间点恢复。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="数据保密性"&gt;数据保密性&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;备份被窃导致数据外泄&lt;/li&gt;
&lt;li&gt;介质被盗导致明文数据泄露&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Pigsty 支持&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;备份加密&lt;/strong&gt;：MinIO 仓库支持 AES-256-CBC（&lt;code&gt;cipher_type&lt;/code&gt;）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;透明加密（可选）&lt;/strong&gt;：通过 &lt;code&gt;pg_tde&lt;/code&gt; 等扩展实现数据静态加密。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;密钥隔离&lt;/strong&gt;：建议将 &lt;code&gt;cipher_pass&lt;/code&gt; 与 CA 私钥分离管理。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="审计与可追溯"&gt;审计与可追溯&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;解决的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无法追责与还原操作&lt;/li&gt;
&lt;li&gt;合规审计缺少证据&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Pigsty 支持&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;日志收集&lt;/strong&gt;：模板默认启用 &lt;code&gt;logging_collector&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DDL 审计&lt;/strong&gt;：&lt;code&gt;log_statement: ddl&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;慢查询&lt;/strong&gt;：&lt;code&gt;log_min_duration_statement&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;连接日志&lt;/strong&gt;：&lt;code&gt;log_connections&lt;/code&gt;（PG18+）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;审计扩展&lt;/strong&gt;：&lt;code&gt;pgaudit&lt;/code&gt;、&lt;code&gt;pgauditlogtofile&lt;/code&gt; 可选。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="加固建议"&gt;加固建议&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;对远程备份强制加密与专用密钥。&lt;/li&gt;
&lt;li&gt;定期演练 PITR，验证恢复链路。&lt;/li&gt;
&lt;li&gt;对关键业务启用 &lt;code&gt;pgaudit&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;结合 &lt;a href="https://pigsty.cc/docs/concept/ha/"&gt;高可用&lt;/a&gt; 形成“备份 + 副本”双层兜底。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="接下来"&gt;接下来&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;🔐 &lt;a href="https://pigsty.cc/docs/concept/sec/ca"&gt;&lt;strong&gt;加密通信&lt;/strong&gt;&lt;/a&gt;：证书管理与 TLS&lt;/li&gt;
&lt;li&gt;✅ &lt;a href="https://pigsty.cc/docs/concept/sec/compliance"&gt;&lt;strong&gt;合规清单&lt;/strong&gt;&lt;/a&gt;：审计与合规要求&lt;/li&gt;
&lt;li&gt;⏰ &lt;a href="https://pigsty.cc/docs/concept/pitr/"&gt;&lt;strong&gt;备份恢复&lt;/strong&gt;&lt;/a&gt;：PITR 机制与实践&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>合规清单</title><link>https://pigsty.cc/docs/concept/sec/compliance/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/sec/compliance/</guid><description>&lt;p&gt;合规不是“开关”，而是 &lt;strong&gt;配置 + 流程 + 证据&lt;/strong&gt; 的组合：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;配置&lt;/strong&gt;：安全能力是否启用（HBA/TLS/审计/备份）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;流程&lt;/strong&gt;：是否有权限管理、变更、备份演练等制度&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;证据&lt;/strong&gt;：日志、配置快照、备份报告、监控告警&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本页以 SOC2 与等保三级为切入点，说明 Pigsty 的安全能力与合规映射。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="默认凭证清单必须修改"&gt;默认凭证清单（必须修改）&lt;/h2&gt;
&lt;p&gt;来自源码默认值：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;组件&lt;/th&gt;
 &lt;th&gt;默认用户名&lt;/th&gt;
 &lt;th&gt;默认密码&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;PostgreSQL 管理员&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dbuser_dba&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;DBUser.DBA&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PostgreSQL 监控&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dbuser_monitor&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;DBUser.Monitor&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;PostgreSQL 复制&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;replicator&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;DBUser.Replicator&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;Patroni API&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;postgres&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;Patroni.API&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;HAProxy 管理&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;admin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pigsty&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;Grafana 管理&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;admin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pigsty&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;MinIO Root&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;minioadmin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;S3User.MinIO&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;etcd Root&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;root&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;Etcd.Root&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;生产环境必须修改。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="证据准备建议"&gt;证据准备（建议）&lt;/h2&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;证据类型&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;th&gt;Pigsty 支持&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;配置快照&lt;/td&gt;
 &lt;td&gt;HBA、角色、TLS、备份策略&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pigsty.yml&lt;/code&gt; / inventory 配置&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;访问控制&lt;/td&gt;
 &lt;td&gt;角色与权限&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pg_default_roles&lt;/code&gt; / &lt;code&gt;pg_default_privileges&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;连接审计&lt;/td&gt;
 &lt;td&gt;连接、断开、DDL&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;log_connections&lt;/code&gt; / &lt;code&gt;log_statement&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;备份报告&lt;/td&gt;
 &lt;td&gt;完整备份与恢复记录&lt;/td&gt;
 &lt;td&gt;pgBackRest 日志与任务&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;监控告警&lt;/td&gt;
 &lt;td&gt;异常事件记录&lt;/td&gt;
 &lt;td&gt;Prometheus + Grafana&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;证书管理&lt;/td&gt;
 &lt;td&gt;CA/证书分发记录&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;files/pki/&lt;/code&gt; / &lt;code&gt;/etc/pki/ca.crt&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="soc2-视角示例映射"&gt;SOC2 视角（示例映射）&lt;/h2&gt;
&lt;p&gt;SOC2 的核心是 &lt;strong&gt;安全、可用性、机密性&lt;/strong&gt;。以下为常见控制点的概念映射：&lt;/p&gt;</description></item><item><title>PGSQL 集群模型</title><link>https://pigsty.cc/docs/concept/model/pgsql/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/pgsql/</guid><description>&lt;p&gt;PGSQL模块在生产环境中以&lt;strong&gt;集群&lt;/strong&gt;的形式组织，这些&lt;strong&gt;集群&lt;/strong&gt;是由一组由&lt;strong&gt;主-备&lt;/strong&gt;关联的数据库&lt;strong&gt;实例&lt;/strong&gt;组成的&lt;strong&gt;逻辑实体&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;每个集群都是一个&lt;strong&gt;自治&lt;/strong&gt;的业务单元，由至少一个 &lt;strong&gt;主库实例&lt;/strong&gt; 组成，并通过服务向外暴露能力。&lt;/p&gt;
&lt;p&gt;在 Pigsty 的PGSQL模块中有四种核心实体：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;集群&lt;/strong&gt;（Cluster）：自治的 PostgreSQL 业务单元，用作其他实体的顶级命名空间。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;服务&lt;/strong&gt;（Service）：对外暴露能力的命名抽象，路由流量，并使用节点端口暴露服务。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实例&lt;/strong&gt;（Instance）：由在单个节点上的运行进程和数据库文件组成的单一 PostgreSQL 服务器。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;节点&lt;/strong&gt;（Node）：运行 Linux + Systemd 环境的硬件资源抽象，可以是裸机、VM、容器或 Pod。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;辅以“数据库”“角色”两个业务实体，共同组成完整的逻辑视图。如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/er-pgsql.svg" alt="er-pgsql"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="具体样例"&gt;具体样例&lt;/h2&gt;
&lt;p&gt;让我们来看两个具体的例子，以四节点的 Pigsty &lt;a href="https://pigsty.cc/docs/deploy/sandbox"&gt;&lt;strong&gt;沙箱环境&lt;/strong&gt;&lt;/a&gt; 为例，在这个环境中，有一套三节点的 &lt;code&gt;pg-test&lt;/code&gt; 集群。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-test&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 2, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;replica }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.13&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 3, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;replica }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-test }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的配置片段定义了一个如下所示的 &lt;a href="https://pigsty.cc/docs/concept/ha/"&gt;&lt;strong&gt;高可用&lt;/strong&gt;&lt;/a&gt; PostgreSQL 集群，该集群中的相关实体包括：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;&lt;span class="text-secondary"&gt;&lt;strong&gt;集群&lt;/strong&gt;&lt;/span&gt;&lt;/th&gt;
 &lt;th&gt;&lt;span class="text-secondary"&gt;&lt;strong&gt;Cluster&lt;/strong&gt;&lt;/span&gt;&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;pg-test&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;PostgreSQL 3 节点高可用集群&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;span class="text-success"&gt;&lt;strong&gt;实例&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;td&gt;&lt;span class="text-success"&gt;&lt;strong&gt;Instance&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;pg-test-1&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;1 号 PostgreSQL 实例，默认为主库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;pg-test-2&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;2 号 PostgreSQL 实例，初始为从库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;pg-test-3&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;3 号 PostgreSQL 实例，初始为从库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;span class="text-info"&gt;&lt;strong&gt;服务&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;td&gt;&lt;span class="text-info"&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/service/#primary%E6%9C%8D%E5%8A%A1"&gt;&lt;strong&gt;&lt;code&gt;pg-test-primary&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;读写服务（路由到主库 pgbouncer）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/service/#replica%E6%9C%8D%E5%8A%A1"&gt;&lt;strong&gt;&lt;code&gt;pg-test-replica&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;只读服务（路由到从库 pgbouncer）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/service/#default%E6%9C%8D%E5%8A%A1"&gt;&lt;strong&gt;&lt;code&gt;pg-test-default&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;直连读写服务（路由到主库 postgres）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/service/#offline%E6%9C%8D%E5%8A%A1"&gt;&lt;strong&gt;&lt;code&gt;pg-test-offline&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td&gt;离线读取服务（路由到专用 postgres）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;span class="text-danger"&gt;&lt;strong&gt;节点&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;td&gt;&lt;span class="text-danger"&gt;&lt;strong&gt;Nodes&lt;/strong&gt;&lt;/span&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;node-1&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;10.10.10.11&lt;/code&gt; 1 号节点，对应 &lt;code&gt;pg-test-1&lt;/code&gt; PG 实例&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;node-2&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;10.10.10.12&lt;/code&gt; 2 号节点，对应 &lt;code&gt;pg-test-2&lt;/code&gt; PG 实例&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;&lt;code&gt;node-3&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;10.10.10.13&lt;/code&gt; 3 号节点，对应 &lt;code&gt;pg-test-3&lt;/code&gt; PG 实例&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/ha.png" alt="ha"&gt;&lt;/p&gt;</description></item><item><title>ETCD 集群模型</title><link>https://pigsty.cc/docs/concept/model/etcd/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/etcd/</guid><description>&lt;p&gt;ETCD 模块在生产环境中以&lt;strong&gt;集群&lt;/strong&gt;的形式组织，这些&lt;strong&gt;集群&lt;/strong&gt;是由一组通过 &lt;strong&gt;Raft&lt;/strong&gt; 共识协议关联的 ETCD &lt;strong&gt;实例&lt;/strong&gt;组成的&lt;strong&gt;逻辑实体&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;每个集群都是一个&lt;strong&gt;自治&lt;/strong&gt;的分布式键值存储单元，由至少一个 &lt;strong&gt;ETCD 实例&lt;/strong&gt; 组成，通过客户端端口向外暴露服务能力。&lt;/p&gt;
&lt;p&gt;在 Pigsty 的 ETCD 模块中有三种核心实体：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;集群&lt;/strong&gt;（Cluster）：自治的 ETCD 服务单元，用作其他实体的顶级命名空间。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实例&lt;/strong&gt;（Instance）：单个 ETCD 服务器进程，在节点上运行，参与 Raft 共识。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;节点&lt;/strong&gt;（Node）：运行 Linux + Systemd 环境的硬件资源抽象，隐含式声明。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;相比于 PostgreSQL 集群，ETCD 集群模型更为简单，没有服务（Service）和复杂的角色（Role）区分。
所有 ETCD 实例在功能上是对等的，通过 Raft 协议选举出 Leader，其余为 Follower。
在扩容的中间状态，还允许不参与投票的 Learner 实例成员存在。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="具体样例"&gt;具体样例&lt;/h2&gt;
&lt;p&gt;让我们来看一个具体的例子，以三节点的 ETCD 集群为例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;etcd&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;etcd_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;etcd_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;2&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;etcd_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;3&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;etcd_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;etcd&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的配置片段定义了一个如下所示的三节点 ETCD 集群，该集群中的相关实体包括：&lt;/p&gt;</description></item><item><title>MINIO 集群模型</title><link>https://pigsty.cc/docs/concept/model/minio/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/minio/</guid><description>&lt;p&gt;MinIO 模块在生产环境中以&lt;strong&gt;集群&lt;/strong&gt;的形式组织，这些&lt;strong&gt;集群&lt;/strong&gt;是由一组分布式 MinIO &lt;strong&gt;实例&lt;/strong&gt;组成的&lt;strong&gt;逻辑实体&lt;/strong&gt;，共同提供高可用的对象存储服务。&lt;/p&gt;
&lt;p&gt;每个集群都是一个&lt;strong&gt;自治&lt;/strong&gt;的 S3 兼容对象存储单元，由至少一个 &lt;strong&gt;MinIO 实例&lt;/strong&gt; 组成，通过 S3 API 端口向外暴露服务能力。&lt;/p&gt;
&lt;p&gt;在 Pigsty 的 MinIO 模块中有三种核心实体：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;集群&lt;/strong&gt;（Cluster）：自治的 MinIO 服务单元，用作其他实体的顶级命名空间。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实例&lt;/strong&gt;（Instance）：单个 MinIO 服务器进程，在节点上运行，管理本地磁盘存储。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;节点&lt;/strong&gt;（Node）：运行 Linux + Systemd 环境的硬件资源抽象，隐含式声明。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此外，MinIO 还有 &lt;a href="https://pigsty.cc/docs/minio/config#%E5%A4%9A%E6%B1%A0%E9%83%A8%E7%BD%B2"&gt;&lt;strong&gt;存储池&lt;/strong&gt;&lt;/a&gt;（Pool）的概念，用于集群平滑扩容。
一个集群可以包含多个存储池，每个存储池由一组节点和磁盘组成。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="部署模式"&gt;部署模式&lt;/h2&gt;
&lt;p&gt;MinIO 支持三种主要部署模式，适用于不同的场景：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;模式&lt;/th&gt;
 &lt;th style="text-align: center"&gt;代号&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;th style="text-align: left"&gt;适用场景&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98"&gt;&lt;strong&gt;单机单盘&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;SNSD&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;单节点，单个数据目录，或单块磁盘&lt;/td&gt;
 &lt;td style="text-align: left"&gt;开发、测试、演示&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98"&gt;&lt;strong&gt;单机多盘&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;SNMD&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;单节点，使用多块磁盘，通常至少 4 块盘&lt;/td&gt;
 &lt;td style="text-align: left"&gt;资源受限的小规模部署&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="https://pigsty.cc/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98"&gt;&lt;strong&gt;多机多盘&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;strong&gt;MNMD&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;多节点，每节点多块磁盘&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;生产环境推荐&lt;/strong&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;单机单盘模式可以使用任意目录作为存储，适合快速体验；单机多盘和多机多盘模式需要使用真实的磁盘挂载点，否则会拒绝启动。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="具体样例"&gt;具体样例&lt;/h2&gt;
&lt;p&gt;让我们来看一个多机多盘模式的具体例子，以四节点的 MinIO 集群为例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;2&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;3&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.13&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_seq&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;4&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;minio&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_data&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;/data{1...4}&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;minio_node&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;${minio_cluster}-${minio_seq}.pigsty&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的配置片段定义了一个四节点的 MinIO 集群，每个节点使用四块磁盘，该集群中的相关实体包括：&lt;/p&gt;</description></item><item><title>REDIS 集群模型</title><link>https://pigsty.cc/docs/concept/model/redis/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/redis/</guid><description>&lt;p&gt;Redis 模块在生产环境中以&lt;strong&gt;集群&lt;/strong&gt;的形式组织，这些&lt;strong&gt;集群&lt;/strong&gt;是由一组 Redis &lt;strong&gt;实例&lt;/strong&gt;组成的&lt;strong&gt;逻辑实体&lt;/strong&gt;，部署在一个或多个&lt;strong&gt;节点&lt;/strong&gt;上。&lt;/p&gt;
&lt;p&gt;每个集群都是一个&lt;strong&gt;自治&lt;/strong&gt;的高性能缓存/存储单元，由至少一个 &lt;strong&gt;Redis 实例&lt;/strong&gt; 组成，通过端口向外暴露服务能力。&lt;/p&gt;
&lt;p&gt;在 Pigsty 的 Redis 模块中有三种核心实体：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;集群&lt;/strong&gt;（Cluster）：自治的 Redis 服务单元，用作其他实体的顶级命名空间。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实例&lt;/strong&gt;（Instance）：单个 Redis 服务器进程，在节点上的特定端口运行。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;节点&lt;/strong&gt;（Node）：运行 Linux + Systemd 环境的硬件资源抽象，可以承载多个 Redis 实例，隐含式声明。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;与 PostgreSQL 不同，Redis 采用 &lt;strong&gt;单机多实例&lt;/strong&gt; 的部署模型：一个物理/虚拟机节点上通常会部署 &lt;strong&gt;多个&lt;/strong&gt; Redis 实例，
以充分利用多核 CPU。因此，节点与实例是 &lt;strong&gt;1:N&lt;/strong&gt; 的关系。此外，生产中通常不建议设置单个内存规模大于 12GB 的 Redis 实例。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="工作模式"&gt;工作模式&lt;/h2&gt;
&lt;p&gt;Redis 有三种不同的工作模式，由 &lt;a href="https://pigsty.cc/docs/redis/param#redis_mode"&gt;&lt;strong&gt;&lt;code&gt;redis_mode&lt;/code&gt;&lt;/strong&gt;&lt;/a&gt; 参数指定：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: center"&gt;模式&lt;/th&gt;
 &lt;th style="text-align: center"&gt;代号&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;th style="text-align: left"&gt;高可用机制&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4"&gt;&lt;strong&gt;主从模式&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;standalone&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;经典主从复制，&lt;strong&gt;默认模式&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;需配合 Sentinel 实现&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4"&gt;&lt;strong&gt;哨兵模式&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;sentinel&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;为主从模式提供高可用监控与自动故障转移&lt;/td&gt;
 &lt;td style="text-align: left"&gt;本身的多节点仲裁&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: center"&gt;&lt;a href="#%E5%8E%9F%E7%94%9F%E9%9B%86%E7%BE%A4"&gt;&lt;strong&gt;原生集群模式&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: center"&gt;&lt;code&gt;cluster&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Redis 原生分布式集群，无需哨兵即可高可用&lt;/td&gt;
 &lt;td style="text-align: left"&gt;内置自动故障转移&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;主从模式&lt;/strong&gt;：默认模式，通过 &lt;code&gt;replica_of&lt;/code&gt; 参数设置主从复制关系。需要额外的 Sentinel 集群提供高可用。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;哨兵模式&lt;/strong&gt;：不存储业务数据，专门用于监控主从模式的 Redis 集群，实现自动故障转移，本身多节点即可高可用。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;原生集群模式&lt;/strong&gt;：数据自动分片到多个主节点，每个主节点可以有多个从节点，内置高可用能力，无需哨兵支持。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="具体样例"&gt;具体样例&lt;/h2&gt;
&lt;p&gt;让我们来看三种模式的具体例子：&lt;/p&gt;</description></item><item><title>INFRA 集群模型</title><link>https://pigsty.cc/docs/concept/model/infra/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/model/infra/</guid><description>&lt;p&gt;INFRA 模块在 Pigsty 中承担着特殊的角色：它不是传统意义上的&amp;quot;集群&amp;quot;，而是由一组 &lt;strong&gt;基础设施节点&lt;/strong&gt; 构成的管理中枢，为整个 Pigsty 部署提供核心服务。
每个 INFRA 节点都是一个&lt;strong&gt;自治&lt;/strong&gt;的基础设施服务单元，运行着 Nginx、Grafana、VictoriaMetrics 等核心组件，共同为纳管的数据库集群提供可观测性与管理能力。&lt;/p&gt;
&lt;p&gt;在 Pigsty 的 INFRA 模块中有两种核心实体：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;节点&lt;/strong&gt;（Node）：运行基础设施组件的服务器，可以是裸机、VM、容器或 Pod。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;组件&lt;/strong&gt;（Component）：在节点上运行的各类基础设施服务，如 Nginx、Grafana、VictoriaMetrics 等。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;INFRA 节点通常承担管理节点（Admin Node）的角色，是 Pigsty 的控制平面所在。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="组件构成"&gt;组件构成&lt;/h2&gt;
&lt;p&gt;每个 INFRA 节点上运行着以下核心组件：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;组件&lt;/th&gt;
 &lt;th style="text-align: left"&gt;端口&lt;/th&gt;
 &lt;th style="text-align: left"&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#nginx"&gt;&lt;strong&gt;Nginx&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;80/443&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Web 服务门户，本地软件仓库，统一反向代理入口&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#grafana"&gt;&lt;strong&gt;Grafana&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;3000&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;可视化平台，监控大屏，巡检与数据应用&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#victoriametrics"&gt;&lt;strong&gt;VictoriaMetrics&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;8428&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;时序数据库，兼容 Prometheus API&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#victorialogs"&gt;&lt;strong&gt;VictoriaLogs&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;9428&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;日志数据库，接收 Vector 推送的结构化日志&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#victoriatraces"&gt;&lt;strong&gt;VictoriaTraces&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;10428&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;链路追踪存储，用于慢 SQL / 请求追踪&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#vmalert"&gt;&lt;strong&gt;VMAlert&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;8880&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;告警规则评估器，基于 VictoriaMetrics 触发告警&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#alertmanager"&gt;&lt;strong&gt;Alertmanager&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;9059&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;告警聚合与分发&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#blackboxexporter"&gt;&lt;strong&gt;Blackbox Exporter&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;9115&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;ICMP/TCP/HTTP 黑盒探测&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#dnsmasq"&gt;&lt;strong&gt;DNSMASQ&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;53&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;DNS 服务器，提供内部域名解析&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/concept/arch/infra#chronyd"&gt;&lt;strong&gt;Chronyd&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;123&lt;/code&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;NTP 时间服务器&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这些组件共同构成了 Pigsty 的可观测性基础设施。&lt;/p&gt;</description></item><item><title>备份机制</title><link>https://pigsty.cc/docs/pgsql/backup/mechanism/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/backup/mechanism/</guid><description>&lt;p&gt;备份可以通过内置 &lt;a href="#%E8%84%9A%E6%9C%AC"&gt;脚本&lt;/a&gt; 调用，使用节点 &lt;a href="#%E5%AE%9A%E6%97%B6%E5%A4%87%E4%BB%BD"&gt;crontab&lt;/a&gt; 定时执行，
由 &lt;a href="https://pgbackrest.org/"&gt;pgbackrest&lt;/a&gt; 管理，存储在备份仓库中，
仓库可以是本地磁盘文件系统或 MinIO / S3，并支持不同的 &lt;a href="https://pigsty.cc/docs/pgsql/backup/repository#%E4%BB%93%E5%BA%93%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"&gt;保留&lt;/a&gt; 策略。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="脚本"&gt;脚本&lt;/h2&gt;
&lt;p&gt;您可以使用 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_dbsu"&gt;&lt;code&gt;pg_dbsu&lt;/code&gt;&lt;/a&gt; 用户（默认为 &lt;code&gt;postgres&lt;/code&gt;）执行 &lt;code&gt;pgbackrest&lt;/code&gt; 命令创建备份：&lt;/p&gt;







&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist"&gt;
 &lt;li class="nav-item"&gt;
 &lt;button class="nav-link disabled"
 id="tabs-00-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-00" role="tab"
 aria-controls="tabs-00-00" aria-selected="false"&gt;
 备份命令
 &lt;/button&gt;
 &lt;/li&gt;&lt;li class="nav-item"&gt;
 &lt;button class="nav-link active"
 id="tabs-00-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-01" role="tab"
 aria-controls="tabs-00-01" aria-selected="true"&gt;
 backup
 &lt;/button&gt;
 &lt;/li&gt;&lt;li class="nav-item"&gt;
 &lt;button class="nav-link"
 id="tabs-00-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-02" role="tab"
 aria-controls="tabs-00-02" aria-selected="false"&gt;
 full
 &lt;/button&gt;
 &lt;/li&gt;&lt;li class="nav-item"&gt;
 &lt;button class="nav-link"
 id="tabs-00-03-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-03" role="tab"
 aria-controls="tabs-00-03" aria-selected="false"&gt;
 diff
 &lt;/button&gt;
 &lt;/li&gt;&lt;li class="nav-item"&gt;
 &lt;button class="nav-link"
 id="tabs-00-04-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-04" role="tab"
 aria-controls="tabs-00-04" aria-selected="false"&gt;
 incr
 &lt;/button&gt;
 &lt;/li&gt;&lt;li class="nav-item"&gt;
 &lt;button class="nav-link"
 id="tabs-00-05-tab" data-bs-toggle="tab" data-bs-target="#tabs-00-05" role="tab"
 aria-controls="tabs-00-05" aria-selected="false"&gt;
 info
 &lt;/button&gt;
 &lt;/li&gt;
&lt;/ul&gt;

&lt;div class="tab-content" id="tabs-0-content"&gt;
 &lt;div class="tab-pane fade"
 id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab" tabindex="0"&gt;
 &lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
 &lt;/div&gt;
 &lt;div class="tab-pane fade show active"
 id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab" tabindex="0"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;pgbackrest --stanza&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta --type&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;full backup &lt;span style="color:#8f5902;font-style:italic"&gt;# 为集群 pg-meta 创建全量备份&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 &lt;/div&gt;
 &lt;div class="tab-pane fade"
 id="tabs-00-02" role="tabpanel" aria-labelled-by="tabs-00-02-tab" tabindex="0"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ pgbackrest --stanza&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta --type&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;full backup
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:57.007 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; begin 2.54.2: --annotation&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;&lt;span style="color:#000"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta ...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:57.030 P00 INFO: execute non-exclusive backup start: backup begins after the requested immediate checkpoint completes
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:57.105 P00 INFO: backup start &lt;span style="color:#000"&gt;archive&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 000000010000000000000006, &lt;span style="color:#000"&gt;lsn&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 0/6000028
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:58.540 P00 INFO: new backup &lt;span style="color:#000"&gt;label&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 20250715-013657F
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:58.588 P00 INFO: full backup &lt;span style="color:#000"&gt;size&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 44.5MB, file &lt;span style="color:#000"&gt;total&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#0000cf;font-weight:bold"&gt;1437&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:36:58.589 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; end: completed successfully &lt;span style="color:#ce5c00;font-weight:bold"&gt;(&lt;/span&gt;1584ms&lt;span style="color:#ce5c00;font-weight:bold"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 &lt;/div&gt;
 &lt;div class="tab-pane fade"
 id="tabs-00-03" role="tabpanel" aria-labelled-by="tabs-00-03-tab" tabindex="0"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ pgbackrest --stanza&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta --type&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;diff backup
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:24.952 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; begin 2.54.2: ...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:24.985 P00 INFO: last backup &lt;span style="color:#000"&gt;label&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 20250715-013657F, &lt;span style="color:#000"&gt;version&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 2.54.2
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:26.337 P00 INFO: new backup &lt;span style="color:#000"&gt;label&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 20250715-013657F_20250715-013724D
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:26.381 P00 INFO: diff backup &lt;span style="color:#000"&gt;size&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 424.3KB, file &lt;span style="color:#000"&gt;total&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#0000cf;font-weight:bold"&gt;1437&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:26.381 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; end: completed successfully &lt;span style="color:#ce5c00;font-weight:bold"&gt;(&lt;/span&gt;1431ms&lt;span style="color:#ce5c00;font-weight:bold"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 &lt;/div&gt;
 &lt;div class="tab-pane fade"
 id="tabs-00-04" role="tabpanel" aria-labelled-by="tabs-00-04-tab" tabindex="0"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ pgbackrest --stanza&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta --type&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;incr backup
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:30.305 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; begin 2.54.2: ...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:30.337 P00 INFO: last backup &lt;span style="color:#000"&gt;label&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 20250715-013657F_20250715-013724D, &lt;span style="color:#000"&gt;version&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 2.54.2
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:31.356 P00 INFO: new backup &lt;span style="color:#000"&gt;label&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 20250715-013657F_20250715-013730I
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:31.403 P00 INFO: incr backup &lt;span style="color:#000"&gt;size&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; 8.3KB, file &lt;span style="color:#000"&gt;total&lt;/span&gt; &lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#0000cf;font-weight:bold"&gt;1437&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;2025-07-15 01:37:31.403 P00 INFO: backup &lt;span style="color:#204a87"&gt;command&lt;/span&gt; end: completed successfully &lt;span style="color:#ce5c00;font-weight:bold"&gt;(&lt;/span&gt;1099ms&lt;span style="color:#ce5c00;font-weight:bold"&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 &lt;/div&gt;
 &lt;div class="tab-pane fade"
 id="tabs-00-05" role="tabpanel" aria-labelled-by="tabs-00-05-tab" tabindex="0"&gt;
 &lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ pgbackrest --stanza&lt;span style="color:#ce5c00;font-weight:bold"&gt;=&lt;/span&gt;pg-meta info
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;stanza: pg-meta
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; status: ok
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; cipher: aes-256-cbc
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; db &lt;span style="color:#ce5c00;font-weight:bold"&gt;(&lt;/span&gt;current&lt;span style="color:#ce5c00;font-weight:bold"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; wal archive min/max &lt;span style="color:#ce5c00;font-weight:bold"&gt;(&lt;/span&gt;17&lt;span style="color:#ce5c00;font-weight:bold"&gt;)&lt;/span&gt;: 000000010000000000000001/00000001000000000000000A
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; full backup: 20250715-013657F
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; timestamp start/stop: 2025-07-15 01:36:57+00 / 2025-07-15 01:36:58+00
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; wal start/stop: &lt;span style="color:#0000cf;font-weight:bold"&gt;000000010000000000000006&lt;/span&gt; / &lt;span style="color:#0000cf;font-weight:bold"&gt;000000010000000000000006&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; database size: 44.5MB, database backup size: 44.5MB
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; repo1: backup size: 8.7MB
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; diff backup: 20250715-013657F_20250715-013724D
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; timestamp start/stop: 2025-07-15 01:37:24+00 / 2025-07-15 01:37:26+00
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; database size: 44.5MB, database backup size: 424.3KB
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; repo1: backup size: 94KB
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; backup reference total: &lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt; full
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; incr backup: 20250715-013657F_20250715-013730I
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; timestamp start/stop: 2025-07-15 01:37:30+00 / 2025-07-15 01:37:31+00
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; database size: 44.5MB, database backup size: 8.3KB
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; repo1: backup size: 504B
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; backup reference total: &lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt; full, &lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt; diff&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;这里的 &lt;code&gt;stanza&lt;/code&gt; 是数据库集群名称：&lt;a href="https://pigsty.cc/docs/pgsql/param#pg_cluster"&gt;&lt;code&gt;pg_cluster&lt;/code&gt;&lt;/a&gt;，在默认配置中为 &lt;code&gt;pg-meta&lt;/code&gt;。&lt;/p&gt;</description></item><item><title>3坏2应急处理</title><link>https://pigsty.cc/docs/pgsql/tutorial/drill/</link><pubDate>Sat, 11 Jan 2025 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/tutorial/drill/</guid><description>&lt;p&gt;如果经典3节点高可用部署同时出现两台（多数主体）故障，系统通常无法自动完成故障切换，需要人工介入：&lt;/p&gt;
&lt;p&gt;首先判断另外两台服务器的情况，如果短时间内可以拉起，优先选择拉起另外两台服务。否则进入 &lt;strong&gt;紧急止血流程&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;紧急止血流程假设您的管理节点故障&lt;/strong&gt;，只有单台普通数据库节点存活，在这种情况下，最快的恢复操作流程为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;调整 HAProxy 配置，将流量指向主库。&lt;/li&gt;
&lt;li&gt;关闭 Patroni，手动提升 PostgreSQL 从库为主库。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="调整haproxy配置"&gt;调整HAProxy配置&lt;/h2&gt;
&lt;p&gt;如果你通过其他方式绕开 HAProxy 访问集群，那么可以跳过这一步。
如果你通过 HAProxy 方式访问数据库集群，那么你需要调整负载均衡配置，将读写流量手工指向主库。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;编辑 &lt;code&gt;/etc/haproxy/&amp;lt;pg_cluster&amp;gt;-primary.cfg&lt;/code&gt; 配置文件，其中 &lt;code&gt;&amp;lt;pg_cluster&amp;gt;&lt;/code&gt; 为你的 PostgreSQL 集群名称，例如 &lt;code&gt;pg-meta&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;将健康检查配置选项注释，停止进行健康鉴擦好&lt;/li&gt;
&lt;li&gt;将服务器列表中，其他两台故障的机器注释掉，只保留当前主库服务器。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-ini" data-lang="ini"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#c4a000"&gt;listen pg-meta-primary&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;bind *:5433&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;mode tcp&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;maxconn 5000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;balance roundrobin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;# 注释掉以下四行健康检查配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#option httpchk # &amp;lt;---- remove this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#option http-keep-alive # &amp;lt;---- remove this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#http-check send meth OPTIONS uri /primary # &amp;lt;---- remove this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#http-check expect status 200 # &amp;lt;---- remove this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;default-server inter 3s fastinter 1s downinter 5s rise 3 fall 3 on-marked-down shutdown-sessions slowstart 30s maxconn 3000 maxqueue 128 weight 100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c4a000"&gt;server pg-meta-1 10.10.10.10:6432 check port 8008 weight 100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;# 注释掉其他两台故障的机器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#server pg-meta-2 10.10.10.11:6432 check port 8008 weight 100 &amp;lt;---- comment this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#8f5902;font-style:italic"&gt;#server pg-meta-3 10.10.10.12:6432 check port 8008 weight 100 &amp;lt;---- comment this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;配置调整完成后，先不着急执行 &lt;code&gt;systemctl reload haproxy&lt;/code&gt; 重载生效，等待后续主库提升后一起执行。
以上配置的效果是，HAProxy 将不再进行主库健康检查（默认使用 Patroni），而是直接将写入流量指向当前主库&lt;/p&gt;</description></item><item><title>PostgreSQL</title><link>https://pigsty.cc/docs/pgsql/kernel/postgres/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/postgres/</guid><description>&lt;p&gt;&lt;a href="https://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; 是世界上最先进和最受欢迎的开源数据库。&lt;/p&gt;
&lt;p&gt;Pigsty 支持 PostgreSQL 13 ~ 18，并提供 451 个 PG 扩展。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="快速开始"&gt;快速开始&lt;/h2&gt;
&lt;p&gt;使用 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/pgsql.yml"&gt;&lt;code&gt;pgsql&lt;/code&gt;&lt;/a&gt; 配置模板 &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;安装&lt;/strong&gt;&lt;/a&gt; Pigsty。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c pgsql &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 postgres 内核&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./deploy.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 pigsty 设置一切&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;大多数 &lt;a href="https://pigsty.cc/docs/conf/"&gt;配置模板&lt;/a&gt; 默认使用 PostgreSQL 内核，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/meta.yml"&gt;&lt;code&gt;meta&lt;/code&gt;&lt;/a&gt; : &lt;strong&gt;默认&lt;/strong&gt;，带有核心扩展（vector、postgis、timescale）的 postgres&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/rich.yml"&gt;&lt;code&gt;rich&lt;/code&gt;&lt;/a&gt; : 安装了所有扩展的 postgres&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/slim.yml"&gt;&lt;code&gt;slim&lt;/code&gt;&lt;/a&gt; : 仅 postgres，无监控基础设施&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/full.yml"&gt;&lt;code&gt;full&lt;/code&gt;&lt;/a&gt; : 用于 HA 演示的 4 节点沙盒&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/pgsql.yml"&gt;&lt;code&gt;pgsql&lt;/code&gt;&lt;/a&gt; : 最小的 postgres 内核配置示例&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;原版 PostgreSQL 内核不需要特殊调整：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin ] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta, baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;vector ]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;allow grafana dashboard access cmdb from infra nodes&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_crontab&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;00 01 * * * postgres /pg/bin/pg-backup full&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 每天凌晨 1 点进行全量备份&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pgsql-main, pgsql-common ] &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# pg 内核和通用工具&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#pg_extensions: [ pg18-time ,pg18-gis ,pg18-rag ,pg18-fts ,pg18-olap ,pg18-feat ,pg18-lang ,pg18-type ,pg18-util ,pg18-func ,pg18-admin ,pg18-stat ,pg18-sec ,pg18-fdw ,pg18-sim ,pg18-etl]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="版本选择"&gt;版本选择&lt;/h2&gt;
&lt;p&gt;要使用不同的 PostgreSQL 主版本，您可以使用 &lt;code&gt;-v&lt;/code&gt; 参数进行配置：&lt;/p&gt;</description></item><item><title>Supabase</title><link>https://pigsty.cc/docs/pgsql/kernel/supabase/</link><pubDate>Sun, 23 Jun 2024 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/supabase/</guid><description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://supabase.com/"&gt;Supabase&lt;/a&gt; —— Build in a weekend, Scale to millions&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Supabase 是一个开源的 Firebase 替代，对 PostgreSQL 进行了封装，并提供了认证，开箱即用的 API，边缘函数，实时订阅，对象存储，向量嵌入能力。
这是一个低代码的一站式后端平台，能让你几乎告别大部分后端开发的工作，只需要懂数据库设计与前端即可快速出活！&lt;/p&gt;
&lt;p&gt;Supabase 的口号是：“&lt;strong&gt;花个周末写写，随便扩容至百万&lt;/strong&gt;”。诚然，在小微规模（4c8g）内的 Supabase &lt;a href="https://supabase.com/pricing"&gt;极有性价比&lt;/a&gt;，堪称赛博菩萨。
—— 但当你真的增长到百万用户时 —— 确实应该认真考虑托管自建 Supabase 了 —— 无论是出于功能，性能，还是成本上的考虑。&lt;/p&gt;
&lt;p&gt;Pigsty 为您提供完整的 Supabase 一键自建方案。自建的 Supabase 可以享受完整的 PostgreSQL 监控，IaC，PITR 与高可用，
而且相比 Supabase 云服务，提供了多达 &lt;a href="https://pgext.cloud"&gt;&lt;strong&gt;451&lt;/strong&gt;&lt;/a&gt; 个开箱即用的 PostgreSQL 扩展，并能够更充分地利用现代硬件的性能与成本优势。&lt;/p&gt;
&lt;p&gt;完整自建教程，请参考：《&lt;a href="https://pigsty.cc/docs/app/supabase"&gt;&lt;strong&gt;Supabase自建手册&lt;/strong&gt;&lt;/a&gt;》&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/supabase.webp" alt=""&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="快速上手"&gt;快速上手&lt;/h2&gt;
&lt;p&gt;Pigsty 默认提供的 &lt;a href="https://github.com/Vonng/pigsty/blob/main/conf/supa.yml"&gt;&lt;code&gt;supa.yml&lt;/code&gt;&lt;/a&gt; 配置模板定义了一套单节点 Supabase。&lt;/p&gt;
&lt;p&gt;首先，使用 Pigsty &lt;a href="https://pigsty.cc/docs/setup/install"&gt;标准安装流程&lt;/a&gt; 安装 Supabase 所需的 MinIO 与 PostgreSQL 实例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; curl -fsSL https://repo.pigsty.io/get &lt;span style="color:#000;font-weight:bold"&gt;|&lt;/span&gt; bash
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./bootstrap &lt;span style="color:#8f5902;font-style:italic"&gt;# 环境检查，安装依赖&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c supa &lt;span style="color:#8f5902;font-style:italic"&gt;# 重要：请在配置文件中修改密码等关键信息！&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./deploy.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# 安装 Pigsty，拉起 PGSQL 与 MINIO！&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请在部署 Supabase 前，根据您的实际情况，修改 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件中 &lt;a href="#%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82"&gt;关于 Supabase 的参数&lt;/a&gt;（主要是密码！）&lt;/p&gt;</description></item><item><title>Citus</title><link>https://pigsty.cc/docs/pgsql/kernel/citus/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/citus/</guid><description>&lt;p&gt;Pigsty 原生支持 Citus。这是一个基于原生 PostgreSQL 内核的分布式水平扩展插件。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/citus.jpg" alt=""&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;Citus 是一个 PostgreSQL &lt;a href="https://pigsty.cc/docs/pgsql/ext/"&gt;扩展插件&lt;/a&gt;，可以按照标准插件安装的流程，在原生 PostgreSQL 集群上加装启用。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./pgsql.yml -t pg_extension -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;pg_extensions&amp;#34;:[&amp;#34;citus&amp;#34;]}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;要定义一个 citus 集群，您需要指定以下参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://pigsty.cc/docs/pgsql/param#pg_mode"&gt;&lt;code&gt;pg_mode&lt;/code&gt;&lt;/a&gt; 必须设置为 &lt;code&gt;citus&lt;/code&gt;，而不是默认的 &lt;code&gt;pgsql&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在每个分片集群上都必须定义分片名 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_shard"&gt;&lt;code&gt;pg_shard&lt;/code&gt;&lt;/a&gt; 和分片号 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_group"&gt;&lt;code&gt;pg_group&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;必须定义 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_primary_db"&gt;&lt;code&gt;pg_primary_db&lt;/code&gt;&lt;/a&gt; 来指定由 Patroni 管理的 Citus 数据库。&lt;/li&gt;
&lt;li&gt;如果您想使用 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_dbsu"&gt;&lt;code&gt;pg_dbsu&lt;/code&gt;&lt;/a&gt; 的 &lt;code&gt;postgres&lt;/code&gt; 而不是默认的 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_admin_username"&gt;&lt;code&gt;pg_admin_username&lt;/code&gt;&lt;/a&gt; 来执行管理命令，那么 &lt;a href="https://pigsty.cc/docs/pgsql/param#pg_dbsu_password"&gt;&lt;code&gt;pg_dbsu_password&lt;/code&gt;&lt;/a&gt; 必须设置为非空的纯文本密码&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此外，还需要额外的 hba 规则，允许从本地和其他数据节点进行 SSL 访问。&lt;/p&gt;
&lt;p&gt;您可以将每个 Citus 集群分别定义为独立的分组，像标准的 PostgreSQL 集群一样，如 &lt;a href="https://github.com/Vonng/pigsty/blob/main/conf/citus.yml"&gt;&lt;code&gt;conf/dbms/citus.yml&lt;/code&gt;&lt;/a&gt; 所示：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;all&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;children&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-citus0&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 0号分片&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: pg-citus0 , pg_group&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;0&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-citus1&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 1号分片&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: pg-citus1 , pg_group&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;1&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-citus2&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 2号分片&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: pg-citus2 , pg_group&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;2&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-citus3&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 3号分片&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.13&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.14&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 2, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;replica }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: pg-citus3 , pg_group&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;3&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 所有 Citus 集群的全局参数&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_mode&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;citus &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# pgsql 集群模式需要设置为： citus&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_shard&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-citus &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 水平分片名称： pg-citus&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_primary_db&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;meta &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# citus 数据库名称：meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_dbsu_password&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;DBUser.Postgres&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 如果使用 dbsu ，那么需要为其配置一个密码&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;dbrole_admin ] } ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta ,extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;citus }, { name: postgis }, { name: timescaledb } ] } ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;user: &amp;#39;all&amp;#39; ,db: all ,addr: 127.0.0.1/32 ,auth: ssl ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;all user ssl access from localhost&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;user: &amp;#39;all&amp;#39; ,db: all ,addr: intra ,auth: ssl ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;all user ssl access from intranet&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;您也可以在一个分组内指定所有 Citus 集群成员的身份参数，如 &lt;a href="https://github.com/Vonng/pigsty/blob/main/conf/prod.yml#L298"&gt;&lt;code&gt;prod.yml&lt;/code&gt;&lt;/a&gt; 所示：&lt;/p&gt;</description></item><item><title>Babelfish</title><link>https://pigsty.cc/docs/pgsql/kernel/babelfish/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/babelfish/</guid><description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://babelfishpg.org/"&gt;Babelfish&lt;/a&gt; 是一个基于 PostgreSQL 的 MSSQL（微软 SQL Server）兼容性方案，由 AWS 开源。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;Pigsty 允许用户使用 Babelfish 与 WiltonDB 创建 Microsoft SQL Server 兼容的 PostgreSQL 集群！&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://babelfishpg.org/"&gt;Babelfish&lt;/a&gt; ：一个由 AWS 开源的 MSSQL（微软 SQL Server） 兼容性扩展插件&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wiltondb/wiltondb"&gt;WiltonDB&lt;/a&gt;： 一个专注于整合 Babelfish 的 PostgreSQL 内核发行版&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Babelfish 是一个 PostgreSQL 扩展插件，但只能在一个轻微修改过的 PostgreSQL 内核 Fork 上工作，WiltonDB 在 EL/Ubuntu 系统下提供了编译后的Fork内核二进制与扩展二进制软件包。&lt;/p&gt;
&lt;p&gt;Pigsty 可以使用 WiltonDB 替代原生的 PostgreSQL 内核，提供开箱即用的 MSSQL 兼容集群。MSSQL集群使用与管理与一套标准的 PostgreSQL 15 集群并无差异，您可以使用 Pigsty 提供的所有功能，如高可用，备份，监控等。&lt;/p&gt;
&lt;p&gt;WiltonDB 带有包括 Babelfish 在内的若干扩展插件，但不能使用 PostgreSQL 原生的扩展插件。&lt;/p&gt;
&lt;p&gt;MSSQL 兼容集群在启动后，除了监听 PostgreSQL 默认的端口外，还会监听 MSSQL 默认的 &lt;code&gt;1433&lt;/code&gt; 端口，并在此端口上通过 TDS WireProtocol 提供 MSSQL 服务。
您可以用任何 MSSQL 客户端连接至 Pigsty 提供的 MSSQL 服务，如 SQL Server Management Studio，或者使用 &lt;code&gt;sqlcmd&lt;/code&gt; 命令行工具。&lt;/p&gt;</description></item><item><title>IvorySQL</title><link>https://pigsty.cc/docs/pgsql/kernel/ivorysql/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/ivorysql/</guid><description>&lt;p&gt;&lt;a href="https://www.ivorysql.org/"&gt;IvorySQL&lt;/a&gt; 是一个开源的，旨在基于 PG 提供 “Oracle兼容性” 的 PostgreSQL 内核分支。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;IvorySQL 内核支持在 Pigsty 开源版本中提供，您的服务器需要互联网访问，直接从 IvorySQL 的官方仓库下载相关软件包。&lt;/p&gt;
&lt;p&gt;请注意，直接将 IvorySQL 加入 Pigsty 默认软件仓库中会影响原生 PostgreSQL 内核的安装。Pigsty 专业版提供包括 IvorySQL 内核在内的离线安装解决方案。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/ivory.jpg" alt=""&gt;&lt;/p&gt;
&lt;p&gt;当前 IvorySQL 的最新版本为 &lt;strong&gt;5.0&lt;/strong&gt;，对应的 PostgreSQL 版本为 &lt;strong&gt;18&lt;/strong&gt;。请注意，IvorySQL 当前仅在 EL8/EL9 上可用。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;最后一个支持 EL7 的 IvorySQL 版本为 3.3，对应 PostgreSQL 16.3；最后一个基于 PostgreSQL 17 的版本为 IvorySQL 4.4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;如果您的环境有互联网访问，您可以使用以下方式，直接将 IvorySQL 仓库加入到节点上，然后执行 PGSQL 剧本进行安装&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_repo -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;node_repo_modules&amp;#34;:&amp;#34;local,node,pgsql,ivory&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;以下参数需要针对 IvorySQL 数据库集群进行配置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# Ivory SQL Configuration&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_repo_modules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;local,node,pgsql,ivory &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# add ivorysql upstream repo&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_mode&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;ivory &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# IvorySQL Oracle Compatible Mode&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;ivorysql patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_libs&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;liboracle_parser, pg_stat_statements, auto_explain&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# do not install any vanilla postgresql extensions&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;使用 Oracle 兼容性模式时，需要动态加载 &lt;code&gt;liboracle_parser&lt;/code&gt; 扩展插件。&lt;/p&gt;</description></item><item><title>PolarDB PG</title><link>https://pigsty.cc/docs/pgsql/kernel/polardb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/polardb/</guid><description>&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;Pigsty 允许使用 PolarDB 创建带有 “国产化信创资质” 的 PostgreSQL 集群！&lt;/p&gt;
&lt;p&gt;PolarDB for PostgreSQL 基本等效于 PostgreSQL 15，任何兼容 PostgreSQL 线缆协议的客户端工具都可以访问 PolarDB 集群。&lt;/p&gt;
&lt;p&gt;Pigsty 的 PGSQL 仓库中提供了 EL7 / EL8 的 PolarDB PG 开源版安装包，但不会在 Pigsty 安装时下载到本地软件仓库。&lt;/p&gt;
&lt;p&gt;如果您需要 PolarDB PG 的离线安装支持，请考虑我们的 &lt;a href="https://pigsty.cc/docs/about/service"&gt;专业订阅服务&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/polar.jpg" alt=""&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;如果您的环境有互联网访问，您可以使用以下方式，直接将 Pigsty PGSQL 及依赖仓库加入到节点上，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_repo_modules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;local,node,pgsql&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后在 &lt;code&gt;pg_packages&lt;/code&gt; 中，使用 &lt;code&gt;polardb&lt;/code&gt; 替换原生的 &lt;code&gt;postgresql&lt;/code&gt; 软件包。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;以下参数需要针对 PolarDB 数据库集群进行特殊配置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# PGSQL &amp;amp; PolarDB&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_version&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;15&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;polardb patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# do not install any vanilla postgresql extensions&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_mode&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;polar &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# PolarDB Compatible Mode&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_default_roles&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# default roles and users in postgres cluster&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_readonly ,login: false ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;role for global read-only access }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_offline ,login: false ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;role for restricted read-only access }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_readwrite ,login: false ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;role for global read-write access }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbrole_admin ,login: false ,roles: [pg_monitor, dbrole_readwrite] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;role for object creation }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: postgres ,superuser: true ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;system superuser }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: replicator ,superuser: true ,replication: true ,roles: [pg_monitor, dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;system replicator }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# &amp;lt;- superuser is required for replication&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_dba ,superuser: true ,roles: [dbrole_admin] ,pgbouncer: true ,pool_mode: session, pool_connlimit: 16 ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pgsql admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_monitor ,roles: [pg_monitor] ,pgbouncer: true ,parameters&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#204a87;font-weight:bold"&gt;log_min_duration_statement: 1000 } ,pool_mode: session ,pool_connlimit: 8 ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pgsql monitor user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里特别注意，PolarDB PG 要求 &lt;code&gt;replicator&lt;/code&gt; 复制用户为 Superuser，与原生 PG 不同。&lt;/p&gt;</description></item><item><title>PolarDB Oracle</title><link>https://pigsty.cc/docs/pgsql/kernel/polardb-o/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/polardb-o/</guid><description>&lt;p&gt;Pigsty 允许使用 PolarDB 创建带有 “国产化信创资质” 的 PolarDB for Oracle 集群！&lt;/p&gt;
&lt;p&gt;根据 【&lt;a href="http://www.itsec.gov.cn/aqkkcp/cpgg/202312/t20231226_162074.html"&gt;安全可靠测评结果公告（2023年第1号）&lt;/a&gt;】，附表三、集中式数据库。PolarDB v2.0 属于自主可控，安全可靠的国产信创数据库。&lt;/p&gt;
&lt;p&gt;PolarDB for Oracle 是基于 PolarDB for PostgreSQL 进行二次开发的 Oracle 兼容版本，两者共用同一套内核，通过 &lt;code&gt;--compatibility-mode&lt;/code&gt; 参数进行区分。&lt;/p&gt;
&lt;p&gt;我们与阿里云内核团队合作，提供基于 PolarDB v2.0 内核与 Pigsty 的完整数据库解决方案，请联系销售咨询，或在阿里云市场自行采购。&lt;/p&gt;
&lt;p&gt;PolarDB for Oracle 内核目前仅在 EL 系统中可用。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/polar.jpg" alt=""&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="扩展"&gt;扩展&lt;/h2&gt;
&lt;p&gt;目前 PolarDB 2.0 (Oracle兼容) 内核自带了以下 &lt;strong&gt;188&lt;/strong&gt; 个扩展插件：&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;name&lt;/th&gt;
 &lt;th&gt;default_version&lt;/th&gt;
 &lt;th&gt;comment&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;cube&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;data type for multidimensional cubes&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ip4r&lt;/td&gt;
 &lt;td&gt;2.4&lt;/td&gt;
 &lt;td&gt;NULL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;adminpack&lt;/td&gt;
 &lt;td&gt;2.1&lt;/td&gt;
 &lt;td&gt;administrative functions for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;dict_xsyn&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;text search dictionary template for extended synonym processing&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;amcheck&lt;/td&gt;
 &lt;td&gt;1.4&lt;/td&gt;
 &lt;td&gt;functions for verifying relation integrity&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;autoinc&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;functions for autoincrementing fields&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore&lt;/td&gt;
 &lt;td&gt;1.8&lt;/td&gt;
 &lt;td&gt;data type for storing sets of (key, value) pairs&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;bloom&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;bloom access method - signature file based index&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;earthdistance&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;calculate great-circle distances on the surface of the Earth&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore_plperl&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between hstore and plperl&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;bool_plperl&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between bool and plperl&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;file_fdw&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;foreign-data wrapper for flat file access&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;bool_plperlu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between bool and plperlu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;fuzzystrmatch&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;determine similarities and distance between strings&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore_plperlu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between hstore and plperlu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;btree_gin&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;support for indexing common datatypes in GIN&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore_plpython2u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between hstore and plpython2u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;btree_gist&lt;/td&gt;
 &lt;td&gt;1.6&lt;/td&gt;
 &lt;td&gt;support for indexing common datatypes in GiST&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hll&lt;/td&gt;
 &lt;td&gt;2.17&lt;/td&gt;
 &lt;td&gt;type for storing hyperloglog data&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore_plpython3u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between hstore and plpython3u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;citext&lt;/td&gt;
 &lt;td&gt;1.6&lt;/td&gt;
 &lt;td&gt;data type for case-insensitive character strings&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hstore_plpythonu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between hstore and plpythonu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;hypopg&lt;/td&gt;
 &lt;td&gt;1.3.1&lt;/td&gt;
 &lt;td&gt;Hypothetical indexes for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;insert_username&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;functions for tracking who changed a table&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;dblink&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;connect to other PostgreSQL databases from within a database&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;decoderbufs&lt;/td&gt;
 &lt;td&gt;0.1.0&lt;/td&gt;
 &lt;td&gt;Logical decoding plugin that delivers WAL stream changes using a Protocol Buffer format&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;intagg&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;integer aggregator and enumerator (obsolete)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;dict_int&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;text search dictionary template for integers&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;intarray&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;functions, operators, and index support for 1-D arrays of integers&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;isn&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;data types for international product numbering standards&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;jsonb_plperl&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between jsonb and plperl&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;jsonb_plperlu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between jsonb and plperlu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;jsonb_plpython2u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between jsonb and plpython2u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;jsonb_plpython3u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between jsonb and plpython3u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;jsonb_plpythonu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between jsonb and plpythonu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;lo&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;Large Object maintenance&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;log_fdw&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;foreign-data wrapper for csvlog&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ltree&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;data type for hierarchical tree-like structures&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ltree_plpython2u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between ltree and plpython2u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ltree_plpython3u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between ltree and plpython3u&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ltree_plpythonu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;transform between ltree and plpythonu&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;moddatetime&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;functions for tracking last modification time&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;old_snapshot&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;utilities in support of old_snapshot_threshold&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;oracle_fdw&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;foreign data wrapper for Oracle access&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;oss_fdw&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;foreign-data wrapper for OSS access&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pageinspect&lt;/td&gt;
 &lt;td&gt;2.1&lt;/td&gt;
 &lt;td&gt;inspect the contents of database pages at a low level&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pase&lt;/td&gt;
 &lt;td&gt;0.0.1&lt;/td&gt;
 &lt;td&gt;ant ai similarity search&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_bigm&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;text similarity measurement and index searching based on bigrams&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_freespacemap&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;examine the free space map (FSM)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_hint_plan&lt;/td&gt;
 &lt;td&gt;1.4&lt;/td&gt;
 &lt;td&gt;controls execution plan with hinting phrases in comment of special form&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_buffercache&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;examine the shared buffer cache&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_prewarm&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;prewarm relation data&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_repack&lt;/td&gt;
 &lt;td&gt;1.4.8-1&lt;/td&gt;
 &lt;td&gt;Reorganize tables in PostgreSQL databases with minimal locks&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_sphere&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;spherical objects with useful functions, operators and index support&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_cron&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;Job scheduler for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_jieba&lt;/td&gt;
 &lt;td&gt;1.1.0&lt;/td&gt;
 &lt;td&gt;a parser for full-text search of Chinese&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_stat_kcache&lt;/td&gt;
 &lt;td&gt;2.2.1&lt;/td&gt;
 &lt;td&gt;Kernel statistics gathering&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_stat_statements&lt;/td&gt;
 &lt;td&gt;1.9&lt;/td&gt;
 &lt;td&gt;track planning and execution statistics of all SQL statements executed&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_surgery&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;extension to perform surgery on a damaged relation&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_trgm&lt;/td&gt;
 &lt;td&gt;1.6&lt;/td&gt;
 &lt;td&gt;text similarity measurement and index searching based on trigrams&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_visibility&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;examine the visibility map (VM) and page-level visibility info&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pg_wait_sampling&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;sampling based statistics of wait events&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pgaudit&lt;/td&gt;
 &lt;td&gt;1.6.2&lt;/td&gt;
 &lt;td&gt;provides auditing functionality&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pgcrypto&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;cryptographic functions&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pgrowlocks&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;show row-level locking information&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pgstattuple&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;show tuple-level statistics&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pgtap&lt;/td&gt;
 &lt;td&gt;1.2.0&lt;/td&gt;
 &lt;td&gt;Unit testing for PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pldbgapi&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;server-side support for debugging PL/pgSQL functions&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plperl&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/Perl procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plperlu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/PerlU untrusted procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plpgsql&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/pgSQL procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plpython2u&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/Python2U untrusted procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plpythonu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/PythonU untrusted procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;plsql&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Oracle compatible PL/SQL procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pltcl&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/Tcl procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;pltclu&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PL/TclU untrusted procedural language&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_bfile&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;The BFILE data type enables access to binary file LOBs that are stored in file systems outside Database&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_bpe&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_bpe&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_builtin_cast&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;Internal extension for builtin casts&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_builtin_funcs&lt;/td&gt;
 &lt;td&gt;2.0&lt;/td&gt;
 &lt;td&gt;implement polar builtin functions&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_builtin_type&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;polar_builtin_type for PolarDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_builtin_view&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;polar_builtin_view&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_catalog&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;polardb pg extend catalog&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_channel&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_channel&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_constraint&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_constraint&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_csn&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_csn&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dba_views&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_dba_views&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_alert&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_alert - supports asynchronous notification of database events.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_application_info&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_application_info - record names of executing modules or transactions in the database.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_pipe&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implements polar_dbms_pipe - package lets two or more sessions in the same instance communicate.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_aq&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement dbms_aq - provides an interface to Advanced Queuing.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_lob&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;implement dbms_lob - provides subprograms to operate on BLOBs, CLOBs, and NCLOBs.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_output&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_output - enables you to send messages from stored procedures.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_lock&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_lock - provides an interface to Oracle Lock Management services.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_aqadm&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;polar_dbms_aqadm - procedures to manage Advanced Queuing configuration and administration information.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_assert&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_assert - provide an interface to validate properties of the input value.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_metadata&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_metadata - provides a way for you to retrieve metadata from the database dictionary.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_random&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_random - a built-in random number generator, not intended for cryptography&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_crypto&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implement dbms_crypto - provides an interface to encrypt and decrypt stored data.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_redact&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_redact - provides an interface to mask data from queries by an application.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_debug&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;server-side support for debugging PL/SQL functions&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_job&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_dbms_job&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_mview&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_mview - enables to refresh materialized views.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_job_preload&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_dbms_job_preload&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_obfuscation_toolkit&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_obfuscation_toolkit - enables an application to get data md5.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_rls&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_rls - a fine-grained access control administrative built-in package&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_multi_toast_utils&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_multi_toast_utils&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_session&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_session - support to set preferences and security levels.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_odciconst&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement ODCIConst - Provide some built-in constants in Oracle.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_sql&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_sql - provides an interface to execute dynamic SQL.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_osfs_toolkit&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;osfs library tools and functions extension&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_stats&lt;/td&gt;
 &lt;td&gt;14.0&lt;/td&gt;
 &lt;td&gt;stabilize plans by fixing statistics&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_monitor&lt;/td&gt;
 &lt;td&gt;1.5&lt;/td&gt;
 &lt;td&gt;monitor functions for PolarDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_osfs_utils&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;osfs library utils extension&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_utility&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;implement polar_dbms_utility - provides various utility subprograms.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_parameter_check&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;kernel extension for parameter validation&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_dbms_xmldom&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement dbms_xmldom and dbms_xmlparser - support standard DOM interface and xml parser object&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_parameter_manager&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;Extension to select parameters for manger.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_faults&lt;/td&gt;
 &lt;td&gt;1.0.0&lt;/td&gt;
 &lt;td&gt;simulate some database faults for end user or testing system.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_monitor_preload&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;examine the polardb information&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_proxy_utils&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Extension to provide operations about proxy.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_feature_utils&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;PolarDB feature utilization&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_global_awr&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;PolarDB Global AWR Report&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_publication&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;support polardb pg logical replication&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_global_cache&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_global_cache&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_px&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Parallel Execution extension&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_serverless&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar serverless extension&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_resource_manager&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;a background process that forcibly frees user session process memory&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_sys_context&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;implement polar_sys_context - returns the value of parameter associated with the context namespace at the current instant.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_gpc&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;polar_gpc&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_tde_utils&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Internal extension for TDE&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_gtt&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;polar_gtt&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_utl_encode&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;implement polar_utl_encode - provides functions that encode RAW data into a standard encoded format&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_htap&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;extension for PolarDB HTAP&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_htap_db&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;extension for PolarDB HTAP database level operation&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_io_stat&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar io stat in multi dimension&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_utl_file&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement utl_file - support PL/SQL programs can read and write operating system text files&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_ivm&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_ivm&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_sql_mapping&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;Record error sqls and mapping them to correct one&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_stat_sql&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Kernel statistics gathering, and sql plan nodes information gathering&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;tds_fdw&lt;/td&gt;
 &lt;td&gt;2.0.2&lt;/td&gt;
 &lt;td&gt;Foreign data wrapper for querying a TDS database (Sybase or Microsoft SQL Server)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;xml2&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;XPath querying and XSLT&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_upgrade_catalogs&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;Upgrade catalogs for old version instance&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_utl_i18n&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;polar_utl_i18n&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_utl_raw&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;implement utl_raw - provides SQL functions for manipulating RAW datatypes.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;timescaledb&lt;/td&gt;
 &lt;td&gt;2.9.2&lt;/td&gt;
 &lt;td&gt;Enables scalable inserts and complex queries for time-series data&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_vfs&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar virtual file system for different storage&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;polar_worker&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;polar_worker&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;postgres_fdw&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;foreign-data wrapper for remote PostgreSQL servers&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;refint&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;functions for implementing referential integrity (obsolete)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;roaringbitmap&lt;/td&gt;
 &lt;td&gt;0.5&lt;/td&gt;
 &lt;td&gt;support for Roaring Bitmaps&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;tsm_system_time&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;TABLESAMPLE method which accepts time in milliseconds as a limit&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;vector&lt;/td&gt;
 &lt;td&gt;0.5.0&lt;/td&gt;
 &lt;td&gt;vector data type and ivfflat and hnsw access methods&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;rum&lt;/td&gt;
 &lt;td&gt;1.3&lt;/td&gt;
 &lt;td&gt;RUM index access method&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;unaccent&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;text search dictionary that removes accents&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;seg&lt;/td&gt;
 &lt;td&gt;1.4&lt;/td&gt;
 &lt;td&gt;data type for representing line segments or floating-point intervals&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;sequential_uuids&lt;/td&gt;
 &lt;td&gt;1.0.2&lt;/td&gt;
 &lt;td&gt;generator of sequential UUIDs&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;uuid-ossp&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;generate universally unique identifiers (UUIDs)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;smlar&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;compute similary of any one-dimensional arrays&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;varbitx&lt;/td&gt;
 &lt;td&gt;1.1&lt;/td&gt;
 &lt;td&gt;varbit functions pack&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;sslinfo&lt;/td&gt;
 &lt;td&gt;1.2&lt;/td&gt;
 &lt;td&gt;information about SSL certificates&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;tablefunc&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;functions that manipulate whole tables, including crosstab&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;tcn&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;Triggered change notifications&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;zhparser&lt;/td&gt;
 &lt;td&gt;1.0&lt;/td&gt;
 &lt;td&gt;a parser for full-text search of Chinese&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;address_standardizer&lt;/td&gt;
 &lt;td&gt;3.3.2&lt;/td&gt;
 &lt;td&gt;Ganos PostGIS address standardizer&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;address_standardizer_data_us&lt;/td&gt;
 &lt;td&gt;3.3.2&lt;/td&gt;
 &lt;td&gt;Ganos PostGIS address standardizer data us&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_fdw&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos Spatial FDW extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_geometry&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos geometry lite extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_geometry_pyramid&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos Geometry Pyramid extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_geometry_sfcgal&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos geometry lite sfcgal extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_geomgrid&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos geometry grid extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_importer&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos Spatial importer extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_networking&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos networking&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_pointcloud&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos pointcloud extension For POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_pointcloud_geometry&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos_pointcloud LIDAR data and ganos_geometry data for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_raster&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos raster extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_scene&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos scene extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_sfmesh&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos surface mesh extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_spatialref&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos spatial reference extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_trajectory&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos trajectory extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ganos_vomesh&lt;/td&gt;
 &lt;td&gt;6.0&lt;/td&gt;
 &lt;td&gt;Ganos volumn mesh extension for POLARDB&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;postgis_tiger_geocoder&lt;/td&gt;
 &lt;td&gt;3.3.2&lt;/td&gt;
 &lt;td&gt;Ganos PostGIS tiger geocoder&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;postgis_topology&lt;/td&gt;
 &lt;td&gt;3.3.2&lt;/td&gt;
 &lt;td&gt;Ganos PostGIS topology&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;</description></item><item><title>Percona</title><link>https://pigsty.cc/docs/pgsql/kernel/percona/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/percona/</guid><description>&lt;p&gt;&lt;a href="https://www.percona.com/postgresql/software/postgresql-distribution"&gt;Percona Postgres&lt;/a&gt; 是一个带有 &lt;a href="https://docs.percona.com/pg-tde/index.html"&gt;&lt;code&gt;pg_tde&lt;/code&gt;&lt;/a&gt;（透明数据加密）扩展的补丁 Postgres 内核。&lt;/p&gt;
&lt;p&gt;它与 PostgreSQL 18.1 兼容，在所有 Pigsty 支持的平台上都可用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://andreas.scherbaum.la/post/2025-06-30_performance-test-for-percona-transparent-data-encryption-tde/"&gt;Percona 透明数据加密（TDE）性能测试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="快速开始"&gt;快速开始&lt;/h2&gt;
&lt;p&gt;使用 Pigsty &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;标准安装流程&lt;/strong&gt;&lt;/a&gt;，配合 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/pgtde.yml"&gt;&lt;code&gt;pgtde&lt;/code&gt;&lt;/a&gt; 配置模板。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://repo.pigsty.io/get &lt;span style="color:#000;font-weight:bold"&gt;|&lt;/span&gt; bash&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt; &lt;span style="color:#204a87"&gt;cd&lt;/span&gt; ~/pigsty&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c pgtde &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 percona postgres 内核&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./deploy.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 pigsty 设置一切&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;需要调整以下参数来部署 Percona 集群：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin ] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- &lt;span style="color:#204a87;font-weight:bold"&gt;name&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;baseline&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;cmdb.sql&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty tde database&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;schemas&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#000"&gt;pigsty]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;vector, postgis, pg_tde ,pgaudit, { name: pg_stat_monitor, schema: monitor } ]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;allow grafana dashboard access cmdb from infra nodes&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_crontab&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;00 01 * * * postgres /pg/bin/pg-backup full&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 每天凌晨 1 点进行全量备份&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# Percona PostgreSQL TDE 临时设置&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;percona-main, pgsql-common ] &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 安装 percona postgres 包&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_libs&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;pg_tde, pgaudit, pg_stat_statements, pg_stat_monitor, auto_explain&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="扩展"&gt;扩展&lt;/h2&gt;
&lt;p&gt;Percona 提供了 80 个可用的扩展，包括 &lt;code&gt;pg_tde&lt;/code&gt;, &lt;code&gt;pgvector&lt;/code&gt;, &lt;code&gt;postgis&lt;/code&gt;, &lt;code&gt;pgaudit&lt;/code&gt;, &lt;code&gt;set_user&lt;/code&gt;, &lt;code&gt;pg_stat_monitor&lt;/code&gt; 等实用三方扩展。&lt;/p&gt;</description></item><item><title>PostgresML</title><link>https://pigsty.cc/docs/pgsql/kernel/pgml/</link><pubDate>Sun, 23 Jun 2024 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/pgml/</guid><description>&lt;p&gt;&lt;a href="https://postgresml.org/"&gt;PostgresML&lt;/a&gt; 是一个 PostgreSQL 扩展，支持最新的大语言模型（LLM）、向量操作、经典机器学习以及传统的 Postgres 应用负载。&lt;/p&gt;
&lt;p&gt;PostgresML (pgml) 是一个用 Rust 编写的 PostgreSQL 扩展。您可以运行独立的 Docker 镜像，但本文档不是 docker-compose 模板介绍，仅供参考。&lt;/p&gt;
&lt;p&gt;PostgresML 官方支持 Ubuntu 22.04，但我们也为 EL 8/9 维护了 RPM 版本，如果您不需要 CUDA 和 NVIDIA 相关功能的话。&lt;/p&gt;
&lt;p&gt;您需要在数据库节点上能够访问互联网，以便从 PyPI 下载 Python 依赖，并从 HuggingFace 下载模型。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;PostgresML 是一个用 Rust 编写的扩展，官方支持 Ubuntu。Pigsty 在 EL8 和 EL9 上维护了 PostgresML 的 RPM 版本。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;创建新集群&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;PostgresML 2.7.9 可用于 PostgreSQL 15，支持 Ubuntu 22.04（官方）、Debian 12 和 EL 8/9（Pigsty 维护）。要启用 &lt;code&gt;pgml&lt;/code&gt;，首先需要安装扩展：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary } }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer for meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;{&lt;span style="color:#204a87;font-weight:bold"&gt;name: postgis, schema&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;public}, {name: timescaledb}]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;allow grafana dashboard access cmdb from infra nodes&amp;#39;&lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_libs&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;pgml, pg_stat_statements, auto_explain&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;pgml_15 pgvector_15 wal2json_15 repack_15&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# ubuntu&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#pg_extensions: [ &amp;#39;postgresql-pgml-15 postgresql-15-pgvector postgresql-15-wal2json postgresql-15-repack&amp;#39; ] # ubuntu&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 EL 8/9 中，扩展名为 &lt;code&gt;pgml_15&lt;/code&gt;，对应的 Ubuntu/Debian 名称为 &lt;code&gt;postgresql-pgml-15&lt;/code&gt;。同时需要将 &lt;code&gt;pgml&lt;/code&gt; 添加到 &lt;code&gt;pg_libs&lt;/code&gt; 中。&lt;/p&gt;</description></item><item><title>OpenHalo</title><link>https://pigsty.cc/docs/pgsql/kernel/openhalo/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/openhalo/</guid><description>&lt;p&gt;&lt;a href="https://www.openhalo.org/"&gt;OpenHalo&lt;/a&gt; 是一个开源的 PostgreSQL 内核，提供 MySQL 线协议兼容性。&lt;/p&gt;
&lt;p&gt;OpenHalo 基于 PostgreSQL 14.10 内核版本，提供与 MySQL 5.7.32-log / 8.0 版本的线协议兼容性。&lt;/p&gt;
&lt;p&gt;Pigsty 在所有支持的 Linux 平台上为 OpenHalo 提供部署支持。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="快速开始"&gt;快速开始&lt;/h2&gt;
&lt;p&gt;使用 Pigsty 的 &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;标准安装流程&lt;/strong&gt;&lt;/a&gt; 和 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/mysql.yml"&gt;&lt;code&gt;mysql&lt;/code&gt;&lt;/a&gt; 配置模板。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://repo.pigsty.io/get &lt;span style="color:#000;font-weight:bold"&gt;|&lt;/span&gt; bash&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt; &lt;span style="color:#204a87"&gt;cd&lt;/span&gt; ~/pigsty&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c mysql &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 MySQL（openHalo）配置模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./deploy.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# 安装，生产部署请先在 pigsty.yml 中修改密码&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对于生产部署，请确保在运行安装剧本之前修改 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置文件中的密码参数。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer for meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: postgres, extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#000"&gt;aux_mysql]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# mysql 兼容数据库&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#000"&gt;pigsty]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;allow grafana dashboard access cmdb from infra nodes&amp;#39;&lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_crontab&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;00 01 * * * postgres /pg/bin/pg-backup full&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 每天凌晨 1 点进行全量备份&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# OpenHalo 临时设置&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_mode&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mysql &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# HaloDB 的 MySQL 兼容模式&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_version&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;14&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 当前 HaloDB 兼容 PG 主版本 14&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;openhalodb, pgsql-common ] &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 安装 openhalodb 而不是 postgresql 内核&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="使用"&gt;使用&lt;/h2&gt;
&lt;p&gt;访问 MySQL 时，实际连接使用的是 &lt;code&gt;postgres&lt;/code&gt; 数据库。请注意，MySQL 中的&amp;quot;数据库&amp;quot;概念实际上对应于 PostgreSQL 中的&amp;quot;Schema&amp;quot;。因此，&lt;code&gt;use mysql&lt;/code&gt; 实际上使用的是 &lt;code&gt;postgres&lt;/code&gt; 数据库内的 &lt;code&gt;mysql&lt;/code&gt; Schema。&lt;/p&gt;</description></item><item><title>Greenplum</title><link>https://pigsty.cc/docs/pgsql/kernel/greenplum/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/greenplum/</guid><description>&lt;p&gt;Pigsty 支持部署 Greenplum 集群，及其衍生发行版 YMatrixDB，并提供了将现有 Greenplum 部署纳入 Pigsty 监控的能力。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="概览"&gt;概览&lt;/h2&gt;
&lt;p&gt;Greenplum / YMatrix 集群部署能力仅在专业版本/企业版本中提供，目前不对外开源。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;Pigsty 提供了 Greenplum 6 (@el7) 与 Greenplum 7 (@el8) 的安装包，开源版本用户可以自行安装配置。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# EL 7 Only (Greenplum6)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_install -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;node_repo_modules&amp;#34;:&amp;#34;pgsql&amp;#34;,&amp;#34;node_packages&amp;#34;:[&amp;#34;open-source-greenplum-db-6&amp;#34;]}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# EL 8 Only (Greenplum7)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_install -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;node_repo_modules&amp;#34;:&amp;#34;pgsql&amp;#34;,&amp;#34;node_packages&amp;#34;:[&amp;#34;open-source-greenplum-db-7&amp;#34;]}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;p&gt;要定义 Greenplum 集群，需要用到 &lt;code&gt;pg_mode&lt;/code&gt; = &lt;code&gt;gpsql&lt;/code&gt;，并使用额外的身份参数 &lt;code&gt;pg_shard&lt;/code&gt; 与 &lt;code&gt;gp_role&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#================================================================#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# GPSQL Clusters #&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#================================================================#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# cluster: mx-mdw (gp master)&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;mx-mdw&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role: primary , nodename&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-mdw-1 }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;gp_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;master &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# this cluster is used as greenplum master&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_shard&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# pgsql sharding name &amp;amp; gpsql deployment name&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-mdw &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# this master cluster name is mx-mdw&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: matrixmgr , extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;matrixdbts } ] }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;meta }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta , password: DBUser.Meta , pgbouncer&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;true&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_monitor , password: DBUser.Monitor , roles: [ dbrole_readonly ], superuser&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;true&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pgbouncer_enabled&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;true&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# enable pgbouncer for greenplum master&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pgbouncer_exporter_enabled&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;false&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# enable pgbouncer_exporter for greenplum master&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_exporter_params&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;host=127.0.0.1&amp;amp;sslmode=disable&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# use 127.0.0.1 as local monitor host&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# cluster: mx-sdw (gp master)&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;#----------------------------------#&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;mx-sdw&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.11&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;nodename&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-sdw-1 &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# greenplum segment node&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_instances&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# greenplum segment instances&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6000&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg1, pg_seq: 1, pg_role: primary , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9633&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6001&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg2, pg_seq: 2, pg_role: replica , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9634&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.12&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;nodename&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-sdw-2&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_instances&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6000&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg2, pg_seq: 1, pg_role: primary , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9633&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6001&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg3, pg_seq: 2, pg_role: replica , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9634&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.13&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;nodename&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-sdw-3&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_instances&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6000&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg3, pg_seq: 1, pg_role: primary , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9633&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;6001&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster: mx-seg1, pg_seq: 2, pg_role: replica , pg_exporter_port&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#0000cf;font-weight:bold"&gt;9634&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;gp_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;segment &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# these are nodes for gp segments&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_shard&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# pgsql sharding name &amp;amp; gpsql deployment name&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;mx-sdw &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# these segment clusters name is mx-sdw&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_preflight_skip&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;true&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# skip preflight check (since pg_seq &amp;amp; pg_role &amp;amp; pg_cluster not exists)&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_exporter_config&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg_exporter_basic.yml &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# use basic config to avoid segment server crash&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_exporter_params&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;options=-c%20gp_role%3Dutility&amp;amp;sslmode=disable&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# use gp_role = utility to connect to segments&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此外，PG Exporter 需要额外的连接参数，才能连接到 Greenplum Segment 实例上采集监控指标。&lt;/p&gt;</description></item><item><title>OrioleDB</title><link>https://pigsty.cc/docs/pgsql/kernel/orioledb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/orioledb/</guid><description>&lt;p&gt;&lt;a href="https://orioledb.com/"&gt;OrioleDB&lt;/a&gt; 是一个 PostgreSQL 存储引擎扩展，声称能够提供 4 倍 OLTP 性能，没有 xid 环绕和表膨胀问题，并具有&amp;quot;云原生&amp;quot;（数据存储在 S3）能力。&lt;/p&gt;
&lt;p&gt;OrioleDB 的最新版本基于 &lt;a href="https://github.com/orioledb/postgres"&gt;补丁版 PostgreSQL 17.0&lt;/a&gt; 和一个额外的 &lt;a href="https://github.com/orioledb/orioledb"&gt;扩展&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;您可以使用 Pigsty 将 OrioleDB 作为 RDS 运行，它与 PG 17 兼容，在所有支持的 Linux 平台上都可用。
最新版本为 beta12，基于 PG 17_11 补丁。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="快速开始"&gt;快速开始&lt;/h2&gt;
&lt;p&gt;按照 Pigsty &lt;a href="https://pigsty.cc/docs/setup/install"&gt;&lt;strong&gt;标准安装&lt;/strong&gt;&lt;/a&gt; 流程，使用 &lt;a href="https://github.com/pgsty/pigsty/blob/main/conf/oriole.yml"&gt;&lt;code&gt;oriole&lt;/code&gt;&lt;/a&gt; 配置模板。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -fsSL https://repo.pigsty.io/get &lt;span style="color:#000;font-weight:bold"&gt;|&lt;/span&gt; bash&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt; &lt;span style="color:#204a87"&gt;cd&lt;/span&gt; ~/pigsty&lt;span style="color:#000;font-weight:bold"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./configure -c oriole &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 OrioleDB 配置模板&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./deploy.yml &lt;span style="color:#8f5902;font-style:italic"&gt;# 使用 OrioleDB 安装 Pigsty&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对于生产部署，请确保在运行 &lt;code&gt;install&lt;/code&gt; 剧本之前修改 &lt;code&gt;pigsty.yml&lt;/code&gt; 配置中的密码参数。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;hosts&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;10.10.10.10&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;{&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_seq: 1, pg_role&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;primary }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;vars&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_cluster&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pg-meta&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_users&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_meta ,password: DBUser.Meta ,pgbouncer: true ,roles: [dbrole_admin] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;pigsty admin user }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;read-only viewer for meta database }&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_databases&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty], extensions&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#000"&gt;orioledb]}&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_hba_rules&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;- {&lt;span style="color:#204a87;font-weight:bold"&gt;user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;allow grafana dashboard access cmdb from infra nodes&amp;#39;&lt;/span&gt;}&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;node_crontab&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;00 01 * * * postgres /pg/bin/pg-backup full&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;]&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 每天凌晨 1 点进行全量备份&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# OrioleDB 临时设置&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_mode&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;oriole &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# oriole 兼容模式&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_packages&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;[&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#000"&gt;orioledb, pgsql-common ] &lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 安装 OrioleDB 内核&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#204a87;font-weight:bold"&gt;pg_libs&lt;/span&gt;&lt;span style="color:#000;font-weight:bold"&gt;:&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#4e9a06"&gt;&amp;#39;orioledb, pg_stat_statements, auto_explain&amp;#39;&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt; &lt;/span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# 加载 OrioleDB 扩展&lt;/span&gt;&lt;span style="color:#f8f8f8"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="使用"&gt;使用&lt;/h2&gt;
&lt;p&gt;要使用 OrioleDB，您需要安装 &lt;code&gt;orioledb_17&lt;/code&gt; 和 &lt;code&gt;oriolepg_17&lt;/code&gt; 包（目前仅提供 RPM 版本）。&lt;/p&gt;</description></item><item><title>Cloudberry</title><link>https://pigsty.cc/docs/pgsql/kernel/cloudberry/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/cloudberry/</guid><description>&lt;hr&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;p&gt;Pigsty 提供了 Greenplum 6 (@el7) 与 Greenplum 7 (@el8) 的安装包，开源版本用户可以自行安装配置。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# EL 7 Only (Greenplum6)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_install -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;node_repo_modules&amp;#34;:&amp;#34;pgsql&amp;#34;,&amp;#34;node_packages&amp;#34;:[&amp;#34;cloudberrydb&amp;#34;]}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#8f5902;font-style:italic"&gt;# EL 8 Only (Greenplum7)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;./node.yml -t node_install -e &lt;span style="color:#4e9a06"&gt;&amp;#39;{&amp;#34;node_repo_modules&amp;#34;:&amp;#34;pgsql&amp;#34;,&amp;#34;node_packages&amp;#34;:[&amp;#34;cloudberrydb&amp;#34;]}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Neon</title><link>https://pigsty.cc/docs/pgsql/kernel/neon/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/neon/</guid><description>&lt;p&gt;&lt;a href="https://github.com/neondatabase/neon"&gt;&lt;strong&gt;Neon&lt;/strong&gt;&lt;/a&gt; 采用了存储与计算分离架构，提供了丝滑的自动扩缩容，Scale to Zero，以及数据库版本分叉等独家能力。&lt;/p&gt;
&lt;p&gt;Neon 官网：https://neon.tech/&lt;/p&gt;
&lt;p&gt;Neon 编译后的二进制产物过于庞大，目前不对开源版用户提供，目前处于试点阶段，有需求请联系 Pigsty 销售。&lt;/p&gt;</description></item><item><title>内核分支</title><link>https://pigsty.cc/docs/pgsql/kernel/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/pgsql/kernel/</guid><description>&lt;p&gt;在 Pigsty 中，您可以使用不同 &amp;ldquo;&lt;strong&gt;风味&lt;/strong&gt;&amp;rdquo; 的 PostgreSQL 分支替换 &amp;ldquo;原生PG内核&amp;rdquo;，实现特殊的功能与效果。&lt;/p&gt;
&lt;p&gt;Pigsty 支持各种 PostgreSQL 内核和兼容分支，使您能够模拟不同的数据库系统，同时利用 PostgreSQL 的生态系统。每个内核都能提供独特的功能和兼容性层。&lt;/p&gt;
&lt;table class="full-width"&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;内核&lt;/th&gt;
 &lt;th style="text-align: left"&gt;关键特性&lt;/th&gt;
 &lt;th style="text-align: left"&gt;描述&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql"&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;451扩展&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;原版 PostgreSQL，配备 451 扩展&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/citus"&gt;&lt;strong&gt;Citus&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;水平扩展&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;通过原生扩展实现分布式 PostgreSQL&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/babelfish"&gt;&lt;strong&gt;WiltonDB&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;SQL Server 兼容&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;SQL Server 线协议兼容&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/ivorysql"&gt;&lt;strong&gt;IvorySQL&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;Oracle 兼容&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Oracle 语法和 PL/SQL 兼容&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/openhalo"&gt;&lt;strong&gt;OpenHalo&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;MySQL 兼容&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;MySQL 线协议兼容&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/percona"&gt;&lt;strong&gt;Percona&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;透明数据加密&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;带有 pg_tde 的 Percona 发行版&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/ferret"&gt;&lt;strong&gt;FerretDB&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;MongoDB 迁移&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;MongoDB 线协议兼容&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/orioledb"&gt;&lt;strong&gt;OrioleDB&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;OLTP 优化&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;Zheap，无膨胀，S3 存储&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/polardb"&gt;&lt;strong&gt;PolarDB&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;Aurora 风格 RAC&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;RAC，中国国产合规&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/supabase"&gt;&lt;strong&gt;Supabase&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;后端即服务&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;基于 PostgreSQL 的 BaaS，Firebase 替代方案&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;a href="https://pigsty.cc/docs/pgsql/kernel/cloudberry"&gt;&lt;strong&gt;Cloudberry&lt;/strong&gt;&lt;/a&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;&lt;strong&gt;MPP数仓与数据分析&lt;/strong&gt;&lt;/td&gt;
 &lt;td style="text-align: left"&gt;大规模并行处理数据仓库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;</description></item><item><title>服务接入</title><link>https://pigsty.cc/docs/concept/ha/svc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pigsty.cc/docs/concept/ha/svc/</guid><description>&lt;blockquote&gt;
&lt;p&gt;分离读写操作，正确路由流量，稳定可靠地交付 PostgreSQL 集群提供的能力。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="#%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0"&gt;服务&lt;/a&gt; 是一种抽象：它是数据库集群对外提供能力的形式，并封装了底层集群的细节。&lt;/p&gt;
&lt;p&gt;服务对于生产环境中的 &lt;a href="#%E6%8E%A5%E5%85%A5%E6%9C%8D%E5%8A%A1"&gt;稳定接入&lt;/a&gt; 至关重要，在 &lt;a href="https://pigsty.cc/docs/concept/ha"&gt;高可用&lt;/a&gt; 集群自动故障时方显其价值，&lt;a href="#%E5%8D%95%E6%9C%BA%E7%94%A8%E6%88%B7"&gt;单机用户&lt;/a&gt; 通常不需要操心这个概念。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="单机用户"&gt;单机用户&lt;/h2&gt;
&lt;p&gt;“服务” 的概念是给生产环境用的，个人用户/单机集群可以不折腾，直接拿实例名/IP地址访问数据库。&lt;/p&gt;
&lt;p&gt;例如，Pigsty 默认的单节点 &lt;code&gt;pg-meta&lt;/code&gt;.&lt;code&gt;meta&lt;/code&gt; 数据库，就可以直接用下面三个不同的用户连接上去。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;psql postgres://dbuser_dba:DBUser.DBA@10.10.10.10/meta &lt;span style="color:#8f5902;font-style:italic"&gt;# 直接用 DBA 超级用户连上去&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;psql postgres://dbuser_meta:DBUser.Meta@10.10.10.10/meta &lt;span style="color:#8f5902;font-style:italic"&gt;# 用默认的业务管理员用户连上去&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;psql postgres://dbuser_view:DBUser.View@pg-meta/meta &lt;span style="color:#8f5902;font-style:italic"&gt;# 用默认的只读用户走实例域名连上去&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="服务概述"&gt;服务概述&lt;/h2&gt;
&lt;p&gt;在真实世界生产环境中，我们会使用基于复制的主从数据库集群。集群中有且仅有一个实例作为领导者（&lt;a href="https://pigsty.cc/docs/pgsql/config/cluster#%E8%AF%BB%E5%86%99%E4%B8%BB%E5%BA%93"&gt;主库&lt;/a&gt;）可以接受写入。
而其他实例（&lt;a href="https://pigsty.cc/docs/pgsql/config/cluster#%E5%8F%AA%E8%AF%BB%E4%BB%8E%E5%BA%93"&gt;从库&lt;/a&gt;）则会从持续从集群领导者获取变更日志，与领导者保持一致。同时，从库还可以承载只读请求，在读多写少的场景下可以显著分担主库的负担，
因此对集群的写入请求与只读请求进行区分，是一种十分常见的实践。&lt;/p&gt;
&lt;p&gt;此外对于高频短连接的生产环境，我们还会通过连接池中间件（Pgbouncer）对请求进行池化，减少连接与后端进程的创建开销。但对于ETL与变更执行等场景，我们又需要绕过连接池，直接访问数据库。
同时，高可用集群在故障时会出现故障切换（Failover），故障切换会导致集群的领导者出现变更。因此高可用的数据库方案要求写入流量可以自动适配集群的领导者变化。
这些不同的访问需求（读写分离，池化与直连，故障切换自动适配）最终抽象出 &lt;strong&gt;服务&lt;/strong&gt; （Service）的概念。&lt;/p&gt;
&lt;p&gt;通常来说，数据库集群都必须提供这种最基础的服务：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;读写服务（primary）&lt;/strong&gt; ：可以读写数据库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于生产数据库集群，至少应当提供这两种服务：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;读写服务（primary）&lt;/strong&gt; ：写入数据：只能由主库所承载。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;只读服务（replica）&lt;/strong&gt; ：读取数据：可以由从库承载，没有从库时也可由主库承载&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此外，根据具体的业务场景，可能还会有其他的服务，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;默认直连服务（default）&lt;/strong&gt; ：允许（管理）用户，绕过连接池直接访问数据库的服务&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;离线从库服务（offline）&lt;/strong&gt; ：不承接线上只读流量的专用从库，用于ETL与分析查询&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;同步从库服务（standby）&lt;/strong&gt; ：没有复制延迟的只读服务，由 &lt;a href="https://pigsty.cc/docs/pgsql/config/cluster#%E5%90%8C%E6%AD%A5%E5%A4%87%E5%BA%93"&gt;同步备库&lt;/a&gt; /主库处理只读查询&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;延迟从库服务（delayed）&lt;/strong&gt; ：访问同一个集群在一段时间之前的旧数据，由 &lt;a href="https://pigsty.cc/docs/pgsql/config/cluster#%E5%BB%B6%E8%BF%9F%E9%9B%86%E7%BE%A4"&gt;延迟从库&lt;/a&gt; 来处理&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="接入服务"&gt;接入服务&lt;/h2&gt;
&lt;p&gt;Pigsty的服务交付边界止步于集群的HAProxy，用户可以用各种手段访问这些负载均衡器。&lt;/p&gt;
&lt;p&gt;典型的做法是使用 DNS 或 VIP 接入，将其绑定在集群所有或任意数量的负载均衡器上。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://pigsty.cc/img/pigsty/access.jpg" alt="pigsty-access.jpg"&gt;&lt;/p&gt;
&lt;p&gt;你可以使用不同的 主机 &amp;amp; 端口 组合，它们以不同的方式提供 PostgreSQL 服务。&lt;/p&gt;</description></item></channel></rss>